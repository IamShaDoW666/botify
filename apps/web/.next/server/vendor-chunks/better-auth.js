"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/better-auth";
exports.ids = ["vendor-chunks/better-auth"];
exports.modules = {

/***/ "(action-browser)/../../node_modules/better-auth/dist/adapters/prisma-adapter/index.mjs":
/*!*****************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/adapters/prisma-adapter/index.mjs ***!
  \*****************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prismaAdapter: () => (/* binding */ prismaAdapter)\n/* harmony export */ });\n/* harmony import */ var _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../shared/better-auth.DdzSJf-n.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs\");\n/* harmony import */ var _shared_better_auth_gBl3F_xa_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../shared/better-auth.gBl3F_xa.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.gBl3F_xa.mjs\");\n/* harmony import */ var _shared_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../shared/better-auth.tB5eU6EY.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.tB5eU6EY.mjs\");\n/* harmony import */ var _shared_better_auth_DORkW_Ge_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../shared/better-auth.DORkW_Ge.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DORkW_Ge.mjs\");\n/* harmony import */ var _shared_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../shared/better-auth.DBGfIDnh.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DBGfIDnh.mjs\");\n/* harmony import */ var _better_auth_utils_random__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @better-auth/utils/random */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/random.mjs\");\n/* harmony import */ var better_call__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! better-call */ \"(action-browser)/../../node_modules/better-call/dist/index.js\");\n/* harmony import */ var _better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @better-auth/utils/hash */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/hash.mjs\");\n/* harmony import */ var _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @better-auth/utils/base64 */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/base64.mjs\");\n/* harmony import */ var _better_auth_utils__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @better-auth/utils */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/index.mjs\");\n/* harmony import */ var _better_auth_utils_hex__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @better-auth/utils/hex */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/hex.mjs\");\n/* harmony import */ var _shared_better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../shared/better-auth.B4Qoxdgc.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst prismaAdapter = (prisma, config) => (0,_shared_better_auth_gBl3F_xa_mjs__WEBPACK_IMPORTED_MODULE_1__.c)({\n  config: {\n    adapterId: \"prisma\",\n    adapterName: \"Prisma Adapter\",\n    usePlural: config.usePlural ?? false,\n    debugLogs: config.debugLogs ?? false\n  },\n  adapter: ({ getFieldName }) => {\n    const db = prisma;\n    const convertSelect = (select, model) => {\n      if (!select || !model) return void 0;\n      return select.reduce((prev, cur) => {\n        return {\n          ...prev,\n          [getFieldName({ model, field: cur })]: true\n        };\n      }, {});\n    };\n    function operatorToPrismaOperator(operator) {\n      switch (operator) {\n        case \"starts_with\":\n          return \"startsWith\";\n        case \"ends_with\":\n          return \"endsWith\";\n        case \"ne\":\n          return \"not\";\n        default:\n          return operator;\n      }\n    }\n    const convertWhereClause = (model, where) => {\n      if (!where) return {};\n      if (where.length === 1) {\n        const w = where[0];\n        if (!w) {\n          return;\n        }\n        return {\n          [getFieldName({ model, field: w.field })]: w.operator === \"eq\" || !w.operator ? w.value : {\n            [operatorToPrismaOperator(w.operator)]: w.value\n          }\n        };\n      }\n      const and = where.filter((w) => w.connector === \"AND\" || !w.connector);\n      const or = where.filter((w) => w.connector === \"OR\");\n      const andClause = and.map((w) => {\n        return {\n          [getFieldName({ model, field: w.field })]: w.operator === \"eq\" || !w.operator ? w.value : {\n            [operatorToPrismaOperator(w.operator)]: w.value\n          }\n        };\n      });\n      const orClause = or.map((w) => {\n        return {\n          [getFieldName({ model, field: w.field })]: w.operator === \"eq\" || !w.operator ? w.value : {\n            [operatorToPrismaOperator(w.operator)]: w.value\n          }\n        };\n      });\n      return {\n        ...andClause.length ? { AND: andClause } : {},\n        ...orClause.length ? { OR: orClause } : {}\n      };\n    };\n    return {\n      async create({ model, data: values, select }) {\n        if (!db[model]) {\n          throw new _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_0__.B(\n            `Model ${model} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`\n          );\n        }\n        return await db[model].create({\n          data: values,\n          select: convertSelect(select, model)\n        });\n      },\n      async findOne({ model, where, select }) {\n        const whereClause = convertWhereClause(model, where);\n        if (!db[model]) {\n          throw new _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_0__.B(\n            `Model ${model} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`\n          );\n        }\n        return await db[model].findFirst({\n          where: whereClause,\n          select: convertSelect(select, model)\n        });\n      },\n      async findMany({ model, where, limit, offset, sortBy }) {\n        const whereClause = convertWhereClause(model, where);\n        if (!db[model]) {\n          throw new _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_0__.B(\n            `Model ${model} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`\n          );\n        }\n        return await db[model].findMany({\n          where: whereClause,\n          take: limit || 100,\n          skip: offset || 0,\n          ...sortBy?.field ? {\n            orderBy: {\n              [getFieldName({ model, field: sortBy.field })]: sortBy.direction === \"desc\" ? \"desc\" : \"asc\"\n            }\n          } : {}\n        });\n      },\n      async count({ model, where }) {\n        const whereClause = convertWhereClause(model, where);\n        if (!db[model]) {\n          throw new _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_0__.B(\n            `Model ${model} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`\n          );\n        }\n        return await db[model].count({\n          where: whereClause\n        });\n      },\n      async update({ model, where, update }) {\n        if (!db[model]) {\n          throw new _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_0__.B(\n            `Model ${model} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`\n          );\n        }\n        const whereClause = convertWhereClause(model, where);\n        return await db[model].update({\n          where: whereClause,\n          data: update\n        });\n      },\n      async updateMany({ model, where, update }) {\n        const whereClause = convertWhereClause(model, where);\n        const result = await db[model].updateMany({\n          where: whereClause,\n          data: update\n        });\n        return result ? result.count : 0;\n      },\n      async delete({ model, where }) {\n        const whereClause = convertWhereClause(model, where);\n        try {\n          await db[model].delete({\n            where: whereClause\n          });\n        } catch (e) {\n        }\n      },\n      async deleteMany({ model, where }) {\n        const whereClause = convertWhereClause(model, where);\n        const result = await db[model].deleteMany({\n          where: whereClause\n        });\n        return result ? result.count : 0;\n      },\n      options: config\n    };\n  }\n});\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9hZGFwdGVycy9wcmlzbWEtYWRhcHRlci9pbmRleC5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUE2RTtBQUNGO0FBQzVCO0FBQ0E7QUFDQTtBQUNaO0FBQ25CO0FBQ0s7QUFDWTtBQUNGO0FBQ0Q7QUFDSTtBQUNDO0FBQ3JCO0FBQ2dCO0FBQ0Y7QUFDSTtBQUNIO0FBQ2tCOztBQUUvQywwQ0FBMEMsbUVBQWE7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxjQUFjLGNBQWM7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLG1CQUFtQjtBQUM3QztBQUNBLE9BQU8sSUFBSTtBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQix1QkFBdUI7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQix1QkFBdUI7QUFDakQ7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSwwQkFBMEIsdUJBQXVCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLGdDQUFnQyxpQkFBaUIsSUFBSTtBQUNyRCwrQkFBK0IsZUFBZTtBQUM5QztBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsNkJBQTZCO0FBQ2xEO0FBQ0Esb0JBQW9CLCtEQUFlO0FBQ25DLHFCQUFxQixPQUFPO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsT0FBTztBQUNQLHNCQUFzQixzQkFBc0I7QUFDNUM7QUFDQTtBQUNBLG9CQUFvQiwrREFBZTtBQUNuQyxxQkFBcUIsT0FBTztBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULE9BQU87QUFDUCx1QkFBdUIscUNBQXFDO0FBQzVEO0FBQ0E7QUFDQSxvQkFBb0IsK0RBQWU7QUFDbkMscUJBQXFCLE9BQU87QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4Qiw0QkFBNEI7QUFDMUQ7QUFDQSxZQUFZO0FBQ1osU0FBUztBQUNULE9BQU87QUFDUCxvQkFBb0IsY0FBYztBQUNsQztBQUNBO0FBQ0Esb0JBQW9CLCtEQUFlO0FBQ25DLHFCQUFxQixPQUFPO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULE9BQU87QUFDUCxxQkFBcUIsc0JBQXNCO0FBQzNDO0FBQ0Esb0JBQW9CLCtEQUFlO0FBQ25DLHFCQUFxQixPQUFPO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxPQUFPO0FBQ1AseUJBQXlCLHNCQUFzQjtBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLE9BQU87QUFDUCxxQkFBcUIsY0FBYztBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWCxVQUFVO0FBQ1Y7QUFDQSxPQUFPO0FBQ1AseUJBQXlCLGNBQWM7QUFDdkM7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRXdCIiwic291cmNlcyI6WyIvVXNlcnMvbWlsYW4vRGVza3RvcC9BcHBzL2JldHRlci1hdXRoL25vZGVfbW9kdWxlcy9iZXR0ZXItYXV0aC9kaXN0L2FkYXB0ZXJzL3ByaXNtYS1hZGFwdGVyL2luZGV4Lm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCIGFzIEJldHRlckF1dGhFcnJvciB9IGZyb20gJy4uLy4uL3NoYXJlZC9iZXR0ZXItYXV0aC5EZHpTSmYtbi5tanMnO1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVBZGFwdGVyIH0gZnJvbSAnLi4vLi4vc2hhcmVkL2JldHRlci1hdXRoLmdCbDNGX3hhLm1qcyc7XG5pbXBvcnQgJy4uLy4uL3NoYXJlZC9iZXR0ZXItYXV0aC50QjVlVTZFWS5tanMnO1xuaW1wb3J0ICcuLi8uLi9zaGFyZWQvYmV0dGVyLWF1dGguRE9Sa1dfR2UubWpzJztcbmltcG9ydCAnLi4vLi4vc2hhcmVkL2JldHRlci1hdXRoLkRCR2ZJRG5oLm1qcyc7XG5pbXBvcnQgJ0BiZXR0ZXItYXV0aC91dGlscy9yYW5kb20nO1xuaW1wb3J0ICd6b2QvdjQnO1xuaW1wb3J0ICdiZXR0ZXItY2FsbCc7XG5pbXBvcnQgJ0BiZXR0ZXItYXV0aC91dGlscy9oYXNoJztcbmltcG9ydCAnQG5vYmxlL2NpcGhlcnMvY2hhY2hhJztcbmltcG9ydCAnQG5vYmxlL2NpcGhlcnMvdXRpbHMnO1xuaW1wb3J0ICdAbm9ibGUvY2lwaGVycy93ZWJjcnlwdG8nO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMvYmFzZTY0JztcbmltcG9ydCAnam9zZSc7XG5pbXBvcnQgJ0Bub2JsZS9oYXNoZXMvc2NyeXB0JztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzJztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzL2hleCc7XG5pbXBvcnQgJ0Bub2JsZS9oYXNoZXMvdXRpbHMnO1xuaW1wb3J0ICcuLi8uLi9zaGFyZWQvYmV0dGVyLWF1dGguQjRRb3hkZ2MubWpzJztcblxuY29uc3QgcHJpc21hQWRhcHRlciA9IChwcmlzbWEsIGNvbmZpZykgPT4gY3JlYXRlQWRhcHRlcih7XG4gIGNvbmZpZzoge1xuICAgIGFkYXB0ZXJJZDogXCJwcmlzbWFcIixcbiAgICBhZGFwdGVyTmFtZTogXCJQcmlzbWEgQWRhcHRlclwiLFxuICAgIHVzZVBsdXJhbDogY29uZmlnLnVzZVBsdXJhbCA/PyBmYWxzZSxcbiAgICBkZWJ1Z0xvZ3M6IGNvbmZpZy5kZWJ1Z0xvZ3MgPz8gZmFsc2VcbiAgfSxcbiAgYWRhcHRlcjogKHsgZ2V0RmllbGROYW1lIH0pID0+IHtcbiAgICBjb25zdCBkYiA9IHByaXNtYTtcbiAgICBjb25zdCBjb252ZXJ0U2VsZWN0ID0gKHNlbGVjdCwgbW9kZWwpID0+IHtcbiAgICAgIGlmICghc2VsZWN0IHx8ICFtb2RlbCkgcmV0dXJuIHZvaWQgMDtcbiAgICAgIHJldHVybiBzZWxlY3QucmVkdWNlKChwcmV2LCBjdXIpID0+IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAuLi5wcmV2LFxuICAgICAgICAgIFtnZXRGaWVsZE5hbWUoeyBtb2RlbCwgZmllbGQ6IGN1ciB9KV06IHRydWVcbiAgICAgICAgfTtcbiAgICAgIH0sIHt9KTtcbiAgICB9O1xuICAgIGZ1bmN0aW9uIG9wZXJhdG9yVG9QcmlzbWFPcGVyYXRvcihvcGVyYXRvcikge1xuICAgICAgc3dpdGNoIChvcGVyYXRvcikge1xuICAgICAgICBjYXNlIFwic3RhcnRzX3dpdGhcIjpcbiAgICAgICAgICByZXR1cm4gXCJzdGFydHNXaXRoXCI7XG4gICAgICAgIGNhc2UgXCJlbmRzX3dpdGhcIjpcbiAgICAgICAgICByZXR1cm4gXCJlbmRzV2l0aFwiO1xuICAgICAgICBjYXNlIFwibmVcIjpcbiAgICAgICAgICByZXR1cm4gXCJub3RcIjtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICByZXR1cm4gb3BlcmF0b3I7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGNvbnZlcnRXaGVyZUNsYXVzZSA9IChtb2RlbCwgd2hlcmUpID0+IHtcbiAgICAgIGlmICghd2hlcmUpIHJldHVybiB7fTtcbiAgICAgIGlmICh3aGVyZS5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgY29uc3QgdyA9IHdoZXJlWzBdO1xuICAgICAgICBpZiAoIXcpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBbZ2V0RmllbGROYW1lKHsgbW9kZWwsIGZpZWxkOiB3LmZpZWxkIH0pXTogdy5vcGVyYXRvciA9PT0gXCJlcVwiIHx8ICF3Lm9wZXJhdG9yID8gdy52YWx1ZSA6IHtcbiAgICAgICAgICAgIFtvcGVyYXRvclRvUHJpc21hT3BlcmF0b3Iody5vcGVyYXRvcildOiB3LnZhbHVlXG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgY29uc3QgYW5kID0gd2hlcmUuZmlsdGVyKCh3KSA9PiB3LmNvbm5lY3RvciA9PT0gXCJBTkRcIiB8fCAhdy5jb25uZWN0b3IpO1xuICAgICAgY29uc3Qgb3IgPSB3aGVyZS5maWx0ZXIoKHcpID0+IHcuY29ubmVjdG9yID09PSBcIk9SXCIpO1xuICAgICAgY29uc3QgYW5kQ2xhdXNlID0gYW5kLm1hcCgodykgPT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIFtnZXRGaWVsZE5hbWUoeyBtb2RlbCwgZmllbGQ6IHcuZmllbGQgfSldOiB3Lm9wZXJhdG9yID09PSBcImVxXCIgfHwgIXcub3BlcmF0b3IgPyB3LnZhbHVlIDoge1xuICAgICAgICAgICAgW29wZXJhdG9yVG9QcmlzbWFPcGVyYXRvcih3Lm9wZXJhdG9yKV06IHcudmFsdWVcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICAgIGNvbnN0IG9yQ2xhdXNlID0gb3IubWFwKCh3KSA9PiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgW2dldEZpZWxkTmFtZSh7IG1vZGVsLCBmaWVsZDogdy5maWVsZCB9KV06IHcub3BlcmF0b3IgPT09IFwiZXFcIiB8fCAhdy5vcGVyYXRvciA/IHcudmFsdWUgOiB7XG4gICAgICAgICAgICBbb3BlcmF0b3JUb1ByaXNtYU9wZXJhdG9yKHcub3BlcmF0b3IpXTogdy52YWx1ZVxuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uYW5kQ2xhdXNlLmxlbmd0aCA/IHsgQU5EOiBhbmRDbGF1c2UgfSA6IHt9LFxuICAgICAgICAuLi5vckNsYXVzZS5sZW5ndGggPyB7IE9SOiBvckNsYXVzZSB9IDoge31cbiAgICAgIH07XG4gICAgfTtcbiAgICByZXR1cm4ge1xuICAgICAgYXN5bmMgY3JlYXRlKHsgbW9kZWwsIGRhdGE6IHZhbHVlcywgc2VsZWN0IH0pIHtcbiAgICAgICAgaWYgKCFkYlttb2RlbF0pIHtcbiAgICAgICAgICB0aHJvdyBuZXcgQmV0dGVyQXV0aEVycm9yKFxuICAgICAgICAgICAgYE1vZGVsICR7bW9kZWx9IGRvZXMgbm90IGV4aXN0IGluIHRoZSBkYXRhYmFzZS4gSWYgeW91IGhhdmVuJ3QgZ2VuZXJhdGVkIHRoZSBQcmlzbWEgY2xpZW50LCB5b3UgbmVlZCB0byBydW4gJ25weCBwcmlzbWEgZ2VuZXJhdGUnYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGF3YWl0IGRiW21vZGVsXS5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHZhbHVlcyxcbiAgICAgICAgICBzZWxlY3Q6IGNvbnZlcnRTZWxlY3Qoc2VsZWN0LCBtb2RlbClcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgYXN5bmMgZmluZE9uZSh7IG1vZGVsLCB3aGVyZSwgc2VsZWN0IH0pIHtcbiAgICAgICAgY29uc3Qgd2hlcmVDbGF1c2UgPSBjb252ZXJ0V2hlcmVDbGF1c2UobW9kZWwsIHdoZXJlKTtcbiAgICAgICAgaWYgKCFkYlttb2RlbF0pIHtcbiAgICAgICAgICB0aHJvdyBuZXcgQmV0dGVyQXV0aEVycm9yKFxuICAgICAgICAgICAgYE1vZGVsICR7bW9kZWx9IGRvZXMgbm90IGV4aXN0IGluIHRoZSBkYXRhYmFzZS4gSWYgeW91IGhhdmVuJ3QgZ2VuZXJhdGVkIHRoZSBQcmlzbWEgY2xpZW50LCB5b3UgbmVlZCB0byBydW4gJ25weCBwcmlzbWEgZ2VuZXJhdGUnYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGF3YWl0IGRiW21vZGVsXS5maW5kRmlyc3Qoe1xuICAgICAgICAgIHdoZXJlOiB3aGVyZUNsYXVzZSxcbiAgICAgICAgICBzZWxlY3Q6IGNvbnZlcnRTZWxlY3Qoc2VsZWN0LCBtb2RlbClcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgYXN5bmMgZmluZE1hbnkoeyBtb2RlbCwgd2hlcmUsIGxpbWl0LCBvZmZzZXQsIHNvcnRCeSB9KSB7XG4gICAgICAgIGNvbnN0IHdoZXJlQ2xhdXNlID0gY29udmVydFdoZXJlQ2xhdXNlKG1vZGVsLCB3aGVyZSk7XG4gICAgICAgIGlmICghZGJbbW9kZWxdKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEJldHRlckF1dGhFcnJvcihcbiAgICAgICAgICAgIGBNb2RlbCAke21vZGVsfSBkb2VzIG5vdCBleGlzdCBpbiB0aGUgZGF0YWJhc2UuIElmIHlvdSBoYXZlbid0IGdlbmVyYXRlZCB0aGUgUHJpc21hIGNsaWVudCwgeW91IG5lZWQgdG8gcnVuICducHggcHJpc21hIGdlbmVyYXRlJ2BcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhd2FpdCBkYlttb2RlbF0uZmluZE1hbnkoe1xuICAgICAgICAgIHdoZXJlOiB3aGVyZUNsYXVzZSxcbiAgICAgICAgICB0YWtlOiBsaW1pdCB8fCAxMDAsXG4gICAgICAgICAgc2tpcDogb2Zmc2V0IHx8IDAsXG4gICAgICAgICAgLi4uc29ydEJ5Py5maWVsZCA/IHtcbiAgICAgICAgICAgIG9yZGVyQnk6IHtcbiAgICAgICAgICAgICAgW2dldEZpZWxkTmFtZSh7IG1vZGVsLCBmaWVsZDogc29ydEJ5LmZpZWxkIH0pXTogc29ydEJ5LmRpcmVjdGlvbiA9PT0gXCJkZXNjXCIgPyBcImRlc2NcIiA6IFwiYXNjXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IDoge31cbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgYXN5bmMgY291bnQoeyBtb2RlbCwgd2hlcmUgfSkge1xuICAgICAgICBjb25zdCB3aGVyZUNsYXVzZSA9IGNvbnZlcnRXaGVyZUNsYXVzZShtb2RlbCwgd2hlcmUpO1xuICAgICAgICBpZiAoIWRiW21vZGVsXSkge1xuICAgICAgICAgIHRocm93IG5ldyBCZXR0ZXJBdXRoRXJyb3IoXG4gICAgICAgICAgICBgTW9kZWwgJHttb2RlbH0gZG9lcyBub3QgZXhpc3QgaW4gdGhlIGRhdGFiYXNlLiBJZiB5b3UgaGF2ZW4ndCBnZW5lcmF0ZWQgdGhlIFByaXNtYSBjbGllbnQsIHlvdSBuZWVkIHRvIHJ1biAnbnB4IHByaXNtYSBnZW5lcmF0ZSdgXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXdhaXQgZGJbbW9kZWxdLmNvdW50KHtcbiAgICAgICAgICB3aGVyZTogd2hlcmVDbGF1c2VcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgYXN5bmMgdXBkYXRlKHsgbW9kZWwsIHdoZXJlLCB1cGRhdGUgfSkge1xuICAgICAgICBpZiAoIWRiW21vZGVsXSkge1xuICAgICAgICAgIHRocm93IG5ldyBCZXR0ZXJBdXRoRXJyb3IoXG4gICAgICAgICAgICBgTW9kZWwgJHttb2RlbH0gZG9lcyBub3QgZXhpc3QgaW4gdGhlIGRhdGFiYXNlLiBJZiB5b3UgaGF2ZW4ndCBnZW5lcmF0ZWQgdGhlIFByaXNtYSBjbGllbnQsIHlvdSBuZWVkIHRvIHJ1biAnbnB4IHByaXNtYSBnZW5lcmF0ZSdgXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB3aGVyZUNsYXVzZSA9IGNvbnZlcnRXaGVyZUNsYXVzZShtb2RlbCwgd2hlcmUpO1xuICAgICAgICByZXR1cm4gYXdhaXQgZGJbbW9kZWxdLnVwZGF0ZSh7XG4gICAgICAgICAgd2hlcmU6IHdoZXJlQ2xhdXNlLFxuICAgICAgICAgIGRhdGE6IHVwZGF0ZVxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICBhc3luYyB1cGRhdGVNYW55KHsgbW9kZWwsIHdoZXJlLCB1cGRhdGUgfSkge1xuICAgICAgICBjb25zdCB3aGVyZUNsYXVzZSA9IGNvbnZlcnRXaGVyZUNsYXVzZShtb2RlbCwgd2hlcmUpO1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlttb2RlbF0udXBkYXRlTWFueSh7XG4gICAgICAgICAgd2hlcmU6IHdoZXJlQ2xhdXNlLFxuICAgICAgICAgIGRhdGE6IHVwZGF0ZVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdCA/IHJlc3VsdC5jb3VudCA6IDA7XG4gICAgICB9LFxuICAgICAgYXN5bmMgZGVsZXRlKHsgbW9kZWwsIHdoZXJlIH0pIHtcbiAgICAgICAgY29uc3Qgd2hlcmVDbGF1c2UgPSBjb252ZXJ0V2hlcmVDbGF1c2UobW9kZWwsIHdoZXJlKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCBkYlttb2RlbF0uZGVsZXRlKHtcbiAgICAgICAgICAgIHdoZXJlOiB3aGVyZUNsYXVzZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBhc3luYyBkZWxldGVNYW55KHsgbW9kZWwsIHdoZXJlIH0pIHtcbiAgICAgICAgY29uc3Qgd2hlcmVDbGF1c2UgPSBjb252ZXJ0V2hlcmVDbGF1c2UobW9kZWwsIHdoZXJlKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJbbW9kZWxdLmRlbGV0ZU1hbnkoe1xuICAgICAgICAgIHdoZXJlOiB3aGVyZUNsYXVzZVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdCA/IHJlc3VsdC5jb3VudCA6IDA7XG4gICAgICB9LFxuICAgICAgb3B0aW9uczogY29uZmlnXG4gICAgfTtcbiAgfVxufSk7XG5cbmV4cG9ydCB7IHByaXNtYUFkYXB0ZXIgfTtcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/adapters/prisma-adapter/index.mjs\n");

/***/ }),

/***/ "(action-browser)/../../node_modules/better-auth/dist/api/index.mjs":
/*!*********************************************************!*\
  !*** ../../node_modules/better-auth/dist/api/index.mjs ***!
  \*********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   APIError: () => (/* reexport safe */ better_call__WEBPACK_IMPORTED_MODULE_0__.APIError),\n/* harmony export */   accountInfo: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.E),\n/* harmony export */   callbackOAuth: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.a0),\n/* harmony export */   changeEmail: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.V),\n/* harmony export */   changePassword: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.U),\n/* harmony export */   createAuthEndpoint: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.j),\n/* harmony export */   createAuthMiddleware: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.i),\n/* harmony export */   createEmailVerificationToken: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.w),\n/* harmony export */   deleteUser: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.S),\n/* harmony export */   deleteUserCallback: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.J),\n/* harmony export */   error: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.C),\n/* harmony export */   forgetPassword: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.Z),\n/* harmony export */   forgetPasswordCallback: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.R),\n/* harmony export */   freshSessionMiddleware: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.n),\n/* harmony export */   getAccessToken: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.F),\n/* harmony export */   getEndpoints: () => (/* binding */ getEndpoints),\n/* harmony export */   getSession: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.m),\n/* harmony export */   getSessionFromCtx: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.k),\n/* harmony export */   linkSocialAccount: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.L),\n/* harmony export */   listSessions: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.y),\n/* harmony export */   listUserAccounts: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.K),\n/* harmony export */   ok: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.D),\n/* harmony export */   optionsMiddleware: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.q),\n/* harmony export */   originCheck: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.o),\n/* harmony export */   originCheckMiddleware: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.A),\n/* harmony export */   refreshToken: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.G),\n/* harmony export */   requestOnlySessionMiddleware: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.a2),\n/* harmony export */   requestPasswordReset: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.Q),\n/* harmony export */   requestPasswordResetCallback: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.P),\n/* harmony export */   resetPassword: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.Y),\n/* harmony export */   revokeOtherSessions: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.M),\n/* harmony export */   revokeSession: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.O),\n/* harmony export */   revokeSessions: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.N),\n/* harmony export */   router: () => (/* binding */ router),\n/* harmony export */   sendVerificationEmail: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.W),\n/* harmony export */   sendVerificationEmailFn: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.u),\n/* harmony export */   sessionMiddleware: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.l),\n/* harmony export */   setPassword: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.T),\n/* harmony export */   signInEmail: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__._),\n/* harmony export */   signInSocial: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.a1),\n/* harmony export */   signOut: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.$),\n/* harmony export */   signUpEmail: () => (/* binding */ signUpEmail),\n/* harmony export */   unlinkAccount: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.I),\n/* harmony export */   updateUser: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.z),\n/* harmony export */   verifyEmail: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.X)\n/* harmony export */ });\n/* harmony import */ var better_call__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! better-call */ \"(action-browser)/../../node_modules/better-call/dist/index.js\");\n/* harmony import */ var _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../shared/better-auth.z3dsxLxE.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.z3dsxLxE.mjs\");\n/* harmony import */ var zod_v4__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! zod/v4 */ \"(action-browser)/../../node_modules/zod/v4/classic/schemas.js\");\n/* harmony import */ var _cookies_index_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../cookies/index.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/cookies/index.mjs\");\n/* harmony import */ var _shared_better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../shared/better-auth.n2KFGwjY.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.n2KFGwjY.mjs\");\n/* harmony import */ var _shared_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../shared/better-auth.8zoxzg-F.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs\");\n/* harmony import */ var _shared_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../shared/better-auth.DBGfIDnh.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DBGfIDnh.mjs\");\n/* harmony import */ var _shared_better_auth_DcfNPS8q_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../shared/better-auth.DcfNPS8q.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DcfNPS8q.mjs\");\n/* harmony import */ var defu__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! defu */ \"(action-browser)/../../node_modules/defu/dist/defu.mjs\");\n/* harmony import */ var _shared_better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../shared/better-auth.CW6D9eSx.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.CW6D9eSx.mjs\");\n/* harmony import */ var _better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @better-auth/utils/hash */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/hash.mjs\");\n/* harmony import */ var _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @better-auth/utils/base64 */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/base64.mjs\");\n/* harmony import */ var _crypto_index_mjs__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../crypto/index.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/crypto/index.mjs\");\n/* harmony import */ var _better_auth_utils__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @better-auth/utils */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/index.mjs\");\n/* harmony import */ var _better_auth_utils_hex__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @better-auth/utils/hex */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/hex.mjs\");\n/* harmony import */ var _shared_better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../shared/better-auth.B4Qoxdgc.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs\");\n/* harmony import */ var _better_auth_utils_random__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @better-auth/utils/random */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/random.mjs\");\n/* harmony import */ var _better_fetch_fetch__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! @better-fetch/fetch */ \"(action-browser)/../../node_modules/@better-fetch/fetch/dist/index.js\");\n/* harmony import */ var _shared_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../shared/better-auth.VTXNLFMT.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.VTXNLFMT.mjs\");\n/* harmony import */ var _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../shared/better-auth.DdzSJf-n.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs\");\n/* harmony import */ var _shared_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../shared/better-auth.tB5eU6EY.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.tB5eU6EY.mjs\");\n/* harmony import */ var _better_auth_utils_hmac__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! @better-auth/utils/hmac */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/hmac.mjs\");\n/* harmony import */ var _better_auth_utils_binary__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @better-auth/utils/binary */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/binary.mjs\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst signUpEmail = () => (0,_shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.j)(\n  \"/sign-up/email\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_22__.record(zod_v4__WEBPACK_IMPORTED_MODULE_22__.string(), zod_v4__WEBPACK_IMPORTED_MODULE_22__.any()),\n    metadata: {\n      $Infer: {\n        body: {}\n      },\n      openapi: {\n        description: \"Sign up a user using email and password\",\n        requestBody: {\n          content: {\n            \"application/json\": {\n              schema: {\n                type: \"object\",\n                properties: {\n                  name: {\n                    type: \"string\",\n                    description: \"The name of the user\"\n                  },\n                  email: {\n                    type: \"string\",\n                    description: \"The email of the user\"\n                  },\n                  password: {\n                    type: \"string\",\n                    description: \"The password of the user\"\n                  },\n                  image: {\n                    type: \"string\",\n                    description: \"The profile image URL of the user\"\n                  },\n                  callbackURL: {\n                    type: \"string\",\n                    description: \"The URL to use for email verification callback\"\n                  },\n                  rememberMe: {\n                    type: \"boolean\",\n                    description: \"If this is false, the session will not be remembered. Default is `true`.\"\n                  }\n                },\n                required: [\"name\", \"email\", \"password\"]\n              }\n            }\n          }\n        },\n        responses: {\n          \"200\": {\n            description: \"Successfully created user\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    token: {\n                      type: \"string\",\n                      nullable: true,\n                      description: \"Authentication token for the session\"\n                    },\n                    user: {\n                      type: \"object\",\n                      properties: {\n                        id: {\n                          type: \"string\",\n                          description: \"The unique identifier of the user\"\n                        },\n                        email: {\n                          type: \"string\",\n                          format: \"email\",\n                          description: \"The email address of the user\"\n                        },\n                        name: {\n                          type: \"string\",\n                          description: \"The name of the user\"\n                        },\n                        image: {\n                          type: \"string\",\n                          format: \"uri\",\n                          nullable: true,\n                          description: \"The profile image URL of the user\"\n                        },\n                        emailVerified: {\n                          type: \"boolean\",\n                          description: \"Whether the email has been verified\"\n                        },\n                        createdAt: {\n                          type: \"string\",\n                          format: \"date-time\",\n                          description: \"When the user was created\"\n                        },\n                        updatedAt: {\n                          type: \"string\",\n                          format: \"date-time\",\n                          description: \"When the user was last updated\"\n                        }\n                      },\n                      required: [\n                        \"id\",\n                        \"email\",\n                        \"name\",\n                        \"emailVerified\",\n                        \"createdAt\",\n                        \"updatedAt\"\n                      ]\n                    }\n                  },\n                  required: [\"user\"]\n                  // token is optional\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    if (!ctx.context.options.emailAndPassword?.enabled || ctx.context.options.emailAndPassword?.disableSignUp) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Email and password sign up is not enabled\"\n      });\n    }\n    const body = ctx.body;\n    const {\n      name,\n      email,\n      password,\n      image,\n      callbackURL,\n      rememberMe,\n      ...additionalFields\n    } = body;\n    const isValidEmail = zod_v4__WEBPACK_IMPORTED_MODULE_22__.email().safeParse(email);\n    if (!isValidEmail.success) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.B.INVALID_EMAIL\n      });\n    }\n    const minPasswordLength = ctx.context.password.config.minPasswordLength;\n    if (password.length < minPasswordLength) {\n      ctx.context.logger.error(\"Password is too short\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.B.PASSWORD_TOO_SHORT\n      });\n    }\n    const maxPasswordLength = ctx.context.password.config.maxPasswordLength;\n    if (password.length > maxPasswordLength) {\n      ctx.context.logger.error(\"Password is too long\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.B.PASSWORD_TOO_LONG\n      });\n    }\n    const dbUser = await ctx.context.internalAdapter.findUserByEmail(email);\n    if (dbUser?.user) {\n      ctx.context.logger.info(`Sign-up attempt for existing email: ${email}`);\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNPROCESSABLE_ENTITY\", {\n        message: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.B.USER_ALREADY_EXISTS\n      });\n    }\n    const additionalData = (0,_shared_better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_3__.f)(\n      ctx.context.options,\n      additionalFields\n    );\n    const hash = await ctx.context.password.hash(password);\n    let createdUser;\n    try {\n      createdUser = await ctx.context.internalAdapter.createUser(\n        {\n          email: email.toLowerCase(),\n          name,\n          image,\n          ...additionalData,\n          emailVerified: false\n        },\n        ctx\n      );\n      if (!createdUser) {\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n          message: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.B.FAILED_TO_CREATE_USER\n        });\n      }\n    } catch (e) {\n      if (_shared_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_4__.b) {\n        ctx.context.logger.error(\"Failed to create user\", e);\n      }\n      if (e instanceof better_call__WEBPACK_IMPORTED_MODULE_0__.APIError) {\n        throw e;\n      }\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNPROCESSABLE_ENTITY\", {\n        message: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.B.FAILED_TO_CREATE_USER,\n        details: e\n      });\n    }\n    if (!createdUser) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNPROCESSABLE_ENTITY\", {\n        message: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.B.FAILED_TO_CREATE_USER\n      });\n    }\n    await ctx.context.internalAdapter.linkAccount(\n      {\n        userId: createdUser.id,\n        providerId: \"credential\",\n        accountId: createdUser.id,\n        password: hash\n      },\n      ctx\n    );\n    if (ctx.context.options.emailVerification?.sendOnSignUp || ctx.context.options.emailAndPassword.requireEmailVerification) {\n      const token = await (0,_shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.w)(\n        ctx.context.secret,\n        createdUser.email,\n        void 0,\n        ctx.context.options.emailVerification?.expiresIn\n      );\n      const url = `${ctx.context.baseURL}/verify-email?token=${token}&callbackURL=${body.callbackURL || \"/\"}`;\n      await ctx.context.options.emailVerification?.sendVerificationEmail?.(\n        {\n          user: createdUser,\n          url,\n          token\n        },\n        ctx.request\n      );\n    }\n    if (ctx.context.options.emailAndPassword.autoSignIn === false || ctx.context.options.emailAndPassword.requireEmailVerification) {\n      return ctx.json({\n        token: null,\n        user: {\n          id: createdUser.id,\n          email: createdUser.email,\n          name: createdUser.name,\n          image: createdUser.image,\n          emailVerified: createdUser.emailVerified,\n          createdAt: createdUser.createdAt,\n          updatedAt: createdUser.updatedAt\n        }\n      });\n    }\n    const session = await ctx.context.internalAdapter.createSession(\n      createdUser.id,\n      ctx,\n      rememberMe === false\n    );\n    if (!session) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.B.FAILED_TO_CREATE_SESSION\n      });\n    }\n    await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_2__.setSessionCookie)(\n      ctx,\n      {\n        session,\n        user: createdUser\n      },\n      rememberMe === false\n    );\n    return ctx.json({\n      token: session.token,\n      user: {\n        id: createdUser.id,\n        email: createdUser.email,\n        name: createdUser.name,\n        image: createdUser.image,\n        emailVerified: createdUser.emailVerified,\n        createdAt: createdUser.createdAt,\n        updatedAt: createdUser.updatedAt\n      }\n    });\n  }\n);\n\nfunction shouldRateLimit(max, window, rateLimitData) {\n  const now = Date.now();\n  const windowInMs = window * 1e3;\n  const timeSinceLastRequest = now - rateLimitData.lastRequest;\n  return timeSinceLastRequest < windowInMs && rateLimitData.count >= max;\n}\nfunction rateLimitResponse(retryAfter) {\n  return new Response(\n    JSON.stringify({\n      message: \"Too many requests. Please try again later.\"\n    }),\n    {\n      status: 429,\n      statusText: \"Too Many Requests\",\n      headers: {\n        \"X-Retry-After\": retryAfter.toString()\n      }\n    }\n  );\n}\nfunction getRetryAfter(lastRequest, window) {\n  const now = Date.now();\n  const windowInMs = window * 1e3;\n  return Math.ceil((lastRequest + windowInMs - now) / 1e3);\n}\nfunction createDBStorage(ctx) {\n  const model = \"rateLimit\";\n  const db = ctx.adapter;\n  return {\n    get: async (key) => {\n      const res = await db.findMany({\n        model,\n        where: [{ field: \"key\", value: key }]\n      });\n      const data = res[0];\n      if (typeof data?.lastRequest === \"bigint\") {\n        data.lastRequest = Number(data.lastRequest);\n      }\n      return data;\n    },\n    set: async (key, value, _update) => {\n      try {\n        if (_update) {\n          await db.updateMany({\n            model,\n            where: [{ field: \"key\", value: key }],\n            update: {\n              count: value.count,\n              lastRequest: value.lastRequest\n            }\n          });\n        } else {\n          await db.create({\n            model,\n            data: {\n              key,\n              count: value.count,\n              lastRequest: value.lastRequest\n            }\n          });\n        }\n      } catch (e) {\n        ctx.logger.error(\"Error setting rate limit\", e);\n      }\n    }\n  };\n}\nconst memory = /* @__PURE__ */ new Map();\nfunction getRateLimitStorage(ctx) {\n  if (ctx.options.rateLimit?.customStorage) {\n    return ctx.options.rateLimit.customStorage;\n  }\n  if (ctx.rateLimit.storage === \"secondary-storage\") {\n    return {\n      get: async (key) => {\n        const stringified = await ctx.options.secondaryStorage?.get(key);\n        return stringified ? JSON.parse(stringified) : void 0;\n      },\n      set: async (key, value) => {\n        await ctx.options.secondaryStorage?.set?.(key, JSON.stringify(value));\n      }\n    };\n  }\n  const storage = ctx.rateLimit.storage;\n  if (storage === \"memory\") {\n    return {\n      async get(key) {\n        return memory.get(key);\n      },\n      async set(key, value, _update) {\n        memory.set(key, value);\n      }\n    };\n  }\n  return createDBStorage(ctx);\n}\nasync function onRequestRateLimit(req, ctx) {\n  if (!ctx.rateLimit.enabled) {\n    return;\n  }\n  const path = new URL(req.url).pathname.replace(\n    ctx.options.basePath || \"/api/auth\",\n    \"\"\n  );\n  let window = ctx.rateLimit.window;\n  let max = ctx.rateLimit.max;\n  const ip = (0,_shared_better_auth_DcfNPS8q_mjs__WEBPACK_IMPORTED_MODULE_6__.g)(req, ctx.options);\n  if (!ip) {\n    console.warn(\"No IP address found for rate limiting\");\n    return;\n  }\n  const key = ip + path;\n  const specialRules = getDefaultSpecialRules();\n  const specialRule = specialRules.find((rule) => rule.pathMatcher(path));\n  if (specialRule) {\n    window = specialRule.window;\n    max = specialRule.max;\n  }\n  for (const plugin of ctx.options.plugins || []) {\n    if (plugin.rateLimit) {\n      const matchedRule = plugin.rateLimit.find(\n        (rule) => rule.pathMatcher(path)\n      );\n      if (matchedRule) {\n        window = matchedRule.window;\n        max = matchedRule.max;\n        break;\n      }\n    }\n  }\n  if (ctx.rateLimit.customRules) {\n    const _path = Object.keys(ctx.rateLimit.customRules).find((p) => {\n      if (p.includes(\"*\")) {\n        const isMatch = (0,_shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.x)(p)(path);\n        return isMatch;\n      }\n      return p === path;\n    });\n    if (_path) {\n      const customRule = ctx.rateLimit.customRules[_path];\n      const resolved = typeof customRule === \"function\" ? await customRule(req) : customRule;\n      if (resolved) {\n        window = resolved.window;\n        max = resolved.max;\n      }\n    }\n  }\n  const storage = getRateLimitStorage(ctx);\n  const data = await storage.get(key);\n  const now = Date.now();\n  if (!data) {\n    await storage.set(key, {\n      key,\n      count: 1,\n      lastRequest: now\n    });\n  } else {\n    const timeSinceLastRequest = now - data.lastRequest;\n    if (shouldRateLimit(max, window, data)) {\n      const retryAfter = getRetryAfter(data.lastRequest, window);\n      return rateLimitResponse(retryAfter);\n    } else if (timeSinceLastRequest > window * 1e3) {\n      await storage.set(\n        key,\n        {\n          ...data,\n          count: 1,\n          lastRequest: now\n        },\n        true\n      );\n    } else {\n      await storage.set(\n        key,\n        {\n          ...data,\n          count: data.count + 1,\n          lastRequest: now\n        },\n        true\n      );\n    }\n  }\n}\nfunction getDefaultSpecialRules() {\n  const specialRules = [\n    {\n      pathMatcher(path) {\n        return path.startsWith(\"/sign-in\") || path.startsWith(\"/sign-up\") || path.startsWith(\"/change-password\") || path.startsWith(\"/change-email\");\n      },\n      window: 10,\n      max: 3\n    }\n  ];\n  return specialRules;\n}\n\nfunction toAuthEndpoints(endpoints, ctx) {\n  const api = {};\n  for (const [key, endpoint] of Object.entries(endpoints)) {\n    api[key] = async (context) => {\n      const authContext = await ctx;\n      let internalContext = {\n        ...context,\n        context: {\n          ...authContext,\n          returned: void 0,\n          responseHeaders: void 0,\n          session: null\n        },\n        path: endpoint.path,\n        headers: context?.headers ? new Headers(context?.headers) : void 0\n      };\n      const { beforeHooks, afterHooks } = getHooks(authContext);\n      const before = await runBeforeHooks(internalContext, beforeHooks);\n      if (\"context\" in before && before.context && typeof before.context === \"object\") {\n        const { headers, ...rest } = before.context;\n        if (headers) {\n          headers.forEach((value, key2) => {\n            internalContext.headers.set(key2, value);\n          });\n        }\n        internalContext = (0,defu__WEBPACK_IMPORTED_MODULE_7__[\"default\"])(rest, internalContext);\n      } else if (before) {\n        return before;\n      }\n      internalContext.asResponse = false;\n      internalContext.returnHeaders = true;\n      const result = await endpoint(internalContext).catch((e) => {\n        if (e instanceof better_call__WEBPACK_IMPORTED_MODULE_0__.APIError) {\n          return {\n            response: e,\n            headers: e.headers ? new Headers(e.headers) : null\n          };\n        }\n        throw e;\n      });\n      internalContext.context.returned = result.response;\n      internalContext.context.responseHeaders = result.headers;\n      const after = await runAfterHooks(internalContext, afterHooks);\n      if (after.response) {\n        result.response = after.response;\n      }\n      if (result.response instanceof better_call__WEBPACK_IMPORTED_MODULE_0__.APIError && !context?.asResponse) {\n        throw result.response;\n      }\n      const response = context?.asResponse ? (0,better_call__WEBPACK_IMPORTED_MODULE_0__.toResponse)(result.response, {\n        headers: result.headers\n      }) : context?.returnHeaders ? {\n        headers: result.headers,\n        response: result.response\n      } : result.response;\n      return response;\n    };\n    api[key].path = endpoint.path;\n    api[key].options = endpoint.options;\n  }\n  return api;\n}\nasync function runBeforeHooks(context, hooks) {\n  let modifiedContext = {};\n  for (const hook of hooks) {\n    if (hook.matcher(context)) {\n      const result = await hook.handler({\n        ...context,\n        returnHeaders: false\n      });\n      if (result && typeof result === \"object\") {\n        if (\"context\" in result && typeof result.context === \"object\") {\n          const { headers, ...rest } = result.context;\n          if (headers instanceof Headers) {\n            if (modifiedContext.headers) {\n              headers.forEach((value, key) => {\n                modifiedContext.headers?.set(key, value);\n              });\n            } else {\n              modifiedContext.headers = headers;\n            }\n          }\n          modifiedContext = (0,defu__WEBPACK_IMPORTED_MODULE_7__[\"default\"])(rest, modifiedContext);\n          continue;\n        }\n        return result;\n      }\n    }\n  }\n  return { context: modifiedContext };\n}\nasync function runAfterHooks(context, hooks) {\n  for (const hook of hooks) {\n    if (hook.matcher(context)) {\n      const result = await hook.handler(context).catch((e) => {\n        if (e instanceof better_call__WEBPACK_IMPORTED_MODULE_0__.APIError) {\n          return {\n            response: e,\n            headers: e.headers ? new Headers(e.headers) : null\n          };\n        }\n        throw e;\n      });\n      if (result.headers) {\n        result.headers.forEach((value, key) => {\n          if (!context.context.responseHeaders) {\n            context.context.responseHeaders = new Headers({\n              [key]: value\n            });\n          } else {\n            if (key.toLowerCase() === \"set-cookie\") {\n              context.context.responseHeaders.append(key, value);\n            } else {\n              context.context.responseHeaders.set(key, value);\n            }\n          }\n        });\n      }\n      if (result.response) {\n        context.context.returned = result.response;\n      }\n    }\n  }\n  return {\n    response: context.context.returned,\n    headers: context.context.responseHeaders\n  };\n}\nfunction getHooks(authContext) {\n  const plugins = authContext.options.plugins || [];\n  const beforeHooks = [];\n  const afterHooks = [];\n  if (authContext.options.hooks?.before) {\n    beforeHooks.push({\n      matcher: () => true,\n      handler: authContext.options.hooks.before\n    });\n  }\n  if (authContext.options.hooks?.after) {\n    afterHooks.push({\n      matcher: () => true,\n      handler: authContext.options.hooks.after\n    });\n  }\n  const pluginBeforeHooks = plugins.map((plugin) => {\n    if (plugin.hooks?.before) {\n      return plugin.hooks.before;\n    }\n  }).filter((plugin) => plugin !== void 0).flat();\n  const pluginAfterHooks = plugins.map((plugin) => {\n    if (plugin.hooks?.after) {\n      return plugin.hooks.after;\n    }\n  }).filter((plugin) => plugin !== void 0).flat();\n  pluginBeforeHooks.length && beforeHooks.push(...pluginBeforeHooks);\n  pluginAfterHooks.length && afterHooks.push(...pluginAfterHooks);\n  return {\n    beforeHooks,\n    afterHooks\n  };\n}\n\nfunction getEndpoints(ctx, options) {\n  const pluginEndpoints = options.plugins?.reduce(\n    (acc, plugin) => {\n      return {\n        ...acc,\n        ...plugin.endpoints\n      };\n    },\n    {}\n  );\n  const middlewares = options.plugins?.map(\n    (plugin) => plugin.middlewares?.map((m) => {\n      const middleware = async (context) => {\n        return m.middleware({\n          ...context,\n          context: {\n            ...ctx,\n            ...context.context\n          }\n        });\n      };\n      middleware.options = m.middleware.options;\n      return {\n        path: m.path,\n        middleware\n      };\n    })\n  ).filter((plugin) => plugin !== void 0).flat() || [];\n  const baseEndpoints = {\n    signInSocial: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.a1,\n    callbackOAuth: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.a0,\n    getSession: (0,_shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.m)(),\n    signOut: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.$,\n    signUpEmail: signUpEmail(),\n    signInEmail: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__._,\n    forgetPassword: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.Z,\n    resetPassword: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.Y,\n    verifyEmail: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.X,\n    sendVerificationEmail: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.W,\n    changeEmail: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.V,\n    changePassword: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.U,\n    setPassword: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.T,\n    updateUser: (0,_shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.z)(),\n    deleteUser: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.S,\n    forgetPasswordCallback: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.R,\n    requestPasswordReset: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.Q,\n    requestPasswordResetCallback: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.P,\n    listSessions: (0,_shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.y)(),\n    revokeSession: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.O,\n    revokeSessions: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.N,\n    revokeOtherSessions: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.M,\n    linkSocialAccount: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.L,\n    listUserAccounts: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.K,\n    deleteUserCallback: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.J,\n    unlinkAccount: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.I,\n    refreshToken: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.G,\n    getAccessToken: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.F,\n    accountInfo: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.E\n  };\n  const endpoints = {\n    ...baseEndpoints,\n    ...pluginEndpoints,\n    ok: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.D,\n    error: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.C\n  };\n  const api = toAuthEndpoints(endpoints, ctx);\n  return {\n    api,\n    middlewares\n  };\n}\nconst router = (ctx, options) => {\n  const { api, middlewares } = getEndpoints(ctx, options);\n  const basePath = new URL(ctx.baseURL).pathname;\n  return (0,better_call__WEBPACK_IMPORTED_MODULE_0__.createRouter)(api, {\n    routerContext: ctx,\n    openapi: {\n      disabled: true\n    },\n    basePath,\n    routerMiddleware: [\n      {\n        path: \"/**\",\n        middleware: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.A\n      },\n      ...middlewares\n    ],\n    async onRequest(req) {\n      const disabledPaths = ctx.options.disabledPaths || [];\n      const path = new URL(req.url).pathname.replace(basePath, \"\");\n      if (disabledPaths.includes(path)) {\n        return new Response(\"Not Found\", { status: 404 });\n      }\n      for (const plugin of ctx.options.plugins || []) {\n        if (plugin.onRequest) {\n          const response = await plugin.onRequest(req, ctx);\n          if (response && \"response\" in response) {\n            return response.response;\n          }\n        }\n      }\n      return onRequestRateLimit(req, ctx);\n    },\n    async onResponse(res) {\n      for (const plugin of ctx.options.plugins || []) {\n        if (plugin.onResponse) {\n          const response = await plugin.onResponse(res, ctx);\n          if (response) {\n            return response.response;\n          }\n        }\n      }\n      return res;\n    },\n    onError(e) {\n      if (e instanceof better_call__WEBPACK_IMPORTED_MODULE_0__.APIError && e.status === \"FOUND\") {\n        return;\n      }\n      if (options.onAPIError?.throw) {\n        throw e;\n      }\n      if (options.onAPIError?.onError) {\n        options.onAPIError.onError(e, ctx);\n        return;\n      }\n      const optLogLevel = options.logger?.level;\n      const log = optLogLevel === \"error\" || optLogLevel === \"warn\" || optLogLevel === \"debug\" ? _shared_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_5__.a : void 0;\n      if (options.logger?.disabled !== true) {\n        if (e && typeof e === \"object\" && \"message\" in e && typeof e.message === \"string\") {\n          if (e.message.includes(\"no column\") || e.message.includes(\"column\") || e.message.includes(\"relation\") || e.message.includes(\"table\") || e.message.includes(\"does not exist\")) {\n            ctx.logger?.error(e.message);\n            return;\n          }\n        }\n        if (e instanceof better_call__WEBPACK_IMPORTED_MODULE_0__.APIError) {\n          if (e.status === \"INTERNAL_SERVER_ERROR\") {\n            ctx.logger.error(e.status, e);\n          }\n          log?.error(e.message);\n        } else {\n          ctx.logger?.error(\n            e && typeof e === \"object\" && \"name\" in e ? e.name : \"\",\n            e\n          );\n        }\n      }\n    }\n  });\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9hcGkvaW5kZXgubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQWlFO0FBQzFCO0FBQ3d2QjtBQUN2aEI7QUFDNU87QUFDNEI7QUFDaUI7QUFDRDtBQUNQO0FBQ0Q7QUFDeEM7QUFDb0I7QUFDWDtBQUNFO0FBQ047QUFDRTtBQUNEO0FBQ0k7QUFDcEI7QUFDZ0I7QUFDRjtBQUNJO0FBQ0g7QUFDZTtBQUNUO0FBQ047QUFDZTtBQUNBO0FBQ0E7QUFDWDtBQUNFO0FBQ2Q7O0FBRXJCLDBCQUEwQixtRUFBa0I7QUFDNUM7QUFDQTtBQUNBO0FBQ0EsVUFBVSwyQ0FBUSxDQUFDLDJDQUFRLElBQUksd0NBQUs7QUFDcEM7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFB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LHVCQUF1QixpREFBUTtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlHQUFpRywrREFBTTtBQUN2RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QixpREFBUTtBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFc2tCIiwic291cmNlcyI6WyIvVXNlcnMvbWlsYW4vRGVza3RvcC9BcHBzL2JldHRlci1hdXRoL25vZGVfbW9kdWxlcy9iZXR0ZXItYXV0aC9kaXN0L2FwaS9pbmRleC5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQVBJRXJyb3IsIHRvUmVzcG9uc2UsIGNyZWF0ZVJvdXRlciB9IGZyb20gJ2JldHRlci1jYWxsJztcbmV4cG9ydCB7IEFQSUVycm9yIH0gZnJvbSAnYmV0dGVyLWNhbGwnO1xuaW1wb3J0IHsgaiBhcyBjcmVhdGVBdXRoRW5kcG9pbnQsIEIgYXMgQkFTRV9FUlJPUl9DT0RFUywgdyBhcyBjcmVhdGVFbWFpbFZlcmlmaWNhdGlvblRva2VuLCB4IGFzIHdpbGRjYXJkTWF0Y2gsIHkgYXMgbGlzdFNlc3Npb25zLCB6IGFzIHVwZGF0ZVVzZXIsIG0gYXMgZ2V0U2Vzc2lvbiwgQSBhcyBvcmlnaW5DaGVja01pZGRsZXdhcmUsIEMgYXMgZXJyb3IsIEQgYXMgb2ssIEUgYXMgYWNjb3VudEluZm8sIEYgYXMgZ2V0QWNjZXNzVG9rZW4sIEcgYXMgcmVmcmVzaFRva2VuLCBJIGFzIHVubGlua0FjY291bnQsIEogYXMgZGVsZXRlVXNlckNhbGxiYWNrLCBLIGFzIGxpc3RVc2VyQWNjb3VudHMsIEwgYXMgbGlua1NvY2lhbEFjY291bnQsIE0gYXMgcmV2b2tlT3RoZXJTZXNzaW9ucywgTiBhcyByZXZva2VTZXNzaW9ucywgTyBhcyByZXZva2VTZXNzaW9uLCBQIGFzIHJlcXVlc3RQYXNzd29yZFJlc2V0Q2FsbGJhY2ssIFEgYXMgcmVxdWVzdFBhc3N3b3JkUmVzZXQsIFIgYXMgZm9yZ2V0UGFzc3dvcmRDYWxsYmFjaywgUyBhcyBkZWxldGVVc2VyLCBUIGFzIHNldFBhc3N3b3JkLCBVIGFzIGNoYW5nZVBhc3N3b3JkLCBWIGFzIGNoYW5nZUVtYWlsLCBXIGFzIHNlbmRWZXJpZmljYXRpb25FbWFpbCwgWCBhcyB2ZXJpZnlFbWFpbCwgWSBhcyByZXNldFBhc3N3b3JkLCBaIGFzIGZvcmdldFBhc3N3b3JkLCBfIGFzIHNpZ25JbkVtYWlsLCAkIGFzIHNpZ25PdXQsIGEwIGFzIGNhbGxiYWNrT0F1dGgsIGExIGFzIHNpZ25JblNvY2lhbCB9IGZyb20gJy4uL3NoYXJlZC9iZXR0ZXItYXV0aC56M2RzeEx4RS5tanMnO1xuZXhwb3J0IHsgaSBhcyBjcmVhdGVBdXRoTWlkZGxld2FyZSwgbiBhcyBmcmVzaFNlc3Npb25NaWRkbGV3YXJlLCBrIGFzIGdldFNlc3Npb25Gcm9tQ3R4LCBxIGFzIG9wdGlvbnNNaWRkbGV3YXJlLCBvIGFzIG9yaWdpbkNoZWNrLCBhMiBhcyByZXF1ZXN0T25seVNlc3Npb25NaWRkbGV3YXJlLCB1IGFzIHNlbmRWZXJpZmljYXRpb25FbWFpbEZuLCBsIGFzIHNlc3Npb25NaWRkbGV3YXJlIH0gZnJvbSAnLi4vc2hhcmVkL2JldHRlci1hdXRoLnozZHN4THhFLm1qcyc7XG5pbXBvcnQgKiBhcyB6IGZyb20gJ3pvZC92NCc7XG5pbXBvcnQgeyBzZXRTZXNzaW9uQ29va2llIH0gZnJvbSAnLi4vY29va2llcy9pbmRleC5tanMnO1xuaW1wb3J0IHsgZiBhcyBwYXJzZVVzZXJJbnB1dCB9IGZyb20gJy4uL3NoYXJlZC9iZXR0ZXItYXV0aC5uMktGR3dqWS5tanMnO1xuaW1wb3J0IHsgYiBhcyBpc0RldmVsb3BtZW50IH0gZnJvbSAnLi4vc2hhcmVkL2JldHRlci1hdXRoLjh6b3h6Zy1GLm1qcyc7XG5pbXBvcnQgeyBhIGFzIGxvZ2dlciB9IGZyb20gJy4uL3NoYXJlZC9iZXR0ZXItYXV0aC5EQkdmSURuaC5tanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRJcCB9IGZyb20gJy4uL3NoYXJlZC9iZXR0ZXItYXV0aC5EY2ZOUFM4cS5tanMnO1xuaW1wb3J0IGRlZnUgZnJvbSAnZGVmdSc7XG5pbXBvcnQgJy4uL3NoYXJlZC9iZXR0ZXItYXV0aC5DVzZEOWVTeC5tanMnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMvaGFzaCc7XG5pbXBvcnQgJ0BiZXR0ZXItYXV0aC91dGlscy9iYXNlNjQnO1xuaW1wb3J0ICcuLi9jcnlwdG8vaW5kZXgubWpzJztcbmltcG9ydCAnQG5vYmxlL2NpcGhlcnMvY2hhY2hhJztcbmltcG9ydCAnQG5vYmxlL2NpcGhlcnMvdXRpbHMnO1xuaW1wb3J0ICdAbm9ibGUvY2lwaGVycy93ZWJjcnlwdG8nO1xuaW1wb3J0ICdqb3NlJztcbmltcG9ydCAnQG5vYmxlL2hhc2hlcy9zY3J5cHQnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMvaGV4JztcbmltcG9ydCAnQG5vYmxlL2hhc2hlcy91dGlscyc7XG5pbXBvcnQgJy4uL3NoYXJlZC9iZXR0ZXItYXV0aC5CNFFveGRnYy5tanMnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMvcmFuZG9tJztcbmltcG9ydCAnQGJldHRlci1mZXRjaC9mZXRjaCc7XG5pbXBvcnQgJy4uL3NoYXJlZC9iZXR0ZXItYXV0aC5WVFhOTEZNVC5tanMnO1xuaW1wb3J0ICcuLi9zaGFyZWQvYmV0dGVyLWF1dGguRGR6U0pmLW4ubWpzJztcbmltcG9ydCAnLi4vc2hhcmVkL2JldHRlci1hdXRoLnRCNWVVNkVZLm1qcyc7XG5pbXBvcnQgJ0BiZXR0ZXItYXV0aC91dGlscy9obWFjJztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzL2JpbmFyeSc7XG5pbXBvcnQgJ2pvc2UvZXJyb3JzJztcblxuY29uc3Qgc2lnblVwRW1haWwgPSAoKSA9PiBjcmVhdGVBdXRoRW5kcG9pbnQoXG4gIFwiL3NpZ24tdXAvZW1haWxcIixcbiAge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgYm9keTogei5yZWNvcmQoei5zdHJpbmcoKSwgei5hbnkoKSksXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgICRJbmZlcjoge1xuICAgICAgICBib2R5OiB7fVxuICAgICAgfSxcbiAgICAgIG9wZW5hcGk6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiU2lnbiB1cCBhIHVzZXIgdXNpbmcgZW1haWwgYW5kIHBhc3N3b3JkXCIsXG4gICAgICAgIHJlcXVlc3RCb2R5OiB7XG4gICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgXCJhcHBsaWNhdGlvbi9qc29uXCI6IHtcbiAgICAgICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICBuYW1lOiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBuYW1lIG9mIHRoZSB1c2VyXCJcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICBlbWFpbDoge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgZW1haWwgb2YgdGhlIHVzZXJcIlxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIHBhc3N3b3JkOiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBwYXNzd29yZCBvZiB0aGUgdXNlclwiXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgaW1hZ2U6IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIHByb2ZpbGUgaW1hZ2UgVVJMIG9mIHRoZSB1c2VyXCJcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICBjYWxsYmFja1VSTDoge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgVVJMIHRvIHVzZSBmb3IgZW1haWwgdmVyaWZpY2F0aW9uIGNhbGxiYWNrXCJcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICByZW1lbWJlck1lOiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYm9vbGVhblwiLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJJZiB0aGlzIGlzIGZhbHNlLCB0aGUgc2Vzc2lvbiB3aWxsIG5vdCBiZSByZW1lbWJlcmVkLiBEZWZhdWx0IGlzIGB0cnVlYC5cIlxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFtcIm5hbWVcIiwgXCJlbWFpbFwiLCBcInBhc3N3b3JkXCJdXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHJlc3BvbnNlczoge1xuICAgICAgICAgIFwiMjAwXCI6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlN1Y2Nlc3NmdWxseSBjcmVhdGVkIHVzZXJcIixcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbi9qc29uXCI6IHtcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgIHRva2VuOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICBudWxsYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJBdXRoZW50aWNhdGlvbiB0b2tlbiBmb3IgdGhlIHNlc3Npb25cIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgdW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIHVzZXJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogXCJlbWFpbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgZW1haWwgYWRkcmVzcyBvZiB0aGUgdXNlclwiXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgbmFtZSBvZiB0aGUgdXNlclwiXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBcInVyaVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIHByb2ZpbGUgaW1hZ2UgVVJMIG9mIHRoZSB1c2VyXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBlbWFpbFZlcmlmaWVkOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYm9vbGVhblwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJXaGV0aGVyIHRoZSBlbWFpbCBoYXMgYmVlbiB2ZXJpZmllZFwiXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogXCJkYXRlLXRpbWVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiV2hlbiB0aGUgdXNlciB3YXMgY3JlYXRlZFwiXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlZEF0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogXCJkYXRlLXRpbWVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiV2hlbiB0aGUgdXNlciB3YXMgbGFzdCB1cGRhdGVkXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICBcImlkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImVtYWlsXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZW1haWxWZXJpZmllZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjcmVhdGVkQXRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidXBkYXRlZEF0XCJcbiAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICByZXF1aXJlZDogW1widXNlclwiXVxuICAgICAgICAgICAgICAgICAgLy8gdG9rZW4gaXMgb3B0aW9uYWxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGFzeW5jIChjdHgpID0+IHtcbiAgICBpZiAoIWN0eC5jb250ZXh0Lm9wdGlvbnMuZW1haWxBbmRQYXNzd29yZD8uZW5hYmxlZCB8fCBjdHguY29udGV4dC5vcHRpb25zLmVtYWlsQW5kUGFzc3dvcmQ/LmRpc2FibGVTaWduVXApIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogXCJFbWFpbCBhbmQgcGFzc3dvcmQgc2lnbiB1cCBpcyBub3QgZW5hYmxlZFwiXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgYm9keSA9IGN0eC5ib2R5O1xuICAgIGNvbnN0IHtcbiAgICAgIG5hbWUsXG4gICAgICBlbWFpbCxcbiAgICAgIHBhc3N3b3JkLFxuICAgICAgaW1hZ2UsXG4gICAgICBjYWxsYmFja1VSTCxcbiAgICAgIHJlbWVtYmVyTWUsXG4gICAgICAuLi5hZGRpdGlvbmFsRmllbGRzXG4gICAgfSA9IGJvZHk7XG4gICAgY29uc3QgaXNWYWxpZEVtYWlsID0gei5lbWFpbCgpLnNhZmVQYXJzZShlbWFpbCk7XG4gICAgaWYgKCFpc1ZhbGlkRW1haWwuc3VjY2Vzcykge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLklOVkFMSURfRU1BSUxcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBtaW5QYXNzd29yZExlbmd0aCA9IGN0eC5jb250ZXh0LnBhc3N3b3JkLmNvbmZpZy5taW5QYXNzd29yZExlbmd0aDtcbiAgICBpZiAocGFzc3dvcmQubGVuZ3RoIDwgbWluUGFzc3dvcmRMZW5ndGgpIHtcbiAgICAgIGN0eC5jb250ZXh0LmxvZ2dlci5lcnJvcihcIlBhc3N3b3JkIGlzIHRvbyBzaG9ydFwiKTtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5QQVNTV09SRF9UT09fU0hPUlRcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBtYXhQYXNzd29yZExlbmd0aCA9IGN0eC5jb250ZXh0LnBhc3N3b3JkLmNvbmZpZy5tYXhQYXNzd29yZExlbmd0aDtcbiAgICBpZiAocGFzc3dvcmQubGVuZ3RoID4gbWF4UGFzc3dvcmRMZW5ndGgpIHtcbiAgICAgIGN0eC5jb250ZXh0LmxvZ2dlci5lcnJvcihcIlBhc3N3b3JkIGlzIHRvbyBsb25nXCIpO1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLlBBU1NXT1JEX1RPT19MT05HXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgZGJVc2VyID0gYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmZpbmRVc2VyQnlFbWFpbChlbWFpbCk7XG4gICAgaWYgKGRiVXNlcj8udXNlcikge1xuICAgICAgY3R4LmNvbnRleHQubG9nZ2VyLmluZm8oYFNpZ24tdXAgYXR0ZW1wdCBmb3IgZXhpc3RpbmcgZW1haWw6ICR7ZW1haWx9YCk7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJVTlBST0NFU1NBQkxFX0VOVElUWVwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuVVNFUl9BTFJFQURZX0VYSVNUU1xuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IGFkZGl0aW9uYWxEYXRhID0gcGFyc2VVc2VySW5wdXQoXG4gICAgICBjdHguY29udGV4dC5vcHRpb25zLFxuICAgICAgYWRkaXRpb25hbEZpZWxkc1xuICAgICk7XG4gICAgY29uc3QgaGFzaCA9IGF3YWl0IGN0eC5jb250ZXh0LnBhc3N3b3JkLmhhc2gocGFzc3dvcmQpO1xuICAgIGxldCBjcmVhdGVkVXNlcjtcbiAgICB0cnkge1xuICAgICAgY3JlYXRlZFVzZXIgPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuY3JlYXRlVXNlcihcbiAgICAgICAge1xuICAgICAgICAgIGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgaW1hZ2UsXG4gICAgICAgICAgLi4uYWRkaXRpb25hbERhdGEsXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogZmFsc2VcbiAgICAgICAgfSxcbiAgICAgICAgY3R4XG4gICAgICApO1xuICAgICAgaWYgKCFjcmVhdGVkVXNlcikge1xuICAgICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5GQUlMRURfVE9fQ1JFQVRFX1VTRVJcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgaWYgKGlzRGV2ZWxvcG1lbnQpIHtcbiAgICAgICAgY3R4LmNvbnRleHQubG9nZ2VyLmVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSB1c2VyXCIsIGUpO1xuICAgICAgfVxuICAgICAgaWYgKGUgaW5zdGFuY2VvZiBBUElFcnJvcikge1xuICAgICAgICB0aHJvdyBlO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiVU5QUk9DRVNTQUJMRV9FTlRJVFlcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLkZBSUxFRF9UT19DUkVBVEVfVVNFUixcbiAgICAgICAgZGV0YWlsczogZVxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmICghY3JlYXRlZFVzZXIpIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIlVOUFJPQ0VTU0FCTEVfRU5USVRZXCIsIHtcbiAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5GQUlMRURfVE9fQ1JFQVRFX1VTRVJcbiAgICAgIH0pO1xuICAgIH1cbiAgICBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIubGlua0FjY291bnQoXG4gICAgICB7XG4gICAgICAgIHVzZXJJZDogY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgIHByb3ZpZGVySWQ6IFwiY3JlZGVudGlhbFwiLFxuICAgICAgICBhY2NvdW50SWQ6IGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgICBwYXNzd29yZDogaGFzaFxuICAgICAgfSxcbiAgICAgIGN0eFxuICAgICk7XG4gICAgaWYgKGN0eC5jb250ZXh0Lm9wdGlvbnMuZW1haWxWZXJpZmljYXRpb24/LnNlbmRPblNpZ25VcCB8fCBjdHguY29udGV4dC5vcHRpb25zLmVtYWlsQW5kUGFzc3dvcmQucmVxdWlyZUVtYWlsVmVyaWZpY2F0aW9uKSB7XG4gICAgICBjb25zdCB0b2tlbiA9IGF3YWl0IGNyZWF0ZUVtYWlsVmVyaWZpY2F0aW9uVG9rZW4oXG4gICAgICAgIGN0eC5jb250ZXh0LnNlY3JldCxcbiAgICAgICAgY3JlYXRlZFVzZXIuZW1haWwsXG4gICAgICAgIHZvaWQgMCxcbiAgICAgICAgY3R4LmNvbnRleHQub3B0aW9ucy5lbWFpbFZlcmlmaWNhdGlvbj8uZXhwaXJlc0luXG4gICAgICApO1xuICAgICAgY29uc3QgdXJsID0gYCR7Y3R4LmNvbnRleHQuYmFzZVVSTH0vdmVyaWZ5LWVtYWlsP3Rva2VuPSR7dG9rZW59JmNhbGxiYWNrVVJMPSR7Ym9keS5jYWxsYmFja1VSTCB8fCBcIi9cIn1gO1xuICAgICAgYXdhaXQgY3R4LmNvbnRleHQub3B0aW9ucy5lbWFpbFZlcmlmaWNhdGlvbj8uc2VuZFZlcmlmaWNhdGlvbkVtYWlsPy4oXG4gICAgICAgIHtcbiAgICAgICAgICB1c2VyOiBjcmVhdGVkVXNlcixcbiAgICAgICAgICB1cmwsXG4gICAgICAgICAgdG9rZW5cbiAgICAgICAgfSxcbiAgICAgICAgY3R4LnJlcXVlc3RcbiAgICAgICk7XG4gICAgfVxuICAgIGlmIChjdHguY29udGV4dC5vcHRpb25zLmVtYWlsQW5kUGFzc3dvcmQuYXV0b1NpZ25JbiA9PT0gZmFsc2UgfHwgY3R4LmNvbnRleHQub3B0aW9ucy5lbWFpbEFuZFBhc3N3b3JkLnJlcXVpcmVFbWFpbFZlcmlmaWNhdGlvbikge1xuICAgICAgcmV0dXJuIGN0eC5qc29uKHtcbiAgICAgICAgdG9rZW46IG51bGwsXG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgICAgZW1haWw6IGNyZWF0ZWRVc2VyLmVtYWlsLFxuICAgICAgICAgIG5hbWU6IGNyZWF0ZWRVc2VyLm5hbWUsXG4gICAgICAgICAgaW1hZ2U6IGNyZWF0ZWRVc2VyLmltYWdlLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IGNyZWF0ZWRVc2VyLmVtYWlsVmVyaWZpZWQsXG4gICAgICAgICAgY3JlYXRlZEF0OiBjcmVhdGVkVXNlci5jcmVhdGVkQXQsXG4gICAgICAgICAgdXBkYXRlZEF0OiBjcmVhdGVkVXNlci51cGRhdGVkQXRcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuY3JlYXRlU2Vzc2lvbihcbiAgICAgIGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgY3R4LFxuICAgICAgcmVtZW1iZXJNZSA9PT0gZmFsc2VcbiAgICApO1xuICAgIGlmICghc2Vzc2lvbikge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLkZBSUxFRF9UT19DUkVBVEVfU0VTU0lPTlxuICAgICAgfSk7XG4gICAgfVxuICAgIGF3YWl0IHNldFNlc3Npb25Db29raWUoXG4gICAgICBjdHgsXG4gICAgICB7XG4gICAgICAgIHNlc3Npb24sXG4gICAgICAgIHVzZXI6IGNyZWF0ZWRVc2VyXG4gICAgICB9LFxuICAgICAgcmVtZW1iZXJNZSA9PT0gZmFsc2VcbiAgICApO1xuICAgIHJldHVybiBjdHguanNvbih7XG4gICAgICB0b2tlbjogc2Vzc2lvbi50b2tlbixcbiAgICAgIHVzZXI6IHtcbiAgICAgICAgaWQ6IGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgICBlbWFpbDogY3JlYXRlZFVzZXIuZW1haWwsXG4gICAgICAgIG5hbWU6IGNyZWF0ZWRVc2VyLm5hbWUsXG4gICAgICAgIGltYWdlOiBjcmVhdGVkVXNlci5pbWFnZSxcbiAgICAgICAgZW1haWxWZXJpZmllZDogY3JlYXRlZFVzZXIuZW1haWxWZXJpZmllZCxcbiAgICAgICAgY3JlYXRlZEF0OiBjcmVhdGVkVXNlci5jcmVhdGVkQXQsXG4gICAgICAgIHVwZGF0ZWRBdDogY3JlYXRlZFVzZXIudXBkYXRlZEF0XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbik7XG5cbmZ1bmN0aW9uIHNob3VsZFJhdGVMaW1pdChtYXgsIHdpbmRvdywgcmF0ZUxpbWl0RGF0YSkge1xuICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICBjb25zdCB3aW5kb3dJbk1zID0gd2luZG93ICogMWUzO1xuICBjb25zdCB0aW1lU2luY2VMYXN0UmVxdWVzdCA9IG5vdyAtIHJhdGVMaW1pdERhdGEubGFzdFJlcXVlc3Q7XG4gIHJldHVybiB0aW1lU2luY2VMYXN0UmVxdWVzdCA8IHdpbmRvd0luTXMgJiYgcmF0ZUxpbWl0RGF0YS5jb3VudCA+PSBtYXg7XG59XG5mdW5jdGlvbiByYXRlTGltaXRSZXNwb25zZShyZXRyeUFmdGVyKSB7XG4gIHJldHVybiBuZXcgUmVzcG9uc2UoXG4gICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgbWVzc2FnZTogXCJUb28gbWFueSByZXF1ZXN0cy4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci5cIlxuICAgIH0pLFxuICAgIHtcbiAgICAgIHN0YXR1czogNDI5LFxuICAgICAgc3RhdHVzVGV4dDogXCJUb28gTWFueSBSZXF1ZXN0c1wiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcIlgtUmV0cnktQWZ0ZXJcIjogcmV0cnlBZnRlci50b1N0cmluZygpXG4gICAgICB9XG4gICAgfVxuICApO1xufVxuZnVuY3Rpb24gZ2V0UmV0cnlBZnRlcihsYXN0UmVxdWVzdCwgd2luZG93KSB7XG4gIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gIGNvbnN0IHdpbmRvd0luTXMgPSB3aW5kb3cgKiAxZTM7XG4gIHJldHVybiBNYXRoLmNlaWwoKGxhc3RSZXF1ZXN0ICsgd2luZG93SW5NcyAtIG5vdykgLyAxZTMpO1xufVxuZnVuY3Rpb24gY3JlYXRlREJTdG9yYWdlKGN0eCkge1xuICBjb25zdCBtb2RlbCA9IFwicmF0ZUxpbWl0XCI7XG4gIGNvbnN0IGRiID0gY3R4LmFkYXB0ZXI7XG4gIHJldHVybiB7XG4gICAgZ2V0OiBhc3luYyAoa2V5KSA9PiB7XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBkYi5maW5kTWFueSh7XG4gICAgICAgIG1vZGVsLFxuICAgICAgICB3aGVyZTogW3sgZmllbGQ6IFwia2V5XCIsIHZhbHVlOiBrZXkgfV1cbiAgICAgIH0pO1xuICAgICAgY29uc3QgZGF0YSA9IHJlc1swXTtcbiAgICAgIGlmICh0eXBlb2YgZGF0YT8ubGFzdFJlcXVlc3QgPT09IFwiYmlnaW50XCIpIHtcbiAgICAgICAgZGF0YS5sYXN0UmVxdWVzdCA9IE51bWJlcihkYXRhLmxhc3RSZXF1ZXN0KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBkYXRhO1xuICAgIH0sXG4gICAgc2V0OiBhc3luYyAoa2V5LCB2YWx1ZSwgX3VwZGF0ZSkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKF91cGRhdGUpIHtcbiAgICAgICAgICBhd2FpdCBkYi51cGRhdGVNYW55KHtcbiAgICAgICAgICAgIG1vZGVsLFxuICAgICAgICAgICAgd2hlcmU6IFt7IGZpZWxkOiBcImtleVwiLCB2YWx1ZToga2V5IH1dLFxuICAgICAgICAgICAgdXBkYXRlOiB7XG4gICAgICAgICAgICAgIGNvdW50OiB2YWx1ZS5jb3VudCxcbiAgICAgICAgICAgICAgbGFzdFJlcXVlc3Q6IHZhbHVlLmxhc3RSZXF1ZXN0XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYXdhaXQgZGIuY3JlYXRlKHtcbiAgICAgICAgICAgIG1vZGVsLFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICBrZXksXG4gICAgICAgICAgICAgIGNvdW50OiB2YWx1ZS5jb3VudCxcbiAgICAgICAgICAgICAgbGFzdFJlcXVlc3Q6IHZhbHVlLmxhc3RSZXF1ZXN0XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY3R4LmxvZ2dlci5lcnJvcihcIkVycm9yIHNldHRpbmcgcmF0ZSBsaW1pdFwiLCBlKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG59XG5jb25zdCBtZW1vcnkgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuZnVuY3Rpb24gZ2V0UmF0ZUxpbWl0U3RvcmFnZShjdHgpIHtcbiAgaWYgKGN0eC5vcHRpb25zLnJhdGVMaW1pdD8uY3VzdG9tU3RvcmFnZSkge1xuICAgIHJldHVybiBjdHgub3B0aW9ucy5yYXRlTGltaXQuY3VzdG9tU3RvcmFnZTtcbiAgfVxuICBpZiAoY3R4LnJhdGVMaW1pdC5zdG9yYWdlID09PSBcInNlY29uZGFyeS1zdG9yYWdlXCIpIHtcbiAgICByZXR1cm4ge1xuICAgICAgZ2V0OiBhc3luYyAoa2V5KSA9PiB7XG4gICAgICAgIGNvbnN0IHN0cmluZ2lmaWVkID0gYXdhaXQgY3R4Lm9wdGlvbnMuc2Vjb25kYXJ5U3RvcmFnZT8uZ2V0KGtleSk7XG4gICAgICAgIHJldHVybiBzdHJpbmdpZmllZCA/IEpTT04ucGFyc2Uoc3RyaW5naWZpZWQpIDogdm9pZCAwO1xuICAgICAgfSxcbiAgICAgIHNldDogYXN5bmMgKGtleSwgdmFsdWUpID0+IHtcbiAgICAgICAgYXdhaXQgY3R4Lm9wdGlvbnMuc2Vjb25kYXJ5U3RvcmFnZT8uc2V0Py4oa2V5LCBKU09OLnN0cmluZ2lmeSh2YWx1ZSkpO1xuICAgICAgfVxuICAgIH07XG4gIH1cbiAgY29uc3Qgc3RvcmFnZSA9IGN0eC5yYXRlTGltaXQuc3RvcmFnZTtcbiAgaWYgKHN0b3JhZ2UgPT09IFwibWVtb3J5XCIpIHtcbiAgICByZXR1cm4ge1xuICAgICAgYXN5bmMgZ2V0KGtleSkge1xuICAgICAgICByZXR1cm4gbWVtb3J5LmdldChrZXkpO1xuICAgICAgfSxcbiAgICAgIGFzeW5jIHNldChrZXksIHZhbHVlLCBfdXBkYXRlKSB7XG4gICAgICAgIG1lbW9yeS5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuICByZXR1cm4gY3JlYXRlREJTdG9yYWdlKGN0eCk7XG59XG5hc3luYyBmdW5jdGlvbiBvblJlcXVlc3RSYXRlTGltaXQocmVxLCBjdHgpIHtcbiAgaWYgKCFjdHgucmF0ZUxpbWl0LmVuYWJsZWQpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgcGF0aCA9IG5ldyBVUkwocmVxLnVybCkucGF0aG5hbWUucmVwbGFjZShcbiAgICBjdHgub3B0aW9ucy5iYXNlUGF0aCB8fCBcIi9hcGkvYXV0aFwiLFxuICAgIFwiXCJcbiAgKTtcbiAgbGV0IHdpbmRvdyA9IGN0eC5yYXRlTGltaXQud2luZG93O1xuICBsZXQgbWF4ID0gY3R4LnJhdGVMaW1pdC5tYXg7XG4gIGNvbnN0IGlwID0gZ2V0SXAocmVxLCBjdHgub3B0aW9ucyk7XG4gIGlmICghaXApIHtcbiAgICBjb25zb2xlLndhcm4oXCJObyBJUCBhZGRyZXNzIGZvdW5kIGZvciByYXRlIGxpbWl0aW5nXCIpO1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBrZXkgPSBpcCArIHBhdGg7XG4gIGNvbnN0IHNwZWNpYWxSdWxlcyA9IGdldERlZmF1bHRTcGVjaWFsUnVsZXMoKTtcbiAgY29uc3Qgc3BlY2lhbFJ1bGUgPSBzcGVjaWFsUnVsZXMuZmluZCgocnVsZSkgPT4gcnVsZS5wYXRoTWF0Y2hlcihwYXRoKSk7XG4gIGlmIChzcGVjaWFsUnVsZSkge1xuICAgIHdpbmRvdyA9IHNwZWNpYWxSdWxlLndpbmRvdztcbiAgICBtYXggPSBzcGVjaWFsUnVsZS5tYXg7XG4gIH1cbiAgZm9yIChjb25zdCBwbHVnaW4gb2YgY3R4Lm9wdGlvbnMucGx1Z2lucyB8fCBbXSkge1xuICAgIGlmIChwbHVnaW4ucmF0ZUxpbWl0KSB7XG4gICAgICBjb25zdCBtYXRjaGVkUnVsZSA9IHBsdWdpbi5yYXRlTGltaXQuZmluZChcbiAgICAgICAgKHJ1bGUpID0+IHJ1bGUucGF0aE1hdGNoZXIocGF0aClcbiAgICAgICk7XG4gICAgICBpZiAobWF0Y2hlZFJ1bGUpIHtcbiAgICAgICAgd2luZG93ID0gbWF0Y2hlZFJ1bGUud2luZG93O1xuICAgICAgICBtYXggPSBtYXRjaGVkUnVsZS5tYXg7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBpZiAoY3R4LnJhdGVMaW1pdC5jdXN0b21SdWxlcykge1xuICAgIGNvbnN0IF9wYXRoID0gT2JqZWN0LmtleXMoY3R4LnJhdGVMaW1pdC5jdXN0b21SdWxlcykuZmluZCgocCkgPT4ge1xuICAgICAgaWYgKHAuaW5jbHVkZXMoXCIqXCIpKSB7XG4gICAgICAgIGNvbnN0IGlzTWF0Y2ggPSB3aWxkY2FyZE1hdGNoKHApKHBhdGgpO1xuICAgICAgICByZXR1cm4gaXNNYXRjaDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwID09PSBwYXRoO1xuICAgIH0pO1xuICAgIGlmIChfcGF0aCkge1xuICAgICAgY29uc3QgY3VzdG9tUnVsZSA9IGN0eC5yYXRlTGltaXQuY3VzdG9tUnVsZXNbX3BhdGhdO1xuICAgICAgY29uc3QgcmVzb2x2ZWQgPSB0eXBlb2YgY3VzdG9tUnVsZSA9PT0gXCJmdW5jdGlvblwiID8gYXdhaXQgY3VzdG9tUnVsZShyZXEpIDogY3VzdG9tUnVsZTtcbiAgICAgIGlmIChyZXNvbHZlZCkge1xuICAgICAgICB3aW5kb3cgPSByZXNvbHZlZC53aW5kb3c7XG4gICAgICAgIG1heCA9IHJlc29sdmVkLm1heDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgY29uc3Qgc3RvcmFnZSA9IGdldFJhdGVMaW1pdFN0b3JhZ2UoY3R4KTtcbiAgY29uc3QgZGF0YSA9IGF3YWl0IHN0b3JhZ2UuZ2V0KGtleSk7XG4gIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gIGlmICghZGF0YSkge1xuICAgIGF3YWl0IHN0b3JhZ2Uuc2V0KGtleSwge1xuICAgICAga2V5LFxuICAgICAgY291bnQ6IDEsXG4gICAgICBsYXN0UmVxdWVzdDogbm93XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgdGltZVNpbmNlTGFzdFJlcXVlc3QgPSBub3cgLSBkYXRhLmxhc3RSZXF1ZXN0O1xuICAgIGlmIChzaG91bGRSYXRlTGltaXQobWF4LCB3aW5kb3csIGRhdGEpKSB7XG4gICAgICBjb25zdCByZXRyeUFmdGVyID0gZ2V0UmV0cnlBZnRlcihkYXRhLmxhc3RSZXF1ZXN0LCB3aW5kb3cpO1xuICAgICAgcmV0dXJuIHJhdGVMaW1pdFJlc3BvbnNlKHJldHJ5QWZ0ZXIpO1xuICAgIH0gZWxzZSBpZiAodGltZVNpbmNlTGFzdFJlcXVlc3QgPiB3aW5kb3cgKiAxZTMpIHtcbiAgICAgIGF3YWl0IHN0b3JhZ2Uuc2V0KFxuICAgICAgICBrZXksXG4gICAgICAgIHtcbiAgICAgICAgICAuLi5kYXRhLFxuICAgICAgICAgIGNvdW50OiAxLFxuICAgICAgICAgIGxhc3RSZXF1ZXN0OiBub3dcbiAgICAgICAgfSxcbiAgICAgICAgdHJ1ZVxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgc3RvcmFnZS5zZXQoXG4gICAgICAgIGtleSxcbiAgICAgICAge1xuICAgICAgICAgIC4uLmRhdGEsXG4gICAgICAgICAgY291bnQ6IGRhdGEuY291bnQgKyAxLFxuICAgICAgICAgIGxhc3RSZXF1ZXN0OiBub3dcbiAgICAgICAgfSxcbiAgICAgICAgdHJ1ZVxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIGdldERlZmF1bHRTcGVjaWFsUnVsZXMoKSB7XG4gIGNvbnN0IHNwZWNpYWxSdWxlcyA9IFtcbiAgICB7XG4gICAgICBwYXRoTWF0Y2hlcihwYXRoKSB7XG4gICAgICAgIHJldHVybiBwYXRoLnN0YXJ0c1dpdGgoXCIvc2lnbi1pblwiKSB8fCBwYXRoLnN0YXJ0c1dpdGgoXCIvc2lnbi11cFwiKSB8fCBwYXRoLnN0YXJ0c1dpdGgoXCIvY2hhbmdlLXBhc3N3b3JkXCIpIHx8IHBhdGguc3RhcnRzV2l0aChcIi9jaGFuZ2UtZW1haWxcIik7XG4gICAgICB9LFxuICAgICAgd2luZG93OiAxMCxcbiAgICAgIG1heDogM1xuICAgIH1cbiAgXTtcbiAgcmV0dXJuIHNwZWNpYWxSdWxlcztcbn1cblxuZnVuY3Rpb24gdG9BdXRoRW5kcG9pbnRzKGVuZHBvaW50cywgY3R4KSB7XG4gIGNvbnN0IGFwaSA9IHt9O1xuICBmb3IgKGNvbnN0IFtrZXksIGVuZHBvaW50XSBvZiBPYmplY3QuZW50cmllcyhlbmRwb2ludHMpKSB7XG4gICAgYXBpW2tleV0gPSBhc3luYyAoY29udGV4dCkgPT4ge1xuICAgICAgY29uc3QgYXV0aENvbnRleHQgPSBhd2FpdCBjdHg7XG4gICAgICBsZXQgaW50ZXJuYWxDb250ZXh0ID0ge1xuICAgICAgICAuLi5jb250ZXh0LFxuICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgLi4uYXV0aENvbnRleHQsXG4gICAgICAgICAgcmV0dXJuZWQ6IHZvaWQgMCxcbiAgICAgICAgICByZXNwb25zZUhlYWRlcnM6IHZvaWQgMCxcbiAgICAgICAgICBzZXNzaW9uOiBudWxsXG4gICAgICAgIH0sXG4gICAgICAgIHBhdGg6IGVuZHBvaW50LnBhdGgsXG4gICAgICAgIGhlYWRlcnM6IGNvbnRleHQ/LmhlYWRlcnMgPyBuZXcgSGVhZGVycyhjb250ZXh0Py5oZWFkZXJzKSA6IHZvaWQgMFxuICAgICAgfTtcbiAgICAgIGNvbnN0IHsgYmVmb3JlSG9va3MsIGFmdGVySG9va3MgfSA9IGdldEhvb2tzKGF1dGhDb250ZXh0KTtcbiAgICAgIGNvbnN0IGJlZm9yZSA9IGF3YWl0IHJ1bkJlZm9yZUhvb2tzKGludGVybmFsQ29udGV4dCwgYmVmb3JlSG9va3MpO1xuICAgICAgaWYgKFwiY29udGV4dFwiIGluIGJlZm9yZSAmJiBiZWZvcmUuY29udGV4dCAmJiB0eXBlb2YgYmVmb3JlLmNvbnRleHQgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgY29uc3QgeyBoZWFkZXJzLCAuLi5yZXN0IH0gPSBiZWZvcmUuY29udGV4dDtcbiAgICAgICAgaWYgKGhlYWRlcnMpIHtcbiAgICAgICAgICBoZWFkZXJzLmZvckVhY2goKHZhbHVlLCBrZXkyKSA9PiB7XG4gICAgICAgICAgICBpbnRlcm5hbENvbnRleHQuaGVhZGVycy5zZXQoa2V5MiwgdmFsdWUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGludGVybmFsQ29udGV4dCA9IGRlZnUocmVzdCwgaW50ZXJuYWxDb250ZXh0KTtcbiAgICAgIH0gZWxzZSBpZiAoYmVmb3JlKSB7XG4gICAgICAgIHJldHVybiBiZWZvcmU7XG4gICAgICB9XG4gICAgICBpbnRlcm5hbENvbnRleHQuYXNSZXNwb25zZSA9IGZhbHNlO1xuICAgICAgaW50ZXJuYWxDb250ZXh0LnJldHVybkhlYWRlcnMgPSB0cnVlO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZW5kcG9pbnQoaW50ZXJuYWxDb250ZXh0KS5jYXRjaCgoZSkgPT4ge1xuICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEFQSUVycm9yKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3BvbnNlOiBlLFxuICAgICAgICAgICAgaGVhZGVyczogZS5oZWFkZXJzID8gbmV3IEhlYWRlcnMoZS5oZWFkZXJzKSA6IG51bGxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHRocm93IGU7XG4gICAgICB9KTtcbiAgICAgIGludGVybmFsQ29udGV4dC5jb250ZXh0LnJldHVybmVkID0gcmVzdWx0LnJlc3BvbnNlO1xuICAgICAgaW50ZXJuYWxDb250ZXh0LmNvbnRleHQucmVzcG9uc2VIZWFkZXJzID0gcmVzdWx0LmhlYWRlcnM7XG4gICAgICBjb25zdCBhZnRlciA9IGF3YWl0IHJ1bkFmdGVySG9va3MoaW50ZXJuYWxDb250ZXh0LCBhZnRlckhvb2tzKTtcbiAgICAgIGlmIChhZnRlci5yZXNwb25zZSkge1xuICAgICAgICByZXN1bHQucmVzcG9uc2UgPSBhZnRlci5yZXNwb25zZTtcbiAgICAgIH1cbiAgICAgIGlmIChyZXN1bHQucmVzcG9uc2UgaW5zdGFuY2VvZiBBUElFcnJvciAmJiAhY29udGV4dD8uYXNSZXNwb25zZSkge1xuICAgICAgICB0aHJvdyByZXN1bHQucmVzcG9uc2U7XG4gICAgICB9XG4gICAgICBjb25zdCByZXNwb25zZSA9IGNvbnRleHQ/LmFzUmVzcG9uc2UgPyB0b1Jlc3BvbnNlKHJlc3VsdC5yZXNwb25zZSwge1xuICAgICAgICBoZWFkZXJzOiByZXN1bHQuaGVhZGVyc1xuICAgICAgfSkgOiBjb250ZXh0Py5yZXR1cm5IZWFkZXJzID8ge1xuICAgICAgICBoZWFkZXJzOiByZXN1bHQuaGVhZGVycyxcbiAgICAgICAgcmVzcG9uc2U6IHJlc3VsdC5yZXNwb25zZVxuICAgICAgfSA6IHJlc3VsdC5yZXNwb25zZTtcbiAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9O1xuICAgIGFwaVtrZXldLnBhdGggPSBlbmRwb2ludC5wYXRoO1xuICAgIGFwaVtrZXldLm9wdGlvbnMgPSBlbmRwb2ludC5vcHRpb25zO1xuICB9XG4gIHJldHVybiBhcGk7XG59XG5hc3luYyBmdW5jdGlvbiBydW5CZWZvcmVIb29rcyhjb250ZXh0LCBob29rcykge1xuICBsZXQgbW9kaWZpZWRDb250ZXh0ID0ge307XG4gIGZvciAoY29uc3QgaG9vayBvZiBob29rcykge1xuICAgIGlmIChob29rLm1hdGNoZXIoY29udGV4dCkpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGhvb2suaGFuZGxlcih7XG4gICAgICAgIC4uLmNvbnRleHQsXG4gICAgICAgIHJldHVybkhlYWRlcnM6IGZhbHNlXG4gICAgICB9KTtcbiAgICAgIGlmIChyZXN1bHQgJiYgdHlwZW9mIHJlc3VsdCA9PT0gXCJvYmplY3RcIikge1xuICAgICAgICBpZiAoXCJjb250ZXh0XCIgaW4gcmVzdWx0ICYmIHR5cGVvZiByZXN1bHQuY29udGV4dCA9PT0gXCJvYmplY3RcIikge1xuICAgICAgICAgIGNvbnN0IHsgaGVhZGVycywgLi4ucmVzdCB9ID0gcmVzdWx0LmNvbnRleHQ7XG4gICAgICAgICAgaWYgKGhlYWRlcnMgaW5zdGFuY2VvZiBIZWFkZXJzKSB7XG4gICAgICAgICAgICBpZiAobW9kaWZpZWRDb250ZXh0LmhlYWRlcnMpIHtcbiAgICAgICAgICAgICAgaGVhZGVycy5mb3JFYWNoKCh2YWx1ZSwga2V5KSA9PiB7XG4gICAgICAgICAgICAgICAgbW9kaWZpZWRDb250ZXh0LmhlYWRlcnM/LnNldChrZXksIHZhbHVlKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBtb2RpZmllZENvbnRleHQuaGVhZGVycyA9IGhlYWRlcnM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIG1vZGlmaWVkQ29udGV4dCA9IGRlZnUocmVzdCwgbW9kaWZpZWRDb250ZXh0KTtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4geyBjb250ZXh0OiBtb2RpZmllZENvbnRleHQgfTtcbn1cbmFzeW5jIGZ1bmN0aW9uIHJ1bkFmdGVySG9va3MoY29udGV4dCwgaG9va3MpIHtcbiAgZm9yIChjb25zdCBob29rIG9mIGhvb2tzKSB7XG4gICAgaWYgKGhvb2subWF0Y2hlcihjb250ZXh0KSkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaG9vay5oYW5kbGVyKGNvbnRleHQpLmNhdGNoKChlKSA9PiB7XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgQVBJRXJyb3IpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVzcG9uc2U6IGUsXG4gICAgICAgICAgICBoZWFkZXJzOiBlLmhlYWRlcnMgPyBuZXcgSGVhZGVycyhlLmhlYWRlcnMpIDogbnVsbFxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgZTtcbiAgICAgIH0pO1xuICAgICAgaWYgKHJlc3VsdC5oZWFkZXJzKSB7XG4gICAgICAgIHJlc3VsdC5oZWFkZXJzLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHtcbiAgICAgICAgICBpZiAoIWNvbnRleHQuY29udGV4dC5yZXNwb25zZUhlYWRlcnMpIHtcbiAgICAgICAgICAgIGNvbnRleHQuY29udGV4dC5yZXNwb25zZUhlYWRlcnMgPSBuZXcgSGVhZGVycyh7XG4gICAgICAgICAgICAgIFtrZXldOiB2YWx1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChrZXkudG9Mb3dlckNhc2UoKSA9PT0gXCJzZXQtY29va2llXCIpIHtcbiAgICAgICAgICAgICAgY29udGV4dC5jb250ZXh0LnJlc3BvbnNlSGVhZGVycy5hcHBlbmQoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjb250ZXh0LmNvbnRleHQucmVzcG9uc2VIZWFkZXJzLnNldChrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaWYgKHJlc3VsdC5yZXNwb25zZSkge1xuICAgICAgICBjb250ZXh0LmNvbnRleHQucmV0dXJuZWQgPSByZXN1bHQucmVzcG9uc2U7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiB7XG4gICAgcmVzcG9uc2U6IGNvbnRleHQuY29udGV4dC5yZXR1cm5lZCxcbiAgICBoZWFkZXJzOiBjb250ZXh0LmNvbnRleHQucmVzcG9uc2VIZWFkZXJzXG4gIH07XG59XG5mdW5jdGlvbiBnZXRIb29rcyhhdXRoQ29udGV4dCkge1xuICBjb25zdCBwbHVnaW5zID0gYXV0aENvbnRleHQub3B0aW9ucy5wbHVnaW5zIHx8IFtdO1xuICBjb25zdCBiZWZvcmVIb29rcyA9IFtdO1xuICBjb25zdCBhZnRlckhvb2tzID0gW107XG4gIGlmIChhdXRoQ29udGV4dC5vcHRpb25zLmhvb2tzPy5iZWZvcmUpIHtcbiAgICBiZWZvcmVIb29rcy5wdXNoKHtcbiAgICAgIG1hdGNoZXI6ICgpID0+IHRydWUsXG4gICAgICBoYW5kbGVyOiBhdXRoQ29udGV4dC5vcHRpb25zLmhvb2tzLmJlZm9yZVxuICAgIH0pO1xuICB9XG4gIGlmIChhdXRoQ29udGV4dC5vcHRpb25zLmhvb2tzPy5hZnRlcikge1xuICAgIGFmdGVySG9va3MucHVzaCh7XG4gICAgICBtYXRjaGVyOiAoKSA9PiB0cnVlLFxuICAgICAgaGFuZGxlcjogYXV0aENvbnRleHQub3B0aW9ucy5ob29rcy5hZnRlclxuICAgIH0pO1xuICB9XG4gIGNvbnN0IHBsdWdpbkJlZm9yZUhvb2tzID0gcGx1Z2lucy5tYXAoKHBsdWdpbikgPT4ge1xuICAgIGlmIChwbHVnaW4uaG9va3M/LmJlZm9yZSkge1xuICAgICAgcmV0dXJuIHBsdWdpbi5ob29rcy5iZWZvcmU7XG4gICAgfVxuICB9KS5maWx0ZXIoKHBsdWdpbikgPT4gcGx1Z2luICE9PSB2b2lkIDApLmZsYXQoKTtcbiAgY29uc3QgcGx1Z2luQWZ0ZXJIb29rcyA9IHBsdWdpbnMubWFwKChwbHVnaW4pID0+IHtcbiAgICBpZiAocGx1Z2luLmhvb2tzPy5hZnRlcikge1xuICAgICAgcmV0dXJuIHBsdWdpbi5ob29rcy5hZnRlcjtcbiAgICB9XG4gIH0pLmZpbHRlcigocGx1Z2luKSA9PiBwbHVnaW4gIT09IHZvaWQgMCkuZmxhdCgpO1xuICBwbHVnaW5CZWZvcmVIb29rcy5sZW5ndGggJiYgYmVmb3JlSG9va3MucHVzaCguLi5wbHVnaW5CZWZvcmVIb29rcyk7XG4gIHBsdWdpbkFmdGVySG9va3MubGVuZ3RoICYmIGFmdGVySG9va3MucHVzaCguLi5wbHVnaW5BZnRlckhvb2tzKTtcbiAgcmV0dXJuIHtcbiAgICBiZWZvcmVIb29rcyxcbiAgICBhZnRlckhvb2tzXG4gIH07XG59XG5cbmZ1bmN0aW9uIGdldEVuZHBvaW50cyhjdHgsIG9wdGlvbnMpIHtcbiAgY29uc3QgcGx1Z2luRW5kcG9pbnRzID0gb3B0aW9ucy5wbHVnaW5zPy5yZWR1Y2UoXG4gICAgKGFjYywgcGx1Z2luKSA9PiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5hY2MsXG4gICAgICAgIC4uLnBsdWdpbi5lbmRwb2ludHNcbiAgICAgIH07XG4gICAgfSxcbiAgICB7fVxuICApO1xuICBjb25zdCBtaWRkbGV3YXJlcyA9IG9wdGlvbnMucGx1Z2lucz8ubWFwKFxuICAgIChwbHVnaW4pID0+IHBsdWdpbi5taWRkbGV3YXJlcz8ubWFwKChtKSA9PiB7XG4gICAgICBjb25zdCBtaWRkbGV3YXJlID0gYXN5bmMgKGNvbnRleHQpID0+IHtcbiAgICAgICAgcmV0dXJuIG0ubWlkZGxld2FyZSh7XG4gICAgICAgICAgLi4uY29udGV4dCxcbiAgICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICAuLi5jdHgsXG4gICAgICAgICAgICAuLi5jb250ZXh0LmNvbnRleHRcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIG1pZGRsZXdhcmUub3B0aW9ucyA9IG0ubWlkZGxld2FyZS5vcHRpb25zO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcGF0aDogbS5wYXRoLFxuICAgICAgICBtaWRkbGV3YXJlXG4gICAgICB9O1xuICAgIH0pXG4gICkuZmlsdGVyKChwbHVnaW4pID0+IHBsdWdpbiAhPT0gdm9pZCAwKS5mbGF0KCkgfHwgW107XG4gIGNvbnN0IGJhc2VFbmRwb2ludHMgPSB7XG4gICAgc2lnbkluU29jaWFsLFxuICAgIGNhbGxiYWNrT0F1dGgsXG4gICAgZ2V0U2Vzc2lvbjogZ2V0U2Vzc2lvbigpLFxuICAgIHNpZ25PdXQsXG4gICAgc2lnblVwRW1haWw6IHNpZ25VcEVtYWlsKCksXG4gICAgc2lnbkluRW1haWwsXG4gICAgZm9yZ2V0UGFzc3dvcmQsXG4gICAgcmVzZXRQYXNzd29yZCxcbiAgICB2ZXJpZnlFbWFpbCxcbiAgICBzZW5kVmVyaWZpY2F0aW9uRW1haWwsXG4gICAgY2hhbmdlRW1haWwsXG4gICAgY2hhbmdlUGFzc3dvcmQsXG4gICAgc2V0UGFzc3dvcmQsXG4gICAgdXBkYXRlVXNlcjogdXBkYXRlVXNlcigpLFxuICAgIGRlbGV0ZVVzZXIsXG4gICAgZm9yZ2V0UGFzc3dvcmRDYWxsYmFjayxcbiAgICByZXF1ZXN0UGFzc3dvcmRSZXNldCxcbiAgICByZXF1ZXN0UGFzc3dvcmRSZXNldENhbGxiYWNrLFxuICAgIGxpc3RTZXNzaW9uczogbGlzdFNlc3Npb25zKCksXG4gICAgcmV2b2tlU2Vzc2lvbixcbiAgICByZXZva2VTZXNzaW9ucyxcbiAgICByZXZva2VPdGhlclNlc3Npb25zLFxuICAgIGxpbmtTb2NpYWxBY2NvdW50LFxuICAgIGxpc3RVc2VyQWNjb3VudHMsXG4gICAgZGVsZXRlVXNlckNhbGxiYWNrLFxuICAgIHVubGlua0FjY291bnQsXG4gICAgcmVmcmVzaFRva2VuLFxuICAgIGdldEFjY2Vzc1Rva2VuLFxuICAgIGFjY291bnRJbmZvXG4gIH07XG4gIGNvbnN0IGVuZHBvaW50cyA9IHtcbiAgICAuLi5iYXNlRW5kcG9pbnRzLFxuICAgIC4uLnBsdWdpbkVuZHBvaW50cyxcbiAgICBvayxcbiAgICBlcnJvclxuICB9O1xuICBjb25zdCBhcGkgPSB0b0F1dGhFbmRwb2ludHMoZW5kcG9pbnRzLCBjdHgpO1xuICByZXR1cm4ge1xuICAgIGFwaSxcbiAgICBtaWRkbGV3YXJlc1xuICB9O1xufVxuY29uc3Qgcm91dGVyID0gKGN0eCwgb3B0aW9ucykgPT4ge1xuICBjb25zdCB7IGFwaSwgbWlkZGxld2FyZXMgfSA9IGdldEVuZHBvaW50cyhjdHgsIG9wdGlvbnMpO1xuICBjb25zdCBiYXNlUGF0aCA9IG5ldyBVUkwoY3R4LmJhc2VVUkwpLnBhdGhuYW1lO1xuICByZXR1cm4gY3JlYXRlUm91dGVyKGFwaSwge1xuICAgIHJvdXRlckNvbnRleHQ6IGN0eCxcbiAgICBvcGVuYXBpOiB7XG4gICAgICBkaXNhYmxlZDogdHJ1ZVxuICAgIH0sXG4gICAgYmFzZVBhdGgsXG4gICAgcm91dGVyTWlkZGxld2FyZTogW1xuICAgICAge1xuICAgICAgICBwYXRoOiBcIi8qKlwiLFxuICAgICAgICBtaWRkbGV3YXJlOiBvcmlnaW5DaGVja01pZGRsZXdhcmVcbiAgICAgIH0sXG4gICAgICAuLi5taWRkbGV3YXJlc1xuICAgIF0sXG4gICAgYXN5bmMgb25SZXF1ZXN0KHJlcSkge1xuICAgICAgY29uc3QgZGlzYWJsZWRQYXRocyA9IGN0eC5vcHRpb25zLmRpc2FibGVkUGF0aHMgfHwgW107XG4gICAgICBjb25zdCBwYXRoID0gbmV3IFVSTChyZXEudXJsKS5wYXRobmFtZS5yZXBsYWNlKGJhc2VQYXRoLCBcIlwiKTtcbiAgICAgIGlmIChkaXNhYmxlZFBhdGhzLmluY2x1ZGVzKHBhdGgpKSB7XG4gICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoXCJOb3QgRm91bmRcIiwgeyBzdGF0dXM6IDQwNCB9KTtcbiAgICAgIH1cbiAgICAgIGZvciAoY29uc3QgcGx1Z2luIG9mIGN0eC5vcHRpb25zLnBsdWdpbnMgfHwgW10pIHtcbiAgICAgICAgaWYgKHBsdWdpbi5vblJlcXVlc3QpIHtcbiAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHBsdWdpbi5vblJlcXVlc3QocmVxLCBjdHgpO1xuICAgICAgICAgIGlmIChyZXNwb25zZSAmJiBcInJlc3BvbnNlXCIgaW4gcmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5yZXNwb25zZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBvblJlcXVlc3RSYXRlTGltaXQocmVxLCBjdHgpO1xuICAgIH0sXG4gICAgYXN5bmMgb25SZXNwb25zZShyZXMpIHtcbiAgICAgIGZvciAoY29uc3QgcGx1Z2luIG9mIGN0eC5vcHRpb25zLnBsdWdpbnMgfHwgW10pIHtcbiAgICAgICAgaWYgKHBsdWdpbi5vblJlc3BvbnNlKSB7XG4gICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBwbHVnaW4ub25SZXNwb25zZShyZXMsIGN0eCk7XG4gICAgICAgICAgaWYgKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UucmVzcG9uc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzO1xuICAgIH0sXG4gICAgb25FcnJvcihlKSB7XG4gICAgICBpZiAoZSBpbnN0YW5jZW9mIEFQSUVycm9yICYmIGUuc3RhdHVzID09PSBcIkZPVU5EXCIpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMub25BUElFcnJvcj8udGhyb3cpIHtcbiAgICAgICAgdGhyb3cgZTtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLm9uQVBJRXJyb3I/Lm9uRXJyb3IpIHtcbiAgICAgICAgb3B0aW9ucy5vbkFQSUVycm9yLm9uRXJyb3IoZSwgY3R4KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3Qgb3B0TG9nTGV2ZWwgPSBvcHRpb25zLmxvZ2dlcj8ubGV2ZWw7XG4gICAgICBjb25zdCBsb2cgPSBvcHRMb2dMZXZlbCA9PT0gXCJlcnJvclwiIHx8IG9wdExvZ0xldmVsID09PSBcIndhcm5cIiB8fCBvcHRMb2dMZXZlbCA9PT0gXCJkZWJ1Z1wiID8gbG9nZ2VyIDogdm9pZCAwO1xuICAgICAgaWYgKG9wdGlvbnMubG9nZ2VyPy5kaXNhYmxlZCAhPT0gdHJ1ZSkge1xuICAgICAgICBpZiAoZSAmJiB0eXBlb2YgZSA9PT0gXCJvYmplY3RcIiAmJiBcIm1lc3NhZ2VcIiBpbiBlICYmIHR5cGVvZiBlLm1lc3NhZ2UgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICBpZiAoZS5tZXNzYWdlLmluY2x1ZGVzKFwibm8gY29sdW1uXCIpIHx8IGUubWVzc2FnZS5pbmNsdWRlcyhcImNvbHVtblwiKSB8fCBlLm1lc3NhZ2UuaW5jbHVkZXMoXCJyZWxhdGlvblwiKSB8fCBlLm1lc3NhZ2UuaW5jbHVkZXMoXCJ0YWJsZVwiKSB8fCBlLm1lc3NhZ2UuaW5jbHVkZXMoXCJkb2VzIG5vdCBleGlzdFwiKSkge1xuICAgICAgICAgICAgY3R4LmxvZ2dlcj8uZXJyb3IoZS5tZXNzYWdlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBBUElFcnJvcikge1xuICAgICAgICAgIGlmIChlLnN0YXR1cyA9PT0gXCJJTlRFUk5BTF9TRVJWRVJfRVJST1JcIikge1xuICAgICAgICAgICAgY3R4LmxvZ2dlci5lcnJvcihlLnN0YXR1cywgZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGxvZz8uZXJyb3IoZS5tZXNzYWdlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjdHgubG9nZ2VyPy5lcnJvcihcbiAgICAgICAgICAgIGUgJiYgdHlwZW9mIGUgPT09IFwib2JqZWN0XCIgJiYgXCJuYW1lXCIgaW4gZSA/IGUubmFtZSA6IFwiXCIsXG4gICAgICAgICAgICBlXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSk7XG59O1xuXG5leHBvcnQgeyBhY2NvdW50SW5mbywgY2FsbGJhY2tPQXV0aCwgY2hhbmdlRW1haWwsIGNoYW5nZVBhc3N3b3JkLCBjcmVhdGVBdXRoRW5kcG9pbnQsIGNyZWF0ZUVtYWlsVmVyaWZpY2F0aW9uVG9rZW4sIGRlbGV0ZVVzZXIsIGRlbGV0ZVVzZXJDYWxsYmFjaywgZXJyb3IsIGZvcmdldFBhc3N3b3JkLCBmb3JnZXRQYXNzd29yZENhbGxiYWNrLCBnZXRBY2Nlc3NUb2tlbiwgZ2V0RW5kcG9pbnRzLCBnZXRTZXNzaW9uLCBsaW5rU29jaWFsQWNjb3VudCwgbGlzdFNlc3Npb25zLCBsaXN0VXNlckFjY291bnRzLCBvaywgb3JpZ2luQ2hlY2tNaWRkbGV3YXJlLCByZWZyZXNoVG9rZW4sIHJlcXVlc3RQYXNzd29yZFJlc2V0LCByZXF1ZXN0UGFzc3dvcmRSZXNldENhbGxiYWNrLCByZXNldFBhc3N3b3JkLCByZXZva2VPdGhlclNlc3Npb25zLCByZXZva2VTZXNzaW9uLCByZXZva2VTZXNzaW9ucywgcm91dGVyLCBzZW5kVmVyaWZpY2F0aW9uRW1haWwsIHNldFBhc3N3b3JkLCBzaWduSW5FbWFpbCwgc2lnbkluU29jaWFsLCBzaWduT3V0LCBzaWduVXBFbWFpbCwgdW5saW5rQWNjb3VudCwgdXBkYXRlVXNlciwgdmVyaWZ5RW1haWwgfTtcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/api/index.mjs\n");

/***/ }),

/***/ "(action-browser)/../../node_modules/better-auth/dist/chunks/bun-sqlite-dialect.mjs":
/*!*************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/chunks/bun-sqlite-dialect.mjs ***!
  \*************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BunSqliteAdapter: () => (/* binding */ BunSqliteAdapter),\n/* harmony export */   BunSqliteDialect: () => (/* binding */ BunSqliteDialect),\n/* harmony export */   BunSqliteDriver: () => (/* binding */ BunSqliteDriver),\n/* harmony export */   BunSqliteIntrospector: () => (/* binding */ BunSqliteIntrospector),\n/* harmony export */   BunSqliteQueryCompiler: () => (/* binding */ BunSqliteQueryCompiler)\n/* harmony export */ });\n/* harmony import */ var kysely__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! kysely */ \"(action-browser)/../../node_modules/kysely/dist/esm/query-compiler/compiled-query.js\");\n/* harmony import */ var kysely__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! kysely */ \"(action-browser)/../../node_modules/kysely/dist/esm/migration/migrator.js\");\n/* harmony import */ var kysely__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! kysely */ \"(action-browser)/../../node_modules/kysely/dist/esm/raw-builder/sql.js\");\n/* harmony import */ var kysely__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! kysely */ \"(action-browser)/../../node_modules/kysely/dist/esm/query-compiler/default-query-compiler.js\");\n\n\nclass BunSqliteAdapter {\n  get supportsCreateIfNotExists() {\n    return true;\n  }\n  get supportsTransactionalDdl() {\n    return false;\n  }\n  get supportsReturning() {\n    return true;\n  }\n  async acquireMigrationLock() {\n  }\n  async releaseMigrationLock() {\n  }\n  get supportsOutput() {\n    return true;\n  }\n}\nclass BunSqliteDriver {\n  #config;\n  #connectionMutex = new ConnectionMutex();\n  #db;\n  #connection;\n  constructor(config) {\n    this.#config = { ...config };\n  }\n  async init() {\n    this.#db = this.#config.database;\n    this.#connection = new BunSqliteConnection(this.#db);\n    if (this.#config.onCreateConnection) {\n      await this.#config.onCreateConnection(this.#connection);\n    }\n  }\n  async acquireConnection() {\n    await this.#connectionMutex.lock();\n    return this.#connection;\n  }\n  async beginTransaction(connection) {\n    await connection.executeQuery(kysely__WEBPACK_IMPORTED_MODULE_0__.CompiledQuery.raw(\"begin\"));\n  }\n  async commitTransaction(connection) {\n    await connection.executeQuery(kysely__WEBPACK_IMPORTED_MODULE_0__.CompiledQuery.raw(\"commit\"));\n  }\n  async rollbackTransaction(connection) {\n    await connection.executeQuery(kysely__WEBPACK_IMPORTED_MODULE_0__.CompiledQuery.raw(\"rollback\"));\n  }\n  async releaseConnection() {\n    this.#connectionMutex.unlock();\n  }\n  async destroy() {\n    this.#db?.close();\n  }\n}\nclass BunSqliteConnection {\n  #db;\n  constructor(db) {\n    this.#db = db;\n  }\n  executeQuery(compiledQuery) {\n    const { sql: sql2, parameters } = compiledQuery;\n    const stmt = this.#db.prepare(sql2);\n    return Promise.resolve({\n      rows: stmt.all(parameters)\n    });\n  }\n  async *streamQuery() {\n    throw new Error(\"Streaming query is not supported by SQLite driver.\");\n  }\n}\nclass ConnectionMutex {\n  #promise;\n  #resolve;\n  async lock() {\n    while (this.#promise) {\n      await this.#promise;\n    }\n    this.#promise = new Promise((resolve) => {\n      this.#resolve = resolve;\n    });\n  }\n  unlock() {\n    const resolve = this.#resolve;\n    this.#promise = void 0;\n    this.#resolve = void 0;\n    resolve?.();\n  }\n}\nclass BunSqliteIntrospector {\n  #db;\n  constructor(db) {\n    this.#db = db;\n  }\n  async getSchemas() {\n    return [];\n  }\n  async getTables(options = { withInternalKyselyTables: false }) {\n    let query = this.#db.selectFrom(\"sqlite_schema\").where(\"type\", \"=\", \"table\").where(\"name\", \"not like\", \"sqlite_%\").select(\"name\").$castTo();\n    if (!options.withInternalKyselyTables) {\n      query = query.where(\"name\", \"!=\", kysely__WEBPACK_IMPORTED_MODULE_1__.DEFAULT_MIGRATION_TABLE).where(\"name\", \"!=\", kysely__WEBPACK_IMPORTED_MODULE_1__.DEFAULT_MIGRATION_LOCK_TABLE);\n    }\n    const tables = await query.execute();\n    return Promise.all(tables.map(({ name }) => this.#getTableMetadata(name)));\n  }\n  async getMetadata(options) {\n    return {\n      tables: await this.getTables(options)\n    };\n  }\n  async #getTableMetadata(table) {\n    const db = this.#db;\n    const createSql = await db.selectFrom(\"sqlite_master\").where(\"name\", \"=\", table).select(\"sql\").$castTo().execute();\n    const autoIncrementCol = createSql[0]?.sql?.split(/[\\(\\),]/)?.find((it) => it.toLowerCase().includes(\"autoincrement\"))?.split(/\\s+/)?.[0]?.replace(/[\"`]/g, \"\");\n    const columns = await db.selectFrom(\n      (0,kysely__WEBPACK_IMPORTED_MODULE_2__.sql)`pragma_table_info(${table})`.as(\"table_info\")\n    ).select([\"name\", \"type\", \"notnull\", \"dflt_value\"]).execute();\n    return {\n      name: table,\n      columns: columns.map((col) => ({\n        name: col.name,\n        dataType: col.type,\n        isNullable: !col.notnull,\n        isAutoIncrementing: col.name === autoIncrementCol,\n        hasDefaultValue: col.dflt_value != null\n      })),\n      isView: true\n    };\n  }\n}\nclass BunSqliteQueryCompiler extends kysely__WEBPACK_IMPORTED_MODULE_3__.DefaultQueryCompiler {\n  getCurrentParameterPlaceholder() {\n    return \"?\";\n  }\n  getLeftIdentifierWrapper() {\n    return '\"';\n  }\n  getRightIdentifierWrapper() {\n    return '\"';\n  }\n  getAutoIncrement() {\n    return \"autoincrement\";\n  }\n}\nclass BunSqliteDialect {\n  #config;\n  constructor(config) {\n    this.#config = { ...config };\n  }\n  createDriver() {\n    return new BunSqliteDriver(this.#config);\n  }\n  createQueryCompiler() {\n    return new BunSqliteQueryCompiler();\n  }\n  createAdapter() {\n    return new BunSqliteAdapter();\n  }\n  createIntrospector(db) {\n    return new BunSqliteIntrospector(db);\n  }\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9jaHVua3MvYnVuLXNxbGl0ZS1kaWFsZWN0Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBeUg7O0FBRXpIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxpREFBYTtBQUMvQztBQUNBO0FBQ0Esa0NBQWtDLGlEQUFhO0FBQy9DO0FBQ0E7QUFDQSxrQ0FBa0MsaURBQWE7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksd0JBQXdCO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLGlDQUFpQztBQUMvRDtBQUNBO0FBQ0Esd0NBQXdDLDJEQUF1QixzQkFBc0IsZ0VBQTRCO0FBQ2pIO0FBQ0E7QUFDQSxxQ0FBcUMsTUFBTTtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTSwyQ0FBRyxxQkFBcUIsTUFBTTtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsd0RBQW9CO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRThHIiwic291cmNlcyI6WyIvVXNlcnMvbWlsYW4vRGVza3RvcC9BcHBzL2JldHRlci1hdXRoL25vZGVfbW9kdWxlcy9iZXR0ZXItYXV0aC9kaXN0L2NodW5rcy9idW4tc3FsaXRlLWRpYWxlY3QubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBpbGVkUXVlcnksIERlZmF1bHRRdWVyeUNvbXBpbGVyLCBERUZBVUxUX01JR1JBVElPTl9UQUJMRSwgREVGQVVMVF9NSUdSQVRJT05fTE9DS19UQUJMRSwgc3FsIH0gZnJvbSAna3lzZWx5JztcblxuY2xhc3MgQnVuU3FsaXRlQWRhcHRlciB7XG4gIGdldCBzdXBwb3J0c0NyZWF0ZUlmTm90RXhpc3RzKCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGdldCBzdXBwb3J0c1RyYW5zYWN0aW9uYWxEZGwoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGdldCBzdXBwb3J0c1JldHVybmluZygpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBhc3luYyBhY3F1aXJlTWlncmF0aW9uTG9jaygpIHtcbiAgfVxuICBhc3luYyByZWxlYXNlTWlncmF0aW9uTG9jaygpIHtcbiAgfVxuICBnZXQgc3VwcG9ydHNPdXRwdXQoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbn1cbmNsYXNzIEJ1blNxbGl0ZURyaXZlciB7XG4gICNjb25maWc7XG4gICNjb25uZWN0aW9uTXV0ZXggPSBuZXcgQ29ubmVjdGlvbk11dGV4KCk7XG4gICNkYjtcbiAgI2Nvbm5lY3Rpb247XG4gIGNvbnN0cnVjdG9yKGNvbmZpZykge1xuICAgIHRoaXMuI2NvbmZpZyA9IHsgLi4uY29uZmlnIH07XG4gIH1cbiAgYXN5bmMgaW5pdCgpIHtcbiAgICB0aGlzLiNkYiA9IHRoaXMuI2NvbmZpZy5kYXRhYmFzZTtcbiAgICB0aGlzLiNjb25uZWN0aW9uID0gbmV3IEJ1blNxbGl0ZUNvbm5lY3Rpb24odGhpcy4jZGIpO1xuICAgIGlmICh0aGlzLiNjb25maWcub25DcmVhdGVDb25uZWN0aW9uKSB7XG4gICAgICBhd2FpdCB0aGlzLiNjb25maWcub25DcmVhdGVDb25uZWN0aW9uKHRoaXMuI2Nvbm5lY3Rpb24pO1xuICAgIH1cbiAgfVxuICBhc3luYyBhY3F1aXJlQ29ubmVjdGlvbigpIHtcbiAgICBhd2FpdCB0aGlzLiNjb25uZWN0aW9uTXV0ZXgubG9jaygpO1xuICAgIHJldHVybiB0aGlzLiNjb25uZWN0aW9uO1xuICB9XG4gIGFzeW5jIGJlZ2luVHJhbnNhY3Rpb24oY29ubmVjdGlvbikge1xuICAgIGF3YWl0IGNvbm5lY3Rpb24uZXhlY3V0ZVF1ZXJ5KENvbXBpbGVkUXVlcnkucmF3KFwiYmVnaW5cIikpO1xuICB9XG4gIGFzeW5jIGNvbW1pdFRyYW5zYWN0aW9uKGNvbm5lY3Rpb24pIHtcbiAgICBhd2FpdCBjb25uZWN0aW9uLmV4ZWN1dGVRdWVyeShDb21waWxlZFF1ZXJ5LnJhdyhcImNvbW1pdFwiKSk7XG4gIH1cbiAgYXN5bmMgcm9sbGJhY2tUcmFuc2FjdGlvbihjb25uZWN0aW9uKSB7XG4gICAgYXdhaXQgY29ubmVjdGlvbi5leGVjdXRlUXVlcnkoQ29tcGlsZWRRdWVyeS5yYXcoXCJyb2xsYmFja1wiKSk7XG4gIH1cbiAgYXN5bmMgcmVsZWFzZUNvbm5lY3Rpb24oKSB7XG4gICAgdGhpcy4jY29ubmVjdGlvbk11dGV4LnVubG9jaygpO1xuICB9XG4gIGFzeW5jIGRlc3Ryb3koKSB7XG4gICAgdGhpcy4jZGI/LmNsb3NlKCk7XG4gIH1cbn1cbmNsYXNzIEJ1blNxbGl0ZUNvbm5lY3Rpb24ge1xuICAjZGI7XG4gIGNvbnN0cnVjdG9yKGRiKSB7XG4gICAgdGhpcy4jZGIgPSBkYjtcbiAgfVxuICBleGVjdXRlUXVlcnkoY29tcGlsZWRRdWVyeSkge1xuICAgIGNvbnN0IHsgc3FsOiBzcWwyLCBwYXJhbWV0ZXJzIH0gPSBjb21waWxlZFF1ZXJ5O1xuICAgIGNvbnN0IHN0bXQgPSB0aGlzLiNkYi5wcmVwYXJlKHNxbDIpO1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgcm93czogc3RtdC5hbGwocGFyYW1ldGVycylcbiAgICB9KTtcbiAgfVxuICBhc3luYyAqc3RyZWFtUXVlcnkoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiU3RyZWFtaW5nIHF1ZXJ5IGlzIG5vdCBzdXBwb3J0ZWQgYnkgU1FMaXRlIGRyaXZlci5cIik7XG4gIH1cbn1cbmNsYXNzIENvbm5lY3Rpb25NdXRleCB7XG4gICNwcm9taXNlO1xuICAjcmVzb2x2ZTtcbiAgYXN5bmMgbG9jaygpIHtcbiAgICB3aGlsZSAodGhpcy4jcHJvbWlzZSkge1xuICAgICAgYXdhaXQgdGhpcy4jcHJvbWlzZTtcbiAgICB9XG4gICAgdGhpcy4jcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICB0aGlzLiNyZXNvbHZlID0gcmVzb2x2ZTtcbiAgICB9KTtcbiAgfVxuICB1bmxvY2soKSB7XG4gICAgY29uc3QgcmVzb2x2ZSA9IHRoaXMuI3Jlc29sdmU7XG4gICAgdGhpcy4jcHJvbWlzZSA9IHZvaWQgMDtcbiAgICB0aGlzLiNyZXNvbHZlID0gdm9pZCAwO1xuICAgIHJlc29sdmU/LigpO1xuICB9XG59XG5jbGFzcyBCdW5TcWxpdGVJbnRyb3NwZWN0b3Ige1xuICAjZGI7XG4gIGNvbnN0cnVjdG9yKGRiKSB7XG4gICAgdGhpcy4jZGIgPSBkYjtcbiAgfVxuICBhc3luYyBnZXRTY2hlbWFzKCkge1xuICAgIHJldHVybiBbXTtcbiAgfVxuICBhc3luYyBnZXRUYWJsZXMob3B0aW9ucyA9IHsgd2l0aEludGVybmFsS3lzZWx5VGFibGVzOiBmYWxzZSB9KSB7XG4gICAgbGV0IHF1ZXJ5ID0gdGhpcy4jZGIuc2VsZWN0RnJvbShcInNxbGl0ZV9zY2hlbWFcIikud2hlcmUoXCJ0eXBlXCIsIFwiPVwiLCBcInRhYmxlXCIpLndoZXJlKFwibmFtZVwiLCBcIm5vdCBsaWtlXCIsIFwic3FsaXRlXyVcIikuc2VsZWN0KFwibmFtZVwiKS4kY2FzdFRvKCk7XG4gICAgaWYgKCFvcHRpb25zLndpdGhJbnRlcm5hbEt5c2VseVRhYmxlcykge1xuICAgICAgcXVlcnkgPSBxdWVyeS53aGVyZShcIm5hbWVcIiwgXCIhPVwiLCBERUZBVUxUX01JR1JBVElPTl9UQUJMRSkud2hlcmUoXCJuYW1lXCIsIFwiIT1cIiwgREVGQVVMVF9NSUdSQVRJT05fTE9DS19UQUJMRSk7XG4gICAgfVxuICAgIGNvbnN0IHRhYmxlcyA9IGF3YWl0IHF1ZXJ5LmV4ZWN1dGUoKTtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwodGFibGVzLm1hcCgoeyBuYW1lIH0pID0+IHRoaXMuI2dldFRhYmxlTWV0YWRhdGEobmFtZSkpKTtcbiAgfVxuICBhc3luYyBnZXRNZXRhZGF0YShvcHRpb25zKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRhYmxlczogYXdhaXQgdGhpcy5nZXRUYWJsZXMob3B0aW9ucylcbiAgICB9O1xuICB9XG4gIGFzeW5jICNnZXRUYWJsZU1ldGFkYXRhKHRhYmxlKSB7XG4gICAgY29uc3QgZGIgPSB0aGlzLiNkYjtcbiAgICBjb25zdCBjcmVhdGVTcWwgPSBhd2FpdCBkYi5zZWxlY3RGcm9tKFwic3FsaXRlX21hc3RlclwiKS53aGVyZShcIm5hbWVcIiwgXCI9XCIsIHRhYmxlKS5zZWxlY3QoXCJzcWxcIikuJGNhc3RUbygpLmV4ZWN1dGUoKTtcbiAgICBjb25zdCBhdXRvSW5jcmVtZW50Q29sID0gY3JlYXRlU3FsWzBdPy5zcWw/LnNwbGl0KC9bXFwoXFwpLF0vKT8uZmluZCgoaXQpID0+IGl0LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJhdXRvaW5jcmVtZW50XCIpKT8uc3BsaXQoL1xccysvKT8uWzBdPy5yZXBsYWNlKC9bXCJgXS9nLCBcIlwiKTtcbiAgICBjb25zdCBjb2x1bW5zID0gYXdhaXQgZGIuc2VsZWN0RnJvbShcbiAgICAgIHNxbGBwcmFnbWFfdGFibGVfaW5mbygke3RhYmxlfSlgLmFzKFwidGFibGVfaW5mb1wiKVxuICAgICkuc2VsZWN0KFtcIm5hbWVcIiwgXCJ0eXBlXCIsIFwibm90bnVsbFwiLCBcImRmbHRfdmFsdWVcIl0pLmV4ZWN1dGUoKTtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogdGFibGUsXG4gICAgICBjb2x1bW5zOiBjb2x1bW5zLm1hcCgoY29sKSA9PiAoe1xuICAgICAgICBuYW1lOiBjb2wubmFtZSxcbiAgICAgICAgZGF0YVR5cGU6IGNvbC50eXBlLFxuICAgICAgICBpc051bGxhYmxlOiAhY29sLm5vdG51bGwsXG4gICAgICAgIGlzQXV0b0luY3JlbWVudGluZzogY29sLm5hbWUgPT09IGF1dG9JbmNyZW1lbnRDb2wsXG4gICAgICAgIGhhc0RlZmF1bHRWYWx1ZTogY29sLmRmbHRfdmFsdWUgIT0gbnVsbFxuICAgICAgfSkpLFxuICAgICAgaXNWaWV3OiB0cnVlXG4gICAgfTtcbiAgfVxufVxuY2xhc3MgQnVuU3FsaXRlUXVlcnlDb21waWxlciBleHRlbmRzIERlZmF1bHRRdWVyeUNvbXBpbGVyIHtcbiAgZ2V0Q3VycmVudFBhcmFtZXRlclBsYWNlaG9sZGVyKCkge1xuICAgIHJldHVybiBcIj9cIjtcbiAgfVxuICBnZXRMZWZ0SWRlbnRpZmllcldyYXBwZXIoKSB7XG4gICAgcmV0dXJuICdcIic7XG4gIH1cbiAgZ2V0UmlnaHRJZGVudGlmaWVyV3JhcHBlcigpIHtcbiAgICByZXR1cm4gJ1wiJztcbiAgfVxuICBnZXRBdXRvSW5jcmVtZW50KCkge1xuICAgIHJldHVybiBcImF1dG9pbmNyZW1lbnRcIjtcbiAgfVxufVxuY2xhc3MgQnVuU3FsaXRlRGlhbGVjdCB7XG4gICNjb25maWc7XG4gIGNvbnN0cnVjdG9yKGNvbmZpZykge1xuICAgIHRoaXMuI2NvbmZpZyA9IHsgLi4uY29uZmlnIH07XG4gIH1cbiAgY3JlYXRlRHJpdmVyKCkge1xuICAgIHJldHVybiBuZXcgQnVuU3FsaXRlRHJpdmVyKHRoaXMuI2NvbmZpZyk7XG4gIH1cbiAgY3JlYXRlUXVlcnlDb21waWxlcigpIHtcbiAgICByZXR1cm4gbmV3IEJ1blNxbGl0ZVF1ZXJ5Q29tcGlsZXIoKTtcbiAgfVxuICBjcmVhdGVBZGFwdGVyKCkge1xuICAgIHJldHVybiBuZXcgQnVuU3FsaXRlQWRhcHRlcigpO1xuICB9XG4gIGNyZWF0ZUludHJvc3BlY3RvcihkYikge1xuICAgIHJldHVybiBuZXcgQnVuU3FsaXRlSW50cm9zcGVjdG9yKGRiKTtcbiAgfVxufVxuXG5leHBvcnQgeyBCdW5TcWxpdGVBZGFwdGVyLCBCdW5TcWxpdGVEaWFsZWN0LCBCdW5TcWxpdGVEcml2ZXIsIEJ1blNxbGl0ZUludHJvc3BlY3RvciwgQnVuU3FsaXRlUXVlcnlDb21waWxlciB9O1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/chunks/bun-sqlite-dialect.mjs\n");

/***/ }),

/***/ "(action-browser)/../../node_modules/better-auth/dist/cookies/index.mjs":
/*!*************************************************************!*\
  !*** ../../node_modules/better-auth/dist/cookies/index.mjs ***!
  \*************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createCookieGetter: () => (/* binding */ createCookieGetter),\n/* harmony export */   deleteSessionCookie: () => (/* binding */ deleteSessionCookie),\n/* harmony export */   getCookieCache: () => (/* binding */ getCookieCache),\n/* harmony export */   getCookies: () => (/* binding */ getCookies),\n/* harmony export */   getSessionCookie: () => (/* binding */ getSessionCookie),\n/* harmony export */   parseCookies: () => (/* binding */ parseCookies),\n/* harmony export */   parseSetCookieHeader: () => (/* binding */ parseSetCookieHeader),\n/* harmony export */   setCookieCache: () => (/* binding */ setCookieCache),\n/* harmony export */   setCookieToHeader: () => (/* binding */ setCookieToHeader),\n/* harmony export */   setSessionCookie: () => (/* binding */ setSessionCookie)\n/* harmony export */ });\n/* harmony import */ var _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../shared/better-auth.DdzSJf-n.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs\");\n/* harmony import */ var _shared_better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../shared/better-auth.CW6D9eSx.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.CW6D9eSx.mjs\");\n/* harmony import */ var _shared_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../shared/better-auth.8zoxzg-F.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs\");\n/* harmony import */ var _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @better-auth/utils/base64 */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/base64.mjs\");\n/* harmony import */ var _better_auth_utils_hmac__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @better-auth/utils/hmac */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/hmac.mjs\");\n/* harmony import */ var _shared_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../shared/better-auth.tB5eU6EY.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.tB5eU6EY.mjs\");\n/* harmony import */ var _shared_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../shared/better-auth.VTXNLFMT.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.VTXNLFMT.mjs\");\n/* harmony import */ var _better_auth_utils_binary__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @better-auth/utils/binary */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/binary.mjs\");\n\n\n\n\n\n\n\n\n\nconst createTime = (value, format) => {\n  const toMilliseconds = () => {\n    switch (format) {\n      case \"ms\":\n        return value;\n      case \"s\":\n        return value * 1e3;\n      case \"m\":\n        return value * 1e3 * 60;\n      case \"h\":\n        return value * 1e3 * 60 * 60;\n      case \"d\":\n        return value * 1e3 * 60 * 60 * 24;\n      case \"w\":\n        return value * 1e3 * 60 * 60 * 24 * 7;\n      case \"y\":\n        return value * 1e3 * 60 * 60 * 24 * 365;\n    }\n  };\n  const time = {\n    t: `${value}${format}`,\n    value,\n    tFormat: format,\n    toMilliseconds,\n    toSeconds: () => time.toMilliseconds() / 1e3,\n    toMinutes: () => time.toSeconds() / 60,\n    toHours: () => time.toMinutes() / 60,\n    toDays: () => time.toHours() / 24,\n    toWeeks: () => time.toDays() / 7,\n    toYears: () => time.toDays() / 365,\n    getDate: () => new Date(Date.now() + time.toMilliseconds()),\n    add: (other) => {\n      const otherMs = typeof other === \"string\" ? parseTime(other).toMilliseconds() : other.toMilliseconds();\n      return createTime(time.toMilliseconds() + otherMs, \"ms\");\n    },\n    subtract: (other) => {\n      const otherMs = typeof other === \"string\" ? parseTime(other).toMilliseconds() : other.toMilliseconds();\n      return createTime(time.toMilliseconds() - otherMs, \"ms\");\n    },\n    multiply: (factor) => createTime(time.toMilliseconds() * factor, \"ms\"),\n    divide: (divisor) => createTime(time.toMilliseconds() / divisor, \"ms\"),\n    equals: (other) => {\n      const otherMs = typeof other === \"string\" ? parseTime(other).toMilliseconds() : other.toMilliseconds();\n      return time.toMilliseconds() === otherMs;\n    },\n    lessThan: (other) => {\n      const otherMs = typeof other === \"string\" ? parseTime(other).toMilliseconds() : other.toMilliseconds();\n      return time.toMilliseconds() < otherMs;\n    },\n    greaterThan: (other) => {\n      const otherMs = typeof other === \"string\" ? parseTime(other).toMilliseconds() : other.toMilliseconds();\n      return time.toMilliseconds() > otherMs;\n    },\n    format: (pattern) => {\n      const date = time.getDate();\n      return pattern.replace(/YYYY|MM|DD|HH|mm|ss/g, (match) => {\n        switch (match) {\n          case \"YYYY\":\n            return date.getFullYear().toString();\n          case \"MM\":\n            return (date.getMonth() + 1).toString().padStart(2, \"0\");\n          case \"DD\":\n            return date.getDate().toString().padStart(2, \"0\");\n          case \"HH\":\n            return date.getHours().toString().padStart(2, \"0\");\n          case \"mm\":\n            return date.getMinutes().toString().padStart(2, \"0\");\n          case \"ss\":\n            return date.getSeconds().toString().padStart(2, \"0\");\n          default:\n            return match;\n        }\n      });\n    },\n    fromNow: () => {\n      const ms = time.toMilliseconds();\n      if (ms < 0) return time.ago();\n      if (ms < 1e3) return \"in a few seconds\";\n      if (ms < 6e4) return `in ${Math.round(ms / 1e3)} seconds`;\n      if (ms < 36e5) return `in ${Math.round(ms / 6e4)} minutes`;\n      if (ms < 864e5) return `in ${Math.round(ms / 36e5)} hours`;\n      if (ms < 6048e5) return `in ${Math.round(ms / 864e5)} days`;\n      if (ms < 26298e5) return `in ${Math.round(ms / 6048e5)} weeks`;\n      if (ms < 315576e5) return `in ${Math.round(ms / 26298e5)} months`;\n      return `in ${Math.round(ms / 315576e5)} years`;\n    },\n    ago: () => {\n      const ms = -time.toMilliseconds();\n      if (ms < 0) return time.fromNow();\n      if (ms < 1e3) return \"a few seconds ago\";\n      if (ms < 6e4) return `${Math.round(ms / 1e3)} seconds ago`;\n      if (ms < 36e5) return `${Math.round(ms / 6e4)} minutes ago`;\n      if (ms < 864e5) return `${Math.round(ms / 36e5)} hours ago`;\n      if (ms < 6048e5) return `${Math.round(ms / 864e5)} days ago`;\n      if (ms < 26298e5) return `${Math.round(ms / 6048e5)} weeks ago`;\n      if (ms < 315576e5) return `${Math.round(ms / 26298e5)} months ago`;\n      return `${Math.round(ms / 315576e5)} years ago`;\n    }\n  };\n  return time;\n};\nconst parseTime = (time) => {\n  const match = time.match(/^(\\d+)(ms|s|m|h|d|w|y)$/);\n  if (!match) throw new Error(\"Invalid time format\");\n  return createTime(parseInt(match[1]), match[2]);\n};\n\nfunction parseSetCookieHeader(setCookie) {\n  const cookies = /* @__PURE__ */ new Map();\n  const cookieArray = setCookie.split(\", \");\n  cookieArray.forEach((cookieString) => {\n    const parts = cookieString.split(\";\").map((part) => part.trim());\n    const [nameValue, ...attributes] = parts;\n    const [name, ...valueParts] = nameValue.split(\"=\");\n    const value = valueParts.join(\"=\");\n    if (!name || value === void 0) {\n      return;\n    }\n    const attrObj = { value };\n    attributes.forEach((attribute) => {\n      const [attrName, ...attrValueParts] = attribute.split(\"=\");\n      const attrValue = attrValueParts.join(\"=\");\n      const normalizedAttrName = attrName.trim().toLowerCase();\n      switch (normalizedAttrName) {\n        case \"max-age\":\n          attrObj[\"max-age\"] = attrValue ? parseInt(attrValue.trim(), 10) : void 0;\n          break;\n        case \"expires\":\n          attrObj.expires = attrValue ? new Date(attrValue.trim()) : void 0;\n          break;\n        case \"domain\":\n          attrObj.domain = attrValue ? attrValue.trim() : void 0;\n          break;\n        case \"path\":\n          attrObj.path = attrValue ? attrValue.trim() : void 0;\n          break;\n        case \"secure\":\n          attrObj.secure = true;\n          break;\n        case \"httponly\":\n          attrObj.httponly = true;\n          break;\n        case \"samesite\":\n          attrObj.samesite = attrValue ? attrValue.trim().toLowerCase() : void 0;\n          break;\n        default:\n          attrObj[normalizedAttrName] = attrValue ? attrValue.trim() : true;\n          break;\n      }\n    });\n    cookies.set(name, attrObj);\n  });\n  return cookies;\n}\nfunction setCookieToHeader(headers) {\n  return (context) => {\n    const setCookieHeader = context.response.headers.get(\"set-cookie\");\n    if (!setCookieHeader) {\n      return;\n    }\n    const cookieMap = /* @__PURE__ */ new Map();\n    const existingCookiesHeader = headers.get(\"cookie\") || \"\";\n    existingCookiesHeader.split(\";\").forEach((cookie) => {\n      const [name, ...rest] = cookie.trim().split(\"=\");\n      if (name && rest.length > 0) {\n        cookieMap.set(name, rest.join(\"=\"));\n      }\n    });\n    const setCookieHeaders = setCookieHeader.split(\",\");\n    setCookieHeaders.forEach((header) => {\n      const cookies = parseSetCookieHeader(header);\n      cookies.forEach((value, name) => {\n        cookieMap.set(name, value.value);\n      });\n    });\n    const updatedCookies = Array.from(cookieMap.entries()).map(([name, value]) => `${name}=${value}`).join(\"; \");\n    headers.set(\"cookie\", updatedCookies);\n  };\n}\n\nfunction createCookieGetter(options) {\n  const secure = options.advanced?.useSecureCookies !== void 0 ? options.advanced?.useSecureCookies : options.baseURL !== void 0 ? options.baseURL.startsWith(\"https://\") ? true : false : _shared_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_2__.a;\n  const secureCookiePrefix = secure ? \"__Secure-\" : \"\";\n  const crossSubdomainEnabled = !!options.advanced?.crossSubDomainCookies?.enabled;\n  const domain = crossSubdomainEnabled ? options.advanced?.crossSubDomainCookies?.domain || (options.baseURL ? new URL(options.baseURL).hostname : void 0) : void 0;\n  if (crossSubdomainEnabled && !domain) {\n    throw new _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_0__.B(\n      \"baseURL is required when crossSubdomainCookies are enabled\"\n    );\n  }\n  function createCookie(cookieName, overrideAttributes = {}) {\n    const prefix = options.advanced?.cookiePrefix || \"better-auth\";\n    const name = options.advanced?.cookies?.[cookieName]?.name || `${prefix}.${cookieName}`;\n    const attributes = options.advanced?.cookies?.[cookieName]?.attributes;\n    return {\n      name: `${secureCookiePrefix}${name}`,\n      attributes: {\n        secure: !!secureCookiePrefix,\n        sameSite: \"lax\",\n        path: \"/\",\n        httpOnly: true,\n        ...crossSubdomainEnabled ? { domain } : {},\n        ...options.advanced?.defaultCookieAttributes,\n        ...overrideAttributes,\n        ...attributes\n      }\n    };\n  }\n  return createCookie;\n}\nfunction getCookies(options) {\n  const createCookie = createCookieGetter(options);\n  const sessionMaxAge = options.session?.expiresIn || createTime(7, \"d\").toSeconds();\n  const sessionToken = createCookie(\"session_token\", {\n    maxAge: sessionMaxAge\n  });\n  const sessionData = createCookie(\"session_data\", {\n    maxAge: options.session?.cookieCache?.maxAge || 60 * 5\n  });\n  const dontRememberToken = createCookie(\"dont_remember\");\n  return {\n    sessionToken: {\n      name: sessionToken.name,\n      options: sessionToken.attributes\n    },\n    /**\n     * This cookie is used to store the session data in the cookie\n     * This is useful for when you want to cache the session in the cookie\n     */\n    sessionData: {\n      name: sessionData.name,\n      options: sessionData.attributes\n    },\n    dontRememberToken: {\n      name: dontRememberToken.name,\n      options: dontRememberToken.attributes\n    }\n  };\n}\nasync function setCookieCache(ctx, session) {\n  const shouldStoreSessionDataInCookie = ctx.context.options.session?.cookieCache?.enabled;\n  if (shouldStoreSessionDataInCookie) {\n    const filteredSession = Object.entries(session.session).reduce(\n      (acc, [key, value]) => {\n        const fieldConfig = ctx.context.options.session?.additionalFields?.[key];\n        if (!fieldConfig || fieldConfig.returned !== false) {\n          acc[key] = value;\n        }\n        return acc;\n      },\n      {}\n    );\n    const sessionData = { session: filteredSession, user: session.user };\n    const expiresAtDate = (0,_shared_better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_1__.g)(\n      ctx.context.authCookies.sessionData.options.maxAge || 60,\n      \"sec\"\n    ).getTime();\n    const data = _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_3__.base64Url.encode(\n      JSON.stringify({\n        session: sessionData,\n        expiresAt: expiresAtDate,\n        signature: await (0,_better_auth_utils_hmac__WEBPACK_IMPORTED_MODULE_4__.createHMAC)(\"SHA-256\", \"base64urlnopad\").sign(\n          ctx.context.secret,\n          JSON.stringify({\n            ...sessionData,\n            expiresAt: expiresAtDate\n          })\n        )\n      }),\n      {\n        padding: false\n      }\n    );\n    if (data.length > 4093) {\n      throw new _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_0__.B(\n        \"Session data is too large to store in the cookie. Please disable session cookie caching or reduce the size of the session data\"\n      );\n    }\n    ctx.setCookie(\n      ctx.context.authCookies.sessionData.name,\n      data,\n      ctx.context.authCookies.sessionData.options\n    );\n  }\n}\nasync function setSessionCookie(ctx, session, dontRememberMe, overrides) {\n  const dontRememberMeCookie = await ctx.getSignedCookie(\n    ctx.context.authCookies.dontRememberToken.name,\n    ctx.context.secret\n  );\n  dontRememberMe = dontRememberMe !== void 0 ? dontRememberMe : !!dontRememberMeCookie;\n  const options = ctx.context.authCookies.sessionToken.options;\n  const maxAge = dontRememberMe ? void 0 : ctx.context.sessionConfig.expiresIn;\n  await ctx.setSignedCookie(\n    ctx.context.authCookies.sessionToken.name,\n    session.session.token,\n    ctx.context.secret,\n    {\n      ...options,\n      maxAge,\n      ...overrides\n    }\n  );\n  if (dontRememberMe) {\n    await ctx.setSignedCookie(\n      ctx.context.authCookies.dontRememberToken.name,\n      \"true\",\n      ctx.context.secret,\n      ctx.context.authCookies.dontRememberToken.options\n    );\n  }\n  await setCookieCache(ctx, session);\n  ctx.context.setNewSession(session);\n  if (ctx.context.options.secondaryStorage) {\n    await ctx.context.secondaryStorage?.set(\n      session.session.token,\n      JSON.stringify({\n        user: session.user,\n        session: session.session\n      }),\n      Math.floor(\n        (new Date(session.session.expiresAt).getTime() - Date.now()) / 1e3\n      )\n    );\n  }\n}\nfunction deleteSessionCookie(ctx, skipDontRememberMe) {\n  ctx.setCookie(ctx.context.authCookies.sessionToken.name, \"\", {\n    ...ctx.context.authCookies.sessionToken.options,\n    maxAge: 0\n  });\n  ctx.setCookie(ctx.context.authCookies.sessionData.name, \"\", {\n    ...ctx.context.authCookies.sessionData.options,\n    maxAge: 0\n  });\n  if (!skipDontRememberMe) {\n    ctx.setCookie(ctx.context.authCookies.dontRememberToken.name, \"\", {\n      ...ctx.context.authCookies.dontRememberToken.options,\n      maxAge: 0\n    });\n  }\n}\nfunction parseCookies(cookieHeader) {\n  const cookies = cookieHeader.split(\"; \");\n  const cookieMap = /* @__PURE__ */ new Map();\n  cookies.forEach((cookie) => {\n    const [name, value] = cookie.split(\"=\");\n    cookieMap.set(name, value);\n  });\n  return cookieMap;\n}\nconst getSessionCookie = (request, config) => {\n  if (config?.cookiePrefix) {\n    if (config.cookieName) {\n      config.cookiePrefix = `${config.cookiePrefix}-`;\n    } else {\n      config.cookiePrefix = `${config.cookiePrefix}.`;\n    }\n  }\n  const headers = \"headers\" in request ? request.headers : request;\n  const req = request instanceof Request ? request : void 0;\n  (0,_shared_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_6__.a)(req?.url, config?.path, req);\n  const cookies = headers.get(\"cookie\");\n  if (!cookies) {\n    return null;\n  }\n  const { cookieName = \"session_token\", cookiePrefix = \"better-auth.\" } = config || {};\n  const name = `${cookiePrefix}${cookieName}`;\n  const secureCookieName = `__Secure-${name}`;\n  const parsedCookie = parseCookies(cookies);\n  const sessionToken = parsedCookie.get(name) || parsedCookie.get(secureCookieName);\n  if (sessionToken) {\n    return sessionToken;\n  }\n  return null;\n};\nconst getCookieCache = async (request, config) => {\n  const headers = request instanceof Headers ? request : request.headers;\n  const cookies = headers.get(\"cookie\");\n  if (!cookies) {\n    return null;\n  }\n  const { cookieName = \"session_data\", cookiePrefix = \"better-auth\" } = config || {};\n  const name = config?.isSecure !== void 0 ? config.isSecure ? `__Secure-${cookiePrefix}.${cookieName}` : `${cookiePrefix}.${cookieName}` : _shared_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_2__.a ? `__Secure-${cookiePrefix}.${cookieName}` : `${cookiePrefix}.${cookieName}`;\n  const parsedCookie = parseCookies(cookies);\n  const sessionData = parsedCookie.get(name);\n  if (sessionData) {\n    const sessionDataPayload = (0,_shared_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_5__.s)(_better_auth_utils_binary__WEBPACK_IMPORTED_MODULE_7__.binary.decode(_better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_3__.base64Url.decode(sessionData)));\n    if (!sessionDataPayload) {\n      return null;\n    }\n    const secret = config?.secret || _shared_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_2__.e.BETTER_AUTH_SECRET;\n    if (!secret) {\n      throw new _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_0__.B(\n        \"getCookieCache requires a secret to be provided. Either pass it as an option or set the BETTER_AUTH_SECRET environment variable\"\n      );\n    }\n    const isValid = await (0,_better_auth_utils_hmac__WEBPACK_IMPORTED_MODULE_4__.createHMAC)(\"SHA-256\", \"base64urlnopad\").verify(\n      secret,\n      JSON.stringify({\n        ...sessionDataPayload.session,\n        expiresAt: sessionDataPayload.expiresAt\n      }),\n      sessionDataPayload.signature\n    );\n    if (!isValid) {\n      return null;\n    }\n    return sessionDataPayload.session;\n  }\n  return null;\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9jb29raWVzL2luZGV4Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBMEU7QUFDUjtBQUNlO0FBQzNCO0FBQ0Q7QUFDbUI7QUFDSDtBQUNsQjs7QUFFbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsTUFBTSxFQUFFLE9BQU87QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMsc0JBQXNCO0FBQ3ZELGtDQUFrQyxzQkFBc0I7QUFDeEQsbUNBQW1DLHVCQUF1QjtBQUMxRCxvQ0FBb0Msd0JBQXdCO0FBQzVELHFDQUFxQyx5QkFBeUI7QUFDOUQsc0NBQXNDLDBCQUEwQjtBQUNoRSxtQkFBbUIsMkJBQTJCO0FBQzlDLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QixzQkFBc0I7QUFDcEQsK0JBQStCLHNCQUFzQjtBQUNyRCxnQ0FBZ0MsdUJBQXVCO0FBQ3ZELGlDQUFpQyx3QkFBd0I7QUFDekQsa0NBQWtDLHlCQUF5QjtBQUMzRCxtQ0FBbUMs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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsNERBQTREO0FBQ3RFLDJFQUEyRSxhQUFhLEdBQUcsV0FBVyxPQUFPLGFBQWEsR0FBRyxXQUFXLElBQUksK0RBQVksZUFBZSxhQUFhLEdBQUcsV0FBVyxPQUFPLGFBQWEsR0FBRyxXQUFXO0FBQ3BPO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixtRUFBYSxDQUFDLDZEQUFNLFFBQVEsZ0VBQVM7QUFDcEU7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLCtEQUFHO0FBQ3hDO0FBQ0EsZ0JBQWdCLCtEQUFlO0FBQy9CO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixtRUFBVTtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRTBMIiwic291cmNlcyI6WyIvVXNlcnMvbWlsYW4vRGVza3RvcC9BcHBzL2JldHRlci1hdXRoL25vZGVfbW9kdWxlcy9iZXR0ZXItYXV0aC9kaXN0L2Nvb2tpZXMvaW5kZXgubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEIgYXMgQmV0dGVyQXV0aEVycm9yIH0gZnJvbSAnLi4vc2hhcmVkL2JldHRlci1hdXRoLkRkelNKZi1uLm1qcyc7XG5pbXBvcnQgeyBnIGFzIGdldERhdGUgfSBmcm9tICcuLi9zaGFyZWQvYmV0dGVyLWF1dGguQ1c2RDllU3gubWpzJztcbmltcG9ydCB7IGEgYXMgaXNQcm9kdWN0aW9uLCBlIGFzIGVudiB9IGZyb20gJy4uL3NoYXJlZC9iZXR0ZXItYXV0aC44em94emctRi5tanMnO1xuaW1wb3J0IHsgYmFzZTY0VXJsIH0gZnJvbSAnQGJldHRlci1hdXRoL3V0aWxzL2Jhc2U2NCc7XG5pbXBvcnQgeyBjcmVhdGVITUFDIH0gZnJvbSAnQGJldHRlci1hdXRoL3V0aWxzL2htYWMnO1xuaW1wb3J0IHsgcyBhcyBzYWZlSlNPTlBhcnNlIH0gZnJvbSAnLi4vc2hhcmVkL2JldHRlci1hdXRoLnRCNWVVNkVZLm1qcyc7XG5pbXBvcnQgeyBhIGFzIGdldEJhc2VVUkwgfSBmcm9tICcuLi9zaGFyZWQvYmV0dGVyLWF1dGguVlRYTkxGTVQubWpzJztcbmltcG9ydCB7IGJpbmFyeSB9IGZyb20gJ0BiZXR0ZXItYXV0aC91dGlscy9iaW5hcnknO1xuXG5jb25zdCBjcmVhdGVUaW1lID0gKHZhbHVlLCBmb3JtYXQpID0+IHtcbiAgY29uc3QgdG9NaWxsaXNlY29uZHMgPSAoKSA9PiB7XG4gICAgc3dpdGNoIChmb3JtYXQpIHtcbiAgICAgIGNhc2UgXCJtc1wiOlxuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICBjYXNlIFwic1wiOlxuICAgICAgICByZXR1cm4gdmFsdWUgKiAxZTM7XG4gICAgICBjYXNlIFwibVwiOlxuICAgICAgICByZXR1cm4gdmFsdWUgKiAxZTMgKiA2MDtcbiAgICAgIGNhc2UgXCJoXCI6XG4gICAgICAgIHJldHVybiB2YWx1ZSAqIDFlMyAqIDYwICogNjA7XG4gICAgICBjYXNlIFwiZFwiOlxuICAgICAgICByZXR1cm4gdmFsdWUgKiAxZTMgKiA2MCAqIDYwICogMjQ7XG4gICAgICBjYXNlIFwid1wiOlxuICAgICAgICByZXR1cm4gdmFsdWUgKiAxZTMgKiA2MCAqIDYwICogMjQgKiA3O1xuICAgICAgY2FzZSBcInlcIjpcbiAgICAgICAgcmV0dXJuIHZhbHVlICogMWUzICogNjAgKiA2MCAqIDI0ICogMzY1O1xuICAgIH1cbiAgfTtcbiAgY29uc3QgdGltZSA9IHtcbiAgICB0OiBgJHt2YWx1ZX0ke2Zvcm1hdH1gLFxuICAgIHZhbHVlLFxuICAgIHRGb3JtYXQ6IGZvcm1hdCxcbiAgICB0b01pbGxpc2Vjb25kcyxcbiAgICB0b1NlY29uZHM6ICgpID0+IHRpbWUudG9NaWxsaXNlY29uZHMoKSAvIDFlMyxcbiAgICB0b01pbnV0ZXM6ICgpID0+IHRpbWUudG9TZWNvbmRzKCkgLyA2MCxcbiAgICB0b0hvdXJzOiAoKSA9PiB0aW1lLnRvTWludXRlcygpIC8gNjAsXG4gICAgdG9EYXlzOiAoKSA9PiB0aW1lLnRvSG91cnMoKSAvIDI0LFxuICAgIHRvV2Vla3M6ICgpID0+IHRpbWUudG9EYXlzKCkgLyA3LFxuICAgIHRvWWVhcnM6ICgpID0+IHRpbWUudG9EYXlzKCkgLyAzNjUsXG4gICAgZ2V0RGF0ZTogKCkgPT4gbmV3IERhdGUoRGF0ZS5ub3coKSArIHRpbWUudG9NaWxsaXNlY29uZHMoKSksXG4gICAgYWRkOiAob3RoZXIpID0+IHtcbiAgICAgIGNvbnN0IG90aGVyTXMgPSB0eXBlb2Ygb3RoZXIgPT09IFwic3RyaW5nXCIgPyBwYXJzZVRpbWUob3RoZXIpLnRvTWlsbGlzZWNvbmRzKCkgOiBvdGhlci50b01pbGxpc2Vjb25kcygpO1xuICAgICAgcmV0dXJuIGNyZWF0ZVRpbWUodGltZS50b01pbGxpc2Vjb25kcygpICsgb3RoZXJNcywgXCJtc1wiKTtcbiAgICB9LFxuICAgIHN1YnRyYWN0OiAob3RoZXIpID0+IHtcbiAgICAgIGNvbnN0IG90aGVyTXMgPSB0eXBlb2Ygb3RoZXIgPT09IFwic3RyaW5nXCIgPyBwYXJzZVRpbWUob3RoZXIpLnRvTWlsbGlzZWNvbmRzKCkgOiBvdGhlci50b01pbGxpc2Vjb25kcygpO1xuICAgICAgcmV0dXJuIGNyZWF0ZVRpbWUodGltZS50b01pbGxpc2Vjb25kcygpIC0gb3RoZXJNcywgXCJtc1wiKTtcbiAgICB9LFxuICAgIG11bHRpcGx5OiAoZmFjdG9yKSA9PiBjcmVhdGVUaW1lKHRpbWUudG9NaWxsaXNlY29uZHMoKSAqIGZhY3RvciwgXCJtc1wiKSxcbiAgICBkaXZpZGU6IChkaXZpc29yKSA9PiBjcmVhdGVUaW1lKHRpbWUudG9NaWxsaXNlY29uZHMoKSAvIGRpdmlzb3IsIFwibXNcIiksXG4gICAgZXF1YWxzOiAob3RoZXIpID0+IHtcbiAgICAgIGNvbnN0IG90aGVyTXMgPSB0eXBlb2Ygb3RoZXIgPT09IFwic3RyaW5nXCIgPyBwYXJzZVRpbWUob3RoZXIpLnRvTWlsbGlzZWNvbmRzKCkgOiBvdGhlci50b01pbGxpc2Vjb25kcygpO1xuICAgICAgcmV0dXJuIHRpbWUudG9NaWxsaXNlY29uZHMoKSA9PT0gb3RoZXJNcztcbiAgICB9LFxuICAgIGxlc3NUaGFuOiAob3RoZXIpID0+IHtcbiAgICAgIGNvbnN0IG90aGVyTXMgPSB0eXBlb2Ygb3RoZXIgPT09IFwic3RyaW5nXCIgPyBwYXJzZVRpbWUob3RoZXIpLnRvTWlsbGlzZWNvbmRzKCkgOiBvdGhlci50b01pbGxpc2Vjb25kcygpO1xuICAgICAgcmV0dXJuIHRpbWUudG9NaWxsaXNlY29uZHMoKSA8IG90aGVyTXM7XG4gICAgfSxcbiAgICBncmVhdGVyVGhhbjogKG90aGVyKSA9PiB7XG4gICAgICBjb25zdCBvdGhlck1zID0gdHlwZW9mIG90aGVyID09PSBcInN0cmluZ1wiID8gcGFyc2VUaW1lKG90aGVyKS50b01pbGxpc2Vjb25kcygpIDogb3RoZXIudG9NaWxsaXNlY29uZHMoKTtcbiAgICAgIHJldHVybiB0aW1lLnRvTWlsbGlzZWNvbmRzKCkgPiBvdGhlck1zO1xuICAgIH0sXG4gICAgZm9ybWF0OiAocGF0dGVybikgPT4ge1xuICAgICAgY29uc3QgZGF0ZSA9IHRpbWUuZ2V0RGF0ZSgpO1xuICAgICAgcmV0dXJuIHBhdHRlcm4ucmVwbGFjZSgvWVlZWXxNTXxERHxISHxtbXxzcy9nLCAobWF0Y2gpID0+IHtcbiAgICAgICAgc3dpdGNoIChtYXRjaCkge1xuICAgICAgICAgIGNhc2UgXCJZWVlZXCI6XG4gICAgICAgICAgICByZXR1cm4gZGF0ZS5nZXRGdWxsWWVhcigpLnRvU3RyaW5nKCk7XG4gICAgICAgICAgY2FzZSBcIk1NXCI6XG4gICAgICAgICAgICByZXR1cm4gKGRhdGUuZ2V0TW9udGgoKSArIDEpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgXCIwXCIpO1xuICAgICAgICAgIGNhc2UgXCJERFwiOlxuICAgICAgICAgICAgcmV0dXJuIGRhdGUuZ2V0RGF0ZSgpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgXCIwXCIpO1xuICAgICAgICAgIGNhc2UgXCJISFwiOlxuICAgICAgICAgICAgcmV0dXJuIGRhdGUuZ2V0SG91cnMoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsIFwiMFwiKTtcbiAgICAgICAgICBjYXNlIFwibW1cIjpcbiAgICAgICAgICAgIHJldHVybiBkYXRlLmdldE1pbnV0ZXMoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsIFwiMFwiKTtcbiAgICAgICAgICBjYXNlIFwic3NcIjpcbiAgICAgICAgICAgIHJldHVybiBkYXRlLmdldFNlY29uZHMoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsIFwiMFwiKTtcbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIG1hdGNoO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGZyb21Ob3c6ICgpID0+IHtcbiAgICAgIGNvbnN0IG1zID0gdGltZS50b01pbGxpc2Vjb25kcygpO1xuICAgICAgaWYgKG1zIDwgMCkgcmV0dXJuIHRpbWUuYWdvKCk7XG4gICAgICBpZiAobXMgPCAxZTMpIHJldHVybiBcImluIGEgZmV3IHNlY29uZHNcIjtcbiAgICAgIGlmIChtcyA8IDZlNCkgcmV0dXJuIGBpbiAke01hdGgucm91bmQobXMgLyAxZTMpfSBzZWNvbmRzYDtcbiAgICAgIGlmIChtcyA8IDM2ZTUpIHJldHVybiBgaW4gJHtNYXRoLnJvdW5kKG1zIC8gNmU0KX0gbWludXRlc2A7XG4gICAgICBpZiAobXMgPCA4NjRlNSkgcmV0dXJuIGBpbiAke01hdGgucm91bmQobXMgLyAzNmU1KX0gaG91cnNgO1xuICAgICAgaWYgKG1zIDwgNjA0OGU1KSByZXR1cm4gYGluICR7TWF0aC5yb3VuZChtcyAvIDg2NGU1KX0gZGF5c2A7XG4gICAgICBpZiAobXMgPCAyNjI5OGU1KSByZXR1cm4gYGluICR7TWF0aC5yb3VuZChtcyAvIDYwNDhlNSl9IHdlZWtzYDtcbiAgICAgIGlmIChtcyA8IDMxNTU3NmU1KSByZXR1cm4gYGluICR7TWF0aC5yb3VuZChtcyAvIDI2Mjk4ZTUpfSBtb250aHNgO1xuICAgICAgcmV0dXJuIGBpbiAke01hdGgucm91bmQobXMgLyAzMTU1NzZlNSl9IHllYXJzYDtcbiAgICB9LFxuICAgIGFnbzogKCkgPT4ge1xuICAgICAgY29uc3QgbXMgPSAtdGltZS50b01pbGxpc2Vjb25kcygpO1xuICAgICAgaWYgKG1zIDwgMCkgcmV0dXJuIHRpbWUuZnJvbU5vdygpO1xuICAgICAgaWYgKG1zIDwgMWUzKSByZXR1cm4gXCJhIGZldyBzZWNvbmRzIGFnb1wiO1xuICAgICAgaWYgKG1zIDwgNmU0KSByZXR1cm4gYCR7TWF0aC5yb3VuZChtcyAvIDFlMyl9IHNlY29uZHMgYWdvYDtcbiAgICAgIGlmIChtcyA8IDM2ZTUpIHJldHVybiBgJHtNYXRoLnJvdW5kKG1zIC8gNmU0KX0gbWludXRlcyBhZ29gO1xuICAgICAgaWYgKG1zIDwgODY0ZTUpIHJldHVybiBgJHtNYXRoLnJvdW5kKG1zIC8gMzZlNSl9IGhvdXJzIGFnb2A7XG4gICAgICBpZiAobXMgPCA2MDQ4ZTUpIHJldHVybiBgJHtNYXRoLnJvdW5kKG1zIC8gODY0ZTUpfSBkYXlzIGFnb2A7XG4gICAgICBpZiAobXMgPCAyNjI5OGU1KSByZXR1cm4gYCR7TWF0aC5yb3VuZChtcyAvIDYwNDhlNSl9IHdlZWtzIGFnb2A7XG4gICAgICBpZiAobXMgPCAzMTU1NzZlNSkgcmV0dXJuIGAke01hdGgucm91bmQobXMgLyAyNjI5OGU1KX0gbW9udGhzIGFnb2A7XG4gICAgICByZXR1cm4gYCR7TWF0aC5yb3VuZChtcyAvIDMxNTU3NmU1KX0geWVhcnMgYWdvYDtcbiAgICB9XG4gIH07XG4gIHJldHVybiB0aW1lO1xufTtcbmNvbnN0IHBhcnNlVGltZSA9ICh0aW1lKSA9PiB7XG4gIGNvbnN0IG1hdGNoID0gdGltZS5tYXRjaCgvXihcXGQrKShtc3xzfG18aHxkfHd8eSkkLyk7XG4gIGlmICghbWF0Y2gpIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgdGltZSBmb3JtYXRcIik7XG4gIHJldHVybiBjcmVhdGVUaW1lKHBhcnNlSW50KG1hdGNoWzFdKSwgbWF0Y2hbMl0pO1xufTtcblxuZnVuY3Rpb24gcGFyc2VTZXRDb29raWVIZWFkZXIoc2V0Q29va2llKSB7XG4gIGNvbnN0IGNvb2tpZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICBjb25zdCBjb29raWVBcnJheSA9IHNldENvb2tpZS5zcGxpdChcIiwgXCIpO1xuICBjb29raWVBcnJheS5mb3JFYWNoKChjb29raWVTdHJpbmcpID0+IHtcbiAgICBjb25zdCBwYXJ0cyA9IGNvb2tpZVN0cmluZy5zcGxpdChcIjtcIikubWFwKChwYXJ0KSA9PiBwYXJ0LnRyaW0oKSk7XG4gICAgY29uc3QgW25hbWVWYWx1ZSwgLi4uYXR0cmlidXRlc10gPSBwYXJ0cztcbiAgICBjb25zdCBbbmFtZSwgLi4udmFsdWVQYXJ0c10gPSBuYW1lVmFsdWUuc3BsaXQoXCI9XCIpO1xuICAgIGNvbnN0IHZhbHVlID0gdmFsdWVQYXJ0cy5qb2luKFwiPVwiKTtcbiAgICBpZiAoIW5hbWUgfHwgdmFsdWUgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBhdHRyT2JqID0geyB2YWx1ZSB9O1xuICAgIGF0dHJpYnV0ZXMuZm9yRWFjaCgoYXR0cmlidXRlKSA9PiB7XG4gICAgICBjb25zdCBbYXR0ck5hbWUsIC4uLmF0dHJWYWx1ZVBhcnRzXSA9IGF0dHJpYnV0ZS5zcGxpdChcIj1cIik7XG4gICAgICBjb25zdCBhdHRyVmFsdWUgPSBhdHRyVmFsdWVQYXJ0cy5qb2luKFwiPVwiKTtcbiAgICAgIGNvbnN0IG5vcm1hbGl6ZWRBdHRyTmFtZSA9IGF0dHJOYW1lLnRyaW0oKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgc3dpdGNoIChub3JtYWxpemVkQXR0ck5hbWUpIHtcbiAgICAgICAgY2FzZSBcIm1heC1hZ2VcIjpcbiAgICAgICAgICBhdHRyT2JqW1wibWF4LWFnZVwiXSA9IGF0dHJWYWx1ZSA/IHBhcnNlSW50KGF0dHJWYWx1ZS50cmltKCksIDEwKSA6IHZvaWQgMDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImV4cGlyZXNcIjpcbiAgICAgICAgICBhdHRyT2JqLmV4cGlyZXMgPSBhdHRyVmFsdWUgPyBuZXcgRGF0ZShhdHRyVmFsdWUudHJpbSgpKSA6IHZvaWQgMDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImRvbWFpblwiOlxuICAgICAgICAgIGF0dHJPYmouZG9tYWluID0gYXR0clZhbHVlID8gYXR0clZhbHVlLnRyaW0oKSA6IHZvaWQgMDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInBhdGhcIjpcbiAgICAgICAgICBhdHRyT2JqLnBhdGggPSBhdHRyVmFsdWUgPyBhdHRyVmFsdWUudHJpbSgpIDogdm9pZCAwO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwic2VjdXJlXCI6XG4gICAgICAgICAgYXR0ck9iai5zZWN1cmUgPSB0cnVlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiaHR0cG9ubHlcIjpcbiAgICAgICAgICBhdHRyT2JqLmh0dHBvbmx5ID0gdHJ1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInNhbWVzaXRlXCI6XG4gICAgICAgICAgYXR0ck9iai5zYW1lc2l0ZSA9IGF0dHJWYWx1ZSA/IGF0dHJWYWx1ZS50cmltKCkudG9Mb3dlckNhc2UoKSA6IHZvaWQgMDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBhdHRyT2JqW25vcm1hbGl6ZWRBdHRyTmFtZV0gPSBhdHRyVmFsdWUgPyBhdHRyVmFsdWUudHJpbSgpIDogdHJ1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9KTtcbiAgICBjb29raWVzLnNldChuYW1lLCBhdHRyT2JqKTtcbiAgfSk7XG4gIHJldHVybiBjb29raWVzO1xufVxuZnVuY3Rpb24gc2V0Q29va2llVG9IZWFkZXIoaGVhZGVycykge1xuICByZXR1cm4gKGNvbnRleHQpID0+IHtcbiAgICBjb25zdCBzZXRDb29raWVIZWFkZXIgPSBjb250ZXh0LnJlc3BvbnNlLmhlYWRlcnMuZ2V0KFwic2V0LWNvb2tpZVwiKTtcbiAgICBpZiAoIXNldENvb2tpZUhlYWRlcikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBjb29raWVNYXAgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICAgIGNvbnN0IGV4aXN0aW5nQ29va2llc0hlYWRlciA9IGhlYWRlcnMuZ2V0KFwiY29va2llXCIpIHx8IFwiXCI7XG4gICAgZXhpc3RpbmdDb29raWVzSGVhZGVyLnNwbGl0KFwiO1wiKS5mb3JFYWNoKChjb29raWUpID0+IHtcbiAgICAgIGNvbnN0IFtuYW1lLCAuLi5yZXN0XSA9IGNvb2tpZS50cmltKCkuc3BsaXQoXCI9XCIpO1xuICAgICAgaWYgKG5hbWUgJiYgcmVzdC5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvb2tpZU1hcC5zZXQobmFtZSwgcmVzdC5qb2luKFwiPVwiKSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgY29uc3Qgc2V0Q29va2llSGVhZGVycyA9IHNldENvb2tpZUhlYWRlci5zcGxpdChcIixcIik7XG4gICAgc2V0Q29va2llSGVhZGVycy5mb3JFYWNoKChoZWFkZXIpID0+IHtcbiAgICAgIGNvbnN0IGNvb2tpZXMgPSBwYXJzZVNldENvb2tpZUhlYWRlcihoZWFkZXIpO1xuICAgICAgY29va2llcy5mb3JFYWNoKCh2YWx1ZSwgbmFtZSkgPT4ge1xuICAgICAgICBjb29raWVNYXAuc2V0KG5hbWUsIHZhbHVlLnZhbHVlKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGNvbnN0IHVwZGF0ZWRDb29raWVzID0gQXJyYXkuZnJvbShjb29raWVNYXAuZW50cmllcygpKS5tYXAoKFtuYW1lLCB2YWx1ZV0pID0+IGAke25hbWV9PSR7dmFsdWV9YCkuam9pbihcIjsgXCIpO1xuICAgIGhlYWRlcnMuc2V0KFwiY29va2llXCIsIHVwZGF0ZWRDb29raWVzKTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlQ29va2llR2V0dGVyKG9wdGlvbnMpIHtcbiAgY29uc3Qgc2VjdXJlID0gb3B0aW9ucy5hZHZhbmNlZD8udXNlU2VjdXJlQ29va2llcyAhPT0gdm9pZCAwID8gb3B0aW9ucy5hZHZhbmNlZD8udXNlU2VjdXJlQ29va2llcyA6IG9wdGlvbnMuYmFzZVVSTCAhPT0gdm9pZCAwID8gb3B0aW9ucy5iYXNlVVJMLnN0YXJ0c1dpdGgoXCJodHRwczovL1wiKSA/IHRydWUgOiBmYWxzZSA6IGlzUHJvZHVjdGlvbjtcbiAgY29uc3Qgc2VjdXJlQ29va2llUHJlZml4ID0gc2VjdXJlID8gXCJfX1NlY3VyZS1cIiA6IFwiXCI7XG4gIGNvbnN0IGNyb3NzU3ViZG9tYWluRW5hYmxlZCA9ICEhb3B0aW9ucy5hZHZhbmNlZD8uY3Jvc3NTdWJEb21haW5Db29raWVzPy5lbmFibGVkO1xuICBjb25zdCBkb21haW4gPSBjcm9zc1N1YmRvbWFpbkVuYWJsZWQgPyBvcHRpb25zLmFkdmFuY2VkPy5jcm9zc1N1YkRvbWFpbkNvb2tpZXM/LmRvbWFpbiB8fCAob3B0aW9ucy5iYXNlVVJMID8gbmV3IFVSTChvcHRpb25zLmJhc2VVUkwpLmhvc3RuYW1lIDogdm9pZCAwKSA6IHZvaWQgMDtcbiAgaWYgKGNyb3NzU3ViZG9tYWluRW5hYmxlZCAmJiAhZG9tYWluKSB7XG4gICAgdGhyb3cgbmV3IEJldHRlckF1dGhFcnJvcihcbiAgICAgIFwiYmFzZVVSTCBpcyByZXF1aXJlZCB3aGVuIGNyb3NzU3ViZG9tYWluQ29va2llcyBhcmUgZW5hYmxlZFwiXG4gICAgKTtcbiAgfVxuICBmdW5jdGlvbiBjcmVhdGVDb29raWUoY29va2llTmFtZSwgb3ZlcnJpZGVBdHRyaWJ1dGVzID0ge30pIHtcbiAgICBjb25zdCBwcmVmaXggPSBvcHRpb25zLmFkdmFuY2VkPy5jb29raWVQcmVmaXggfHwgXCJiZXR0ZXItYXV0aFwiO1xuICAgIGNvbnN0IG5hbWUgPSBvcHRpb25zLmFkdmFuY2VkPy5jb29raWVzPy5bY29va2llTmFtZV0/Lm5hbWUgfHwgYCR7cHJlZml4fS4ke2Nvb2tpZU5hbWV9YDtcbiAgICBjb25zdCBhdHRyaWJ1dGVzID0gb3B0aW9ucy5hZHZhbmNlZD8uY29va2llcz8uW2Nvb2tpZU5hbWVdPy5hdHRyaWJ1dGVzO1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiBgJHtzZWN1cmVDb29raWVQcmVmaXh9JHtuYW1lfWAsXG4gICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgIHNlY3VyZTogISFzZWN1cmVDb29raWVQcmVmaXgsXG4gICAgICAgIHNhbWVTaXRlOiBcImxheFwiLFxuICAgICAgICBwYXRoOiBcIi9cIixcbiAgICAgICAgaHR0cE9ubHk6IHRydWUsXG4gICAgICAgIC4uLmNyb3NzU3ViZG9tYWluRW5hYmxlZCA/IHsgZG9tYWluIH0gOiB7fSxcbiAgICAgICAgLi4ub3B0aW9ucy5hZHZhbmNlZD8uZGVmYXVsdENvb2tpZUF0dHJpYnV0ZXMsXG4gICAgICAgIC4uLm92ZXJyaWRlQXR0cmlidXRlcyxcbiAgICAgICAgLi4uYXR0cmlidXRlc1xuICAgICAgfVxuICAgIH07XG4gIH1cbiAgcmV0dXJuIGNyZWF0ZUNvb2tpZTtcbn1cbmZ1bmN0aW9uIGdldENvb2tpZXMob3B0aW9ucykge1xuICBjb25zdCBjcmVhdGVDb29raWUgPSBjcmVhdGVDb29raWVHZXR0ZXIob3B0aW9ucyk7XG4gIGNvbnN0IHNlc3Npb25NYXhBZ2UgPSBvcHRpb25zLnNlc3Npb24/LmV4cGlyZXNJbiB8fCBjcmVhdGVUaW1lKDcsIFwiZFwiKS50b1NlY29uZHMoKTtcbiAgY29uc3Qgc2Vzc2lvblRva2VuID0gY3JlYXRlQ29va2llKFwic2Vzc2lvbl90b2tlblwiLCB7XG4gICAgbWF4QWdlOiBzZXNzaW9uTWF4QWdlXG4gIH0pO1xuICBjb25zdCBzZXNzaW9uRGF0YSA9IGNyZWF0ZUNvb2tpZShcInNlc3Npb25fZGF0YVwiLCB7XG4gICAgbWF4QWdlOiBvcHRpb25zLnNlc3Npb24/LmNvb2tpZUNhY2hlPy5tYXhBZ2UgfHwgNjAgKiA1XG4gIH0pO1xuICBjb25zdCBkb250UmVtZW1iZXJUb2tlbiA9IGNyZWF0ZUNvb2tpZShcImRvbnRfcmVtZW1iZXJcIik7XG4gIHJldHVybiB7XG4gICAgc2Vzc2lvblRva2VuOiB7XG4gICAgICBuYW1lOiBzZXNzaW9uVG9rZW4ubmFtZSxcbiAgICAgIG9wdGlvbnM6IHNlc3Npb25Ub2tlbi5hdHRyaWJ1dGVzXG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBUaGlzIGNvb2tpZSBpcyB1c2VkIHRvIHN0b3JlIHRoZSBzZXNzaW9uIGRhdGEgaW4gdGhlIGNvb2tpZVxuICAgICAqIFRoaXMgaXMgdXNlZnVsIGZvciB3aGVuIHlvdSB3YW50IHRvIGNhY2hlIHRoZSBzZXNzaW9uIGluIHRoZSBjb29raWVcbiAgICAgKi9cbiAgICBzZXNzaW9uRGF0YToge1xuICAgICAgbmFtZTogc2Vzc2lvbkRhdGEubmFtZSxcbiAgICAgIG9wdGlvbnM6IHNlc3Npb25EYXRhLmF0dHJpYnV0ZXNcbiAgICB9LFxuICAgIGRvbnRSZW1lbWJlclRva2VuOiB7XG4gICAgICBuYW1lOiBkb250UmVtZW1iZXJUb2tlbi5uYW1lLFxuICAgICAgb3B0aW9uczogZG9udFJlbWVtYmVyVG9rZW4uYXR0cmlidXRlc1xuICAgIH1cbiAgfTtcbn1cbmFzeW5jIGZ1bmN0aW9uIHNldENvb2tpZUNhY2hlKGN0eCwgc2Vzc2lvbikge1xuICBjb25zdCBzaG91bGRTdG9yZVNlc3Npb25EYXRhSW5Db29raWUgPSBjdHguY29udGV4dC5vcHRpb25zLnNlc3Npb24/LmNvb2tpZUNhY2hlPy5lbmFibGVkO1xuICBpZiAoc2hvdWxkU3RvcmVTZXNzaW9uRGF0YUluQ29va2llKSB7XG4gICAgY29uc3QgZmlsdGVyZWRTZXNzaW9uID0gT2JqZWN0LmVudHJpZXMoc2Vzc2lvbi5zZXNzaW9uKS5yZWR1Y2UoXG4gICAgICAoYWNjLCBba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgICAgY29uc3QgZmllbGRDb25maWcgPSBjdHguY29udGV4dC5vcHRpb25zLnNlc3Npb24/LmFkZGl0aW9uYWxGaWVsZHM/LltrZXldO1xuICAgICAgICBpZiAoIWZpZWxkQ29uZmlnIHx8IGZpZWxkQ29uZmlnLnJldHVybmVkICE9PSBmYWxzZSkge1xuICAgICAgICAgIGFjY1trZXldID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgIH0sXG4gICAgICB7fVxuICAgICk7XG4gICAgY29uc3Qgc2Vzc2lvbkRhdGEgPSB7IHNlc3Npb246IGZpbHRlcmVkU2Vzc2lvbiwgdXNlcjogc2Vzc2lvbi51c2VyIH07XG4gICAgY29uc3QgZXhwaXJlc0F0RGF0ZSA9IGdldERhdGUoXG4gICAgICBjdHguY29udGV4dC5hdXRoQ29va2llcy5zZXNzaW9uRGF0YS5vcHRpb25zLm1heEFnZSB8fCA2MCxcbiAgICAgIFwic2VjXCJcbiAgICApLmdldFRpbWUoKTtcbiAgICBjb25zdCBkYXRhID0gYmFzZTY0VXJsLmVuY29kZShcbiAgICAgIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgc2Vzc2lvbjogc2Vzc2lvbkRhdGEsXG4gICAgICAgIGV4cGlyZXNBdDogZXhwaXJlc0F0RGF0ZSxcbiAgICAgICAgc2lnbmF0dXJlOiBhd2FpdCBjcmVhdGVITUFDKFwiU0hBLTI1NlwiLCBcImJhc2U2NHVybG5vcGFkXCIpLnNpZ24oXG4gICAgICAgICAgY3R4LmNvbnRleHQuc2VjcmV0LFxuICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgIC4uLnNlc3Npb25EYXRhLFxuICAgICAgICAgICAgZXhwaXJlc0F0OiBleHBpcmVzQXREYXRlXG4gICAgICAgICAgfSlcbiAgICAgICAgKVxuICAgICAgfSksXG4gICAgICB7XG4gICAgICAgIHBhZGRpbmc6IGZhbHNlXG4gICAgICB9XG4gICAgKTtcbiAgICBpZiAoZGF0YS5sZW5ndGggPiA0MDkzKSB7XG4gICAgICB0aHJvdyBuZXcgQmV0dGVyQXV0aEVycm9yKFxuICAgICAgICBcIlNlc3Npb24gZGF0YSBpcyB0b28gbGFyZ2UgdG8gc3RvcmUgaW4gdGhlIGNvb2tpZS4gUGxlYXNlIGRpc2FibGUgc2Vzc2lvbiBjb29raWUgY2FjaGluZyBvciByZWR1Y2UgdGhlIHNpemUgb2YgdGhlIHNlc3Npb24gZGF0YVwiXG4gICAgICApO1xuICAgIH1cbiAgICBjdHguc2V0Q29va2llKFxuICAgICAgY3R4LmNvbnRleHQuYXV0aENvb2tpZXMuc2Vzc2lvbkRhdGEubmFtZSxcbiAgICAgIGRhdGEsXG4gICAgICBjdHguY29udGV4dC5hdXRoQ29va2llcy5zZXNzaW9uRGF0YS5vcHRpb25zXG4gICAgKTtcbiAgfVxufVxuYXN5bmMgZnVuY3Rpb24gc2V0U2Vzc2lvbkNvb2tpZShjdHgsIHNlc3Npb24sIGRvbnRSZW1lbWJlck1lLCBvdmVycmlkZXMpIHtcbiAgY29uc3QgZG9udFJlbWVtYmVyTWVDb29raWUgPSBhd2FpdCBjdHguZ2V0U2lnbmVkQ29va2llKFxuICAgIGN0eC5jb250ZXh0LmF1dGhDb29raWVzLmRvbnRSZW1lbWJlclRva2VuLm5hbWUsXG4gICAgY3R4LmNvbnRleHQuc2VjcmV0XG4gICk7XG4gIGRvbnRSZW1lbWJlck1lID0gZG9udFJlbWVtYmVyTWUgIT09IHZvaWQgMCA/IGRvbnRSZW1lbWJlck1lIDogISFkb250UmVtZW1iZXJNZUNvb2tpZTtcbiAgY29uc3Qgb3B0aW9ucyA9IGN0eC5jb250ZXh0LmF1dGhDb29raWVzLnNlc3Npb25Ub2tlbi5vcHRpb25zO1xuICBjb25zdCBtYXhBZ2UgPSBkb250UmVtZW1iZXJNZSA/IHZvaWQgMCA6IGN0eC5jb250ZXh0LnNlc3Npb25Db25maWcuZXhwaXJlc0luO1xuICBhd2FpdCBjdHguc2V0U2lnbmVkQ29va2llKFxuICAgIGN0eC5jb250ZXh0LmF1dGhDb29raWVzLnNlc3Npb25Ub2tlbi5uYW1lLFxuICAgIHNlc3Npb24uc2Vzc2lvbi50b2tlbixcbiAgICBjdHguY29udGV4dC5zZWNyZXQsXG4gICAge1xuICAgICAgLi4ub3B0aW9ucyxcbiAgICAgIG1heEFnZSxcbiAgICAgIC4uLm92ZXJyaWRlc1xuICAgIH1cbiAgKTtcbiAgaWYgKGRvbnRSZW1lbWJlck1lKSB7XG4gICAgYXdhaXQgY3R4LnNldFNpZ25lZENvb2tpZShcbiAgICAgIGN0eC5jb250ZXh0LmF1dGhDb29raWVzLmRvbnRSZW1lbWJlclRva2VuLm5hbWUsXG4gICAgICBcInRydWVcIixcbiAgICAgIGN0eC5jb250ZXh0LnNlY3JldCxcbiAgICAgIGN0eC5jb250ZXh0LmF1dGhDb29raWVzLmRvbnRSZW1lbWJlclRva2VuLm9wdGlvbnNcbiAgICApO1xuICB9XG4gIGF3YWl0IHNldENvb2tpZUNhY2hlKGN0eCwgc2Vzc2lvbik7XG4gIGN0eC5jb250ZXh0LnNldE5ld1Nlc3Npb24oc2Vzc2lvbik7XG4gIGlmIChjdHguY29udGV4dC5vcHRpb25zLnNlY29uZGFyeVN0b3JhZ2UpIHtcbiAgICBhd2FpdCBjdHguY29udGV4dC5zZWNvbmRhcnlTdG9yYWdlPy5zZXQoXG4gICAgICBzZXNzaW9uLnNlc3Npb24udG9rZW4sXG4gICAgICBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIHVzZXI6IHNlc3Npb24udXNlcixcbiAgICAgICAgc2Vzc2lvbjogc2Vzc2lvbi5zZXNzaW9uXG4gICAgICB9KSxcbiAgICAgIE1hdGguZmxvb3IoXG4gICAgICAgIChuZXcgRGF0ZShzZXNzaW9uLnNlc3Npb24uZXhwaXJlc0F0KS5nZXRUaW1lKCkgLSBEYXRlLm5vdygpKSAvIDFlM1xuICAgICAgKVxuICAgICk7XG4gIH1cbn1cbmZ1bmN0aW9uIGRlbGV0ZVNlc3Npb25Db29raWUoY3R4LCBza2lwRG9udFJlbWVtYmVyTWUpIHtcbiAgY3R4LnNldENvb2tpZShjdHguY29udGV4dC5hdXRoQ29va2llcy5zZXNzaW9uVG9rZW4ubmFtZSwgXCJcIiwge1xuICAgIC4uLmN0eC5jb250ZXh0LmF1dGhDb29raWVzLnNlc3Npb25Ub2tlbi5vcHRpb25zLFxuICAgIG1heEFnZTogMFxuICB9KTtcbiAgY3R4LnNldENvb2tpZShjdHguY29udGV4dC5hdXRoQ29va2llcy5zZXNzaW9uRGF0YS5uYW1lLCBcIlwiLCB7XG4gICAgLi4uY3R4LmNvbnRleHQuYXV0aENvb2tpZXMuc2Vzc2lvbkRhdGEub3B0aW9ucyxcbiAgICBtYXhBZ2U6IDBcbiAgfSk7XG4gIGlmICghc2tpcERvbnRSZW1lbWJlck1lKSB7XG4gICAgY3R4LnNldENvb2tpZShjdHguY29udGV4dC5hdXRoQ29va2llcy5kb250UmVtZW1iZXJUb2tlbi5uYW1lLCBcIlwiLCB7XG4gICAgICAuLi5jdHguY29udGV4dC5hdXRoQ29va2llcy5kb250UmVtZW1iZXJUb2tlbi5vcHRpb25zLFxuICAgICAgbWF4QWdlOiAwXG4gICAgfSk7XG4gIH1cbn1cbmZ1bmN0aW9uIHBhcnNlQ29va2llcyhjb29raWVIZWFkZXIpIHtcbiAgY29uc3QgY29va2llcyA9IGNvb2tpZUhlYWRlci5zcGxpdChcIjsgXCIpO1xuICBjb25zdCBjb29raWVNYXAgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpO1xuICBjb29raWVzLmZvckVhY2goKGNvb2tpZSkgPT4ge1xuICAgIGNvbnN0IFtuYW1lLCB2YWx1ZV0gPSBjb29raWUuc3BsaXQoXCI9XCIpO1xuICAgIGNvb2tpZU1hcC5zZXQobmFtZSwgdmFsdWUpO1xuICB9KTtcbiAgcmV0dXJuIGNvb2tpZU1hcDtcbn1cbmNvbnN0IGdldFNlc3Npb25Db29raWUgPSAocmVxdWVzdCwgY29uZmlnKSA9PiB7XG4gIGlmIChjb25maWc/LmNvb2tpZVByZWZpeCkge1xuICAgIGlmIChjb25maWcuY29va2llTmFtZSkge1xuICAgICAgY29uZmlnLmNvb2tpZVByZWZpeCA9IGAke2NvbmZpZy5jb29raWVQcmVmaXh9LWA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbmZpZy5jb29raWVQcmVmaXggPSBgJHtjb25maWcuY29va2llUHJlZml4fS5gO1xuICAgIH1cbiAgfVxuICBjb25zdCBoZWFkZXJzID0gXCJoZWFkZXJzXCIgaW4gcmVxdWVzdCA/IHJlcXVlc3QuaGVhZGVycyA6IHJlcXVlc3Q7XG4gIGNvbnN0IHJlcSA9IHJlcXVlc3QgaW5zdGFuY2VvZiBSZXF1ZXN0ID8gcmVxdWVzdCA6IHZvaWQgMDtcbiAgZ2V0QmFzZVVSTChyZXE/LnVybCwgY29uZmlnPy5wYXRoLCByZXEpO1xuICBjb25zdCBjb29raWVzID0gaGVhZGVycy5nZXQoXCJjb29raWVcIik7XG4gIGlmICghY29va2llcykge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIGNvbnN0IHsgY29va2llTmFtZSA9IFwic2Vzc2lvbl90b2tlblwiLCBjb29raWVQcmVmaXggPSBcImJldHRlci1hdXRoLlwiIH0gPSBjb25maWcgfHwge307XG4gIGNvbnN0IG5hbWUgPSBgJHtjb29raWVQcmVmaXh9JHtjb29raWVOYW1lfWA7XG4gIGNvbnN0IHNlY3VyZUNvb2tpZU5hbWUgPSBgX19TZWN1cmUtJHtuYW1lfWA7XG4gIGNvbnN0IHBhcnNlZENvb2tpZSA9IHBhcnNlQ29va2llcyhjb29raWVzKTtcbiAgY29uc3Qgc2Vzc2lvblRva2VuID0gcGFyc2VkQ29va2llLmdldChuYW1lKSB8fCBwYXJzZWRDb29raWUuZ2V0KHNlY3VyZUNvb2tpZU5hbWUpO1xuICBpZiAoc2Vzc2lvblRva2VuKSB7XG4gICAgcmV0dXJuIHNlc3Npb25Ub2tlbjtcbiAgfVxuICByZXR1cm4gbnVsbDtcbn07XG5jb25zdCBnZXRDb29raWVDYWNoZSA9IGFzeW5jIChyZXF1ZXN0LCBjb25maWcpID0+IHtcbiAgY29uc3QgaGVhZGVycyA9IHJlcXVlc3QgaW5zdGFuY2VvZiBIZWFkZXJzID8gcmVxdWVzdCA6IHJlcXVlc3QuaGVhZGVycztcbiAgY29uc3QgY29va2llcyA9IGhlYWRlcnMuZ2V0KFwiY29va2llXCIpO1xuICBpZiAoIWNvb2tpZXMpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBjb25zdCB7IGNvb2tpZU5hbWUgPSBcInNlc3Npb25fZGF0YVwiLCBjb29raWVQcmVmaXggPSBcImJldHRlci1hdXRoXCIgfSA9IGNvbmZpZyB8fCB7fTtcbiAgY29uc3QgbmFtZSA9IGNvbmZpZz8uaXNTZWN1cmUgIT09IHZvaWQgMCA/IGNvbmZpZy5pc1NlY3VyZSA/IGBfX1NlY3VyZS0ke2Nvb2tpZVByZWZpeH0uJHtjb29raWVOYW1lfWAgOiBgJHtjb29raWVQcmVmaXh9LiR7Y29va2llTmFtZX1gIDogaXNQcm9kdWN0aW9uID8gYF9fU2VjdXJlLSR7Y29va2llUHJlZml4fS4ke2Nvb2tpZU5hbWV9YCA6IGAke2Nvb2tpZVByZWZpeH0uJHtjb29raWVOYW1lfWA7XG4gIGNvbnN0IHBhcnNlZENvb2tpZSA9IHBhcnNlQ29va2llcyhjb29raWVzKTtcbiAgY29uc3Qgc2Vzc2lvbkRhdGEgPSBwYXJzZWRDb29raWUuZ2V0KG5hbWUpO1xuICBpZiAoc2Vzc2lvbkRhdGEpIHtcbiAgICBjb25zdCBzZXNzaW9uRGF0YVBheWxvYWQgPSBzYWZlSlNPTlBhcnNlKGJpbmFyeS5kZWNvZGUoYmFzZTY0VXJsLmRlY29kZShzZXNzaW9uRGF0YSkpKTtcbiAgICBpZiAoIXNlc3Npb25EYXRhUGF5bG9hZCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IHNlY3JldCA9IGNvbmZpZz8uc2VjcmV0IHx8IGVudi5CRVRURVJfQVVUSF9TRUNSRVQ7XG4gICAgaWYgKCFzZWNyZXQpIHtcbiAgICAgIHRocm93IG5ldyBCZXR0ZXJBdXRoRXJyb3IoXG4gICAgICAgIFwiZ2V0Q29va2llQ2FjaGUgcmVxdWlyZXMgYSBzZWNyZXQgdG8gYmUgcHJvdmlkZWQuIEVpdGhlciBwYXNzIGl0IGFzIGFuIG9wdGlvbiBvciBzZXQgdGhlIEJFVFRFUl9BVVRIX1NFQ1JFVCBlbnZpcm9ubWVudCB2YXJpYWJsZVwiXG4gICAgICApO1xuICAgIH1cbiAgICBjb25zdCBpc1ZhbGlkID0gYXdhaXQgY3JlYXRlSE1BQyhcIlNIQS0yNTZcIiwgXCJiYXNlNjR1cmxub3BhZFwiKS52ZXJpZnkoXG4gICAgICBzZWNyZXQsXG4gICAgICBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIC4uLnNlc3Npb25EYXRhUGF5bG9hZC5zZXNzaW9uLFxuICAgICAgICBleHBpcmVzQXQ6IHNlc3Npb25EYXRhUGF5bG9hZC5leHBpcmVzQXRcbiAgICAgIH0pLFxuICAgICAgc2Vzc2lvbkRhdGFQYXlsb2FkLnNpZ25hdHVyZVxuICAgICk7XG4gICAgaWYgKCFpc1ZhbGlkKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIHNlc3Npb25EYXRhUGF5bG9hZC5zZXNzaW9uO1xuICB9XG4gIHJldHVybiBudWxsO1xufTtcblxuZXhwb3J0IHsgY3JlYXRlQ29va2llR2V0dGVyLCBkZWxldGVTZXNzaW9uQ29va2llLCBnZXRDb29raWVDYWNoZSwgZ2V0Q29va2llcywgZ2V0U2Vzc2lvbkNvb2tpZSwgcGFyc2VDb29raWVzLCBwYXJzZVNldENvb2tpZUhlYWRlciwgc2V0Q29va2llQ2FjaGUsIHNldENvb2tpZVRvSGVhZGVyLCBzZXRTZXNzaW9uQ29va2llIH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/cookies/index.mjs\n");

/***/ }),

/***/ "(action-browser)/../../node_modules/better-auth/dist/crypto/index.mjs":
/*!************************************************************!*\
  !*** ../../node_modules/better-auth/dist/crypto/index.mjs ***!
  \************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   compareHash: () => (/* binding */ compareHash),\n/* harmony export */   constantTimeEqual: () => (/* binding */ constantTimeEqual),\n/* harmony export */   generateRandomString: () => (/* reexport safe */ _shared_better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_4__.g),\n/* harmony export */   hashPassword: () => (/* binding */ hashPassword),\n/* harmony export */   hashToBase64: () => (/* binding */ hashToBase64),\n/* harmony export */   signJWT: () => (/* binding */ signJWT),\n/* harmony export */   symmetricDecrypt: () => (/* binding */ symmetricDecrypt),\n/* harmony export */   symmetricEncrypt: () => (/* binding */ symmetricEncrypt),\n/* harmony export */   verifyPassword: () => (/* binding */ verifyPassword)\n/* harmony export */ });\n/* harmony import */ var _better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @better-auth/utils/hash */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/hash.mjs\");\n/* harmony import */ var _noble_ciphers_chacha__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @noble/ciphers/chacha */ \"(action-browser)/../../node_modules/@noble/ciphers/esm/chacha.js\");\n/* harmony import */ var _noble_ciphers_utils__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @noble/ciphers/utils */ \"(action-browser)/../../node_modules/@noble/ciphers/esm/utils.js\");\n/* harmony import */ var _noble_ciphers_webcrypto__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @noble/ciphers/webcrypto */ \"(action-browser)/../../node_modules/@noble/ciphers/esm/webcrypto.js\");\n/* harmony import */ var _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @better-auth/utils/base64 */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/base64.mjs\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! jose */ \"(action-browser)/../../node_modules/jose/dist/node/esm/jwt/sign.js\");\n/* harmony import */ var _noble_hashes_scrypt__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @noble/hashes/scrypt */ \"(action-browser)/../../node_modules/@noble/hashes/esm/scrypt.js\");\n/* harmony import */ var _better_auth_utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @better-auth/utils */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/index.mjs\");\n/* harmony import */ var _better_auth_utils_hex__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @better-auth/utils/hex */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/hex.mjs\");\n/* harmony import */ var _noble_hashes_utils__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @noble/hashes/utils */ \"(action-browser)/../../node_modules/@noble/hashes/esm/utils.js\");\n/* harmony import */ var _shared_better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../shared/better-auth.B4Qoxdgc.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs\");\n/* harmony import */ var _better_auth_utils_random__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @better-auth/utils/random */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/random.mjs\");\n\n\n\n\n\n\n\n\n\n\n\n\n\nasync function signJWT(payload, secret, expiresIn = 3600) {\n  const jwt = await new jose__WEBPACK_IMPORTED_MODULE_6__.SignJWT(payload).setProtectedHeader({ alg: \"HS256\" }).setIssuedAt().setExpirationTime(Math.floor(Date.now() / 1e3) + expiresIn).sign(new TextEncoder().encode(secret));\n  return jwt;\n}\n\nfunction constantTimeEqual(a, b) {\n  const aBuffer = new Uint8Array(a);\n  const bBuffer = new Uint8Array(b);\n  if (aBuffer.length !== bBuffer.length) {\n    return false;\n  }\n  let c = 0;\n  for (let i = 0; i < aBuffer.length; i++) {\n    c |= aBuffer[i] ^ bBuffer[i];\n  }\n  return c === 0;\n}\n\nasync function hashToBase64(data) {\n  const buffer = await (0,_better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_0__.createHash)(\"SHA-256\").digest(data);\n  return _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_1__.base64.encode(buffer);\n}\nasync function compareHash(data, hash) {\n  const buffer = await (0,_better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_0__.createHash)(\"SHA-256\").digest(\n    typeof data === \"string\" ? new TextEncoder().encode(data) : data\n  );\n  const hashBuffer = _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_1__.base64.decode(hash);\n  return constantTimeEqual(buffer, hashBuffer);\n}\n\nconst config = {\n  N: 16384,\n  r: 16,\n  p: 1,\n  dkLen: 64\n};\nasync function generateKey(password, salt) {\n  return await (0,_noble_hashes_scrypt__WEBPACK_IMPORTED_MODULE_7__.scryptAsync)(password.normalize(\"NFKC\"), salt, {\n    N: config.N,\n    p: config.p,\n    r: config.r,\n    dkLen: config.dkLen,\n    maxmem: 128 * config.N * config.r * 2\n  });\n}\nconst hashPassword = async (password) => {\n  const salt = _better_auth_utils_hex__WEBPACK_IMPORTED_MODULE_3__.hex.encode((0,_better_auth_utils__WEBPACK_IMPORTED_MODULE_2__.getRandomValues)(new Uint8Array(16)));\n  const key = await generateKey(password, salt);\n  return `${salt}:${_better_auth_utils_hex__WEBPACK_IMPORTED_MODULE_3__.hex.encode(key)}`;\n};\nconst verifyPassword = async ({\n  hash,\n  password\n}) => {\n  const [salt, key] = hash.split(\":\");\n  const targetKey = await generateKey(password, salt);\n  return constantTimeEqual(targetKey, (0,_noble_hashes_utils__WEBPACK_IMPORTED_MODULE_8__.hexToBytes)(key));\n};\n\nconst symmetricEncrypt = async ({\n  key,\n  data\n}) => {\n  const keyAsBytes = await (0,_better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_0__.createHash)(\"SHA-256\").digest(key);\n  const dataAsBytes = (0,_noble_ciphers_utils__WEBPACK_IMPORTED_MODULE_9__.utf8ToBytes)(data);\n  const chacha = (0,_noble_ciphers_webcrypto__WEBPACK_IMPORTED_MODULE_10__.managedNonce)(_noble_ciphers_chacha__WEBPACK_IMPORTED_MODULE_11__.xchacha20poly1305)(new Uint8Array(keyAsBytes));\n  return (0,_noble_ciphers_utils__WEBPACK_IMPORTED_MODULE_9__.bytesToHex)(chacha.encrypt(dataAsBytes));\n};\nconst symmetricDecrypt = async ({\n  key,\n  data\n}) => {\n  const keyAsBytes = await (0,_better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_0__.createHash)(\"SHA-256\").digest(key);\n  const dataAsBytes = (0,_noble_ciphers_utils__WEBPACK_IMPORTED_MODULE_9__.hexToBytes)(data);\n  const chacha = (0,_noble_ciphers_webcrypto__WEBPACK_IMPORTED_MODULE_10__.managedNonce)(_noble_ciphers_chacha__WEBPACK_IMPORTED_MODULE_11__.xchacha20poly1305)(new Uint8Array(keyAsBytes));\n  return new TextDecoder().decode(chacha.decrypt(dataAsBytes));\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9jcnlwdG8vaW5kZXgubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFxRDtBQUNLO0FBQ2lDO0FBQ25DO0FBQ0w7QUFDcEI7QUFDb0I7QUFDRTtBQUNSO0FBQ0k7QUFDOEI7QUFDNUM7O0FBRW5DO0FBQ0Esd0JBQXdCLHlDQUFPLCtCQUErQixjQUFjO0FBQzVFO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0Isb0JBQW9CO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsdUJBQXVCLG1FQUFVO0FBQ2pDLFNBQVMsNkRBQU07QUFDZjtBQUNBO0FBQ0EsdUJBQXVCLG1FQUFVO0FBQ2pDO0FBQ0E7QUFDQSxxQkFBcUIsNkRBQU07QUFDM0I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsaUVBQVc7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsZUFBZSx1REFBRyxRQUFRLG1FQUFlO0FBQ3pDO0FBQ0EsWUFBWSxLQUFLLEdBQUcsdURBQUcsYUFBYTtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0Esc0NBQXNDLCtEQUFVO0FBQ2hEOztBQUVBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRCwyQkFBMkIsbUVBQVU7QUFDckMsc0JBQXNCLGlFQUFXO0FBQ2pDLGlCQUFpQix1RUFBWSxDQUFDLHFFQUFpQjtBQUMvQyxTQUFTLGdFQUFVO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNELDJCQUEyQixtRUFBVTtBQUNyQyxzQkFBc0IsZ0VBQVk7QUFDbEMsaUJBQWlCLHVFQUFZLENBQUMscUVBQWlCO0FBQy9DO0FBQ0E7O0FBRW1JIiwic291cmNlcyI6WyIvVXNlcnMvbWlsYW4vRGVza3RvcC9BcHBzL2JldHRlci1hdXRoL25vZGVfbW9kdWxlcy9iZXR0ZXItYXV0aC9kaXN0L2NyeXB0by9pbmRleC5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlSGFzaCB9IGZyb20gJ0BiZXR0ZXItYXV0aC91dGlscy9oYXNoJztcbmltcG9ydCB7IHhjaGFjaGEyMHBvbHkxMzA1IH0gZnJvbSAnQG5vYmxlL2NpcGhlcnMvY2hhY2hhJztcbmltcG9ydCB7IHV0ZjhUb0J5dGVzLCBieXRlc1RvSGV4LCBoZXhUb0J5dGVzIGFzIGhleFRvQnl0ZXMkMSB9IGZyb20gJ0Bub2JsZS9jaXBoZXJzL3V0aWxzJztcbmltcG9ydCB7IG1hbmFnZWROb25jZSB9IGZyb20gJ0Bub2JsZS9jaXBoZXJzL3dlYmNyeXB0byc7XG5pbXBvcnQgeyBiYXNlNjQgfSBmcm9tICdAYmV0dGVyLWF1dGgvdXRpbHMvYmFzZTY0JztcbmltcG9ydCB7IFNpZ25KV1QgfSBmcm9tICdqb3NlJztcbmltcG9ydCB7IHNjcnlwdEFzeW5jIH0gZnJvbSAnQG5vYmxlL2hhc2hlcy9zY3J5cHQnO1xuaW1wb3J0IHsgZ2V0UmFuZG9tVmFsdWVzIH0gZnJvbSAnQGJldHRlci1hdXRoL3V0aWxzJztcbmltcG9ydCB7IGhleCB9IGZyb20gJ0BiZXR0ZXItYXV0aC91dGlscy9oZXgnO1xuaW1wb3J0IHsgaGV4VG9CeXRlcyB9IGZyb20gJ0Bub2JsZS9oYXNoZXMvdXRpbHMnO1xuZXhwb3J0IHsgZyBhcyBnZW5lcmF0ZVJhbmRvbVN0cmluZyB9IGZyb20gJy4uL3NoYXJlZC9iZXR0ZXItYXV0aC5CNFFveGRnYy5tanMnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMvcmFuZG9tJztcblxuYXN5bmMgZnVuY3Rpb24gc2lnbkpXVChwYXlsb2FkLCBzZWNyZXQsIGV4cGlyZXNJbiA9IDM2MDApIHtcbiAgY29uc3Qgand0ID0gYXdhaXQgbmV3IFNpZ25KV1QocGF5bG9hZCkuc2V0UHJvdGVjdGVkSGVhZGVyKHsgYWxnOiBcIkhTMjU2XCIgfSkuc2V0SXNzdWVkQXQoKS5zZXRFeHBpcmF0aW9uVGltZShNYXRoLmZsb29yKERhdGUubm93KCkgLyAxZTMpICsgZXhwaXJlc0luKS5zaWduKG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShzZWNyZXQpKTtcbiAgcmV0dXJuIGp3dDtcbn1cblxuZnVuY3Rpb24gY29uc3RhbnRUaW1lRXF1YWwoYSwgYikge1xuICBjb25zdCBhQnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoYSk7XG4gIGNvbnN0IGJCdWZmZXIgPSBuZXcgVWludDhBcnJheShiKTtcbiAgaWYgKGFCdWZmZXIubGVuZ3RoICE9PSBiQnVmZmVyLmxlbmd0aCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBsZXQgYyA9IDA7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYUJ1ZmZlci5sZW5ndGg7IGkrKykge1xuICAgIGMgfD0gYUJ1ZmZlcltpXSBeIGJCdWZmZXJbaV07XG4gIH1cbiAgcmV0dXJuIGMgPT09IDA7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGhhc2hUb0Jhc2U2NChkYXRhKSB7XG4gIGNvbnN0IGJ1ZmZlciA9IGF3YWl0IGNyZWF0ZUhhc2goXCJTSEEtMjU2XCIpLmRpZ2VzdChkYXRhKTtcbiAgcmV0dXJuIGJhc2U2NC5lbmNvZGUoYnVmZmVyKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGNvbXBhcmVIYXNoKGRhdGEsIGhhc2gpIHtcbiAgY29uc3QgYnVmZmVyID0gYXdhaXQgY3JlYXRlSGFzaChcIlNIQS0yNTZcIikuZGlnZXN0KFxuICAgIHR5cGVvZiBkYXRhID09PSBcInN0cmluZ1wiID8gbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKGRhdGEpIDogZGF0YVxuICApO1xuICBjb25zdCBoYXNoQnVmZmVyID0gYmFzZTY0LmRlY29kZShoYXNoKTtcbiAgcmV0dXJuIGNvbnN0YW50VGltZUVxdWFsKGJ1ZmZlciwgaGFzaEJ1ZmZlcik7XG59XG5cbmNvbnN0IGNvbmZpZyA9IHtcbiAgTjogMTYzODQsXG4gIHI6IDE2LFxuICBwOiAxLFxuICBka0xlbjogNjRcbn07XG5hc3luYyBmdW5jdGlvbiBnZW5lcmF0ZUtleShwYXNzd29yZCwgc2FsdCkge1xuICByZXR1cm4gYXdhaXQgc2NyeXB0QXN5bmMocGFzc3dvcmQubm9ybWFsaXplKFwiTkZLQ1wiKSwgc2FsdCwge1xuICAgIE46IGNvbmZpZy5OLFxuICAgIHA6IGNvbmZpZy5wLFxuICAgIHI6IGNvbmZpZy5yLFxuICAgIGRrTGVuOiBjb25maWcuZGtMZW4sXG4gICAgbWF4bWVtOiAxMjggKiBjb25maWcuTiAqIGNvbmZpZy5yICogMlxuICB9KTtcbn1cbmNvbnN0IGhhc2hQYXNzd29yZCA9IGFzeW5jIChwYXNzd29yZCkgPT4ge1xuICBjb25zdCBzYWx0ID0gaGV4LmVuY29kZShnZXRSYW5kb21WYWx1ZXMobmV3IFVpbnQ4QXJyYXkoMTYpKSk7XG4gIGNvbnN0IGtleSA9IGF3YWl0IGdlbmVyYXRlS2V5KHBhc3N3b3JkLCBzYWx0KTtcbiAgcmV0dXJuIGAke3NhbHR9OiR7aGV4LmVuY29kZShrZXkpfWA7XG59O1xuY29uc3QgdmVyaWZ5UGFzc3dvcmQgPSBhc3luYyAoe1xuICBoYXNoLFxuICBwYXNzd29yZFxufSkgPT4ge1xuICBjb25zdCBbc2FsdCwga2V5XSA9IGhhc2guc3BsaXQoXCI6XCIpO1xuICBjb25zdCB0YXJnZXRLZXkgPSBhd2FpdCBnZW5lcmF0ZUtleShwYXNzd29yZCwgc2FsdCk7XG4gIHJldHVybiBjb25zdGFudFRpbWVFcXVhbCh0YXJnZXRLZXksIGhleFRvQnl0ZXMoa2V5KSk7XG59O1xuXG5jb25zdCBzeW1tZXRyaWNFbmNyeXB0ID0gYXN5bmMgKHtcbiAga2V5LFxuICBkYXRhXG59KSA9PiB7XG4gIGNvbnN0IGtleUFzQnl0ZXMgPSBhd2FpdCBjcmVhdGVIYXNoKFwiU0hBLTI1NlwiKS5kaWdlc3Qoa2V5KTtcbiAgY29uc3QgZGF0YUFzQnl0ZXMgPSB1dGY4VG9CeXRlcyhkYXRhKTtcbiAgY29uc3QgY2hhY2hhID0gbWFuYWdlZE5vbmNlKHhjaGFjaGEyMHBvbHkxMzA1KShuZXcgVWludDhBcnJheShrZXlBc0J5dGVzKSk7XG4gIHJldHVybiBieXRlc1RvSGV4KGNoYWNoYS5lbmNyeXB0KGRhdGFBc0J5dGVzKSk7XG59O1xuY29uc3Qgc3ltbWV0cmljRGVjcnlwdCA9IGFzeW5jICh7XG4gIGtleSxcbiAgZGF0YVxufSkgPT4ge1xuICBjb25zdCBrZXlBc0J5dGVzID0gYXdhaXQgY3JlYXRlSGFzaChcIlNIQS0yNTZcIikuZGlnZXN0KGtleSk7XG4gIGNvbnN0IGRhdGFBc0J5dGVzID0gaGV4VG9CeXRlcyQxKGRhdGEpO1xuICBjb25zdCBjaGFjaGEgPSBtYW5hZ2VkTm9uY2UoeGNoYWNoYTIwcG9seTEzMDUpKG5ldyBVaW50OEFycmF5KGtleUFzQnl0ZXMpKTtcbiAgcmV0dXJuIG5ldyBUZXh0RGVjb2RlcigpLmRlY29kZShjaGFjaGEuZGVjcnlwdChkYXRhQXNCeXRlcykpO1xufTtcblxuZXhwb3J0IHsgY29tcGFyZUhhc2gsIGNvbnN0YW50VGltZUVxdWFsLCBoYXNoUGFzc3dvcmQsIGhhc2hUb0Jhc2U2NCwgc2lnbkpXVCwgc3ltbWV0cmljRGVjcnlwdCwgc3ltbWV0cmljRW5jcnlwdCwgdmVyaWZ5UGFzc3dvcmQgfTtcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/crypto/index.mjs\n");

/***/ }),

/***/ "(action-browser)/../../node_modules/better-auth/dist/index.mjs":
/*!*****************************************************!*\
  !*** ../../node_modules/better-auth/dist/index.mjs ***!
  \*****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BetterAuthError: () => (/* reexport safe */ _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_1__.B),\n/* harmony export */   HIDE_METADATA: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_3__.H),\n/* harmony export */   MissingDependencyError: () => (/* reexport safe */ _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_1__.M),\n/* harmony export */   betterAuth: () => (/* reexport safe */ _shared_better_auth_Cbhy6WDJ_mjs__WEBPACK_IMPORTED_MODULE_0__.b),\n/* harmony export */   capitalizeFirstLetter: () => (/* reexport safe */ _shared_better_auth_D_2CmEwz_mjs__WEBPACK_IMPORTED_MODULE_2__.c),\n/* harmony export */   createLogger: () => (/* reexport safe */ _shared_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_4__.c),\n/* harmony export */   generateId: () => (/* reexport safe */ _shared_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_4__.g),\n/* harmony export */   generateState: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_3__.g),\n/* harmony export */   levels: () => (/* reexport safe */ _shared_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_4__.l),\n/* harmony export */   logger: () => (/* reexport safe */ _shared_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_4__.a),\n/* harmony export */   parseState: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_3__.p),\n/* harmony export */   shouldPublishLog: () => (/* reexport safe */ _shared_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_4__.s)\n/* harmony export */ });\n/* harmony import */ var _shared_better_auth_Cbhy6WDJ_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./shared/better-auth.Cbhy6WDJ.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.Cbhy6WDJ.mjs\");\n/* harmony import */ var _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./shared/better-auth.DdzSJf-n.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs\");\n/* harmony import */ var _shared_better_auth_D_2CmEwz_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./shared/better-auth.D-2CmEwz.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.D-2CmEwz.mjs\");\n/* harmony import */ var _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./shared/better-auth.z3dsxLxE.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.z3dsxLxE.mjs\");\n/* harmony import */ var _shared_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./shared/better-auth.DBGfIDnh.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DBGfIDnh.mjs\");\n/* harmony import */ var _api_index_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./api/index.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/api/index.mjs\");\n/* harmony import */ var better_call__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! better-call */ \"(action-browser)/../../node_modules/better-call/dist/index.js\");\n/* harmony import */ var _cookies_index_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./cookies/index.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/cookies/index.mjs\");\n/* harmony import */ var _shared_better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./shared/better-auth.CW6D9eSx.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.CW6D9eSx.mjs\");\n/* harmony import */ var _shared_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./shared/better-auth.8zoxzg-F.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs\");\n/* harmony import */ var _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @better-auth/utils/base64 */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/base64.mjs\");\n/* harmony import */ var _better_auth_utils_hmac__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @better-auth/utils/hmac */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/hmac.mjs\");\n/* harmony import */ var _shared_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./shared/better-auth.tB5eU6EY.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.tB5eU6EY.mjs\");\n/* harmony import */ var _shared_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./shared/better-auth.VTXNLFMT.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.VTXNLFMT.mjs\");\n/* harmony import */ var _better_auth_utils_binary__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @better-auth/utils/binary */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/binary.mjs\");\n/* harmony import */ var _shared_better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./shared/better-auth.n2KFGwjY.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.n2KFGwjY.mjs\");\n/* harmony import */ var _shared_better_auth_DcfNPS8q_mjs__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./shared/better-auth.DcfNPS8q.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DcfNPS8q.mjs\");\n/* harmony import */ var defu__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! defu */ \"(action-browser)/../../node_modules/defu/dist/defu.mjs\");\n/* harmony import */ var _crypto_index_mjs__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./crypto/index.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/crypto/index.mjs\");\n/* harmony import */ var _better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! @better-auth/utils/hash */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/hash.mjs\");\n/* harmony import */ var _better_auth_utils__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! @better-auth/utils */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/index.mjs\");\n/* harmony import */ var _better_auth_utils_hex__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @better-auth/utils/hex */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/hex.mjs\");\n/* harmony import */ var _shared_better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./shared/better-auth.B4Qoxdgc.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs\");\n/* harmony import */ var _better_auth_utils_random__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! @better-auth/utils/random */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/random.mjs\");\n/* harmony import */ var _shared_better_auth_ByruPN9q_mjs__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./shared/better-auth.ByruPN9q.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.ByruPN9q.mjs\");\n/* harmony import */ var _shared_better_auth_DORkW_Ge_mjs__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./shared/better-auth.DORkW_Ge.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DORkW_Ge.mjs\");\n/* harmony import */ var _shared_better_auth_DwzM_9N1_mjs__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./shared/better-auth.DwzM-9N1.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DwzM-9N1.mjs\");\n/* harmony import */ var _shared_better_auth_gBl3F_xa_mjs__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./shared/better-auth.gBl3F_xa.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.gBl3F_xa.mjs\");\n/* harmony import */ var _shared_better_auth_DGpadpzN_mjs__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./shared/better-auth.DGpadpzN.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DGpadpzN.mjs\");\n/* harmony import */ var _shared_better_auth_YwDQhoPc_mjs__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./shared/better-auth.YwDQhoPc.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.YwDQhoPc.mjs\");\n/* harmony import */ var _better_fetch_fetch__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! @better-fetch/fetch */ \"(action-browser)/../../node_modules/@better-fetch/fetch/dist/index.js\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9pbmRleC5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFvRTtBQUNrQztBQUN2QjtBQUM2QjtBQUM0QjtBQUMvRztBQUNKO0FBQ0w7QUFDYTtBQUNjO0FBQ0E7QUFDUjtBQUNGO0FBQ1U7QUFDQTtBQUNSO0FBQ1E7QUFDQTtBQUM3QjtBQUNjO0FBQ0s7QUFDRjtBQUNEO0FBQ0k7QUFDcEI7QUFDZ0I7QUFDRjtBQUNJO0FBQ0g7QUFDYztBQUNSO0FBQ1E7QUFDQTtBQUNBO0FBQzNCO0FBQzJCO0FBQ0E7QUFDQTtBQUNkO0FBQ1IiLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWxhbi9EZXNrdG9wL0FwcHMvYmV0dGVyLWF1dGgvbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3QvaW5kZXgubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCB7IGIgYXMgYmV0dGVyQXV0aCB9IGZyb20gJy4vc2hhcmVkL2JldHRlci1hdXRoLkNiaHk2V0RKLm1qcyc7XG5leHBvcnQgeyBCIGFzIEJldHRlckF1dGhFcnJvciwgTSBhcyBNaXNzaW5nRGVwZW5kZW5jeUVycm9yIH0gZnJvbSAnLi9zaGFyZWQvYmV0dGVyLWF1dGguRGR6U0pmLW4ubWpzJztcbmV4cG9ydCB7IGMgYXMgY2FwaXRhbGl6ZUZpcnN0TGV0dGVyIH0gZnJvbSAnLi9zaGFyZWQvYmV0dGVyLWF1dGguRC0yQ21Fd3oubWpzJztcbmV4cG9ydCB7IEggYXMgSElERV9NRVRBREFUQSwgZyBhcyBnZW5lcmF0ZVN0YXRlLCBwIGFzIHBhcnNlU3RhdGUgfSBmcm9tICcuL3NoYXJlZC9iZXR0ZXItYXV0aC56M2RzeEx4RS5tanMnO1xuZXhwb3J0IHsgYyBhcyBjcmVhdGVMb2dnZXIsIGcgYXMgZ2VuZXJhdGVJZCwgbCBhcyBsZXZlbHMsIGEgYXMgbG9nZ2VyLCBzIGFzIHNob3VsZFB1Ymxpc2hMb2cgfSBmcm9tICcuL3NoYXJlZC9iZXR0ZXItYXV0aC5EQkdmSURuaC5tanMnO1xuaW1wb3J0ICcuL2FwaS9pbmRleC5tanMnO1xuaW1wb3J0ICdiZXR0ZXItY2FsbCc7XG5pbXBvcnQgJ3pvZC92NCc7XG5pbXBvcnQgJy4vY29va2llcy9pbmRleC5tanMnO1xuaW1wb3J0ICcuL3NoYXJlZC9iZXR0ZXItYXV0aC5DVzZEOWVTeC5tanMnO1xuaW1wb3J0ICcuL3NoYXJlZC9iZXR0ZXItYXV0aC44em94emctRi5tanMnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMvYmFzZTY0JztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzL2htYWMnO1xuaW1wb3J0ICcuL3NoYXJlZC9iZXR0ZXItYXV0aC50QjVlVTZFWS5tanMnO1xuaW1wb3J0ICcuL3NoYXJlZC9iZXR0ZXItYXV0aC5WVFhOTEZNVC5tanMnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMvYmluYXJ5JztcbmltcG9ydCAnLi9zaGFyZWQvYmV0dGVyLWF1dGgubjJLRkd3alkubWpzJztcbmltcG9ydCAnLi9zaGFyZWQvYmV0dGVyLWF1dGguRGNmTlBTOHEubWpzJztcbmltcG9ydCAnZGVmdSc7XG5pbXBvcnQgJy4vY3J5cHRvL2luZGV4Lm1qcyc7XG5pbXBvcnQgJ0BiZXR0ZXItYXV0aC91dGlscy9oYXNoJztcbmltcG9ydCAnQG5vYmxlL2NpcGhlcnMvY2hhY2hhJztcbmltcG9ydCAnQG5vYmxlL2NpcGhlcnMvdXRpbHMnO1xuaW1wb3J0ICdAbm9ibGUvY2lwaGVycy93ZWJjcnlwdG8nO1xuaW1wb3J0ICdqb3NlJztcbmltcG9ydCAnQG5vYmxlL2hhc2hlcy9zY3J5cHQnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMvaGV4JztcbmltcG9ydCAnQG5vYmxlL2hhc2hlcy91dGlscyc7XG5pbXBvcnQgJy4vc2hhcmVkL2JldHRlci1hdXRoLkI0UW94ZGdjLm1qcyc7XG5pbXBvcnQgJ0BiZXR0ZXItYXV0aC91dGlscy9yYW5kb20nO1xuaW1wb3J0ICcuL3NoYXJlZC9iZXR0ZXItYXV0aC5CeXJ1UE45cS5tanMnO1xuaW1wb3J0ICcuL3NoYXJlZC9iZXR0ZXItYXV0aC5ET1JrV19HZS5tanMnO1xuaW1wb3J0ICcuL3NoYXJlZC9iZXR0ZXItYXV0aC5Ed3pNLTlOMS5tanMnO1xuaW1wb3J0ICdreXNlbHknO1xuaW1wb3J0ICcuL3NoYXJlZC9iZXR0ZXItYXV0aC5nQmwzRl94YS5tanMnO1xuaW1wb3J0ICcuL3NoYXJlZC9iZXR0ZXItYXV0aC5ER3BhZHB6Ti5tanMnO1xuaW1wb3J0ICcuL3NoYXJlZC9iZXR0ZXItYXV0aC5Zd0RRaG9QYy5tanMnO1xuaW1wb3J0ICdAYmV0dGVyLWZldGNoL2ZldGNoJztcbmltcG9ydCAnam9zZS9lcnJvcnMnO1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/index.mjs\n");

/***/ }),

/***/ "(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   a: () => (/* binding */ isProduction),\n/* harmony export */   b: () => (/* binding */ isDevelopment),\n/* harmony export */   e: () => (/* binding */ env),\n/* harmony export */   i: () => (/* binding */ isTest)\n/* harmony export */ });\nconst _envShim = /* @__PURE__ */ Object.create(null);\nconst _getEnv = (useShim) => globalThis.process?.env || //@ts-expect-error\nglobalThis.Deno?.env.toObject() || //@ts-expect-error\nglobalThis.__env__ || (useShim ? _envShim : globalThis);\nconst env = new Proxy(_envShim, {\n  get(_, prop) {\n    const env2 = _getEnv();\n    return env2[prop] ?? _envShim[prop];\n  },\n  has(_, prop) {\n    const env2 = _getEnv();\n    return prop in env2 || prop in _envShim;\n  },\n  set(_, prop, value) {\n    const env2 = _getEnv(true);\n    env2[prop] = value;\n    return true;\n  },\n  deleteProperty(_, prop) {\n    if (!prop) {\n      return false;\n    }\n    const env2 = _getEnv(true);\n    delete env2[prop];\n    return true;\n  },\n  ownKeys() {\n    const env2 = _getEnv(true);\n    return Object.keys(env2);\n  }\n});\nfunction toBoolean(val) {\n  return val ? val !== \"false\" : false;\n}\nconst nodeENV = typeof process !== \"undefined\" && process.env && \"development\" || \"\";\nconst isProduction = nodeENV === \"production\";\nconst isDevelopment = nodeENV === \"dev\" || nodeENV === \"development\";\nconst isTest = nodeENV === \"test\" || toBoolean(env.TEST);\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguOHpveHpnLUYubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxpRUFBaUUsYUFBb0I7QUFDckY7QUFDQTtBQUNBOztBQUV3RSIsInNvdXJjZXMiOlsiL1VzZXJzL21pbGFuL0Rlc2t0b3AvQXBwcy9iZXR0ZXItYXV0aC9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguOHpveHpnLUYubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IF9lbnZTaGltID0gLyogQF9fUFVSRV9fICovIE9iamVjdC5jcmVhdGUobnVsbCk7XG5jb25zdCBfZ2V0RW52ID0gKHVzZVNoaW0pID0+IGdsb2JhbFRoaXMucHJvY2Vzcz8uZW52IHx8IC8vQHRzLWV4cGVjdC1lcnJvclxuZ2xvYmFsVGhpcy5EZW5vPy5lbnYudG9PYmplY3QoKSB8fCAvL0B0cy1leHBlY3QtZXJyb3Jcbmdsb2JhbFRoaXMuX19lbnZfXyB8fCAodXNlU2hpbSA/IF9lbnZTaGltIDogZ2xvYmFsVGhpcyk7XG5jb25zdCBlbnYgPSBuZXcgUHJveHkoX2VudlNoaW0sIHtcbiAgZ2V0KF8sIHByb3ApIHtcbiAgICBjb25zdCBlbnYyID0gX2dldEVudigpO1xuICAgIHJldHVybiBlbnYyW3Byb3BdID8/IF9lbnZTaGltW3Byb3BdO1xuICB9LFxuICBoYXMoXywgcHJvcCkge1xuICAgIGNvbnN0IGVudjIgPSBfZ2V0RW52KCk7XG4gICAgcmV0dXJuIHByb3AgaW4gZW52MiB8fCBwcm9wIGluIF9lbnZTaGltO1xuICB9LFxuICBzZXQoXywgcHJvcCwgdmFsdWUpIHtcbiAgICBjb25zdCBlbnYyID0gX2dldEVudih0cnVlKTtcbiAgICBlbnYyW3Byb3BdID0gdmFsdWU7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0sXG4gIGRlbGV0ZVByb3BlcnR5KF8sIHByb3ApIHtcbiAgICBpZiAoIXByb3ApIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgZW52MiA9IF9nZXRFbnYodHJ1ZSk7XG4gICAgZGVsZXRlIGVudjJbcHJvcF07XG4gICAgcmV0dXJuIHRydWU7XG4gIH0sXG4gIG93bktleXMoKSB7XG4gICAgY29uc3QgZW52MiA9IF9nZXRFbnYodHJ1ZSk7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKGVudjIpO1xuICB9XG59KTtcbmZ1bmN0aW9uIHRvQm9vbGVhbih2YWwpIHtcbiAgcmV0dXJuIHZhbCA/IHZhbCAhPT0gXCJmYWxzZVwiIDogZmFsc2U7XG59XG5jb25zdCBub2RlRU5WID0gdHlwZW9mIHByb2Nlc3MgIT09IFwidW5kZWZpbmVkXCIgJiYgcHJvY2Vzcy5lbnYgJiYgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgfHwgXCJcIjtcbmNvbnN0IGlzUHJvZHVjdGlvbiA9IG5vZGVFTlYgPT09IFwicHJvZHVjdGlvblwiO1xuY29uc3QgaXNEZXZlbG9wbWVudCA9IG5vZGVFTlYgPT09IFwiZGV2XCIgfHwgbm9kZUVOViA9PT0gXCJkZXZlbG9wbWVudFwiO1xuY29uc3QgaXNUZXN0ID0gbm9kZUVOViA9PT0gXCJ0ZXN0XCIgfHwgdG9Cb29sZWFuKGVudi5URVNUKTtcblxuZXhwb3J0IHsgaXNQcm9kdWN0aW9uIGFzIGEsIGlzRGV2ZWxvcG1lbnQgYXMgYiwgZW52IGFzIGUsIGlzVGVzdCBhcyBpIH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs\n");

/***/ }),

/***/ "(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   g: () => (/* binding */ generateRandomString)\n/* harmony export */ });\n/* harmony import */ var _better_auth_utils_random__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @better-auth/utils/random */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/random.mjs\");\n\n\nconst generateRandomString = (0,_better_auth_utils_random__WEBPACK_IMPORTED_MODULE_0__.createRandomStringGenerator)(\n  \"a-z\",\n  \"0-9\",\n  \"A-Z\",\n  \"-_\"\n);\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguQjRRb3hkZ2MubWpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQXdFOztBQUV4RSw2QkFBNkIsc0ZBQTJCO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRXFDIiwic291cmNlcyI6WyIvVXNlcnMvbWlsYW4vRGVza3RvcC9BcHBzL2JldHRlci1hdXRoL25vZGVfbW9kdWxlcy9iZXR0ZXItYXV0aC9kaXN0L3NoYXJlZC9iZXR0ZXItYXV0aC5CNFFveGRnYy5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlUmFuZG9tU3RyaW5nR2VuZXJhdG9yIH0gZnJvbSAnQGJldHRlci1hdXRoL3V0aWxzL3JhbmRvbSc7XG5cbmNvbnN0IGdlbmVyYXRlUmFuZG9tU3RyaW5nID0gY3JlYXRlUmFuZG9tU3RyaW5nR2VuZXJhdG9yKFxuICBcImEtelwiLFxuICBcIjAtOVwiLFxuICBcIkEtWlwiLFxuICBcIi1fXCJcbik7XG5cbmV4cG9ydCB7IGdlbmVyYXRlUmFuZG9tU3RyaW5nIGFzIGcgfTtcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs\n");

/***/ }),

/***/ "(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.ByruPN9q.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.ByruPN9q.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   a: () => (/* binding */ getAdapter),\n/* harmony export */   b: () => (/* binding */ convertToDB),\n/* harmony export */   c: () => (/* binding */ createInternalAdapter),\n/* harmony export */   d: () => (/* binding */ convertFromDB),\n/* harmony export */   e: () => (/* binding */ getMigrations),\n/* harmony export */   f: () => (/* binding */ getSchema),\n/* harmony export */   g: () => (/* binding */ getWithHooks),\n/* harmony export */   m: () => (/* binding */ matchType)\n/* harmony export */ });\n/* harmony import */ var _better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./better-auth.CW6D9eSx.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.CW6D9eSx.mjs\");\n/* harmony import */ var _better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./better-auth.n2KFGwjY.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.n2KFGwjY.mjs\");\n/* harmony import */ var _better_auth_DcfNPS8q_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./better-auth.DcfNPS8q.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DcfNPS8q.mjs\");\n/* harmony import */ var _better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./better-auth.tB5eU6EY.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.tB5eU6EY.mjs\");\n/* harmony import */ var _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./better-auth.DBGfIDnh.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DBGfIDnh.mjs\");\n/* harmony import */ var better_call__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! better-call */ \"(action-browser)/../../node_modules/better-call/dist/index.js\");\n/* harmony import */ var _better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @better-auth/utils/hash */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/hash.mjs\");\n/* harmony import */ var _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @better-auth/utils/base64 */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/base64.mjs\");\n/* harmony import */ var _better_auth_utils__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @better-auth/utils */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/index.mjs\");\n/* harmony import */ var _better_auth_utils_hex__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @better-auth/utils/hex */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/hex.mjs\");\n/* harmony import */ var _better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./better-auth.B4Qoxdgc.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs\");\n/* harmony import */ var _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./better-auth.8zoxzg-F.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs\");\n/* harmony import */ var _better_auth_utils_random__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @better-auth/utils/random */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/random.mjs\");\n/* harmony import */ var _better_auth_DORkW_Ge_mjs__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./better-auth.DORkW_Ge.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DORkW_Ge.mjs\");\n/* harmony import */ var _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./better-auth.DdzSJf-n.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs\");\n/* harmony import */ var _better_auth_DwzM_9N1_mjs__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./better-auth.DwzM-9N1.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DwzM-9N1.mjs\");\n/* harmony import */ var _better_auth_DGpadpzN_mjs__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./better-auth.DGpadpzN.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DGpadpzN.mjs\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction getWithHooks(adapter, ctx) {\n  const hooks = ctx.hooks;\n  async function createWithHooks(data, model, customCreateFn, context) {\n    let actualData = data;\n    for (const hook of hooks || []) {\n      const toRun = hook[model]?.create?.before;\n      if (toRun) {\n        const result = await toRun(actualData, context);\n        if (result === false) {\n          return null;\n        }\n        const isObject = typeof result === \"object\" && \"data\" in result;\n        if (isObject) {\n          actualData = {\n            ...actualData,\n            ...result.data\n          };\n        }\n      }\n    }\n    const customCreated = customCreateFn ? await customCreateFn.fn(actualData) : null;\n    const created = !customCreateFn || customCreateFn.executeMainFn ? await adapter.create({\n      model,\n      data: actualData,\n      forceAllowId: true\n    }) : customCreated;\n    for (const hook of hooks || []) {\n      const toRun = hook[model]?.create?.after;\n      if (toRun) {\n        await toRun(created, context);\n      }\n    }\n    return created;\n  }\n  async function updateWithHooks(data, where, model, customUpdateFn, context) {\n    let actualData = data;\n    for (const hook of hooks || []) {\n      const toRun = hook[model]?.update?.before;\n      if (toRun) {\n        const result = await toRun(data, context);\n        if (result === false) {\n          return null;\n        }\n        const isObject = typeof result === \"object\";\n        actualData = isObject ? result.data : result;\n      }\n    }\n    const customUpdated = customUpdateFn ? await customUpdateFn.fn(actualData) : null;\n    const updated = !customUpdateFn || customUpdateFn.executeMainFn ? await adapter.update({\n      model,\n      update: actualData,\n      where\n    }) : customUpdated;\n    for (const hook of hooks || []) {\n      const toRun = hook[model]?.update?.after;\n      if (toRun) {\n        await toRun(updated, context);\n      }\n    }\n    return updated;\n  }\n  async function updateManyWithHooks(data, where, model, customUpdateFn, context) {\n    let actualData = data;\n    for (const hook of hooks || []) {\n      const toRun = hook[model]?.update?.before;\n      if (toRun) {\n        const result = await toRun(data, context);\n        if (result === false) {\n          return null;\n        }\n        const isObject = typeof result === \"object\";\n        actualData = isObject ? result.data : result;\n      }\n    }\n    const customUpdated = customUpdateFn ? await customUpdateFn.fn(actualData) : null;\n    const updated = !customUpdateFn || customUpdateFn.executeMainFn ? await adapter.updateMany({\n      model,\n      update: actualData,\n      where\n    }) : customUpdated;\n    for (const hook of hooks || []) {\n      const toRun = hook[model]?.update?.after;\n      if (toRun) {\n        await toRun(updated, context);\n      }\n    }\n    return updated;\n  }\n  return {\n    createWithHooks,\n    updateWithHooks,\n    updateManyWithHooks\n  };\n}\n\nconst createInternalAdapter = (adapter, ctx) => {\n  const options = ctx.options;\n  const secondaryStorage = options.secondaryStorage;\n  const sessionExpiration = options.session?.expiresIn || 60 * 60 * 24 * 7;\n  const { createWithHooks, updateWithHooks, updateManyWithHooks } = getWithHooks(adapter, ctx);\n  return {\n    createOAuthUser: async (user, account, context) => {\n      const createdUser = await createWithHooks(\n        {\n          createdAt: /* @__PURE__ */ new Date(),\n          updatedAt: /* @__PURE__ */ new Date(),\n          ...user\n        },\n        \"user\",\n        void 0,\n        context\n      );\n      const createdAccount = await createWithHooks(\n        {\n          ...account,\n          userId: createdUser.id || user.id,\n          createdAt: /* @__PURE__ */ new Date(),\n          updatedAt: /* @__PURE__ */ new Date()\n        },\n        \"account\",\n        void 0,\n        context\n      );\n      return {\n        user: createdUser,\n        account: createdAccount\n      };\n    },\n    createUser: async (user, context) => {\n      const createdUser = await createWithHooks(\n        {\n          createdAt: /* @__PURE__ */ new Date(),\n          updatedAt: /* @__PURE__ */ new Date(),\n          emailVerified: false,\n          ...user,\n          email: user.email?.toLowerCase()\n        },\n        \"user\",\n        void 0,\n        context\n      );\n      return createdUser;\n    },\n    createAccount: async (account, context) => {\n      const createdAccount = await createWithHooks(\n        {\n          createdAt: /* @__PURE__ */ new Date(),\n          updatedAt: /* @__PURE__ */ new Date(),\n          ...account\n        },\n        \"account\",\n        void 0,\n        context\n      );\n      return createdAccount;\n    },\n    listSessions: async (userId) => {\n      if (secondaryStorage) {\n        const currentList = await secondaryStorage.get(\n          `active-sessions-${userId}`\n        );\n        if (!currentList) return [];\n        const list = (0,_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_3__.s)(currentList) || [];\n        const now = Date.now();\n        const validSessions = list.filter((s) => s.expiresAt > now);\n        const sessions2 = [];\n        for (const session of validSessions) {\n          const sessionStringified = await secondaryStorage.get(session.token);\n          if (sessionStringified) {\n            const s = JSON.parse(sessionStringified);\n            const parsedSession = (0,_better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_1__.d)(ctx.options, {\n              ...s.session,\n              expiresAt: new Date(s.session.expiresAt)\n            });\n            sessions2.push(parsedSession);\n          }\n        }\n        return sessions2;\n      }\n      const sessions = await adapter.findMany({\n        model: \"session\",\n        where: [\n          {\n            field: \"userId\",\n            value: userId\n          }\n        ]\n      });\n      return sessions;\n    },\n    listUsers: async (limit, offset, sortBy, where) => {\n      const users = await adapter.findMany({\n        model: \"user\",\n        limit,\n        offset,\n        sortBy,\n        where\n      });\n      return users;\n    },\n    countTotalUsers: async (where) => {\n      const total = await adapter.count({\n        model: \"user\",\n        where\n      });\n      if (typeof total === \"string\") {\n        return parseInt(total);\n      }\n      return total;\n    },\n    deleteUser: async (userId) => {\n      if (secondaryStorage) {\n        await secondaryStorage.delete(`active-sessions-${userId}`);\n      }\n      if (!secondaryStorage || options.session?.storeSessionInDatabase) {\n        await adapter.deleteMany({\n          model: \"session\",\n          where: [\n            {\n              field: \"userId\",\n              value: userId\n            }\n          ]\n        });\n      }\n      await adapter.deleteMany({\n        model: \"account\",\n        where: [\n          {\n            field: \"userId\",\n            value: userId\n          }\n        ]\n      });\n      await adapter.delete({\n        model: \"user\",\n        where: [\n          {\n            field: \"id\",\n            value: userId\n          }\n        ]\n      });\n    },\n    createSession: async (userId, ctx2, dontRememberMe, override, overrideAll) => {\n      const headers = ctx2.headers || ctx2.request?.headers;\n      const { id: _, ...rest } = override || {};\n      const data = {\n        ipAddress: ctx2.request || ctx2.headers ? (0,_better_auth_DcfNPS8q_mjs__WEBPACK_IMPORTED_MODULE_2__.g)(ctx2.request || ctx2.headers, ctx2.context.options) || \"\" : \"\",\n        userAgent: headers?.get(\"user-agent\") || \"\",\n        ...rest,\n        /**\n         * If the user doesn't want to be remembered\n         * set the session to expire in 1 day.\n         * The cookie will be set to expire at the end of the session\n         */\n        expiresAt: dontRememberMe ? (0,_better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_0__.g)(60 * 60 * 24, \"sec\") : (0,_better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_0__.g)(sessionExpiration, \"sec\"),\n        userId,\n        token: (0,_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_4__.g)(32),\n        createdAt: /* @__PURE__ */ new Date(),\n        updatedAt: /* @__PURE__ */ new Date(),\n        ...overrideAll ? rest : {}\n      };\n      const res = await createWithHooks(\n        data,\n        \"session\",\n        secondaryStorage ? {\n          fn: async (sessionData) => {\n            const currentList = await secondaryStorage.get(\n              `active-sessions-${userId}`\n            );\n            let list = [];\n            const now = Date.now();\n            if (currentList) {\n              list = (0,_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_3__.s)(currentList) || [];\n              list = list.filter((session) => session.expiresAt > now);\n            }\n            list.push({\n              token: data.token,\n              expiresAt: now + sessionExpiration * 1e3\n            });\n            await secondaryStorage.set(\n              `active-sessions-${userId}`,\n              JSON.stringify(list),\n              sessionExpiration\n            );\n            return sessionData;\n          },\n          executeMainFn: options.session?.storeSessionInDatabase\n        } : void 0,\n        ctx2\n      );\n      return res;\n    },\n    findSession: async (token) => {\n      if (secondaryStorage) {\n        const sessionStringified = await secondaryStorage.get(token);\n        if (!sessionStringified && !options.session?.storeSessionInDatabase) {\n          return null;\n        }\n        if (sessionStringified) {\n          const s = JSON.parse(sessionStringified);\n          const parsedSession2 = (0,_better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_1__.d)(ctx.options, {\n            ...s.session,\n            expiresAt: new Date(s.session.expiresAt),\n            createdAt: new Date(s.session.createdAt),\n            updatedAt: new Date(s.session.updatedAt)\n          });\n          const parsedUser2 = (0,_better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_1__.b)(ctx.options, {\n            ...s.user,\n            createdAt: new Date(s.user.createdAt),\n            updatedAt: new Date(s.user.updatedAt)\n          });\n          return {\n            session: parsedSession2,\n            user: parsedUser2\n          };\n        }\n      }\n      const session = await adapter.findOne({\n        model: \"session\",\n        where: [\n          {\n            value: token,\n            field: \"token\"\n          }\n        ]\n      });\n      if (!session) {\n        return null;\n      }\n      const user = await adapter.findOne({\n        model: \"user\",\n        where: [\n          {\n            value: session.userId,\n            field: \"id\"\n          }\n        ]\n      });\n      if (!user) {\n        return null;\n      }\n      const parsedSession = (0,_better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_1__.d)(ctx.options, session);\n      const parsedUser = (0,_better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_1__.b)(ctx.options, user);\n      return {\n        session: parsedSession,\n        user: parsedUser\n      };\n    },\n    findSessions: async (sessionTokens) => {\n      if (secondaryStorage) {\n        const sessions2 = [];\n        for (const sessionToken of sessionTokens) {\n          const sessionStringified = await secondaryStorage.get(sessionToken);\n          if (sessionStringified) {\n            const s = JSON.parse(sessionStringified);\n            const session = {\n              session: {\n                ...s.session,\n                expiresAt: new Date(s.session.expiresAt)\n              },\n              user: {\n                ...s.user,\n                createdAt: new Date(s.user.createdAt),\n                updatedAt: new Date(s.user.updatedAt)\n              }\n            };\n            sessions2.push(session);\n          }\n        }\n        return sessions2;\n      }\n      const sessions = await adapter.findMany({\n        model: \"session\",\n        where: [\n          {\n            field: \"token\",\n            value: sessionTokens,\n            operator: \"in\"\n          }\n        ]\n      });\n      const userIds = sessions.map((session) => {\n        return session.userId;\n      });\n      if (!userIds.length) return [];\n      const users = await adapter.findMany({\n        model: \"user\",\n        where: [\n          {\n            field: \"id\",\n            value: userIds,\n            operator: \"in\"\n          }\n        ]\n      });\n      return sessions.map((session) => {\n        const user = users.find((u) => u.id === session.userId);\n        if (!user) return null;\n        return {\n          session,\n          user\n        };\n      });\n    },\n    updateSession: async (sessionToken, session, context) => {\n      const updatedSession = await updateWithHooks(\n        session,\n        [{ field: \"token\", value: sessionToken }],\n        \"session\",\n        secondaryStorage ? {\n          async fn(data) {\n            const currentSession = await secondaryStorage.get(sessionToken);\n            let updatedSession2 = null;\n            if (currentSession) {\n              const parsedSession = JSON.parse(currentSession);\n              updatedSession2 = {\n                ...parsedSession.session,\n                ...data\n              };\n              return updatedSession2;\n            } else {\n              return null;\n            }\n          },\n          executeMainFn: options.session?.storeSessionInDatabase\n        } : void 0,\n        context\n      );\n      return updatedSession;\n    },\n    deleteSession: async (token) => {\n      if (secondaryStorage) {\n        await secondaryStorage.delete(token);\n        if (!options.session?.storeSessionInDatabase || ctx.options.session?.preserveSessionInDatabase) {\n          return;\n        }\n      }\n      await adapter.delete({\n        model: \"session\",\n        where: [\n          {\n            field: \"token\",\n            value: token\n          }\n        ]\n      });\n    },\n    deleteAccounts: async (userId) => {\n      await adapter.deleteMany({\n        model: \"account\",\n        where: [\n          {\n            field: \"userId\",\n            value: userId\n          }\n        ]\n      });\n    },\n    deleteAccount: async (accountId) => {\n      await adapter.delete({\n        model: \"account\",\n        where: [\n          {\n            field: \"id\",\n            value: accountId\n          }\n        ]\n      });\n    },\n    deleteSessions: async (userIdOrSessionTokens) => {\n      if (secondaryStorage) {\n        if (typeof userIdOrSessionTokens === \"string\") {\n          const activeSession = await secondaryStorage.get(\n            `active-sessions-${userIdOrSessionTokens}`\n          );\n          const sessions = activeSession ? (0,_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_3__.s)(activeSession) : [];\n          if (!sessions) return;\n          for (const session of sessions) {\n            await secondaryStorage.delete(session.token);\n          }\n        } else {\n          for (const sessionToken of userIdOrSessionTokens) {\n            const session = await secondaryStorage.get(sessionToken);\n            if (session) {\n              await secondaryStorage.delete(sessionToken);\n            }\n          }\n        }\n        if (!options.session?.storeSessionInDatabase || ctx.options.session?.preserveSessionInDatabase) {\n          return;\n        }\n      }\n      await adapter.deleteMany({\n        model: \"session\",\n        where: [\n          {\n            field: Array.isArray(userIdOrSessionTokens) ? \"token\" : \"userId\",\n            value: userIdOrSessionTokens,\n            operator: Array.isArray(userIdOrSessionTokens) ? \"in\" : void 0\n          }\n        ]\n      });\n    },\n    findOAuthUser: async (email, accountId, providerId) => {\n      const account = await adapter.findMany({\n        model: \"account\",\n        where: [\n          {\n            value: accountId,\n            field: \"accountId\"\n          }\n        ]\n      }).then((accounts) => {\n        return accounts.find((a) => a.providerId === providerId);\n      });\n      if (account) {\n        const user = await adapter.findOne({\n          model: \"user\",\n          where: [\n            {\n              value: account.userId,\n              field: \"id\"\n            }\n          ]\n        });\n        if (user) {\n          return {\n            user,\n            accounts: [account]\n          };\n        } else {\n          const user2 = await adapter.findOne({\n            model: \"user\",\n            where: [\n              {\n                value: email.toLowerCase(),\n                field: \"email\"\n              }\n            ]\n          });\n          if (user2) {\n            return {\n              user: user2,\n              accounts: [account]\n            };\n          }\n          return null;\n        }\n      } else {\n        const user = await adapter.findOne({\n          model: \"user\",\n          where: [\n            {\n              value: email.toLowerCase(),\n              field: \"email\"\n            }\n          ]\n        });\n        if (user) {\n          const accounts = await adapter.findMany({\n            model: \"account\",\n            where: [\n              {\n                value: user.id,\n                field: \"userId\"\n              }\n            ]\n          });\n          return {\n            user,\n            accounts: accounts || []\n          };\n        } else {\n          return null;\n        }\n      }\n    },\n    findUserByEmail: async (email, options2) => {\n      const user = await adapter.findOne({\n        model: \"user\",\n        where: [\n          {\n            value: email.toLowerCase(),\n            field: \"email\"\n          }\n        ]\n      });\n      if (!user) return null;\n      if (options2?.includeAccounts) {\n        const accounts = await adapter.findMany({\n          model: \"account\",\n          where: [\n            {\n              value: user.id,\n              field: \"userId\"\n            }\n          ]\n        });\n        return {\n          user,\n          accounts\n        };\n      }\n      return {\n        user,\n        accounts: []\n      };\n    },\n    findUserById: async (userId) => {\n      const user = await adapter.findOne({\n        model: \"user\",\n        where: [\n          {\n            field: \"id\",\n            value: userId\n          }\n        ]\n      });\n      return user;\n    },\n    linkAccount: async (account, context) => {\n      const _account = await createWithHooks(\n        {\n          ...account,\n          createdAt: /* @__PURE__ */ new Date(),\n          updatedAt: /* @__PURE__ */ new Date()\n        },\n        \"account\",\n        void 0,\n        context\n      );\n      return _account;\n    },\n    updateUser: async (userId, data, context) => {\n      const user = await updateWithHooks(\n        data,\n        [\n          {\n            field: \"id\",\n            value: userId\n          }\n        ],\n        \"user\",\n        void 0,\n        context\n      );\n      if (secondaryStorage && user) {\n        const listRaw = await secondaryStorage.get(`active-sessions-${userId}`);\n        if (listRaw) {\n          const now = Date.now();\n          const list = (0,_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_3__.s)(listRaw) || [];\n          const validSessions = list.filter((s) => s.expiresAt > now);\n          await Promise.all(\n            validSessions.map(async ({ token }) => {\n              const cached = await secondaryStorage.get(token);\n              if (!cached) return;\n              const parsed = (0,_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_3__.s)(cached);\n              if (!parsed) return;\n              const sessionTTL = Math.max(\n                Math.floor(\n                  (new Date(parsed.session.expiresAt).getTime() - now) / 1e3\n                ),\n                0\n              );\n              await secondaryStorage.set(\n                token,\n                JSON.stringify({\n                  session: parsed.session,\n                  user\n                }),\n                sessionTTL\n              );\n            })\n          );\n        }\n      }\n      return user;\n    },\n    updateUserByEmail: async (email, data, context) => {\n      const user = await updateWithHooks(\n        data,\n        [\n          {\n            field: \"email\",\n            value: email.toLowerCase()\n          }\n        ],\n        \"user\",\n        void 0,\n        context\n      );\n      return user;\n    },\n    updatePassword: async (userId, password, context) => {\n      await updateManyWithHooks(\n        {\n          password\n        },\n        [\n          {\n            field: \"userId\",\n            value: userId\n          },\n          {\n            field: \"providerId\",\n            value: \"credential\"\n          }\n        ],\n        \"account\",\n        void 0,\n        context\n      );\n    },\n    findAccounts: async (userId) => {\n      const accounts = await adapter.findMany({\n        model: \"account\",\n        where: [\n          {\n            field: \"userId\",\n            value: userId\n          }\n        ]\n      });\n      return accounts;\n    },\n    findAccount: async (accountId) => {\n      const account = await adapter.findOne({\n        model: \"account\",\n        where: [\n          {\n            field: \"accountId\",\n            value: accountId\n          }\n        ]\n      });\n      return account;\n    },\n    findAccountByProviderId: async (accountId, providerId) => {\n      const account = await adapter.findOne({\n        model: \"account\",\n        where: [\n          {\n            field: \"accountId\",\n            value: accountId\n          },\n          {\n            field: \"providerId\",\n            value: providerId\n          }\n        ]\n      });\n      return account;\n    },\n    findAccountByUserId: async (userId) => {\n      const account = await adapter.findMany({\n        model: \"account\",\n        where: [\n          {\n            field: \"userId\",\n            value: userId\n          }\n        ]\n      });\n      return account;\n    },\n    updateAccount: async (id, data, context) => {\n      const account = await updateWithHooks(\n        data,\n        [{ field: \"id\", value: id }],\n        \"account\",\n        void 0,\n        context\n      );\n      return account;\n    },\n    createVerificationValue: async (data, context) => {\n      const verification = await createWithHooks(\n        {\n          createdAt: /* @__PURE__ */ new Date(),\n          updatedAt: /* @__PURE__ */ new Date(),\n          ...data\n        },\n        \"verification\",\n        void 0,\n        context\n      );\n      return verification;\n    },\n    findVerificationValue: async (identifier) => {\n      const verification = await adapter.findMany({\n        model: \"verification\",\n        where: [\n          {\n            field: \"identifier\",\n            value: identifier\n          }\n        ],\n        sortBy: {\n          field: \"createdAt\",\n          direction: \"desc\"\n        },\n        limit: 1\n      });\n      if (!options.verification?.disableCleanup) {\n        await adapter.deleteMany({\n          model: \"verification\",\n          where: [\n            {\n              field: \"expiresAt\",\n              value: /* @__PURE__ */ new Date(),\n              operator: \"lt\"\n            }\n          ]\n        });\n      }\n      const lastVerification = verification[0];\n      return lastVerification;\n    },\n    deleteVerificationValue: async (id) => {\n      await adapter.delete({\n        model: \"verification\",\n        where: [\n          {\n            field: \"id\",\n            value: id\n          }\n        ]\n      });\n    },\n    deleteVerificationByIdentifier: async (identifier) => {\n      await adapter.delete({\n        model: \"verification\",\n        where: [\n          {\n            field: \"identifier\",\n            value: identifier\n          }\n        ]\n      });\n    },\n    updateVerificationValue: async (id, data, context) => {\n      const verification = await updateWithHooks(\n        data,\n        [{ field: \"id\", value: id }],\n        \"verification\",\n        void 0,\n        context\n      );\n      return verification;\n    }\n  };\n};\n\nasync function getAdapter(options) {\n  if (!options.database) {\n    const tables = (0,_better_auth_DORkW_Ge_mjs__WEBPACK_IMPORTED_MODULE_13__.g)(options);\n    const memoryDB = Object.keys(tables).reduce((acc, key) => {\n      acc[key] = [];\n      return acc;\n    }, {});\n    _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_4__.a.warn(\n      \"No database configuration provided. Using memory adapter in development\"\n    );\n    return (0,_better_auth_DGpadpzN_mjs__WEBPACK_IMPORTED_MODULE_16__.m)(memoryDB)(options);\n  }\n  if (typeof options.database === \"function\") {\n    return options.database(options);\n  }\n  const { kysely, databaseType } = await (0,_better_auth_DwzM_9N1_mjs__WEBPACK_IMPORTED_MODULE_15__.c)(options);\n  if (!kysely) {\n    throw new _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_14__.B(\"Failed to initialize database adapter\");\n  }\n  return (0,_better_auth_DwzM_9N1_mjs__WEBPACK_IMPORTED_MODULE_15__.k)(kysely, {\n    type: databaseType || \"sqlite\",\n    debugLogs: \"debugLogs\" in options.database ? options.database.debugLogs : false\n  })(options);\n}\nfunction convertToDB(fields, values) {\n  let result = values.id ? {\n    id: values.id\n  } : {};\n  for (const key in fields) {\n    const field = fields[key];\n    const value = values[key];\n    if (value === void 0) {\n      continue;\n    }\n    result[field.fieldName || key] = value;\n  }\n  return result;\n}\nfunction convertFromDB(fields, values) {\n  if (!values) {\n    return null;\n  }\n  let result = {\n    id: values.id\n  };\n  for (const [key, value] of Object.entries(fields)) {\n    result[key] = values[value.fieldName || key];\n  }\n  return result;\n}\n\nfunction getSchema(config) {\n  const tables = (0,_better_auth_DORkW_Ge_mjs__WEBPACK_IMPORTED_MODULE_13__.g)(config);\n  let schema = {};\n  for (const key in tables) {\n    const table = tables[key];\n    const fields = table.fields;\n    let actualFields = {};\n    Object.entries(fields).forEach(([key2, field]) => {\n      actualFields[field.fieldName || key2] = field;\n      if (field.references) {\n        const refTable = tables[field.references.model];\n        if (refTable) {\n          actualFields[field.fieldName || key2].references = {\n            model: refTable.modelName,\n            field: field.references.field\n          };\n        }\n      }\n    });\n    if (schema[table.modelName]) {\n      schema[table.modelName].fields = {\n        ...schema[table.modelName].fields,\n        ...actualFields\n      };\n      continue;\n    }\n    schema[table.modelName] = {\n      fields: actualFields,\n      order: table.order || Infinity\n    };\n  }\n  return schema;\n}\n\nconst postgresMap = {\n  string: [\"character varying\", \"varchar\", \"text\"],\n  number: [\n    \"int4\",\n    \"integer\",\n    \"bigint\",\n    \"smallint\",\n    \"numeric\",\n    \"real\",\n    \"double precision\"\n  ],\n  boolean: [\"bool\", \"boolean\"],\n  date: [\"timestamp\", \"date\"]\n};\nconst mysqlMap = {\n  string: [\"varchar\", \"text\"],\n  number: [\n    \"integer\",\n    \"int\",\n    \"bigint\",\n    \"smallint\",\n    \"decimal\",\n    \"float\",\n    \"double\"\n  ],\n  boolean: [\"boolean\", \"tinyint\"],\n  date: [\"timestamp\", \"datetime\", \"date\"]\n};\nconst sqliteMap = {\n  string: [\"TEXT\"],\n  number: [\"INTEGER\", \"REAL\"],\n  boolean: [\"INTEGER\", \"BOOLEAN\"],\n  // 0 or 1\n  date: [\"DATE\", \"INTEGER\"]\n};\nconst mssqlMap = {\n  string: [\"text\", \"varchar\"],\n  number: [\"int\", \"bigint\", \"smallint\", \"decimal\", \"float\", \"double\"],\n  boolean: [\"bit\", \"smallint\"],\n  date: [\"datetime\", \"date\"]\n};\nconst map = {\n  postgres: postgresMap,\n  mysql: mysqlMap,\n  sqlite: sqliteMap,\n  mssql: mssqlMap\n};\nfunction matchType(columnDataType, fieldType, dbType) {\n  function normalize(type) {\n    return type.toLowerCase().split(\"(\")[0].trim();\n  }\n  if (fieldType === \"string[]\" || fieldType === \"number[]\") {\n    return columnDataType.toLowerCase().includes(\"json\");\n  }\n  const types = map[dbType];\n  const expected = Array.isArray(fieldType) ? types[\"string\"].map((t) => t.toLowerCase()) : types[fieldType].map((t) => t.toLowerCase());\n  return expected.includes(normalize(columnDataType));\n}\nasync function getMigrations(config) {\n  const betterAuthSchema = getSchema(config);\n  const logger = (0,_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_4__.c)(config.logger);\n  let { kysely: db, databaseType: dbType } = await (0,_better_auth_DwzM_9N1_mjs__WEBPACK_IMPORTED_MODULE_15__.c)(config);\n  if (!dbType) {\n    logger.warn(\n      \"Could not determine database type, defaulting to sqlite. Please provide a type in the database options to avoid this.\"\n    );\n    dbType = \"sqlite\";\n  }\n  if (!db) {\n    logger.error(\n      \"Only kysely adapter is supported for migrations. You can use `generate` command to generate the schema, if you're using a different adapter.\"\n    );\n    process.exit(1);\n  }\n  const tableMetadata = await db.introspection.getTables();\n  const toBeCreated = [];\n  const toBeAdded = [];\n  for (const [key, value] of Object.entries(betterAuthSchema)) {\n    const table = tableMetadata.find((t) => t.name === key);\n    if (!table) {\n      const tIndex = toBeCreated.findIndex((t) => t.table === key);\n      const tableData = {\n        table: key,\n        fields: value.fields,\n        order: value.order || Infinity\n      };\n      const insertIndex = toBeCreated.findIndex(\n        (t) => (t.order || Infinity) > tableData.order\n      );\n      if (insertIndex === -1) {\n        if (tIndex === -1) {\n          toBeCreated.push(tableData);\n        } else {\n          toBeCreated[tIndex].fields = {\n            ...toBeCreated[tIndex].fields,\n            ...value.fields\n          };\n        }\n      } else {\n        toBeCreated.splice(insertIndex, 0, tableData);\n      }\n      continue;\n    }\n    let toBeAddedFields = {};\n    for (const [fieldName, field] of Object.entries(value.fields)) {\n      const column = table.columns.find((c) => c.name === fieldName);\n      if (!column) {\n        toBeAddedFields[fieldName] = field;\n        continue;\n      }\n      if (matchType(column.dataType, field.type, dbType)) {\n        continue;\n      } else {\n        logger.warn(\n          `Field ${fieldName} in table ${key} has a different type in the database. Expected ${field.type} but got ${column.dataType}.`\n        );\n      }\n    }\n    if (Object.keys(toBeAddedFields).length > 0) {\n      toBeAdded.push({\n        table: key,\n        fields: toBeAddedFields,\n        order: value.order || Infinity\n      });\n    }\n  }\n  const migrations = [];\n  function getType(field, fieldName) {\n    const type = field.type;\n    const typeMap = {\n      string: {\n        sqlite: \"text\",\n        postgres: \"text\",\n        mysql: field.unique ? \"varchar(255)\" : field.references ? \"varchar(36)\" : \"text\",\n        mssql: field.unique || field.sortable ? \"varchar(255)\" : field.references ? \"varchar(36)\" : \"text\"\n      },\n      boolean: {\n        sqlite: \"integer\",\n        postgres: \"boolean\",\n        mysql: \"boolean\",\n        mssql: \"smallint\"\n      },\n      number: {\n        sqlite: field.bigint ? \"bigint\" : \"integer\",\n        postgres: field.bigint ? \"bigint\" : \"integer\",\n        mysql: field.bigint ? \"bigint\" : \"integer\",\n        mssql: field.bigint ? \"bigint\" : \"integer\"\n      },\n      date: {\n        sqlite: \"date\",\n        postgres: \"timestamp\",\n        mysql: \"datetime\",\n        mssql: \"datetime\"\n      },\n      id: {\n        postgres: config.advanced?.database?.useNumberId ? \"serial\" : \"text\",\n        mysql: config.advanced?.database?.useNumberId ? \"integer\" : \"varchar(36)\",\n        mssql: config.advanced?.database?.useNumberId ? \"integer\" : \"varchar(36)\",\n        sqlite: config.advanced?.database?.useNumberId ? \"integer\" : \"text\"\n      }\n    };\n    if (fieldName === \"id\" || field.references?.field === \"id\") {\n      return typeMap.id[dbType];\n    }\n    if (dbType === \"sqlite\" && (type === \"string[]\" || type === \"number[]\")) {\n      return \"text\";\n    }\n    if (type === \"string[]\" || type === \"number[]\") {\n      return \"jsonb\";\n    }\n    if (Array.isArray(type)) {\n      return \"text\";\n    }\n    return typeMap[type][dbType || \"sqlite\"];\n  }\n  if (toBeAdded.length) {\n    for (const table of toBeAdded) {\n      for (const [fieldName, field] of Object.entries(table.fields)) {\n        const type = getType(field, fieldName);\n        const exec = db.schema.alterTable(table.table).addColumn(fieldName, type, (col) => {\n          col = field.required !== false ? col.notNull() : col;\n          if (field.references) {\n            col = col.references(\n              `${field.references.model}.${field.references.field}`\n            );\n          }\n          if (field.unique) {\n            col = col.unique();\n          }\n          return col;\n        });\n        migrations.push(exec);\n      }\n    }\n  }\n  if (toBeCreated.length) {\n    for (const table of toBeCreated) {\n      let dbT = db.schema.createTable(table.table).addColumn(\n        \"id\",\n        config.advanced?.database?.useNumberId ? dbType === \"postgres\" ? \"serial\" : \"integer\" : dbType === \"mysql\" || dbType === \"mssql\" ? \"varchar(36)\" : \"text\",\n        (col) => {\n          if (config.advanced?.database?.useNumberId) {\n            if (dbType === \"postgres\") {\n              return col.primaryKey().notNull();\n            }\n            return col.autoIncrement().primaryKey().notNull();\n          }\n          return col.primaryKey().notNull();\n        }\n      );\n      for (const [fieldName, field] of Object.entries(table.fields)) {\n        const type = getType(field, fieldName);\n        dbT = dbT.addColumn(fieldName, type, (col) => {\n          col = field.required !== false ? col.notNull() : col;\n          if (field.references) {\n            col = col.references(\n              `${field.references.model}.${field.references.field}`\n            );\n          }\n          if (field.unique) {\n            col = col.unique();\n          }\n          return col;\n        });\n      }\n      migrations.push(dbT);\n    }\n  }\n  async function runMigrations() {\n    for (const migration of migrations) {\n      await migration.execute();\n    }\n  }\n  async function compileMigrations() {\n    const compiled = migrations.map((m) => m.compile().sql);\n    return compiled.join(\";\\n\\n\") + \";\";\n  }\n  return { toBeCreated, toBeAdded, runMigrations, compileMigrations };\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguQnlydVBOOXEubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBMEQ7QUFDaUM7QUFDbkM7QUFDUTtBQUM2QjtBQUM3RTtBQUNLO0FBQ1k7QUFDRjtBQUNEO0FBQ0k7QUFDQztBQUNyQjtBQUNnQjtBQUNGO0FBQ0k7QUFDSDtBQUNPO0FBQ0E7QUFDRDtBQUM2QjtBQUNFO0FBQ3dCO0FBQzFCO0FBQ2hEOztBQUVoQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsd0RBQXdEO0FBQ2xFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNFQUFzRSxPQUFPO0FBQzdFO0FBQ0E7QUFDQSx1QkFBdUIsNERBQWE7QUFDcEM7QUFDQTtBQUNBLHVDQUF1QyxPQUFPO0FBQzlDO0FBQ0E7QUFDQSw2QkFBNkIsNERBQWE7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFD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O0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsV0FBVztBQUN0QztBQUNBLFdBQVc7QUFDWDs7QUFFb0siLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWxhbi9EZXNrdG9wL0FwcHMvYmV0dGVyLWF1dGgvbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLkJ5cnVQTjlxLm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnIGFzIGdldERhdGUgfSBmcm9tICcuL2JldHRlci1hdXRoLkNXNkQ5ZVN4Lm1qcyc7XG5pbXBvcnQgeyBkIGFzIHBhcnNlU2Vzc2lvbk91dHB1dCwgYiBhcyBwYXJzZVVzZXJPdXRwdXQgfSBmcm9tICcuL2JldHRlci1hdXRoLm4yS0ZHd2pZLm1qcyc7XG5pbXBvcnQgeyBnIGFzIGdldElwIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC5EY2ZOUFM4cS5tanMnO1xuaW1wb3J0IHsgcyBhcyBzYWZlSlNPTlBhcnNlIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC50QjVlVTZFWS5tanMnO1xuaW1wb3J0IHsgZyBhcyBnZW5lcmF0ZUlkLCBhIGFzIGxvZ2dlciwgYyBhcyBjcmVhdGVMb2dnZXIgfSBmcm9tICcuL2JldHRlci1hdXRoLkRCR2ZJRG5oLm1qcyc7XG5pbXBvcnQgJ3pvZC92NCc7XG5pbXBvcnQgJ2JldHRlci1jYWxsJztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzL2hhc2gnO1xuaW1wb3J0ICdAbm9ibGUvY2lwaGVycy9jaGFjaGEnO1xuaW1wb3J0ICdAbm9ibGUvY2lwaGVycy91dGlscyc7XG5pbXBvcnQgJ0Bub2JsZS9jaXBoZXJzL3dlYmNyeXB0byc7XG5pbXBvcnQgJ0BiZXR0ZXItYXV0aC91dGlscy9iYXNlNjQnO1xuaW1wb3J0ICdqb3NlJztcbmltcG9ydCAnQG5vYmxlL2hhc2hlcy9zY3J5cHQnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMvaGV4JztcbmltcG9ydCAnQG5vYmxlL2hhc2hlcy91dGlscyc7XG5pbXBvcnQgJy4vYmV0dGVyLWF1dGguQjRRb3hkZ2MubWpzJztcbmltcG9ydCAnLi9iZXR0ZXItYXV0aC44em94emctRi5tanMnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMvcmFuZG9tJztcbmltcG9ydCB7IGcgYXMgZ2V0QXV0aFRhYmxlcyB9IGZyb20gJy4vYmV0dGVyLWF1dGguRE9Sa1dfR2UubWpzJztcbmltcG9ydCB7IEIgYXMgQmV0dGVyQXV0aEVycm9yIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC5EZHpTSmYtbi5tanMnO1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVLeXNlbHlBZGFwdGVyLCBrIGFzIGt5c2VseUFkYXB0ZXIgfSBmcm9tICcuL2JldHRlci1hdXRoLkR3ek0tOU4xLm1qcyc7XG5pbXBvcnQgeyBtIGFzIG1lbW9yeUFkYXB0ZXIgfSBmcm9tICcuL2JldHRlci1hdXRoLkRHcGFkcHpOLm1qcyc7XG5pbXBvcnQgJ2t5c2VseSc7XG5cbmZ1bmN0aW9uIGdldFdpdGhIb29rcyhhZGFwdGVyLCBjdHgpIHtcbiAgY29uc3QgaG9va3MgPSBjdHguaG9va3M7XG4gIGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVdpdGhIb29rcyhkYXRhLCBtb2RlbCwgY3VzdG9tQ3JlYXRlRm4sIGNvbnRleHQpIHtcbiAgICBsZXQgYWN0dWFsRGF0YSA9IGRhdGE7XG4gICAgZm9yIChjb25zdCBob29rIG9mIGhvb2tzIHx8IFtdKSB7XG4gICAgICBjb25zdCB0b1J1biA9IGhvb2tbbW9kZWxdPy5jcmVhdGU/LmJlZm9yZTtcbiAgICAgIGlmICh0b1J1bikge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0b1J1bihhY3R1YWxEYXRhLCBjb250ZXh0KTtcbiAgICAgICAgaWYgKHJlc3VsdCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpc09iamVjdCA9IHR5cGVvZiByZXN1bHQgPT09IFwib2JqZWN0XCIgJiYgXCJkYXRhXCIgaW4gcmVzdWx0O1xuICAgICAgICBpZiAoaXNPYmplY3QpIHtcbiAgICAgICAgICBhY3R1YWxEYXRhID0ge1xuICAgICAgICAgICAgLi4uYWN0dWFsRGF0YSxcbiAgICAgICAgICAgIC4uLnJlc3VsdC5kYXRhXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBjdXN0b21DcmVhdGVkID0gY3VzdG9tQ3JlYXRlRm4gPyBhd2FpdCBjdXN0b21DcmVhdGVGbi5mbihhY3R1YWxEYXRhKSA6IG51bGw7XG4gICAgY29uc3QgY3JlYXRlZCA9ICFjdXN0b21DcmVhdGVGbiB8fCBjdXN0b21DcmVhdGVGbi5leGVjdXRlTWFpbkZuID8gYXdhaXQgYWRhcHRlci5jcmVhdGUoe1xuICAgICAgbW9kZWwsXG4gICAgICBkYXRhOiBhY3R1YWxEYXRhLFxuICAgICAgZm9yY2VBbGxvd0lkOiB0cnVlXG4gICAgfSkgOiBjdXN0b21DcmVhdGVkO1xuICAgIGZvciAoY29uc3QgaG9vayBvZiBob29rcyB8fCBbXSkge1xuICAgICAgY29uc3QgdG9SdW4gPSBob29rW21vZGVsXT8uY3JlYXRlPy5hZnRlcjtcbiAgICAgIGlmICh0b1J1bikge1xuICAgICAgICBhd2FpdCB0b1J1bihjcmVhdGVkLCBjb250ZXh0KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGNyZWF0ZWQ7XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gdXBkYXRlV2l0aEhvb2tzKGRhdGEsIHdoZXJlLCBtb2RlbCwgY3VzdG9tVXBkYXRlRm4sIGNvbnRleHQpIHtcbiAgICBsZXQgYWN0dWFsRGF0YSA9IGRhdGE7XG4gICAgZm9yIChjb25zdCBob29rIG9mIGhvb2tzIHx8IFtdKSB7XG4gICAgICBjb25zdCB0b1J1biA9IGhvb2tbbW9kZWxdPy51cGRhdGU/LmJlZm9yZTtcbiAgICAgIGlmICh0b1J1bikge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0b1J1bihkYXRhLCBjb250ZXh0KTtcbiAgICAgICAgaWYgKHJlc3VsdCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpc09iamVjdCA9IHR5cGVvZiByZXN1bHQgPT09IFwib2JqZWN0XCI7XG4gICAgICAgIGFjdHVhbERhdGEgPSBpc09iamVjdCA/IHJlc3VsdC5kYXRhIDogcmVzdWx0O1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBjdXN0b21VcGRhdGVkID0gY3VzdG9tVXBkYXRlRm4gPyBhd2FpdCBjdXN0b21VcGRhdGVGbi5mbihhY3R1YWxEYXRhKSA6IG51bGw7XG4gICAgY29uc3QgdXBkYXRlZCA9ICFjdXN0b21VcGRhdGVGbiB8fCBjdXN0b21VcGRhdGVGbi5leGVjdXRlTWFpbkZuID8gYXdhaXQgYWRhcHRlci51cGRhdGUoe1xuICAgICAgbW9kZWwsXG4gICAgICB1cGRhdGU6IGFjdHVhbERhdGEsXG4gICAgICB3aGVyZVxuICAgIH0pIDogY3VzdG9tVXBkYXRlZDtcbiAgICBmb3IgKGNvbnN0IGhvb2sgb2YgaG9va3MgfHwgW10pIHtcbiAgICAgIGNvbnN0IHRvUnVuID0gaG9va1ttb2RlbF0/LnVwZGF0ZT8uYWZ0ZXI7XG4gICAgICBpZiAodG9SdW4pIHtcbiAgICAgICAgYXdhaXQgdG9SdW4odXBkYXRlZCwgY29udGV4dCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB1cGRhdGVkO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZU1hbnlXaXRoSG9va3MoZGF0YSwgd2hlcmUsIG1vZGVsLCBjdXN0b21VcGRhdGVGbiwgY29udGV4dCkge1xuICAgIGxldCBhY3R1YWxEYXRhID0gZGF0YTtcbiAgICBmb3IgKGNvbnN0IGhvb2sgb2YgaG9va3MgfHwgW10pIHtcbiAgICAgIGNvbnN0IHRvUnVuID0gaG9va1ttb2RlbF0/LnVwZGF0ZT8uYmVmb3JlO1xuICAgICAgaWYgKHRvUnVuKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRvUnVuKGRhdGEsIGNvbnRleHQpO1xuICAgICAgICBpZiAocmVzdWx0ID09PSBmYWxzZSkge1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGlzT2JqZWN0ID0gdHlwZW9mIHJlc3VsdCA9PT0gXCJvYmplY3RcIjtcbiAgICAgICAgYWN0dWFsRGF0YSA9IGlzT2JqZWN0ID8gcmVzdWx0LmRhdGEgOiByZXN1bHQ7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGN1c3RvbVVwZGF0ZWQgPSBjdXN0b21VcGRhdGVGbiA/IGF3YWl0IGN1c3RvbVVwZGF0ZUZuLmZuKGFjdHVhbERhdGEpIDogbnVsbDtcbiAgICBjb25zdCB1cGRhdGVkID0gIWN1c3RvbVVwZGF0ZUZuIHx8IGN1c3RvbVVwZGF0ZUZuLmV4ZWN1dGVNYWluRm4gPyBhd2FpdCBhZGFwdGVyLnVwZGF0ZU1hbnkoe1xuICAgICAgbW9kZWwsXG4gICAgICB1cGRhdGU6IGFjdHVhbERhdGEsXG4gICAgICB3aGVyZVxuICAgIH0pIDogY3VzdG9tVXBkYXRlZDtcbiAgICBmb3IgKGNvbnN0IGhvb2sgb2YgaG9va3MgfHwgW10pIHtcbiAgICAgIGNvbnN0IHRvUnVuID0gaG9va1ttb2RlbF0/LnVwZGF0ZT8uYWZ0ZXI7XG4gICAgICBpZiAodG9SdW4pIHtcbiAgICAgICAgYXdhaXQgdG9SdW4odXBkYXRlZCwgY29udGV4dCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB1cGRhdGVkO1xuICB9XG4gIHJldHVybiB7XG4gICAgY3JlYXRlV2l0aEhvb2tzLFxuICAgIHVwZGF0ZVdpdGhIb29rcyxcbiAgICB1cGRhdGVNYW55V2l0aEhvb2tzXG4gIH07XG59XG5cbmNvbnN0IGNyZWF0ZUludGVybmFsQWRhcHRlciA9IChhZGFwdGVyLCBjdHgpID0+IHtcbiAgY29uc3Qgb3B0aW9ucyA9IGN0eC5vcHRpb25zO1xuICBjb25zdCBzZWNvbmRhcnlTdG9yYWdlID0gb3B0aW9ucy5zZWNvbmRhcnlTdG9yYWdlO1xuICBjb25zdCBzZXNzaW9uRXhwaXJhdGlvbiA9IG9wdGlvbnMuc2Vzc2lvbj8uZXhwaXJlc0luIHx8IDYwICogNjAgKiAyNCAqIDc7XG4gIGNvbnN0IHsgY3JlYXRlV2l0aEhvb2tzLCB1cGRhdGVXaXRoSG9va3MsIHVwZGF0ZU1hbnlXaXRoSG9va3MgfSA9IGdldFdpdGhIb29rcyhhZGFwdGVyLCBjdHgpO1xuICByZXR1cm4ge1xuICAgIGNyZWF0ZU9BdXRoVXNlcjogYXN5bmMgKHVzZXIsIGFjY291bnQsIGNvbnRleHQpID0+IHtcbiAgICAgIGNvbnN0IGNyZWF0ZWRVc2VyID0gYXdhaXQgY3JlYXRlV2l0aEhvb2tzKFxuICAgICAgICB7XG4gICAgICAgICAgY3JlYXRlZEF0OiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSxcbiAgICAgICAgICB1cGRhdGVkQXQ6IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpLFxuICAgICAgICAgIC4uLnVzZXJcbiAgICAgICAgfSxcbiAgICAgICAgXCJ1c2VyXCIsXG4gICAgICAgIHZvaWQgMCxcbiAgICAgICAgY29udGV4dFxuICAgICAgKTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRBY2NvdW50ID0gYXdhaXQgY3JlYXRlV2l0aEhvb2tzKFxuICAgICAgICB7XG4gICAgICAgICAgLi4uYWNjb3VudCxcbiAgICAgICAgICB1c2VySWQ6IGNyZWF0ZWRVc2VyLmlkIHx8IHVzZXIuaWQsXG4gICAgICAgICAgY3JlYXRlZEF0OiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSxcbiAgICAgICAgICB1cGRhdGVkQXQ6IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpXG4gICAgICAgIH0sXG4gICAgICAgIFwiYWNjb3VudFwiLFxuICAgICAgICB2b2lkIDAsXG4gICAgICAgIGNvbnRleHRcbiAgICAgICk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VyOiBjcmVhdGVkVXNlcixcbiAgICAgICAgYWNjb3VudDogY3JlYXRlZEFjY291bnRcbiAgICAgIH07XG4gICAgfSxcbiAgICBjcmVhdGVVc2VyOiBhc3luYyAodXNlciwgY29udGV4dCkgPT4ge1xuICAgICAgY29uc3QgY3JlYXRlZFVzZXIgPSBhd2FpdCBjcmVhdGVXaXRoSG9va3MoXG4gICAgICAgIHtcbiAgICAgICAgICBjcmVhdGVkQXQ6IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpLFxuICAgICAgICAgIHVwZGF0ZWRBdDogLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCksXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogZmFsc2UsXG4gICAgICAgICAgLi4udXNlcixcbiAgICAgICAgICBlbWFpbDogdXNlci5lbWFpbD8udG9Mb3dlckNhc2UoKVxuICAgICAgICB9LFxuICAgICAgICBcInVzZXJcIixcbiAgICAgICAgdm9pZCAwLFxuICAgICAgICBjb250ZXh0XG4gICAgICApO1xuICAgICAgcmV0dXJuIGNyZWF0ZWRVc2VyO1xuICAgIH0sXG4gICAgY3JlYXRlQWNjb3VudDogYXN5bmMgKGFjY291bnQsIGNvbnRleHQpID0+IHtcbiAgICAgIGNvbnN0IGNyZWF0ZWRBY2NvdW50ID0gYXdhaXQgY3JlYXRlV2l0aEhvb2tzKFxuICAgICAgICB7XG4gICAgICAgICAgY3JlYXRlZEF0OiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSxcbiAgICAgICAgICB1cGRhdGVkQXQ6IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpLFxuICAgICAgICAgIC4uLmFjY291bnRcbiAgICAgICAgfSxcbiAgICAgICAgXCJhY2NvdW50XCIsXG4gICAgICAgIHZvaWQgMCxcbiAgICAgICAgY29udGV4dFxuICAgICAgKTtcbiAgICAgIHJldHVybiBjcmVhdGVkQWNjb3VudDtcbiAgICB9LFxuICAgIGxpc3RTZXNzaW9uczogYXN5bmMgKHVzZXJJZCkgPT4ge1xuICAgICAgaWYgKHNlY29uZGFyeVN0b3JhZ2UpIHtcbiAgICAgICAgY29uc3QgY3VycmVudExpc3QgPSBhd2FpdCBzZWNvbmRhcnlTdG9yYWdlLmdldChcbiAgICAgICAgICBgYWN0aXZlLXNlc3Npb25zLSR7dXNlcklkfWBcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKCFjdXJyZW50TGlzdCkgcmV0dXJuIFtdO1xuICAgICAgICBjb25zdCBsaXN0ID0gc2FmZUpTT05QYXJzZShjdXJyZW50TGlzdCkgfHwgW107XG4gICAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgICAgIGNvbnN0IHZhbGlkU2Vzc2lvbnMgPSBsaXN0LmZpbHRlcigocykgPT4gcy5leHBpcmVzQXQgPiBub3cpO1xuICAgICAgICBjb25zdCBzZXNzaW9uczIgPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCBzZXNzaW9uIG9mIHZhbGlkU2Vzc2lvbnMpIHtcbiAgICAgICAgICBjb25zdCBzZXNzaW9uU3RyaW5naWZpZWQgPSBhd2FpdCBzZWNvbmRhcnlTdG9yYWdlLmdldChzZXNzaW9uLnRva2VuKTtcbiAgICAgICAgICBpZiAoc2Vzc2lvblN0cmluZ2lmaWVkKSB7XG4gICAgICAgICAgICBjb25zdCBzID0gSlNPTi5wYXJzZShzZXNzaW9uU3RyaW5naWZpZWQpO1xuICAgICAgICAgICAgY29uc3QgcGFyc2VkU2Vzc2lvbiA9IHBhcnNlU2Vzc2lvbk91dHB1dChjdHgub3B0aW9ucywge1xuICAgICAgICAgICAgICAuLi5zLnNlc3Npb24sXG4gICAgICAgICAgICAgIGV4cGlyZXNBdDogbmV3IERhdGUocy5zZXNzaW9uLmV4cGlyZXNBdClcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc2Vzc2lvbnMyLnB1c2gocGFyc2VkU2Vzc2lvbik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzZXNzaW9uczI7XG4gICAgICB9XG4gICAgICBjb25zdCBzZXNzaW9ucyA9IGF3YWl0IGFkYXB0ZXIuZmluZE1hbnkoe1xuICAgICAgICBtb2RlbDogXCJzZXNzaW9uXCIsXG4gICAgICAgIHdoZXJlOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6IFwidXNlcklkXCIsXG4gICAgICAgICAgICB2YWx1ZTogdXNlcklkXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBzZXNzaW9ucztcbiAgICB9LFxuICAgIGxpc3RVc2VyczogYXN5bmMgKGxpbWl0LCBvZmZzZXQsIHNvcnRCeSwgd2hlcmUpID0+IHtcbiAgICAgIGNvbnN0IHVzZXJzID0gYXdhaXQgYWRhcHRlci5maW5kTWFueSh7XG4gICAgICAgIG1vZGVsOiBcInVzZXJcIixcbiAgICAgICAgbGltaXQsXG4gICAgICAgIG9mZnNldCxcbiAgICAgICAgc29ydEJ5LFxuICAgICAgICB3aGVyZVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gdXNlcnM7XG4gICAgfSxcbiAgICBjb3VudFRvdGFsVXNlcnM6IGFzeW5jICh3aGVyZSkgPT4ge1xuICAgICAgY29uc3QgdG90YWwgPSBhd2FpdCBhZGFwdGVyLmNvdW50KHtcbiAgICAgICAgbW9kZWw6IFwidXNlclwiLFxuICAgICAgICB3aGVyZVxuICAgICAgfSk7XG4gICAgICBpZiAodHlwZW9mIHRvdGFsID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHJldHVybiBwYXJzZUludCh0b3RhbCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdG90YWw7XG4gICAgfSxcbiAgICBkZWxldGVVc2VyOiBhc3luYyAodXNlcklkKSA9PiB7XG4gICAgICBpZiAoc2Vjb25kYXJ5U3RvcmFnZSkge1xuICAgICAgICBhd2FpdCBzZWNvbmRhcnlTdG9yYWdlLmRlbGV0ZShgYWN0aXZlLXNlc3Npb25zLSR7dXNlcklkfWApO1xuICAgICAgfVxuICAgICAgaWYgKCFzZWNvbmRhcnlTdG9yYWdlIHx8IG9wdGlvbnMuc2Vzc2lvbj8uc3RvcmVTZXNzaW9uSW5EYXRhYmFzZSkge1xuICAgICAgICBhd2FpdCBhZGFwdGVyLmRlbGV0ZU1hbnkoe1xuICAgICAgICAgIG1vZGVsOiBcInNlc3Npb25cIixcbiAgICAgICAgICB3aGVyZTogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBmaWVsZDogXCJ1c2VySWRcIixcbiAgICAgICAgICAgICAgdmFsdWU6IHVzZXJJZFxuICAgICAgICAgICAgfVxuICAgICAgICAgIF1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBhd2FpdCBhZGFwdGVyLmRlbGV0ZU1hbnkoe1xuICAgICAgICBtb2RlbDogXCJhY2NvdW50XCIsXG4gICAgICAgIHdoZXJlOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6IFwidXNlcklkXCIsXG4gICAgICAgICAgICB2YWx1ZTogdXNlcklkXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9KTtcbiAgICAgIGF3YWl0IGFkYXB0ZXIuZGVsZXRlKHtcbiAgICAgICAgbW9kZWw6IFwidXNlclwiLFxuICAgICAgICB3aGVyZTogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiBcImlkXCIsXG4gICAgICAgICAgICB2YWx1ZTogdXNlcklkXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9KTtcbiAgICB9LFxuICAgIGNyZWF0ZVNlc3Npb246IGFzeW5jICh1c2VySWQsIGN0eDIsIGRvbnRSZW1lbWJlck1lLCBvdmVycmlkZSwgb3ZlcnJpZGVBbGwpID0+IHtcbiAgICAgIGNvbnN0IGhlYWRlcnMgPSBjdHgyLmhlYWRlcnMgfHwgY3R4Mi5yZXF1ZXN0Py5oZWFkZXJzO1xuICAgICAgY29uc3QgeyBpZDogXywgLi4ucmVzdCB9ID0gb3ZlcnJpZGUgfHwge307XG4gICAgICBjb25zdCBkYXRhID0ge1xuICAgICAgICBpcEFkZHJlc3M6IGN0eDIucmVxdWVzdCB8fCBjdHgyLmhlYWRlcnMgPyBnZXRJcChjdHgyLnJlcXVlc3QgfHwgY3R4Mi5oZWFkZXJzLCBjdHgyLmNvbnRleHQub3B0aW9ucykgfHwgXCJcIiA6IFwiXCIsXG4gICAgICAgIHVzZXJBZ2VudDogaGVhZGVycz8uZ2V0KFwidXNlci1hZ2VudFwiKSB8fCBcIlwiLFxuICAgICAgICAuLi5yZXN0LFxuICAgICAgICAvKipcbiAgICAgICAgICogSWYgdGhlIHVzZXIgZG9lc24ndCB3YW50IHRvIGJlIHJlbWVtYmVyZWRcbiAgICAgICAgICogc2V0IHRoZSBzZXNzaW9uIHRvIGV4cGlyZSBpbiAxIGRheS5cbiAgICAgICAgICogVGhlIGNvb2tpZSB3aWxsIGJlIHNldCB0byBleHBpcmUgYXQgdGhlIGVuZCBvZiB0aGUgc2Vzc2lvblxuICAgICAgICAgKi9cbiAgICAgICAgZXhwaXJlc0F0OiBkb250UmVtZW1iZXJNZSA/IGdldERhdGUoNjAgKiA2MCAqIDI0LCBcInNlY1wiKSA6IGdldERhdGUoc2Vzc2lvbkV4cGlyYXRpb24sIFwic2VjXCIpLFxuICAgICAgICB1c2VySWQsXG4gICAgICAgIHRva2VuOiBnZW5lcmF0ZUlkKDMyKSxcbiAgICAgICAgY3JlYXRlZEF0OiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSxcbiAgICAgICAgdXBkYXRlZEF0OiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSxcbiAgICAgICAgLi4ub3ZlcnJpZGVBbGwgPyByZXN0IDoge31cbiAgICAgIH07XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBjcmVhdGVXaXRoSG9va3MoXG4gICAgICAgIGRhdGEsXG4gICAgICAgIFwic2Vzc2lvblwiLFxuICAgICAgICBzZWNvbmRhcnlTdG9yYWdlID8ge1xuICAgICAgICAgIGZuOiBhc3luYyAoc2Vzc2lvbkRhdGEpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRMaXN0ID0gYXdhaXQgc2Vjb25kYXJ5U3RvcmFnZS5nZXQoXG4gICAgICAgICAgICAgIGBhY3RpdmUtc2Vzc2lvbnMtJHt1c2VySWR9YFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGxldCBsaXN0ID0gW107XG4gICAgICAgICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRMaXN0KSB7XG4gICAgICAgICAgICAgIGxpc3QgPSBzYWZlSlNPTlBhcnNlKGN1cnJlbnRMaXN0KSB8fCBbXTtcbiAgICAgICAgICAgICAgbGlzdCA9IGxpc3QuZmlsdGVyKChzZXNzaW9uKSA9PiBzZXNzaW9uLmV4cGlyZXNBdCA+IG5vdyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsaXN0LnB1c2goe1xuICAgICAgICAgICAgICB0b2tlbjogZGF0YS50b2tlbixcbiAgICAgICAgICAgICAgZXhwaXJlc0F0OiBub3cgKyBzZXNzaW9uRXhwaXJhdGlvbiAqIDFlM1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBhd2FpdCBzZWNvbmRhcnlTdG9yYWdlLnNldChcbiAgICAgICAgICAgICAgYGFjdGl2ZS1zZXNzaW9ucy0ke3VzZXJJZH1gLFxuICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeShsaXN0KSxcbiAgICAgICAgICAgICAgc2Vzc2lvbkV4cGlyYXRpb25cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByZXR1cm4gc2Vzc2lvbkRhdGE7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBleGVjdXRlTWFpbkZuOiBvcHRpb25zLnNlc3Npb24/LnN0b3JlU2Vzc2lvbkluRGF0YWJhc2VcbiAgICAgICAgfSA6IHZvaWQgMCxcbiAgICAgICAgY3R4MlxuICAgICAgKTtcbiAgICAgIHJldHVybiByZXM7XG4gICAgfSxcbiAgICBmaW5kU2Vzc2lvbjogYXN5bmMgKHRva2VuKSA9PiB7XG4gICAgICBpZiAoc2Vjb25kYXJ5U3RvcmFnZSkge1xuICAgICAgICBjb25zdCBzZXNzaW9uU3RyaW5naWZpZWQgPSBhd2FpdCBzZWNvbmRhcnlTdG9yYWdlLmdldCh0b2tlbik7XG4gICAgICAgIGlmICghc2Vzc2lvblN0cmluZ2lmaWVkICYmICFvcHRpb25zLnNlc3Npb24/LnN0b3JlU2Vzc2lvbkluRGF0YWJhc2UpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2Vzc2lvblN0cmluZ2lmaWVkKSB7XG4gICAgICAgICAgY29uc3QgcyA9IEpTT04ucGFyc2Uoc2Vzc2lvblN0cmluZ2lmaWVkKTtcbiAgICAgICAgICBjb25zdCBwYXJzZWRTZXNzaW9uMiA9IHBhcnNlU2Vzc2lvbk91dHB1dChjdHgub3B0aW9ucywge1xuICAgICAgICAgICAgLi4ucy5zZXNzaW9uLFxuICAgICAgICAgICAgZXhwaXJlc0F0OiBuZXcgRGF0ZShzLnNlc3Npb24uZXhwaXJlc0F0KSxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUocy5zZXNzaW9uLmNyZWF0ZWRBdCksXG4gICAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKHMuc2Vzc2lvbi51cGRhdGVkQXQpXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY29uc3QgcGFyc2VkVXNlcjIgPSBwYXJzZVVzZXJPdXRwdXQoY3R4Lm9wdGlvbnMsIHtcbiAgICAgICAgICAgIC4uLnMudXNlcixcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUocy51c2VyLmNyZWF0ZWRBdCksXG4gICAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKHMudXNlci51cGRhdGVkQXQpXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNlc3Npb246IHBhcnNlZFNlc3Npb24yLFxuICAgICAgICAgICAgdXNlcjogcGFyc2VkVXNlcjJcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYWRhcHRlci5maW5kT25lKHtcbiAgICAgICAgbW9kZWw6IFwic2Vzc2lvblwiLFxuICAgICAgICB3aGVyZTogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiB0b2tlbixcbiAgICAgICAgICAgIGZpZWxkOiBcInRva2VuXCJcbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH0pO1xuICAgICAgaWYgKCFzZXNzaW9uKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IGFkYXB0ZXIuZmluZE9uZSh7XG4gICAgICAgIG1vZGVsOiBcInVzZXJcIixcbiAgICAgICAgd2hlcmU6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogc2Vzc2lvbi51c2VySWQsXG4gICAgICAgICAgICBmaWVsZDogXCJpZFwiXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9KTtcbiAgICAgIGlmICghdXNlcikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHBhcnNlZFNlc3Npb24gPSBwYXJzZVNlc3Npb25PdXRwdXQoY3R4Lm9wdGlvbnMsIHNlc3Npb24pO1xuICAgICAgY29uc3QgcGFyc2VkVXNlciA9IHBhcnNlVXNlck91dHB1dChjdHgub3B0aW9ucywgdXNlcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzZXNzaW9uOiBwYXJzZWRTZXNzaW9uLFxuICAgICAgICB1c2VyOiBwYXJzZWRVc2VyXG4gICAgICB9O1xuICAgIH0sXG4gICAgZmluZFNlc3Npb25zOiBhc3luYyAoc2Vzc2lvblRva2VucykgPT4ge1xuICAgICAgaWYgKHNlY29uZGFyeVN0b3JhZ2UpIHtcbiAgICAgICAgY29uc3Qgc2Vzc2lvbnMyID0gW107XG4gICAgICAgIGZvciAoY29uc3Qgc2Vzc2lvblRva2VuIG9mIHNlc3Npb25Ub2tlbnMpIHtcbiAgICAgICAgICBjb25zdCBzZXNzaW9uU3RyaW5naWZpZWQgPSBhd2FpdCBzZWNvbmRhcnlTdG9yYWdlLmdldChzZXNzaW9uVG9rZW4pO1xuICAgICAgICAgIGlmIChzZXNzaW9uU3RyaW5naWZpZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSBKU09OLnBhcnNlKHNlc3Npb25TdHJpbmdpZmllZCk7XG4gICAgICAgICAgICBjb25zdCBzZXNzaW9uID0ge1xuICAgICAgICAgICAgICBzZXNzaW9uOiB7XG4gICAgICAgICAgICAgICAgLi4ucy5zZXNzaW9uLFxuICAgICAgICAgICAgICAgIGV4cGlyZXNBdDogbmV3IERhdGUocy5zZXNzaW9uLmV4cGlyZXNBdClcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgIC4uLnMudXNlcixcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKHMudXNlci5jcmVhdGVkQXQpLFxuICAgICAgICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUocy51c2VyLnVwZGF0ZWRBdClcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHNlc3Npb25zMi5wdXNoKHNlc3Npb24pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc2Vzc2lvbnMyO1xuICAgICAgfVxuICAgICAgY29uc3Qgc2Vzc2lvbnMgPSBhd2FpdCBhZGFwdGVyLmZpbmRNYW55KHtcbiAgICAgICAgbW9kZWw6IFwic2Vzc2lvblwiLFxuICAgICAgICB3aGVyZTogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiBcInRva2VuXCIsXG4gICAgICAgICAgICB2YWx1ZTogc2Vzc2lvblRva2VucyxcbiAgICAgICAgICAgIG9wZXJhdG9yOiBcImluXCJcbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH0pO1xuICAgICAgY29uc3QgdXNlcklkcyA9IHNlc3Npb25zLm1hcCgoc2Vzc2lvbikgPT4ge1xuICAgICAgICByZXR1cm4gc2Vzc2lvbi51c2VySWQ7XG4gICAgICB9KTtcbiAgICAgIGlmICghdXNlcklkcy5sZW5ndGgpIHJldHVybiBbXTtcbiAgICAgIGNvbnN0IHVzZXJzID0gYXdhaXQgYWRhcHRlci5maW5kTWFueSh7XG4gICAgICAgIG1vZGVsOiBcInVzZXJcIixcbiAgICAgICAgd2hlcmU6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogXCJpZFwiLFxuICAgICAgICAgICAgdmFsdWU6IHVzZXJJZHMsXG4gICAgICAgICAgICBvcGVyYXRvcjogXCJpblwiXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBzZXNzaW9ucy5tYXAoKHNlc3Npb24pID0+IHtcbiAgICAgICAgY29uc3QgdXNlciA9IHVzZXJzLmZpbmQoKHUpID0+IHUuaWQgPT09IHNlc3Npb24udXNlcklkKTtcbiAgICAgICAgaWYgKCF1c2VyKSByZXR1cm4gbnVsbDtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzZXNzaW9uLFxuICAgICAgICAgIHVzZXJcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgdXBkYXRlU2Vzc2lvbjogYXN5bmMgKHNlc3Npb25Ub2tlbiwgc2Vzc2lvbiwgY29udGV4dCkgPT4ge1xuICAgICAgY29uc3QgdXBkYXRlZFNlc3Npb24gPSBhd2FpdCB1cGRhdGVXaXRoSG9va3MoXG4gICAgICAgIHNlc3Npb24sXG4gICAgICAgIFt7IGZpZWxkOiBcInRva2VuXCIsIHZhbHVlOiBzZXNzaW9uVG9rZW4gfV0sXG4gICAgICAgIFwic2Vzc2lvblwiLFxuICAgICAgICBzZWNvbmRhcnlTdG9yYWdlID8ge1xuICAgICAgICAgIGFzeW5jIGZuKGRhdGEpIHtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRTZXNzaW9uID0gYXdhaXQgc2Vjb25kYXJ5U3RvcmFnZS5nZXQoc2Vzc2lvblRva2VuKTtcbiAgICAgICAgICAgIGxldCB1cGRhdGVkU2Vzc2lvbjIgPSBudWxsO1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRTZXNzaW9uKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHBhcnNlZFNlc3Npb24gPSBKU09OLnBhcnNlKGN1cnJlbnRTZXNzaW9uKTtcbiAgICAgICAgICAgICAgdXBkYXRlZFNlc3Npb24yID0ge1xuICAgICAgICAgICAgICAgIC4uLnBhcnNlZFNlc3Npb24uc2Vzc2lvbixcbiAgICAgICAgICAgICAgICAuLi5kYXRhXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIHJldHVybiB1cGRhdGVkU2Vzc2lvbjI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGV4ZWN1dGVNYWluRm46IG9wdGlvbnMuc2Vzc2lvbj8uc3RvcmVTZXNzaW9uSW5EYXRhYmFzZVxuICAgICAgICB9IDogdm9pZCAwLFxuICAgICAgICBjb250ZXh0XG4gICAgICApO1xuICAgICAgcmV0dXJuIHVwZGF0ZWRTZXNzaW9uO1xuICAgIH0sXG4gICAgZGVsZXRlU2Vzc2lvbjogYXN5bmMgKHRva2VuKSA9PiB7XG4gICAgICBpZiAoc2Vjb25kYXJ5U3RvcmFnZSkge1xuICAgICAgICBhd2FpdCBzZWNvbmRhcnlTdG9yYWdlLmRlbGV0ZSh0b2tlbik7XG4gICAgICAgIGlmICghb3B0aW9ucy5zZXNzaW9uPy5zdG9yZVNlc3Npb25JbkRhdGFiYXNlIHx8IGN0eC5vcHRpb25zLnNlc3Npb24/LnByZXNlcnZlU2Vzc2lvbkluRGF0YWJhc2UpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGF3YWl0IGFkYXB0ZXIuZGVsZXRlKHtcbiAgICAgICAgbW9kZWw6IFwic2Vzc2lvblwiLFxuICAgICAgICB3aGVyZTogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiBcInRva2VuXCIsXG4gICAgICAgICAgICB2YWx1ZTogdG9rZW5cbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZGVsZXRlQWNjb3VudHM6IGFzeW5jICh1c2VySWQpID0+IHtcbiAgICAgIGF3YWl0IGFkYXB0ZXIuZGVsZXRlTWFueSh7XG4gICAgICAgIG1vZGVsOiBcImFjY291bnRcIixcbiAgICAgICAgd2hlcmU6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogXCJ1c2VySWRcIixcbiAgICAgICAgICAgIHZhbHVlOiB1c2VySWRcbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZGVsZXRlQWNjb3VudDogYXN5bmMgKGFjY291bnRJZCkgPT4ge1xuICAgICAgYXdhaXQgYWRhcHRlci5kZWxldGUoe1xuICAgICAgICBtb2RlbDogXCJhY2NvdW50XCIsXG4gICAgICAgIHdoZXJlOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6IFwiaWRcIixcbiAgICAgICAgICAgIHZhbHVlOiBhY2NvdW50SWRcbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZGVsZXRlU2Vzc2lvbnM6IGFzeW5jICh1c2VySWRPclNlc3Npb25Ub2tlbnMpID0+IHtcbiAgICAgIGlmIChzZWNvbmRhcnlTdG9yYWdlKSB7XG4gICAgICAgIGlmICh0eXBlb2YgdXNlcklkT3JTZXNzaW9uVG9rZW5zID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgY29uc3QgYWN0aXZlU2Vzc2lvbiA9IGF3YWl0IHNlY29uZGFyeVN0b3JhZ2UuZ2V0KFxuICAgICAgICAgICAgYGFjdGl2ZS1zZXNzaW9ucy0ke3VzZXJJZE9yU2Vzc2lvblRva2Vuc31gXG4gICAgICAgICAgKTtcbiAgICAgICAgICBjb25zdCBzZXNzaW9ucyA9IGFjdGl2ZVNlc3Npb24gPyBzYWZlSlNPTlBhcnNlKGFjdGl2ZVNlc3Npb24pIDogW107XG4gICAgICAgICAgaWYgKCFzZXNzaW9ucykgcmV0dXJuO1xuICAgICAgICAgIGZvciAoY29uc3Qgc2Vzc2lvbiBvZiBzZXNzaW9ucykge1xuICAgICAgICAgICAgYXdhaXQgc2Vjb25kYXJ5U3RvcmFnZS5kZWxldGUoc2Vzc2lvbi50b2tlbik7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGZvciAoY29uc3Qgc2Vzc2lvblRva2VuIG9mIHVzZXJJZE9yU2Vzc2lvblRva2Vucykge1xuICAgICAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IHNlY29uZGFyeVN0b3JhZ2UuZ2V0KHNlc3Npb25Ub2tlbik7XG4gICAgICAgICAgICBpZiAoc2Vzc2lvbikge1xuICAgICAgICAgICAgICBhd2FpdCBzZWNvbmRhcnlTdG9yYWdlLmRlbGV0ZShzZXNzaW9uVG9rZW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIW9wdGlvbnMuc2Vzc2lvbj8uc3RvcmVTZXNzaW9uSW5EYXRhYmFzZSB8fCBjdHgub3B0aW9ucy5zZXNzaW9uPy5wcmVzZXJ2ZVNlc3Npb25JbkRhdGFiYXNlKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBhd2FpdCBhZGFwdGVyLmRlbGV0ZU1hbnkoe1xuICAgICAgICBtb2RlbDogXCJzZXNzaW9uXCIsXG4gICAgICAgIHdoZXJlOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6IEFycmF5LmlzQXJyYXkodXNlcklkT3JTZXNzaW9uVG9rZW5zKSA/IFwidG9rZW5cIiA6IFwidXNlcklkXCIsXG4gICAgICAgICAgICB2YWx1ZTogdXNlcklkT3JTZXNzaW9uVG9rZW5zLFxuICAgICAgICAgICAgb3BlcmF0b3I6IEFycmF5LmlzQXJyYXkodXNlcklkT3JTZXNzaW9uVG9rZW5zKSA/IFwiaW5cIiA6IHZvaWQgMFxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfSk7XG4gICAgfSxcbiAgICBmaW5kT0F1dGhVc2VyOiBhc3luYyAoZW1haWwsIGFjY291bnRJZCwgcHJvdmlkZXJJZCkgPT4ge1xuICAgICAgY29uc3QgYWNjb3VudCA9IGF3YWl0IGFkYXB0ZXIuZmluZE1hbnkoe1xuICAgICAgICBtb2RlbDogXCJhY2NvdW50XCIsXG4gICAgICAgIHdoZXJlOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6IGFjY291bnRJZCxcbiAgICAgICAgICAgIGZpZWxkOiBcImFjY291bnRJZFwiXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9KS50aGVuKChhY2NvdW50cykgPT4ge1xuICAgICAgICByZXR1cm4gYWNjb3VudHMuZmluZCgoYSkgPT4gYS5wcm92aWRlcklkID09PSBwcm92aWRlcklkKTtcbiAgICAgIH0pO1xuICAgICAgaWYgKGFjY291bnQpIHtcbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IGFkYXB0ZXIuZmluZE9uZSh7XG4gICAgICAgICAgbW9kZWw6IFwidXNlclwiLFxuICAgICAgICAgIHdoZXJlOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHZhbHVlOiBhY2NvdW50LnVzZXJJZCxcbiAgICAgICAgICAgICAgZmllbGQ6IFwiaWRcIlxuICAgICAgICAgICAgfVxuICAgICAgICAgIF1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHVzZXIsXG4gICAgICAgICAgICBhY2NvdW50czogW2FjY291bnRdXG4gICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCB1c2VyMiA9IGF3YWl0IGFkYXB0ZXIuZmluZE9uZSh7XG4gICAgICAgICAgICBtb2RlbDogXCJ1c2VyXCIsXG4gICAgICAgICAgICB3aGVyZTogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IGVtYWlsLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICAgICAgZmllbGQ6IFwiZW1haWxcIlxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBdXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaWYgKHVzZXIyKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICB1c2VyOiB1c2VyMixcbiAgICAgICAgICAgICAgYWNjb3VudHM6IFthY2NvdW50XVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBhZGFwdGVyLmZpbmRPbmUoe1xuICAgICAgICAgIG1vZGVsOiBcInVzZXJcIixcbiAgICAgICAgICB3aGVyZTogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB2YWx1ZTogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgZmllbGQ6IFwiZW1haWxcIlxuICAgICAgICAgICAgfVxuICAgICAgICAgIF1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgICAgY29uc3QgYWNjb3VudHMgPSBhd2FpdCBhZGFwdGVyLmZpbmRNYW55KHtcbiAgICAgICAgICAgIG1vZGVsOiBcImFjY291bnRcIixcbiAgICAgICAgICAgIHdoZXJlOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogdXNlci5pZCxcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJ1c2VySWRcIlxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBdXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHVzZXIsXG4gICAgICAgICAgICBhY2NvdW50czogYWNjb3VudHMgfHwgW11cbiAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBmaW5kVXNlckJ5RW1haWw6IGFzeW5jIChlbWFpbCwgb3B0aW9uczIpID0+IHtcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBhZGFwdGVyLmZpbmRPbmUoe1xuICAgICAgICBtb2RlbDogXCJ1c2VyXCIsXG4gICAgICAgIHdoZXJlOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6IGVtYWlsLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICBmaWVsZDogXCJlbWFpbFwiXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9KTtcbiAgICAgIGlmICghdXNlcikgcmV0dXJuIG51bGw7XG4gICAgICBpZiAob3B0aW9uczI/LmluY2x1ZGVBY2NvdW50cykge1xuICAgICAgICBjb25zdCBhY2NvdW50cyA9IGF3YWl0IGFkYXB0ZXIuZmluZE1hbnkoe1xuICAgICAgICAgIG1vZGVsOiBcImFjY291bnRcIixcbiAgICAgICAgICB3aGVyZTogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB2YWx1ZTogdXNlci5pZCxcbiAgICAgICAgICAgICAgZmllbGQ6IFwidXNlcklkXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICBdXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHVzZXIsXG4gICAgICAgICAgYWNjb3VudHNcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXIsXG4gICAgICAgIGFjY291bnRzOiBbXVxuICAgICAgfTtcbiAgICB9LFxuICAgIGZpbmRVc2VyQnlJZDogYXN5bmMgKHVzZXJJZCkgPT4ge1xuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IGFkYXB0ZXIuZmluZE9uZSh7XG4gICAgICAgIG1vZGVsOiBcInVzZXJcIixcbiAgICAgICAgd2hlcmU6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogXCJpZFwiLFxuICAgICAgICAgICAgdmFsdWU6IHVzZXJJZFxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gdXNlcjtcbiAgICB9LFxuICAgIGxpbmtBY2NvdW50OiBhc3luYyAoYWNjb3VudCwgY29udGV4dCkgPT4ge1xuICAgICAgY29uc3QgX2FjY291bnQgPSBhd2FpdCBjcmVhdGVXaXRoSG9va3MoXG4gICAgICAgIHtcbiAgICAgICAgICAuLi5hY2NvdW50LFxuICAgICAgICAgIGNyZWF0ZWRBdDogLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCksXG4gICAgICAgICAgdXBkYXRlZEF0OiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKVxuICAgICAgICB9LFxuICAgICAgICBcImFjY291bnRcIixcbiAgICAgICAgdm9pZCAwLFxuICAgICAgICBjb250ZXh0XG4gICAgICApO1xuICAgICAgcmV0dXJuIF9hY2NvdW50O1xuICAgIH0sXG4gICAgdXBkYXRlVXNlcjogYXN5bmMgKHVzZXJJZCwgZGF0YSwgY29udGV4dCkgPT4ge1xuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHVwZGF0ZVdpdGhIb29rcyhcbiAgICAgICAgZGF0YSxcbiAgICAgICAgW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiBcImlkXCIsXG4gICAgICAgICAgICB2YWx1ZTogdXNlcklkXG4gICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBcInVzZXJcIixcbiAgICAgICAgdm9pZCAwLFxuICAgICAgICBjb250ZXh0XG4gICAgICApO1xuICAgICAgaWYgKHNlY29uZGFyeVN0b3JhZ2UgJiYgdXNlcikge1xuICAgICAgICBjb25zdCBsaXN0UmF3ID0gYXdhaXQgc2Vjb25kYXJ5U3RvcmFnZS5nZXQoYGFjdGl2ZS1zZXNzaW9ucy0ke3VzZXJJZH1gKTtcbiAgICAgICAgaWYgKGxpc3RSYXcpIHtcbiAgICAgICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgICAgICAgIGNvbnN0IGxpc3QgPSBzYWZlSlNPTlBhcnNlKGxpc3RSYXcpIHx8IFtdO1xuICAgICAgICAgIGNvbnN0IHZhbGlkU2Vzc2lvbnMgPSBsaXN0LmZpbHRlcigocykgPT4gcy5leHBpcmVzQXQgPiBub3cpO1xuICAgICAgICAgIGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgICAgICAgdmFsaWRTZXNzaW9ucy5tYXAoYXN5bmMgKHsgdG9rZW4gfSkgPT4ge1xuICAgICAgICAgICAgICBjb25zdCBjYWNoZWQgPSBhd2FpdCBzZWNvbmRhcnlTdG9yYWdlLmdldCh0b2tlbik7XG4gICAgICAgICAgICAgIGlmICghY2FjaGVkKSByZXR1cm47XG4gICAgICAgICAgICAgIGNvbnN0IHBhcnNlZCA9IHNhZmVKU09OUGFyc2UoY2FjaGVkKTtcbiAgICAgICAgICAgICAgaWYgKCFwYXJzZWQpIHJldHVybjtcbiAgICAgICAgICAgICAgY29uc3Qgc2Vzc2lvblRUTCA9IE1hdGgubWF4KFxuICAgICAgICAgICAgICAgIE1hdGguZmxvb3IoXG4gICAgICAgICAgICAgICAgICAobmV3IERhdGUocGFyc2VkLnNlc3Npb24uZXhwaXJlc0F0KS5nZXRUaW1lKCkgLSBub3cpIC8gMWUzXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAwXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIGF3YWl0IHNlY29uZGFyeVN0b3JhZ2Uuc2V0KFxuICAgICAgICAgICAgICAgIHRva2VuLFxuICAgICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICAgIHNlc3Npb246IHBhcnNlZC5zZXNzaW9uLFxuICAgICAgICAgICAgICAgICAgdXNlclxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIHNlc3Npb25UVExcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHVzZXI7XG4gICAgfSxcbiAgICB1cGRhdGVVc2VyQnlFbWFpbDogYXN5bmMgKGVtYWlsLCBkYXRhLCBjb250ZXh0KSA9PiB7XG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgdXBkYXRlV2l0aEhvb2tzKFxuICAgICAgICBkYXRhLFxuICAgICAgICBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6IFwiZW1haWxcIixcbiAgICAgICAgICAgIHZhbHVlOiBlbWFpbC50b0xvd2VyQ2FzZSgpXG4gICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBcInVzZXJcIixcbiAgICAgICAgdm9pZCAwLFxuICAgICAgICBjb250ZXh0XG4gICAgICApO1xuICAgICAgcmV0dXJuIHVzZXI7XG4gICAgfSxcbiAgICB1cGRhdGVQYXNzd29yZDogYXN5bmMgKHVzZXJJZCwgcGFzc3dvcmQsIGNvbnRleHQpID0+IHtcbiAgICAgIGF3YWl0IHVwZGF0ZU1hbnlXaXRoSG9va3MoXG4gICAgICAgIHtcbiAgICAgICAgICBwYXNzd29yZFxuICAgICAgICB9LFxuICAgICAgICBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6IFwidXNlcklkXCIsXG4gICAgICAgICAgICB2YWx1ZTogdXNlcklkXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogXCJwcm92aWRlcklkXCIsXG4gICAgICAgICAgICB2YWx1ZTogXCJjcmVkZW50aWFsXCJcbiAgICAgICAgICB9XG4gICAgICAgIF0sXG4gICAgICAgIFwiYWNjb3VudFwiLFxuICAgICAgICB2b2lkIDAsXG4gICAgICAgIGNvbnRleHRcbiAgICAgICk7XG4gICAgfSxcbiAgICBmaW5kQWNjb3VudHM6IGFzeW5jICh1c2VySWQpID0+IHtcbiAgICAgIGNvbnN0IGFjY291bnRzID0gYXdhaXQgYWRhcHRlci5maW5kTWFueSh7XG4gICAgICAgIG1vZGVsOiBcImFjY291bnRcIixcbiAgICAgICAgd2hlcmU6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogXCJ1c2VySWRcIixcbiAgICAgICAgICAgIHZhbHVlOiB1c2VySWRcbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGFjY291bnRzO1xuICAgIH0sXG4gICAgZmluZEFjY291bnQ6IGFzeW5jIChhY2NvdW50SWQpID0+IHtcbiAgICAgIGNvbnN0IGFjY291bnQgPSBhd2FpdCBhZGFwdGVyLmZpbmRPbmUoe1xuICAgICAgICBtb2RlbDogXCJhY2NvdW50XCIsXG4gICAgICAgIHdoZXJlOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6IFwiYWNjb3VudElkXCIsXG4gICAgICAgICAgICB2YWx1ZTogYWNjb3VudElkXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBhY2NvdW50O1xuICAgIH0sXG4gICAgZmluZEFjY291bnRCeVByb3ZpZGVySWQ6IGFzeW5jIChhY2NvdW50SWQsIHByb3ZpZGVySWQpID0+IHtcbiAgICAgIGNvbnN0IGFjY291bnQgPSBhd2FpdCBhZGFwdGVyLmZpbmRPbmUoe1xuICAgICAgICBtb2RlbDogXCJhY2NvdW50XCIsXG4gICAgICAgIHdoZXJlOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6IFwiYWNjb3VudElkXCIsXG4gICAgICAgICAgICB2YWx1ZTogYWNjb3VudElkXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogXCJwcm92aWRlcklkXCIsXG4gICAgICAgICAgICB2YWx1ZTogcHJvdmlkZXJJZFxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gYWNjb3VudDtcbiAgICB9LFxuICAgIGZpbmRBY2NvdW50QnlVc2VySWQ6IGFzeW5jICh1c2VySWQpID0+IHtcbiAgICAgIGNvbnN0IGFjY291bnQgPSBhd2FpdCBhZGFwdGVyLmZpbmRNYW55KHtcbiAgICAgICAgbW9kZWw6IFwiYWNjb3VudFwiLFxuICAgICAgICB3aGVyZTogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiBcInVzZXJJZFwiLFxuICAgICAgICAgICAgdmFsdWU6IHVzZXJJZFxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gYWNjb3VudDtcbiAgICB9LFxuICAgIHVwZGF0ZUFjY291bnQ6IGFzeW5jIChpZCwgZGF0YSwgY29udGV4dCkgPT4ge1xuICAgICAgY29uc3QgYWNjb3VudCA9IGF3YWl0IHVwZGF0ZVdpdGhIb29rcyhcbiAgICAgICAgZGF0YSxcbiAgICAgICAgW3sgZmllbGQ6IFwiaWRcIiwgdmFsdWU6IGlkIH1dLFxuICAgICAgICBcImFjY291bnRcIixcbiAgICAgICAgdm9pZCAwLFxuICAgICAgICBjb250ZXh0XG4gICAgICApO1xuICAgICAgcmV0dXJuIGFjY291bnQ7XG4gICAgfSxcbiAgICBjcmVhdGVWZXJpZmljYXRpb25WYWx1ZTogYXN5bmMgKGRhdGEsIGNvbnRleHQpID0+IHtcbiAgICAgIGNvbnN0IHZlcmlmaWNhdGlvbiA9IGF3YWl0IGNyZWF0ZVdpdGhIb29rcyhcbiAgICAgICAge1xuICAgICAgICAgIGNyZWF0ZWRBdDogLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCksXG4gICAgICAgICAgdXBkYXRlZEF0OiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSxcbiAgICAgICAgICAuLi5kYXRhXG4gICAgICAgIH0sXG4gICAgICAgIFwidmVyaWZpY2F0aW9uXCIsXG4gICAgICAgIHZvaWQgMCxcbiAgICAgICAgY29udGV4dFxuICAgICAgKTtcbiAgICAgIHJldHVybiB2ZXJpZmljYXRpb247XG4gICAgfSxcbiAgICBmaW5kVmVyaWZpY2F0aW9uVmFsdWU6IGFzeW5jIChpZGVudGlmaWVyKSA9PiB7XG4gICAgICBjb25zdCB2ZXJpZmljYXRpb24gPSBhd2FpdCBhZGFwdGVyLmZpbmRNYW55KHtcbiAgICAgICAgbW9kZWw6IFwidmVyaWZpY2F0aW9uXCIsXG4gICAgICAgIHdoZXJlOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6IFwiaWRlbnRpZmllclwiLFxuICAgICAgICAgICAgdmFsdWU6IGlkZW50aWZpZXJcbiAgICAgICAgICB9XG4gICAgICAgIF0sXG4gICAgICAgIHNvcnRCeToge1xuICAgICAgICAgIGZpZWxkOiBcImNyZWF0ZWRBdFwiLFxuICAgICAgICAgIGRpcmVjdGlvbjogXCJkZXNjXCJcbiAgICAgICAgfSxcbiAgICAgICAgbGltaXQ6IDFcbiAgICAgIH0pO1xuICAgICAgaWYgKCFvcHRpb25zLnZlcmlmaWNhdGlvbj8uZGlzYWJsZUNsZWFudXApIHtcbiAgICAgICAgYXdhaXQgYWRhcHRlci5kZWxldGVNYW55KHtcbiAgICAgICAgICBtb2RlbDogXCJ2ZXJpZmljYXRpb25cIixcbiAgICAgICAgICB3aGVyZTogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBmaWVsZDogXCJleHBpcmVzQXRcIixcbiAgICAgICAgICAgICAgdmFsdWU6IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgICBvcGVyYXRvcjogXCJsdFwiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGxhc3RWZXJpZmljYXRpb24gPSB2ZXJpZmljYXRpb25bMF07XG4gICAgICByZXR1cm4gbGFzdFZlcmlmaWNhdGlvbjtcbiAgICB9LFxuICAgIGRlbGV0ZVZlcmlmaWNhdGlvblZhbHVlOiBhc3luYyAoaWQpID0+IHtcbiAgICAgIGF3YWl0IGFkYXB0ZXIuZGVsZXRlKHtcbiAgICAgICAgbW9kZWw6IFwidmVyaWZpY2F0aW9uXCIsXG4gICAgICAgIHdoZXJlOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6IFwiaWRcIixcbiAgICAgICAgICAgIHZhbHVlOiBpZFxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfSk7XG4gICAgfSxcbiAgICBkZWxldGVWZXJpZmljYXRpb25CeUlkZW50aWZpZXI6IGFzeW5jIChpZGVudGlmaWVyKSA9PiB7XG4gICAgICBhd2FpdCBhZGFwdGVyLmRlbGV0ZSh7XG4gICAgICAgIG1vZGVsOiBcInZlcmlmaWNhdGlvblwiLFxuICAgICAgICB3aGVyZTogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiBcImlkZW50aWZpZXJcIixcbiAgICAgICAgICAgIHZhbHVlOiBpZGVudGlmaWVyXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9KTtcbiAgICB9LFxuICAgIHVwZGF0ZVZlcmlmaWNhdGlvblZhbHVlOiBhc3luYyAoaWQsIGRhdGEsIGNvbnRleHQpID0+IHtcbiAgICAgIGNvbnN0IHZlcmlmaWNhdGlvbiA9IGF3YWl0IHVwZGF0ZVdpdGhIb29rcyhcbiAgICAgICAgZGF0YSxcbiAgICAgICAgW3sgZmllbGQ6IFwiaWRcIiwgdmFsdWU6IGlkIH1dLFxuICAgICAgICBcInZlcmlmaWNhdGlvblwiLFxuICAgICAgICB2b2lkIDAsXG4gICAgICAgIGNvbnRleHRcbiAgICAgICk7XG4gICAgICByZXR1cm4gdmVyaWZpY2F0aW9uO1xuICAgIH1cbiAgfTtcbn07XG5cbmFzeW5jIGZ1bmN0aW9uIGdldEFkYXB0ZXIob3B0aW9ucykge1xuICBpZiAoIW9wdGlvbnMuZGF0YWJhc2UpIHtcbiAgICBjb25zdCB0YWJsZXMgPSBnZXRBdXRoVGFibGVzKG9wdGlvbnMpO1xuICAgIGNvbnN0IG1lbW9yeURCID0gT2JqZWN0LmtleXModGFibGVzKS5yZWR1Y2UoKGFjYywga2V5KSA9PiB7XG4gICAgICBhY2Nba2V5XSA9IFtdO1xuICAgICAgcmV0dXJuIGFjYztcbiAgICB9LCB7fSk7XG4gICAgbG9nZ2VyLndhcm4oXG4gICAgICBcIk5vIGRhdGFiYXNlIGNvbmZpZ3VyYXRpb24gcHJvdmlkZWQuIFVzaW5nIG1lbW9yeSBhZGFwdGVyIGluIGRldmVsb3BtZW50XCJcbiAgICApO1xuICAgIHJldHVybiBtZW1vcnlBZGFwdGVyKG1lbW9yeURCKShvcHRpb25zKTtcbiAgfVxuICBpZiAodHlwZW9mIG9wdGlvbnMuZGF0YWJhc2UgPT09IFwiZnVuY3Rpb25cIikge1xuICAgIHJldHVybiBvcHRpb25zLmRhdGFiYXNlKG9wdGlvbnMpO1xuICB9XG4gIGNvbnN0IHsga3lzZWx5LCBkYXRhYmFzZVR5cGUgfSA9IGF3YWl0IGNyZWF0ZUt5c2VseUFkYXB0ZXIob3B0aW9ucyk7XG4gIGlmICgha3lzZWx5KSB7XG4gICAgdGhyb3cgbmV3IEJldHRlckF1dGhFcnJvcihcIkZhaWxlZCB0byBpbml0aWFsaXplIGRhdGFiYXNlIGFkYXB0ZXJcIik7XG4gIH1cbiAgcmV0dXJuIGt5c2VseUFkYXB0ZXIoa3lzZWx5LCB7XG4gICAgdHlwZTogZGF0YWJhc2VUeXBlIHx8IFwic3FsaXRlXCIsXG4gICAgZGVidWdMb2dzOiBcImRlYnVnTG9nc1wiIGluIG9wdGlvbnMuZGF0YWJhc2UgPyBvcHRpb25zLmRhdGFiYXNlLmRlYnVnTG9ncyA6IGZhbHNlXG4gIH0pKG9wdGlvbnMpO1xufVxuZnVuY3Rpb24gY29udmVydFRvREIoZmllbGRzLCB2YWx1ZXMpIHtcbiAgbGV0IHJlc3VsdCA9IHZhbHVlcy5pZCA/IHtcbiAgICBpZDogdmFsdWVzLmlkXG4gIH0gOiB7fTtcbiAgZm9yIChjb25zdCBrZXkgaW4gZmllbGRzKSB7XG4gICAgY29uc3QgZmllbGQgPSBmaWVsZHNba2V5XTtcbiAgICBjb25zdCB2YWx1ZSA9IHZhbHVlc1trZXldO1xuICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgcmVzdWx0W2ZpZWxkLmZpZWxkTmFtZSB8fCBrZXldID0gdmFsdWU7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cbmZ1bmN0aW9uIGNvbnZlcnRGcm9tREIoZmllbGRzLCB2YWx1ZXMpIHtcbiAgaWYgKCF2YWx1ZXMpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBsZXQgcmVzdWx0ID0ge1xuICAgIGlkOiB2YWx1ZXMuaWRcbiAgfTtcbiAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoZmllbGRzKSkge1xuICAgIHJlc3VsdFtrZXldID0gdmFsdWVzW3ZhbHVlLmZpZWxkTmFtZSB8fCBrZXldO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIGdldFNjaGVtYShjb25maWcpIHtcbiAgY29uc3QgdGFibGVzID0gZ2V0QXV0aFRhYmxlcyhjb25maWcpO1xuICBsZXQgc2NoZW1hID0ge307XG4gIGZvciAoY29uc3Qga2V5IGluIHRhYmxlcykge1xuICAgIGNvbnN0IHRhYmxlID0gdGFibGVzW2tleV07XG4gICAgY29uc3QgZmllbGRzID0gdGFibGUuZmllbGRzO1xuICAgIGxldCBhY3R1YWxGaWVsZHMgPSB7fTtcbiAgICBPYmplY3QuZW50cmllcyhmaWVsZHMpLmZvckVhY2goKFtrZXkyLCBmaWVsZF0pID0+IHtcbiAgICAgIGFjdHVhbEZpZWxkc1tmaWVsZC5maWVsZE5hbWUgfHwga2V5Ml0gPSBmaWVsZDtcbiAgICAgIGlmIChmaWVsZC5yZWZlcmVuY2VzKSB7XG4gICAgICAgIGNvbnN0IHJlZlRhYmxlID0gdGFibGVzW2ZpZWxkLnJlZmVyZW5jZXMubW9kZWxdO1xuICAgICAgICBpZiAocmVmVGFibGUpIHtcbiAgICAgICAgICBhY3R1YWxGaWVsZHNbZmllbGQuZmllbGROYW1lIHx8IGtleTJdLnJlZmVyZW5jZXMgPSB7XG4gICAgICAgICAgICBtb2RlbDogcmVmVGFibGUubW9kZWxOYW1lLFxuICAgICAgICAgICAgZmllbGQ6IGZpZWxkLnJlZmVyZW5jZXMuZmllbGRcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgaWYgKHNjaGVtYVt0YWJsZS5tb2RlbE5hbWVdKSB7XG4gICAgICBzY2hlbWFbdGFibGUubW9kZWxOYW1lXS5maWVsZHMgPSB7XG4gICAgICAgIC4uLnNjaGVtYVt0YWJsZS5tb2RlbE5hbWVdLmZpZWxkcyxcbiAgICAgICAgLi4uYWN0dWFsRmllbGRzXG4gICAgICB9O1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIHNjaGVtYVt0YWJsZS5tb2RlbE5hbWVdID0ge1xuICAgICAgZmllbGRzOiBhY3R1YWxGaWVsZHMsXG4gICAgICBvcmRlcjogdGFibGUub3JkZXIgfHwgSW5maW5pdHlcbiAgICB9O1xuICB9XG4gIHJldHVybiBzY2hlbWE7XG59XG5cbmNvbnN0IHBvc3RncmVzTWFwID0ge1xuICBzdHJpbmc6IFtcImNoYXJhY3RlciB2YXJ5aW5nXCIsIFwidmFyY2hhclwiLCBcInRleHRcIl0sXG4gIG51bWJlcjogW1xuICAgIFwiaW50NFwiLFxuICAgIFwiaW50ZWdlclwiLFxuICAgIFwiYmlnaW50XCIsXG4gICAgXCJzbWFsbGludFwiLFxuICAgIFwibnVtZXJpY1wiLFxuICAgIFwicmVhbFwiLFxuICAgIFwiZG91YmxlIHByZWNpc2lvblwiXG4gIF0sXG4gIGJvb2xlYW46IFtcImJvb2xcIiwgXCJib29sZWFuXCJdLFxuICBkYXRlOiBbXCJ0aW1lc3RhbXBcIiwgXCJkYXRlXCJdXG59O1xuY29uc3QgbXlzcWxNYXAgPSB7XG4gIHN0cmluZzogW1widmFyY2hhclwiLCBcInRleHRcIl0sXG4gIG51bWJlcjogW1xuICAgIFwiaW50ZWdlclwiLFxuICAgIFwiaW50XCIsXG4gICAgXCJiaWdpbnRcIixcbiAgICBcInNtYWxsaW50XCIsXG4gICAgXCJkZWNpbWFsXCIsXG4gICAgXCJmbG9hdFwiLFxuICAgIFwiZG91YmxlXCJcbiAgXSxcbiAgYm9vbGVhbjogW1wiYm9vbGVhblwiLCBcInRpbnlpbnRcIl0sXG4gIGRhdGU6IFtcInRpbWVzdGFtcFwiLCBcImRhdGV0aW1lXCIsIFwiZGF0ZVwiXVxufTtcbmNvbnN0IHNxbGl0ZU1hcCA9IHtcbiAgc3RyaW5nOiBbXCJURVhUXCJdLFxuICBudW1iZXI6IFtcIklOVEVHRVJcIiwgXCJSRUFMXCJdLFxuICBib29sZWFuOiBbXCJJTlRFR0VSXCIsIFwiQk9PTEVBTlwiXSxcbiAgLy8gMCBvciAxXG4gIGRhdGU6IFtcIkRBVEVcIiwgXCJJTlRFR0VSXCJdXG59O1xuY29uc3QgbXNzcWxNYXAgPSB7XG4gIHN0cmluZzogW1widGV4dFwiLCBcInZhcmNoYXJcIl0sXG4gIG51bWJlcjogW1wiaW50XCIsIFwiYmlnaW50XCIsIFwic21hbGxpbnRcIiwgXCJkZWNpbWFsXCIsIFwiZmxvYXRcIiwgXCJkb3VibGVcIl0sXG4gIGJvb2xlYW46IFtcImJpdFwiLCBcInNtYWxsaW50XCJdLFxuICBkYXRlOiBbXCJkYXRldGltZVwiLCBcImRhdGVcIl1cbn07XG5jb25zdCBtYXAgPSB7XG4gIHBvc3RncmVzOiBwb3N0Z3Jlc01hcCxcbiAgbXlzcWw6IG15c3FsTWFwLFxuICBzcWxpdGU6IHNxbGl0ZU1hcCxcbiAgbXNzcWw6IG1zc3FsTWFwXG59O1xuZnVuY3Rpb24gbWF0Y2hUeXBlKGNvbHVtbkRhdGFUeXBlLCBmaWVsZFR5cGUsIGRiVHlwZSkge1xuICBmdW5jdGlvbiBub3JtYWxpemUodHlwZSkge1xuICAgIHJldHVybiB0eXBlLnRvTG93ZXJDYXNlKCkuc3BsaXQoXCIoXCIpWzBdLnRyaW0oKTtcbiAgfVxuICBpZiAoZmllbGRUeXBlID09PSBcInN0cmluZ1tdXCIgfHwgZmllbGRUeXBlID09PSBcIm51bWJlcltdXCIpIHtcbiAgICByZXR1cm4gY29sdW1uRGF0YVR5cGUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhcImpzb25cIik7XG4gIH1cbiAgY29uc3QgdHlwZXMgPSBtYXBbZGJUeXBlXTtcbiAgY29uc3QgZXhwZWN0ZWQgPSBBcnJheS5pc0FycmF5KGZpZWxkVHlwZSkgPyB0eXBlc1tcInN0cmluZ1wiXS5tYXAoKHQpID0+IHQudG9Mb3dlckNhc2UoKSkgOiB0eXBlc1tmaWVsZFR5cGVdLm1hcCgodCkgPT4gdC50b0xvd2VyQ2FzZSgpKTtcbiAgcmV0dXJuIGV4cGVjdGVkLmluY2x1ZGVzKG5vcm1hbGl6ZShjb2x1bW5EYXRhVHlwZSkpO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0TWlncmF0aW9ucyhjb25maWcpIHtcbiAgY29uc3QgYmV0dGVyQXV0aFNjaGVtYSA9IGdldFNjaGVtYShjb25maWcpO1xuICBjb25zdCBsb2dnZXIgPSBjcmVhdGVMb2dnZXIoY29uZmlnLmxvZ2dlcik7XG4gIGxldCB7IGt5c2VseTogZGIsIGRhdGFiYXNlVHlwZTogZGJUeXBlIH0gPSBhd2FpdCBjcmVhdGVLeXNlbHlBZGFwdGVyKGNvbmZpZyk7XG4gIGlmICghZGJUeXBlKSB7XG4gICAgbG9nZ2VyLndhcm4oXG4gICAgICBcIkNvdWxkIG5vdCBkZXRlcm1pbmUgZGF0YWJhc2UgdHlwZSwgZGVmYXVsdGluZyB0byBzcWxpdGUuIFBsZWFzZSBwcm92aWRlIGEgdHlwZSBpbiB0aGUgZGF0YWJhc2Ugb3B0aW9ucyB0byBhdm9pZCB0aGlzLlwiXG4gICAgKTtcbiAgICBkYlR5cGUgPSBcInNxbGl0ZVwiO1xuICB9XG4gIGlmICghZGIpIHtcbiAgICBsb2dnZXIuZXJyb3IoXG4gICAgICBcIk9ubHkga3lzZWx5IGFkYXB0ZXIgaXMgc3VwcG9ydGVkIGZvciBtaWdyYXRpb25zLiBZb3UgY2FuIHVzZSBgZ2VuZXJhdGVgIGNvbW1hbmQgdG8gZ2VuZXJhdGUgdGhlIHNjaGVtYSwgaWYgeW91J3JlIHVzaW5nIGEgZGlmZmVyZW50IGFkYXB0ZXIuXCJcbiAgICApO1xuICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgfVxuICBjb25zdCB0YWJsZU1ldGFkYXRhID0gYXdhaXQgZGIuaW50cm9zcGVjdGlvbi5nZXRUYWJsZXMoKTtcbiAgY29uc3QgdG9CZUNyZWF0ZWQgPSBbXTtcbiAgY29uc3QgdG9CZUFkZGVkID0gW107XG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGJldHRlckF1dGhTY2hlbWEpKSB7XG4gICAgY29uc3QgdGFibGUgPSB0YWJsZU1ldGFkYXRhLmZpbmQoKHQpID0+IHQubmFtZSA9PT0ga2V5KTtcbiAgICBpZiAoIXRhYmxlKSB7XG4gICAgICBjb25zdCB0SW5kZXggPSB0b0JlQ3JlYXRlZC5maW5kSW5kZXgoKHQpID0+IHQudGFibGUgPT09IGtleSk7XG4gICAgICBjb25zdCB0YWJsZURhdGEgPSB7XG4gICAgICAgIHRhYmxlOiBrZXksXG4gICAgICAgIGZpZWxkczogdmFsdWUuZmllbGRzLFxuICAgICAgICBvcmRlcjogdmFsdWUub3JkZXIgfHwgSW5maW5pdHlcbiAgICAgIH07XG4gICAgICBjb25zdCBpbnNlcnRJbmRleCA9IHRvQmVDcmVhdGVkLmZpbmRJbmRleChcbiAgICAgICAgKHQpID0+ICh0Lm9yZGVyIHx8IEluZmluaXR5KSA+IHRhYmxlRGF0YS5vcmRlclxuICAgICAgKTtcbiAgICAgIGlmIChpbnNlcnRJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgaWYgKHRJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICB0b0JlQ3JlYXRlZC5wdXNoKHRhYmxlRGF0YSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdG9CZUNyZWF0ZWRbdEluZGV4XS5maWVsZHMgPSB7XG4gICAgICAgICAgICAuLi50b0JlQ3JlYXRlZFt0SW5kZXhdLmZpZWxkcyxcbiAgICAgICAgICAgIC4uLnZhbHVlLmZpZWxkc1xuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRvQmVDcmVhdGVkLnNwbGljZShpbnNlcnRJbmRleCwgMCwgdGFibGVEYXRhKTtcbiAgICAgIH1cbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBsZXQgdG9CZUFkZGVkRmllbGRzID0ge307XG4gICAgZm9yIChjb25zdCBbZmllbGROYW1lLCBmaWVsZF0gb2YgT2JqZWN0LmVudHJpZXModmFsdWUuZmllbGRzKSkge1xuICAgICAgY29uc3QgY29sdW1uID0gdGFibGUuY29sdW1ucy5maW5kKChjKSA9PiBjLm5hbWUgPT09IGZpZWxkTmFtZSk7XG4gICAgICBpZiAoIWNvbHVtbikge1xuICAgICAgICB0b0JlQWRkZWRGaWVsZHNbZmllbGROYW1lXSA9IGZpZWxkO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGlmIChtYXRjaFR5cGUoY29sdW1uLmRhdGFUeXBlLCBmaWVsZC50eXBlLCBkYlR5cGUpKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nZ2VyLndhcm4oXG4gICAgICAgICAgYEZpZWxkICR7ZmllbGROYW1lfSBpbiB0YWJsZSAke2tleX0gaGFzIGEgZGlmZmVyZW50IHR5cGUgaW4gdGhlIGRhdGFiYXNlLiBFeHBlY3RlZCAke2ZpZWxkLnR5cGV9IGJ1dCBnb3QgJHtjb2x1bW4uZGF0YVR5cGV9LmBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKE9iamVjdC5rZXlzKHRvQmVBZGRlZEZpZWxkcykubGVuZ3RoID4gMCkge1xuICAgICAgdG9CZUFkZGVkLnB1c2goe1xuICAgICAgICB0YWJsZToga2V5LFxuICAgICAgICBmaWVsZHM6IHRvQmVBZGRlZEZpZWxkcyxcbiAgICAgICAgb3JkZXI6IHZhbHVlLm9yZGVyIHx8IEluZmluaXR5XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgY29uc3QgbWlncmF0aW9ucyA9IFtdO1xuICBmdW5jdGlvbiBnZXRUeXBlKGZpZWxkLCBmaWVsZE5hbWUpIHtcbiAgICBjb25zdCB0eXBlID0gZmllbGQudHlwZTtcbiAgICBjb25zdCB0eXBlTWFwID0ge1xuICAgICAgc3RyaW5nOiB7XG4gICAgICAgIHNxbGl0ZTogXCJ0ZXh0XCIsXG4gICAgICAgIHBvc3RncmVzOiBcInRleHRcIixcbiAgICAgICAgbXlzcWw6IGZpZWxkLnVuaXF1ZSA/IFwidmFyY2hhcigyNTUpXCIgOiBmaWVsZC5yZWZlcmVuY2VzID8gXCJ2YXJjaGFyKDM2KVwiIDogXCJ0ZXh0XCIsXG4gICAgICAgIG1zc3FsOiBmaWVsZC51bmlxdWUgfHwgZmllbGQuc29ydGFibGUgPyBcInZhcmNoYXIoMjU1KVwiIDogZmllbGQucmVmZXJlbmNlcyA/IFwidmFyY2hhcigzNilcIiA6IFwidGV4dFwiXG4gICAgICB9LFxuICAgICAgYm9vbGVhbjoge1xuICAgICAgICBzcWxpdGU6IFwiaW50ZWdlclwiLFxuICAgICAgICBwb3N0Z3JlczogXCJib29sZWFuXCIsXG4gICAgICAgIG15c3FsOiBcImJvb2xlYW5cIixcbiAgICAgICAgbXNzcWw6IFwic21hbGxpbnRcIlxuICAgICAgfSxcbiAgICAgIG51bWJlcjoge1xuICAgICAgICBzcWxpdGU6IGZpZWxkLmJpZ2ludCA/IFwiYmlnaW50XCIgOiBcImludGVnZXJcIixcbiAgICAgICAgcG9zdGdyZXM6IGZpZWxkLmJpZ2ludCA/IFwiYmlnaW50XCIgOiBcImludGVnZXJcIixcbiAgICAgICAgbXlzcWw6IGZpZWxkLmJpZ2ludCA/IFwiYmlnaW50XCIgOiBcImludGVnZXJcIixcbiAgICAgICAgbXNzcWw6IGZpZWxkLmJpZ2ludCA/IFwiYmlnaW50XCIgOiBcImludGVnZXJcIlxuICAgICAgfSxcbiAgICAgIGRhdGU6IHtcbiAgICAgICAgc3FsaXRlOiBcImRhdGVcIixcbiAgICAgICAgcG9zdGdyZXM6IFwidGltZXN0YW1wXCIsXG4gICAgICAgIG15c3FsOiBcImRhdGV0aW1lXCIsXG4gICAgICAgIG1zc3FsOiBcImRhdGV0aW1lXCJcbiAgICAgIH0sXG4gICAgICBpZDoge1xuICAgICAgICBwb3N0Z3JlczogY29uZmlnLmFkdmFuY2VkPy5kYXRhYmFzZT8udXNlTnVtYmVySWQgPyBcInNlcmlhbFwiIDogXCJ0ZXh0XCIsXG4gICAgICAgIG15c3FsOiBjb25maWcuYWR2YW5jZWQ/LmRhdGFiYXNlPy51c2VOdW1iZXJJZCA/IFwiaW50ZWdlclwiIDogXCJ2YXJjaGFyKDM2KVwiLFxuICAgICAgICBtc3NxbDogY29uZmlnLmFkdmFuY2VkPy5kYXRhYmFzZT8udXNlTnVtYmVySWQgPyBcImludGVnZXJcIiA6IFwidmFyY2hhcigzNilcIixcbiAgICAgICAgc3FsaXRlOiBjb25maWcuYWR2YW5jZWQ/LmRhdGFiYXNlPy51c2VOdW1iZXJJZCA/IFwiaW50ZWdlclwiIDogXCJ0ZXh0XCJcbiAgICAgIH1cbiAgICB9O1xuICAgIGlmIChmaWVsZE5hbWUgPT09IFwiaWRcIiB8fCBmaWVsZC5yZWZlcmVuY2VzPy5maWVsZCA9PT0gXCJpZFwiKSB7XG4gICAgICByZXR1cm4gdHlwZU1hcC5pZFtkYlR5cGVdO1xuICAgIH1cbiAgICBpZiAoZGJUeXBlID09PSBcInNxbGl0ZVwiICYmICh0eXBlID09PSBcInN0cmluZ1tdXCIgfHwgdHlwZSA9PT0gXCJudW1iZXJbXVwiKSkge1xuICAgICAgcmV0dXJuIFwidGV4dFwiO1xuICAgIH1cbiAgICBpZiAodHlwZSA9PT0gXCJzdHJpbmdbXVwiIHx8IHR5cGUgPT09IFwibnVtYmVyW11cIikge1xuICAgICAgcmV0dXJuIFwianNvbmJcIjtcbiAgICB9XG4gICAgaWYgKEFycmF5LmlzQXJyYXkodHlwZSkpIHtcbiAgICAgIHJldHVybiBcInRleHRcIjtcbiAgICB9XG4gICAgcmV0dXJuIHR5cGVNYXBbdHlwZV1bZGJUeXBlIHx8IFwic3FsaXRlXCJdO1xuICB9XG4gIGlmICh0b0JlQWRkZWQubGVuZ3RoKSB7XG4gICAgZm9yIChjb25zdCB0YWJsZSBvZiB0b0JlQWRkZWQpIHtcbiAgICAgIGZvciAoY29uc3QgW2ZpZWxkTmFtZSwgZmllbGRdIG9mIE9iamVjdC5lbnRyaWVzKHRhYmxlLmZpZWxkcykpIHtcbiAgICAgICAgY29uc3QgdHlwZSA9IGdldFR5cGUoZmllbGQsIGZpZWxkTmFtZSk7XG4gICAgICAgIGNvbnN0IGV4ZWMgPSBkYi5zY2hlbWEuYWx0ZXJUYWJsZSh0YWJsZS50YWJsZSkuYWRkQ29sdW1uKGZpZWxkTmFtZSwgdHlwZSwgKGNvbCkgPT4ge1xuICAgICAgICAgIGNvbCA9IGZpZWxkLnJlcXVpcmVkICE9PSBmYWxzZSA/IGNvbC5ub3ROdWxsKCkgOiBjb2w7XG4gICAgICAgICAgaWYgKGZpZWxkLnJlZmVyZW5jZXMpIHtcbiAgICAgICAgICAgIGNvbCA9IGNvbC5yZWZlcmVuY2VzKFxuICAgICAgICAgICAgICBgJHtmaWVsZC5yZWZlcmVuY2VzLm1vZGVsfS4ke2ZpZWxkLnJlZmVyZW5jZXMuZmllbGR9YFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGZpZWxkLnVuaXF1ZSkge1xuICAgICAgICAgICAgY29sID0gY29sLnVuaXF1ZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gY29sO1xuICAgICAgICB9KTtcbiAgICAgICAgbWlncmF0aW9ucy5wdXNoKGV4ZWMpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBpZiAodG9CZUNyZWF0ZWQubGVuZ3RoKSB7XG4gICAgZm9yIChjb25zdCB0YWJsZSBvZiB0b0JlQ3JlYXRlZCkge1xuICAgICAgbGV0IGRiVCA9IGRiLnNjaGVtYS5jcmVhdGVUYWJsZSh0YWJsZS50YWJsZSkuYWRkQ29sdW1uKFxuICAgICAgICBcImlkXCIsXG4gICAgICAgIGNvbmZpZy5hZHZhbmNlZD8uZGF0YWJhc2U/LnVzZU51bWJlcklkID8gZGJUeXBlID09PSBcInBvc3RncmVzXCIgPyBcInNlcmlhbFwiIDogXCJpbnRlZ2VyXCIgOiBkYlR5cGUgPT09IFwibXlzcWxcIiB8fCBkYlR5cGUgPT09IFwibXNzcWxcIiA/IFwidmFyY2hhcigzNilcIiA6IFwidGV4dFwiLFxuICAgICAgICAoY29sKSA9PiB7XG4gICAgICAgICAgaWYgKGNvbmZpZy5hZHZhbmNlZD8uZGF0YWJhc2U/LnVzZU51bWJlcklkKSB7XG4gICAgICAgICAgICBpZiAoZGJUeXBlID09PSBcInBvc3RncmVzXCIpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGNvbC5wcmltYXJ5S2V5KCkubm90TnVsbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGNvbC5hdXRvSW5jcmVtZW50KCkucHJpbWFyeUtleSgpLm5vdE51bGwoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGNvbC5wcmltYXJ5S2V5KCkubm90TnVsbCgpO1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgZm9yIChjb25zdCBbZmllbGROYW1lLCBmaWVsZF0gb2YgT2JqZWN0LmVudHJpZXModGFibGUuZmllbGRzKSkge1xuICAgICAgICBjb25zdCB0eXBlID0gZ2V0VHlwZShmaWVsZCwgZmllbGROYW1lKTtcbiAgICAgICAgZGJUID0gZGJULmFkZENvbHVtbihmaWVsZE5hbWUsIHR5cGUsIChjb2wpID0+IHtcbiAgICAgICAgICBjb2wgPSBmaWVsZC5yZXF1aXJlZCAhPT0gZmFsc2UgPyBjb2wubm90TnVsbCgpIDogY29sO1xuICAgICAgICAgIGlmIChmaWVsZC5yZWZlcmVuY2VzKSB7XG4gICAgICAgICAgICBjb2wgPSBjb2wucmVmZXJlbmNlcyhcbiAgICAgICAgICAgICAgYCR7ZmllbGQucmVmZXJlbmNlcy5tb2RlbH0uJHtmaWVsZC5yZWZlcmVuY2VzLmZpZWxkfWBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChmaWVsZC51bmlxdWUpIHtcbiAgICAgICAgICAgIGNvbCA9IGNvbC51bmlxdWUoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGNvbDtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBtaWdyYXRpb25zLnB1c2goZGJUKTtcbiAgICB9XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gcnVuTWlncmF0aW9ucygpIHtcbiAgICBmb3IgKGNvbnN0IG1pZ3JhdGlvbiBvZiBtaWdyYXRpb25zKSB7XG4gICAgICBhd2FpdCBtaWdyYXRpb24uZXhlY3V0ZSgpO1xuICAgIH1cbiAgfVxuICBhc3luYyBmdW5jdGlvbiBjb21waWxlTWlncmF0aW9ucygpIHtcbiAgICBjb25zdCBjb21waWxlZCA9IG1pZ3JhdGlvbnMubWFwKChtKSA9PiBtLmNvbXBpbGUoKS5zcWwpO1xuICAgIHJldHVybiBjb21waWxlZC5qb2luKFwiO1xcblxcblwiKSArIFwiO1wiO1xuICB9XG4gIHJldHVybiB7IHRvQmVDcmVhdGVkLCB0b0JlQWRkZWQsIHJ1bk1pZ3JhdGlvbnMsIGNvbXBpbGVNaWdyYXRpb25zIH07XG59XG5cbmV4cG9ydCB7IGdldEFkYXB0ZXIgYXMgYSwgY29udmVydFRvREIgYXMgYiwgY3JlYXRlSW50ZXJuYWxBZGFwdGVyIGFzIGMsIGNvbnZlcnRGcm9tREIgYXMgZCwgZ2V0TWlncmF0aW9ucyBhcyBlLCBnZXRTY2hlbWEgYXMgZiwgZ2V0V2l0aEhvb2tzIGFzIGcsIG1hdGNoVHlwZSBhcyBtIH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.ByruPN9q.mjs\n");

/***/ }),

/***/ "(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.CW6D9eSx.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.CW6D9eSx.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   g: () => (/* binding */ getDate)\n/* harmony export */ });\nconst getDate = (span, unit = \"ms\") => {\n  return new Date(Date.now() + (unit === \"sec\" ? span * 1e3 : span));\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguQ1c2RDllU3gubWpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTtBQUNBO0FBQ0E7O0FBRXdCIiwic291cmNlcyI6WyIvVXNlcnMvbWlsYW4vRGVza3RvcC9BcHBzL2JldHRlci1hdXRoL25vZGVfbW9kdWxlcy9iZXR0ZXItYXV0aC9kaXN0L3NoYXJlZC9iZXR0ZXItYXV0aC5DVzZEOWVTeC5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZ2V0RGF0ZSA9IChzcGFuLCB1bml0ID0gXCJtc1wiKSA9PiB7XG4gIHJldHVybiBuZXcgRGF0ZShEYXRlLm5vdygpICsgKHVuaXQgPT09IFwic2VjXCIgPyBzcGFuICogMWUzIDogc3BhbikpO1xufTtcblxuZXhwb3J0IHsgZ2V0RGF0ZSBhcyBnIH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.CW6D9eSx.mjs\n");

/***/ }),

/***/ "(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.Cbhy6WDJ.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.Cbhy6WDJ.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   b: () => (/* binding */ betterAuth)\n/* harmony export */ });\n/* harmony import */ var _api_index_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../api/index.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/api/index.mjs\");\n/* harmony import */ var defu__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! defu */ \"(action-browser)/../../node_modules/defu/dist/defu.mjs\");\n/* harmony import */ var _crypto_index_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../crypto/index.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/crypto/index.mjs\");\n/* harmony import */ var _better_auth_ByruPN9q_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./better-auth.ByruPN9q.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.ByruPN9q.mjs\");\n/* harmony import */ var _better_auth_DORkW_Ge_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./better-auth.DORkW_Ge.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DORkW_Ge.mjs\");\n/* harmony import */ var _better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./better-auth.n2KFGwjY.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.n2KFGwjY.mjs\");\n/* harmony import */ var _cookies_index_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../cookies/index.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/cookies/index.mjs\");\n/* harmony import */ var _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./better-auth.DBGfIDnh.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DBGfIDnh.mjs\");\n/* harmony import */ var _better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./better-auth.z3dsxLxE.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.z3dsxLxE.mjs\");\n/* harmony import */ var better_call__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! better-call */ \"(action-browser)/../../node_modules/better-call/dist/index.js\");\n/* harmony import */ var _better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @better-auth/utils/hash */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/hash.mjs\");\n/* harmony import */ var _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @better-auth/utils/base64 */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/base64.mjs\");\n/* harmony import */ var _better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./better-auth.B4Qoxdgc.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs\");\n/* harmony import */ var _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./better-auth.8zoxzg-F.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs\");\n/* harmony import */ var _better_auth_YwDQhoPc_mjs__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./better-auth.YwDQhoPc.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.YwDQhoPc.mjs\");\n/* harmony import */ var _better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./better-auth.VTXNLFMT.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.VTXNLFMT.mjs\");\n/* harmony import */ var _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./better-auth.DdzSJf-n.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst DEFAULT_SECRET = \"better-auth-secret-123456789\";\n\nconst init = async (options) => {\n  const adapter = await (0,_better_auth_ByruPN9q_mjs__WEBPACK_IMPORTED_MODULE_3__.a)(options);\n  const plugins = options.plugins || [];\n  const internalPlugins = getInternalPlugins(options);\n  const logger = (0,_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_7__.c)(options.logger);\n  const baseURL = (0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_15__.a)(options.baseURL, options.basePath);\n  const secret = options.secret || _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_13__.e.BETTER_AUTH_SECRET || _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_13__.e.AUTH_SECRET || DEFAULT_SECRET;\n  if (secret === DEFAULT_SECRET) {\n    if (_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_13__.a) {\n      logger.error(\n        \"You are using the default secret. Please set `BETTER_AUTH_SECRET` in your environment variables or pass `secret` in your auth config.\"\n      );\n    }\n  }\n  options = {\n    ...options,\n    secret,\n    baseURL: baseURL ? new URL(baseURL).origin : \"\",\n    basePath: options.basePath || \"/api/auth\",\n    plugins: plugins.concat(internalPlugins)\n  };\n  const cookies = (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_6__.getCookies)(options);\n  const tables = (0,_better_auth_DORkW_Ge_mjs__WEBPACK_IMPORTED_MODULE_4__.g)(options);\n  const providers = Object.keys(options.socialProviders || {}).map((key) => {\n    const value = options.socialProviders?.[key];\n    if (!value || value.enabled === false) {\n      return null;\n    }\n    if (!value.clientId) {\n      logger.warn(\n        `Social provider ${key} is missing clientId or clientSecret`\n      );\n    }\n    const provider = _better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_8__.t[key](\n      value\n      // TODO: fix this\n    );\n    provider.disableImplicitSignUp = value.disableImplicitSignUp;\n    return provider;\n  }).filter((x) => x !== null);\n  const generateIdFunc = ({ model, size }) => {\n    if (typeof options.advanced?.generateId === \"function\") {\n      return options.advanced.generateId({ model, size });\n    }\n    if (typeof options?.advanced?.database?.generateId === \"function\") {\n      return options.advanced.database.generateId({ model, size });\n    }\n    return (0,_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_7__.g)(size);\n  };\n  const ctx = {\n    appName: options.appName || \"Better Auth\",\n    socialProviders: providers,\n    options,\n    tables,\n    trustedOrigins: getTrustedOrigins(options),\n    baseURL: baseURL || \"\",\n    sessionConfig: {\n      updateAge: options.session?.updateAge !== void 0 ? options.session.updateAge : 24 * 60 * 60,\n      // 24 hours\n      expiresIn: options.session?.expiresIn || 60 * 60 * 24 * 7,\n      // 7 days\n      freshAge: options.session?.freshAge === void 0 ? 60 * 60 * 24 : options.session.freshAge\n    },\n    secret,\n    rateLimit: {\n      ...options.rateLimit,\n      enabled: options.rateLimit?.enabled ?? _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_13__.a,\n      window: options.rateLimit?.window || 10,\n      max: options.rateLimit?.max || 100,\n      storage: options.rateLimit?.storage || (options.secondaryStorage ? \"secondary-storage\" : \"memory\")\n    },\n    authCookies: cookies,\n    logger,\n    generateId: generateIdFunc,\n    session: null,\n    secondaryStorage: options.secondaryStorage,\n    password: {\n      hash: options.emailAndPassword?.password?.hash || _crypto_index_mjs__WEBPACK_IMPORTED_MODULE_2__.hashPassword,\n      verify: options.emailAndPassword?.password?.verify || _crypto_index_mjs__WEBPACK_IMPORTED_MODULE_2__.verifyPassword,\n      config: {\n        minPasswordLength: options.emailAndPassword?.minPasswordLength || 8,\n        maxPasswordLength: options.emailAndPassword?.maxPasswordLength || 128\n      },\n      checkPassword: _better_auth_YwDQhoPc_mjs__WEBPACK_IMPORTED_MODULE_14__.c\n    },\n    setNewSession(session) {\n      this.newSession = session;\n    },\n    newSession: null,\n    adapter,\n    internalAdapter: (0,_better_auth_ByruPN9q_mjs__WEBPACK_IMPORTED_MODULE_3__.c)(adapter, {\n      options,\n      hooks: options.databaseHooks ? [options.databaseHooks] : []}),\n    createAuthCookie: (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_6__.createCookieGetter)(options),\n    async runMigrations() {\n      if (!options.database || \"updateMany\" in options.database) {\n        throw new _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_16__.B(\n          \"Database is not provided or it's an adapter. Migrations are only supported with a database instance.\"\n        );\n      }\n      const { runMigrations } = await (0,_better_auth_ByruPN9q_mjs__WEBPACK_IMPORTED_MODULE_3__.e)(options);\n      await runMigrations();\n    }\n  };\n  let { context } = runPluginInit(ctx);\n  return context;\n};\nfunction runPluginInit(ctx) {\n  let options = ctx.options;\n  const plugins = options.plugins || [];\n  let context = ctx;\n  const dbHooks = [];\n  for (const plugin of plugins) {\n    if (plugin.init) {\n      const result = plugin.init(context);\n      if (typeof result === \"object\") {\n        if (result.options) {\n          const { databaseHooks, ...restOpts } = result.options;\n          if (databaseHooks) {\n            dbHooks.push(databaseHooks);\n          }\n          options = (0,defu__WEBPACK_IMPORTED_MODULE_1__.defu)(options, restOpts);\n        }\n        if (result.context) {\n          context = {\n            ...context,\n            ...result.context\n          };\n        }\n      }\n    }\n  }\n  dbHooks.push(options.databaseHooks);\n  context.internalAdapter = (0,_better_auth_ByruPN9q_mjs__WEBPACK_IMPORTED_MODULE_3__.c)(ctx.adapter, {\n    options,\n    hooks: dbHooks.filter((u) => u !== void 0),\n    generateId: ctx.generateId\n  });\n  context.options = options;\n  return { context };\n}\nfunction getInternalPlugins(options) {\n  const plugins = [];\n  if (options.advanced?.crossSubDomainCookies?.enabled) ;\n  return plugins;\n}\nfunction getTrustedOrigins(options) {\n  const baseURL = (0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_15__.a)(options.baseURL, options.basePath);\n  if (!baseURL) {\n    return [];\n  }\n  const trustedOrigins = [new URL(baseURL).origin];\n  if (options.trustedOrigins && Array.isArray(options.trustedOrigins)) {\n    trustedOrigins.push(...options.trustedOrigins);\n  }\n  const envTrustedOrigins = _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_13__.e.BETTER_AUTH_TRUSTED_ORIGINS;\n  if (envTrustedOrigins) {\n    trustedOrigins.push(...envTrustedOrigins.split(\",\"));\n  }\n  if (trustedOrigins.filter((x) => !x).length) {\n    throw new _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_16__.B(\n      \"A provided trusted origin is invalid, make sure your trusted origins list is properly defined.\"\n    );\n  }\n  return trustedOrigins;\n}\n\nconst betterAuth = (options) => {\n  const authContext = init(options);\n  const { api } = (0,_api_index_mjs__WEBPACK_IMPORTED_MODULE_0__.getEndpoints)(authContext, options);\n  const errorCodes = options.plugins?.reduce((acc, plugin) => {\n    if (plugin.$ERROR_CODES) {\n      return {\n        ...acc,\n        ...plugin.$ERROR_CODES\n      };\n    }\n    return acc;\n  }, {});\n  return {\n    handler: async (request) => {\n      const ctx = await authContext;\n      const basePath = ctx.options.basePath || \"/api/auth\";\n      if (!ctx.options.baseURL) {\n        const baseURL = (0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_15__.a)(void 0, basePath, request);\n        if (baseURL) {\n          ctx.baseURL = baseURL;\n          ctx.options.baseURL = (0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_15__.g)(ctx.baseURL) || void 0;\n        } else {\n          throw new _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_16__.B(\n            \"Could not get base URL from request. Please provide a valid base URL.\"\n          );\n        }\n      }\n      ctx.trustedOrigins = [\n        ...options.trustedOrigins ? Array.isArray(options.trustedOrigins) ? options.trustedOrigins : await options.trustedOrigins(request) : [],\n        ctx.options.baseURL\n      ];\n      const { handler } = (0,_api_index_mjs__WEBPACK_IMPORTED_MODULE_0__.router)(ctx, options);\n      return handler(request);\n    },\n    api,\n    options,\n    $context: authContext,\n    $Infer: {},\n    $ERROR_CODES: {\n      ...errorCodes,\n      ..._better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_8__.B\n    }\n  };\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguQ2JoeTZXREoubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUF3RDtBQUM1QjtBQUN1QztBQUMwQztBQUM3QztBQUNoRDtBQUNvQjtBQUNrQztBQUNVO0FBQ1M7QUFDcEU7QUFDWTtBQUNGO0FBQ0Q7QUFDSTtBQUNDO0FBQ3JCO0FBQ3NCO0FBQ3FDO0FBQ1Q7QUFDYTtBQUNYOztBQUVsRTs7QUFFQTtBQUNBLHdCQUF3Qiw0REFBVTtBQUNsQztBQUNBO0FBQ0EsaUJBQWlCLDREQUFZO0FBQzdCLGtCQUFrQiw2REFBVTtBQUM1QixtQ0FBbUMseURBQUcsdUJBQXVCLHlEQUFHO0FBQ2hFO0FBQ0EsUUFBUSx5REFBWTtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsOERBQVU7QUFDNUIsaUJBQWlCLDREQUFhO0FBQzlCLDZEQUE2RDtBQUM3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsS0FBSztBQUNoQztBQUNBO0FBQ0EscUJBQXFCLHdEQUFlO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsNEJBQTRCLGFBQWE7QUFDekM7QUFDQSwyQ0FBMkMsYUFBYTtBQUN4RDtBQUNBO0FBQ0Esb0RBQW9ELGFBQWE7QUFDakU7QUFDQSxXQUFXLDREQUFVO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLHlEQUFZO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3REFBd0QsMkRBQVk7QUFDcEUsNERBQTRELDZEQUFjO0FBQzFFO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxtQkFBbUI7QUFDbkIsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLHFCQUFxQiw0REFBcUI7QUFDMUM7QUFDQSxrRUFBa0U7QUFDbEUsc0JBQXNCLHNFQUFrQjtBQUN4QztBQUNBO0FBQ0Esa0JBQWtCLHlEQUFlO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBLGNBQWMsZ0JBQWdCLFFBQVEsNERBQWE7QUFDbkQ7QUFDQTtBQUNBO0FBQ0EsUUFBUSxVQUFVO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQiw2QkFBNkI7QUFDL0M7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLDBDQUFJO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsNERBQXFCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQiw2REFBVTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0Qix5REFBRztBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMseURBQWU7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsVUFBVSxNQUFNLEVBQUUsNERBQVk7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUcsSUFBSTtBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsNkRBQVU7QUFDbEM7QUFDQTtBQUNBLGdDQUFnQyw2REFBUztBQUN6QyxVQUFVO0FBQ1Ysb0JBQW9CLHlEQUFlO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLFVBQVUsRUFBRSxzREFBTTtBQUNoQztBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBLFNBQVMsd0RBQWdCO0FBQ3pCO0FBQ0E7QUFDQTs7QUFFMkIiLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWxhbi9EZXNrdG9wL0FwcHMvYmV0dGVyLWF1dGgvbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLkNiaHk2V0RKLm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZXRFbmRwb2ludHMsIHJvdXRlciB9IGZyb20gJy4uL2FwaS9pbmRleC5tanMnO1xuaW1wb3J0IHsgZGVmdSB9IGZyb20gJ2RlZnUnO1xuaW1wb3J0IHsgdmVyaWZ5UGFzc3dvcmQsIGhhc2hQYXNzd29yZCB9IGZyb20gJy4uL2NyeXB0by9pbmRleC5tanMnO1xuaW1wb3J0IHsgYSBhcyBnZXRBZGFwdGVyLCBjIGFzIGNyZWF0ZUludGVybmFsQWRhcHRlciwgZSBhcyBnZXRNaWdyYXRpb25zIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC5CeXJ1UE45cS5tanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRBdXRoVGFibGVzIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC5ET1JrV19HZS5tanMnO1xuaW1wb3J0ICd6b2QvdjQnO1xuaW1wb3J0ICcuL2JldHRlci1hdXRoLm4yS0ZHd2pZLm1qcyc7XG5pbXBvcnQgeyBnZXRDb29raWVzLCBjcmVhdGVDb29raWVHZXR0ZXIgfSBmcm9tICcuLi9jb29raWVzL2luZGV4Lm1qcyc7XG5pbXBvcnQgeyBjIGFzIGNyZWF0ZUxvZ2dlciwgZyBhcyBnZW5lcmF0ZUlkIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC5EQkdmSURuaC5tanMnO1xuaW1wb3J0IHsgdCBhcyBzb2NpYWxQcm92aWRlcnMsIEIgYXMgQkFTRV9FUlJPUl9DT0RFUyB9IGZyb20gJy4vYmV0dGVyLWF1dGguejNkc3hMeEUubWpzJztcbmltcG9ydCAnYmV0dGVyLWNhbGwnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMvaGFzaCc7XG5pbXBvcnQgJ0Bub2JsZS9jaXBoZXJzL2NoYWNoYSc7XG5pbXBvcnQgJ0Bub2JsZS9jaXBoZXJzL3V0aWxzJztcbmltcG9ydCAnQG5vYmxlL2NpcGhlcnMvd2ViY3J5cHRvJztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzL2Jhc2U2NCc7XG5pbXBvcnQgJ2pvc2UnO1xuaW1wb3J0ICcuL2JldHRlci1hdXRoLkI0UW94ZGdjLm1qcyc7XG5pbXBvcnQgeyBlIGFzIGVudiwgYSBhcyBpc1Byb2R1Y3Rpb24gfSBmcm9tICcuL2JldHRlci1hdXRoLjh6b3h6Zy1GLm1qcyc7XG5pbXBvcnQgeyBjIGFzIGNoZWNrUGFzc3dvcmQgfSBmcm9tICcuL2JldHRlci1hdXRoLll3RFFob1BjLm1qcyc7XG5pbXBvcnQgeyBhIGFzIGdldEJhc2VVUkwsIGcgYXMgZ2V0T3JpZ2luIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC5WVFhOTEZNVC5tanMnO1xuaW1wb3J0IHsgQiBhcyBCZXR0ZXJBdXRoRXJyb3IgfSBmcm9tICcuL2JldHRlci1hdXRoLkRkelNKZi1uLm1qcyc7XG5cbmNvbnN0IERFRkFVTFRfU0VDUkVUID0gXCJiZXR0ZXItYXV0aC1zZWNyZXQtMTIzNDU2Nzg5XCI7XG5cbmNvbnN0IGluaXQgPSBhc3luYyAob3B0aW9ucykgPT4ge1xuICBjb25zdCBhZGFwdGVyID0gYXdhaXQgZ2V0QWRhcHRlcihvcHRpb25zKTtcbiAgY29uc3QgcGx1Z2lucyA9IG9wdGlvbnMucGx1Z2lucyB8fCBbXTtcbiAgY29uc3QgaW50ZXJuYWxQbHVnaW5zID0gZ2V0SW50ZXJuYWxQbHVnaW5zKG9wdGlvbnMpO1xuICBjb25zdCBsb2dnZXIgPSBjcmVhdGVMb2dnZXIob3B0aW9ucy5sb2dnZXIpO1xuICBjb25zdCBiYXNlVVJMID0gZ2V0QmFzZVVSTChvcHRpb25zLmJhc2VVUkwsIG9wdGlvbnMuYmFzZVBhdGgpO1xuICBjb25zdCBzZWNyZXQgPSBvcHRpb25zLnNlY3JldCB8fCBlbnYuQkVUVEVSX0FVVEhfU0VDUkVUIHx8IGVudi5BVVRIX1NFQ1JFVCB8fCBERUZBVUxUX1NFQ1JFVDtcbiAgaWYgKHNlY3JldCA9PT0gREVGQVVMVF9TRUNSRVQpIHtcbiAgICBpZiAoaXNQcm9kdWN0aW9uKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoXG4gICAgICAgIFwiWW91IGFyZSB1c2luZyB0aGUgZGVmYXVsdCBzZWNyZXQuIFBsZWFzZSBzZXQgYEJFVFRFUl9BVVRIX1NFQ1JFVGAgaW4geW91ciBlbnZpcm9ubWVudCB2YXJpYWJsZXMgb3IgcGFzcyBgc2VjcmV0YCBpbiB5b3VyIGF1dGggY29uZmlnLlwiXG4gICAgICApO1xuICAgIH1cbiAgfVxuICBvcHRpb25zID0ge1xuICAgIC4uLm9wdGlvbnMsXG4gICAgc2VjcmV0LFxuICAgIGJhc2VVUkw6IGJhc2VVUkwgPyBuZXcgVVJMKGJhc2VVUkwpLm9yaWdpbiA6IFwiXCIsXG4gICAgYmFzZVBhdGg6IG9wdGlvbnMuYmFzZVBhdGggfHwgXCIvYXBpL2F1dGhcIixcbiAgICBwbHVnaW5zOiBwbHVnaW5zLmNvbmNhdChpbnRlcm5hbFBsdWdpbnMpXG4gIH07XG4gIGNvbnN0IGNvb2tpZXMgPSBnZXRDb29raWVzKG9wdGlvbnMpO1xuICBjb25zdCB0YWJsZXMgPSBnZXRBdXRoVGFibGVzKG9wdGlvbnMpO1xuICBjb25zdCBwcm92aWRlcnMgPSBPYmplY3Qua2V5cyhvcHRpb25zLnNvY2lhbFByb3ZpZGVycyB8fCB7fSkubWFwKChrZXkpID0+IHtcbiAgICBjb25zdCB2YWx1ZSA9IG9wdGlvbnMuc29jaWFsUHJvdmlkZXJzPy5ba2V5XTtcbiAgICBpZiAoIXZhbHVlIHx8IHZhbHVlLmVuYWJsZWQgPT09IGZhbHNlKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgaWYgKCF2YWx1ZS5jbGllbnRJZCkge1xuICAgICAgbG9nZ2VyLndhcm4oXG4gICAgICAgIGBTb2NpYWwgcHJvdmlkZXIgJHtrZXl9IGlzIG1pc3NpbmcgY2xpZW50SWQgb3IgY2xpZW50U2VjcmV0YFxuICAgICAgKTtcbiAgICB9XG4gICAgY29uc3QgcHJvdmlkZXIgPSBzb2NpYWxQcm92aWRlcnNba2V5XShcbiAgICAgIHZhbHVlXG4gICAgICAvLyBUT0RPOiBmaXggdGhpc1xuICAgICk7XG4gICAgcHJvdmlkZXIuZGlzYWJsZUltcGxpY2l0U2lnblVwID0gdmFsdWUuZGlzYWJsZUltcGxpY2l0U2lnblVwO1xuICAgIHJldHVybiBwcm92aWRlcjtcbiAgfSkuZmlsdGVyKCh4KSA9PiB4ICE9PSBudWxsKTtcbiAgY29uc3QgZ2VuZXJhdGVJZEZ1bmMgPSAoeyBtb2RlbCwgc2l6ZSB9KSA9PiB7XG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLmFkdmFuY2VkPy5nZW5lcmF0ZUlkID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIHJldHVybiBvcHRpb25zLmFkdmFuY2VkLmdlbmVyYXRlSWQoeyBtb2RlbCwgc2l6ZSB9KTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBvcHRpb25zPy5hZHZhbmNlZD8uZGF0YWJhc2U/LmdlbmVyYXRlSWQgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgcmV0dXJuIG9wdGlvbnMuYWR2YW5jZWQuZGF0YWJhc2UuZ2VuZXJhdGVJZCh7IG1vZGVsLCBzaXplIH0pO1xuICAgIH1cbiAgICByZXR1cm4gZ2VuZXJhdGVJZChzaXplKTtcbiAgfTtcbiAgY29uc3QgY3R4ID0ge1xuICAgIGFwcE5hbWU6IG9wdGlvbnMuYXBwTmFtZSB8fCBcIkJldHRlciBBdXRoXCIsXG4gICAgc29jaWFsUHJvdmlkZXJzOiBwcm92aWRlcnMsXG4gICAgb3B0aW9ucyxcbiAgICB0YWJsZXMsXG4gICAgdHJ1c3RlZE9yaWdpbnM6IGdldFRydXN0ZWRPcmlnaW5zKG9wdGlvbnMpLFxuICAgIGJhc2VVUkw6IGJhc2VVUkwgfHwgXCJcIixcbiAgICBzZXNzaW9uQ29uZmlnOiB7XG4gICAgICB1cGRhdGVBZ2U6IG9wdGlvbnMuc2Vzc2lvbj8udXBkYXRlQWdlICE9PSB2b2lkIDAgPyBvcHRpb25zLnNlc3Npb24udXBkYXRlQWdlIDogMjQgKiA2MCAqIDYwLFxuICAgICAgLy8gMjQgaG91cnNcbiAgICAgIGV4cGlyZXNJbjogb3B0aW9ucy5zZXNzaW9uPy5leHBpcmVzSW4gfHwgNjAgKiA2MCAqIDI0ICogNyxcbiAgICAgIC8vIDcgZGF5c1xuICAgICAgZnJlc2hBZ2U6IG9wdGlvbnMuc2Vzc2lvbj8uZnJlc2hBZ2UgPT09IHZvaWQgMCA/IDYwICogNjAgKiAyNCA6IG9wdGlvbnMuc2Vzc2lvbi5mcmVzaEFnZVxuICAgIH0sXG4gICAgc2VjcmV0LFxuICAgIHJhdGVMaW1pdDoge1xuICAgICAgLi4ub3B0aW9ucy5yYXRlTGltaXQsXG4gICAgICBlbmFibGVkOiBvcHRpb25zLnJhdGVMaW1pdD8uZW5hYmxlZCA/PyBpc1Byb2R1Y3Rpb24sXG4gICAgICB3aW5kb3c6IG9wdGlvbnMucmF0ZUxpbWl0Py53aW5kb3cgfHwgMTAsXG4gICAgICBtYXg6IG9wdGlvbnMucmF0ZUxpbWl0Py5tYXggfHwgMTAwLFxuICAgICAgc3RvcmFnZTogb3B0aW9ucy5yYXRlTGltaXQ/LnN0b3JhZ2UgfHwgKG9wdGlvbnMuc2Vjb25kYXJ5U3RvcmFnZSA/IFwic2Vjb25kYXJ5LXN0b3JhZ2VcIiA6IFwibWVtb3J5XCIpXG4gICAgfSxcbiAgICBhdXRoQ29va2llczogY29va2llcyxcbiAgICBsb2dnZXIsXG4gICAgZ2VuZXJhdGVJZDogZ2VuZXJhdGVJZEZ1bmMsXG4gICAgc2Vzc2lvbjogbnVsbCxcbiAgICBzZWNvbmRhcnlTdG9yYWdlOiBvcHRpb25zLnNlY29uZGFyeVN0b3JhZ2UsXG4gICAgcGFzc3dvcmQ6IHtcbiAgICAgIGhhc2g6IG9wdGlvbnMuZW1haWxBbmRQYXNzd29yZD8ucGFzc3dvcmQ/Lmhhc2ggfHwgaGFzaFBhc3N3b3JkLFxuICAgICAgdmVyaWZ5OiBvcHRpb25zLmVtYWlsQW5kUGFzc3dvcmQ/LnBhc3N3b3JkPy52ZXJpZnkgfHwgdmVyaWZ5UGFzc3dvcmQsXG4gICAgICBjb25maWc6IHtcbiAgICAgICAgbWluUGFzc3dvcmRMZW5ndGg6IG9wdGlvbnMuZW1haWxBbmRQYXNzd29yZD8ubWluUGFzc3dvcmRMZW5ndGggfHwgOCxcbiAgICAgICAgbWF4UGFzc3dvcmRMZW5ndGg6IG9wdGlvbnMuZW1haWxBbmRQYXNzd29yZD8ubWF4UGFzc3dvcmRMZW5ndGggfHwgMTI4XG4gICAgICB9LFxuICAgICAgY2hlY2tQYXNzd29yZFxuICAgIH0sXG4gICAgc2V0TmV3U2Vzc2lvbihzZXNzaW9uKSB7XG4gICAgICB0aGlzLm5ld1Nlc3Npb24gPSBzZXNzaW9uO1xuICAgIH0sXG4gICAgbmV3U2Vzc2lvbjogbnVsbCxcbiAgICBhZGFwdGVyLFxuICAgIGludGVybmFsQWRhcHRlcjogY3JlYXRlSW50ZXJuYWxBZGFwdGVyKGFkYXB0ZXIsIHtcbiAgICAgIG9wdGlvbnMsXG4gICAgICBob29rczogb3B0aW9ucy5kYXRhYmFzZUhvb2tzID8gW29wdGlvbnMuZGF0YWJhc2VIb29rc10gOiBbXX0pLFxuICAgIGNyZWF0ZUF1dGhDb29raWU6IGNyZWF0ZUNvb2tpZUdldHRlcihvcHRpb25zKSxcbiAgICBhc3luYyBydW5NaWdyYXRpb25zKCkge1xuICAgICAgaWYgKCFvcHRpb25zLmRhdGFiYXNlIHx8IFwidXBkYXRlTWFueVwiIGluIG9wdGlvbnMuZGF0YWJhc2UpIHtcbiAgICAgICAgdGhyb3cgbmV3IEJldHRlckF1dGhFcnJvcihcbiAgICAgICAgICBcIkRhdGFiYXNlIGlzIG5vdCBwcm92aWRlZCBvciBpdCdzIGFuIGFkYXB0ZXIuIE1pZ3JhdGlvbnMgYXJlIG9ubHkgc3VwcG9ydGVkIHdpdGggYSBkYXRhYmFzZSBpbnN0YW5jZS5cIlxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY29uc3QgeyBydW5NaWdyYXRpb25zIH0gPSBhd2FpdCBnZXRNaWdyYXRpb25zKG9wdGlvbnMpO1xuICAgICAgYXdhaXQgcnVuTWlncmF0aW9ucygpO1xuICAgIH1cbiAgfTtcbiAgbGV0IHsgY29udGV4dCB9ID0gcnVuUGx1Z2luSW5pdChjdHgpO1xuICByZXR1cm4gY29udGV4dDtcbn07XG5mdW5jdGlvbiBydW5QbHVnaW5Jbml0KGN0eCkge1xuICBsZXQgb3B0aW9ucyA9IGN0eC5vcHRpb25zO1xuICBjb25zdCBwbHVnaW5zID0gb3B0aW9ucy5wbHVnaW5zIHx8IFtdO1xuICBsZXQgY29udGV4dCA9IGN0eDtcbiAgY29uc3QgZGJIb29rcyA9IFtdO1xuICBmb3IgKGNvbnN0IHBsdWdpbiBvZiBwbHVnaW5zKSB7XG4gICAgaWYgKHBsdWdpbi5pbml0KSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBwbHVnaW4uaW5pdChjb250ZXh0KTtcbiAgICAgIGlmICh0eXBlb2YgcmVzdWx0ID09PSBcIm9iamVjdFwiKSB7XG4gICAgICAgIGlmIChyZXN1bHQub3B0aW9ucykge1xuICAgICAgICAgIGNvbnN0IHsgZGF0YWJhc2VIb29rcywgLi4ucmVzdE9wdHMgfSA9IHJlc3VsdC5vcHRpb25zO1xuICAgICAgICAgIGlmIChkYXRhYmFzZUhvb2tzKSB7XG4gICAgICAgICAgICBkYkhvb2tzLnB1c2goZGF0YWJhc2VIb29rcyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG9wdGlvbnMgPSBkZWZ1KG9wdGlvbnMsIHJlc3RPcHRzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVzdWx0LmNvbnRleHQpIHtcbiAgICAgICAgICBjb250ZXh0ID0ge1xuICAgICAgICAgICAgLi4uY29udGV4dCxcbiAgICAgICAgICAgIC4uLnJlc3VsdC5jb250ZXh0XG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICBkYkhvb2tzLnB1c2gob3B0aW9ucy5kYXRhYmFzZUhvb2tzKTtcbiAgY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIgPSBjcmVhdGVJbnRlcm5hbEFkYXB0ZXIoY3R4LmFkYXB0ZXIsIHtcbiAgICBvcHRpb25zLFxuICAgIGhvb2tzOiBkYkhvb2tzLmZpbHRlcigodSkgPT4gdSAhPT0gdm9pZCAwKSxcbiAgICBnZW5lcmF0ZUlkOiBjdHguZ2VuZXJhdGVJZFxuICB9KTtcbiAgY29udGV4dC5vcHRpb25zID0gb3B0aW9ucztcbiAgcmV0dXJuIHsgY29udGV4dCB9O1xufVxuZnVuY3Rpb24gZ2V0SW50ZXJuYWxQbHVnaW5zKG9wdGlvbnMpIHtcbiAgY29uc3QgcGx1Z2lucyA9IFtdO1xuICBpZiAob3B0aW9ucy5hZHZhbmNlZD8uY3Jvc3NTdWJEb21haW5Db29raWVzPy5lbmFibGVkKSA7XG4gIHJldHVybiBwbHVnaW5zO1xufVxuZnVuY3Rpb24gZ2V0VHJ1c3RlZE9yaWdpbnMob3B0aW9ucykge1xuICBjb25zdCBiYXNlVVJMID0gZ2V0QmFzZVVSTChvcHRpb25zLmJhc2VVUkwsIG9wdGlvbnMuYmFzZVBhdGgpO1xuICBpZiAoIWJhc2VVUkwpIHtcbiAgICByZXR1cm4gW107XG4gIH1cbiAgY29uc3QgdHJ1c3RlZE9yaWdpbnMgPSBbbmV3IFVSTChiYXNlVVJMKS5vcmlnaW5dO1xuICBpZiAob3B0aW9ucy50cnVzdGVkT3JpZ2lucyAmJiBBcnJheS5pc0FycmF5KG9wdGlvbnMudHJ1c3RlZE9yaWdpbnMpKSB7XG4gICAgdHJ1c3RlZE9yaWdpbnMucHVzaCguLi5vcHRpb25zLnRydXN0ZWRPcmlnaW5zKTtcbiAgfVxuICBjb25zdCBlbnZUcnVzdGVkT3JpZ2lucyA9IGVudi5CRVRURVJfQVVUSF9UUlVTVEVEX09SSUdJTlM7XG4gIGlmIChlbnZUcnVzdGVkT3JpZ2lucykge1xuICAgIHRydXN0ZWRPcmlnaW5zLnB1c2goLi4uZW52VHJ1c3RlZE9yaWdpbnMuc3BsaXQoXCIsXCIpKTtcbiAgfVxuICBpZiAodHJ1c3RlZE9yaWdpbnMuZmlsdGVyKCh4KSA9PiAheCkubGVuZ3RoKSB7XG4gICAgdGhyb3cgbmV3IEJldHRlckF1dGhFcnJvcihcbiAgICAgIFwiQSBwcm92aWRlZCB0cnVzdGVkIG9yaWdpbiBpcyBpbnZhbGlkLCBtYWtlIHN1cmUgeW91ciB0cnVzdGVkIG9yaWdpbnMgbGlzdCBpcyBwcm9wZXJseSBkZWZpbmVkLlwiXG4gICAgKTtcbiAgfVxuICByZXR1cm4gdHJ1c3RlZE9yaWdpbnM7XG59XG5cbmNvbnN0IGJldHRlckF1dGggPSAob3B0aW9ucykgPT4ge1xuICBjb25zdCBhdXRoQ29udGV4dCA9IGluaXQob3B0aW9ucyk7XG4gIGNvbnN0IHsgYXBpIH0gPSBnZXRFbmRwb2ludHMoYXV0aENvbnRleHQsIG9wdGlvbnMpO1xuICBjb25zdCBlcnJvckNvZGVzID0gb3B0aW9ucy5wbHVnaW5zPy5yZWR1Y2UoKGFjYywgcGx1Z2luKSA9PiB7XG4gICAgaWYgKHBsdWdpbi4kRVJST1JfQ09ERVMpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLmFjYyxcbiAgICAgICAgLi4ucGx1Z2luLiRFUlJPUl9DT0RFU1xuICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIGFjYztcbiAgfSwge30pO1xuICByZXR1cm4ge1xuICAgIGhhbmRsZXI6IGFzeW5jIChyZXF1ZXN0KSA9PiB7XG4gICAgICBjb25zdCBjdHggPSBhd2FpdCBhdXRoQ29udGV4dDtcbiAgICAgIGNvbnN0IGJhc2VQYXRoID0gY3R4Lm9wdGlvbnMuYmFzZVBhdGggfHwgXCIvYXBpL2F1dGhcIjtcbiAgICAgIGlmICghY3R4Lm9wdGlvbnMuYmFzZVVSTCkge1xuICAgICAgICBjb25zdCBiYXNlVVJMID0gZ2V0QmFzZVVSTCh2b2lkIDAsIGJhc2VQYXRoLCByZXF1ZXN0KTtcbiAgICAgICAgaWYgKGJhc2VVUkwpIHtcbiAgICAgICAgICBjdHguYmFzZVVSTCA9IGJhc2VVUkw7XG4gICAgICAgICAgY3R4Lm9wdGlvbnMuYmFzZVVSTCA9IGdldE9yaWdpbihjdHguYmFzZVVSTCkgfHwgdm9pZCAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IG5ldyBCZXR0ZXJBdXRoRXJyb3IoXG4gICAgICAgICAgICBcIkNvdWxkIG5vdCBnZXQgYmFzZSBVUkwgZnJvbSByZXF1ZXN0LiBQbGVhc2UgcHJvdmlkZSBhIHZhbGlkIGJhc2UgVVJMLlwiXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY3R4LnRydXN0ZWRPcmlnaW5zID0gW1xuICAgICAgICAuLi5vcHRpb25zLnRydXN0ZWRPcmlnaW5zID8gQXJyYXkuaXNBcnJheShvcHRpb25zLnRydXN0ZWRPcmlnaW5zKSA/IG9wdGlvbnMudHJ1c3RlZE9yaWdpbnMgOiBhd2FpdCBvcHRpb25zLnRydXN0ZWRPcmlnaW5zKHJlcXVlc3QpIDogW10sXG4gICAgICAgIGN0eC5vcHRpb25zLmJhc2VVUkxcbiAgICAgIF07XG4gICAgICBjb25zdCB7IGhhbmRsZXIgfSA9IHJvdXRlcihjdHgsIG9wdGlvbnMpO1xuICAgICAgcmV0dXJuIGhhbmRsZXIocmVxdWVzdCk7XG4gICAgfSxcbiAgICBhcGksXG4gICAgb3B0aW9ucyxcbiAgICAkY29udGV4dDogYXV0aENvbnRleHQsXG4gICAgJEluZmVyOiB7fSxcbiAgICAkRVJST1JfQ09ERVM6IHtcbiAgICAgIC4uLmVycm9yQ29kZXMsXG4gICAgICAuLi5CQVNFX0VSUk9SX0NPREVTXG4gICAgfVxuICB9O1xufTtcblxuZXhwb3J0IHsgYmV0dGVyQXV0aCBhcyBiIH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.Cbhy6WDJ.mjs\n");

/***/ }),

/***/ "(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.D-2CmEwz.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.D-2CmEwz.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   c: () => (/* binding */ capitalizeFirstLetter)\n/* harmony export */ });\nfunction capitalizeFirstLetter(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguRC0yQ21Fd3oubWpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTtBQUNBO0FBQ0E7O0FBRXNDIiwic291cmNlcyI6WyIvVXNlcnMvbWlsYW4vRGVza3RvcC9BcHBzL2JldHRlci1hdXRoL25vZGVfbW9kdWxlcy9iZXR0ZXItYXV0aC9kaXN0L3NoYXJlZC9iZXR0ZXItYXV0aC5ELTJDbUV3ei5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gY2FwaXRhbGl6ZUZpcnN0TGV0dGVyKHN0cikge1xuICByZXR1cm4gc3RyLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgc3RyLnNsaWNlKDEpO1xufVxuXG5leHBvcnQgeyBjYXBpdGFsaXplRmlyc3RMZXR0ZXIgYXMgYyB9O1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.D-2CmEwz.mjs\n");

/***/ }),

/***/ "(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DBGfIDnh.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.DBGfIDnh.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   a: () => (/* binding */ logger),\n/* harmony export */   c: () => (/* binding */ createLogger),\n/* harmony export */   g: () => (/* binding */ generateId),\n/* harmony export */   l: () => (/* binding */ levels),\n/* harmony export */   s: () => (/* binding */ shouldPublishLog)\n/* harmony export */ });\n/* harmony import */ var _better_auth_utils_random__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @better-auth/utils/random */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/random.mjs\");\n\n\nconst generateId = (size) => {\n  return (0,_better_auth_utils_random__WEBPACK_IMPORTED_MODULE_0__.createRandomStringGenerator)(\"a-z\", \"A-Z\", \"0-9\")(size || 32);\n};\n\nconst levels = [\"info\", \"success\", \"warn\", \"error\", \"debug\"];\nfunction shouldPublishLog(currentLogLevel, logLevel) {\n  return levels.indexOf(logLevel) <= levels.indexOf(currentLogLevel);\n}\nconst colors = {\n  reset: \"\\x1B[0m\",\n  bright: \"\\x1B[1m\",\n  dim: \"\\x1B[2m\",\n  fg: {\n    red: \"\\x1B[31m\",\n    green: \"\\x1B[32m\",\n    yellow: \"\\x1B[33m\",\n    blue: \"\\x1B[34m\",\n    magenta: \"\\x1B[35m\"}};\nconst levelColors = {\n  info: colors.fg.blue,\n  success: colors.fg.green,\n  warn: colors.fg.yellow,\n  error: colors.fg.red,\n  debug: colors.fg.magenta\n};\nconst formatMessage = (level, message) => {\n  const timestamp = (/* @__PURE__ */ new Date()).toISOString();\n  return `${colors.dim}${timestamp}${colors.reset} ${levelColors[level]}${level.toUpperCase()}${colors.reset} ${colors.bright}[Better Auth]:${colors.reset} ${message}`;\n};\nconst createLogger = (options) => {\n  const enabled = options?.disabled !== true;\n  const logLevel = options?.level ?? \"error\";\n  const LogFunc = (level, message, args = []) => {\n    if (!enabled || !shouldPublishLog(logLevel, level)) {\n      return;\n    }\n    const formattedMessage = formatMessage(level, message);\n    if (!options || typeof options.log !== \"function\") {\n      if (level === \"error\") {\n        console.error(formattedMessage, ...args);\n      } else if (level === \"warn\") {\n        console.warn(formattedMessage, ...args);\n      } else {\n        console.log(formattedMessage, ...args);\n      }\n      return;\n    }\n    options.log(level === \"success\" ? \"info\" : level, message, ...args);\n  };\n  return Object.fromEntries(\n    levels.map((level) => [\n      level,\n      (...[message, ...args]) => LogFunc(level, message, args)\n    ])\n  );\n};\nconst logger = createLogger();\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguREJHZklEbmgubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUF3RTs7QUFFeEU7QUFDQSxTQUFTLHNGQUEyQjtBQUNwQzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxXQUFXLEVBQUUsVUFBVSxFQUFFLGNBQWMsRUFBRSxtQkFBbUIsRUFBRSxvQkFBb0IsRUFBRSxjQUFjLEVBQUUsY0FBYyxnQkFBZ0IsY0FBYyxFQUFFLFFBQVE7QUFDdEs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRStGIiwic291cmNlcyI6WyIvVXNlcnMvbWlsYW4vRGVza3RvcC9BcHBzL2JldHRlci1hdXRoL25vZGVfbW9kdWxlcy9iZXR0ZXItYXV0aC9kaXN0L3NoYXJlZC9iZXR0ZXItYXV0aC5EQkdmSURuaC5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlUmFuZG9tU3RyaW5nR2VuZXJhdG9yIH0gZnJvbSAnQGJldHRlci1hdXRoL3V0aWxzL3JhbmRvbSc7XG5cbmNvbnN0IGdlbmVyYXRlSWQgPSAoc2l6ZSkgPT4ge1xuICByZXR1cm4gY3JlYXRlUmFuZG9tU3RyaW5nR2VuZXJhdG9yKFwiYS16XCIsIFwiQS1aXCIsIFwiMC05XCIpKHNpemUgfHwgMzIpO1xufTtcblxuY29uc3QgbGV2ZWxzID0gW1wiaW5mb1wiLCBcInN1Y2Nlc3NcIiwgXCJ3YXJuXCIsIFwiZXJyb3JcIiwgXCJkZWJ1Z1wiXTtcbmZ1bmN0aW9uIHNob3VsZFB1Ymxpc2hMb2coY3VycmVudExvZ0xldmVsLCBsb2dMZXZlbCkge1xuICByZXR1cm4gbGV2ZWxzLmluZGV4T2YobG9nTGV2ZWwpIDw9IGxldmVscy5pbmRleE9mKGN1cnJlbnRMb2dMZXZlbCk7XG59XG5jb25zdCBjb2xvcnMgPSB7XG4gIHJlc2V0OiBcIlxceDFCWzBtXCIsXG4gIGJyaWdodDogXCJcXHgxQlsxbVwiLFxuICBkaW06IFwiXFx4MUJbMm1cIixcbiAgZmc6IHtcbiAgICByZWQ6IFwiXFx4MUJbMzFtXCIsXG4gICAgZ3JlZW46IFwiXFx4MUJbMzJtXCIsXG4gICAgeWVsbG93OiBcIlxceDFCWzMzbVwiLFxuICAgIGJsdWU6IFwiXFx4MUJbMzRtXCIsXG4gICAgbWFnZW50YTogXCJcXHgxQlszNW1cIn19O1xuY29uc3QgbGV2ZWxDb2xvcnMgPSB7XG4gIGluZm86IGNvbG9ycy5mZy5ibHVlLFxuICBzdWNjZXNzOiBjb2xvcnMuZmcuZ3JlZW4sXG4gIHdhcm46IGNvbG9ycy5mZy55ZWxsb3csXG4gIGVycm9yOiBjb2xvcnMuZmcucmVkLFxuICBkZWJ1ZzogY29sb3JzLmZnLm1hZ2VudGFcbn07XG5jb25zdCBmb3JtYXRNZXNzYWdlID0gKGxldmVsLCBtZXNzYWdlKSA9PiB7XG4gIGNvbnN0IHRpbWVzdGFtcCA9ICgvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSkudG9JU09TdHJpbmcoKTtcbiAgcmV0dXJuIGAke2NvbG9ycy5kaW19JHt0aW1lc3RhbXB9JHtjb2xvcnMucmVzZXR9ICR7bGV2ZWxDb2xvcnNbbGV2ZWxdfSR7bGV2ZWwudG9VcHBlckNhc2UoKX0ke2NvbG9ycy5yZXNldH0gJHtjb2xvcnMuYnJpZ2h0fVtCZXR0ZXIgQXV0aF06JHtjb2xvcnMucmVzZXR9ICR7bWVzc2FnZX1gO1xufTtcbmNvbnN0IGNyZWF0ZUxvZ2dlciA9IChvcHRpb25zKSA9PiB7XG4gIGNvbnN0IGVuYWJsZWQgPSBvcHRpb25zPy5kaXNhYmxlZCAhPT0gdHJ1ZTtcbiAgY29uc3QgbG9nTGV2ZWwgPSBvcHRpb25zPy5sZXZlbCA/PyBcImVycm9yXCI7XG4gIGNvbnN0IExvZ0Z1bmMgPSAobGV2ZWwsIG1lc3NhZ2UsIGFyZ3MgPSBbXSkgPT4ge1xuICAgIGlmICghZW5hYmxlZCB8fCAhc2hvdWxkUHVibGlzaExvZyhsb2dMZXZlbCwgbGV2ZWwpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGZvcm1hdHRlZE1lc3NhZ2UgPSBmb3JtYXRNZXNzYWdlKGxldmVsLCBtZXNzYWdlKTtcbiAgICBpZiAoIW9wdGlvbnMgfHwgdHlwZW9mIG9wdGlvbnMubG9nICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIGlmIChsZXZlbCA9PT0gXCJlcnJvclwiKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZm9ybWF0dGVkTWVzc2FnZSwgLi4uYXJncyk7XG4gICAgICB9IGVsc2UgaWYgKGxldmVsID09PSBcIndhcm5cIikge1xuICAgICAgICBjb25zb2xlLndhcm4oZm9ybWF0dGVkTWVzc2FnZSwgLi4uYXJncyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZyhmb3JtYXR0ZWRNZXNzYWdlLCAuLi5hcmdzKTtcbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgb3B0aW9ucy5sb2cobGV2ZWwgPT09IFwic3VjY2Vzc1wiID8gXCJpbmZvXCIgOiBsZXZlbCwgbWVzc2FnZSwgLi4uYXJncyk7XG4gIH07XG4gIHJldHVybiBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgbGV2ZWxzLm1hcCgobGV2ZWwpID0+IFtcbiAgICAgIGxldmVsLFxuICAgICAgKC4uLlttZXNzYWdlLCAuLi5hcmdzXSkgPT4gTG9nRnVuYyhsZXZlbCwgbWVzc2FnZSwgYXJncylcbiAgICBdKVxuICApO1xufTtcbmNvbnN0IGxvZ2dlciA9IGNyZWF0ZUxvZ2dlcigpO1xuXG5leHBvcnQgeyBsb2dnZXIgYXMgYSwgY3JlYXRlTG9nZ2VyIGFzIGMsIGdlbmVyYXRlSWQgYXMgZywgbGV2ZWxzIGFzIGwsIHNob3VsZFB1Ymxpc2hMb2cgYXMgcyB9O1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DBGfIDnh.mjs\n");

/***/ }),

/***/ "(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DGpadpzN.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.DGpadpzN.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   m: () => (/* binding */ memoryAdapter)\n/* harmony export */ });\n/* harmony import */ var _better_auth_utils_random__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @better-auth/utils/random */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/random.mjs\");\n/* harmony import */ var better_call__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! better-call */ \"(action-browser)/../../node_modules/better-call/dist/index.js\");\n/* harmony import */ var _better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @better-auth/utils/hash */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/hash.mjs\");\n/* harmony import */ var _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @better-auth/utils/base64 */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/base64.mjs\");\n/* harmony import */ var _better_auth_utils__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @better-auth/utils */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/index.mjs\");\n/* harmony import */ var _better_auth_utils_hex__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @better-auth/utils/hex */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/hex.mjs\");\n/* harmony import */ var _better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./better-auth.B4Qoxdgc.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs\");\n/* harmony import */ var _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./better-auth.DBGfIDnh.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DBGfIDnh.mjs\");\n/* harmony import */ var _better_auth_gBl3F_xa_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./better-auth.gBl3F_xa.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.gBl3F_xa.mjs\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst memoryAdapter = (db, config) => (0,_better_auth_gBl3F_xa_mjs__WEBPACK_IMPORTED_MODULE_8__.c)({\n  config: {\n    adapterId: \"memory\",\n    adapterName: \"Memory Adapter\",\n    usePlural: false,\n    debugLogs: config?.debugLogs || false,\n    customTransformInput(props) {\n      if (props.options.advanced?.database?.useNumberId && props.field === \"id\" && props.action === \"create\") {\n        return db[props.model].length + 1;\n      }\n      return props.data;\n    }\n  },\n  adapter: ({ getFieldName, options, debugLog }) => {\n    function convertWhereClause(where, model) {\n      const table = db[model];\n      if (!table) {\n        _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_7__.a.error(\n          `[MemoryAdapter] Model ${model} not found in the DB`,\n          Object.keys(db)\n        );\n        throw new Error(`Model ${model} not found`);\n      }\n      return table.filter((record) => {\n        return where.every((clause) => {\n          let { field, value, operator } = clause;\n          if (operator === \"in\") {\n            if (!Array.isArray(value)) {\n              throw new Error(\"Value must be an array\");\n            }\n            return value.includes(record[field]);\n          } else if (operator === \"contains\") {\n            return record[field].includes(value);\n          } else if (operator === \"starts_with\") {\n            return record[field].startsWith(value);\n          } else if (operator === \"ends_with\") {\n            return record[field].endsWith(value);\n          } else {\n            return record[field] === value;\n          }\n        });\n      });\n    }\n    return {\n      create: async ({ model, data }) => {\n        if (options.advanced?.database?.useNumberId) {\n          data.id = db[model].length + 1;\n        }\n        if (!db[model]) {\n          db[model] = [];\n        }\n        db[model].push(data);\n        return data;\n      },\n      findOne: async ({ model, where }) => {\n        const res = convertWhereClause(where, model);\n        const record = res[0] || null;\n        return record;\n      },\n      findMany: async ({ model, where, sortBy, limit, offset }) => {\n        let table = db[model];\n        if (where) {\n          table = convertWhereClause(where, model);\n        }\n        if (sortBy) {\n          table = table.sort((a, b) => {\n            const field = getFieldName({ model, field: sortBy.field });\n            if (sortBy.direction === \"asc\") {\n              return a[field] > b[field] ? 1 : -1;\n            } else {\n              return a[field] < b[field] ? 1 : -1;\n            }\n          });\n        }\n        if (offset !== void 0) {\n          table = table.slice(offset);\n        }\n        if (limit !== void 0) {\n          table = table.slice(0, limit);\n        }\n        return table;\n      },\n      count: async ({ model }) => {\n        return db[model].length;\n      },\n      update: async ({ model, where, update }) => {\n        const res = convertWhereClause(where, model);\n        res.forEach((record) => {\n          Object.assign(record, update);\n        });\n        return res[0] || null;\n      },\n      delete: async ({ model, where }) => {\n        const table = db[model];\n        const res = convertWhereClause(where, model);\n        db[model] = table.filter((record) => !res.includes(record));\n      },\n      deleteMany: async ({ model, where }) => {\n        const table = db[model];\n        const res = convertWhereClause(where, model);\n        let count = 0;\n        db[model] = table.filter((record) => {\n          if (res.includes(record)) {\n            count++;\n            return false;\n          }\n          return !res.includes(record);\n        });\n        return count;\n      },\n      updateMany({ model, where, update }) {\n        const res = convertWhereClause(where, model);\n        res.forEach((record) => {\n          Object.assign(record, update);\n        });\n        return res[0] || null;\n      }\n    };\n  }\n});\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguREdwYWRwek4ubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBbUM7QUFDbkI7QUFDSztBQUNZO0FBQ0Y7QUFDRDtBQUNJO0FBQ0M7QUFDckI7QUFDZ0I7QUFDRjtBQUNJO0FBQ0g7QUFDTztBQUNxQjtBQUNPOztBQUVoRSxzQ0FBc0MsNERBQWE7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxjQUFjLGlDQUFpQztBQUMvQztBQUNBO0FBQ0E7QUFDQSxRQUFRLHdEQUFNO0FBQ2QsbUNBQW1DLE9BQU87QUFDMUM7QUFDQTtBQUNBLGlDQUFpQyxPQUFPO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQix5QkFBeUI7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBLFlBQVk7QUFDWjtBQUNBLFlBQVk7QUFDWjtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0EsU0FBUztBQUNULE9BQU87QUFDUDtBQUNBO0FBQ0EsdUJBQXVCLGFBQWE7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCx3QkFBd0IsY0FBYztBQUN0QztBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AseUJBQXlCLHFDQUFxQztBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUMsNEJBQTRCO0FBQ3JFO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLHNCQUFzQixPQUFPO0FBQzdCO0FBQ0EsT0FBTztBQUNQLHVCQUF1QixzQkFBc0I7QUFDN0M7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsT0FBTztBQUNQLHVCQUF1QixjQUFjO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCwyQkFBMkIsY0FBYztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxPQUFPO0FBQ1AsbUJBQW1CLHNCQUFzQjtBQUN6QztBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUU2QiIsInNvdXJjZXMiOlsiL1VzZXJzL21pbGFuL0Rlc2t0b3AvQXBwcy9iZXR0ZXItYXV0aC9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguREdwYWRwek4ubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzL3JhbmRvbSc7XG5pbXBvcnQgJ3pvZC92NCc7XG5pbXBvcnQgJ2JldHRlci1jYWxsJztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzL2hhc2gnO1xuaW1wb3J0ICdAbm9ibGUvY2lwaGVycy9jaGFjaGEnO1xuaW1wb3J0ICdAbm9ibGUvY2lwaGVycy91dGlscyc7XG5pbXBvcnQgJ0Bub2JsZS9jaXBoZXJzL3dlYmNyeXB0byc7XG5pbXBvcnQgJ0BiZXR0ZXItYXV0aC91dGlscy9iYXNlNjQnO1xuaW1wb3J0ICdqb3NlJztcbmltcG9ydCAnQG5vYmxlL2hhc2hlcy9zY3J5cHQnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMvaGV4JztcbmltcG9ydCAnQG5vYmxlL2hhc2hlcy91dGlscyc7XG5pbXBvcnQgJy4vYmV0dGVyLWF1dGguQjRRb3hkZ2MubWpzJztcbmltcG9ydCB7IGEgYXMgbG9nZ2VyIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC5EQkdmSURuaC5tanMnO1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVBZGFwdGVyIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC5nQmwzRl94YS5tanMnO1xuXG5jb25zdCBtZW1vcnlBZGFwdGVyID0gKGRiLCBjb25maWcpID0+IGNyZWF0ZUFkYXB0ZXIoe1xuICBjb25maWc6IHtcbiAgICBhZGFwdGVySWQ6IFwibWVtb3J5XCIsXG4gICAgYWRhcHRlck5hbWU6IFwiTWVtb3J5IEFkYXB0ZXJcIixcbiAgICB1c2VQbHVyYWw6IGZhbHNlLFxuICAgIGRlYnVnTG9nczogY29uZmlnPy5kZWJ1Z0xvZ3MgfHwgZmFsc2UsXG4gICAgY3VzdG9tVHJhbnNmb3JtSW5wdXQocHJvcHMpIHtcbiAgICAgIGlmIChwcm9wcy5vcHRpb25zLmFkdmFuY2VkPy5kYXRhYmFzZT8udXNlTnVtYmVySWQgJiYgcHJvcHMuZmllbGQgPT09IFwiaWRcIiAmJiBwcm9wcy5hY3Rpb24gPT09IFwiY3JlYXRlXCIpIHtcbiAgICAgICAgcmV0dXJuIGRiW3Byb3BzLm1vZGVsXS5sZW5ndGggKyAxO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHByb3BzLmRhdGE7XG4gICAgfVxuICB9LFxuICBhZGFwdGVyOiAoeyBnZXRGaWVsZE5hbWUsIG9wdGlvbnMsIGRlYnVnTG9nIH0pID0+IHtcbiAgICBmdW5jdGlvbiBjb252ZXJ0V2hlcmVDbGF1c2Uod2hlcmUsIG1vZGVsKSB7XG4gICAgICBjb25zdCB0YWJsZSA9IGRiW21vZGVsXTtcbiAgICAgIGlmICghdGFibGUpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKFxuICAgICAgICAgIGBbTWVtb3J5QWRhcHRlcl0gTW9kZWwgJHttb2RlbH0gbm90IGZvdW5kIGluIHRoZSBEQmAsXG4gICAgICAgICAgT2JqZWN0LmtleXMoZGIpXG4gICAgICAgICk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgTW9kZWwgJHttb2RlbH0gbm90IGZvdW5kYCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGFibGUuZmlsdGVyKChyZWNvcmQpID0+IHtcbiAgICAgICAgcmV0dXJuIHdoZXJlLmV2ZXJ5KChjbGF1c2UpID0+IHtcbiAgICAgICAgICBsZXQgeyBmaWVsZCwgdmFsdWUsIG9wZXJhdG9yIH0gPSBjbGF1c2U7XG4gICAgICAgICAgaWYgKG9wZXJhdG9yID09PSBcImluXCIpIHtcbiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVmFsdWUgbXVzdCBiZSBhbiBhcnJheVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB2YWx1ZS5pbmNsdWRlcyhyZWNvcmRbZmllbGRdKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKG9wZXJhdG9yID09PSBcImNvbnRhaW5zXCIpIHtcbiAgICAgICAgICAgIHJldHVybiByZWNvcmRbZmllbGRdLmluY2x1ZGVzKHZhbHVlKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKG9wZXJhdG9yID09PSBcInN0YXJ0c193aXRoXCIpIHtcbiAgICAgICAgICAgIHJldHVybiByZWNvcmRbZmllbGRdLnN0YXJ0c1dpdGgodmFsdWUpO1xuICAgICAgICAgIH0gZWxzZSBpZiAob3BlcmF0b3IgPT09IFwiZW5kc193aXRoXCIpIHtcbiAgICAgICAgICAgIHJldHVybiByZWNvcmRbZmllbGRdLmVuZHNXaXRoKHZhbHVlKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHJlY29yZFtmaWVsZF0gPT09IHZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIGNyZWF0ZTogYXN5bmMgKHsgbW9kZWwsIGRhdGEgfSkgPT4ge1xuICAgICAgICBpZiAob3B0aW9ucy5hZHZhbmNlZD8uZGF0YWJhc2U/LnVzZU51bWJlcklkKSB7XG4gICAgICAgICAgZGF0YS5pZCA9IGRiW21vZGVsXS5sZW5ndGggKyAxO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZGJbbW9kZWxdKSB7XG4gICAgICAgICAgZGJbbW9kZWxdID0gW107XG4gICAgICAgIH1cbiAgICAgICAgZGJbbW9kZWxdLnB1c2goZGF0YSk7XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgfSxcbiAgICAgIGZpbmRPbmU6IGFzeW5jICh7IG1vZGVsLCB3aGVyZSB9KSA9PiB7XG4gICAgICAgIGNvbnN0IHJlcyA9IGNvbnZlcnRXaGVyZUNsYXVzZSh3aGVyZSwgbW9kZWwpO1xuICAgICAgICBjb25zdCByZWNvcmQgPSByZXNbMF0gfHwgbnVsbDtcbiAgICAgICAgcmV0dXJuIHJlY29yZDtcbiAgICAgIH0sXG4gICAgICBmaW5kTWFueTogYXN5bmMgKHsgbW9kZWwsIHdoZXJlLCBzb3J0QnksIGxpbWl0LCBvZmZzZXQgfSkgPT4ge1xuICAgICAgICBsZXQgdGFibGUgPSBkYlttb2RlbF07XG4gICAgICAgIGlmICh3aGVyZSkge1xuICAgICAgICAgIHRhYmxlID0gY29udmVydFdoZXJlQ2xhdXNlKHdoZXJlLCBtb2RlbCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNvcnRCeSkge1xuICAgICAgICAgIHRhYmxlID0gdGFibGUuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgICAgY29uc3QgZmllbGQgPSBnZXRGaWVsZE5hbWUoeyBtb2RlbCwgZmllbGQ6IHNvcnRCeS5maWVsZCB9KTtcbiAgICAgICAgICAgIGlmIChzb3J0QnkuZGlyZWN0aW9uID09PSBcImFzY1wiKSB7XG4gICAgICAgICAgICAgIHJldHVybiBhW2ZpZWxkXSA+IGJbZmllbGRdID8gMSA6IC0xO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGFbZmllbGRdIDwgYltmaWVsZF0gPyAxIDogLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9mZnNldCAhPT0gdm9pZCAwKSB7XG4gICAgICAgICAgdGFibGUgPSB0YWJsZS5zbGljZShvZmZzZXQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChsaW1pdCAhPT0gdm9pZCAwKSB7XG4gICAgICAgICAgdGFibGUgPSB0YWJsZS5zbGljZSgwLCBsaW1pdCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRhYmxlO1xuICAgICAgfSxcbiAgICAgIGNvdW50OiBhc3luYyAoeyBtb2RlbCB9KSA9PiB7XG4gICAgICAgIHJldHVybiBkYlttb2RlbF0ubGVuZ3RoO1xuICAgICAgfSxcbiAgICAgIHVwZGF0ZTogYXN5bmMgKHsgbW9kZWwsIHdoZXJlLCB1cGRhdGUgfSkgPT4ge1xuICAgICAgICBjb25zdCByZXMgPSBjb252ZXJ0V2hlcmVDbGF1c2Uod2hlcmUsIG1vZGVsKTtcbiAgICAgICAgcmVzLmZvckVhY2goKHJlY29yZCkgPT4ge1xuICAgICAgICAgIE9iamVjdC5hc3NpZ24ocmVjb3JkLCB1cGRhdGUpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlc1swXSB8fCBudWxsO1xuICAgICAgfSxcbiAgICAgIGRlbGV0ZTogYXN5bmMgKHsgbW9kZWwsIHdoZXJlIH0pID0+IHtcbiAgICAgICAgY29uc3QgdGFibGUgPSBkYlttb2RlbF07XG4gICAgICAgIGNvbnN0IHJlcyA9IGNvbnZlcnRXaGVyZUNsYXVzZSh3aGVyZSwgbW9kZWwpO1xuICAgICAgICBkYlttb2RlbF0gPSB0YWJsZS5maWx0ZXIoKHJlY29yZCkgPT4gIXJlcy5pbmNsdWRlcyhyZWNvcmQpKTtcbiAgICAgIH0sXG4gICAgICBkZWxldGVNYW55OiBhc3luYyAoeyBtb2RlbCwgd2hlcmUgfSkgPT4ge1xuICAgICAgICBjb25zdCB0YWJsZSA9IGRiW21vZGVsXTtcbiAgICAgICAgY29uc3QgcmVzID0gY29udmVydFdoZXJlQ2xhdXNlKHdoZXJlLCBtb2RlbCk7XG4gICAgICAgIGxldCBjb3VudCA9IDA7XG4gICAgICAgIGRiW21vZGVsXSA9IHRhYmxlLmZpbHRlcigocmVjb3JkKSA9PiB7XG4gICAgICAgICAgaWYgKHJlcy5pbmNsdWRlcyhyZWNvcmQpKSB7XG4gICAgICAgICAgICBjb3VudCsrO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gIXJlcy5pbmNsdWRlcyhyZWNvcmQpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGNvdW50O1xuICAgICAgfSxcbiAgICAgIHVwZGF0ZU1hbnkoeyBtb2RlbCwgd2hlcmUsIHVwZGF0ZSB9KSB7XG4gICAgICAgIGNvbnN0IHJlcyA9IGNvbnZlcnRXaGVyZUNsYXVzZSh3aGVyZSwgbW9kZWwpO1xuICAgICAgICByZXMuZm9yRWFjaCgocmVjb3JkKSA9PiB7XG4gICAgICAgICAgT2JqZWN0LmFzc2lnbihyZWNvcmQsIHVwZGF0ZSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmVzWzBdIHx8IG51bGw7XG4gICAgICB9XG4gICAgfTtcbiAgfVxufSk7XG5cbmV4cG9ydCB7IG1lbW9yeUFkYXB0ZXIgYXMgbSB9O1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DGpadpzN.mjs\n");

/***/ }),

/***/ "(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DORkW_Ge.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.DORkW_Ge.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   g: () => (/* binding */ getAuthTables)\n/* harmony export */ });\nconst getAuthTables = (options) => {\n  const pluginSchema = options.plugins?.reduce(\n    (acc, plugin) => {\n      const schema = plugin.schema;\n      if (!schema) return acc;\n      for (const [key, value] of Object.entries(schema)) {\n        acc[key] = {\n          fields: {\n            ...acc[key]?.fields,\n            ...value.fields\n          },\n          modelName: value.modelName || key\n        };\n      }\n      return acc;\n    },\n    {}\n  );\n  const shouldAddRateLimitTable = options.rateLimit?.storage === \"database\";\n  const rateLimitTable = {\n    rateLimit: {\n      modelName: options.rateLimit?.modelName || \"rateLimit\",\n      fields: {\n        key: {\n          type: \"string\",\n          fieldName: options.rateLimit?.fields?.key || \"key\"\n        },\n        count: {\n          type: \"number\",\n          fieldName: options.rateLimit?.fields?.count || \"count\"\n        },\n        lastRequest: {\n          type: \"number\",\n          bigint: true,\n          fieldName: options.rateLimit?.fields?.lastRequest || \"lastRequest\"\n        }\n      }\n    }\n  };\n  const { user, session, account, ...pluginTables } = pluginSchema || {};\n  const sessionTable = {\n    session: {\n      modelName: options.session?.modelName || \"session\",\n      fields: {\n        expiresAt: {\n          type: \"date\",\n          required: true,\n          fieldName: options.session?.fields?.expiresAt || \"expiresAt\"\n        },\n        token: {\n          type: \"string\",\n          required: true,\n          fieldName: options.session?.fields?.token || \"token\",\n          unique: true\n        },\n        createdAt: {\n          type: \"date\",\n          required: true,\n          fieldName: options.session?.fields?.createdAt || \"createdAt\"\n        },\n        updatedAt: {\n          type: \"date\",\n          required: true,\n          fieldName: options.session?.fields?.updatedAt || \"updatedAt\"\n        },\n        ipAddress: {\n          type: \"string\",\n          required: false,\n          fieldName: options.session?.fields?.ipAddress || \"ipAddress\"\n        },\n        userAgent: {\n          type: \"string\",\n          required: false,\n          fieldName: options.session?.fields?.userAgent || \"userAgent\"\n        },\n        userId: {\n          type: \"string\",\n          fieldName: options.session?.fields?.userId || \"userId\",\n          references: {\n            model: options.user?.modelName || \"user\",\n            field: \"id\",\n            onDelete: \"cascade\"\n          },\n          required: true\n        },\n        ...session?.fields,\n        ...options.session?.additionalFields\n      },\n      order: 2\n    }\n  };\n  return {\n    user: {\n      modelName: options.user?.modelName || \"user\",\n      fields: {\n        name: {\n          type: \"string\",\n          required: true,\n          fieldName: options.user?.fields?.name || \"name\",\n          sortable: true\n        },\n        email: {\n          type: \"string\",\n          unique: true,\n          required: true,\n          fieldName: options.user?.fields?.email || \"email\",\n          sortable: true\n        },\n        emailVerified: {\n          type: \"boolean\",\n          defaultValue: () => false,\n          required: true,\n          fieldName: options.user?.fields?.emailVerified || \"emailVerified\"\n        },\n        image: {\n          type: \"string\",\n          required: false,\n          fieldName: options.user?.fields?.image || \"image\"\n        },\n        createdAt: {\n          type: \"date\",\n          defaultValue: () => /* @__PURE__ */ new Date(),\n          required: true,\n          fieldName: options.user?.fields?.createdAt || \"createdAt\"\n        },\n        updatedAt: {\n          type: \"date\",\n          defaultValue: () => /* @__PURE__ */ new Date(),\n          required: true,\n          fieldName: options.user?.fields?.updatedAt || \"updatedAt\"\n        },\n        ...user?.fields,\n        ...options.user?.additionalFields\n      },\n      order: 1\n    },\n    //only add session table if it's not stored in secondary storage\n    ...!options.secondaryStorage || options.session?.storeSessionInDatabase ? sessionTable : {},\n    account: {\n      modelName: options.account?.modelName || \"account\",\n      fields: {\n        accountId: {\n          type: \"string\",\n          required: true,\n          fieldName: options.account?.fields?.accountId || \"accountId\"\n        },\n        providerId: {\n          type: \"string\",\n          required: true,\n          fieldName: options.account?.fields?.providerId || \"providerId\"\n        },\n        userId: {\n          type: \"string\",\n          references: {\n            model: options.user?.modelName || \"user\",\n            field: \"id\",\n            onDelete: \"cascade\"\n          },\n          required: true,\n          fieldName: options.account?.fields?.userId || \"userId\"\n        },\n        accessToken: {\n          type: \"string\",\n          required: false,\n          fieldName: options.account?.fields?.accessToken || \"accessToken\"\n        },\n        refreshToken: {\n          type: \"string\",\n          required: false,\n          fieldName: options.account?.fields?.refreshToken || \"refreshToken\"\n        },\n        idToken: {\n          type: \"string\",\n          required: false,\n          fieldName: options.account?.fields?.idToken || \"idToken\"\n        },\n        accessTokenExpiresAt: {\n          type: \"date\",\n          required: false,\n          fieldName: options.account?.fields?.accessTokenExpiresAt || \"accessTokenExpiresAt\"\n        },\n        refreshTokenExpiresAt: {\n          type: \"date\",\n          required: false,\n          fieldName: options.account?.fields?.accessTokenExpiresAt || \"refreshTokenExpiresAt\"\n        },\n        scope: {\n          type: \"string\",\n          required: false,\n          fieldName: options.account?.fields?.scope || \"scope\"\n        },\n        password: {\n          type: \"string\",\n          required: false,\n          fieldName: options.account?.fields?.password || \"password\"\n        },\n        createdAt: {\n          type: \"date\",\n          required: true,\n          fieldName: options.account?.fields?.createdAt || \"createdAt\"\n        },\n        updatedAt: {\n          type: \"date\",\n          required: true,\n          fieldName: options.account?.fields?.updatedAt || \"updatedAt\"\n        },\n        ...account?.fields\n      },\n      order: 3\n    },\n    verification: {\n      modelName: options.verification?.modelName || \"verification\",\n      fields: {\n        identifier: {\n          type: \"string\",\n          required: true,\n          fieldName: options.verification?.fields?.identifier || \"identifier\"\n        },\n        value: {\n          type: \"string\",\n          required: true,\n          fieldName: options.verification?.fields?.value || \"value\"\n        },\n        expiresAt: {\n          type: \"date\",\n          required: true,\n          fieldName: options.verification?.fields?.expiresAt || \"expiresAt\"\n        },\n        createdAt: {\n          type: \"date\",\n          required: false,\n          defaultValue: () => /* @__PURE__ */ new Date(),\n          fieldName: options.verification?.fields?.createdAt || \"createdAt\"\n        },\n        updatedAt: {\n          type: \"date\",\n          required: false,\n          defaultValue: () => /* @__PURE__ */ new Date(),\n          fieldName: options.verification?.fields?.updatedAt || \"updatedAt\"\n        }\n      },\n      order: 4\n    },\n    ...pluginTables,\n    ...shouldAddRateLimitTable ? rateLimitTable : {}\n  };\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguRE9Sa1dfR2UubWpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsMENBQTBDO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLEtBQUs7QUFDTDtBQUNBLCtGQUErRjtBQUMvRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLE9BQU87QUFDUDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTs7QUFFOEIiLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWxhbi9EZXNrdG9wL0FwcHMvYmV0dGVyLWF1dGgvbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLkRPUmtXX0dlLm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBnZXRBdXRoVGFibGVzID0gKG9wdGlvbnMpID0+IHtcbiAgY29uc3QgcGx1Z2luU2NoZW1hID0gb3B0aW9ucy5wbHVnaW5zPy5yZWR1Y2UoXG4gICAgKGFjYywgcGx1Z2luKSA9PiB7XG4gICAgICBjb25zdCBzY2hlbWEgPSBwbHVnaW4uc2NoZW1hO1xuICAgICAgaWYgKCFzY2hlbWEpIHJldHVybiBhY2M7XG4gICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhzY2hlbWEpKSB7XG4gICAgICAgIGFjY1trZXldID0ge1xuICAgICAgICAgIGZpZWxkczoge1xuICAgICAgICAgICAgLi4uYWNjW2tleV0/LmZpZWxkcyxcbiAgICAgICAgICAgIC4uLnZhbHVlLmZpZWxkc1xuICAgICAgICAgIH0sXG4gICAgICAgICAgbW9kZWxOYW1lOiB2YWx1ZS5tb2RlbE5hbWUgfHwga2V5XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH0sXG4gICAge31cbiAgKTtcbiAgY29uc3Qgc2hvdWxkQWRkUmF0ZUxpbWl0VGFibGUgPSBvcHRpb25zLnJhdGVMaW1pdD8uc3RvcmFnZSA9PT0gXCJkYXRhYmFzZVwiO1xuICBjb25zdCByYXRlTGltaXRUYWJsZSA9IHtcbiAgICByYXRlTGltaXQ6IHtcbiAgICAgIG1vZGVsTmFtZTogb3B0aW9ucy5yYXRlTGltaXQ/Lm1vZGVsTmFtZSB8fCBcInJhdGVMaW1pdFwiLFxuICAgICAgZmllbGRzOiB7XG4gICAgICAgIGtleToge1xuICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLnJhdGVMaW1pdD8uZmllbGRzPy5rZXkgfHwgXCJrZXlcIlxuICAgICAgICB9LFxuICAgICAgICBjb3VudDoge1xuICAgICAgICAgIHR5cGU6IFwibnVtYmVyXCIsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLnJhdGVMaW1pdD8uZmllbGRzPy5jb3VudCB8fCBcImNvdW50XCJcbiAgICAgICAgfSxcbiAgICAgICAgbGFzdFJlcXVlc3Q6IHtcbiAgICAgICAgICB0eXBlOiBcIm51bWJlclwiLFxuICAgICAgICAgIGJpZ2ludDogdHJ1ZSxcbiAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMucmF0ZUxpbWl0Py5maWVsZHM/Lmxhc3RSZXF1ZXN0IHx8IFwibGFzdFJlcXVlc3RcIlxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCB7IHVzZXIsIHNlc3Npb24sIGFjY291bnQsIC4uLnBsdWdpblRhYmxlcyB9ID0gcGx1Z2luU2NoZW1hIHx8IHt9O1xuICBjb25zdCBzZXNzaW9uVGFibGUgPSB7XG4gICAgc2Vzc2lvbjoge1xuICAgICAgbW9kZWxOYW1lOiBvcHRpb25zLnNlc3Npb24/Lm1vZGVsTmFtZSB8fCBcInNlc3Npb25cIixcbiAgICAgIGZpZWxkczoge1xuICAgICAgICBleHBpcmVzQXQ6IHtcbiAgICAgICAgICB0eXBlOiBcImRhdGVcIixcbiAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMuc2Vzc2lvbj8uZmllbGRzPy5leHBpcmVzQXQgfHwgXCJleHBpcmVzQXRcIlxuICAgICAgICB9LFxuICAgICAgICB0b2tlbjoge1xuICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLnNlc3Npb24/LmZpZWxkcz8udG9rZW4gfHwgXCJ0b2tlblwiLFxuICAgICAgICAgIHVuaXF1ZTogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBjcmVhdGVkQXQ6IHtcbiAgICAgICAgICB0eXBlOiBcImRhdGVcIixcbiAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMuc2Vzc2lvbj8uZmllbGRzPy5jcmVhdGVkQXQgfHwgXCJjcmVhdGVkQXRcIlxuICAgICAgICB9LFxuICAgICAgICB1cGRhdGVkQXQ6IHtcbiAgICAgICAgICB0eXBlOiBcImRhdGVcIixcbiAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMuc2Vzc2lvbj8uZmllbGRzPy51cGRhdGVkQXQgfHwgXCJ1cGRhdGVkQXRcIlxuICAgICAgICB9LFxuICAgICAgICBpcEFkZHJlc3M6IHtcbiAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMuc2Vzc2lvbj8uZmllbGRzPy5pcEFkZHJlc3MgfHwgXCJpcEFkZHJlc3NcIlxuICAgICAgICB9LFxuICAgICAgICB1c2VyQWdlbnQ6IHtcbiAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMuc2Vzc2lvbj8uZmllbGRzPy51c2VyQWdlbnQgfHwgXCJ1c2VyQWdlbnRcIlxuICAgICAgICB9LFxuICAgICAgICB1c2VySWQ6IHtcbiAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgIGZpZWxkTmFtZTogb3B0aW9ucy5zZXNzaW9uPy5maWVsZHM/LnVzZXJJZCB8fCBcInVzZXJJZFwiLFxuICAgICAgICAgIHJlZmVyZW5jZXM6IHtcbiAgICAgICAgICAgIG1vZGVsOiBvcHRpb25zLnVzZXI/Lm1vZGVsTmFtZSB8fCBcInVzZXJcIixcbiAgICAgICAgICAgIGZpZWxkOiBcImlkXCIsXG4gICAgICAgICAgICBvbkRlbGV0ZTogXCJjYXNjYWRlXCJcbiAgICAgICAgICB9LFxuICAgICAgICAgIHJlcXVpcmVkOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIC4uLnNlc3Npb24/LmZpZWxkcyxcbiAgICAgICAgLi4ub3B0aW9ucy5zZXNzaW9uPy5hZGRpdGlvbmFsRmllbGRzXG4gICAgICB9LFxuICAgICAgb3JkZXI6IDJcbiAgICB9XG4gIH07XG4gIHJldHVybiB7XG4gICAgdXNlcjoge1xuICAgICAgbW9kZWxOYW1lOiBvcHRpb25zLnVzZXI/Lm1vZGVsTmFtZSB8fCBcInVzZXJcIixcbiAgICAgIGZpZWxkczoge1xuICAgICAgICBuYW1lOiB7XG4gICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMudXNlcj8uZmllbGRzPy5uYW1lIHx8IFwibmFtZVwiLFxuICAgICAgICAgIHNvcnRhYmxlOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIGVtYWlsOiB7XG4gICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICB1bmlxdWU6IHRydWUsXG4gICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLnVzZXI/LmZpZWxkcz8uZW1haWwgfHwgXCJlbWFpbFwiLFxuICAgICAgICAgIHNvcnRhYmxlOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIGVtYWlsVmVyaWZpZWQ6IHtcbiAgICAgICAgICB0eXBlOiBcImJvb2xlYW5cIixcbiAgICAgICAgICBkZWZhdWx0VmFsdWU6ICgpID0+IGZhbHNlLFxuICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgIGZpZWxkTmFtZTogb3B0aW9ucy51c2VyPy5maWVsZHM/LmVtYWlsVmVyaWZpZWQgfHwgXCJlbWFpbFZlcmlmaWVkXCJcbiAgICAgICAgfSxcbiAgICAgICAgaW1hZ2U6IHtcbiAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMudXNlcj8uZmllbGRzPy5pbWFnZSB8fCBcImltYWdlXCJcbiAgICAgICAgfSxcbiAgICAgICAgY3JlYXRlZEF0OiB7XG4gICAgICAgICAgdHlwZTogXCJkYXRlXCIsXG4gICAgICAgICAgZGVmYXVsdFZhbHVlOiAoKSA9PiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSxcbiAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMudXNlcj8uZmllbGRzPy5jcmVhdGVkQXQgfHwgXCJjcmVhdGVkQXRcIlxuICAgICAgICB9LFxuICAgICAgICB1cGRhdGVkQXQ6IHtcbiAgICAgICAgICB0eXBlOiBcImRhdGVcIixcbiAgICAgICAgICBkZWZhdWx0VmFsdWU6ICgpID0+IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpLFxuICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgIGZpZWxkTmFtZTogb3B0aW9ucy51c2VyPy5maWVsZHM/LnVwZGF0ZWRBdCB8fCBcInVwZGF0ZWRBdFwiXG4gICAgICAgIH0sXG4gICAgICAgIC4uLnVzZXI/LmZpZWxkcyxcbiAgICAgICAgLi4ub3B0aW9ucy51c2VyPy5hZGRpdGlvbmFsRmllbGRzXG4gICAgICB9LFxuICAgICAgb3JkZXI6IDFcbiAgICB9LFxuICAgIC8vb25seSBhZGQgc2Vzc2lvbiB0YWJsZSBpZiBpdCdzIG5vdCBzdG9yZWQgaW4gc2Vjb25kYXJ5IHN0b3JhZ2VcbiAgICAuLi4hb3B0aW9ucy5zZWNvbmRhcnlTdG9yYWdlIHx8IG9wdGlvbnMuc2Vzc2lvbj8uc3RvcmVTZXNzaW9uSW5EYXRhYmFzZSA/IHNlc3Npb25UYWJsZSA6IHt9LFxuICAgIGFjY291bnQ6IHtcbiAgICAgIG1vZGVsTmFtZTogb3B0aW9ucy5hY2NvdW50Py5tb2RlbE5hbWUgfHwgXCJhY2NvdW50XCIsXG4gICAgICBmaWVsZHM6IHtcbiAgICAgICAgYWNjb3VudElkOiB7XG4gICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMuYWNjb3VudD8uZmllbGRzPy5hY2NvdW50SWQgfHwgXCJhY2NvdW50SWRcIlxuICAgICAgICB9LFxuICAgICAgICBwcm92aWRlcklkOiB7XG4gICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMuYWNjb3VudD8uZmllbGRzPy5wcm92aWRlcklkIHx8IFwicHJvdmlkZXJJZFwiXG4gICAgICAgIH0sXG4gICAgICAgIHVzZXJJZDoge1xuICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgcmVmZXJlbmNlczoge1xuICAgICAgICAgICAgbW9kZWw6IG9wdGlvbnMudXNlcj8ubW9kZWxOYW1lIHx8IFwidXNlclwiLFxuICAgICAgICAgICAgZmllbGQ6IFwiaWRcIixcbiAgICAgICAgICAgIG9uRGVsZXRlOiBcImNhc2NhZGVcIlxuICAgICAgICAgIH0sXG4gICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLmFjY291bnQ/LmZpZWxkcz8udXNlcklkIHx8IFwidXNlcklkXCJcbiAgICAgICAgfSxcbiAgICAgICAgYWNjZXNzVG9rZW46IHtcbiAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMuYWNjb3VudD8uZmllbGRzPy5hY2Nlc3NUb2tlbiB8fCBcImFjY2Vzc1Rva2VuXCJcbiAgICAgICAgfSxcbiAgICAgICAgcmVmcmVzaFRva2VuOiB7XG4gICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLmFjY291bnQ/LmZpZWxkcz8ucmVmcmVzaFRva2VuIHx8IFwicmVmcmVzaFRva2VuXCJcbiAgICAgICAgfSxcbiAgICAgICAgaWRUb2tlbjoge1xuICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgICAgIGZpZWxkTmFtZTogb3B0aW9ucy5hY2NvdW50Py5maWVsZHM/LmlkVG9rZW4gfHwgXCJpZFRva2VuXCJcbiAgICAgICAgfSxcbiAgICAgICAgYWNjZXNzVG9rZW5FeHBpcmVzQXQ6IHtcbiAgICAgICAgICB0eXBlOiBcImRhdGVcIixcbiAgICAgICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLmFjY291bnQ/LmZpZWxkcz8uYWNjZXNzVG9rZW5FeHBpcmVzQXQgfHwgXCJhY2Nlc3NUb2tlbkV4cGlyZXNBdFwiXG4gICAgICAgIH0sXG4gICAgICAgIHJlZnJlc2hUb2tlbkV4cGlyZXNBdDoge1xuICAgICAgICAgIHR5cGU6IFwiZGF0ZVwiLFxuICAgICAgICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMuYWNjb3VudD8uZmllbGRzPy5hY2Nlc3NUb2tlbkV4cGlyZXNBdCB8fCBcInJlZnJlc2hUb2tlbkV4cGlyZXNBdFwiXG4gICAgICAgIH0sXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLmFjY291bnQ/LmZpZWxkcz8uc2NvcGUgfHwgXCJzY29wZVwiXG4gICAgICAgIH0sXG4gICAgICAgIHBhc3N3b3JkOiB7XG4gICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLmFjY291bnQ/LmZpZWxkcz8ucGFzc3dvcmQgfHwgXCJwYXNzd29yZFwiXG4gICAgICAgIH0sXG4gICAgICAgIGNyZWF0ZWRBdDoge1xuICAgICAgICAgIHR5cGU6IFwiZGF0ZVwiLFxuICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgIGZpZWxkTmFtZTogb3B0aW9ucy5hY2NvdW50Py5maWVsZHM/LmNyZWF0ZWRBdCB8fCBcImNyZWF0ZWRBdFwiXG4gICAgICAgIH0sXG4gICAgICAgIHVwZGF0ZWRBdDoge1xuICAgICAgICAgIHR5cGU6IFwiZGF0ZVwiLFxuICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgIGZpZWxkTmFtZTogb3B0aW9ucy5hY2NvdW50Py5maWVsZHM/LnVwZGF0ZWRBdCB8fCBcInVwZGF0ZWRBdFwiXG4gICAgICAgIH0sXG4gICAgICAgIC4uLmFjY291bnQ/LmZpZWxkc1xuICAgICAgfSxcbiAgICAgIG9yZGVyOiAzXG4gICAgfSxcbiAgICB2ZXJpZmljYXRpb246IHtcbiAgICAgIG1vZGVsTmFtZTogb3B0aW9ucy52ZXJpZmljYXRpb24/Lm1vZGVsTmFtZSB8fCBcInZlcmlmaWNhdGlvblwiLFxuICAgICAgZmllbGRzOiB7XG4gICAgICAgIGlkZW50aWZpZXI6IHtcbiAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgIGZpZWxkTmFtZTogb3B0aW9ucy52ZXJpZmljYXRpb24/LmZpZWxkcz8uaWRlbnRpZmllciB8fCBcImlkZW50aWZpZXJcIlxuICAgICAgICB9LFxuICAgICAgICB2YWx1ZToge1xuICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLnZlcmlmaWNhdGlvbj8uZmllbGRzPy52YWx1ZSB8fCBcInZhbHVlXCJcbiAgICAgICAgfSxcbiAgICAgICAgZXhwaXJlc0F0OiB7XG4gICAgICAgICAgdHlwZTogXCJkYXRlXCIsXG4gICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLnZlcmlmaWNhdGlvbj8uZmllbGRzPy5leHBpcmVzQXQgfHwgXCJleHBpcmVzQXRcIlxuICAgICAgICB9LFxuICAgICAgICBjcmVhdGVkQXQ6IHtcbiAgICAgICAgICB0eXBlOiBcImRhdGVcIixcbiAgICAgICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICAgICAgZGVmYXVsdFZhbHVlOiAoKSA9PiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSxcbiAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMudmVyaWZpY2F0aW9uPy5maWVsZHM/LmNyZWF0ZWRBdCB8fCBcImNyZWF0ZWRBdFwiXG4gICAgICAgIH0sXG4gICAgICAgIHVwZGF0ZWRBdDoge1xuICAgICAgICAgIHR5cGU6IFwiZGF0ZVwiLFxuICAgICAgICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICAgICAgICBkZWZhdWx0VmFsdWU6ICgpID0+IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpLFxuICAgICAgICAgIGZpZWxkTmFtZTogb3B0aW9ucy52ZXJpZmljYXRpb24/LmZpZWxkcz8udXBkYXRlZEF0IHx8IFwidXBkYXRlZEF0XCJcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIG9yZGVyOiA0XG4gICAgfSxcbiAgICAuLi5wbHVnaW5UYWJsZXMsXG4gICAgLi4uc2hvdWxkQWRkUmF0ZUxpbWl0VGFibGUgPyByYXRlTGltaXRUYWJsZSA6IHt9XG4gIH07XG59O1xuXG5leHBvcnQgeyBnZXRBdXRoVGFibGVzIGFzIGcgfTtcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DORkW_Ge.mjs\n");

/***/ }),

/***/ "(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DcfNPS8q.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.DcfNPS8q.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   g: () => (/* binding */ getIp)\n/* harmony export */ });\n/* harmony import */ var _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./better-auth.8zoxzg-F.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs\");\n\n\nfunction getIp(req, options) {\n  if (options.advanced?.ipAddress?.disableIpTracking) {\n    return null;\n  }\n  if (_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__.i) {\n    return \"127.0.0.1\";\n  }\n  const headers = \"headers\" in req ? req.headers : req;\n  const defaultHeaders = [\"x-forwarded-for\"];\n  const ipHeaders = options.advanced?.ipAddress?.ipAddressHeaders || defaultHeaders;\n  for (const key of ipHeaders) {\n    const value = \"get\" in headers ? headers.get(key) : headers[key];\n    if (typeof value === \"string\") {\n      const ip = value.split(\",\")[0].trim();\n      if (isValidIP(ip)) {\n        return ip;\n      }\n    }\n  }\n  return null;\n}\nfunction isValidIP(ip) {\n  const ipv4Regex = /^(\\d{1,3}\\.){3}\\d{1,3}$/;\n  if (ipv4Regex.test(ip)) {\n    const parts = ip.split(\".\").map(Number);\n    return parts.every((part) => part >= 0 && part <= 255);\n  }\n  const ipv6Regex = /^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/;\n  return ipv6Regex.test(ip);\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguRGNmTlBTOHEubWpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQXlEOztBQUV6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sd0RBQU07QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLElBQUksSUFBSSxFQUFFLEdBQUcsSUFBSTtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxJQUFJLEdBQUcsRUFBRSxZQUFZLElBQUk7QUFDNUQ7QUFDQTs7QUFFc0IiLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWxhbi9EZXNrdG9wL0FwcHMvYmV0dGVyLWF1dGgvbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLkRjZk5QUzhxLm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpIGFzIGlzVGVzdCB9IGZyb20gJy4vYmV0dGVyLWF1dGguOHpveHpnLUYubWpzJztcblxuZnVuY3Rpb24gZ2V0SXAocmVxLCBvcHRpb25zKSB7XG4gIGlmIChvcHRpb25zLmFkdmFuY2VkPy5pcEFkZHJlc3M/LmRpc2FibGVJcFRyYWNraW5nKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgaWYgKGlzVGVzdCkge1xuICAgIHJldHVybiBcIjEyNy4wLjAuMVwiO1xuICB9XG4gIGNvbnN0IGhlYWRlcnMgPSBcImhlYWRlcnNcIiBpbiByZXEgPyByZXEuaGVhZGVycyA6IHJlcTtcbiAgY29uc3QgZGVmYXVsdEhlYWRlcnMgPSBbXCJ4LWZvcndhcmRlZC1mb3JcIl07XG4gIGNvbnN0IGlwSGVhZGVycyA9IG9wdGlvbnMuYWR2YW5jZWQ/LmlwQWRkcmVzcz8uaXBBZGRyZXNzSGVhZGVycyB8fCBkZWZhdWx0SGVhZGVycztcbiAgZm9yIChjb25zdCBrZXkgb2YgaXBIZWFkZXJzKSB7XG4gICAgY29uc3QgdmFsdWUgPSBcImdldFwiIGluIGhlYWRlcnMgPyBoZWFkZXJzLmdldChrZXkpIDogaGVhZGVyc1trZXldO1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIGNvbnN0IGlwID0gdmFsdWUuc3BsaXQoXCIsXCIpWzBdLnRyaW0oKTtcbiAgICAgIGlmIChpc1ZhbGlkSVAoaXApKSB7XG4gICAgICAgIHJldHVybiBpcDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59XG5mdW5jdGlvbiBpc1ZhbGlkSVAoaXApIHtcbiAgY29uc3QgaXB2NFJlZ2V4ID0gL14oXFxkezEsM31cXC4pezN9XFxkezEsM30kLztcbiAgaWYgKGlwdjRSZWdleC50ZXN0KGlwKSkge1xuICAgIGNvbnN0IHBhcnRzID0gaXAuc3BsaXQoXCIuXCIpLm1hcChOdW1iZXIpO1xuICAgIHJldHVybiBwYXJ0cy5ldmVyeSgocGFydCkgPT4gcGFydCA+PSAwICYmIHBhcnQgPD0gMjU1KTtcbiAgfVxuICBjb25zdCBpcHY2UmVnZXggPSAvXihbMC05YS1mQS1GXXsxLDR9Oil7N31bMC05YS1mQS1GXXsxLDR9JC87XG4gIHJldHVybiBpcHY2UmVnZXgudGVzdChpcCk7XG59XG5cbmV4cG9ydCB7IGdldElwIGFzIGcgfTtcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DcfNPS8q.mjs\n");

/***/ }),

/***/ "(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   B: () => (/* binding */ BetterAuthError),\n/* harmony export */   M: () => (/* binding */ MissingDependencyError)\n/* harmony export */ });\nclass BetterAuthError extends Error {\n  constructor(message, cause) {\n    super(message);\n    this.name = \"BetterAuthError\";\n    this.message = message;\n    this.cause = cause;\n    this.stack = \"\";\n  }\n}\nclass MissingDependencyError extends BetterAuthError {\n  constructor(pkgName) {\n    super(\n      `The package \"${pkgName}\" is required. Make sure it is installed.`,\n      pkgName\n    );\n  }\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguRGR6U0pmLW4ubWpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLFFBQVE7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7O0FBRTZEIiwic291cmNlcyI6WyIvVXNlcnMvbWlsYW4vRGVza3RvcC9BcHBzL2JldHRlci1hdXRoL25vZGVfbW9kdWxlcy9iZXR0ZXItYXV0aC9kaXN0L3NoYXJlZC9iZXR0ZXItYXV0aC5EZHpTSmYtbi5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgQmV0dGVyQXV0aEVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihtZXNzYWdlLCBjYXVzZSkge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIHRoaXMubmFtZSA9IFwiQmV0dGVyQXV0aEVycm9yXCI7XG4gICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTtcbiAgICB0aGlzLmNhdXNlID0gY2F1c2U7XG4gICAgdGhpcy5zdGFjayA9IFwiXCI7XG4gIH1cbn1cbmNsYXNzIE1pc3NpbmdEZXBlbmRlbmN5RXJyb3IgZXh0ZW5kcyBCZXR0ZXJBdXRoRXJyb3Ige1xuICBjb25zdHJ1Y3Rvcihwa2dOYW1lKSB7XG4gICAgc3VwZXIoXG4gICAgICBgVGhlIHBhY2thZ2UgXCIke3BrZ05hbWV9XCIgaXMgcmVxdWlyZWQuIE1ha2Ugc3VyZSBpdCBpcyBpbnN0YWxsZWQuYCxcbiAgICAgIHBrZ05hbWVcbiAgICApO1xuICB9XG59XG5cbmV4cG9ydCB7IEJldHRlckF1dGhFcnJvciBhcyBCLCBNaXNzaW5nRGVwZW5kZW5jeUVycm9yIGFzIE0gfTtcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs\n");

/***/ }),

/***/ "(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DwzM-9N1.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.DwzM-9N1.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   c: () => (/* binding */ createKyselyAdapter),\n/* harmony export */   k: () => (/* binding */ kyselyAdapter)\n/* harmony export */ });\n/* harmony import */ var kysely__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! kysely */ \"(action-browser)/../../node_modules/kysely/dist/esm/dialect/sqlite/sqlite-dialect.js\");\n/* harmony import */ var kysely__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! kysely */ \"(action-browser)/../../node_modules/kysely/dist/esm/dialect/mysql/mysql-dialect.js\");\n/* harmony import */ var kysely__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! kysely */ \"(action-browser)/../../node_modules/kysely/dist/esm/dialect/postgres/postgres-dialect.js\");\n/* harmony import */ var kysely__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! kysely */ \"(action-browser)/../../node_modules/kysely/dist/esm/dialect/mssql/mssql-dialect.js\");\n/* harmony import */ var kysely__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! kysely */ \"(action-browser)/../../node_modules/kysely/dist/esm/kysely.js\");\n/* harmony import */ var _better_auth_gBl3F_xa_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./better-auth.gBl3F_xa.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.gBl3F_xa.mjs\");\n\n\n\nfunction getDatabaseType(db) {\n  if (!db) {\n    return null;\n  }\n  if (\"dialect\" in db) {\n    return getDatabaseType(db.dialect);\n  }\n  if (\"createDriver\" in db) {\n    if (db instanceof kysely__WEBPACK_IMPORTED_MODULE_1__.SqliteDialect) {\n      return \"sqlite\";\n    }\n    if (db instanceof kysely__WEBPACK_IMPORTED_MODULE_2__.MysqlDialect) {\n      return \"mysql\";\n    }\n    if (db instanceof kysely__WEBPACK_IMPORTED_MODULE_3__.PostgresDialect) {\n      return \"postgres\";\n    }\n    if (db instanceof kysely__WEBPACK_IMPORTED_MODULE_4__.MssqlDialect) {\n      return \"mssql\";\n    }\n  }\n  if (\"aggregate\" in db) {\n    return \"sqlite\";\n  }\n  if (\"getConnection\" in db) {\n    return \"mysql\";\n  }\n  if (\"connect\" in db) {\n    return \"postgres\";\n  }\n  if (\"fileControl\" in db) {\n    return \"sqlite\";\n  }\n  return null;\n}\nconst createKyselyAdapter = async (config) => {\n  const db = config.database;\n  if (!db) {\n    return {\n      kysely: null,\n      databaseType: null\n    };\n  }\n  if (\"db\" in db) {\n    return {\n      kysely: db.db,\n      databaseType: db.type\n    };\n  }\n  if (\"dialect\" in db) {\n    return {\n      kysely: new kysely__WEBPACK_IMPORTED_MODULE_5__.Kysely({ dialect: db.dialect }),\n      databaseType: db.type\n    };\n  }\n  let dialect = void 0;\n  const databaseType = getDatabaseType(db);\n  if (\"createDriver\" in db) {\n    dialect = db;\n  }\n  if (\"aggregate\" in db) {\n    dialect = new kysely__WEBPACK_IMPORTED_MODULE_1__.SqliteDialect({\n      database: db\n    });\n  }\n  if (\"getConnection\" in db) {\n    dialect = new kysely__WEBPACK_IMPORTED_MODULE_2__.MysqlDialect(db);\n  }\n  if (\"connect\" in db) {\n    dialect = new kysely__WEBPACK_IMPORTED_MODULE_3__.PostgresDialect({\n      pool: db\n    });\n  }\n  if (\"fileControl\" in db) {\n    const { BunSqliteDialect } = await __webpack_require__.e(/*! import() */ \"vendor-chunks/better-auth\").then(__webpack_require__.bind(__webpack_require__, /*! ../chunks/bun-sqlite-dialect.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/chunks/bun-sqlite-dialect.mjs\"));\n    dialect = new BunSqliteDialect({\n      database: db\n    });\n  }\n  return {\n    kysely: dialect ? new kysely__WEBPACK_IMPORTED_MODULE_5__.Kysely({ dialect }) : null,\n    databaseType\n  };\n};\n\nconst kyselyAdapter = (db, config) => (0,_better_auth_gBl3F_xa_mjs__WEBPACK_IMPORTED_MODULE_0__.c)({\n  config: {\n    adapterId: \"kysely\",\n    adapterName: \"Kysely Adapter\",\n    usePlural: config?.usePlural,\n    debugLogs: config?.debugLogs,\n    supportsBooleans: config?.type === \"sqlite\" || config?.type === \"mssql\" || !config?.type ? false : true,\n    supportsDates: config?.type === \"sqlite\" || config?.type === \"mssql\" || !config?.type ? false : true,\n    supportsJSON: false\n  },\n  adapter: ({ getFieldName, schema }) => {\n    const withReturning = async (values, builder, model, where) => {\n      let res;\n      if (config?.type === \"mysql\") {\n        await builder.execute();\n        const field = values.id ? \"id\" : where.length > 0 && where[0].field ? where[0].field : \"id\";\n        if (!values.id && where.length === 0) {\n          res = await db.selectFrom(model).selectAll().orderBy(getFieldName({ model, field }), \"desc\").limit(1).executeTakeFirst();\n          return res;\n        }\n        const value = values[field] || where[0].value;\n        res = await db.selectFrom(model).selectAll().orderBy(getFieldName({ model, field }), \"desc\").where(getFieldName({ model, field }), \"=\", value).limit(1).executeTakeFirst();\n        return res;\n      }\n      if (config?.type === \"mssql\") {\n        res = await builder.outputAll(\"inserted\").executeTakeFirst();\n        return res;\n      }\n      res = await builder.returningAll().executeTakeFirst();\n      return res;\n    };\n    function transformValueToDB(value, model, field) {\n      if (field === \"id\") {\n        return value;\n      }\n      const { type = \"sqlite\" } = config || {};\n      let f = schema[model]?.fields[field];\n      if (!f) {\n        f = Object.values(schema).find((f2) => f2.modelName === model);\n      }\n      if (f.type === \"boolean\" && (type === \"sqlite\" || type === \"mssql\") && value !== null && value !== void 0) {\n        return value ? 1 : 0;\n      }\n      if (f.type === \"date\" && value && value instanceof Date) {\n        return type === \"sqlite\" ? value.toISOString() : value;\n      }\n      return value;\n    }\n    function convertWhereClause(model, w) {\n      if (!w)\n        return {\n          and: null,\n          or: null\n        };\n      const conditions = {\n        and: [],\n        or: []\n      };\n      w.forEach((condition) => {\n        let {\n          field: _field,\n          value,\n          operator = \"=\",\n          connector = \"AND\"\n        } = condition;\n        const field = getFieldName({ model, field: _field });\n        value = transformValueToDB(value, model, _field);\n        const expr = (eb) => {\n          if (operator.toLowerCase() === \"in\") {\n            return eb(field, \"in\", Array.isArray(value) ? value : [value]);\n          }\n          if (operator === \"contains\") {\n            return eb(field, \"like\", `%${value}%`);\n          }\n          if (operator === \"starts_with\") {\n            return eb(field, \"like\", `${value}%`);\n          }\n          if (operator === \"ends_with\") {\n            return eb(field, \"like\", `%${value}`);\n          }\n          if (operator === \"eq\") {\n            return eb(field, \"=\", value);\n          }\n          if (operator === \"ne\") {\n            return eb(field, \"<>\", value);\n          }\n          if (operator === \"gt\") {\n            return eb(field, \">\", value);\n          }\n          if (operator === \"gte\") {\n            return eb(field, \">=\", value);\n          }\n          if (operator === \"lt\") {\n            return eb(field, \"<\", value);\n          }\n          if (operator === \"lte\") {\n            return eb(field, \"<=\", value);\n          }\n          return eb(field, operator, value);\n        };\n        if (connector === \"OR\") {\n          conditions.or.push(expr);\n        } else {\n          conditions.and.push(expr);\n        }\n      });\n      return {\n        and: conditions.and.length ? conditions.and : null,\n        or: conditions.or.length ? conditions.or : null\n      };\n    }\n    return {\n      async create({ data, model }) {\n        const builder = db.insertInto(model).values(data);\n        return await withReturning(data, builder, model, []);\n      },\n      async findOne({ model, where, select }) {\n        const { and, or } = convertWhereClause(model, where);\n        let query = db.selectFrom(model).selectAll();\n        if (and) {\n          query = query.where((eb) => eb.and(and.map((expr) => expr(eb))));\n        }\n        if (or) {\n          query = query.where((eb) => eb.or(or.map((expr) => expr(eb))));\n        }\n        const res = await query.executeTakeFirst();\n        if (!res) return null;\n        return res;\n      },\n      async findMany({ model, where, limit, offset, sortBy }) {\n        const { and, or } = convertWhereClause(model, where);\n        let query = db.selectFrom(model);\n        if (and) {\n          query = query.where((eb) => eb.and(and.map((expr) => expr(eb))));\n        }\n        if (or) {\n          query = query.where((eb) => eb.or(or.map((expr) => expr(eb))));\n        }\n        if (config?.type === \"mssql\") {\n          if (!offset) {\n            query = query.top(limit || 100);\n          }\n        } else {\n          query = query.limit(limit || 100);\n        }\n        if (sortBy) {\n          query = query.orderBy(\n            getFieldName({ model, field: sortBy.field }),\n            sortBy.direction\n          );\n        }\n        if (offset) {\n          if (config?.type === \"mssql\") {\n            if (!sortBy) {\n              query = query.orderBy(getFieldName({ model, field: \"id\" }));\n            }\n            query = query.offset(offset).fetch(limit || 100);\n          } else {\n            query = query.offset(offset);\n          }\n        }\n        const res = await query.selectAll().execute();\n        if (!res) return [];\n        return res;\n      },\n      async update({ model, where, update: values }) {\n        const { and, or } = convertWhereClause(model, where);\n        let query = db.updateTable(model).set(values);\n        if (and) {\n          query = query.where((eb) => eb.and(and.map((expr) => expr(eb))));\n        }\n        if (or) {\n          query = query.where((eb) => eb.or(or.map((expr) => expr(eb))));\n        }\n        return await withReturning(values, query, model, where);\n      },\n      async updateMany({ model, where, update: values }) {\n        const { and, or } = convertWhereClause(model, where);\n        let query = db.updateTable(model).set(values);\n        if (and) {\n          query = query.where((eb) => eb.and(and.map((expr) => expr(eb))));\n        }\n        if (or) {\n          query = query.where((eb) => eb.or(or.map((expr) => expr(eb))));\n        }\n        const res = await query.execute();\n        return res.length;\n      },\n      async count({ model, where }) {\n        const { and, or } = convertWhereClause(model, where);\n        let query = db.selectFrom(model).select(db.fn.count(\"id\").as(\"count\"));\n        if (and) {\n          query = query.where((eb) => eb.and(and.map((expr) => expr(eb))));\n        }\n        if (or) {\n          query = query.where((eb) => eb.or(or.map((expr) => expr(eb))));\n        }\n        const res = await query.execute();\n        return res[0].count;\n      },\n      async delete({ model, where }) {\n        const { and, or } = convertWhereClause(model, where);\n        let query = db.deleteFrom(model);\n        if (and) {\n          query = query.where((eb) => eb.and(and.map((expr) => expr(eb))));\n        }\n        if (or) {\n          query = query.where((eb) => eb.or(or.map((expr) => expr(eb))));\n        }\n        await query.execute();\n      },\n      async deleteMany({ model, where }) {\n        const { and, or } = convertWhereClause(model, where);\n        let query = db.deleteFrom(model);\n        if (and) {\n          query = query.where((eb) => eb.and(and.map((expr) => expr(eb))));\n        }\n        if (or) {\n          query = query.where((eb) => eb.or(or.map((expr) => expr(eb))));\n        }\n        return (await query.execute()).length;\n      },\n      options: config\n    };\n  }\n});\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguRHd6TS05TjEubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQTRGO0FBQzVCOztBQUVoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLGlEQUFhO0FBQ25DO0FBQ0E7QUFDQSxzQkFBc0IsZ0RBQVk7QUFDbEM7QUFDQTtBQUNBLHNCQUFzQixtREFBZTtBQUNyQztBQUNBO0FBQ0Esc0JBQXNCLGdEQUFZO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQiwwQ0FBTSxHQUFHLHFCQUFxQjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsaURBQWE7QUFDL0I7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLGtCQUFrQixnREFBWTtBQUM5QjtBQUNBO0FBQ0Esa0JBQWtCLG1EQUFlO0FBQ2pDO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZLG1CQUFtQixRQUFRLG9QQUEwQztBQUNqRjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSwwQkFBMEIsMENBQU0sR0FBRyxTQUFTO0FBQzVDO0FBQ0E7QUFDQTs7QUFFQSxzQ0FBc0MsNERBQWE7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxjQUFjLHNCQUFzQjtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4RUFBOEUsY0FBYztBQUM1RjtBQUNBO0FBQ0E7QUFDQSw0RUFBNEUsY0FBYyxnQ0FBZ0MsY0FBYztBQUN4STtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsa0JBQWtCO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWLHFDQUFxQyxzQkFBc0I7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLE1BQU07QUFDL0M7QUFDQTtBQUNBLHdDQUF3QyxNQUFNO0FBQzlDO0FBQ0E7QUFDQSx5Q0FBeUMsTUFBTTtBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLGFBQWE7QUFDbEM7QUFDQTtBQUNBLE9BQU87QUFDUCxzQkFBc0Isc0JBQXNCO0FBQzVDLGdCQUFnQixVQUFVO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLHVCQUF1QixxQ0FBcUM7QUFDNUQsZ0JBQWdCLFVBQVU7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQiw0QkFBNEI7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbURBQW1ELG9CQUFvQjtBQUN2RTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxxQkFBcUIsOEJBQThCO0FBQ25ELGdCQUFnQixVQUFVO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AseUJBQXlCLDhCQUE4QjtBQUN2RCxnQkFBZ0IsVUFBVTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1Asb0JBQW9CLGNBQWM7QUFDbEMsZ0JBQWdCLFVBQVU7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLHFCQUFxQixjQUFjO0FBQ25DLGdCQUFnQixVQUFVO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AseUJBQXlCLGNBQWM7QUFDdkMsZ0JBQWdCLFVBQVU7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUV1RCIsInNvdXJjZXMiOlsiL1VzZXJzL21pbGFuL0Rlc2t0b3AvQXBwcy9iZXR0ZXItYXV0aC9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguRHd6TS05TjEubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEt5c2VseSwgU3FsaXRlRGlhbGVjdCwgTXlzcWxEaWFsZWN0LCBQb3N0Z3Jlc0RpYWxlY3QsIE1zc3FsRGlhbGVjdCB9IGZyb20gJ2t5c2VseSc7XG5pbXBvcnQgeyBjIGFzIGNyZWF0ZUFkYXB0ZXIgfSBmcm9tICcuL2JldHRlci1hdXRoLmdCbDNGX3hhLm1qcyc7XG5cbmZ1bmN0aW9uIGdldERhdGFiYXNlVHlwZShkYikge1xuICBpZiAoIWRiKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgaWYgKFwiZGlhbGVjdFwiIGluIGRiKSB7XG4gICAgcmV0dXJuIGdldERhdGFiYXNlVHlwZShkYi5kaWFsZWN0KTtcbiAgfVxuICBpZiAoXCJjcmVhdGVEcml2ZXJcIiBpbiBkYikge1xuICAgIGlmIChkYiBpbnN0YW5jZW9mIFNxbGl0ZURpYWxlY3QpIHtcbiAgICAgIHJldHVybiBcInNxbGl0ZVwiO1xuICAgIH1cbiAgICBpZiAoZGIgaW5zdGFuY2VvZiBNeXNxbERpYWxlY3QpIHtcbiAgICAgIHJldHVybiBcIm15c3FsXCI7XG4gICAgfVxuICAgIGlmIChkYiBpbnN0YW5jZW9mIFBvc3RncmVzRGlhbGVjdCkge1xuICAgICAgcmV0dXJuIFwicG9zdGdyZXNcIjtcbiAgICB9XG4gICAgaWYgKGRiIGluc3RhbmNlb2YgTXNzcWxEaWFsZWN0KSB7XG4gICAgICByZXR1cm4gXCJtc3NxbFwiO1xuICAgIH1cbiAgfVxuICBpZiAoXCJhZ2dyZWdhdGVcIiBpbiBkYikge1xuICAgIHJldHVybiBcInNxbGl0ZVwiO1xuICB9XG4gIGlmIChcImdldENvbm5lY3Rpb25cIiBpbiBkYikge1xuICAgIHJldHVybiBcIm15c3FsXCI7XG4gIH1cbiAgaWYgKFwiY29ubmVjdFwiIGluIGRiKSB7XG4gICAgcmV0dXJuIFwicG9zdGdyZXNcIjtcbiAgfVxuICBpZiAoXCJmaWxlQ29udHJvbFwiIGluIGRiKSB7XG4gICAgcmV0dXJuIFwic3FsaXRlXCI7XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59XG5jb25zdCBjcmVhdGVLeXNlbHlBZGFwdGVyID0gYXN5bmMgKGNvbmZpZykgPT4ge1xuICBjb25zdCBkYiA9IGNvbmZpZy5kYXRhYmFzZTtcbiAgaWYgKCFkYikge1xuICAgIHJldHVybiB7XG4gICAgICBreXNlbHk6IG51bGwsXG4gICAgICBkYXRhYmFzZVR5cGU6IG51bGxcbiAgICB9O1xuICB9XG4gIGlmIChcImRiXCIgaW4gZGIpIHtcbiAgICByZXR1cm4ge1xuICAgICAga3lzZWx5OiBkYi5kYixcbiAgICAgIGRhdGFiYXNlVHlwZTogZGIudHlwZVxuICAgIH07XG4gIH1cbiAgaWYgKFwiZGlhbGVjdFwiIGluIGRiKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGt5c2VseTogbmV3IEt5c2VseSh7IGRpYWxlY3Q6IGRiLmRpYWxlY3QgfSksXG4gICAgICBkYXRhYmFzZVR5cGU6IGRiLnR5cGVcbiAgICB9O1xuICB9XG4gIGxldCBkaWFsZWN0ID0gdm9pZCAwO1xuICBjb25zdCBkYXRhYmFzZVR5cGUgPSBnZXREYXRhYmFzZVR5cGUoZGIpO1xuICBpZiAoXCJjcmVhdGVEcml2ZXJcIiBpbiBkYikge1xuICAgIGRpYWxlY3QgPSBkYjtcbiAgfVxuICBpZiAoXCJhZ2dyZWdhdGVcIiBpbiBkYikge1xuICAgIGRpYWxlY3QgPSBuZXcgU3FsaXRlRGlhbGVjdCh7XG4gICAgICBkYXRhYmFzZTogZGJcbiAgICB9KTtcbiAgfVxuICBpZiAoXCJnZXRDb25uZWN0aW9uXCIgaW4gZGIpIHtcbiAgICBkaWFsZWN0ID0gbmV3IE15c3FsRGlhbGVjdChkYik7XG4gIH1cbiAgaWYgKFwiY29ubmVjdFwiIGluIGRiKSB7XG4gICAgZGlhbGVjdCA9IG5ldyBQb3N0Z3Jlc0RpYWxlY3Qoe1xuICAgICAgcG9vbDogZGJcbiAgICB9KTtcbiAgfVxuICBpZiAoXCJmaWxlQ29udHJvbFwiIGluIGRiKSB7XG4gICAgY29uc3QgeyBCdW5TcWxpdGVEaWFsZWN0IH0gPSBhd2FpdCBpbXBvcnQoJy4uL2NodW5rcy9idW4tc3FsaXRlLWRpYWxlY3QubWpzJyk7XG4gICAgZGlhbGVjdCA9IG5ldyBCdW5TcWxpdGVEaWFsZWN0KHtcbiAgICAgIGRhdGFiYXNlOiBkYlxuICAgIH0pO1xuICB9XG4gIHJldHVybiB7XG4gICAga3lzZWx5OiBkaWFsZWN0ID8gbmV3IEt5c2VseSh7IGRpYWxlY3QgfSkgOiBudWxsLFxuICAgIGRhdGFiYXNlVHlwZVxuICB9O1xufTtcblxuY29uc3Qga3lzZWx5QWRhcHRlciA9IChkYiwgY29uZmlnKSA9PiBjcmVhdGVBZGFwdGVyKHtcbiAgY29uZmlnOiB7XG4gICAgYWRhcHRlcklkOiBcImt5c2VseVwiLFxuICAgIGFkYXB0ZXJOYW1lOiBcIkt5c2VseSBBZGFwdGVyXCIsXG4gICAgdXNlUGx1cmFsOiBjb25maWc/LnVzZVBsdXJhbCxcbiAgICBkZWJ1Z0xvZ3M6IGNvbmZpZz8uZGVidWdMb2dzLFxuICAgIHN1cHBvcnRzQm9vbGVhbnM6IGNvbmZpZz8udHlwZSA9PT0gXCJzcWxpdGVcIiB8fCBjb25maWc/LnR5cGUgPT09IFwibXNzcWxcIiB8fCAhY29uZmlnPy50eXBlID8gZmFsc2UgOiB0cnVlLFxuICAgIHN1cHBvcnRzRGF0ZXM6IGNvbmZpZz8udHlwZSA9PT0gXCJzcWxpdGVcIiB8fCBjb25maWc/LnR5cGUgPT09IFwibXNzcWxcIiB8fCAhY29uZmlnPy50eXBlID8gZmFsc2UgOiB0cnVlLFxuICAgIHN1cHBvcnRzSlNPTjogZmFsc2VcbiAgfSxcbiAgYWRhcHRlcjogKHsgZ2V0RmllbGROYW1lLCBzY2hlbWEgfSkgPT4ge1xuICAgIGNvbnN0IHdpdGhSZXR1cm5pbmcgPSBhc3luYyAodmFsdWVzLCBidWlsZGVyLCBtb2RlbCwgd2hlcmUpID0+IHtcbiAgICAgIGxldCByZXM7XG4gICAgICBpZiAoY29uZmlnPy50eXBlID09PSBcIm15c3FsXCIpIHtcbiAgICAgICAgYXdhaXQgYnVpbGRlci5leGVjdXRlKCk7XG4gICAgICAgIGNvbnN0IGZpZWxkID0gdmFsdWVzLmlkID8gXCJpZFwiIDogd2hlcmUubGVuZ3RoID4gMCAmJiB3aGVyZVswXS5maWVsZCA/IHdoZXJlWzBdLmZpZWxkIDogXCJpZFwiO1xuICAgICAgICBpZiAoIXZhbHVlcy5pZCAmJiB3aGVyZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICByZXMgPSBhd2FpdCBkYi5zZWxlY3RGcm9tKG1vZGVsKS5zZWxlY3RBbGwoKS5vcmRlckJ5KGdldEZpZWxkTmFtZSh7IG1vZGVsLCBmaWVsZCB9KSwgXCJkZXNjXCIpLmxpbWl0KDEpLmV4ZWN1dGVUYWtlRmlyc3QoKTtcbiAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHZhbHVlID0gdmFsdWVzW2ZpZWxkXSB8fCB3aGVyZVswXS52YWx1ZTtcbiAgICAgICAgcmVzID0gYXdhaXQgZGIuc2VsZWN0RnJvbShtb2RlbCkuc2VsZWN0QWxsKCkub3JkZXJCeShnZXRGaWVsZE5hbWUoeyBtb2RlbCwgZmllbGQgfSksIFwiZGVzY1wiKS53aGVyZShnZXRGaWVsZE5hbWUoeyBtb2RlbCwgZmllbGQgfSksIFwiPVwiLCB2YWx1ZSkubGltaXQoMSkuZXhlY3V0ZVRha2VGaXJzdCgpO1xuICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgfVxuICAgICAgaWYgKGNvbmZpZz8udHlwZSA9PT0gXCJtc3NxbFwiKSB7XG4gICAgICAgIHJlcyA9IGF3YWl0IGJ1aWxkZXIub3V0cHV0QWxsKFwiaW5zZXJ0ZWRcIikuZXhlY3V0ZVRha2VGaXJzdCgpO1xuICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgfVxuICAgICAgcmVzID0gYXdhaXQgYnVpbGRlci5yZXR1cm5pbmdBbGwoKS5leGVjdXRlVGFrZUZpcnN0KCk7XG4gICAgICByZXR1cm4gcmVzO1xuICAgIH07XG4gICAgZnVuY3Rpb24gdHJhbnNmb3JtVmFsdWVUb0RCKHZhbHVlLCBtb2RlbCwgZmllbGQpIHtcbiAgICAgIGlmIChmaWVsZCA9PT0gXCJpZFwiKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgdHlwZSA9IFwic3FsaXRlXCIgfSA9IGNvbmZpZyB8fCB7fTtcbiAgICAgIGxldCBmID0gc2NoZW1hW21vZGVsXT8uZmllbGRzW2ZpZWxkXTtcbiAgICAgIGlmICghZikge1xuICAgICAgICBmID0gT2JqZWN0LnZhbHVlcyhzY2hlbWEpLmZpbmQoKGYyKSA9PiBmMi5tb2RlbE5hbWUgPT09IG1vZGVsKTtcbiAgICAgIH1cbiAgICAgIGlmIChmLnR5cGUgPT09IFwiYm9vbGVhblwiICYmICh0eXBlID09PSBcInNxbGl0ZVwiIHx8IHR5cGUgPT09IFwibXNzcWxcIikgJiYgdmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHZvaWQgMCkge1xuICAgICAgICByZXR1cm4gdmFsdWUgPyAxIDogMDtcbiAgICAgIH1cbiAgICAgIGlmIChmLnR5cGUgPT09IFwiZGF0ZVwiICYmIHZhbHVlICYmIHZhbHVlIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgICByZXR1cm4gdHlwZSA9PT0gXCJzcWxpdGVcIiA/IHZhbHVlLnRvSVNPU3RyaW5nKCkgOiB2YWx1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG4gICAgZnVuY3Rpb24gY29udmVydFdoZXJlQ2xhdXNlKG1vZGVsLCB3KSB7XG4gICAgICBpZiAoIXcpXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYW5kOiBudWxsLFxuICAgICAgICAgIG9yOiBudWxsXG4gICAgICAgIH07XG4gICAgICBjb25zdCBjb25kaXRpb25zID0ge1xuICAgICAgICBhbmQ6IFtdLFxuICAgICAgICBvcjogW11cbiAgICAgIH07XG4gICAgICB3LmZvckVhY2goKGNvbmRpdGlvbikgPT4ge1xuICAgICAgICBsZXQge1xuICAgICAgICAgIGZpZWxkOiBfZmllbGQsXG4gICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgb3BlcmF0b3IgPSBcIj1cIixcbiAgICAgICAgICBjb25uZWN0b3IgPSBcIkFORFwiXG4gICAgICAgIH0gPSBjb25kaXRpb247XG4gICAgICAgIGNvbnN0IGZpZWxkID0gZ2V0RmllbGROYW1lKHsgbW9kZWwsIGZpZWxkOiBfZmllbGQgfSk7XG4gICAgICAgIHZhbHVlID0gdHJhbnNmb3JtVmFsdWVUb0RCKHZhbHVlLCBtb2RlbCwgX2ZpZWxkKTtcbiAgICAgICAgY29uc3QgZXhwciA9IChlYikgPT4ge1xuICAgICAgICAgIGlmIChvcGVyYXRvci50b0xvd2VyQ2FzZSgpID09PSBcImluXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBlYihmaWVsZCwgXCJpblwiLCBBcnJheS5pc0FycmF5KHZhbHVlKSA/IHZhbHVlIDogW3ZhbHVlXSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChvcGVyYXRvciA9PT0gXCJjb250YWluc1wiKSB7XG4gICAgICAgICAgICByZXR1cm4gZWIoZmllbGQsIFwibGlrZVwiLCBgJSR7dmFsdWV9JWApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAob3BlcmF0b3IgPT09IFwic3RhcnRzX3dpdGhcIikge1xuICAgICAgICAgICAgcmV0dXJuIGViKGZpZWxkLCBcImxpa2VcIiwgYCR7dmFsdWV9JWApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAob3BlcmF0b3IgPT09IFwiZW5kc193aXRoXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBlYihmaWVsZCwgXCJsaWtlXCIsIGAlJHt2YWx1ZX1gKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG9wZXJhdG9yID09PSBcImVxXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBlYihmaWVsZCwgXCI9XCIsIHZhbHVlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG9wZXJhdG9yID09PSBcIm5lXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBlYihmaWVsZCwgXCI8PlwiLCB2YWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChvcGVyYXRvciA9PT0gXCJndFwiKSB7XG4gICAgICAgICAgICByZXR1cm4gZWIoZmllbGQsIFwiPlwiLCB2YWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChvcGVyYXRvciA9PT0gXCJndGVcIikge1xuICAgICAgICAgICAgcmV0dXJuIGViKGZpZWxkLCBcIj49XCIsIHZhbHVlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG9wZXJhdG9yID09PSBcImx0XCIpIHtcbiAgICAgICAgICAgIHJldHVybiBlYihmaWVsZCwgXCI8XCIsIHZhbHVlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG9wZXJhdG9yID09PSBcImx0ZVwiKSB7XG4gICAgICAgICAgICByZXR1cm4gZWIoZmllbGQsIFwiPD1cIiwgdmFsdWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZWIoZmllbGQsIG9wZXJhdG9yLCB2YWx1ZSk7XG4gICAgICAgIH07XG4gICAgICAgIGlmIChjb25uZWN0b3IgPT09IFwiT1JcIikge1xuICAgICAgICAgIGNvbmRpdGlvbnMub3IucHVzaChleHByKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25kaXRpb25zLmFuZC5wdXNoKGV4cHIpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFuZDogY29uZGl0aW9ucy5hbmQubGVuZ3RoID8gY29uZGl0aW9ucy5hbmQgOiBudWxsLFxuICAgICAgICBvcjogY29uZGl0aW9ucy5vci5sZW5ndGggPyBjb25kaXRpb25zLm9yIDogbnVsbFxuICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIGFzeW5jIGNyZWF0ZSh7IGRhdGEsIG1vZGVsIH0pIHtcbiAgICAgICAgY29uc3QgYnVpbGRlciA9IGRiLmluc2VydEludG8obW9kZWwpLnZhbHVlcyhkYXRhKTtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHdpdGhSZXR1cm5pbmcoZGF0YSwgYnVpbGRlciwgbW9kZWwsIFtdKTtcbiAgICAgIH0sXG4gICAgICBhc3luYyBmaW5kT25lKHsgbW9kZWwsIHdoZXJlLCBzZWxlY3QgfSkge1xuICAgICAgICBjb25zdCB7IGFuZCwgb3IgfSA9IGNvbnZlcnRXaGVyZUNsYXVzZShtb2RlbCwgd2hlcmUpO1xuICAgICAgICBsZXQgcXVlcnkgPSBkYi5zZWxlY3RGcm9tKG1vZGVsKS5zZWxlY3RBbGwoKTtcbiAgICAgICAgaWYgKGFuZCkge1xuICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkud2hlcmUoKGViKSA9PiBlYi5hbmQoYW5kLm1hcCgoZXhwcikgPT4gZXhwcihlYikpKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9yKSB7XG4gICAgICAgICAgcXVlcnkgPSBxdWVyeS53aGVyZSgoZWIpID0+IGViLm9yKG9yLm1hcCgoZXhwcikgPT4gZXhwcihlYikpKSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgcXVlcnkuZXhlY3V0ZVRha2VGaXJzdCgpO1xuICAgICAgICBpZiAoIXJlcykgcmV0dXJuIG51bGw7XG4gICAgICAgIHJldHVybiByZXM7XG4gICAgICB9LFxuICAgICAgYXN5bmMgZmluZE1hbnkoeyBtb2RlbCwgd2hlcmUsIGxpbWl0LCBvZmZzZXQsIHNvcnRCeSB9KSB7XG4gICAgICAgIGNvbnN0IHsgYW5kLCBvciB9ID0gY29udmVydFdoZXJlQ2xhdXNlKG1vZGVsLCB3aGVyZSk7XG4gICAgICAgIGxldCBxdWVyeSA9IGRiLnNlbGVjdEZyb20obW9kZWwpO1xuICAgICAgICBpZiAoYW5kKSB7XG4gICAgICAgICAgcXVlcnkgPSBxdWVyeS53aGVyZSgoZWIpID0+IGViLmFuZChhbmQubWFwKChleHByKSA9PiBleHByKGViKSkpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3IpIHtcbiAgICAgICAgICBxdWVyeSA9IHF1ZXJ5LndoZXJlKChlYikgPT4gZWIub3Iob3IubWFwKChleHByKSA9PiBleHByKGViKSkpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnPy50eXBlID09PSBcIm1zc3FsXCIpIHtcbiAgICAgICAgICBpZiAoIW9mZnNldCkge1xuICAgICAgICAgICAgcXVlcnkgPSBxdWVyeS50b3AobGltaXQgfHwgMTAwKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcXVlcnkgPSBxdWVyeS5saW1pdChsaW1pdCB8fCAxMDApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzb3J0QnkpIHtcbiAgICAgICAgICBxdWVyeSA9IHF1ZXJ5Lm9yZGVyQnkoXG4gICAgICAgICAgICBnZXRGaWVsZE5hbWUoeyBtb2RlbCwgZmllbGQ6IHNvcnRCeS5maWVsZCB9KSxcbiAgICAgICAgICAgIHNvcnRCeS5kaXJlY3Rpb25cbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvZmZzZXQpIHtcbiAgICAgICAgICBpZiAoY29uZmlnPy50eXBlID09PSBcIm1zc3FsXCIpIHtcbiAgICAgICAgICAgIGlmICghc29ydEJ5KSB7XG4gICAgICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkub3JkZXJCeShnZXRGaWVsZE5hbWUoeyBtb2RlbCwgZmllbGQ6IFwiaWRcIiB9KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBxdWVyeSA9IHF1ZXJ5Lm9mZnNldChvZmZzZXQpLmZldGNoKGxpbWl0IHx8IDEwMCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkub2Zmc2V0KG9mZnNldCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHF1ZXJ5LnNlbGVjdEFsbCgpLmV4ZWN1dGUoKTtcbiAgICAgICAgaWYgKCFyZXMpIHJldHVybiBbXTtcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgIH0sXG4gICAgICBhc3luYyB1cGRhdGUoeyBtb2RlbCwgd2hlcmUsIHVwZGF0ZTogdmFsdWVzIH0pIHtcbiAgICAgICAgY29uc3QgeyBhbmQsIG9yIH0gPSBjb252ZXJ0V2hlcmVDbGF1c2UobW9kZWwsIHdoZXJlKTtcbiAgICAgICAgbGV0IHF1ZXJ5ID0gZGIudXBkYXRlVGFibGUobW9kZWwpLnNldCh2YWx1ZXMpO1xuICAgICAgICBpZiAoYW5kKSB7XG4gICAgICAgICAgcXVlcnkgPSBxdWVyeS53aGVyZSgoZWIpID0+IGViLmFuZChhbmQubWFwKChleHByKSA9PiBleHByKGViKSkpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3IpIHtcbiAgICAgICAgICBxdWVyeSA9IHF1ZXJ5LndoZXJlKChlYikgPT4gZWIub3Iob3IubWFwKChleHByKSA9PiBleHByKGViKSkpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXdhaXQgd2l0aFJldHVybmluZyh2YWx1ZXMsIHF1ZXJ5LCBtb2RlbCwgd2hlcmUpO1xuICAgICAgfSxcbiAgICAgIGFzeW5jIHVwZGF0ZU1hbnkoeyBtb2RlbCwgd2hlcmUsIHVwZGF0ZTogdmFsdWVzIH0pIHtcbiAgICAgICAgY29uc3QgeyBhbmQsIG9yIH0gPSBjb252ZXJ0V2hlcmVDbGF1c2UobW9kZWwsIHdoZXJlKTtcbiAgICAgICAgbGV0IHF1ZXJ5ID0gZGIudXBkYXRlVGFibGUobW9kZWwpLnNldCh2YWx1ZXMpO1xuICAgICAgICBpZiAoYW5kKSB7XG4gICAgICAgICAgcXVlcnkgPSBxdWVyeS53aGVyZSgoZWIpID0+IGViLmFuZChhbmQubWFwKChleHByKSA9PiBleHByKGViKSkpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3IpIHtcbiAgICAgICAgICBxdWVyeSA9IHF1ZXJ5LndoZXJlKChlYikgPT4gZWIub3Iob3IubWFwKChleHByKSA9PiBleHByKGViKSkpKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBxdWVyeS5leGVjdXRlKCk7XG4gICAgICAgIHJldHVybiByZXMubGVuZ3RoO1xuICAgICAgfSxcbiAgICAgIGFzeW5jIGNvdW50KHsgbW9kZWwsIHdoZXJlIH0pIHtcbiAgICAgICAgY29uc3QgeyBhbmQsIG9yIH0gPSBjb252ZXJ0V2hlcmVDbGF1c2UobW9kZWwsIHdoZXJlKTtcbiAgICAgICAgbGV0IHF1ZXJ5ID0gZGIuc2VsZWN0RnJvbShtb2RlbCkuc2VsZWN0KGRiLmZuLmNvdW50KFwiaWRcIikuYXMoXCJjb3VudFwiKSk7XG4gICAgICAgIGlmIChhbmQpIHtcbiAgICAgICAgICBxdWVyeSA9IHF1ZXJ5LndoZXJlKChlYikgPT4gZWIuYW5kKGFuZC5tYXAoKGV4cHIpID0+IGV4cHIoZWIpKSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcikge1xuICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkud2hlcmUoKGViKSA9PiBlYi5vcihvci5tYXAoKGV4cHIpID0+IGV4cHIoZWIpKSkpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHF1ZXJ5LmV4ZWN1dGUoKTtcbiAgICAgICAgcmV0dXJuIHJlc1swXS5jb3VudDtcbiAgICAgIH0sXG4gICAgICBhc3luYyBkZWxldGUoeyBtb2RlbCwgd2hlcmUgfSkge1xuICAgICAgICBjb25zdCB7IGFuZCwgb3IgfSA9IGNvbnZlcnRXaGVyZUNsYXVzZShtb2RlbCwgd2hlcmUpO1xuICAgICAgICBsZXQgcXVlcnkgPSBkYi5kZWxldGVGcm9tKG1vZGVsKTtcbiAgICAgICAgaWYgKGFuZCkge1xuICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkud2hlcmUoKGViKSA9PiBlYi5hbmQoYW5kLm1hcCgoZXhwcikgPT4gZXhwcihlYikpKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9yKSB7XG4gICAgICAgICAgcXVlcnkgPSBxdWVyeS53aGVyZSgoZWIpID0+IGViLm9yKG9yLm1hcCgoZXhwcikgPT4gZXhwcihlYikpKSk7XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgcXVlcnkuZXhlY3V0ZSgpO1xuICAgICAgfSxcbiAgICAgIGFzeW5jIGRlbGV0ZU1hbnkoeyBtb2RlbCwgd2hlcmUgfSkge1xuICAgICAgICBjb25zdCB7IGFuZCwgb3IgfSA9IGNvbnZlcnRXaGVyZUNsYXVzZShtb2RlbCwgd2hlcmUpO1xuICAgICAgICBsZXQgcXVlcnkgPSBkYi5kZWxldGVGcm9tKG1vZGVsKTtcbiAgICAgICAgaWYgKGFuZCkge1xuICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkud2hlcmUoKGViKSA9PiBlYi5hbmQoYW5kLm1hcCgoZXhwcikgPT4gZXhwcihlYikpKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9yKSB7XG4gICAgICAgICAgcXVlcnkgPSBxdWVyeS53aGVyZSgoZWIpID0+IGViLm9yKG9yLm1hcCgoZXhwcikgPT4gZXhwcihlYikpKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChhd2FpdCBxdWVyeS5leGVjdXRlKCkpLmxlbmd0aDtcbiAgICAgIH0sXG4gICAgICBvcHRpb25zOiBjb25maWdcbiAgICB9O1xuICB9XG59KTtcblxuZXhwb3J0IHsgY3JlYXRlS3lzZWx5QWRhcHRlciBhcyBjLCBreXNlbHlBZGFwdGVyIGFzIGsgfTtcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DwzM-9N1.mjs\n");

/***/ }),

/***/ "(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.VTXNLFMT.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.VTXNLFMT.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   a: () => (/* binding */ getBaseURL),\n/* harmony export */   b: () => (/* binding */ getHost),\n/* harmony export */   c: () => (/* binding */ getProtocol),\n/* harmony export */   g: () => (/* binding */ getOrigin)\n/* harmony export */ });\n/* harmony import */ var _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./better-auth.8zoxzg-F.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs\");\n/* harmony import */ var _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./better-auth.DdzSJf-n.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs\");\n\n\n\nfunction checkHasPath(url) {\n  try {\n    const parsedUrl = new URL(url);\n    return parsedUrl.pathname !== \"/\";\n  } catch (error) {\n    throw new _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_1__.B(\n      `Invalid base URL: ${url}. Please provide a valid base URL.`\n    );\n  }\n}\nfunction withPath(url, path = \"/api/auth\") {\n  const hasPath = checkHasPath(url);\n  if (hasPath) {\n    return url;\n  }\n  path = path.startsWith(\"/\") ? path : `/${path}`;\n  return `${url.replace(/\\/+$/, \"\")}${path}`;\n}\nfunction getBaseURL(url, path, request) {\n  if (url) {\n    return withPath(url, path);\n  }\n  const fromEnv = _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__.e.BETTER_AUTH_URL || _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__.e.NEXT_PUBLIC_BETTER_AUTH_URL || _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__.e.PUBLIC_BETTER_AUTH_URL || _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__.e.NUXT_PUBLIC_BETTER_AUTH_URL || _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__.e.NUXT_PUBLIC_AUTH_URL || (_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__.e.BASE_URL !== \"/\" ? _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__.e.BASE_URL : void 0);\n  if (fromEnv) {\n    return withPath(fromEnv, path);\n  }\n  const fromRequest = request?.headers.get(\"x-forwarded-host\");\n  const fromRequestProto = request?.headers.get(\"x-forwarded-proto\");\n  if (fromRequest && fromRequestProto) {\n    return withPath(`${fromRequestProto}://${fromRequest}`, path);\n  }\n  if (request) {\n    const url2 = getOrigin(request.url);\n    if (!url2) {\n      throw new _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_1__.B(\n        \"Could not get origin from request. Please provide a valid base URL.\"\n      );\n    }\n    return withPath(url2, path);\n  }\n  if (typeof window !== \"undefined\" && window.location) {\n    return withPath(window.location.origin, path);\n  }\n  return void 0;\n}\nfunction getOrigin(url) {\n  try {\n    const parsedUrl = new URL(url);\n    return parsedUrl.origin;\n  } catch (error) {\n    return null;\n  }\n}\nfunction getProtocol(url) {\n  try {\n    const parsedUrl = new URL(url);\n    return parsedUrl.protocol;\n  } catch (error) {\n    return null;\n  }\n}\nfunction getHost(url) {\n  try {\n    const parsedUrl = new URL(url);\n    return parsedUrl.host;\n  } catch (error) {\n    return url;\n  }\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguVlRYTkxGTVQubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFzRDtBQUNZOztBQUVsRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixjQUFjLHdEQUFlO0FBQzdCLDJCQUEyQixJQUFJO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkMsS0FBSztBQUNoRCxZQUFZLHdCQUF3QixFQUFFLEtBQUs7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQix3REFBRyxvQkFBb0Isd0RBQUcsZ0NBQWdDLHdEQUFHLDJCQUEyQix3REFBRyxnQ0FBZ0Msd0RBQUcsMEJBQTBCLHdEQUFHLG9CQUFvQix3REFBRztBQUNwTTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsaUJBQWlCLEtBQUssWUFBWTtBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQix3REFBZTtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFMkUiLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWxhbi9EZXNrdG9wL0FwcHMvYmV0dGVyLWF1dGgvbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLlZUWE5MRk1ULm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBlIGFzIGVudiB9IGZyb20gJy4vYmV0dGVyLWF1dGguOHpveHpnLUYubWpzJztcbmltcG9ydCB7IEIgYXMgQmV0dGVyQXV0aEVycm9yIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC5EZHpTSmYtbi5tanMnO1xuXG5mdW5jdGlvbiBjaGVja0hhc1BhdGgodXJsKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgcGFyc2VkVXJsID0gbmV3IFVSTCh1cmwpO1xuICAgIHJldHVybiBwYXJzZWRVcmwucGF0aG5hbWUgIT09IFwiL1wiO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHRocm93IG5ldyBCZXR0ZXJBdXRoRXJyb3IoXG4gICAgICBgSW52YWxpZCBiYXNlIFVSTDogJHt1cmx9LiBQbGVhc2UgcHJvdmlkZSBhIHZhbGlkIGJhc2UgVVJMLmBcbiAgICApO1xuICB9XG59XG5mdW5jdGlvbiB3aXRoUGF0aCh1cmwsIHBhdGggPSBcIi9hcGkvYXV0aFwiKSB7XG4gIGNvbnN0IGhhc1BhdGggPSBjaGVja0hhc1BhdGgodXJsKTtcbiAgaWYgKGhhc1BhdGgpIHtcbiAgICByZXR1cm4gdXJsO1xuICB9XG4gIHBhdGggPSBwYXRoLnN0YXJ0c1dpdGgoXCIvXCIpID8gcGF0aCA6IGAvJHtwYXRofWA7XG4gIHJldHVybiBgJHt1cmwucmVwbGFjZSgvXFwvKyQvLCBcIlwiKX0ke3BhdGh9YDtcbn1cbmZ1bmN0aW9uIGdldEJhc2VVUkwodXJsLCBwYXRoLCByZXF1ZXN0KSB7XG4gIGlmICh1cmwpIHtcbiAgICByZXR1cm4gd2l0aFBhdGgodXJsLCBwYXRoKTtcbiAgfVxuICBjb25zdCBmcm9tRW52ID0gZW52LkJFVFRFUl9BVVRIX1VSTCB8fCBlbnYuTkVYVF9QVUJMSUNfQkVUVEVSX0FVVEhfVVJMIHx8IGVudi5QVUJMSUNfQkVUVEVSX0FVVEhfVVJMIHx8IGVudi5OVVhUX1BVQkxJQ19CRVRURVJfQVVUSF9VUkwgfHwgZW52Lk5VWFRfUFVCTElDX0FVVEhfVVJMIHx8IChlbnYuQkFTRV9VUkwgIT09IFwiL1wiID8gZW52LkJBU0VfVVJMIDogdm9pZCAwKTtcbiAgaWYgKGZyb21FbnYpIHtcbiAgICByZXR1cm4gd2l0aFBhdGgoZnJvbUVudiwgcGF0aCk7XG4gIH1cbiAgY29uc3QgZnJvbVJlcXVlc3QgPSByZXF1ZXN0Py5oZWFkZXJzLmdldChcIngtZm9yd2FyZGVkLWhvc3RcIik7XG4gIGNvbnN0IGZyb21SZXF1ZXN0UHJvdG8gPSByZXF1ZXN0Py5oZWFkZXJzLmdldChcIngtZm9yd2FyZGVkLXByb3RvXCIpO1xuICBpZiAoZnJvbVJlcXVlc3QgJiYgZnJvbVJlcXVlc3RQcm90bykge1xuICAgIHJldHVybiB3aXRoUGF0aChgJHtmcm9tUmVxdWVzdFByb3RvfTovLyR7ZnJvbVJlcXVlc3R9YCwgcGF0aCk7XG4gIH1cbiAgaWYgKHJlcXVlc3QpIHtcbiAgICBjb25zdCB1cmwyID0gZ2V0T3JpZ2luKHJlcXVlc3QudXJsKTtcbiAgICBpZiAoIXVybDIpIHtcbiAgICAgIHRocm93IG5ldyBCZXR0ZXJBdXRoRXJyb3IoXG4gICAgICAgIFwiQ291bGQgbm90IGdldCBvcmlnaW4gZnJvbSByZXF1ZXN0LiBQbGVhc2UgcHJvdmlkZSBhIHZhbGlkIGJhc2UgVVJMLlwiXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gd2l0aFBhdGgodXJsMiwgcGF0aCk7XG4gIH1cbiAgaWYgKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgJiYgd2luZG93LmxvY2F0aW9uKSB7XG4gICAgcmV0dXJuIHdpdGhQYXRoKHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4sIHBhdGgpO1xuICB9XG4gIHJldHVybiB2b2lkIDA7XG59XG5mdW5jdGlvbiBnZXRPcmlnaW4odXJsKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgcGFyc2VkVXJsID0gbmV3IFVSTCh1cmwpO1xuICAgIHJldHVybiBwYXJzZWRVcmwub3JpZ2luO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5mdW5jdGlvbiBnZXRQcm90b2NvbCh1cmwpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBwYXJzZWRVcmwgPSBuZXcgVVJMKHVybCk7XG4gICAgcmV0dXJuIHBhcnNlZFVybC5wcm90b2NvbDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuZnVuY3Rpb24gZ2V0SG9zdCh1cmwpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBwYXJzZWRVcmwgPSBuZXcgVVJMKHVybCk7XG4gICAgcmV0dXJuIHBhcnNlZFVybC5ob3N0O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiB1cmw7XG4gIH1cbn1cblxuZXhwb3J0IHsgZ2V0QmFzZVVSTCBhcyBhLCBnZXRIb3N0IGFzIGIsIGdldFByb3RvY29sIGFzIGMsIGdldE9yaWdpbiBhcyBnIH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.VTXNLFMT.mjs\n");

/***/ }),

/***/ "(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.YwDQhoPc.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.YwDQhoPc.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   c: () => (/* binding */ checkPassword),\n/* harmony export */   v: () => (/* binding */ validatePassword)\n/* harmony export */ });\n/* harmony import */ var better_call__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! better-call */ \"(action-browser)/../../node_modules/better-call/dist/index.js\");\n\n\nasync function validatePassword(ctx, data) {\n  const accounts = await ctx.context.internalAdapter.findAccounts(data.userId);\n  const credentialAccount = accounts?.find(\n    (account) => account.providerId === \"credential\"\n  );\n  const currentPassword = credentialAccount?.password;\n  if (!credentialAccount || !currentPassword) {\n    return false;\n  }\n  const compare = await ctx.context.password.verify({\n    hash: currentPassword,\n    password: data.password\n  });\n  return compare;\n}\nasync function checkPassword(userId, c) {\n  const accounts = await c.context.internalAdapter.findAccounts(userId);\n  const credentialAccount = accounts?.find(\n    (account) => account.providerId === \"credential\"\n  );\n  const currentPassword = credentialAccount?.password;\n  if (!credentialAccount || !currentPassword || !c.body.password) {\n    throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n      message: \"No password credential found\"\n    });\n  }\n  const compare = await c.context.password.verify({\n    hash: currentPassword,\n    password: c.body.password\n  });\n  if (!compare) {\n    throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n      message: \"Invalid password\"\n    });\n  }\n  return true;\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguWXdEUWhvUGMubWpzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUF1Qzs7QUFFdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsaURBQVE7QUFDdEI7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSxjQUFjLGlEQUFRO0FBQ3RCO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFcUQiLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWxhbi9EZXNrdG9wL0FwcHMvYmV0dGVyLWF1dGgvbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLll3RFFob1BjLm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBUElFcnJvciB9IGZyb20gJ2JldHRlci1jYWxsJztcblxuYXN5bmMgZnVuY3Rpb24gdmFsaWRhdGVQYXNzd29yZChjdHgsIGRhdGEpIHtcbiAgY29uc3QgYWNjb3VudHMgPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZmluZEFjY291bnRzKGRhdGEudXNlcklkKTtcbiAgY29uc3QgY3JlZGVudGlhbEFjY291bnQgPSBhY2NvdW50cz8uZmluZChcbiAgICAoYWNjb3VudCkgPT4gYWNjb3VudC5wcm92aWRlcklkID09PSBcImNyZWRlbnRpYWxcIlxuICApO1xuICBjb25zdCBjdXJyZW50UGFzc3dvcmQgPSBjcmVkZW50aWFsQWNjb3VudD8ucGFzc3dvcmQ7XG4gIGlmICghY3JlZGVudGlhbEFjY291bnQgfHwgIWN1cnJlbnRQYXNzd29yZCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBjb25zdCBjb21wYXJlID0gYXdhaXQgY3R4LmNvbnRleHQucGFzc3dvcmQudmVyaWZ5KHtcbiAgICBoYXNoOiBjdXJyZW50UGFzc3dvcmQsXG4gICAgcGFzc3dvcmQ6IGRhdGEucGFzc3dvcmRcbiAgfSk7XG4gIHJldHVybiBjb21wYXJlO1xufVxuYXN5bmMgZnVuY3Rpb24gY2hlY2tQYXNzd29yZCh1c2VySWQsIGMpIHtcbiAgY29uc3QgYWNjb3VudHMgPSBhd2FpdCBjLmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmZpbmRBY2NvdW50cyh1c2VySWQpO1xuICBjb25zdCBjcmVkZW50aWFsQWNjb3VudCA9IGFjY291bnRzPy5maW5kKFxuICAgIChhY2NvdW50KSA9PiBhY2NvdW50LnByb3ZpZGVySWQgPT09IFwiY3JlZGVudGlhbFwiXG4gICk7XG4gIGNvbnN0IGN1cnJlbnRQYXNzd29yZCA9IGNyZWRlbnRpYWxBY2NvdW50Py5wYXNzd29yZDtcbiAgaWYgKCFjcmVkZW50aWFsQWNjb3VudCB8fCAhY3VycmVudFBhc3N3b3JkIHx8ICFjLmJvZHkucGFzc3dvcmQpIHtcbiAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICBtZXNzYWdlOiBcIk5vIHBhc3N3b3JkIGNyZWRlbnRpYWwgZm91bmRcIlxuICAgIH0pO1xuICB9XG4gIGNvbnN0IGNvbXBhcmUgPSBhd2FpdCBjLmNvbnRleHQucGFzc3dvcmQudmVyaWZ5KHtcbiAgICBoYXNoOiBjdXJyZW50UGFzc3dvcmQsXG4gICAgcGFzc3dvcmQ6IGMuYm9keS5wYXNzd29yZFxuICB9KTtcbiAgaWYgKCFjb21wYXJlKSB7XG4gICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgbWVzc2FnZTogXCJJbnZhbGlkIHBhc3N3b3JkXCJcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn1cblxuZXhwb3J0IHsgY2hlY2tQYXNzd29yZCBhcyBjLCB2YWxpZGF0ZVBhc3N3b3JkIGFzIHYgfTtcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.YwDQhoPc.mjs\n");

/***/ }),

/***/ "(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.gBl3F_xa.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.gBl3F_xa.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   c: () => (/* binding */ createAdapter)\n/* harmony export */ });\n/* harmony import */ var _better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./better-auth.tB5eU6EY.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.tB5eU6EY.mjs\");\n/* harmony import */ var _better_auth_DORkW_Ge_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./better-auth.DORkW_Ge.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DORkW_Ge.mjs\");\n/* harmony import */ var _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./better-auth.DBGfIDnh.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DBGfIDnh.mjs\");\n/* harmony import */ var better_call__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! better-call */ \"(action-browser)/../../node_modules/better-call/dist/index.js\");\n/* harmony import */ var _better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @better-auth/utils/hash */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/hash.mjs\");\n/* harmony import */ var _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @better-auth/utils/base64 */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/base64.mjs\");\n/* harmony import */ var _better_auth_utils__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @better-auth/utils */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/index.mjs\");\n/* harmony import */ var _better_auth_utils_hex__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @better-auth/utils/hex */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/hex.mjs\");\n/* harmony import */ var _better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./better-auth.B4Qoxdgc.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction withApplyDefault(value, field, action) {\n  if (action === \"update\") {\n    return value;\n  }\n  if (value === void 0 || value === null) {\n    if (field.defaultValue !== void 0) {\n      if (typeof field.defaultValue === \"function\") {\n        return field.defaultValue();\n      }\n      return field.defaultValue;\n    }\n  }\n  return value;\n}\n\nlet debugLogs = [];\nlet transactionId = -1;\nconst colors = {\n  reset: \"\\x1B[0m\",\n  bright: \"\\x1B[1m\",\n  dim: \"\\x1B[2m\",\n  fg: {\n    yellow: \"\\x1B[33m\",\n    magenta: \"\\x1B[35m\"},\n  bg: {\n    black: \"\\x1B[40m\"}\n};\nconst createAdapter = ({\n  adapter,\n  config: cfg\n}) => (options) => {\n  const config = {\n    ...cfg,\n    supportsBooleans: cfg.supportsBooleans ?? true,\n    supportsDates: cfg.supportsDates ?? true,\n    supportsJSON: cfg.supportsJSON ?? false,\n    adapterName: cfg.adapterName ?? cfg.adapterId,\n    supportsNumericIds: cfg.supportsNumericIds ?? true\n  };\n  if (options.advanced?.database?.useNumberId === true && config.supportsNumericIds === false) {\n    throw new Error(\n      `[${config.adapterName}] Your database or database adapter does not support numeric ids. Please disable \"useNumberId\" in your config.`\n    );\n  }\n  const schema = (0,_better_auth_DORkW_Ge_mjs__WEBPACK_IMPORTED_MODULE_1__.g)(options);\n  const getDefaultFieldName = ({\n    field,\n    model: unsafe_model\n  }) => {\n    if (field === \"id\" || field === \"_id\") {\n      return \"id\";\n    }\n    const model = getDefaultModelName(unsafe_model);\n    let f = schema[model]?.fields[field];\n    if (!f) {\n      f = Object.values(schema[model]?.fields).find(\n        (f2) => f2.fieldName === field\n      );\n    }\n    if (!f) {\n      debugLog(`Field ${field} not found in model ${model}`);\n      debugLog(`Schema:`, schema);\n      throw new Error(`Field ${field} not found in model ${model}`);\n    }\n    return field;\n  };\n  const getDefaultModelName = (model) => {\n    if (config.usePlural && model.charAt(model.length - 1) === \"s\") {\n      let pluralessModel = model.slice(0, -1);\n      let m2 = schema[pluralessModel] ? pluralessModel : void 0;\n      if (!m2) {\n        m2 = Object.entries(schema).find(\n          ([_, f]) => f.modelName === pluralessModel\n        )?.[0];\n      }\n      if (m2) {\n        return m2;\n      }\n    }\n    let m = schema[model] ? model : void 0;\n    if (!m) {\n      m = Object.entries(schema).find(([_, f]) => f.modelName === model)?.[0];\n    }\n    if (!m) {\n      debugLog(`Model \"${model}\" not found in schema`);\n      debugLog(`Schema:`, schema);\n      throw new Error(`Model \"${model}\" not found in schema`);\n    }\n    return m;\n  };\n  const getModelName = (model) => {\n    const defaultModelKey = getDefaultModelName(model);\n    const usePlural = config && config.usePlural;\n    const useCustomModelName = schema && schema[defaultModelKey] && schema[defaultModelKey].modelName !== model;\n    if (useCustomModelName) {\n      return usePlural ? `${schema[defaultModelKey].modelName}s` : schema[defaultModelKey].modelName;\n    }\n    return usePlural ? `${model}s` : model;\n  };\n  function getFieldName({\n    model: model_name,\n    field: field_name\n  }) {\n    const model = getDefaultModelName(model_name);\n    const field = getDefaultFieldName({ model, field: field_name });\n    return schema[model]?.fields[field]?.fieldName || field;\n  }\n  const debugLog = (...args) => {\n    if (config.debugLogs === true || typeof config.debugLogs === \"object\") {\n      if (typeof config.debugLogs === \"object\" && \"isRunningAdapterTests\" in config.debugLogs) {\n        if (config.debugLogs.isRunningAdapterTests) {\n          args.shift();\n          debugLogs.push(args);\n        }\n        return;\n      }\n      if (typeof config.debugLogs === \"object\" && config.debugLogs.logCondition && !config.debugLogs.logCondition?.()) {\n        return;\n      }\n      if (typeof args[0] === \"object\" && \"method\" in args[0]) {\n        const method = args.shift().method;\n        if (typeof config.debugLogs === \"object\") {\n          if (method === \"create\" && !config.debugLogs.create) {\n            return;\n          } else if (method === \"update\" && !config.debugLogs.update) {\n            return;\n          } else if (method === \"updateMany\" && !config.debugLogs.updateMany) {\n            return;\n          } else if (method === \"findOne\" && !config.debugLogs.findOne) {\n            return;\n          } else if (method === \"findMany\" && !config.debugLogs.findMany) {\n            return;\n          } else if (method === \"delete\" && !config.debugLogs.delete) {\n            return;\n          } else if (method === \"deleteMany\" && !config.debugLogs.deleteMany) {\n            return;\n          } else if (method === \"count\" && !config.debugLogs.count) {\n            return;\n          }\n        }\n        _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_2__.a.info(`[${config.adapterName}]`, ...args);\n      } else {\n        _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_2__.a.info(`[${config.adapterName}]`, ...args);\n      }\n    }\n  };\n  const idField = ({\n    customModelName,\n    forceAllowId\n  }) => {\n    const shouldGenerateId = !config.disableIdGeneration && !options.advanced?.database?.useNumberId && !forceAllowId;\n    const model = getDefaultModelName(customModelName ?? \"id\");\n    return {\n      type: options.advanced?.database?.useNumberId ? \"number\" : \"string\",\n      required: shouldGenerateId ? true : false,\n      ...shouldGenerateId ? {\n        defaultValue() {\n          if (config.disableIdGeneration) return void 0;\n          const useNumberId = options.advanced?.database?.useNumberId;\n          let generateId$1 = options.advanced?.database?.generateId;\n          if (options.advanced?.generateId !== void 0) {\n            _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_2__.a.warn(\n              \"Your Better Auth config includes advanced.generateId which is deprecated. Please use advanced.database.generateId instead. This will be removed in future releases.\"\n            );\n            generateId$1 = options.advanced?.generateId;\n          }\n          if (generateId$1 === false || useNumberId) return void 0;\n          if (generateId$1) {\n            return generateId$1({\n              model\n            });\n          }\n          if (config.customIdGenerator) {\n            return config.customIdGenerator({ model });\n          }\n          return (0,_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_2__.g)();\n        }\n      } : {}\n    };\n  };\n  const getFieldAttributes = ({\n    model,\n    field\n  }) => {\n    const defaultModelName = getDefaultModelName(model);\n    const defaultFieldName = getDefaultFieldName({\n      field,\n      model\n    });\n    const fields = schema[defaultModelName].fields;\n    fields.id = idField({ customModelName: defaultModelName });\n    return fields[defaultFieldName];\n  };\n  const adapterInstance = adapter({\n    options,\n    schema,\n    debugLog,\n    getFieldName,\n    getModelName,\n    getDefaultModelName,\n    getDefaultFieldName,\n    getFieldAttributes\n  });\n  const transformInput = async (data, unsafe_model, action, forceAllowId) => {\n    const transformedData = {};\n    const fields = schema[unsafe_model].fields;\n    const newMappedKeys = config.mapKeysTransformInput ?? {};\n    if (!config.disableIdGeneration && !options.advanced?.database?.useNumberId) {\n      fields.id = idField({\n        customModelName: unsafe_model,\n        forceAllowId: forceAllowId && \"id\" in data\n      });\n    }\n    for (const field in fields) {\n      const value = data[field];\n      const fieldAttributes = fields[field];\n      let newFieldName = newMappedKeys[field] || fields[field].fieldName || field;\n      if (value === void 0 && (!fieldAttributes.defaultValue && !fieldAttributes.transform?.input || action === \"update\")) {\n        continue;\n      }\n      let newValue = withApplyDefault(value, fieldAttributes, action);\n      if (fieldAttributes.transform?.input) {\n        newValue = await fieldAttributes.transform.input(newValue);\n      }\n      if (fieldAttributes.references?.field === \"id\" && options.advanced?.database?.useNumberId) {\n        if (Array.isArray(newValue)) {\n          newValue = newValue.map(Number);\n        } else {\n          newValue = Number(newValue);\n        }\n      } else if (config.supportsJSON === false && typeof newValue === \"object\" && //@ts-expect-error -Future proofing\n      fieldAttributes.type === \"json\") {\n        newValue = JSON.stringify(newValue);\n      } else if (config.supportsDates === false && newValue instanceof Date && fieldAttributes.type === \"date\") {\n        newValue = newValue.toISOString();\n      } else if (config.supportsBooleans === false && typeof newValue === \"boolean\") {\n        newValue = newValue ? 1 : 0;\n      }\n      if (config.customTransformInput) {\n        newValue = config.customTransformInput({\n          data: newValue,\n          action,\n          field: newFieldName,\n          fieldAttributes,\n          model: unsafe_model,\n          schema,\n          options\n        });\n      }\n      transformedData[newFieldName] = newValue;\n    }\n    return transformedData;\n  };\n  const transformOutput = async (data, unsafe_model, select = []) => {\n    if (!data) return null;\n    const newMappedKeys = config.mapKeysTransformOutput ?? {};\n    const transformedData = {};\n    const tableSchema = schema[unsafe_model].fields;\n    const idKey = Object.entries(newMappedKeys).find(\n      ([_, v]) => v === \"id\"\n    )?.[0];\n    tableSchema[idKey ?? \"id\"] = {\n      type: options.advanced?.database?.useNumberId ? \"number\" : \"string\"\n    };\n    for (const key in tableSchema) {\n      if (select.length && !select.includes(key)) {\n        continue;\n      }\n      const field = tableSchema[key];\n      if (field) {\n        const originalKey = field.fieldName || key;\n        let newValue = data[Object.entries(newMappedKeys).find(\n          ([_, v]) => v === originalKey\n        )?.[0] || originalKey];\n        if (field.transform?.output) {\n          newValue = await field.transform.output(newValue);\n        }\n        let newFieldName = newMappedKeys[key] || key;\n        if (originalKey === \"id\" || field.references?.field === \"id\") {\n          if (typeof newValue !== \"undefined\") newValue = String(newValue);\n        } else if (config.supportsJSON === false && typeof newValue === \"string\" && //@ts-expect-error - Future proofing\n        field.type === \"json\") {\n          newValue = (0,_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_0__.s)(newValue);\n        } else if (config.supportsDates === false && typeof newValue === \"string\" && field.type === \"date\") {\n          newValue = new Date(newValue);\n        } else if (config.supportsBooleans === false && typeof newValue === \"number\" && field.type === \"boolean\") {\n          newValue = newValue === 1;\n        }\n        if (config.customTransformOutput) {\n          newValue = config.customTransformOutput({\n            data: newValue,\n            field: newFieldName,\n            fieldAttributes: field,\n            select,\n            model: unsafe_model,\n            schema,\n            options\n          });\n        }\n        transformedData[newFieldName] = newValue;\n      }\n    }\n    return transformedData;\n  };\n  const transformWhereClause = ({\n    model,\n    where\n  }) => {\n    if (!where) return void 0;\n    const newMappedKeys = config.mapKeysTransformInput ?? {};\n    return where.map((w) => {\n      const {\n        field: unsafe_field,\n        value,\n        operator = \"eq\",\n        connector = \"AND\"\n      } = w;\n      if (operator === \"in\") {\n        if (!Array.isArray(value)) {\n          throw new Error(\"Value must be an array\");\n        }\n      }\n      const defaultModelName = getDefaultModelName(model);\n      const defaultFieldName = getDefaultFieldName({\n        field: unsafe_field,\n        model\n      });\n      const fieldName = newMappedKeys[defaultFieldName] || getFieldName({\n        field: defaultFieldName,\n        model: defaultModelName\n      });\n      const fieldAttr = getFieldAttributes({\n        field: defaultFieldName,\n        model: defaultModelName\n      });\n      if (defaultFieldName === \"id\" || fieldAttr.references?.field === \"id\") {\n        if (options.advanced?.database?.useNumberId) {\n          if (Array.isArray(value)) {\n            return {\n              operator,\n              connector,\n              field: fieldName,\n              value: value.map(Number)\n            };\n          }\n          return {\n            operator,\n            connector,\n            field: fieldName,\n            value: Number(value)\n          };\n        }\n      }\n      return {\n        operator,\n        connector,\n        field: fieldName,\n        value\n      };\n    });\n  };\n  return {\n    create: async ({\n      data: unsafeData,\n      model: unsafeModel,\n      select,\n      forceAllowId = false\n    }) => {\n      transactionId++;\n      let thisTransactionId = transactionId;\n      const model = getModelName(unsafeModel);\n      if (\"id\" in unsafeData && !forceAllowId) {\n        _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_2__.a.warn(\n          `[${config.adapterName}] - You are trying to create a record with an id. This is not allowed as we handle id generation for you, unless you pass in the \\`forceAllowId\\` parameter. The id will be ignored.`\n        );\n        const err = new Error();\n        const stack = err.stack?.split(\"\\n\").filter((_, i) => i !== 1).join(\"\\n\").replace(\"Error:\", \"Create method with `id` being called at:\");\n        console.log(stack);\n        unsafeData.id = void 0;\n      }\n      debugLog(\n        { method: \"create\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(1, 4)}`,\n        `${formatMethod(\"create\")} ${formatAction(\"Unsafe Input\")}:`,\n        { model, data: unsafeData }\n      );\n      const data = await transformInput(\n        unsafeData,\n        unsafeModel,\n        \"create\",\n        forceAllowId\n      );\n      debugLog(\n        { method: \"create\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(2, 4)}`,\n        `${formatMethod(\"create\")} ${formatAction(\"Parsed Input\")}:`,\n        { model, data }\n      );\n      const res = await adapterInstance.create({ data, model });\n      debugLog(\n        { method: \"create\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(3, 4)}`,\n        `${formatMethod(\"create\")} ${formatAction(\"DB Result\")}:`,\n        { model, res }\n      );\n      const transformed = await transformOutput(res, unsafeModel, select);\n      debugLog(\n        { method: \"create\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(4, 4)}`,\n        `${formatMethod(\"create\")} ${formatAction(\"Parsed Result\")}:`,\n        { model, data: transformed }\n      );\n      return transformed;\n    },\n    update: async ({\n      model: unsafeModel,\n      where: unsafeWhere,\n      update: unsafeData\n    }) => {\n      transactionId++;\n      let thisTransactionId = transactionId;\n      const model = getModelName(unsafeModel);\n      const where = transformWhereClause({\n        model: unsafeModel,\n        where: unsafeWhere\n      });\n      debugLog(\n        { method: \"update\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(1, 4)}`,\n        `${formatMethod(\"update\")} ${formatAction(\"Unsafe Input\")}:`,\n        { model, data: unsafeData }\n      );\n      const data = await transformInput(\n        unsafeData,\n        unsafeModel,\n        \"update\"\n      );\n      debugLog(\n        { method: \"update\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(2, 4)}`,\n        `${formatMethod(\"update\")} ${formatAction(\"Parsed Input\")}:`,\n        { model, data }\n      );\n      const res = await adapterInstance.update({\n        model,\n        where,\n        update: data\n      });\n      debugLog(\n        { method: \"update\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(3, 4)}`,\n        `${formatMethod(\"update\")} ${formatAction(\"DB Result\")}:`,\n        { model, data: res }\n      );\n      const transformed = await transformOutput(res, unsafeModel);\n      debugLog(\n        { method: \"update\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(4, 4)}`,\n        `${formatMethod(\"update\")} ${formatAction(\"Parsed Result\")}:`,\n        { model, data: transformed }\n      );\n      return transformed;\n    },\n    updateMany: async ({\n      model: unsafeModel,\n      where: unsafeWhere,\n      update: unsafeData\n    }) => {\n      transactionId++;\n      let thisTransactionId = transactionId;\n      const model = getModelName(unsafeModel);\n      const where = transformWhereClause({\n        model: unsafeModel,\n        where: unsafeWhere\n      });\n      debugLog(\n        { method: \"updateMany\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(1, 4)}`,\n        `${formatMethod(\"updateMany\")} ${formatAction(\"Unsafe Input\")}:`,\n        { model, data: unsafeData }\n      );\n      const data = await transformInput(unsafeData, unsafeModel, \"update\");\n      debugLog(\n        { method: \"updateMany\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(2, 4)}`,\n        `${formatMethod(\"updateMany\")} ${formatAction(\"Parsed Input\")}:`,\n        { model, data }\n      );\n      const updatedCount = await adapterInstance.updateMany({\n        model,\n        where,\n        update: data\n      });\n      debugLog(\n        { method: \"updateMany\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(3, 4)}`,\n        `${formatMethod(\"updateMany\")} ${formatAction(\"DB Result\")}:`,\n        { model, data: updatedCount }\n      );\n      debugLog(\n        { method: \"updateMany\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(4, 4)}`,\n        `${formatMethod(\"updateMany\")} ${formatAction(\"Parsed Result\")}:`,\n        { model, data: updatedCount }\n      );\n      return updatedCount;\n    },\n    findOne: async ({\n      model: unsafeModel,\n      where: unsafeWhere,\n      select\n    }) => {\n      transactionId++;\n      let thisTransactionId = transactionId;\n      const model = getModelName(unsafeModel);\n      const where = transformWhereClause({\n        model: unsafeModel,\n        where: unsafeWhere\n      });\n      debugLog(\n        { method: \"findOne\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(1, 3)}`,\n        `${formatMethod(\"findOne\")}:`,\n        { model, where, select }\n      );\n      const res = await adapterInstance.findOne({\n        model,\n        where,\n        select\n      });\n      debugLog(\n        { method: \"findOne\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(2, 3)}`,\n        `${formatMethod(\"findOne\")} ${formatAction(\"DB Result\")}:`,\n        { model, data: res }\n      );\n      const transformed = await transformOutput(\n        res,\n        unsafeModel,\n        select\n      );\n      debugLog(\n        { method: \"findOne\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(3, 3)}`,\n        `${formatMethod(\"findOne\")} ${formatAction(\"Parsed Result\")}:`,\n        { model, data: transformed }\n      );\n      return transformed;\n    },\n    findMany: async ({\n      model: unsafeModel,\n      where: unsafeWhere,\n      limit: unsafeLimit,\n      sortBy,\n      offset\n    }) => {\n      transactionId++;\n      let thisTransactionId = transactionId;\n      const limit = unsafeLimit ?? options.advanced?.database?.defaultFindManyLimit ?? 100;\n      const model = getModelName(unsafeModel);\n      const where = transformWhereClause({\n        model: unsafeModel,\n        where: unsafeWhere\n      });\n      debugLog(\n        { method: \"findMany\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(1, 3)}`,\n        `${formatMethod(\"findMany\")}:`,\n        { model, where, limit, sortBy, offset }\n      );\n      const res = await adapterInstance.findMany({\n        model,\n        where,\n        limit,\n        sortBy,\n        offset\n      });\n      debugLog(\n        { method: \"findMany\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(2, 3)}`,\n        `${formatMethod(\"findMany\")} ${formatAction(\"DB Result\")}:`,\n        { model, data: res }\n      );\n      const transformed = await Promise.all(\n        res.map(async (r) => await transformOutput(r, unsafeModel))\n      );\n      debugLog(\n        { method: \"findMany\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(3, 3)}`,\n        `${formatMethod(\"findMany\")} ${formatAction(\"Parsed Result\")}:`,\n        { model, data: transformed }\n      );\n      return transformed;\n    },\n    delete: async ({\n      model: unsafeModel,\n      where: unsafeWhere\n    }) => {\n      transactionId++;\n      let thisTransactionId = transactionId;\n      const model = getModelName(unsafeModel);\n      const where = transformWhereClause({\n        model: unsafeModel,\n        where: unsafeWhere\n      });\n      debugLog(\n        { method: \"delete\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(1, 2)}`,\n        `${formatMethod(\"delete\")}:`,\n        { model, where }\n      );\n      await adapterInstance.delete({\n        model,\n        where\n      });\n      debugLog(\n        { method: \"delete\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(2, 2)}`,\n        `${formatMethod(\"delete\")} ${formatAction(\"DB Result\")}:`,\n        { model }\n      );\n    },\n    deleteMany: async ({\n      model: unsafeModel,\n      where: unsafeWhere\n    }) => {\n      transactionId++;\n      let thisTransactionId = transactionId;\n      const model = getModelName(unsafeModel);\n      const where = transformWhereClause({\n        model: unsafeModel,\n        where: unsafeWhere\n      });\n      debugLog(\n        { method: \"deleteMany\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(1, 2)}`,\n        `${formatMethod(\"deleteMany\")} ${formatAction(\"DeleteMany\")}:`,\n        { model, where }\n      );\n      const res = await adapterInstance.deleteMany({\n        model,\n        where\n      });\n      debugLog(\n        { method: \"deleteMany\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(2, 2)}`,\n        `${formatMethod(\"deleteMany\")} ${formatAction(\"DB Result\")}:`,\n        { model, data: res }\n      );\n      return res;\n    },\n    count: async ({\n      model: unsafeModel,\n      where: unsafeWhere\n    }) => {\n      transactionId++;\n      let thisTransactionId = transactionId;\n      const model = getModelName(unsafeModel);\n      const where = transformWhereClause({\n        model: unsafeModel,\n        where: unsafeWhere\n      });\n      debugLog(\n        { method: \"count\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(1, 2)}`,\n        `${formatMethod(\"count\")}:`,\n        {\n          model,\n          where\n        }\n      );\n      const res = await adapterInstance.count({\n        model,\n        where\n      });\n      debugLog(\n        { method: \"count\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(2, 2)}`,\n        `${formatMethod(\"count\")}:`,\n        {\n          model,\n          data: res\n        }\n      );\n      return res;\n    },\n    createSchema: adapterInstance.createSchema ? async (_, file) => {\n      const tables = (0,_better_auth_DORkW_Ge_mjs__WEBPACK_IMPORTED_MODULE_1__.g)(options);\n      if (options.secondaryStorage && !options.session?.storeSessionInDatabase) {\n        delete tables.session;\n      }\n      if (options.rateLimit && options.rateLimit.storage === \"database\" && // rate-limit will default to enabled in production,\n      // and given storage is database, it will try to use the rate-limit table,\n      // so we should make sure to generate rate-limit table schema\n      (typeof options.rateLimit.enabled === \"undefined\" || // and of course if they forcefully set to true, then they want rate-limit,\n      // thus we should also generate rate-limit table schema\n      options.rateLimit.enabled === true)) {\n        tables.ratelimit = {\n          modelName: options.rateLimit.modelName ?? \"ratelimit\",\n          fields: {\n            key: {\n              type: \"string\",\n              unique: true,\n              required: true,\n              fieldName: options.rateLimit.fields?.key ?? \"key\"\n            },\n            count: {\n              type: \"number\",\n              required: true,\n              fieldName: options.rateLimit.fields?.count ?? \"count\"\n            },\n            lastRequest: {\n              type: \"number\",\n              required: true,\n              bigint: true,\n              defaultValue: () => Date.now(),\n              fieldName: options.rateLimit.fields?.lastRequest ?? \"lastRequest\"\n            }\n          }\n        };\n      }\n      return adapterInstance.createSchema({ file, tables });\n    } : void 0,\n    options: {\n      adapterConfig: config,\n      ...adapterInstance.options ?? {}\n    },\n    id: config.adapterId,\n    // Secretly export values ONLY if this adapter has enabled adapter-test-debug-logs.\n    // This would then be used during our adapter-tests to help print debug logs if a test fails.\n    //@ts-expect-error - ^^\n    ...config.debugLogs?.isRunningAdapterTests ? {\n      adapterTestDebugLogs: {\n        resetDebugLogs() {\n          debugLogs = [];\n        },\n        printDebugLogs() {\n          const separator = `\\u2500`.repeat(80);\n          let log = debugLogs.reverse().map((log2) => {\n            log2[0] = `\n${log2[0]}`;\n            return [...log2, \"\\n\"];\n          }).reduce(\n            (prev, curr) => {\n              return [...curr, ...prev];\n            },\n            [`\n${separator}`]\n          );\n          console.log(...log);\n        }\n      }\n    } : {}\n  };\n};\nfunction formatTransactionId(transactionId2) {\n  return `${colors.fg.magenta}#${transactionId2}${colors.reset}`;\n}\nfunction formatStep(step, total) {\n  return `${colors.bg.black}${colors.fg.yellow}[${step}/${total}]${colors.reset}`;\n}\nfunction formatMethod(method) {\n  return `${colors.bright}${method}${colors.reset}`;\n}\nfunction formatAction(action) {\n  return `${colors.dim}(${action})${colors.reset}`;\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguZ0JsM0ZfeGEubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBZ0U7QUFDQTtBQUNVO0FBQzFEO0FBQ0s7QUFDWTtBQUNGO0FBQ0Q7QUFDSTtBQUNDO0FBQ3JCO0FBQ2dCO0FBQ0Y7QUFDSTtBQUNIO0FBQ087O0FBRXBDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLG1CQUFtQjtBQUM3QjtBQUNBO0FBQ0EsaUJBQWlCLDREQUFhO0FBQzlCO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLE9BQU8scUJBQXFCLE1BQU07QUFDMUQ7QUFDQSwrQkFBK0IsT0FBTyxxQkFBcUIsTUFBTTtBQUNqRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsTUFBTTtBQUMvQjtBQUNBLGdDQUFnQyxNQUFNO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsa0NBQWtDO0FBQzlEO0FBQ0EsMEJBQTBCLE1BQU07QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSx3Q0FBd0Ms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YTtBQUMvRDtBQUNBO0FBQ0EsWUFBWSxnQkFBZ0IsRUFBRSxpQkFBaUIsR0FBRyxLQUFLLEdBQUcsTUFBTSxHQUFHLGFBQWE7QUFDaEY7QUFDQTtBQUNBLFlBQVksY0FBYyxFQUFFLE9BQU8sRUFBRSxhQUFhO0FBQ2xEO0FBQ0E7QUFDQSxZQUFZLFdBQVcsR0FBRyxPQUFPLEdBQUcsYUFBYTtBQUNqRDs7QUFFOEIiLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWxhbi9EZXNrdG9wL0FwcHMvYmV0dGVyLWF1dGgvbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLmdCbDNGX3hhLm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBzIGFzIHNhZmVKU09OUGFyc2UgfSBmcm9tICcuL2JldHRlci1hdXRoLnRCNWVVNkVZLm1qcyc7XG5pbXBvcnQgeyBnIGFzIGdldEF1dGhUYWJsZXMgfSBmcm9tICcuL2JldHRlci1hdXRoLkRPUmtXX0dlLm1qcyc7XG5pbXBvcnQgeyBhIGFzIGxvZ2dlciwgZyBhcyBnZW5lcmF0ZUlkIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC5EQkdmSURuaC5tanMnO1xuaW1wb3J0ICd6b2QvdjQnO1xuaW1wb3J0ICdiZXR0ZXItY2FsbCc7XG5pbXBvcnQgJ0BiZXR0ZXItYXV0aC91dGlscy9oYXNoJztcbmltcG9ydCAnQG5vYmxlL2NpcGhlcnMvY2hhY2hhJztcbmltcG9ydCAnQG5vYmxlL2NpcGhlcnMvdXRpbHMnO1xuaW1wb3J0ICdAbm9ibGUvY2lwaGVycy93ZWJjcnlwdG8nO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMvYmFzZTY0JztcbmltcG9ydCAnam9zZSc7XG5pbXBvcnQgJ0Bub2JsZS9oYXNoZXMvc2NyeXB0JztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzJztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzL2hleCc7XG5pbXBvcnQgJ0Bub2JsZS9oYXNoZXMvdXRpbHMnO1xuaW1wb3J0ICcuL2JldHRlci1hdXRoLkI0UW94ZGdjLm1qcyc7XG5cbmZ1bmN0aW9uIHdpdGhBcHBseURlZmF1bHQodmFsdWUsIGZpZWxkLCBhY3Rpb24pIHtcbiAgaWYgKGFjdGlvbiA9PT0gXCJ1cGRhdGVcIikge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuICBpZiAodmFsdWUgPT09IHZvaWQgMCB8fCB2YWx1ZSA9PT0gbnVsbCkge1xuICAgIGlmIChmaWVsZC5kZWZhdWx0VmFsdWUgIT09IHZvaWQgMCkge1xuICAgICAgaWYgKHR5cGVvZiBmaWVsZC5kZWZhdWx0VmFsdWUgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICByZXR1cm4gZmllbGQuZGVmYXVsdFZhbHVlKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmllbGQuZGVmYXVsdFZhbHVlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdmFsdWU7XG59XG5cbmxldCBkZWJ1Z0xvZ3MgPSBbXTtcbmxldCB0cmFuc2FjdGlvbklkID0gLTE7XG5jb25zdCBjb2xvcnMgPSB7XG4gIHJlc2V0OiBcIlxceDFCWzBtXCIsXG4gIGJyaWdodDogXCJcXHgxQlsxbVwiLFxuICBkaW06IFwiXFx4MUJbMm1cIixcbiAgZmc6IHtcbiAgICB5ZWxsb3c6IFwiXFx4MUJbMzNtXCIsXG4gICAgbWFnZW50YTogXCJcXHgxQlszNW1cIn0sXG4gIGJnOiB7XG4gICAgYmxhY2s6IFwiXFx4MUJbNDBtXCJ9XG59O1xuY29uc3QgY3JlYXRlQWRhcHRlciA9ICh7XG4gIGFkYXB0ZXIsXG4gIGNvbmZpZzogY2ZnXG59KSA9PiAob3B0aW9ucykgPT4ge1xuICBjb25zdCBjb25maWcgPSB7XG4gICAgLi4uY2ZnLFxuICAgIHN1cHBvcnRzQm9vbGVhbnM6IGNmZy5zdXBwb3J0c0Jvb2xlYW5zID8/IHRydWUsXG4gICAgc3VwcG9ydHNEYXRlczogY2ZnLnN1cHBvcnRzRGF0ZXMgPz8gdHJ1ZSxcbiAgICBzdXBwb3J0c0pTT046IGNmZy5zdXBwb3J0c0pTT04gPz8gZmFsc2UsXG4gICAgYWRhcHRlck5hbWU6IGNmZy5hZGFwdGVyTmFtZSA/PyBjZmcuYWRhcHRlcklkLFxuICAgIHN1cHBvcnRzTnVtZXJpY0lkczogY2ZnLnN1cHBvcnRzTnVtZXJpY0lkcyA/PyB0cnVlXG4gIH07XG4gIGlmIChvcHRpb25zLmFkdmFuY2VkPy5kYXRhYmFzZT8udXNlTnVtYmVySWQgPT09IHRydWUgJiYgY29uZmlnLnN1cHBvcnRzTnVtZXJpY0lkcyA9PT0gZmFsc2UpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBgWyR7Y29uZmlnLmFkYXB0ZXJOYW1lfV0gWW91ciBkYXRhYmFzZSBvciBkYXRhYmFzZSBhZGFwdGVyIGRvZXMgbm90IHN1cHBvcnQgbnVtZXJpYyBpZHMuIFBsZWFzZSBkaXNhYmxlIFwidXNlTnVtYmVySWRcIiBpbiB5b3VyIGNvbmZpZy5gXG4gICAgKTtcbiAgfVxuICBjb25zdCBzY2hlbWEgPSBnZXRBdXRoVGFibGVzKG9wdGlvbnMpO1xuICBjb25zdCBnZXREZWZhdWx0RmllbGROYW1lID0gKHtcbiAgICBmaWVsZCxcbiAgICBtb2RlbDogdW5zYWZlX21vZGVsXG4gIH0pID0+IHtcbiAgICBpZiAoZmllbGQgPT09IFwiaWRcIiB8fCBmaWVsZCA9PT0gXCJfaWRcIikge1xuICAgICAgcmV0dXJuIFwiaWRcIjtcbiAgICB9XG4gICAgY29uc3QgbW9kZWwgPSBnZXREZWZhdWx0TW9kZWxOYW1lKHVuc2FmZV9tb2RlbCk7XG4gICAgbGV0IGYgPSBzY2hlbWFbbW9kZWxdPy5maWVsZHNbZmllbGRdO1xuICAgIGlmICghZikge1xuICAgICAgZiA9IE9iamVjdC52YWx1ZXMoc2NoZW1hW21vZGVsXT8uZmllbGRzKS5maW5kKFxuICAgICAgICAoZjIpID0+IGYyLmZpZWxkTmFtZSA9PT0gZmllbGRcbiAgICAgICk7XG4gICAgfVxuICAgIGlmICghZikge1xuICAgICAgZGVidWdMb2coYEZpZWxkICR7ZmllbGR9IG5vdCBmb3VuZCBpbiBtb2RlbCAke21vZGVsfWApO1xuICAgICAgZGVidWdMb2coYFNjaGVtYTpgLCBzY2hlbWEpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBGaWVsZCAke2ZpZWxkfSBub3QgZm91bmQgaW4gbW9kZWwgJHttb2RlbH1gKTtcbiAgICB9XG4gICAgcmV0dXJuIGZpZWxkO1xuICB9O1xuICBjb25zdCBnZXREZWZhdWx0TW9kZWxOYW1lID0gKG1vZGVsKSA9PiB7XG4gICAgaWYgKGNvbmZpZy51c2VQbHVyYWwgJiYgbW9kZWwuY2hhckF0KG1vZGVsLmxlbmd0aCAtIDEpID09PSBcInNcIikge1xuICAgICAgbGV0IHBsdXJhbGVzc01vZGVsID0gbW9kZWwuc2xpY2UoMCwgLTEpO1xuICAgICAgbGV0IG0yID0gc2NoZW1hW3BsdXJhbGVzc01vZGVsXSA/IHBsdXJhbGVzc01vZGVsIDogdm9pZCAwO1xuICAgICAgaWYgKCFtMikge1xuICAgICAgICBtMiA9IE9iamVjdC5lbnRyaWVzKHNjaGVtYSkuZmluZChcbiAgICAgICAgICAoW18sIGZdKSA9PiBmLm1vZGVsTmFtZSA9PT0gcGx1cmFsZXNzTW9kZWxcbiAgICAgICAgKT8uWzBdO1xuICAgICAgfVxuICAgICAgaWYgKG0yKSB7XG4gICAgICAgIHJldHVybiBtMjtcbiAgICAgIH1cbiAgICB9XG4gICAgbGV0IG0gPSBzY2hlbWFbbW9kZWxdID8gbW9kZWwgOiB2b2lkIDA7XG4gICAgaWYgKCFtKSB7XG4gICAgICBtID0gT2JqZWN0LmVudHJpZXMoc2NoZW1hKS5maW5kKChbXywgZl0pID0+IGYubW9kZWxOYW1lID09PSBtb2RlbCk/LlswXTtcbiAgICB9XG4gICAgaWYgKCFtKSB7XG4gICAgICBkZWJ1Z0xvZyhgTW9kZWwgXCIke21vZGVsfVwiIG5vdCBmb3VuZCBpbiBzY2hlbWFgKTtcbiAgICAgIGRlYnVnTG9nKGBTY2hlbWE6YCwgc2NoZW1hKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTW9kZWwgXCIke21vZGVsfVwiIG5vdCBmb3VuZCBpbiBzY2hlbWFgKTtcbiAgICB9XG4gICAgcmV0dXJuIG07XG4gIH07XG4gIGNvbnN0IGdldE1vZGVsTmFtZSA9IChtb2RlbCkgPT4ge1xuICAgIGNvbnN0IGRlZmF1bHRNb2RlbEtleSA9IGdldERlZmF1bHRNb2RlbE5hbWUobW9kZWwpO1xuICAgIGNvbnN0IHVzZVBsdXJhbCA9IGNvbmZpZyAmJiBjb25maWcudXNlUGx1cmFsO1xuICAgIGNvbnN0IHVzZUN1c3RvbU1vZGVsTmFtZSA9IHNjaGVtYSAmJiBzY2hlbWFbZGVmYXVsdE1vZGVsS2V5XSAmJiBzY2hlbWFbZGVmYXVsdE1vZGVsS2V5XS5tb2RlbE5hbWUgIT09IG1vZGVsO1xuICAgIGlmICh1c2VDdXN0b21Nb2RlbE5hbWUpIHtcbiAgICAgIHJldHVybiB1c2VQbHVyYWwgPyBgJHtzY2hlbWFbZGVmYXVsdE1vZGVsS2V5XS5tb2RlbE5hbWV9c2AgOiBzY2hlbWFbZGVmYXVsdE1vZGVsS2V5XS5tb2RlbE5hbWU7XG4gICAgfVxuICAgIHJldHVybiB1c2VQbHVyYWwgPyBgJHttb2RlbH1zYCA6IG1vZGVsO1xuICB9O1xuICBmdW5jdGlvbiBnZXRGaWVsZE5hbWUoe1xuICAgIG1vZGVsOiBtb2RlbF9uYW1lLFxuICAgIGZpZWxkOiBmaWVsZF9uYW1lXG4gIH0pIHtcbiAgICBjb25zdCBtb2RlbCA9IGdldERlZmF1bHRNb2RlbE5hbWUobW9kZWxfbmFtZSk7XG4gICAgY29uc3QgZmllbGQgPSBnZXREZWZhdWx0RmllbGROYW1lKHsgbW9kZWwsIGZpZWxkOiBmaWVsZF9uYW1lIH0pO1xuICAgIHJldHVybiBzY2hlbWFbbW9kZWxdPy5maWVsZHNbZmllbGRdPy5maWVsZE5hbWUgfHwgZmllbGQ7XG4gIH1cbiAgY29uc3QgZGVidWdMb2cgPSAoLi4uYXJncykgPT4ge1xuICAgIGlmIChjb25maWcuZGVidWdMb2dzID09PSB0cnVlIHx8IHR5cGVvZiBjb25maWcuZGVidWdMb2dzID09PSBcIm9iamVjdFwiKSB7XG4gICAgICBpZiAodHlwZW9mIGNvbmZpZy5kZWJ1Z0xvZ3MgPT09IFwib2JqZWN0XCIgJiYgXCJpc1J1bm5pbmdBZGFwdGVyVGVzdHNcIiBpbiBjb25maWcuZGVidWdMb2dzKSB7XG4gICAgICAgIGlmIChjb25maWcuZGVidWdMb2dzLmlzUnVubmluZ0FkYXB0ZXJUZXN0cykge1xuICAgICAgICAgIGFyZ3Muc2hpZnQoKTtcbiAgICAgICAgICBkZWJ1Z0xvZ3MucHVzaChhcmdzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAodHlwZW9mIGNvbmZpZy5kZWJ1Z0xvZ3MgPT09IFwib2JqZWN0XCIgJiYgY29uZmlnLmRlYnVnTG9ncy5sb2dDb25kaXRpb24gJiYgIWNvbmZpZy5kZWJ1Z0xvZ3MubG9nQ29uZGl0aW9uPy4oKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAodHlwZW9mIGFyZ3NbMF0gPT09IFwib2JqZWN0XCIgJiYgXCJtZXRob2RcIiBpbiBhcmdzWzBdKSB7XG4gICAgICAgIGNvbnN0IG1ldGhvZCA9IGFyZ3Muc2hpZnQoKS5tZXRob2Q7XG4gICAgICAgIGlmICh0eXBlb2YgY29uZmlnLmRlYnVnTG9ncyA9PT0gXCJvYmplY3RcIikge1xuICAgICAgICAgIGlmIChtZXRob2QgPT09IFwiY3JlYXRlXCIgJiYgIWNvbmZpZy5kZWJ1Z0xvZ3MuY3JlYXRlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfSBlbHNlIGlmIChtZXRob2QgPT09IFwidXBkYXRlXCIgJiYgIWNvbmZpZy5kZWJ1Z0xvZ3MudXBkYXRlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfSBlbHNlIGlmIChtZXRob2QgPT09IFwidXBkYXRlTWFueVwiICYmICFjb25maWcuZGVidWdMb2dzLnVwZGF0ZU1hbnkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9IGVsc2UgaWYgKG1ldGhvZCA9PT0gXCJmaW5kT25lXCIgJiYgIWNvbmZpZy5kZWJ1Z0xvZ3MuZmluZE9uZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0gZWxzZSBpZiAobWV0aG9kID09PSBcImZpbmRNYW55XCIgJiYgIWNvbmZpZy5kZWJ1Z0xvZ3MuZmluZE1hbnkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9IGVsc2UgaWYgKG1ldGhvZCA9PT0gXCJkZWxldGVcIiAmJiAhY29uZmlnLmRlYnVnTG9ncy5kZWxldGUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9IGVsc2UgaWYgKG1ldGhvZCA9PT0gXCJkZWxldGVNYW55XCIgJiYgIWNvbmZpZy5kZWJ1Z0xvZ3MuZGVsZXRlTWFueSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0gZWxzZSBpZiAobWV0aG9kID09PSBcImNvdW50XCIgJiYgIWNvbmZpZy5kZWJ1Z0xvZ3MuY291bnQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbG9nZ2VyLmluZm8oYFske2NvbmZpZy5hZGFwdGVyTmFtZX1dYCwgLi4uYXJncyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2dnZXIuaW5mbyhgWyR7Y29uZmlnLmFkYXB0ZXJOYW1lfV1gLCAuLi5hcmdzKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IGlkRmllbGQgPSAoe1xuICAgIGN1c3RvbU1vZGVsTmFtZSxcbiAgICBmb3JjZUFsbG93SWRcbiAgfSkgPT4ge1xuICAgIGNvbnN0IHNob3VsZEdlbmVyYXRlSWQgPSAhY29uZmlnLmRpc2FibGVJZEdlbmVyYXRpb24gJiYgIW9wdGlvbnMuYWR2YW5jZWQ/LmRhdGFiYXNlPy51c2VOdW1iZXJJZCAmJiAhZm9yY2VBbGxvd0lkO1xuICAgIGNvbnN0IG1vZGVsID0gZ2V0RGVmYXVsdE1vZGVsTmFtZShjdXN0b21Nb2RlbE5hbWUgPz8gXCJpZFwiKTtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogb3B0aW9ucy5hZHZhbmNlZD8uZGF0YWJhc2U/LnVzZU51bWJlcklkID8gXCJudW1iZXJcIiA6IFwic3RyaW5nXCIsXG4gICAgICByZXF1aXJlZDogc2hvdWxkR2VuZXJhdGVJZCA/IHRydWUgOiBmYWxzZSxcbiAgICAgIC4uLnNob3VsZEdlbmVyYXRlSWQgPyB7XG4gICAgICAgIGRlZmF1bHRWYWx1ZSgpIHtcbiAgICAgICAgICBpZiAoY29uZmlnLmRpc2FibGVJZEdlbmVyYXRpb24pIHJldHVybiB2b2lkIDA7XG4gICAgICAgICAgY29uc3QgdXNlTnVtYmVySWQgPSBvcHRpb25zLmFkdmFuY2VkPy5kYXRhYmFzZT8udXNlTnVtYmVySWQ7XG4gICAgICAgICAgbGV0IGdlbmVyYXRlSWQkMSA9IG9wdGlvbnMuYWR2YW5jZWQ/LmRhdGFiYXNlPy5nZW5lcmF0ZUlkO1xuICAgICAgICAgIGlmIChvcHRpb25zLmFkdmFuY2VkPy5nZW5lcmF0ZUlkICE9PSB2b2lkIDApIHtcbiAgICAgICAgICAgIGxvZ2dlci53YXJuKFxuICAgICAgICAgICAgICBcIllvdXIgQmV0dGVyIEF1dGggY29uZmlnIGluY2x1ZGVzIGFkdmFuY2VkLmdlbmVyYXRlSWQgd2hpY2ggaXMgZGVwcmVjYXRlZC4gUGxlYXNlIHVzZSBhZHZhbmNlZC5kYXRhYmFzZS5nZW5lcmF0ZUlkIGluc3RlYWQuIFRoaXMgd2lsbCBiZSByZW1vdmVkIGluIGZ1dHVyZSByZWxlYXNlcy5cIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGdlbmVyYXRlSWQkMSA9IG9wdGlvbnMuYWR2YW5jZWQ/LmdlbmVyYXRlSWQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChnZW5lcmF0ZUlkJDEgPT09IGZhbHNlIHx8IHVzZU51bWJlcklkKSByZXR1cm4gdm9pZCAwO1xuICAgICAgICAgIGlmIChnZW5lcmF0ZUlkJDEpIHtcbiAgICAgICAgICAgIHJldHVybiBnZW5lcmF0ZUlkJDEoe1xuICAgICAgICAgICAgICBtb2RlbFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChjb25maWcuY3VzdG9tSWRHZW5lcmF0b3IpIHtcbiAgICAgICAgICAgIHJldHVybiBjb25maWcuY3VzdG9tSWRHZW5lcmF0b3IoeyBtb2RlbCB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGdlbmVyYXRlSWQoKTtcbiAgICAgICAgfVxuICAgICAgfSA6IHt9XG4gICAgfTtcbiAgfTtcbiAgY29uc3QgZ2V0RmllbGRBdHRyaWJ1dGVzID0gKHtcbiAgICBtb2RlbCxcbiAgICBmaWVsZFxuICB9KSA9PiB7XG4gICAgY29uc3QgZGVmYXVsdE1vZGVsTmFtZSA9IGdldERlZmF1bHRNb2RlbE5hbWUobW9kZWwpO1xuICAgIGNvbnN0IGRlZmF1bHRGaWVsZE5hbWUgPSBnZXREZWZhdWx0RmllbGROYW1lKHtcbiAgICAgIGZpZWxkLFxuICAgICAgbW9kZWxcbiAgICB9KTtcbiAgICBjb25zdCBmaWVsZHMgPSBzY2hlbWFbZGVmYXVsdE1vZGVsTmFtZV0uZmllbGRzO1xuICAgIGZpZWxkcy5pZCA9IGlkRmllbGQoeyBjdXN0b21Nb2RlbE5hbWU6IGRlZmF1bHRNb2RlbE5hbWUgfSk7XG4gICAgcmV0dXJuIGZpZWxkc1tkZWZhdWx0RmllbGROYW1lXTtcbiAgfTtcbiAgY29uc3QgYWRhcHRlckluc3RhbmNlID0gYWRhcHRlcih7XG4gICAgb3B0aW9ucyxcbiAgICBzY2hlbWEsXG4gICAgZGVidWdMb2csXG4gICAgZ2V0RmllbGROYW1lLFxuICAgIGdldE1vZGVsTmFtZSxcbiAgICBnZXREZWZhdWx0TW9kZWxOYW1lLFxuICAgIGdldERlZmF1bHRGaWVsZE5hbWUsXG4gICAgZ2V0RmllbGRBdHRyaWJ1dGVzXG4gIH0pO1xuICBjb25zdCB0cmFuc2Zvcm1JbnB1dCA9IGFzeW5jIChkYXRhLCB1bnNhZmVfbW9kZWwsIGFjdGlvbiwgZm9yY2VBbGxvd0lkKSA9PiB7XG4gICAgY29uc3QgdHJhbnNmb3JtZWREYXRhID0ge307XG4gICAgY29uc3QgZmllbGRzID0gc2NoZW1hW3Vuc2FmZV9tb2RlbF0uZmllbGRzO1xuICAgIGNvbnN0IG5ld01hcHBlZEtleXMgPSBjb25maWcubWFwS2V5c1RyYW5zZm9ybUlucHV0ID8/IHt9O1xuICAgIGlmICghY29uZmlnLmRpc2FibGVJZEdlbmVyYXRpb24gJiYgIW9wdGlvbnMuYWR2YW5jZWQ/LmRhdGFiYXNlPy51c2VOdW1iZXJJZCkge1xuICAgICAgZmllbGRzLmlkID0gaWRGaWVsZCh7XG4gICAgICAgIGN1c3RvbU1vZGVsTmFtZTogdW5zYWZlX21vZGVsLFxuICAgICAgICBmb3JjZUFsbG93SWQ6IGZvcmNlQWxsb3dJZCAmJiBcImlkXCIgaW4gZGF0YVxuICAgICAgfSk7XG4gICAgfVxuICAgIGZvciAoY29uc3QgZmllbGQgaW4gZmllbGRzKSB7XG4gICAgICBjb25zdCB2YWx1ZSA9IGRhdGFbZmllbGRdO1xuICAgICAgY29uc3QgZmllbGRBdHRyaWJ1dGVzID0gZmllbGRzW2ZpZWxkXTtcbiAgICAgIGxldCBuZXdGaWVsZE5hbWUgPSBuZXdNYXBwZWRLZXlzW2ZpZWxkXSB8fCBmaWVsZHNbZmllbGRdLmZpZWxkTmFtZSB8fCBmaWVsZDtcbiAgICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwICYmICghZmllbGRBdHRyaWJ1dGVzLmRlZmF1bHRWYWx1ZSAmJiAhZmllbGRBdHRyaWJ1dGVzLnRyYW5zZm9ybT8uaW5wdXQgfHwgYWN0aW9uID09PSBcInVwZGF0ZVwiKSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGxldCBuZXdWYWx1ZSA9IHdpdGhBcHBseURlZmF1bHQodmFsdWUsIGZpZWxkQXR0cmlidXRlcywgYWN0aW9uKTtcbiAgICAgIGlmIChmaWVsZEF0dHJpYnV0ZXMudHJhbnNmb3JtPy5pbnB1dCkge1xuICAgICAgICBuZXdWYWx1ZSA9IGF3YWl0IGZpZWxkQXR0cmlidXRlcy50cmFuc2Zvcm0uaW5wdXQobmV3VmFsdWUpO1xuICAgICAgfVxuICAgICAgaWYgKGZpZWxkQXR0cmlidXRlcy5yZWZlcmVuY2VzPy5maWVsZCA9PT0gXCJpZFwiICYmIG9wdGlvbnMuYWR2YW5jZWQ/LmRhdGFiYXNlPy51c2VOdW1iZXJJZCkge1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShuZXdWYWx1ZSkpIHtcbiAgICAgICAgICBuZXdWYWx1ZSA9IG5ld1ZhbHVlLm1hcChOdW1iZXIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG5ld1ZhbHVlID0gTnVtYmVyKG5ld1ZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChjb25maWcuc3VwcG9ydHNKU09OID09PSBmYWxzZSAmJiB0eXBlb2YgbmV3VmFsdWUgPT09IFwib2JqZWN0XCIgJiYgLy9AdHMtZXhwZWN0LWVycm9yIC1GdXR1cmUgcHJvb2ZpbmdcbiAgICAgIGZpZWxkQXR0cmlidXRlcy50eXBlID09PSBcImpzb25cIikge1xuICAgICAgICBuZXdWYWx1ZSA9IEpTT04uc3RyaW5naWZ5KG5ld1ZhbHVlKTtcbiAgICAgIH0gZWxzZSBpZiAoY29uZmlnLnN1cHBvcnRzRGF0ZXMgPT09IGZhbHNlICYmIG5ld1ZhbHVlIGluc3RhbmNlb2YgRGF0ZSAmJiBmaWVsZEF0dHJpYnV0ZXMudHlwZSA9PT0gXCJkYXRlXCIpIHtcbiAgICAgICAgbmV3VmFsdWUgPSBuZXdWYWx1ZS50b0lTT1N0cmluZygpO1xuICAgICAgfSBlbHNlIGlmIChjb25maWcuc3VwcG9ydHNCb29sZWFucyA9PT0gZmFsc2UgJiYgdHlwZW9mIG5ld1ZhbHVlID09PSBcImJvb2xlYW5cIikge1xuICAgICAgICBuZXdWYWx1ZSA9IG5ld1ZhbHVlID8gMSA6IDA7XG4gICAgICB9XG4gICAgICBpZiAoY29uZmlnLmN1c3RvbVRyYW5zZm9ybUlucHV0KSB7XG4gICAgICAgIG5ld1ZhbHVlID0gY29uZmlnLmN1c3RvbVRyYW5zZm9ybUlucHV0KHtcbiAgICAgICAgICBkYXRhOiBuZXdWYWx1ZSxcbiAgICAgICAgICBhY3Rpb24sXG4gICAgICAgICAgZmllbGQ6IG5ld0ZpZWxkTmFtZSxcbiAgICAgICAgICBmaWVsZEF0dHJpYnV0ZXMsXG4gICAgICAgICAgbW9kZWw6IHVuc2FmZV9tb2RlbCxcbiAgICAgICAgICBzY2hlbWEsXG4gICAgICAgICAgb3B0aW9uc1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHRyYW5zZm9ybWVkRGF0YVtuZXdGaWVsZE5hbWVdID0gbmV3VmFsdWU7XG4gICAgfVxuICAgIHJldHVybiB0cmFuc2Zvcm1lZERhdGE7XG4gIH07XG4gIGNvbnN0IHRyYW5zZm9ybU91dHB1dCA9IGFzeW5jIChkYXRhLCB1bnNhZmVfbW9kZWwsIHNlbGVjdCA9IFtdKSA9PiB7XG4gICAgaWYgKCFkYXRhKSByZXR1cm4gbnVsbDtcbiAgICBjb25zdCBuZXdNYXBwZWRLZXlzID0gY29uZmlnLm1hcEtleXNUcmFuc2Zvcm1PdXRwdXQgPz8ge307XG4gICAgY29uc3QgdHJhbnNmb3JtZWREYXRhID0ge307XG4gICAgY29uc3QgdGFibGVTY2hlbWEgPSBzY2hlbWFbdW5zYWZlX21vZGVsXS5maWVsZHM7XG4gICAgY29uc3QgaWRLZXkgPSBPYmplY3QuZW50cmllcyhuZXdNYXBwZWRLZXlzKS5maW5kKFxuICAgICAgKFtfLCB2XSkgPT4gdiA9PT0gXCJpZFwiXG4gICAgKT8uWzBdO1xuICAgIHRhYmxlU2NoZW1hW2lkS2V5ID8/IFwiaWRcIl0gPSB7XG4gICAgICB0eXBlOiBvcHRpb25zLmFkdmFuY2VkPy5kYXRhYmFzZT8udXNlTnVtYmVySWQgPyBcIm51bWJlclwiIDogXCJzdHJpbmdcIlxuICAgIH07XG4gICAgZm9yIChjb25zdCBrZXkgaW4gdGFibGVTY2hlbWEpIHtcbiAgICAgIGlmIChzZWxlY3QubGVuZ3RoICYmICFzZWxlY3QuaW5jbHVkZXMoa2V5KSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGZpZWxkID0gdGFibGVTY2hlbWFba2V5XTtcbiAgICAgIGlmIChmaWVsZCkge1xuICAgICAgICBjb25zdCBvcmlnaW5hbEtleSA9IGZpZWxkLmZpZWxkTmFtZSB8fCBrZXk7XG4gICAgICAgIGxldCBuZXdWYWx1ZSA9IGRhdGFbT2JqZWN0LmVudHJpZXMobmV3TWFwcGVkS2V5cykuZmluZChcbiAgICAgICAgICAoW18sIHZdKSA9PiB2ID09PSBvcmlnaW5hbEtleVxuICAgICAgICApPy5bMF0gfHwgb3JpZ2luYWxLZXldO1xuICAgICAgICBpZiAoZmllbGQudHJhbnNmb3JtPy5vdXRwdXQpIHtcbiAgICAgICAgICBuZXdWYWx1ZSA9IGF3YWl0IGZpZWxkLnRyYW5zZm9ybS5vdXRwdXQobmV3VmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIGxldCBuZXdGaWVsZE5hbWUgPSBuZXdNYXBwZWRLZXlzW2tleV0gfHwga2V5O1xuICAgICAgICBpZiAob3JpZ2luYWxLZXkgPT09IFwiaWRcIiB8fCBmaWVsZC5yZWZlcmVuY2VzPy5maWVsZCA9PT0gXCJpZFwiKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBuZXdWYWx1ZSAhPT0gXCJ1bmRlZmluZWRcIikgbmV3VmFsdWUgPSBTdHJpbmcobmV3VmFsdWUpO1xuICAgICAgICB9IGVsc2UgaWYgKGNvbmZpZy5zdXBwb3J0c0pTT04gPT09IGZhbHNlICYmIHR5cGVvZiBuZXdWYWx1ZSA9PT0gXCJzdHJpbmdcIiAmJiAvL0B0cy1leHBlY3QtZXJyb3IgLSBGdXR1cmUgcHJvb2ZpbmdcbiAgICAgICAgZmllbGQudHlwZSA9PT0gXCJqc29uXCIpIHtcbiAgICAgICAgICBuZXdWYWx1ZSA9IHNhZmVKU09OUGFyc2UobmV3VmFsdWUpO1xuICAgICAgICB9IGVsc2UgaWYgKGNvbmZpZy5zdXBwb3J0c0RhdGVzID09PSBmYWxzZSAmJiB0eXBlb2YgbmV3VmFsdWUgPT09IFwic3RyaW5nXCIgJiYgZmllbGQudHlwZSA9PT0gXCJkYXRlXCIpIHtcbiAgICAgICAgICBuZXdWYWx1ZSA9IG5ldyBEYXRlKG5ld1ZhbHVlKTtcbiAgICAgICAgfSBlbHNlIGlmIChjb25maWcuc3VwcG9ydHNCb29sZWFucyA9PT0gZmFsc2UgJiYgdHlwZW9mIG5ld1ZhbHVlID09PSBcIm51bWJlclwiICYmIGZpZWxkLnR5cGUgPT09IFwiYm9vbGVhblwiKSB7XG4gICAgICAgICAgbmV3VmFsdWUgPSBuZXdWYWx1ZSA9PT0gMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnLmN1c3RvbVRyYW5zZm9ybU91dHB1dCkge1xuICAgICAgICAgIG5ld1ZhbHVlID0gY29uZmlnLmN1c3RvbVRyYW5zZm9ybU91dHB1dCh7XG4gICAgICAgICAgICBkYXRhOiBuZXdWYWx1ZSxcbiAgICAgICAgICAgIGZpZWxkOiBuZXdGaWVsZE5hbWUsXG4gICAgICAgICAgICBmaWVsZEF0dHJpYnV0ZXM6IGZpZWxkLFxuICAgICAgICAgICAgc2VsZWN0LFxuICAgICAgICAgICAgbW9kZWw6IHVuc2FmZV9tb2RlbCxcbiAgICAgICAgICAgIHNjaGVtYSxcbiAgICAgICAgICAgIG9wdGlvbnNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB0cmFuc2Zvcm1lZERhdGFbbmV3RmllbGROYW1lXSA9IG5ld1ZhbHVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJhbnNmb3JtZWREYXRhO1xuICB9O1xuICBjb25zdCB0cmFuc2Zvcm1XaGVyZUNsYXVzZSA9ICh7XG4gICAgbW9kZWwsXG4gICAgd2hlcmVcbiAgfSkgPT4ge1xuICAgIGlmICghd2hlcmUpIHJldHVybiB2b2lkIDA7XG4gICAgY29uc3QgbmV3TWFwcGVkS2V5cyA9IGNvbmZpZy5tYXBLZXlzVHJhbnNmb3JtSW5wdXQgPz8ge307XG4gICAgcmV0dXJuIHdoZXJlLm1hcCgodykgPT4ge1xuICAgICAgY29uc3Qge1xuICAgICAgICBmaWVsZDogdW5zYWZlX2ZpZWxkLFxuICAgICAgICB2YWx1ZSxcbiAgICAgICAgb3BlcmF0b3IgPSBcImVxXCIsXG4gICAgICAgIGNvbm5lY3RvciA9IFwiQU5EXCJcbiAgICAgIH0gPSB3O1xuICAgICAgaWYgKG9wZXJhdG9yID09PSBcImluXCIpIHtcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlZhbHVlIG11c3QgYmUgYW4gYXJyYXlcIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvbnN0IGRlZmF1bHRNb2RlbE5hbWUgPSBnZXREZWZhdWx0TW9kZWxOYW1lKG1vZGVsKTtcbiAgICAgIGNvbnN0IGRlZmF1bHRGaWVsZE5hbWUgPSBnZXREZWZhdWx0RmllbGROYW1lKHtcbiAgICAgICAgZmllbGQ6IHVuc2FmZV9maWVsZCxcbiAgICAgICAgbW9kZWxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgZmllbGROYW1lID0gbmV3TWFwcGVkS2V5c1tkZWZhdWx0RmllbGROYW1lXSB8fCBnZXRGaWVsZE5hbWUoe1xuICAgICAgICBmaWVsZDogZGVmYXVsdEZpZWxkTmFtZSxcbiAgICAgICAgbW9kZWw6IGRlZmF1bHRNb2RlbE5hbWVcbiAgICAgIH0pO1xuICAgICAgY29uc3QgZmllbGRBdHRyID0gZ2V0RmllbGRBdHRyaWJ1dGVzKHtcbiAgICAgICAgZmllbGQ6IGRlZmF1bHRGaWVsZE5hbWUsXG4gICAgICAgIG1vZGVsOiBkZWZhdWx0TW9kZWxOYW1lXG4gICAgICB9KTtcbiAgICAgIGlmIChkZWZhdWx0RmllbGROYW1lID09PSBcImlkXCIgfHwgZmllbGRBdHRyLnJlZmVyZW5jZXM/LmZpZWxkID09PSBcImlkXCIpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMuYWR2YW5jZWQ/LmRhdGFiYXNlPy51c2VOdW1iZXJJZCkge1xuICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgb3BlcmF0b3IsXG4gICAgICAgICAgICAgIGNvbm5lY3RvcixcbiAgICAgICAgICAgICAgZmllbGQ6IGZpZWxkTmFtZSxcbiAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLm1hcChOdW1iZXIpXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgb3BlcmF0b3IsXG4gICAgICAgICAgICBjb25uZWN0b3IsXG4gICAgICAgICAgICBmaWVsZDogZmllbGROYW1lLFxuICAgICAgICAgICAgdmFsdWU6IE51bWJlcih2YWx1ZSlcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICBvcGVyYXRvcixcbiAgICAgICAgY29ubmVjdG9yLFxuICAgICAgICBmaWVsZDogZmllbGROYW1lLFxuICAgICAgICB2YWx1ZVxuICAgICAgfTtcbiAgICB9KTtcbiAgfTtcbiAgcmV0dXJuIHtcbiAgICBjcmVhdGU6IGFzeW5jICh7XG4gICAgICBkYXRhOiB1bnNhZmVEYXRhLFxuICAgICAgbW9kZWw6IHVuc2FmZU1vZGVsLFxuICAgICAgc2VsZWN0LFxuICAgICAgZm9yY2VBbGxvd0lkID0gZmFsc2VcbiAgICB9KSA9PiB7XG4gICAgICB0cmFuc2FjdGlvbklkKys7XG4gICAgICBsZXQgdGhpc1RyYW5zYWN0aW9uSWQgPSB0cmFuc2FjdGlvbklkO1xuICAgICAgY29uc3QgbW9kZWwgPSBnZXRNb2RlbE5hbWUodW5zYWZlTW9kZWwpO1xuICAgICAgaWYgKFwiaWRcIiBpbiB1bnNhZmVEYXRhICYmICFmb3JjZUFsbG93SWQpIHtcbiAgICAgICAgbG9nZ2VyLndhcm4oXG4gICAgICAgICAgYFske2NvbmZpZy5hZGFwdGVyTmFtZX1dIC0gWW91IGFyZSB0cnlpbmcgdG8gY3JlYXRlIGEgcmVjb3JkIHdpdGggYW4gaWQuIFRoaXMgaXMgbm90IGFsbG93ZWQgYXMgd2UgaGFuZGxlIGlkIGdlbmVyYXRpb24gZm9yIHlvdSwgdW5sZXNzIHlvdSBwYXNzIGluIHRoZSBcXGBmb3JjZUFsbG93SWRcXGAgcGFyYW1ldGVyLiBUaGUgaWQgd2lsbCBiZSBpZ25vcmVkLmBcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgZXJyID0gbmV3IEVycm9yKCk7XG4gICAgICAgIGNvbnN0IHN0YWNrID0gZXJyLnN0YWNrPy5zcGxpdChcIlxcblwiKS5maWx0ZXIoKF8sIGkpID0+IGkgIT09IDEpLmpvaW4oXCJcXG5cIikucmVwbGFjZShcIkVycm9yOlwiLCBcIkNyZWF0ZSBtZXRob2Qgd2l0aCBgaWRgIGJlaW5nIGNhbGxlZCBhdDpcIik7XG4gICAgICAgIGNvbnNvbGUubG9nKHN0YWNrKTtcbiAgICAgICAgdW5zYWZlRGF0YS5pZCA9IHZvaWQgMDtcbiAgICAgIH1cbiAgICAgIGRlYnVnTG9nKFxuICAgICAgICB7IG1ldGhvZDogXCJjcmVhdGVcIiB9LFxuICAgICAgICBgJHtmb3JtYXRUcmFuc2FjdGlvbklkKHRoaXNUcmFuc2FjdGlvbklkKX0gJHtmb3JtYXRTdGVwKDEsIDQpfWAsXG4gICAgICAgIGAke2Zvcm1hdE1ldGhvZChcImNyZWF0ZVwiKX0gJHtmb3JtYXRBY3Rpb24oXCJVbnNhZmUgSW5wdXRcIil9OmAsXG4gICAgICAgIHsgbW9kZWwsIGRhdGE6IHVuc2FmZURhdGEgfVxuICAgICAgKTtcbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0cmFuc2Zvcm1JbnB1dChcbiAgICAgICAgdW5zYWZlRGF0YSxcbiAgICAgICAgdW5zYWZlTW9kZWwsXG4gICAgICAgIFwiY3JlYXRlXCIsXG4gICAgICAgIGZvcmNlQWxsb3dJZFxuICAgICAgKTtcbiAgICAgIGRlYnVnTG9nKFxuICAgICAgICB7IG1ldGhvZDogXCJjcmVhdGVcIiB9LFxuICAgICAgICBgJHtmb3JtYXRUcmFuc2FjdGlvbklkKHRoaXNUcmFuc2FjdGlvbklkKX0gJHtmb3JtYXRTdGVwKDIsIDQpfWAsXG4gICAgICAgIGAke2Zvcm1hdE1ldGhvZChcImNyZWF0ZVwiKX0gJHtmb3JtYXRBY3Rpb24oXCJQYXJzZWQgSW5wdXRcIil9OmAsXG4gICAgICAgIHsgbW9kZWwsIGRhdGEgfVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGFkYXB0ZXJJbnN0YW5jZS5jcmVhdGUoeyBkYXRhLCBtb2RlbCB9KTtcbiAgICAgIGRlYnVnTG9nKFxuICAgICAgICB7IG1ldGhvZDogXCJjcmVhdGVcIiB9LFxuICAgICAgICBgJHtmb3JtYXRUcmFuc2FjdGlvbklkKHRoaXNUcmFuc2FjdGlvbklkKX0gJHtmb3JtYXRTdGVwKDMsIDQpfWAsXG4gICAgICAgIGAke2Zvcm1hdE1ldGhvZChcImNyZWF0ZVwiKX0gJHtmb3JtYXRBY3Rpb24oXCJEQiBSZXN1bHRcIil9OmAsXG4gICAgICAgIHsgbW9kZWwsIHJlcyB9XG4gICAgICApO1xuICAgICAgY29uc3QgdHJhbnNmb3JtZWQgPSBhd2FpdCB0cmFuc2Zvcm1PdXRwdXQocmVzLCB1bnNhZmVNb2RlbCwgc2VsZWN0KTtcbiAgICAgIGRlYnVnTG9nKFxuICAgICAgICB7IG1ldGhvZDogXCJjcmVhdGVcIiB9LFxuICAgICAgICBgJHtmb3JtYXRUcmFuc2FjdGlvbklkKHRoaXNUcmFuc2FjdGlvbklkKX0gJHtmb3JtYXRTdGVwKDQsIDQpfWAsXG4gICAgICAgIGAke2Zvcm1hdE1ldGhvZChcImNyZWF0ZVwiKX0gJHtmb3JtYXRBY3Rpb24oXCJQYXJzZWQgUmVzdWx0XCIpfTpgLFxuICAgICAgICB7IG1vZGVsLCBkYXRhOiB0cmFuc2Zvcm1lZCB9XG4gICAgICApO1xuICAgICAgcmV0dXJuIHRyYW5zZm9ybWVkO1xuICAgIH0sXG4gICAgdXBkYXRlOiBhc3luYyAoe1xuICAgICAgbW9kZWw6IHVuc2FmZU1vZGVsLFxuICAgICAgd2hlcmU6IHVuc2FmZVdoZXJlLFxuICAgICAgdXBkYXRlOiB1bnNhZmVEYXRhXG4gICAgfSkgPT4ge1xuICAgICAgdHJhbnNhY3Rpb25JZCsrO1xuICAgICAgbGV0IHRoaXNUcmFuc2FjdGlvbklkID0gdHJhbnNhY3Rpb25JZDtcbiAgICAgIGNvbnN0IG1vZGVsID0gZ2V0TW9kZWxOYW1lKHVuc2FmZU1vZGVsKTtcbiAgICAgIGNvbnN0IHdoZXJlID0gdHJhbnNmb3JtV2hlcmVDbGF1c2Uoe1xuICAgICAgICBtb2RlbDogdW5zYWZlTW9kZWwsXG4gICAgICAgIHdoZXJlOiB1bnNhZmVXaGVyZVxuICAgICAgfSk7XG4gICAgICBkZWJ1Z0xvZyhcbiAgICAgICAgeyBtZXRob2Q6IFwidXBkYXRlXCIgfSxcbiAgICAgICAgYCR7Zm9ybWF0VHJhbnNhY3Rpb25JZCh0aGlzVHJhbnNhY3Rpb25JZCl9ICR7Zm9ybWF0U3RlcCgxLCA0KX1gLFxuICAgICAgICBgJHtmb3JtYXRNZXRob2QoXCJ1cGRhdGVcIil9ICR7Zm9ybWF0QWN0aW9uKFwiVW5zYWZlIElucHV0XCIpfTpgLFxuICAgICAgICB7IG1vZGVsLCBkYXRhOiB1bnNhZmVEYXRhIH1cbiAgICAgICk7XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgdHJhbnNmb3JtSW5wdXQoXG4gICAgICAgIHVuc2FmZURhdGEsXG4gICAgICAgIHVuc2FmZU1vZGVsLFxuICAgICAgICBcInVwZGF0ZVwiXG4gICAgICApO1xuICAgICAgZGVidWdMb2coXG4gICAgICAgIHsgbWV0aG9kOiBcInVwZGF0ZVwiIH0sXG4gICAgICAgIGAke2Zvcm1hdFRyYW5zYWN0aW9uSWQodGhpc1RyYW5zYWN0aW9uSWQpfSAke2Zvcm1hdFN0ZXAoMiwgNCl9YCxcbiAgICAgICAgYCR7Zm9ybWF0TWV0aG9kKFwidXBkYXRlXCIpfSAke2Zvcm1hdEFjdGlvbihcIlBhcnNlZCBJbnB1dFwiKX06YCxcbiAgICAgICAgeyBtb2RlbCwgZGF0YSB9XG4gICAgICApO1xuICAgICAgY29uc3QgcmVzID0gYXdhaXQgYWRhcHRlckluc3RhbmNlLnVwZGF0ZSh7XG4gICAgICAgIG1vZGVsLFxuICAgICAgICB3aGVyZSxcbiAgICAgICAgdXBkYXRlOiBkYXRhXG4gICAgICB9KTtcbiAgICAgIGRlYnVnTG9nKFxuICAgICAgICB7IG1ldGhvZDogXCJ1cGRhdGVcIiB9LFxuICAgICAgICBgJHtmb3JtYXRUcmFuc2FjdGlvbklkKHRoaXNUcmFuc2FjdGlvbklkKX0gJHtmb3JtYXRTdGVwKDMsIDQpfWAsXG4gICAgICAgIGAke2Zvcm1hdE1ldGhvZChcInVwZGF0ZVwiKX0gJHtmb3JtYXRBY3Rpb24oXCJEQiBSZXN1bHRcIil9OmAsXG4gICAgICAgIHsgbW9kZWwsIGRhdGE6IHJlcyB9XG4gICAgICApO1xuICAgICAgY29uc3QgdHJhbnNmb3JtZWQgPSBhd2FpdCB0cmFuc2Zvcm1PdXRwdXQocmVzLCB1bnNhZmVNb2RlbCk7XG4gICAgICBkZWJ1Z0xvZyhcbiAgICAgICAgeyBtZXRob2Q6IFwidXBkYXRlXCIgfSxcbiAgICAgICAgYCR7Zm9ybWF0VHJhbnNhY3Rpb25JZCh0aGlzVHJhbnNhY3Rpb25JZCl9ICR7Zm9ybWF0U3RlcCg0LCA0KX1gLFxuICAgICAgICBgJHtmb3JtYXRNZXRob2QoXCJ1cGRhdGVcIil9ICR7Zm9ybWF0QWN0aW9uKFwiUGFyc2VkIFJlc3VsdFwiKX06YCxcbiAgICAgICAgeyBtb2RlbCwgZGF0YTogdHJhbnNmb3JtZWQgfVxuICAgICAgKTtcbiAgICAgIHJldHVybiB0cmFuc2Zvcm1lZDtcbiAgICB9LFxuICAgIHVwZGF0ZU1hbnk6IGFzeW5jICh7XG4gICAgICBtb2RlbDogdW5zYWZlTW9kZWwsXG4gICAgICB3aGVyZTogdW5zYWZlV2hlcmUsXG4gICAgICB1cGRhdGU6IHVuc2FmZURhdGFcbiAgICB9KSA9PiB7XG4gICAgICB0cmFuc2FjdGlvbklkKys7XG4gICAgICBsZXQgdGhpc1RyYW5zYWN0aW9uSWQgPSB0cmFuc2FjdGlvbklkO1xuICAgICAgY29uc3QgbW9kZWwgPSBnZXRNb2RlbE5hbWUodW5zYWZlTW9kZWwpO1xuICAgICAgY29uc3Qgd2hlcmUgPSB0cmFuc2Zvcm1XaGVyZUNsYXVzZSh7XG4gICAgICAgIG1vZGVsOiB1bnNhZmVNb2RlbCxcbiAgICAgICAgd2hlcmU6IHVuc2FmZVdoZXJlXG4gICAgICB9KTtcbiAgICAgIGRlYnVnTG9nKFxuICAgICAgICB7IG1ldGhvZDogXCJ1cGRhdGVNYW55XCIgfSxcbiAgICAgICAgYCR7Zm9ybWF0VHJhbnNhY3Rpb25JZCh0aGlzVHJhbnNhY3Rpb25JZCl9ICR7Zm9ybWF0U3RlcCgxLCA0KX1gLFxuICAgICAgICBgJHtmb3JtYXRNZXRob2QoXCJ1cGRhdGVNYW55XCIpfSAke2Zvcm1hdEFjdGlvbihcIlVuc2FmZSBJbnB1dFwiKX06YCxcbiAgICAgICAgeyBtb2RlbCwgZGF0YTogdW5zYWZlRGF0YSB9XG4gICAgICApO1xuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRyYW5zZm9ybUlucHV0KHVuc2FmZURhdGEsIHVuc2FmZU1vZGVsLCBcInVwZGF0ZVwiKTtcbiAgICAgIGRlYnVnTG9nKFxuICAgICAgICB7IG1ldGhvZDogXCJ1cGRhdGVNYW55XCIgfSxcbiAgICAgICAgYCR7Zm9ybWF0VHJhbnNhY3Rpb25JZCh0aGlzVHJhbnNhY3Rpb25JZCl9ICR7Zm9ybWF0U3RlcCgyLCA0KX1gLFxuICAgICAgICBgJHtmb3JtYXRNZXRob2QoXCJ1cGRhdGVNYW55XCIpfSAke2Zvcm1hdEFjdGlvbihcIlBhcnNlZCBJbnB1dFwiKX06YCxcbiAgICAgICAgeyBtb2RlbCwgZGF0YSB9XG4gICAgICApO1xuICAgICAgY29uc3QgdXBkYXRlZENvdW50ID0gYXdhaXQgYWRhcHRlckluc3RhbmNlLnVwZGF0ZU1hbnkoe1xuICAgICAgICBtb2RlbCxcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIHVwZGF0ZTogZGF0YVxuICAgICAgfSk7XG4gICAgICBkZWJ1Z0xvZyhcbiAgICAgICAgeyBtZXRob2Q6IFwidXBkYXRlTWFueVwiIH0sXG4gICAgICAgIGAke2Zvcm1hdFRyYW5zYWN0aW9uSWQodGhpc1RyYW5zYWN0aW9uSWQpfSAke2Zvcm1hdFN0ZXAoMywgNCl9YCxcbiAgICAgICAgYCR7Zm9ybWF0TWV0aG9kKFwidXBkYXRlTWFueVwiKX0gJHtmb3JtYXRBY3Rpb24oXCJEQiBSZXN1bHRcIil9OmAsXG4gICAgICAgIHsgbW9kZWwsIGRhdGE6IHVwZGF0ZWRDb3VudCB9XG4gICAgICApO1xuICAgICAgZGVidWdMb2coXG4gICAgICAgIHsgbWV0aG9kOiBcInVwZGF0ZU1hbnlcIiB9LFxuICAgICAgICBgJHtmb3JtYXRUcmFuc2FjdGlvbklkKHRoaXNUcmFuc2FjdGlvbklkKX0gJHtmb3JtYXRTdGVwKDQsIDQpfWAsXG4gICAgICAgIGAke2Zvcm1hdE1ldGhvZChcInVwZGF0ZU1hbnlcIil9ICR7Zm9ybWF0QWN0aW9uKFwiUGFyc2VkIFJlc3VsdFwiKX06YCxcbiAgICAgICAgeyBtb2RlbCwgZGF0YTogdXBkYXRlZENvdW50IH1cbiAgICAgICk7XG4gICAgICByZXR1cm4gdXBkYXRlZENvdW50O1xuICAgIH0sXG4gICAgZmluZE9uZTogYXN5bmMgKHtcbiAgICAgIG1vZGVsOiB1bnNhZmVNb2RlbCxcbiAgICAgIHdoZXJlOiB1bnNhZmVXaGVyZSxcbiAgICAgIHNlbGVjdFxuICAgIH0pID0+IHtcbiAgICAgIHRyYW5zYWN0aW9uSWQrKztcbiAgICAgIGxldCB0aGlzVHJhbnNhY3Rpb25JZCA9IHRyYW5zYWN0aW9uSWQ7XG4gICAgICBjb25zdCBtb2RlbCA9IGdldE1vZGVsTmFtZSh1bnNhZmVNb2RlbCk7XG4gICAgICBjb25zdCB3aGVyZSA9IHRyYW5zZm9ybVdoZXJlQ2xhdXNlKHtcbiAgICAgICAgbW9kZWw6IHVuc2FmZU1vZGVsLFxuICAgICAgICB3aGVyZTogdW5zYWZlV2hlcmVcbiAgICAgIH0pO1xuICAgICAgZGVidWdMb2coXG4gICAgICAgIHsgbWV0aG9kOiBcImZpbmRPbmVcIiB9LFxuICAgICAgICBgJHtmb3JtYXRUcmFuc2FjdGlvbklkKHRoaXNUcmFuc2FjdGlvbklkKX0gJHtmb3JtYXRTdGVwKDEsIDMpfWAsXG4gICAgICAgIGAke2Zvcm1hdE1ldGhvZChcImZpbmRPbmVcIil9OmAsXG4gICAgICAgIHsgbW9kZWwsIHdoZXJlLCBzZWxlY3QgfVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGFkYXB0ZXJJbnN0YW5jZS5maW5kT25lKHtcbiAgICAgICAgbW9kZWwsXG4gICAgICAgIHdoZXJlLFxuICAgICAgICBzZWxlY3RcbiAgICAgIH0pO1xuICAgICAgZGVidWdMb2coXG4gICAgICAgIHsgbWV0aG9kOiBcImZpbmRPbmVcIiB9LFxuICAgICAgICBgJHtmb3JtYXRUcmFuc2FjdGlvbklkKHRoaXNUcmFuc2FjdGlvbklkKX0gJHtmb3JtYXRTdGVwKDIsIDMpfWAsXG4gICAgICAgIGAke2Zvcm1hdE1ldGhvZChcImZpbmRPbmVcIil9ICR7Zm9ybWF0QWN0aW9uKFwiREIgUmVzdWx0XCIpfTpgLFxuICAgICAgICB7IG1vZGVsLCBkYXRhOiByZXMgfVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHRyYW5zZm9ybWVkID0gYXdhaXQgdHJhbnNmb3JtT3V0cHV0KFxuICAgICAgICByZXMsXG4gICAgICAgIHVuc2FmZU1vZGVsLFxuICAgICAgICBzZWxlY3RcbiAgICAgICk7XG4gICAgICBkZWJ1Z0xvZyhcbiAgICAgICAgeyBtZXRob2Q6IFwiZmluZE9uZVwiIH0sXG4gICAgICAgIGAke2Zvcm1hdFRyYW5zYWN0aW9uSWQodGhpc1RyYW5zYWN0aW9uSWQpfSAke2Zvcm1hdFN0ZXAoMywgMyl9YCxcbiAgICAgICAgYCR7Zm9ybWF0TWV0aG9kKFwiZmluZE9uZVwiKX0gJHtmb3JtYXRBY3Rpb24oXCJQYXJzZWQgUmVzdWx0XCIpfTpgLFxuICAgICAgICB7IG1vZGVsLCBkYXRhOiB0cmFuc2Zvcm1lZCB9XG4gICAgICApO1xuICAgICAgcmV0dXJuIHRyYW5zZm9ybWVkO1xuICAgIH0sXG4gICAgZmluZE1hbnk6IGFzeW5jICh7XG4gICAgICBtb2RlbDogdW5zYWZlTW9kZWwsXG4gICAgICB3aGVyZTogdW5zYWZlV2hlcmUsXG4gICAgICBsaW1pdDogdW5zYWZlTGltaXQsXG4gICAgICBzb3J0QnksXG4gICAgICBvZmZzZXRcbiAgICB9KSA9PiB7XG4gICAgICB0cmFuc2FjdGlvbklkKys7XG4gICAgICBsZXQgdGhpc1RyYW5zYWN0aW9uSWQgPSB0cmFuc2FjdGlvbklkO1xuICAgICAgY29uc3QgbGltaXQgPSB1bnNhZmVMaW1pdCA/PyBvcHRpb25zLmFkdmFuY2VkPy5kYXRhYmFzZT8uZGVmYXVsdEZpbmRNYW55TGltaXQgPz8gMTAwO1xuICAgICAgY29uc3QgbW9kZWwgPSBnZXRNb2RlbE5hbWUodW5zYWZlTW9kZWwpO1xuICAgICAgY29uc3Qgd2hlcmUgPSB0cmFuc2Zvcm1XaGVyZUNsYXVzZSh7XG4gICAgICAgIG1vZGVsOiB1bnNhZmVNb2RlbCxcbiAgICAgICAgd2hlcmU6IHVuc2FmZVdoZXJlXG4gICAgICB9KTtcbiAgICAgIGRlYnVnTG9nKFxuICAgICAgICB7IG1ldGhvZDogXCJmaW5kTWFueVwiIH0sXG4gICAgICAgIGAke2Zvcm1hdFRyYW5zYWN0aW9uSWQodGhpc1RyYW5zYWN0aW9uSWQpfSAke2Zvcm1hdFN0ZXAoMSwgMyl9YCxcbiAgICAgICAgYCR7Zm9ybWF0TWV0aG9kKFwiZmluZE1hbnlcIil9OmAsXG4gICAgICAgIHsgbW9kZWwsIHdoZXJlLCBsaW1pdCwgc29ydEJ5LCBvZmZzZXQgfVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGFkYXB0ZXJJbnN0YW5jZS5maW5kTWFueSh7XG4gICAgICAgIG1vZGVsLFxuICAgICAgICB3aGVyZSxcbiAgICAgICAgbGltaXQsXG4gICAgICAgIHNvcnRCeSxcbiAgICAgICAgb2Zmc2V0XG4gICAgICB9KTtcbiAgICAgIGRlYnVnTG9nKFxuICAgICAgICB7IG1ldGhvZDogXCJmaW5kTWFueVwiIH0sXG4gICAgICAgIGAke2Zvcm1hdFRyYW5zYWN0aW9uSWQodGhpc1RyYW5zYWN0aW9uSWQpfSAke2Zvcm1hdFN0ZXAoMiwgMyl9YCxcbiAgICAgICAgYCR7Zm9ybWF0TWV0aG9kKFwiZmluZE1hbnlcIil9ICR7Zm9ybWF0QWN0aW9uKFwiREIgUmVzdWx0XCIpfTpgLFxuICAgICAgICB7IG1vZGVsLCBkYXRhOiByZXMgfVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHRyYW5zZm9ybWVkID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICAgIHJlcy5tYXAoYXN5bmMgKHIpID0+IGF3YWl0IHRyYW5zZm9ybU91dHB1dChyLCB1bnNhZmVNb2RlbCkpXG4gICAgICApO1xuICAgICAgZGVidWdMb2coXG4gICAgICAgIHsgbWV0aG9kOiBcImZpbmRNYW55XCIgfSxcbiAgICAgICAgYCR7Zm9ybWF0VHJhbnNhY3Rpb25JZCh0aGlzVHJhbnNhY3Rpb25JZCl9ICR7Zm9ybWF0U3RlcCgzLCAzKX1gLFxuICAgICAgICBgJHtmb3JtYXRNZXRob2QoXCJmaW5kTWFueVwiKX0gJHtmb3JtYXRBY3Rpb24oXCJQYXJzZWQgUmVzdWx0XCIpfTpgLFxuICAgICAgICB7IG1vZGVsLCBkYXRhOiB0cmFuc2Zvcm1lZCB9XG4gICAgICApO1xuICAgICAgcmV0dXJuIHRyYW5zZm9ybWVkO1xuICAgIH0sXG4gICAgZGVsZXRlOiBhc3luYyAoe1xuICAgICAgbW9kZWw6IHVuc2FmZU1vZGVsLFxuICAgICAgd2hlcmU6IHVuc2FmZVdoZXJlXG4gICAgfSkgPT4ge1xuICAgICAgdHJhbnNhY3Rpb25JZCsrO1xuICAgICAgbGV0IHRoaXNUcmFuc2FjdGlvbklkID0gdHJhbnNhY3Rpb25JZDtcbiAgICAgIGNvbnN0IG1vZGVsID0gZ2V0TW9kZWxOYW1lKHVuc2FmZU1vZGVsKTtcbiAgICAgIGNvbnN0IHdoZXJlID0gdHJhbnNmb3JtV2hlcmVDbGF1c2Uoe1xuICAgICAgICBtb2RlbDogdW5zYWZlTW9kZWwsXG4gICAgICAgIHdoZXJlOiB1bnNhZmVXaGVyZVxuICAgICAgfSk7XG4gICAgICBkZWJ1Z0xvZyhcbiAgICAgICAgeyBtZXRob2Q6IFwiZGVsZXRlXCIgfSxcbiAgICAgICAgYCR7Zm9ybWF0VHJhbnNhY3Rpb25JZCh0aGlzVHJhbnNhY3Rpb25JZCl9ICR7Zm9ybWF0U3RlcCgxLCAyKX1gLFxuICAgICAgICBgJHtmb3JtYXRNZXRob2QoXCJkZWxldGVcIil9OmAsXG4gICAgICAgIHsgbW9kZWwsIHdoZXJlIH1cbiAgICAgICk7XG4gICAgICBhd2FpdCBhZGFwdGVySW5zdGFuY2UuZGVsZXRlKHtcbiAgICAgICAgbW9kZWwsXG4gICAgICAgIHdoZXJlXG4gICAgICB9KTtcbiAgICAgIGRlYnVnTG9nKFxuICAgICAgICB7IG1ldGhvZDogXCJkZWxldGVcIiB9LFxuICAgICAgICBgJHtmb3JtYXRUcmFuc2FjdGlvbklkKHRoaXNUcmFuc2FjdGlvbklkKX0gJHtmb3JtYXRTdGVwKDIsIDIpfWAsXG4gICAgICAgIGAke2Zvcm1hdE1ldGhvZChcImRlbGV0ZVwiKX0gJHtmb3JtYXRBY3Rpb24oXCJEQiBSZXN1bHRcIil9OmAsXG4gICAgICAgIHsgbW9kZWwgfVxuICAgICAgKTtcbiAgICB9LFxuICAgIGRlbGV0ZU1hbnk6IGFzeW5jICh7XG4gICAgICBtb2RlbDogdW5zYWZlTW9kZWwsXG4gICAgICB3aGVyZTogdW5zYWZlV2hlcmVcbiAgICB9KSA9PiB7XG4gICAgICB0cmFuc2FjdGlvbklkKys7XG4gICAgICBsZXQgdGhpc1RyYW5zYWN0aW9uSWQgPSB0cmFuc2FjdGlvbklkO1xuICAgICAgY29uc3QgbW9kZWwgPSBnZXRNb2RlbE5hbWUodW5zYWZlTW9kZWwpO1xuICAgICAgY29uc3Qgd2hlcmUgPSB0cmFuc2Zvcm1XaGVyZUNsYXVzZSh7XG4gICAgICAgIG1vZGVsOiB1bnNhZmVNb2RlbCxcbiAgICAgICAgd2hlcmU6IHVuc2FmZVdoZXJlXG4gICAgICB9KTtcbiAgICAgIGRlYnVnTG9nKFxuICAgICAgICB7IG1ldGhvZDogXCJkZWxldGVNYW55XCIgfSxcbiAgICAgICAgYCR7Zm9ybWF0VHJhbnNhY3Rpb25JZCh0aGlzVHJhbnNhY3Rpb25JZCl9ICR7Zm9ybWF0U3RlcCgxLCAyKX1gLFxuICAgICAgICBgJHtmb3JtYXRNZXRob2QoXCJkZWxldGVNYW55XCIpfSAke2Zvcm1hdEFjdGlvbihcIkRlbGV0ZU1hbnlcIil9OmAsXG4gICAgICAgIHsgbW9kZWwsIHdoZXJlIH1cbiAgICAgICk7XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBhZGFwdGVySW5zdGFuY2UuZGVsZXRlTWFueSh7XG4gICAgICAgIG1vZGVsLFxuICAgICAgICB3aGVyZVxuICAgICAgfSk7XG4gICAgICBkZWJ1Z0xvZyhcbiAgICAgICAgeyBtZXRob2Q6IFwiZGVsZXRlTWFueVwiIH0sXG4gICAgICAgIGAke2Zvcm1hdFRyYW5zYWN0aW9uSWQodGhpc1RyYW5zYWN0aW9uSWQpfSAke2Zvcm1hdFN0ZXAoMiwgMil9YCxcbiAgICAgICAgYCR7Zm9ybWF0TWV0aG9kKFwiZGVsZXRlTWFueVwiKX0gJHtmb3JtYXRBY3Rpb24oXCJEQiBSZXN1bHRcIil9OmAsXG4gICAgICAgIHsgbW9kZWwsIGRhdGE6IHJlcyB9XG4gICAgICApO1xuICAgICAgcmV0dXJuIHJlcztcbiAgICB9LFxuICAgIGNvdW50OiBhc3luYyAoe1xuICAgICAgbW9kZWw6IHVuc2FmZU1vZGVsLFxuICAgICAgd2hlcmU6IHVuc2FmZVdoZXJlXG4gICAgfSkgPT4ge1xuICAgICAgdHJhbnNhY3Rpb25JZCsrO1xuICAgICAgbGV0IHRoaXNUcmFuc2FjdGlvbklkID0gdHJhbnNhY3Rpb25JZDtcbiAgICAgIGNvbnN0IG1vZGVsID0gZ2V0TW9kZWxOYW1lKHVuc2FmZU1vZGVsKTtcbiAgICAgIGNvbnN0IHdoZXJlID0gdHJhbnNmb3JtV2hlcmVDbGF1c2Uoe1xuICAgICAgICBtb2RlbDogdW5zYWZlTW9kZWwsXG4gICAgICAgIHdoZXJlOiB1bnNhZmVXaGVyZVxuICAgICAgfSk7XG4gICAgICBkZWJ1Z0xvZyhcbiAgICAgICAgeyBtZXRob2Q6IFwiY291bnRcIiB9LFxuICAgICAgICBgJHtmb3JtYXRUcmFuc2FjdGlvbklkKHRoaXNUcmFuc2FjdGlvbklkKX0gJHtmb3JtYXRTdGVwKDEsIDIpfWAsXG4gICAgICAgIGAke2Zvcm1hdE1ldGhvZChcImNvdW50XCIpfTpgLFxuICAgICAgICB7XG4gICAgICAgICAgbW9kZWwsXG4gICAgICAgICAgd2hlcmVcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGFkYXB0ZXJJbnN0YW5jZS5jb3VudCh7XG4gICAgICAgIG1vZGVsLFxuICAgICAgICB3aGVyZVxuICAgICAgfSk7XG4gICAgICBkZWJ1Z0xvZyhcbiAgICAgICAgeyBtZXRob2Q6IFwiY291bnRcIiB9LFxuICAgICAgICBgJHtmb3JtYXRUcmFuc2FjdGlvbklkKHRoaXNUcmFuc2FjdGlvbklkKX0gJHtmb3JtYXRTdGVwKDIsIDIpfWAsXG4gICAgICAgIGAke2Zvcm1hdE1ldGhvZChcImNvdW50XCIpfTpgLFxuICAgICAgICB7XG4gICAgICAgICAgbW9kZWwsXG4gICAgICAgICAgZGF0YTogcmVzXG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICByZXR1cm4gcmVzO1xuICAgIH0sXG4gICAgY3JlYXRlU2NoZW1hOiBhZGFwdGVySW5zdGFuY2UuY3JlYXRlU2NoZW1hID8gYXN5bmMgKF8sIGZpbGUpID0+IHtcbiAgICAgIGNvbnN0IHRhYmxlcyA9IGdldEF1dGhUYWJsZXMob3B0aW9ucyk7XG4gICAgICBpZiAob3B0aW9ucy5zZWNvbmRhcnlTdG9yYWdlICYmICFvcHRpb25zLnNlc3Npb24/LnN0b3JlU2Vzc2lvbkluRGF0YWJhc2UpIHtcbiAgICAgICAgZGVsZXRlIHRhYmxlcy5zZXNzaW9uO1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMucmF0ZUxpbWl0ICYmIG9wdGlvbnMucmF0ZUxpbWl0LnN0b3JhZ2UgPT09IFwiZGF0YWJhc2VcIiAmJiAvLyByYXRlLWxpbWl0IHdpbGwgZGVmYXVsdCB0byBlbmFibGVkIGluIHByb2R1Y3Rpb24sXG4gICAgICAvLyBhbmQgZ2l2ZW4gc3RvcmFnZSBpcyBkYXRhYmFzZSwgaXQgd2lsbCB0cnkgdG8gdXNlIHRoZSByYXRlLWxpbWl0IHRhYmxlLFxuICAgICAgLy8gc28gd2Ugc2hvdWxkIG1ha2Ugc3VyZSB0byBnZW5lcmF0ZSByYXRlLWxpbWl0IHRhYmxlIHNjaGVtYVxuICAgICAgKHR5cGVvZiBvcHRpb25zLnJhdGVMaW1pdC5lbmFibGVkID09PSBcInVuZGVmaW5lZFwiIHx8IC8vIGFuZCBvZiBjb3Vyc2UgaWYgdGhleSBmb3JjZWZ1bGx5IHNldCB0byB0cnVlLCB0aGVuIHRoZXkgd2FudCByYXRlLWxpbWl0LFxuICAgICAgLy8gdGh1cyB3ZSBzaG91bGQgYWxzbyBnZW5lcmF0ZSByYXRlLWxpbWl0IHRhYmxlIHNjaGVtYVxuICAgICAgb3B0aW9ucy5yYXRlTGltaXQuZW5hYmxlZCA9PT0gdHJ1ZSkpIHtcbiAgICAgICAgdGFibGVzLnJhdGVsaW1pdCA9IHtcbiAgICAgICAgICBtb2RlbE5hbWU6IG9wdGlvbnMucmF0ZUxpbWl0Lm1vZGVsTmFtZSA/PyBcInJhdGVsaW1pdFwiLFxuICAgICAgICAgIGZpZWxkczoge1xuICAgICAgICAgICAga2V5OiB7XG4gICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgIHVuaXF1ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICAgIGZpZWxkTmFtZTogb3B0aW9ucy5yYXRlTGltaXQuZmllbGRzPy5rZXkgPz8gXCJrZXlcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvdW50OiB7XG4gICAgICAgICAgICAgIHR5cGU6IFwibnVtYmVyXCIsXG4gICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMucmF0ZUxpbWl0LmZpZWxkcz8uY291bnQgPz8gXCJjb3VudFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGFzdFJlcXVlc3Q6IHtcbiAgICAgICAgICAgICAgdHlwZTogXCJudW1iZXJcIixcbiAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICAgIGJpZ2ludDogdHJ1ZSxcbiAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAoKSA9PiBEYXRlLm5vdygpLFxuICAgICAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMucmF0ZUxpbWl0LmZpZWxkcz8ubGFzdFJlcXVlc3QgPz8gXCJsYXN0UmVxdWVzdFwiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIGFkYXB0ZXJJbnN0YW5jZS5jcmVhdGVTY2hlbWEoeyBmaWxlLCB0YWJsZXMgfSk7XG4gICAgfSA6IHZvaWQgMCxcbiAgICBvcHRpb25zOiB7XG4gICAgICBhZGFwdGVyQ29uZmlnOiBjb25maWcsXG4gICAgICAuLi5hZGFwdGVySW5zdGFuY2Uub3B0aW9ucyA/PyB7fVxuICAgIH0sXG4gICAgaWQ6IGNvbmZpZy5hZGFwdGVySWQsXG4gICAgLy8gU2VjcmV0bHkgZXhwb3J0IHZhbHVlcyBPTkxZIGlmIHRoaXMgYWRhcHRlciBoYXMgZW5hYmxlZCBhZGFwdGVyLXRlc3QtZGVidWctbG9ncy5cbiAgICAvLyBUaGlzIHdvdWxkIHRoZW4gYmUgdXNlZCBkdXJpbmcgb3VyIGFkYXB0ZXItdGVzdHMgdG8gaGVscCBwcmludCBkZWJ1ZyBsb2dzIGlmIGEgdGVzdCBmYWlscy5cbiAgICAvL0B0cy1leHBlY3QtZXJyb3IgLSBeXlxuICAgIC4uLmNvbmZpZy5kZWJ1Z0xvZ3M/LmlzUnVubmluZ0FkYXB0ZXJUZXN0cyA/IHtcbiAgICAgIGFkYXB0ZXJUZXN0RGVidWdMb2dzOiB7XG4gICAgICAgIHJlc2V0RGVidWdMb2dzKCkge1xuICAgICAgICAgIGRlYnVnTG9ncyA9IFtdO1xuICAgICAgICB9LFxuICAgICAgICBwcmludERlYnVnTG9ncygpIHtcbiAgICAgICAgICBjb25zdCBzZXBhcmF0b3IgPSBgXFx1MjUwMGAucmVwZWF0KDgwKTtcbiAgICAgICAgICBsZXQgbG9nID0gZGVidWdMb2dzLnJldmVyc2UoKS5tYXAoKGxvZzIpID0+IHtcbiAgICAgICAgICAgIGxvZzJbMF0gPSBgXG4ke2xvZzJbMF19YDtcbiAgICAgICAgICAgIHJldHVybiBbLi4ubG9nMiwgXCJcXG5cIl07XG4gICAgICAgICAgfSkucmVkdWNlKFxuICAgICAgICAgICAgKHByZXYsIGN1cnIpID0+IHtcbiAgICAgICAgICAgICAgcmV0dXJuIFsuLi5jdXJyLCAuLi5wcmV2XTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBbYFxuJHtzZXBhcmF0b3J9YF1cbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnNvbGUubG9nKC4uLmxvZyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IDoge31cbiAgfTtcbn07XG5mdW5jdGlvbiBmb3JtYXRUcmFuc2FjdGlvbklkKHRyYW5zYWN0aW9uSWQyKSB7XG4gIHJldHVybiBgJHtjb2xvcnMuZmcubWFnZW50YX0jJHt0cmFuc2FjdGlvbklkMn0ke2NvbG9ycy5yZXNldH1gO1xufVxuZnVuY3Rpb24gZm9ybWF0U3RlcChzdGVwLCB0b3RhbCkge1xuICByZXR1cm4gYCR7Y29sb3JzLmJnLmJsYWNrfSR7Y29sb3JzLmZnLnllbGxvd31bJHtzdGVwfS8ke3RvdGFsfV0ke2NvbG9ycy5yZXNldH1gO1xufVxuZnVuY3Rpb24gZm9ybWF0TWV0aG9kKG1ldGhvZCkge1xuICByZXR1cm4gYCR7Y29sb3JzLmJyaWdodH0ke21ldGhvZH0ke2NvbG9ycy5yZXNldH1gO1xufVxuZnVuY3Rpb24gZm9ybWF0QWN0aW9uKGFjdGlvbikge1xuICByZXR1cm4gYCR7Y29sb3JzLmRpbX0oJHthY3Rpb259KSR7Y29sb3JzLnJlc2V0fWA7XG59XG5cbmV4cG9ydCB7IGNyZWF0ZUFkYXB0ZXIgYXMgYyB9O1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.gBl3F_xa.mjs\n");

/***/ }),

/***/ "(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.n2KFGwjY.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.n2KFGwjY.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   a: () => (/* binding */ accountSchema),\n/* harmony export */   b: () => (/* binding */ parseUserOutput),\n/* harmony export */   c: () => (/* binding */ parseAccountOutput),\n/* harmony export */   d: () => (/* binding */ parseSessionOutput),\n/* harmony export */   e: () => (/* binding */ parseInputData),\n/* harmony export */   f: () => (/* binding */ parseUserInput),\n/* harmony export */   g: () => (/* binding */ getAllFields),\n/* harmony export */   h: () => (/* binding */ parseAdditionalUserInput),\n/* harmony export */   i: () => (/* binding */ parseAccountInput),\n/* harmony export */   j: () => (/* binding */ parseSessionInput),\n/* harmony export */   m: () => (/* binding */ mergeSchema),\n/* harmony export */   p: () => (/* binding */ parseOutputData),\n/* harmony export */   s: () => (/* binding */ sessionSchema),\n/* harmony export */   u: () => (/* binding */ userSchema),\n/* harmony export */   v: () => (/* binding */ verificationSchema)\n/* harmony export */ });\n/* harmony import */ var zod_v4__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! zod/v4 */ \"(action-browser)/../../node_modules/zod/v4/classic/schemas.js\");\n/* harmony import */ var zod_v4__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! zod/v4 */ \"(action-browser)/../../node_modules/zod/v4/classic/coerce.js\");\n/* harmony import */ var better_call__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! better-call */ \"(action-browser)/../../node_modules/better-call/dist/index.js\");\n\n\n\nconst accountSchema = zod_v4__WEBPACK_IMPORTED_MODULE_1__.object({\n  id: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string(),\n  providerId: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string(),\n  accountId: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string(),\n  userId: zod_v4__WEBPACK_IMPORTED_MODULE_2__.string(),\n  accessToken: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string().nullish(),\n  refreshToken: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string().nullish(),\n  idToken: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string().nullish(),\n  /**\n   * Access token expires at\n   */\n  accessTokenExpiresAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date().nullish(),\n  /**\n   * Refresh token expires at\n   */\n  refreshTokenExpiresAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date().nullish(),\n  /**\n   * The scopes that the user has authorized\n   */\n  scope: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string().nullish(),\n  /**\n   * Password is only stored in the credential provider\n   */\n  password: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string().nullish(),\n  createdAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date().default(() => /* @__PURE__ */ new Date()),\n  updatedAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date().default(() => /* @__PURE__ */ new Date())\n});\nconst userSchema = zod_v4__WEBPACK_IMPORTED_MODULE_1__.object({\n  id: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string(),\n  email: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string().transform((val) => val.toLowerCase()),\n  emailVerified: zod_v4__WEBPACK_IMPORTED_MODULE_1__.boolean().default(false),\n  name: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string(),\n  image: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string().nullish(),\n  createdAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date().default(() => /* @__PURE__ */ new Date()),\n  updatedAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date().default(() => /* @__PURE__ */ new Date())\n});\nconst sessionSchema = zod_v4__WEBPACK_IMPORTED_MODULE_1__.object({\n  id: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string(),\n  userId: zod_v4__WEBPACK_IMPORTED_MODULE_2__.string(),\n  expiresAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date(),\n  createdAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date().default(() => /* @__PURE__ */ new Date()),\n  updatedAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date().default(() => /* @__PURE__ */ new Date()),\n  token: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string(),\n  ipAddress: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string().nullish(),\n  userAgent: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string().nullish()\n});\nconst verificationSchema = zod_v4__WEBPACK_IMPORTED_MODULE_1__.object({\n  id: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string(),\n  value: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string(),\n  createdAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date().default(() => /* @__PURE__ */ new Date()),\n  updatedAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date().default(() => /* @__PURE__ */ new Date()),\n  expiresAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date(),\n  identifier: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string()\n});\nfunction parseOutputData(data, schema) {\n  const fields = schema.fields;\n  const parsedData = {};\n  for (const key in data) {\n    const field = fields[key];\n    if (!field) {\n      parsedData[key] = data[key];\n      continue;\n    }\n    if (field.returned === false) {\n      continue;\n    }\n    parsedData[key] = data[key];\n  }\n  return parsedData;\n}\nfunction getAllFields(options, table) {\n  let schema = {\n    ...table === \"user\" ? options.user?.additionalFields : {},\n    ...table === \"session\" ? options.session?.additionalFields : {}\n  };\n  for (const plugin of options.plugins || []) {\n    if (plugin.schema && plugin.schema[table]) {\n      schema = {\n        ...schema,\n        ...plugin.schema[table].fields\n      };\n    }\n  }\n  return schema;\n}\nfunction parseUserOutput(options, user) {\n  const schema = getAllFields(options, \"user\");\n  return parseOutputData(user, { fields: schema });\n}\nfunction parseAccountOutput(options, account) {\n  const schema = getAllFields(options, \"account\");\n  return parseOutputData(account, { fields: schema });\n}\nfunction parseSessionOutput(options, session) {\n  const schema = getAllFields(options, \"session\");\n  return parseOutputData(session, { fields: schema });\n}\nfunction parseInputData(data, schema) {\n  const action = schema.action || \"create\";\n  const fields = schema.fields;\n  const parsedData = {};\n  for (const key in fields) {\n    if (key in data) {\n      if (fields[key].input === false) {\n        if (fields[key].defaultValue) {\n          parsedData[key] = fields[key].defaultValue;\n          continue;\n        }\n        continue;\n      }\n      if (fields[key].validator?.input && data[key] !== void 0) {\n        parsedData[key] = fields[key].validator.input.parse(data[key]);\n        continue;\n      }\n      if (fields[key].transform?.input && data[key] !== void 0) {\n        parsedData[key] = fields[key].transform?.input(data[key]);\n        continue;\n      }\n      parsedData[key] = data[key];\n      continue;\n    }\n    if (fields[key].defaultValue && action === \"create\") {\n      parsedData[key] = fields[key].defaultValue;\n      continue;\n    }\n    if (fields[key].required && action === \"create\") {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: `${key} is required`\n      });\n    }\n  }\n  return parsedData;\n}\nfunction parseUserInput(options, user, action) {\n  const schema = getAllFields(options, \"user\");\n  return parseInputData(user || {}, { fields: schema, action });\n}\nfunction parseAdditionalUserInput(options, user) {\n  const schema = getAllFields(options, \"user\");\n  return parseInputData(user || {}, { fields: schema });\n}\nfunction parseAccountInput(options, account) {\n  const schema = getAllFields(options, \"account\");\n  return parseInputData(account, { fields: schema });\n}\nfunction parseSessionInput(options, session) {\n  const schema = getAllFields(options, \"session\");\n  return parseInputData(session, { fields: schema });\n}\nfunction mergeSchema(schema, newSchema) {\n  if (!newSchema) {\n    return schema;\n  }\n  for (const table in newSchema) {\n    const newModelName = newSchema[table]?.modelName;\n    if (newModelName) {\n      schema[table].modelName = newModelName;\n    }\n    for (const field in schema[table].fields) {\n      const newField = newSchema[table]?.fields?.[field];\n      if (!newField) {\n        continue;\n      }\n      schema[table].fields[field].fieldName = newField;\n    }\n  }\n  return schema;\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGgubjJLRkd3alkubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUE0QjtBQUNXOztBQUV2QyxzQkFBc0IsMENBQVE7QUFDOUIsTUFBTSwwQ0FBUTtBQUNkLGNBQWMsMENBQVE7QUFDdEIsYUFBYSwwQ0FBUTtBQUNyQixVQUFVLDBDQUFlO0FBQ3pCLGVBQWUsMENBQVE7QUFDdkIsZ0JBQWdCLDBDQUFRO0FBQ3hCLFdBQVcsMENBQVE7QUFDbkI7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHdDQUFNO0FBQzlCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5Qix3Q0FBTTtBQUMvQjtBQUNBO0FBQ0E7QUFDQSxTQUFTLDBDQUFRO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLFlBQVksMENBQVE7QUFDcEIsYUFBYSx3Q0FBTTtBQUNuQixhQUFhLHdDQUFNO0FBQ25CLENBQUM7QUFDRCxtQkFBbUIsMENBQVE7QUFDM0IsTUFBTSwwQ0FBUTtBQUNkLFNBQVMsMENBQVE7QUFDakIsaUJBQWlCLDJDQUFTO0FBQzFCLFFBQVEsMENBQVE7QUFDaEIsU0FBUywwQ0FBUTtBQUNqQixhQUFhLHdDQUFNO0FBQ25CLGFBQWEsd0NBQU07QUFDbkIsQ0FBQztBQUNELHNCQUFzQiwwQ0FBUTtBQUM5QixNQUFNLDBDQUFRO0FBQ2QsVUFBVSwwQ0FBZTtBQUN6QixhQUFhLHdDQUFNO0FBQ25CLGFBQWEsd0NBQU07QUFDbkIsYUFBYSx3Q0FBTTtBQUNuQixTQUFTLDBDQUFRO0FBQ2pCLGFBQWEsMENBQVE7QUFDckIsYUFBYSwwQ0FBUTtBQUNyQixDQUFDO0FBQ0QsMkJBQTJCLDBDQUFRO0FBQ25DLE1BQU0sMENBQVE7QUFDZCxTQUFTLDBDQUFRO0FBQ2pCLGFBQWEsd0NBQU07QUFDbkIsYUFBYSx3Q0FBTTtBQUNuQixhQUFhLHdDQUFNO0FBQ25CLGNBQWMsMENBQVE7QUFDdEIsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZEQUE2RDtBQUM3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLGdCQUFnQjtBQUNqRDtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsZ0JBQWdCO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxnQkFBZ0I7QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCLG9CQUFvQixLQUFLO0FBQ3pCLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsSUFBSSx3QkFBd0I7QUFDOUQ7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLElBQUksZ0JBQWdCO0FBQ3REO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxnQkFBZ0I7QUFDbkQ7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLGdCQUFnQjtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUV3ViIsInNvdXJjZXMiOlsiL1VzZXJzL21pbGFuL0Rlc2t0b3AvQXBwcy9iZXR0ZXItYXV0aC9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGgubjJLRkd3alkubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHogZnJvbSAnem9kL3Y0JztcbmltcG9ydCB7IEFQSUVycm9yIH0gZnJvbSAnYmV0dGVyLWNhbGwnO1xuXG5jb25zdCBhY2NvdW50U2NoZW1hID0gei5vYmplY3Qoe1xuICBpZDogei5zdHJpbmcoKSxcbiAgcHJvdmlkZXJJZDogei5zdHJpbmcoKSxcbiAgYWNjb3VudElkOiB6LnN0cmluZygpLFxuICB1c2VySWQ6IHouY29lcmNlLnN0cmluZygpLFxuICBhY2Nlc3NUb2tlbjogei5zdHJpbmcoKS5udWxsaXNoKCksXG4gIHJlZnJlc2hUb2tlbjogei5zdHJpbmcoKS5udWxsaXNoKCksXG4gIGlkVG9rZW46IHouc3RyaW5nKCkubnVsbGlzaCgpLFxuICAvKipcbiAgICogQWNjZXNzIHRva2VuIGV4cGlyZXMgYXRcbiAgICovXG4gIGFjY2Vzc1Rva2VuRXhwaXJlc0F0OiB6LmRhdGUoKS5udWxsaXNoKCksXG4gIC8qKlxuICAgKiBSZWZyZXNoIHRva2VuIGV4cGlyZXMgYXRcbiAgICovXG4gIHJlZnJlc2hUb2tlbkV4cGlyZXNBdDogei5kYXRlKCkubnVsbGlzaCgpLFxuICAvKipcbiAgICogVGhlIHNjb3BlcyB0aGF0IHRoZSB1c2VyIGhhcyBhdXRob3JpemVkXG4gICAqL1xuICBzY29wZTogei5zdHJpbmcoKS5udWxsaXNoKCksXG4gIC8qKlxuICAgKiBQYXNzd29yZCBpcyBvbmx5IHN0b3JlZCBpbiB0aGUgY3JlZGVudGlhbCBwcm92aWRlclxuICAgKi9cbiAgcGFzc3dvcmQ6IHouc3RyaW5nKCkubnVsbGlzaCgpLFxuICBjcmVhdGVkQXQ6IHouZGF0ZSgpLmRlZmF1bHQoKCkgPT4gLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCkpLFxuICB1cGRhdGVkQXQ6IHouZGF0ZSgpLmRlZmF1bHQoKCkgPT4gLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCkpXG59KTtcbmNvbnN0IHVzZXJTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIGlkOiB6LnN0cmluZygpLFxuICBlbWFpbDogei5zdHJpbmcoKS50cmFuc2Zvcm0oKHZhbCkgPT4gdmFsLnRvTG93ZXJDYXNlKCkpLFxuICBlbWFpbFZlcmlmaWVkOiB6LmJvb2xlYW4oKS5kZWZhdWx0KGZhbHNlKSxcbiAgbmFtZTogei5zdHJpbmcoKSxcbiAgaW1hZ2U6IHouc3RyaW5nKCkubnVsbGlzaCgpLFxuICBjcmVhdGVkQXQ6IHouZGF0ZSgpLmRlZmF1bHQoKCkgPT4gLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCkpLFxuICB1cGRhdGVkQXQ6IHouZGF0ZSgpLmRlZmF1bHQoKCkgPT4gLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCkpXG59KTtcbmNvbnN0IHNlc3Npb25TY2hlbWEgPSB6Lm9iamVjdCh7XG4gIGlkOiB6LnN0cmluZygpLFxuICB1c2VySWQ6IHouY29lcmNlLnN0cmluZygpLFxuICBleHBpcmVzQXQ6IHouZGF0ZSgpLFxuICBjcmVhdGVkQXQ6IHouZGF0ZSgpLmRlZmF1bHQoKCkgPT4gLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCkpLFxuICB1cGRhdGVkQXQ6IHouZGF0ZSgpLmRlZmF1bHQoKCkgPT4gLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCkpLFxuICB0b2tlbjogei5zdHJpbmcoKSxcbiAgaXBBZGRyZXNzOiB6LnN0cmluZygpLm51bGxpc2goKSxcbiAgdXNlckFnZW50OiB6LnN0cmluZygpLm51bGxpc2goKVxufSk7XG5jb25zdCB2ZXJpZmljYXRpb25TY2hlbWEgPSB6Lm9iamVjdCh7XG4gIGlkOiB6LnN0cmluZygpLFxuICB2YWx1ZTogei5zdHJpbmcoKSxcbiAgY3JlYXRlZEF0OiB6LmRhdGUoKS5kZWZhdWx0KCgpID0+IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpKSxcbiAgdXBkYXRlZEF0OiB6LmRhdGUoKS5kZWZhdWx0KCgpID0+IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpKSxcbiAgZXhwaXJlc0F0OiB6LmRhdGUoKSxcbiAgaWRlbnRpZmllcjogei5zdHJpbmcoKVxufSk7XG5mdW5jdGlvbiBwYXJzZU91dHB1dERhdGEoZGF0YSwgc2NoZW1hKSB7XG4gIGNvbnN0IGZpZWxkcyA9IHNjaGVtYS5maWVsZHM7XG4gIGNvbnN0IHBhcnNlZERhdGEgPSB7fTtcbiAgZm9yIChjb25zdCBrZXkgaW4gZGF0YSkge1xuICAgIGNvbnN0IGZpZWxkID0gZmllbGRzW2tleV07XG4gICAgaWYgKCFmaWVsZCkge1xuICAgICAgcGFyc2VkRGF0YVtrZXldID0gZGF0YVtrZXldO1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGlmIChmaWVsZC5yZXR1cm5lZCA9PT0gZmFsc2UpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBwYXJzZWREYXRhW2tleV0gPSBkYXRhW2tleV07XG4gIH1cbiAgcmV0dXJuIHBhcnNlZERhdGE7XG59XG5mdW5jdGlvbiBnZXRBbGxGaWVsZHMob3B0aW9ucywgdGFibGUpIHtcbiAgbGV0IHNjaGVtYSA9IHtcbiAgICAuLi50YWJsZSA9PT0gXCJ1c2VyXCIgPyBvcHRpb25zLnVzZXI/LmFkZGl0aW9uYWxGaWVsZHMgOiB7fSxcbiAgICAuLi50YWJsZSA9PT0gXCJzZXNzaW9uXCIgPyBvcHRpb25zLnNlc3Npb24/LmFkZGl0aW9uYWxGaWVsZHMgOiB7fVxuICB9O1xuICBmb3IgKGNvbnN0IHBsdWdpbiBvZiBvcHRpb25zLnBsdWdpbnMgfHwgW10pIHtcbiAgICBpZiAocGx1Z2luLnNjaGVtYSAmJiBwbHVnaW4uc2NoZW1hW3RhYmxlXSkge1xuICAgICAgc2NoZW1hID0ge1xuICAgICAgICAuLi5zY2hlbWEsXG4gICAgICAgIC4uLnBsdWdpbi5zY2hlbWFbdGFibGVdLmZpZWxkc1xuICAgICAgfTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHNjaGVtYTtcbn1cbmZ1bmN0aW9uIHBhcnNlVXNlck91dHB1dChvcHRpb25zLCB1c2VyKSB7XG4gIGNvbnN0IHNjaGVtYSA9IGdldEFsbEZpZWxkcyhvcHRpb25zLCBcInVzZXJcIik7XG4gIHJldHVybiBwYXJzZU91dHB1dERhdGEodXNlciwgeyBmaWVsZHM6IHNjaGVtYSB9KTtcbn1cbmZ1bmN0aW9uIHBhcnNlQWNjb3VudE91dHB1dChvcHRpb25zLCBhY2NvdW50KSB7XG4gIGNvbnN0IHNjaGVtYSA9IGdldEFsbEZpZWxkcyhvcHRpb25zLCBcImFjY291bnRcIik7XG4gIHJldHVybiBwYXJzZU91dHB1dERhdGEoYWNjb3VudCwgeyBmaWVsZHM6IHNjaGVtYSB9KTtcbn1cbmZ1bmN0aW9uIHBhcnNlU2Vzc2lvbk91dHB1dChvcHRpb25zLCBzZXNzaW9uKSB7XG4gIGNvbnN0IHNjaGVtYSA9IGdldEFsbEZpZWxkcyhvcHRpb25zLCBcInNlc3Npb25cIik7XG4gIHJldHVybiBwYXJzZU91dHB1dERhdGEoc2Vzc2lvbiwgeyBmaWVsZHM6IHNjaGVtYSB9KTtcbn1cbmZ1bmN0aW9uIHBhcnNlSW5wdXREYXRhKGRhdGEsIHNjaGVtYSkge1xuICBjb25zdCBhY3Rpb24gPSBzY2hlbWEuYWN0aW9uIHx8IFwiY3JlYXRlXCI7XG4gIGNvbnN0IGZpZWxkcyA9IHNjaGVtYS5maWVsZHM7XG4gIGNvbnN0IHBhcnNlZERhdGEgPSB7fTtcbiAgZm9yIChjb25zdCBrZXkgaW4gZmllbGRzKSB7XG4gICAgaWYgKGtleSBpbiBkYXRhKSB7XG4gICAgICBpZiAoZmllbGRzW2tleV0uaW5wdXQgPT09IGZhbHNlKSB7XG4gICAgICAgIGlmIChmaWVsZHNba2V5XS5kZWZhdWx0VmFsdWUpIHtcbiAgICAgICAgICBwYXJzZWREYXRhW2tleV0gPSBmaWVsZHNba2V5XS5kZWZhdWx0VmFsdWU7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAoZmllbGRzW2tleV0udmFsaWRhdG9yPy5pbnB1dCAmJiBkYXRhW2tleV0gIT09IHZvaWQgMCkge1xuICAgICAgICBwYXJzZWREYXRhW2tleV0gPSBmaWVsZHNba2V5XS52YWxpZGF0b3IuaW5wdXQucGFyc2UoZGF0YVtrZXldKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAoZmllbGRzW2tleV0udHJhbnNmb3JtPy5pbnB1dCAmJiBkYXRhW2tleV0gIT09IHZvaWQgMCkge1xuICAgICAgICBwYXJzZWREYXRhW2tleV0gPSBmaWVsZHNba2V5XS50cmFuc2Zvcm0/LmlucHV0KGRhdGFba2V5XSk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgcGFyc2VkRGF0YVtrZXldID0gZGF0YVtrZXldO1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGlmIChmaWVsZHNba2V5XS5kZWZhdWx0VmFsdWUgJiYgYWN0aW9uID09PSBcImNyZWF0ZVwiKSB7XG4gICAgICBwYXJzZWREYXRhW2tleV0gPSBmaWVsZHNba2V5XS5kZWZhdWx0VmFsdWU7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgaWYgKGZpZWxkc1trZXldLnJlcXVpcmVkICYmIGFjdGlvbiA9PT0gXCJjcmVhdGVcIikge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBgJHtrZXl9IGlzIHJlcXVpcmVkYFxuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBwYXJzZWREYXRhO1xufVxuZnVuY3Rpb24gcGFyc2VVc2VySW5wdXQob3B0aW9ucywgdXNlciwgYWN0aW9uKSB7XG4gIGNvbnN0IHNjaGVtYSA9IGdldEFsbEZpZWxkcyhvcHRpb25zLCBcInVzZXJcIik7XG4gIHJldHVybiBwYXJzZUlucHV0RGF0YSh1c2VyIHx8IHt9LCB7IGZpZWxkczogc2NoZW1hLCBhY3Rpb24gfSk7XG59XG5mdW5jdGlvbiBwYXJzZUFkZGl0aW9uYWxVc2VySW5wdXQob3B0aW9ucywgdXNlcikge1xuICBjb25zdCBzY2hlbWEgPSBnZXRBbGxGaWVsZHMob3B0aW9ucywgXCJ1c2VyXCIpO1xuICByZXR1cm4gcGFyc2VJbnB1dERhdGEodXNlciB8fCB7fSwgeyBmaWVsZHM6IHNjaGVtYSB9KTtcbn1cbmZ1bmN0aW9uIHBhcnNlQWNjb3VudElucHV0KG9wdGlvbnMsIGFjY291bnQpIHtcbiAgY29uc3Qgc2NoZW1hID0gZ2V0QWxsRmllbGRzKG9wdGlvbnMsIFwiYWNjb3VudFwiKTtcbiAgcmV0dXJuIHBhcnNlSW5wdXREYXRhKGFjY291bnQsIHsgZmllbGRzOiBzY2hlbWEgfSk7XG59XG5mdW5jdGlvbiBwYXJzZVNlc3Npb25JbnB1dChvcHRpb25zLCBzZXNzaW9uKSB7XG4gIGNvbnN0IHNjaGVtYSA9IGdldEFsbEZpZWxkcyhvcHRpb25zLCBcInNlc3Npb25cIik7XG4gIHJldHVybiBwYXJzZUlucHV0RGF0YShzZXNzaW9uLCB7IGZpZWxkczogc2NoZW1hIH0pO1xufVxuZnVuY3Rpb24gbWVyZ2VTY2hlbWEoc2NoZW1hLCBuZXdTY2hlbWEpIHtcbiAgaWYgKCFuZXdTY2hlbWEpIHtcbiAgICByZXR1cm4gc2NoZW1hO1xuICB9XG4gIGZvciAoY29uc3QgdGFibGUgaW4gbmV3U2NoZW1hKSB7XG4gICAgY29uc3QgbmV3TW9kZWxOYW1lID0gbmV3U2NoZW1hW3RhYmxlXT8ubW9kZWxOYW1lO1xuICAgIGlmIChuZXdNb2RlbE5hbWUpIHtcbiAgICAgIHNjaGVtYVt0YWJsZV0ubW9kZWxOYW1lID0gbmV3TW9kZWxOYW1lO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGZpZWxkIGluIHNjaGVtYVt0YWJsZV0uZmllbGRzKSB7XG4gICAgICBjb25zdCBuZXdGaWVsZCA9IG5ld1NjaGVtYVt0YWJsZV0/LmZpZWxkcz8uW2ZpZWxkXTtcbiAgICAgIGlmICghbmV3RmllbGQpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBzY2hlbWFbdGFibGVdLmZpZWxkc1tmaWVsZF0uZmllbGROYW1lID0gbmV3RmllbGQ7XG4gICAgfVxuICB9XG4gIHJldHVybiBzY2hlbWE7XG59XG5cbmV4cG9ydCB7IGFjY291bnRTY2hlbWEgYXMgYSwgcGFyc2VVc2VyT3V0cHV0IGFzIGIsIHBhcnNlQWNjb3VudE91dHB1dCBhcyBjLCBwYXJzZVNlc3Npb25PdXRwdXQgYXMgZCwgcGFyc2VJbnB1dERhdGEgYXMgZSwgcGFyc2VVc2VySW5wdXQgYXMgZiwgZ2V0QWxsRmllbGRzIGFzIGcsIHBhcnNlQWRkaXRpb25hbFVzZXJJbnB1dCBhcyBoLCBwYXJzZUFjY291bnRJbnB1dCBhcyBpLCBwYXJzZVNlc3Npb25JbnB1dCBhcyBqLCBtZXJnZVNjaGVtYSBhcyBtLCBwYXJzZU91dHB1dERhdGEgYXMgcCwgc2Vzc2lvblNjaGVtYSBhcyBzLCB1c2VyU2NoZW1hIGFzIHUsIHZlcmlmaWNhdGlvblNjaGVtYSBhcyB2IH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.n2KFGwjY.mjs\n");

/***/ }),

/***/ "(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.tB5eU6EY.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.tB5eU6EY.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   s: () => (/* binding */ safeJSONParse)\n/* harmony export */ });\nfunction safeJSONParse(data) {\n  function reviver(_, value) {\n    if (typeof value === \"string\") {\n      const iso8601Regex = /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(?:\\.\\d+)?Z$/;\n      if (iso8601Regex.test(value)) {\n        const date = new Date(value);\n        if (!isNaN(date.getTime())) {\n          return date;\n        }\n      }\n    }\n    return value;\n  }\n  try {\n    return JSON.parse(data, reviver);\n  } catch {\n    return null;\n  }\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGgudEI1ZVU2RVkubWpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUU4QiIsInNvdXJjZXMiOlsiL1VzZXJzL21pbGFuL0Rlc2t0b3AvQXBwcy9iZXR0ZXItYXV0aC9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGgudEI1ZVU2RVkubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIHNhZmVKU09OUGFyc2UoZGF0YSkge1xuICBmdW5jdGlvbiByZXZpdmVyKF8sIHZhbHVlKSB7XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgY29uc3QgaXNvODYwMVJlZ2V4ID0gL15cXGR7NH0tXFxkezJ9LVxcZHsyfVRcXGR7Mn06XFxkezJ9OlxcZHsyfSg/OlxcLlxcZCspP1okLztcbiAgICAgIGlmIChpc284NjAxUmVnZXgudGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHZhbHVlKTtcbiAgICAgICAgaWYgKCFpc05hTihkYXRlLmdldFRpbWUoKSkpIHtcbiAgICAgICAgICByZXR1cm4gZGF0ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cbiAgdHJ5IHtcbiAgICByZXR1cm4gSlNPTi5wYXJzZShkYXRhLCByZXZpdmVyKTtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuZXhwb3J0IHsgc2FmZUpTT05QYXJzZSBhcyBzIH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.tB5eU6EY.mjs\n");

/***/ }),

/***/ "(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.z3dsxLxE.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.z3dsxLxE.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   $: () => (/* binding */ signOut),\n/* harmony export */   A: () => (/* binding */ originCheckMiddleware),\n/* harmony export */   B: () => (/* binding */ BASE_ERROR_CODES),\n/* harmony export */   C: () => (/* binding */ error),\n/* harmony export */   D: () => (/* binding */ ok),\n/* harmony export */   E: () => (/* binding */ accountInfo),\n/* harmony export */   F: () => (/* binding */ getAccessToken),\n/* harmony export */   G: () => (/* binding */ refreshToken),\n/* harmony export */   H: () => (/* binding */ HIDE_METADATA),\n/* harmony export */   I: () => (/* binding */ unlinkAccount),\n/* harmony export */   J: () => (/* binding */ deleteUserCallback),\n/* harmony export */   K: () => (/* binding */ listUserAccounts),\n/* harmony export */   L: () => (/* binding */ linkSocialAccount),\n/* harmony export */   M: () => (/* binding */ revokeOtherSessions),\n/* harmony export */   N: () => (/* binding */ revokeSessions),\n/* harmony export */   O: () => (/* binding */ revokeSession),\n/* harmony export */   P: () => (/* binding */ requestPasswordResetCallback),\n/* harmony export */   Q: () => (/* binding */ requestPasswordReset),\n/* harmony export */   R: () => (/* binding */ forgetPasswordCallback),\n/* harmony export */   S: () => (/* binding */ deleteUser),\n/* harmony export */   T: () => (/* binding */ setPassword),\n/* harmony export */   U: () => (/* binding */ changePassword),\n/* harmony export */   V: () => (/* binding */ changeEmail),\n/* harmony export */   W: () => (/* binding */ sendVerificationEmail),\n/* harmony export */   X: () => (/* binding */ verifyEmail),\n/* harmony export */   Y: () => (/* binding */ resetPassword),\n/* harmony export */   Z: () => (/* binding */ forgetPassword),\n/* harmony export */   _: () => (/* binding */ signInEmail),\n/* harmony export */   a: () => (/* binding */ validateToken),\n/* harmony export */   a0: () => (/* binding */ callbackOAuth),\n/* harmony export */   a1: () => (/* binding */ signInSocial),\n/* harmony export */   a2: () => (/* binding */ requestOnlySessionMiddleware),\n/* harmony export */   a3: () => (/* binding */ socialProviderList),\n/* harmony export */   a4: () => (/* binding */ SocialProviderListEnum),\n/* harmony export */   a5: () => (/* binding */ apple),\n/* harmony export */   a6: () => (/* binding */ getApplePublicKey),\n/* harmony export */   a7: () => (/* binding */ discord),\n/* harmony export */   a8: () => (/* binding */ dropbox),\n/* harmony export */   a9: () => (/* binding */ facebook),\n/* harmony export */   aa: () => (/* binding */ github),\n/* harmony export */   ab: () => (/* binding */ linear),\n/* harmony export */   ac: () => (/* binding */ linkedin),\n/* harmony export */   ad: () => (/* binding */ gitlab),\n/* harmony export */   ae: () => (/* binding */ google),\n/* harmony export */   af: () => (/* binding */ kick),\n/* harmony export */   ag: () => (/* binding */ microsoft),\n/* harmony export */   ah: () => (/* binding */ notion),\n/* harmony export */   ai: () => (/* binding */ reddit),\n/* harmony export */   aj: () => (/* binding */ roblox),\n/* harmony export */   ak: () => (/* binding */ spotify),\n/* harmony export */   al: () => (/* binding */ tiktok),\n/* harmony export */   am: () => (/* binding */ twitch),\n/* harmony export */   an: () => (/* binding */ twitter),\n/* harmony export */   ao: () => (/* binding */ LANG),\n/* harmony export */   ap: () => (/* binding */ vk),\n/* harmony export */   aq: () => (/* binding */ zoom),\n/* harmony export */   ar: () => (/* binding */ huggingface),\n/* harmony export */   as: () => (/* binding */ slack),\n/* harmony export */   b: () => (/* binding */ generateCodeChallenge),\n/* harmony export */   c: () => (/* binding */ createAuthorizationURL),\n/* harmony export */   d: () => (/* binding */ getOAuth2Tokens),\n/* harmony export */   e: () => (/* binding */ encodeOAuthParameter),\n/* harmony export */   f: () => (/* binding */ decryptOAuthToken),\n/* harmony export */   g: () => (/* binding */ generateState),\n/* harmony export */   h: () => (/* binding */ handleOAuthUserInfo),\n/* harmony export */   i: () => (/* binding */ createAuthMiddleware),\n/* harmony export */   j: () => (/* binding */ createAuthEndpoint),\n/* harmony export */   k: () => (/* binding */ getSessionFromCtx),\n/* harmony export */   l: () => (/* binding */ sessionMiddleware),\n/* harmony export */   m: () => (/* binding */ getSession),\n/* harmony export */   n: () => (/* binding */ freshSessionMiddleware),\n/* harmony export */   o: () => (/* binding */ originCheck),\n/* harmony export */   p: () => (/* binding */ parseState),\n/* harmony export */   q: () => (/* binding */ optionsMiddleware),\n/* harmony export */   r: () => (/* binding */ refreshAccessToken),\n/* harmony export */   s: () => (/* binding */ setTokenUtil),\n/* harmony export */   t: () => (/* binding */ socialProviders),\n/* harmony export */   u: () => (/* binding */ sendVerificationEmailFn),\n/* harmony export */   v: () => (/* binding */ validateAuthorizationCode),\n/* harmony export */   w: () => (/* binding */ createEmailVerificationToken),\n/* harmony export */   x: () => (/* binding */ wildcardMatch),\n/* harmony export */   y: () => (/* binding */ listSessions),\n/* harmony export */   z: () => (/* binding */ updateUser)\n/* harmony export */ });\n/* harmony import */ var zod_v4__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! zod/v4 */ \"(action-browser)/../../node_modules/zod/v4/classic/schemas.js\");\n/* harmony import */ var zod_v4__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! zod/v4 */ \"(action-browser)/../../node_modules/zod/v4/classic/coerce.js\");\n/* harmony import */ var better_call__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! better-call */ \"(action-browser)/../../node_modules/better-call/dist/index.js\");\n/* harmony import */ var _better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./better-auth.CW6D9eSx.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.CW6D9eSx.mjs\");\n/* harmony import */ var _better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @better-auth/utils/hash */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/hash.mjs\");\n/* harmony import */ var _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @better-auth/utils/base64 */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/base64.mjs\");\n/* harmony import */ var _crypto_index_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../crypto/index.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/crypto/index.mjs\");\n/* harmony import */ var _better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @better-fetch/fetch */ \"(action-browser)/../../node_modules/@better-fetch/fetch/dist/index.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! jose */ \"(action-browser)/../../node_modules/jose/dist/node/esm/jwt/verify.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! jose */ \"(action-browser)/../../node_modules/jose/dist/node/esm/util/decode_protected_header.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! jose */ \"(action-browser)/../../node_modules/jose/dist/node/esm/util/decode_jwt.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! jose */ \"(action-browser)/../../node_modules/jose/dist/node/esm/key/import.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! jose */ \"(action-browser)/../../node_modules/jose/dist/node/esm/jwks/remote.js\");\n/* harmony import */ var _better_auth_utils__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @better-auth/utils */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/index.mjs\");\n/* harmony import */ var _better_auth_utils_hex__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @better-auth/utils/hex */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/hex.mjs\");\n/* harmony import */ var _better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./better-auth.B4Qoxdgc.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs\");\n/* harmony import */ var _better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./better-auth.VTXNLFMT.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.VTXNLFMT.mjs\");\n/* harmony import */ var _cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../cookies/index.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/cookies/index.mjs\");\n/* harmony import */ var _better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./better-auth.tB5eU6EY.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.tB5eU6EY.mjs\");\n/* harmony import */ var _better_auth_utils_hmac__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @better-auth/utils/hmac */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/hmac.mjs\");\n/* harmony import */ var _better_auth_utils_binary__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @better-auth/utils/binary */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/binary.mjs\");\n/* harmony import */ var jose_errors__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! jose/errors */ \"(action-browser)/../../node_modules/jose/dist/node/esm/util/errors.js\");\n/* harmony import */ var _better_auth_utils_random__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @better-auth/utils/random */ \"(action-browser)/../../node_modules/@better-auth/utils/dist/random.mjs\");\n/* harmony import */ var _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./better-auth.DBGfIDnh.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DBGfIDnh.mjs\");\n/* harmony import */ var _better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./better-auth.n2KFGwjY.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.n2KFGwjY.mjs\");\n/* harmony import */ var _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./better-auth.8zoxzg-F.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs\");\n/* harmony import */ var defu__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! defu */ \"(action-browser)/../../node_modules/defu/dist/defu.mjs\");\n/* harmony import */ var _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./better-auth.DdzSJf-n.mjs */ \"(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst optionsMiddleware = (0,better_call__WEBPACK_IMPORTED_MODULE_0__.createMiddleware)(async () => {\n  return {};\n});\nconst createAuthMiddleware = better_call__WEBPACK_IMPORTED_MODULE_0__.createMiddleware.create({\n  use: [\n    optionsMiddleware,\n    /**\n     * Only use for post hooks\n     */\n    (0,better_call__WEBPACK_IMPORTED_MODULE_0__.createMiddleware)(async () => {\n      return {};\n    })\n  ]\n});\nconst createAuthEndpoint = better_call__WEBPACK_IMPORTED_MODULE_0__.createEndpoint.create({\n  use: [optionsMiddleware]\n});\n\nfunction escapeRegExpChar(char) {\n  if (char === \"-\" || char === \"^\" || char === \"$\" || char === \"+\" || char === \".\" || char === \"(\" || char === \")\" || char === \"|\" || char === \"[\" || char === \"]\" || char === \"{\" || char === \"}\" || char === \"*\" || char === \"?\" || char === \"\\\\\") {\n    return `\\\\${char}`;\n  } else {\n    return char;\n  }\n}\nfunction escapeRegExpString(str) {\n  let result = \"\";\n  for (let i = 0; i < str.length; i++) {\n    result += escapeRegExpChar(str[i]);\n  }\n  return result;\n}\nfunction transform(pattern, separator = true) {\n  if (Array.isArray(pattern)) {\n    let regExpPatterns = pattern.map((p) => `^${transform(p, separator)}$`);\n    return `(?:${regExpPatterns.join(\"|\")})`;\n  }\n  let separatorSplitter = \"\";\n  let separatorMatcher = \"\";\n  let wildcard = \".\";\n  if (separator === true) {\n    separatorSplitter = \"/\";\n    separatorMatcher = \"[/\\\\\\\\]\";\n    wildcard = \"[^/\\\\\\\\]\";\n  } else if (separator) {\n    separatorSplitter = separator;\n    separatorMatcher = escapeRegExpString(separatorSplitter);\n    if (separatorMatcher.length > 1) {\n      separatorMatcher = `(?:${separatorMatcher})`;\n      wildcard = `((?!${separatorMatcher}).)`;\n    } else {\n      wildcard = `[^${separatorMatcher}]`;\n    }\n  }\n  let requiredSeparator = separator ? `${separatorMatcher}+?` : \"\";\n  let optionalSeparator = separator ? `${separatorMatcher}*?` : \"\";\n  let segments = separator ? pattern.split(separatorSplitter) : [pattern];\n  let result = \"\";\n  for (let s = 0; s < segments.length; s++) {\n    let segment = segments[s];\n    let nextSegment = segments[s + 1];\n    let currentSeparator = \"\";\n    if (!segment && s > 0) {\n      continue;\n    }\n    if (separator) {\n      if (s === segments.length - 1) {\n        currentSeparator = optionalSeparator;\n      } else if (nextSegment !== \"**\") {\n        currentSeparator = requiredSeparator;\n      } else {\n        currentSeparator = \"\";\n      }\n    }\n    if (separator && segment === \"**\") {\n      if (currentSeparator) {\n        result += s === 0 ? \"\" : currentSeparator;\n        result += `(?:${wildcard}*?${currentSeparator})*?`;\n      }\n      continue;\n    }\n    for (let c = 0; c < segment.length; c++) {\n      let char = segment[c];\n      if (char === \"\\\\\") {\n        if (c < segment.length - 1) {\n          result += escapeRegExpChar(segment[c + 1]);\n          c++;\n        }\n      } else if (char === \"?\") {\n        result += wildcard;\n      } else if (char === \"*\") {\n        result += `${wildcard}*?`;\n      } else {\n        result += escapeRegExpChar(char);\n      }\n    }\n    result += currentSeparator;\n  }\n  return result;\n}\nfunction isMatch(regexp, sample) {\n  if (typeof sample !== \"string\") {\n    throw new TypeError(`Sample must be a string, but ${typeof sample} given`);\n  }\n  return regexp.test(sample);\n}\nfunction wildcardMatch(pattern, options) {\n  if (typeof pattern !== \"string\" && !Array.isArray(pattern)) {\n    throw new TypeError(\n      `The first argument must be a single pattern string or an array of patterns, but ${typeof pattern} given`\n    );\n  }\n  if (typeof options === \"string\" || typeof options === \"boolean\") {\n    options = { separator: options };\n  }\n  if (arguments.length === 2 && !(typeof options === \"undefined\" || typeof options === \"object\" && options !== null && !Array.isArray(options))) {\n    throw new TypeError(\n      `The second argument must be an options object or a string/boolean separator, but ${typeof options} given`\n    );\n  }\n  options = options || {};\n  if (options.separator === \"\\\\\") {\n    throw new Error(\n      \"\\\\ is not a valid separator because it is used for escaping. Try setting the separator to `true` instead\"\n    );\n  }\n  let regexpPattern = transform(pattern, options.separator);\n  let regexp = new RegExp(`^${regexpPattern}$`, options.flags);\n  let fn = isMatch.bind(null, regexp);\n  fn.options = options;\n  fn.pattern = pattern;\n  fn.regexp = regexp;\n  return fn;\n}\n\nconst originCheckMiddleware = createAuthMiddleware(async (ctx) => {\n  if (ctx.request?.method !== \"POST\" || !ctx.request) {\n    return;\n  }\n  const { body, query, context } = ctx;\n  const originHeader = ctx.headers?.get(\"origin\") || ctx.headers?.get(\"referer\") || \"\";\n  const callbackURL = body?.callbackURL || query?.callbackURL;\n  const redirectURL = body?.redirectTo;\n  const errorCallbackURL = body?.errorCallbackURL;\n  const newUserCallbackURL = body?.newUserCallbackURL;\n  const trustedOrigins = Array.isArray(context.options.trustedOrigins) ? context.trustedOrigins : [\n    ...context.trustedOrigins,\n    ...await context.options.trustedOrigins?.(ctx.request) || []\n  ];\n  const usesCookies = ctx.headers?.has(\"cookie\");\n  const matchesPattern = (url, pattern) => {\n    if (url.startsWith(\"/\")) {\n      return false;\n    }\n    if (pattern.includes(\"*\")) {\n      if (pattern.includes(\"://\")) {\n        return wildcardMatch(pattern)((0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_9__.g)(url) || url);\n      }\n      return wildcardMatch(pattern)((0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_9__.b)(url));\n    }\n    const protocol = (0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_9__.c)(url);\n    return protocol === \"http:\" || protocol === \"https:\" || !protocol ? pattern === (0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_9__.g)(url) : url.startsWith(pattern);\n  };\n  const validateURL = (url, label) => {\n    if (!url) {\n      return;\n    }\n    const isTrustedOrigin = trustedOrigins.some(\n      (origin) => matchesPattern(url, origin) || url?.startsWith(\"/\") && label !== \"origin\" && /^\\/(?!\\/|\\\\|%2f|%5c)[\\w\\-.\\+/@]*(?:\\?[\\w\\-.\\+/=&%@]*)?$/.test(url)\n    );\n    if (!isTrustedOrigin) {\n      ctx.context.logger.error(`Invalid ${label}: ${url}`);\n      ctx.context.logger.info(\n        `If it's a valid URL, please add ${url} to trustedOrigins in your auth config\n`,\n        `Current list of trustedOrigins: ${trustedOrigins}`\n      );\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"FORBIDDEN\", { message: `Invalid ${label}` });\n    }\n  };\n  if (usesCookies && !ctx.context.options.advanced?.disableCSRFCheck) {\n    validateURL(originHeader, \"origin\");\n  }\n  callbackURL && validateURL(callbackURL, \"callbackURL\");\n  redirectURL && validateURL(redirectURL, \"redirectURL\");\n  errorCallbackURL && validateURL(errorCallbackURL, \"errorCallbackURL\");\n  newUserCallbackURL && validateURL(newUserCallbackURL, \"newUserCallbackURL\");\n});\nconst originCheck = (getValue) => createAuthMiddleware(async (ctx) => {\n  if (!ctx.request) {\n    return;\n  }\n  const { context } = ctx;\n  const callbackURL = getValue(ctx);\n  const trustedOrigins = Array.isArray(\n    context.options.trustedOrigins\n  ) ? context.trustedOrigins : [\n    ...context.trustedOrigins,\n    ...await context.options.trustedOrigins?.(ctx.request) || []\n  ];\n  const matchesPattern = (url, pattern) => {\n    if (url.startsWith(\"/\")) {\n      return false;\n    }\n    if (pattern.includes(\"*\")) {\n      if (pattern.includes(\"://\")) {\n        return wildcardMatch(pattern)((0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_9__.g)(url) || url);\n      }\n      return wildcardMatch(pattern)((0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_9__.b)(url));\n    }\n    const protocol = (0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_9__.c)(url);\n    return protocol === \"http:\" || protocol === \"https:\" || !protocol ? pattern === (0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_9__.g)(url) : url.startsWith(pattern);\n  };\n  const validateURL = (url, label) => {\n    if (!url) {\n      return;\n    }\n    const isTrustedOrigin = trustedOrigins.some(\n      (origin) => matchesPattern(url, origin) || url?.startsWith(\"/\") && label !== \"origin\" && /^\\/(?!\\/|\\\\|%2f|%5c)[\\w\\-.\\+/@]*(?:\\?[\\w\\-.\\+/=&%@]*)?$/.test(\n        url\n      )\n    );\n    if (!isTrustedOrigin) {\n      ctx.context.logger.error(`Invalid ${label}: ${url}`);\n      ctx.context.logger.info(\n        `If it's a valid URL, please add ${url} to trustedOrigins in your auth config\n`,\n        `Current list of trustedOrigins: ${trustedOrigins}`\n      );\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"FORBIDDEN\", { message: `Invalid ${label}` });\n    }\n  };\n  const callbacks = Array.isArray(callbackURL) ? callbackURL : [callbackURL];\n  for (const url of callbacks) {\n    validateURL(url, \"callbackURL\");\n  }\n});\n\nconst BASE_ERROR_CODES = {\n  USER_NOT_FOUND: \"User not found\",\n  FAILED_TO_CREATE_USER: \"Failed to create user\",\n  FAILED_TO_CREATE_SESSION: \"Failed to create session\",\n  FAILED_TO_UPDATE_USER: \"Failed to update user\",\n  FAILED_TO_GET_SESSION: \"Failed to get session\",\n  INVALID_PASSWORD: \"Invalid password\",\n  INVALID_EMAIL: \"Invalid email\",\n  INVALID_EMAIL_OR_PASSWORD: \"Invalid email or password\",\n  SOCIAL_ACCOUNT_ALREADY_LINKED: \"Social account already linked\",\n  PROVIDER_NOT_FOUND: \"Provider not found\",\n  INVALID_TOKEN: \"invalid token\",\n  ID_TOKEN_NOT_SUPPORTED: \"id_token not supported\",\n  FAILED_TO_GET_USER_INFO: \"Failed to get user info\",\n  USER_EMAIL_NOT_FOUND: \"User email not found\",\n  EMAIL_NOT_VERIFIED: \"Email not verified\",\n  PASSWORD_TOO_SHORT: \"Password too short\",\n  PASSWORD_TOO_LONG: \"Password too long\",\n  USER_ALREADY_EXISTS: \"User already exists\",\n  EMAIL_CAN_NOT_BE_UPDATED: \"Email can not be updated\",\n  CREDENTIAL_ACCOUNT_NOT_FOUND: \"Credential account not found\",\n  SESSION_EXPIRED: \"Session expired. Re-authenticate to perform this action.\",\n  FAILED_TO_UNLINK_LAST_ACCOUNT: \"You can't unlink your last account\",\n  ACCOUNT_NOT_FOUND: \"Account not found\",\n  USER_ALREADY_HAS_PASSWORD: \"User already has a password. Provide that to delete the account.\"\n};\n\nconst getSession = () => createAuthEndpoint(\n  \"/get-session\",\n  {\n    method: \"GET\",\n    query: zod_v4__WEBPACK_IMPORTED_MODULE_20__.optional(\n      zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n        /**\n         * If cookie cache is enabled, it will disable the cache\n         * and fetch the session from the database\n         */\n        disableCookieCache: zod_v4__WEBPACK_IMPORTED_MODULE_21__.boolean().meta({\n          description: \"Disable cookie cache and fetch session from database\"\n        }).optional(),\n        disableRefresh: zod_v4__WEBPACK_IMPORTED_MODULE_21__.boolean().meta({\n          description: \"Disable session refresh. Useful for checking session status, without updating the session\"\n        }).optional()\n      })\n    ),\n    requireHeaders: true,\n    metadata: {\n      openapi: {\n        description: \"Get the current session\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    session: {\n                      $ref: \"#/components/schemas/Session\"\n                    },\n                    user: {\n                      $ref: \"#/components/schemas/User\"\n                    }\n                  },\n                  required: [\"session\", \"user\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    try {\n      const sessionCookieToken = await ctx.getSignedCookie(\n        ctx.context.authCookies.sessionToken.name,\n        ctx.context.secret\n      );\n      if (!sessionCookieToken) {\n        return null;\n      }\n      const sessionDataCookie = ctx.getCookie(\n        ctx.context.authCookies.sessionData.name\n      );\n      const sessionDataPayload = sessionDataCookie ? (0,_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_11__.s)(_better_auth_utils_binary__WEBPACK_IMPORTED_MODULE_13__.binary.decode(_better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_3__.base64.decode(sessionDataCookie))) : null;\n      if (sessionDataPayload) {\n        const isValid = await (0,_better_auth_utils_hmac__WEBPACK_IMPORTED_MODULE_12__.createHMAC)(\"SHA-256\", \"base64urlnopad\").verify(\n          ctx.context.secret,\n          JSON.stringify({\n            ...sessionDataPayload.session,\n            expiresAt: sessionDataPayload.expiresAt\n          }),\n          sessionDataPayload.signature\n        );\n        if (!isValid) {\n          const dataCookie = ctx.context.authCookies.sessionData.name;\n          ctx.setCookie(dataCookie, \"\", {\n            maxAge: 0\n          });\n          return ctx.json(null);\n        }\n      }\n      const dontRememberMe = await ctx.getSignedCookie(\n        ctx.context.authCookies.dontRememberToken.name,\n        ctx.context.secret\n      );\n      if (sessionDataPayload?.session && ctx.context.options.session?.cookieCache?.enabled && !ctx.query?.disableCookieCache) {\n        const session2 = sessionDataPayload.session;\n        const hasExpired = sessionDataPayload.expiresAt < Date.now() || session2.session.expiresAt < /* @__PURE__ */ new Date();\n        if (!hasExpired) {\n          ctx.context.session = session2;\n          return ctx.json(\n            session2\n          );\n        } else {\n          const dataCookie = ctx.context.authCookies.sessionData.name;\n          ctx.setCookie(dataCookie, \"\", {\n            maxAge: 0\n          });\n        }\n      }\n      const session = await ctx.context.internalAdapter.findSession(sessionCookieToken);\n      ctx.context.session = session;\n      if (!session || session.session.expiresAt < /* @__PURE__ */ new Date()) {\n        (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.deleteSessionCookie)(ctx);\n        if (session) {\n          await ctx.context.internalAdapter.deleteSession(\n            session.session.token\n          );\n        }\n        return ctx.json(null);\n      }\n      if (dontRememberMe || ctx.query?.disableRefresh) {\n        return ctx.json(\n          session\n        );\n      }\n      const expiresIn = ctx.context.sessionConfig.expiresIn;\n      const updateAge = ctx.context.sessionConfig.updateAge;\n      const sessionIsDueToBeUpdatedDate = session.session.expiresAt.valueOf() - expiresIn * 1e3 + updateAge * 1e3;\n      const shouldBeUpdated = sessionIsDueToBeUpdatedDate <= Date.now();\n      if (shouldBeUpdated && (!ctx.query?.disableRefresh || !ctx.context.options.session?.disableSessionRefresh)) {\n        const updatedSession = await ctx.context.internalAdapter.updateSession(\n          session.session.token,\n          {\n            expiresAt: (0,_better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_1__.g)(ctx.context.sessionConfig.expiresIn, \"sec\"),\n            updatedAt: /* @__PURE__ */ new Date()\n          }\n        );\n        if (!updatedSession) {\n          (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.deleteSessionCookie)(ctx);\n          return ctx.json(null, { status: 401 });\n        }\n        const maxAge = (updatedSession.expiresAt.valueOf() - Date.now()) / 1e3;\n        await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.setSessionCookie)(\n          ctx,\n          {\n            session: updatedSession,\n            user: session.user\n          },\n          false,\n          {\n            maxAge\n          }\n        );\n        return ctx.json({\n          session: updatedSession,\n          user: session.user\n        });\n      }\n      await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.setCookieCache)(ctx, session);\n      return ctx.json(\n        session\n      );\n    } catch (error) {\n      ctx.context.logger.error(\"INTERNAL_SERVER_ERROR\", error);\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"INTERNAL_SERVER_ERROR\", {\n        message: BASE_ERROR_CODES.FAILED_TO_GET_SESSION\n      });\n    }\n  }\n);\nconst getSessionFromCtx = async (ctx, config) => {\n  if (ctx.context.session) {\n    return ctx.context.session;\n  }\n  const session = await getSession()({\n    ...ctx,\n    asResponse: false,\n    headers: ctx.headers,\n    returnHeaders: false,\n    query: {\n      ...config,\n      ...ctx.query\n    }\n  }).catch((e) => {\n    return null;\n  });\n  ctx.context.session = session;\n  return session;\n};\nconst sessionMiddleware = createAuthMiddleware(async (ctx) => {\n  const session = await getSessionFromCtx(ctx);\n  if (!session?.session) {\n    throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\");\n  }\n  return {\n    session\n  };\n});\nconst requestOnlySessionMiddleware = createAuthMiddleware(\n  async (ctx) => {\n    const session = await getSessionFromCtx(ctx);\n    if (!session?.session && (ctx.request || ctx.headers)) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\");\n    }\n    return { session };\n  }\n);\nconst freshSessionMiddleware = createAuthMiddleware(async (ctx) => {\n  const session = await getSessionFromCtx(ctx);\n  if (!session?.session) {\n    throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\");\n  }\n  if (ctx.context.sessionConfig.freshAge === 0) {\n    return {\n      session\n    };\n  }\n  const freshAge = ctx.context.sessionConfig.freshAge;\n  const lastUpdated = session.session.updatedAt?.valueOf() || session.session.createdAt.valueOf();\n  const now = Date.now();\n  const isFresh = now - lastUpdated < freshAge * 1e3;\n  if (!isFresh) {\n    throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"FORBIDDEN\", {\n      message: \"Session is not fresh\"\n    });\n  }\n  return {\n    session\n  };\n});\nconst listSessions = () => createAuthEndpoint(\n  \"/list-sessions\",\n  {\n    method: \"GET\",\n    use: [sessionMiddleware],\n    requireHeaders: true,\n    metadata: {\n      openapi: {\n        description: \"List all active sessions for the user\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"array\",\n                  items: {\n                    $ref: \"#/components/schemas/Session\"\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    try {\n      const sessions = await ctx.context.internalAdapter.listSessions(\n        ctx.context.session.user.id\n      );\n      const activeSessions = sessions.filter((session) => {\n        return session.expiresAt > /* @__PURE__ */ new Date();\n      });\n      return ctx.json(\n        activeSessions\n      );\n    } catch (e) {\n      ctx.context.logger.error(e);\n      throw ctx.error(\"INTERNAL_SERVER_ERROR\");\n    }\n  }\n);\nconst revokeSession = createAuthEndpoint(\n  \"/revoke-session\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      token: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The token to revoke\"\n      })\n    }),\n    use: [sessionMiddleware],\n    requireHeaders: true,\n    metadata: {\n      openapi: {\n        description: \"Revoke a single session\",\n        requestBody: {\n          content: {\n            \"application/json\": {\n              schema: {\n                type: \"object\",\n                properties: {\n                  token: {\n                    type: \"string\",\n                    description: \"The token to revoke\"\n                  }\n                },\n                required: [\"token\"]\n              }\n            }\n          }\n        },\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    status: {\n                      type: \"boolean\",\n                      description: \"Indicates if the session was revoked successfully\"\n                    }\n                  },\n                  required: [\"status\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    const token = ctx.body.token;\n    const findSession = await ctx.context.internalAdapter.findSession(token);\n    if (!findSession) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Session not found\"\n      });\n    }\n    if (findSession.session.userId !== ctx.context.session.user.id) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\");\n    }\n    try {\n      await ctx.context.internalAdapter.deleteSession(token);\n    } catch (error) {\n      ctx.context.logger.error(\n        error && typeof error === \"object\" && \"name\" in error ? error.name : \"\",\n        error\n      );\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"INTERNAL_SERVER_ERROR\");\n    }\n    return ctx.json({\n      status: true\n    });\n  }\n);\nconst revokeSessions = createAuthEndpoint(\n  \"/revoke-sessions\",\n  {\n    method: \"POST\",\n    use: [sessionMiddleware],\n    requireHeaders: true,\n    metadata: {\n      openapi: {\n        description: \"Revoke all sessions for the user\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    status: {\n                      type: \"boolean\",\n                      description: \"Indicates if all sessions were revoked successfully\"\n                    }\n                  },\n                  required: [\"status\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    try {\n      await ctx.context.internalAdapter.deleteSessions(\n        ctx.context.session.user.id\n      );\n    } catch (error) {\n      ctx.context.logger.error(\n        error && typeof error === \"object\" && \"name\" in error ? error.name : \"\",\n        error\n      );\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"INTERNAL_SERVER_ERROR\");\n    }\n    return ctx.json({\n      status: true\n    });\n  }\n);\nconst revokeOtherSessions = createAuthEndpoint(\n  \"/revoke-other-sessions\",\n  {\n    method: \"POST\",\n    requireHeaders: true,\n    use: [sessionMiddleware],\n    metadata: {\n      openapi: {\n        description: \"Revoke all other sessions for the user except the current one\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    status: {\n                      type: \"boolean\",\n                      description: \"Indicates if all other sessions were revoked successfully\"\n                    }\n                  },\n                  required: [\"status\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    const session = ctx.context.session;\n    if (!session.user) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\");\n    }\n    const sessions = await ctx.context.internalAdapter.listSessions(\n      session.user.id\n    );\n    const activeSessions = sessions.filter((session2) => {\n      return session2.expiresAt > /* @__PURE__ */ new Date();\n    });\n    const otherSessions = activeSessions.filter(\n      (session2) => session2.token !== ctx.context.session.session.token\n    );\n    await Promise.all(\n      otherSessions.map(\n        (session2) => ctx.context.internalAdapter.deleteSession(session2.token)\n      )\n    );\n    return ctx.json({\n      status: true\n    });\n  }\n);\n\nasync function createEmailVerificationToken(secret, email, updateTo, expiresIn = 3600) {\n  const token = await (0,_crypto_index_mjs__WEBPACK_IMPORTED_MODULE_4__.signJWT)(\n    {\n      email: email.toLowerCase(),\n      updateTo\n    },\n    secret,\n    expiresIn\n  );\n  return token;\n}\nasync function sendVerificationEmailFn(ctx, user) {\n  if (!ctx.context.options.emailVerification?.sendVerificationEmail) {\n    ctx.context.logger.error(\"Verification email isn't enabled.\");\n    throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n      message: \"Verification email isn't enabled\"\n    });\n  }\n  const token = await createEmailVerificationToken(\n    ctx.context.secret,\n    user.email,\n    void 0,\n    ctx.context.options.emailVerification?.expiresIn\n  );\n  const url = `${ctx.context.baseURL}/verify-email?token=${token}&callbackURL=${ctx.body.callbackURL || \"/\"}`;\n  await ctx.context.options.emailVerification.sendVerificationEmail(\n    {\n      user,\n      url,\n      token\n    },\n    ctx.request\n  );\n}\nconst sendVerificationEmail = createAuthEndpoint(\n  \"/send-verification-email\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      email: zod_v4__WEBPACK_IMPORTED_MODULE_20__.email().meta({\n        description: \"The email to send the verification email to\"\n      }),\n      callbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The URL to use for email verification callback\"\n      }).optional()\n    }),\n    metadata: {\n      openapi: {\n        description: \"Send a verification email to the user\",\n        requestBody: {\n          content: {\n            \"application/json\": {\n              schema: {\n                type: \"object\",\n                properties: {\n                  email: {\n                    type: \"string\",\n                    description: \"The email to send the verification email to\",\n                    example: \"user@example.com\"\n                  },\n                  callbackURL: {\n                    type: \"string\",\n                    description: \"The URL to use for email verification callback\",\n                    example: \"https://example.com/callback\",\n                    nullable: true\n                  }\n                },\n                required: [\"email\"]\n              }\n            }\n          }\n        },\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    status: {\n                      type: \"boolean\",\n                      description: \"Indicates if the email was sent successfully\",\n                      example: true\n                    }\n                  }\n                }\n              }\n            }\n          },\n          \"400\": {\n            description: \"Bad Request\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    message: {\n                      type: \"string\",\n                      description: \"Error message\",\n                      example: \"Verification email isn't enabled\"\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    if (!ctx.context.options.emailVerification?.sendVerificationEmail) {\n      ctx.context.logger.error(\"Verification email isn't enabled.\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Verification email isn't enabled\"\n      });\n    }\n    const { email } = ctx.body;\n    const session = await getSessionFromCtx(ctx);\n    if (!session) {\n      const user = await ctx.context.internalAdapter.findUserByEmail(email);\n      if (!user) {\n        return ctx.json({\n          status: true\n        });\n      }\n      await sendVerificationEmailFn(ctx, user.user);\n      return ctx.json({\n        status: true\n      });\n    }\n    if (session?.user.emailVerified) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"You can only send a verification email to an unverified email\"\n      });\n    }\n    if (session?.user.email !== email) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"You can only send a verification email to your own email\"\n      });\n    }\n    await sendVerificationEmailFn(ctx, session.user);\n    return ctx.json({\n      status: true\n    });\n  }\n);\nconst verifyEmail = createAuthEndpoint(\n  \"/verify-email\",\n  {\n    method: \"GET\",\n    query: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      token: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The token to verify the email\"\n      }),\n      callbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The URL to redirect to after email verification\"\n      }).optional()\n    }),\n    use: [originCheck((ctx) => ctx.query.callbackURL)],\n    metadata: {\n      openapi: {\n        description: \"Verify the email of the user\",\n        parameters: [\n          {\n            name: \"token\",\n            in: \"query\",\n            description: \"The token to verify the email\",\n            required: true,\n            schema: {\n              type: \"string\"\n            }\n          },\n          {\n            name: \"callbackURL\",\n            in: \"query\",\n            description: \"The URL to redirect to after email verification\",\n            required: false,\n            schema: {\n              type: \"string\"\n            }\n          }\n        ],\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    user: {\n                      type: \"object\",\n                      properties: {\n                        id: {\n                          type: \"string\",\n                          description: \"User ID\"\n                        },\n                        email: {\n                          type: \"string\",\n                          description: \"User email\"\n                        },\n                        name: {\n                          type: \"string\",\n                          description: \"User name\"\n                        },\n                        image: {\n                          type: \"string\",\n                          description: \"User image URL\"\n                        },\n                        emailVerified: {\n                          type: \"boolean\",\n                          description: \"Indicates if the user email is verified\"\n                        },\n                        createdAt: {\n                          type: \"string\",\n                          description: \"User creation date\"\n                        },\n                        updatedAt: {\n                          type: \"string\",\n                          description: \"User update date\"\n                        }\n                      },\n                      required: [\n                        \"id\",\n                        \"email\",\n                        \"name\",\n                        \"image\",\n                        \"emailVerified\",\n                        \"createdAt\",\n                        \"updatedAt\"\n                      ]\n                    },\n                    status: {\n                      type: \"boolean\",\n                      description: \"Indicates if the email was verified successfully\"\n                    }\n                  },\n                  required: [\"user\", \"status\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    function redirectOnError(error) {\n      if (ctx.query.callbackURL) {\n        if (ctx.query.callbackURL.includes(\"?\")) {\n          throw ctx.redirect(`${ctx.query.callbackURL}&error=${error}`);\n        }\n        throw ctx.redirect(`${ctx.query.callbackURL}?error=${error}`);\n      }\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n        message: error\n      });\n    }\n    const { token } = ctx.query;\n    let jwt;\n    try {\n      jwt = await (0,jose__WEBPACK_IMPORTED_MODULE_22__.jwtVerify)(\n        token,\n        new TextEncoder().encode(ctx.context.secret),\n        {\n          algorithms: [\"HS256\"]\n        }\n      );\n    } catch (e) {\n      if (e instanceof jose_errors__WEBPACK_IMPORTED_MODULE_23__.JWTExpired) {\n        return redirectOnError(\"token_expired\");\n      }\n      return redirectOnError(\"invalid_token\");\n    }\n    const schema = zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      email: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().email(),\n      updateTo: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional()\n    });\n    const parsed = schema.parse(jwt.payload);\n    const user = await ctx.context.internalAdapter.findUserByEmail(\n      parsed.email\n    );\n    if (!user) {\n      return redirectOnError(\"user_not_found\");\n    }\n    if (parsed.updateTo) {\n      const session = await getSessionFromCtx(ctx);\n      if (!session) {\n        if (ctx.query.callbackURL) {\n          throw ctx.redirect(`${ctx.query.callbackURL}?error=unauthorized`);\n        }\n        return redirectOnError(\"unauthorized\");\n      }\n      if (session.user.email !== parsed.email) {\n        if (ctx.query.callbackURL) {\n          throw ctx.redirect(`${ctx.query.callbackURL}?error=unauthorized`);\n        }\n        return redirectOnError(\"unauthorized\");\n      }\n      const updatedUser2 = await ctx.context.internalAdapter.updateUserByEmail(\n        parsed.email,\n        {\n          email: parsed.updateTo,\n          emailVerified: false\n        },\n        ctx\n      );\n      const newToken = await createEmailVerificationToken(\n        ctx.context.secret,\n        parsed.updateTo\n      );\n      await ctx.context.options.emailVerification?.sendVerificationEmail?.(\n        {\n          user: updatedUser2,\n          url: `${ctx.context.baseURL}/verify-email?token=${newToken}&callbackURL=${ctx.query.callbackURL || \"/\"}`,\n          token: newToken\n        },\n        ctx.request\n      );\n      await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.setSessionCookie)(ctx, {\n        session: session.session,\n        user: {\n          ...session.user,\n          email: parsed.updateTo,\n          emailVerified: false\n        }\n      });\n      if (ctx.query.callbackURL) {\n        throw ctx.redirect(ctx.query.callbackURL);\n      }\n      return ctx.json({\n        status: true,\n        user: {\n          id: updatedUser2.id,\n          email: updatedUser2.email,\n          name: updatedUser2.name,\n          image: updatedUser2.image,\n          emailVerified: updatedUser2.emailVerified,\n          createdAt: updatedUser2.createdAt,\n          updatedAt: updatedUser2.updatedAt\n        }\n      });\n    }\n    if (ctx.context.options.emailVerification?.onEmailVerification) {\n      await ctx.context.options.emailVerification.onEmailVerification(\n        user.user,\n        ctx.request\n      );\n    }\n    const updatedUser = await ctx.context.internalAdapter.updateUserByEmail(\n      parsed.email,\n      {\n        emailVerified: true\n      },\n      ctx\n    );\n    if (ctx.context.options.emailVerification?.afterEmailVerification) {\n      await ctx.context.options.emailVerification.afterEmailVerification(\n        updatedUser,\n        ctx.request\n      );\n    }\n    if (ctx.context.options.emailVerification?.autoSignInAfterVerification) {\n      const currentSession = await getSessionFromCtx(ctx);\n      if (!currentSession || currentSession.user.email !== parsed.email) {\n        const session = await ctx.context.internalAdapter.createSession(\n          user.user.id,\n          ctx\n        );\n        if (!session) {\n          throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"INTERNAL_SERVER_ERROR\", {\n            message: \"Failed to create session\"\n          });\n        }\n        await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.setSessionCookie)(ctx, {\n          session,\n          user: {\n            ...user.user,\n            emailVerified: true\n          }\n        });\n      } else {\n        await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.setSessionCookie)(ctx, {\n          session: currentSession.session,\n          user: {\n            ...currentSession.user,\n            emailVerified: true\n          }\n        });\n      }\n    }\n    if (ctx.query.callbackURL) {\n      throw ctx.redirect(ctx.query.callbackURL);\n    }\n    return ctx.json({\n      status: true,\n      user: null\n    });\n  }\n);\n\nconst HIDE_METADATA = {\n  isAction: false\n};\n\nasync function generateState(c, link) {\n  const callbackURL = c.body?.callbackURL || c.context.options.baseURL;\n  if (!callbackURL) {\n    throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n      message: \"callbackURL is required\"\n    });\n  }\n  const codeVerifier = (0,_better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_8__.g)(128);\n  const state = (0,_better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_8__.g)(32);\n  const data = JSON.stringify({\n    callbackURL,\n    codeVerifier,\n    errorURL: c.body?.errorCallbackURL,\n    newUserURL: c.body?.newUserCallbackURL,\n    link,\n    /**\n     * This is the actual expiry time of the state\n     */\n    expiresAt: Date.now() + 10 * 60 * 1e3,\n    requestSignUp: c.body?.requestSignUp\n  });\n  const expiresAt = /* @__PURE__ */ new Date();\n  expiresAt.setMinutes(expiresAt.getMinutes() + 10);\n  const verification = await c.context.internalAdapter.createVerificationValue(\n    {\n      value: data,\n      identifier: state,\n      expiresAt\n    },\n    c\n  );\n  if (!verification) {\n    c.context.logger.error(\n      \"Unable to create verification. Make sure the database adapter is properly working and there is a verification table in the database\"\n    );\n    throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"INTERNAL_SERVER_ERROR\", {\n      message: \"Unable to create verification\"\n    });\n  }\n  return {\n    state: verification.identifier,\n    codeVerifier\n  };\n}\nasync function parseState(c) {\n  const state = c.query.state || c.body.state;\n  const data = await c.context.internalAdapter.findVerificationValue(state);\n  if (!data) {\n    c.context.logger.error(\"State Mismatch. Verification not found\", {\n      state\n    });\n    const errorURL = c.context.options.onAPIError?.errorURL || `${c.context.baseURL}/error`;\n    throw c.redirect(`${errorURL}?error=please_restart_the_process`);\n  }\n  const parsedData = zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n    callbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string(),\n    codeVerifier: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string(),\n    errorURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional(),\n    newUserURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional(),\n    expiresAt: zod_v4__WEBPACK_IMPORTED_MODULE_20__.number(),\n    link: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      email: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string(),\n      userId: zod_v4__WEBPACK_IMPORTED_MODULE_21__.string()\n    }).optional(),\n    requestSignUp: zod_v4__WEBPACK_IMPORTED_MODULE_20__.boolean().optional()\n  }).parse(JSON.parse(data.value));\n  if (!parsedData.errorURL) {\n    parsedData.errorURL = `${c.context.baseURL}/error`;\n  }\n  if (parsedData.expiresAt < Date.now()) {\n    await c.context.internalAdapter.deleteVerificationValue(data.id);\n    const errorURL = c.context.options.onAPIError?.errorURL || `${c.context.baseURL}/error`;\n    throw c.redirect(`${errorURL}?error=please_restart_the_process`);\n  }\n  await c.context.internalAdapter.deleteVerificationValue(data.id);\n  return parsedData;\n}\n\nasync function generateCodeChallenge(codeVerifier) {\n  const codeChallengeBytes = await (0,_better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_2__.createHash)(\"SHA-256\").digest(codeVerifier);\n  return _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_3__.base64Url.encode(new Uint8Array(codeChallengeBytes), {\n    padding: false\n  });\n}\nfunction getOAuth2Tokens(data) {\n  return {\n    tokenType: data.token_type,\n    accessToken: data.access_token,\n    refreshToken: data.refresh_token,\n    accessTokenExpiresAt: data.expires_in ? (0,_better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_1__.g)(data.expires_in, \"sec\") : void 0,\n    refreshTokenExpiresAt: data.refresh_token_expires_in ? (0,_better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_1__.g)(data.refresh_token_expires_in, \"sec\") : void 0,\n    scopes: data?.scope ? typeof data.scope === \"string\" ? data.scope.split(\" \") : data.scope : [],\n    idToken: data.id_token\n  };\n}\nconst encodeOAuthParameter = (value) => encodeURIComponent(value).replace(/%20/g, \"+\");\nfunction decryptOAuthToken(token, ctx) {\n  if (!token) return token;\n  if (ctx.options.account?.encryptOAuthTokens) {\n    return (0,_crypto_index_mjs__WEBPACK_IMPORTED_MODULE_4__.symmetricDecrypt)({\n      key: ctx.secret,\n      data: token\n    });\n  }\n  return token;\n}\nfunction setTokenUtil(token, ctx) {\n  if (ctx.options.account?.encryptOAuthTokens && token) {\n    return (0,_crypto_index_mjs__WEBPACK_IMPORTED_MODULE_4__.symmetricEncrypt)({\n      key: ctx.secret,\n      data: token\n    });\n  }\n  return token;\n}\n\nasync function handleOAuthUserInfo(c, {\n  userInfo,\n  account,\n  callbackURL,\n  disableSignUp,\n  overrideUserInfo\n}) {\n  const dbUser = await c.context.internalAdapter.findOAuthUser(\n    userInfo.email.toLowerCase(),\n    account.accountId,\n    account.providerId\n  ).catch((e) => {\n    _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_15__.a.error(\n      \"Better auth was unable to query your database.\\nError: \",\n      e\n    );\n    const errorURL = c.context.options.onAPIError?.errorURL || `${c.context.baseURL}/error`;\n    throw c.redirect(`${errorURL}?error=internal_server_error`);\n  });\n  let user = dbUser?.user;\n  let isRegister = !user;\n  if (dbUser) {\n    const hasBeenLinked = dbUser.accounts.find(\n      (a) => a.providerId === account.providerId && a.accountId === account.accountId\n    );\n    if (!hasBeenLinked) {\n      const trustedProviders = c.context.options.account?.accountLinking?.trustedProviders;\n      const isTrustedProvider = trustedProviders?.includes(\n        account.providerId\n      );\n      if (!isTrustedProvider && !userInfo.emailVerified || c.context.options.account?.accountLinking?.enabled === false) {\n        if (_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_17__.b) {\n          _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_15__.a.warn(\n            `User already exist but account isn't linked to ${account.providerId}. To read more about how account linking works in Better Auth see https://www.better-auth.com/docs/concepts/users-accounts#account-linking.`\n          );\n        }\n        return {\n          error: \"account not linked\",\n          data: null\n        };\n      }\n      try {\n        await c.context.internalAdapter.linkAccount(\n          {\n            providerId: account.providerId,\n            accountId: userInfo.id.toString(),\n            userId: dbUser.user.id,\n            accessToken: await setTokenUtil(account.accessToken, c.context),\n            refreshToken: await setTokenUtil(account.refreshToken, c.context),\n            idToken: account.idToken,\n            accessTokenExpiresAt: account.accessTokenExpiresAt,\n            refreshTokenExpiresAt: account.refreshTokenExpiresAt,\n            scope: account.scope\n          },\n          c\n        );\n      } catch (e) {\n        _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_15__.a.error(\"Unable to link account\", e);\n        return {\n          error: \"unable to link account\",\n          data: null\n        };\n      }\n    } else {\n      if (c.context.options.account?.updateAccountOnSignIn !== false) {\n        const updateData = Object.fromEntries(\n          Object.entries({\n            idToken: account.idToken,\n            accessToken: await setTokenUtil(account.accessToken, c.context),\n            refreshToken: await setTokenUtil(account.refreshToken, c.context),\n            accessTokenExpiresAt: account.accessTokenExpiresAt,\n            refreshTokenExpiresAt: account.refreshTokenExpiresAt,\n            scope: account.scope\n          }).filter(([_, value]) => value !== void 0)\n        );\n        if (Object.keys(updateData).length > 0) {\n          await c.context.internalAdapter.updateAccount(\n            hasBeenLinked.id,\n            updateData,\n            c\n          );\n        }\n      }\n    }\n    if (overrideUserInfo) {\n      const { id: _, ...restUserInfo } = userInfo;\n      await c.context.internalAdapter.updateUser(dbUser.user.id, {\n        ...restUserInfo,\n        email: userInfo.email.toLowerCase(),\n        emailVerified: userInfo.email.toLowerCase() === dbUser.user.email ? dbUser.user.emailVerified || userInfo.emailVerified : userInfo.emailVerified\n      });\n    }\n  } else {\n    if (disableSignUp) {\n      return {\n        error: \"signup disabled\",\n        data: null,\n        isRegister: false\n      };\n    }\n    try {\n      const { id: _, ...restUserInfo } = userInfo;\n      user = await c.context.internalAdapter.createOAuthUser(\n        {\n          ...restUserInfo,\n          email: userInfo.email.toLowerCase()\n        },\n        {\n          accessToken: await setTokenUtil(account.accessToken, c.context),\n          refreshToken: await setTokenUtil(account.refreshToken, c.context),\n          idToken: account.idToken,\n          accessTokenExpiresAt: account.accessTokenExpiresAt,\n          refreshTokenExpiresAt: account.refreshTokenExpiresAt,\n          scope: account.scope,\n          providerId: account.providerId,\n          accountId: userInfo.id.toString()\n        },\n        c\n      ).then((res) => res?.user);\n      if (!userInfo.emailVerified && user && c.context.options.emailVerification?.sendOnSignUp) {\n        const token = await createEmailVerificationToken(\n          c.context.secret,\n          user.email,\n          void 0,\n          c.context.options.emailVerification?.expiresIn\n        );\n        const url = `${c.context.baseURL}/verify-email?token=${token}&callbackURL=${callbackURL}`;\n        await c.context.options.emailVerification?.sendVerificationEmail?.(\n          {\n            user,\n            url,\n            token\n          },\n          c.request\n        );\n      }\n    } catch (e) {\n      _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_15__.a.error(e);\n      if (e instanceof better_call__WEBPACK_IMPORTED_MODULE_0__.APIError) {\n        return {\n          error: e.message,\n          data: null,\n          isRegister: false\n        };\n      }\n      return {\n        error: \"unable to create user\",\n        data: null,\n        isRegister: false\n      };\n    }\n  }\n  if (!user) {\n    return {\n      error: \"unable to create user\",\n      data: null,\n      isRegister: false\n    };\n  }\n  const session = await c.context.internalAdapter.createSession(user.id, c);\n  if (!session) {\n    return {\n      error: \"unable to create session\",\n      data: null,\n      isRegister: false\n    };\n  }\n  return {\n    data: {\n      session,\n      user\n    },\n    error: null,\n    isRegister\n  };\n}\n\nasync function createAuthorizationURL({\n  id,\n  options,\n  authorizationEndpoint,\n  state,\n  codeVerifier,\n  scopes,\n  claims,\n  redirectURI,\n  duration,\n  prompt,\n  accessType,\n  responseType,\n  display,\n  loginHint,\n  hd,\n  responseMode,\n  additionalParams,\n  scopeJoiner\n}) {\n  const url = new URL(authorizationEndpoint);\n  url.searchParams.set(\"response_type\", responseType || \"code\");\n  url.searchParams.set(\"client_id\", options.clientId);\n  url.searchParams.set(\"state\", state);\n  url.searchParams.set(\"scope\", scopes.join(scopeJoiner || \" \"));\n  url.searchParams.set(\"redirect_uri\", options.redirectURI || redirectURI);\n  duration && url.searchParams.set(\"duration\", duration);\n  display && url.searchParams.set(\"display\", display);\n  loginHint && url.searchParams.set(\"login_hint\", loginHint);\n  prompt && url.searchParams.set(\"prompt\", prompt);\n  hd && url.searchParams.set(\"hd\", hd);\n  accessType && url.searchParams.set(\"access_type\", accessType);\n  responseMode && url.searchParams.set(\"response_mode\", responseMode);\n  if (codeVerifier) {\n    const codeChallenge = await generateCodeChallenge(codeVerifier);\n    url.searchParams.set(\"code_challenge_method\", \"S256\");\n    url.searchParams.set(\"code_challenge\", codeChallenge);\n  }\n  if (claims) {\n    const claimsObj = claims.reduce(\n      (acc, claim) => {\n        acc[claim] = null;\n        return acc;\n      },\n      {}\n    );\n    url.searchParams.set(\n      \"claims\",\n      JSON.stringify({\n        id_token: { email: null, email_verified: null, ...claimsObj }\n      })\n    );\n  }\n  if (additionalParams) {\n    Object.entries(additionalParams).forEach(([key, value]) => {\n      url.searchParams.set(key, value);\n    });\n  }\n  return url;\n}\n\nasync function validateAuthorizationCode({\n  code,\n  codeVerifier,\n  redirectURI,\n  options,\n  tokenEndpoint,\n  authentication,\n  deviceId,\n  headers,\n  additionalParams = {}\n}) {\n  const body = new URLSearchParams();\n  const requestHeaders = {\n    \"content-type\": \"application/x-www-form-urlencoded\",\n    accept: \"application/json\",\n    \"user-agent\": \"better-auth\",\n    ...headers\n  };\n  body.set(\"grant_type\", \"authorization_code\");\n  body.set(\"code\", code);\n  codeVerifier && body.set(\"code_verifier\", codeVerifier);\n  options.clientKey && body.set(\"client_key\", options.clientKey);\n  deviceId && body.set(\"device_id\", deviceId);\n  body.set(\"redirect_uri\", options.redirectURI || redirectURI);\n  body.set(\"client_id\", options.clientId);\n  if (authentication === \"basic\") {\n    const encodedCredentials = _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_3__.base64.encode(\n      `${options.clientId}:${options.clientSecret}`\n    );\n    requestHeaders[\"authorization\"] = `Basic ${encodedCredentials}`;\n  } else {\n    body.set(\"client_secret\", options.clientSecret);\n  }\n  for (const [key, value] of Object.entries(additionalParams)) {\n    if (!body.has(key)) body.append(key, value);\n  }\n  const { data, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(tokenEndpoint, {\n    method: \"POST\",\n    body,\n    headers: requestHeaders\n  });\n  if (error) {\n    throw error;\n  }\n  const tokens = getOAuth2Tokens(data);\n  return tokens;\n}\nasync function validateToken(token, jwksEndpoint) {\n  const { data, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(jwksEndpoint, {\n    method: \"GET\",\n    headers: {\n      accept: \"application/json\",\n      \"user-agent\": \"better-auth\"\n    }\n  });\n  if (error) {\n    throw error;\n  }\n  const keys = data[\"keys\"];\n  const header = JSON.parse(atob(token.split(\".\")[0]));\n  const key = keys.find((key2) => key2.kid === header.kid);\n  if (!key) {\n    throw new Error(\"Key not found\");\n  }\n  const verified = await (0,jose__WEBPACK_IMPORTED_MODULE_22__.jwtVerify)(token, key);\n  return verified;\n}\n\nasync function refreshAccessToken({\n  refreshToken,\n  options,\n  tokenEndpoint,\n  authentication,\n  extraParams,\n  grantType = \"refresh_token\"\n}) {\n  const body = new URLSearchParams();\n  const headers = {\n    \"content-type\": \"application/x-www-form-urlencoded\",\n    accept: \"application/json\"\n  };\n  body.set(\"grant_type\", grantType);\n  body.set(\"refresh_token\", refreshToken);\n  if (authentication === \"basic\") {\n    headers[\"authorization\"] = _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_3__.base64.encode(\n      `${options.clientId}:${options.clientSecret}`\n    );\n  } else {\n    body.set(\"client_id\", options.clientId);\n    body.set(\"client_secret\", options.clientSecret);\n  }\n  if (extraParams) {\n    for (const [key, value] of Object.entries(extraParams)) {\n      body.set(key, value);\n    }\n  }\n  const { data, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(tokenEndpoint, {\n    method: \"POST\",\n    body,\n    headers\n  });\n  if (error) {\n    throw error;\n  }\n  const tokens = {\n    accessToken: data.access_token,\n    refreshToken: data.refresh_token,\n    tokenType: data.token_type,\n    scopes: data.scope?.split(\" \"),\n    idToken: data.id_token\n  };\n  if (data.expires_in) {\n    const now = /* @__PURE__ */ new Date();\n    tokens.accessTokenExpiresAt = new Date(\n      now.getTime() + data.expires_in * 1e3\n    );\n  }\n  return tokens;\n}\n\nconst apple = (options) => {\n  const tokenEndpoint = \"https://appleid.apple.com/auth/token\";\n  return {\n    id: \"apple\",\n    name: \"Apple\",\n    async createAuthorizationURL({ state, scopes, redirectURI }) {\n      const _scope = options.disableDefaultScope ? [] : [\"email\", \"name\"];\n      options.scope && _scope.push(...options.scope);\n      scopes && _scope.push(...scopes);\n      const url = await createAuthorizationURL({\n        id: \"apple\",\n        options,\n        authorizationEndpoint: \"https://appleid.apple.com/auth/authorize\",\n        scopes: _scope,\n        state,\n        redirectURI,\n        responseMode: \"form_post\",\n        responseType: \"code id_token\"\n      });\n      return url;\n    },\n    validateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        codeVerifier,\n        redirectURI,\n        options,\n        tokenEndpoint\n      });\n    },\n    async verifyIdToken(token, nonce) {\n      if (options.disableIdTokenSignIn) {\n        return false;\n      }\n      if (options.verifyIdToken) {\n        return options.verifyIdToken(token, nonce);\n      }\n      const decodedHeader = (0,jose__WEBPACK_IMPORTED_MODULE_24__.decodeProtectedHeader)(token);\n      const { kid, alg: jwtAlg } = decodedHeader;\n      if (!kid || !jwtAlg) return false;\n      const publicKey = await getApplePublicKey(kid);\n      const { payload: jwtClaims } = await (0,jose__WEBPACK_IMPORTED_MODULE_22__.jwtVerify)(token, publicKey, {\n        algorithms: [jwtAlg],\n        issuer: \"https://appleid.apple.com\",\n        audience: options.appBundleIdentifier || options.clientId,\n        maxTokenAge: \"1h\"\n      });\n      [\"email_verified\", \"is_private_email\"].forEach((field) => {\n        if (jwtClaims[field] !== void 0) {\n          jwtClaims[field] = Boolean(jwtClaims[field]);\n        }\n      });\n      if (nonce && jwtClaims.nonce !== nonce) {\n        return false;\n      }\n      return !!jwtClaims;\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://appleid.apple.com/auth/token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      if (!token.idToken) {\n        return null;\n      }\n      const profile = (0,jose__WEBPACK_IMPORTED_MODULE_25__.decodeJwt)(token.idToken);\n      if (!profile) {\n        return null;\n      }\n      const name = token.user ? `${token.user.name?.firstName} ${token.user.name?.lastName}` : profile.name || profile.email;\n      const emailVerified = typeof profile.email_verified === \"boolean\" ? profile.email_verified : profile.email_verified === \"true\";\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.sub,\n          name,\n          emailVerified,\n          email: profile.email,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\nconst getApplePublicKey = async (kid) => {\n  const APPLE_BASE_URL = \"https://appleid.apple.com\";\n  const JWKS_APPLE_URI = \"/auth/keys\";\n  const { data } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(`${APPLE_BASE_URL}${JWKS_APPLE_URI}`);\n  if (!data?.keys) {\n    throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n      message: \"Keys not found\"\n    });\n  }\n  const jwk = data.keys.find((key) => key.kid === kid);\n  if (!jwk) {\n    throw new Error(`JWK with kid ${kid} not found`);\n  }\n  return await (0,jose__WEBPACK_IMPORTED_MODULE_26__.importJWK)(jwk, jwk.alg);\n};\n\nconst discord = (options) => {\n  return {\n    id: \"discord\",\n    name: \"Discord\",\n    createAuthorizationURL({ state, scopes, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"identify\", \"email\"];\n      scopes && _scopes.push(...scopes);\n      options.scope && _scopes.push(...options.scope);\n      return new URL(\n        `https://discord.com/api/oauth2/authorize?scope=${_scopes.join(\n          \"+\"\n        )}&response_type=code&client_id=${options.clientId}&redirect_uri=${encodeURIComponent(\n          options.redirectURI || redirectURI\n        )}&state=${state}&prompt=${options.prompt || \"none\"}`\n      );\n    },\n    validateAuthorizationCode: async ({ code, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        redirectURI,\n        options,\n        tokenEndpoint: \"https://discord.com/api/oauth2/token\"\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://discord.com/api/oauth2/token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://discord.com/api/users/@me\",\n        {\n          headers: {\n            authorization: `Bearer ${token.accessToken}`\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      if (profile.avatar === null) {\n        const defaultAvatarNumber = profile.discriminator === \"0\" ? Number(BigInt(profile.id) >> BigInt(22)) % 6 : parseInt(profile.discriminator) % 5;\n        profile.image_url = `https://cdn.discordapp.com/embed/avatars/${defaultAvatarNumber}.png`;\n      } else {\n        const format = profile.avatar.startsWith(\"a_\") ? \"gif\" : \"png\";\n        profile.image_url = `https://cdn.discordapp.com/avatars/${profile.id}/${profile.avatar}.${format}`;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.id,\n          name: profile.global_name || profile.username || \"\",\n          email: profile.email,\n          emailVerified: profile.verified,\n          image: profile.image_url,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst facebook = (options) => {\n  return {\n    id: \"facebook\",\n    name: \"Facebook\",\n    async createAuthorizationURL({ state, scopes, redirectURI, loginHint }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"email\", \"public_profile\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return await createAuthorizationURL({\n        id: \"facebook\",\n        options,\n        authorizationEndpoint: \"https://www.facebook.com/v21.0/dialog/oauth\",\n        scopes: _scopes,\n        state,\n        redirectURI,\n        loginHint,\n        additionalParams: options.configId ? {\n          config_id: options.configId\n        } : {}\n      });\n    },\n    validateAuthorizationCode: async ({ code, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        redirectURI,\n        options,\n        tokenEndpoint: \"https://graph.facebook.com/oauth/access_token\"\n      });\n    },\n    async verifyIdToken(token, nonce) {\n      if (options.disableIdTokenSignIn) {\n        return false;\n      }\n      if (options.verifyIdToken) {\n        return options.verifyIdToken(token, nonce);\n      }\n      if (token.split(\".\").length === 3) {\n        try {\n          const { payload: jwtClaims } = await (0,jose__WEBPACK_IMPORTED_MODULE_22__.jwtVerify)(\n            token,\n            (0,jose__WEBPACK_IMPORTED_MODULE_27__.createRemoteJWKSet)(\n              // https://developers.facebook.com/docs/facebook-login/limited-login/token/#jwks\n              new URL(\n                \"https://limited.facebook.com/.well-known/oauth/openid/jwks/\"\n              )\n            ),\n            {\n              algorithms: [\"RS256\"],\n              audience: options.clientId,\n              issuer: \"https://www.facebook.com\"\n            }\n          );\n          if (nonce && jwtClaims.nonce !== nonce) {\n            return false;\n          }\n          return !!jwtClaims;\n        } catch (error) {\n          return false;\n        }\n      }\n      return true;\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://graph.facebook.com/v18.0/oauth/access_token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      if (token.idToken && token.idToken.split(\".\").length === 3) {\n        const profile2 = (0,jose__WEBPACK_IMPORTED_MODULE_25__.decodeJwt)(token.idToken);\n        const user = {\n          id: profile2.sub,\n          name: profile2.name,\n          email: profile2.email,\n          picture: {\n            data: {\n              url: profile2.picture,\n              height: 100,\n              width: 100,\n              is_silhouette: false\n            }\n          }\n        };\n        const userMap2 = await options.mapProfileToUser?.({\n          ...user,\n          email_verified: true\n        });\n        return {\n          user: {\n            ...user,\n            emailVerified: true,\n            ...userMap2\n          },\n          data: profile2\n        };\n      }\n      const fields = [\n        \"id\",\n        \"name\",\n        \"email\",\n        \"picture\",\n        ...options?.fields || []\n      ];\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://graph.facebook.com/me?fields=\" + fields.join(\",\"),\n        {\n          auth: {\n            type: \"Bearer\",\n            token: token.accessToken\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.id,\n          name: profile.name,\n          email: profile.email,\n          image: profile.picture.data.url,\n          emailVerified: profile.email_verified,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst github = (options) => {\n  const tokenEndpoint = \"https://github.com/login/oauth/access_token\";\n  return {\n    id: \"github\",\n    name: \"GitHub\",\n    createAuthorizationURL({ state, scopes, loginHint, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"read:user\", \"user:email\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return createAuthorizationURL({\n        id: \"github\",\n        options,\n        authorizationEndpoint: \"https://github.com/login/oauth/authorize\",\n        scopes: _scopes,\n        state,\n        redirectURI,\n        loginHint,\n        prompt: options.prompt\n      });\n    },\n    validateAuthorizationCode: async ({ code, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        redirectURI,\n        options,\n        tokenEndpoint\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://github.com/login/oauth/access_token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://api.github.com/user\",\n        {\n          headers: {\n            \"User-Agent\": \"better-auth\",\n            authorization: `Bearer ${token.accessToken}`\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      const { data: emails } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\"https://api.github.com/user/emails\", {\n        headers: {\n          Authorization: `Bearer ${token.accessToken}`,\n          \"User-Agent\": \"better-auth\"\n        }\n      });\n      if (!profile.email && emails) {\n        profile.email = (emails.find((e) => e.primary) ?? emails[0])?.email;\n      }\n      const emailVerified = emails?.find((e) => e.email === profile.email)?.verified ?? false;\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.id.toString(),\n          name: profile.name || profile.login,\n          email: profile.email,\n          image: profile.avatar_url,\n          emailVerified,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst google = (options) => {\n  return {\n    id: \"google\",\n    name: \"Google\",\n    async createAuthorizationURL({\n      state,\n      scopes,\n      codeVerifier,\n      redirectURI,\n      loginHint,\n      display\n    }) {\n      if (!options.clientId || !options.clientSecret) {\n        _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_15__.a.error(\n          \"Client Id and Client Secret is required for Google. Make sure to provide them in the options.\"\n        );\n        throw new _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_19__.B(\"CLIENT_ID_AND_SECRET_REQUIRED\");\n      }\n      if (!codeVerifier) {\n        throw new _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_19__.B(\"codeVerifier is required for Google\");\n      }\n      const _scopes = options.disableDefaultScope ? [] : [\"email\", \"profile\", \"openid\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      if (options.prompt === \"select_account+consent\")\n        options.prompt = \"select_account consent\";\n      const url = await createAuthorizationURL({\n        id: \"google\",\n        options,\n        authorizationEndpoint: \"https://accounts.google.com/o/oauth2/auth\",\n        scopes: _scopes,\n        state,\n        codeVerifier,\n        redirectURI,\n        prompt: options.prompt,\n        accessType: options.accessType,\n        display: display || options.display,\n        loginHint,\n        hd: options.hd,\n        additionalParams: {\n          include_granted_scopes: \"true\"\n        }\n      });\n      return url;\n    },\n    validateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        codeVerifier,\n        redirectURI,\n        options,\n        tokenEndpoint: \"https://oauth2.googleapis.com/token\"\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://www.googleapis.com/oauth2/v4/token\"\n      });\n    },\n    async verifyIdToken(token, nonce) {\n      if (options.disableIdTokenSignIn) {\n        return false;\n      }\n      if (options.verifyIdToken) {\n        return options.verifyIdToken(token, nonce);\n      }\n      const googlePublicKeyUrl = `https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=${token}`;\n      const { data: tokenInfo } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(googlePublicKeyUrl);\n      if (!tokenInfo) {\n        return false;\n      }\n      const isValid = tokenInfo.aud === options.clientId && (tokenInfo.iss === \"https://accounts.google.com\" || tokenInfo.iss === \"accounts.google.com\");\n      return isValid;\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      if (!token.idToken) {\n        return null;\n      }\n      const user = (0,jose__WEBPACK_IMPORTED_MODULE_25__.decodeJwt)(token.idToken);\n      const userMap = await options.mapProfileToUser?.(user);\n      return {\n        user: {\n          id: user.sub,\n          name: user.name,\n          email: user.email,\n          image: user.picture,\n          emailVerified: user.email_verified,\n          ...userMap\n        },\n        data: user\n      };\n    },\n    options\n  };\n};\n\nconst kick = (options) => {\n  return {\n    id: \"kick\",\n    name: \"Kick\",\n    createAuthorizationURL({ state, scopes, redirectURI, codeVerifier }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"user:read\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return createAuthorizationURL({\n        id: \"kick\",\n        redirectURI,\n        options,\n        authorizationEndpoint: \"https://id.kick.com/oauth/authorize\",\n        scopes: _scopes,\n        codeVerifier,\n        state\n      });\n    },\n    async validateAuthorizationCode({ code, redirectURI, codeVerifier }) {\n      return validateAuthorizationCode({\n        code,\n        redirectURI,\n        options,\n        tokenEndpoint: \"https://id.kick.com/oauth/token\",\n        codeVerifier\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\"https://api.kick.com/public/v1/users\", {\n        method: \"GET\",\n        headers: {\n          Authorization: `Bearer ${token.accessToken}`\n        }\n      });\n      if (error) {\n        return null;\n      }\n      const profile = data.data[0];\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.user_id,\n          name: profile.name,\n          email: profile.email,\n          image: profile.profile_picture,\n          emailVerified: true,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst huggingface = (options) => {\n  return {\n    id: \"huggingface\",\n    name: \"Hugging Face\",\n    createAuthorizationURL({ state, scopes, codeVerifier, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"openid\", \"profile\", \"email\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return createAuthorizationURL({\n        id: \"huggingface\",\n        options,\n        authorizationEndpoint: \"https://huggingface.co/oauth/authorize\",\n        scopes: _scopes,\n        state,\n        codeVerifier,\n        redirectURI\n      });\n    },\n    validateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        codeVerifier,\n        redirectURI,\n        options,\n        tokenEndpoint: \"https://huggingface.co/oauth/token\"\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://huggingface.co/oauth/token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://huggingface.co/oauth/userinfo\",\n        {\n          method: \"GET\",\n          headers: {\n            Authorization: `Bearer ${token.accessToken}`\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.sub,\n          name: profile.name || profile.preferred_username,\n          email: profile.email,\n          image: profile.picture,\n          emailVerified: profile.email_verified ?? false,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst microsoft = (options) => {\n  const tenant = options.tenantId || \"common\";\n  const authorizationEndpoint = `https://login.microsoftonline.com/${tenant}/oauth2/v2.0/authorize`;\n  const tokenEndpoint = `https://login.microsoftonline.com/${tenant}/oauth2/v2.0/token`;\n  return {\n    id: \"microsoft\",\n    name: \"Microsoft EntraID\",\n    createAuthorizationURL(data) {\n      const scopes = options.disableDefaultScope ? [] : [\"openid\", \"profile\", \"email\", \"User.Read\", \"offline_access\"];\n      options.scope && scopes.push(...options.scope);\n      data.scopes && scopes.push(...data.scopes);\n      return createAuthorizationURL({\n        id: \"microsoft\",\n        options,\n        authorizationEndpoint,\n        state: data.state,\n        codeVerifier: data.codeVerifier,\n        scopes,\n        redirectURI: data.redirectURI,\n        prompt: options.prompt\n      });\n    },\n    validateAuthorizationCode({ code, codeVerifier, redirectURI }) {\n      return validateAuthorizationCode({\n        code,\n        codeVerifier,\n        redirectURI,\n        options,\n        tokenEndpoint\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      if (!token.idToken) {\n        return null;\n      }\n      const user = (0,jose__WEBPACK_IMPORTED_MODULE_25__.decodeJwt)(token.idToken);\n      const profilePhotoSize = options.profilePhotoSize || 48;\n      await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        `https://graph.microsoft.com/v1.0/me/photos/${profilePhotoSize}x${profilePhotoSize}/$value`,\n        {\n          headers: {\n            Authorization: `Bearer ${token.accessToken}`\n          },\n          async onResponse(context) {\n            if (options.disableProfilePhoto || !context.response.ok) {\n              return;\n            }\n            try {\n              const response = context.response.clone();\n              const pictureBuffer = await response.arrayBuffer();\n              const pictureBase64 = _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_3__.base64.encode(pictureBuffer);\n              user.picture = `data:image/jpeg;base64, ${pictureBase64}`;\n            } catch (e) {\n              _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_15__.a.error(\n                e && typeof e === \"object\" && \"name\" in e ? e.name : \"\",\n                e\n              );\n            }\n          }\n        }\n      );\n      const userMap = await options.mapProfileToUser?.(user);\n      return {\n        user: {\n          id: user.sub,\n          name: user.name,\n          email: user.email,\n          image: user.picture,\n          emailVerified: true,\n          ...userMap\n        },\n        data: user\n      };\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      const scopes = options.disableDefaultScope ? [] : [\"openid\", \"profile\", \"email\", \"User.Read\", \"offline_access\"];\n      options.scope && scopes.push(...options.scope);\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientSecret: options.clientSecret\n        },\n        extraParams: {\n          scope: scopes.join(\" \")\n          // Include the scopes in request to microsoft\n        },\n        tokenEndpoint\n      });\n    },\n    options\n  };\n};\n\nconst slack = (options) => {\n  return {\n    id: \"slack\",\n    name: \"Slack\",\n    createAuthorizationURL({ state, scopes, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"openid\", \"profile\", \"email\"];\n      scopes && _scopes.push(...scopes);\n      options.scope && _scopes.push(...options.scope);\n      const url = new URL(\"https://slack.com/openid/connect/authorize\");\n      url.searchParams.set(\"scope\", _scopes.join(\" \"));\n      url.searchParams.set(\"response_type\", \"code\");\n      url.searchParams.set(\"client_id\", options.clientId);\n      url.searchParams.set(\"redirect_uri\", options.redirectURI || redirectURI);\n      url.searchParams.set(\"state\", state);\n      return url;\n    },\n    validateAuthorizationCode: async ({ code, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        redirectURI,\n        options,\n        tokenEndpoint: \"https://slack.com/api/openid.connect.token\"\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://slack.com/api/openid.connect.token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://slack.com/api/openid.connect.userInfo\",\n        {\n          headers: {\n            authorization: `Bearer ${token.accessToken}`\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile[\"https://slack.com/user_id\"],\n          name: profile.name || \"\",\n          email: profile.email,\n          emailVerified: profile.email_verified,\n          image: profile.picture || profile[\"https://slack.com/user_image_512\"],\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst notion = (options) => {\n  const tokenEndpoint = \"https://api.notion.com/v1/oauth/token\";\n  return {\n    id: \"notion\",\n    name: \"Notion\",\n    createAuthorizationURL({ state, scopes, loginHint, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return createAuthorizationURL({\n        id: \"notion\",\n        options,\n        authorizationEndpoint: \"https://api.notion.com/v1/oauth/authorize\",\n        scopes: _scopes,\n        state,\n        redirectURI,\n        loginHint,\n        additionalParams: {\n          owner: \"user\"\n        }\n      });\n    },\n    validateAuthorizationCode: async ({ code, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        redirectURI,\n        options,\n        tokenEndpoint,\n        authentication: \"basic\"\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\"https://api.notion.com/v1/users/me\", {\n        headers: {\n          Authorization: `Bearer ${token.accessToken}`,\n          \"Notion-Version\": \"2022-06-28\"\n        }\n      });\n      if (error || !profile) {\n        return null;\n      }\n      const userProfile = profile.bot?.owner?.user;\n      if (!userProfile) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(userProfile);\n      return {\n        user: {\n          id: userProfile.id,\n          name: userProfile.name || \"Notion User\",\n          email: userProfile.person?.email || null,\n          image: userProfile.avatar_url,\n          emailVerified: !!userProfile.person?.email,\n          ...userMap\n        },\n        data: userProfile\n      };\n    },\n    options\n  };\n};\n\nconst spotify = (options) => {\n  return {\n    id: \"spotify\",\n    name: \"Spotify\",\n    createAuthorizationURL({ state, scopes, codeVerifier, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"user-read-email\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return createAuthorizationURL({\n        id: \"spotify\",\n        options,\n        authorizationEndpoint: \"https://accounts.spotify.com/authorize\",\n        scopes: _scopes,\n        state,\n        codeVerifier,\n        redirectURI\n      });\n    },\n    validateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        codeVerifier,\n        redirectURI,\n        options,\n        tokenEndpoint: \"https://accounts.spotify.com/api/token\"\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://accounts.spotify.com/api/token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://api.spotify.com/v1/me\",\n        {\n          method: \"GET\",\n          headers: {\n            Authorization: `Bearer ${token.accessToken}`\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.id,\n          name: profile.display_name,\n          email: profile.email,\n          image: profile.images[0]?.url,\n          emailVerified: false,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst twitch = (options) => {\n  return {\n    id: \"twitch\",\n    name: \"Twitch\",\n    createAuthorizationURL({ state, scopes, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"user:read:email\", \"openid\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return createAuthorizationURL({\n        id: \"twitch\",\n        redirectURI,\n        options,\n        authorizationEndpoint: \"https://id.twitch.tv/oauth2/authorize\",\n        scopes: _scopes,\n        state,\n        claims: options.claims || [\n          \"email\",\n          \"email_verified\",\n          \"preferred_username\",\n          \"picture\"\n        ]\n      });\n    },\n    validateAuthorizationCode: async ({ code, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        redirectURI,\n        options,\n        tokenEndpoint: \"https://id.twitch.tv/oauth2/token\"\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://id.twitch.tv/oauth2/token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const idToken = token.idToken;\n      if (!idToken) {\n        _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_15__.a.error(\"No idToken found in token\");\n        return null;\n      }\n      const profile = (0,jose__WEBPACK_IMPORTED_MODULE_25__.decodeJwt)(idToken);\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.sub,\n          name: profile.preferred_username,\n          email: profile.email,\n          image: profile.picture,\n          emailVerified: profile.email_verified,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst twitter = (options) => {\n  return {\n    id: \"twitter\",\n    name: \"Twitter\",\n    createAuthorizationURL(data) {\n      const _scopes = options.disableDefaultScope ? [] : [\"users.read\", \"tweet.read\", \"offline.access\", \"users.email\"];\n      options.scope && _scopes.push(...options.scope);\n      data.scopes && _scopes.push(...data.scopes);\n      return createAuthorizationURL({\n        id: \"twitter\",\n        options,\n        authorizationEndpoint: \"https://x.com/i/oauth2/authorize\",\n        scopes: _scopes,\n        state: data.state,\n        codeVerifier: data.codeVerifier,\n        redirectURI: data.redirectURI\n      });\n    },\n    validateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        codeVerifier,\n        authentication: \"basic\",\n        redirectURI,\n        options,\n        tokenEndpoint: \"https://api.x.com/2/oauth2/token\"\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://api.x.com/2/oauth2/token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error: profileError } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://api.x.com/2/users/me?user.fields=profile_image_url\",\n        {\n          method: \"GET\",\n          headers: {\n            Authorization: `Bearer ${token.accessToken}`\n          }\n        }\n      );\n      if (profileError) {\n        return null;\n      }\n      const { data: emailData, error: emailError } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\"https://api.x.com/2/users/me?user.fields=confirmed_email\", {\n        method: \"GET\",\n        headers: {\n          Authorization: `Bearer ${token.accessToken}`\n        }\n      });\n      let emailVerified = false;\n      if (!emailError && emailData?.data?.confirmed_email) {\n        profile.data.email = emailData.data.confirmed_email;\n        emailVerified = true;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.data.id,\n          name: profile.data.name,\n          email: profile.data.email || profile.data.username || null,\n          image: profile.data.profile_image_url,\n          emailVerified,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst dropbox = (options) => {\n  const tokenEndpoint = \"https://api.dropboxapi.com/oauth2/token\";\n  return {\n    id: \"dropbox\",\n    name: \"Dropbox\",\n    createAuthorizationURL: async ({\n      state,\n      scopes,\n      codeVerifier,\n      redirectURI\n    }) => {\n      const _scopes = options.disableDefaultScope ? [] : [\"account_info.read\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      const additionalParams = {};\n      if (options.accessType) {\n        additionalParams.token_access_type = options.accessType;\n      }\n      return await createAuthorizationURL({\n        id: \"dropbox\",\n        options,\n        authorizationEndpoint: \"https://www.dropbox.com/oauth2/authorize\",\n        scopes: _scopes,\n        state,\n        redirectURI,\n        codeVerifier,\n        additionalParams\n      });\n    },\n    validateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n      return await validateAuthorizationCode({\n        code,\n        codeVerifier,\n        redirectURI,\n        options,\n        tokenEndpoint\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://api.dropbox.com/oauth2/token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://api.dropboxapi.com/2/users/get_current_account\",\n        {\n          method: \"POST\",\n          headers: {\n            Authorization: `Bearer ${token.accessToken}`\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.account_id,\n          name: profile.name?.display_name,\n          email: profile.email,\n          emailVerified: profile.email_verified || false,\n          image: profile.profile_photo_url,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst linear = (options) => {\n  const tokenEndpoint = \"https://api.linear.app/oauth/token\";\n  return {\n    id: \"linear\",\n    name: \"Linear\",\n    createAuthorizationURL({ state, scopes, loginHint, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"read\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return createAuthorizationURL({\n        id: \"linear\",\n        options,\n        authorizationEndpoint: \"https://linear.app/oauth/authorize\",\n        scopes: _scopes,\n        state,\n        redirectURI,\n        loginHint\n      });\n    },\n    validateAuthorizationCode: async ({ code, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        redirectURI,\n        options,\n        tokenEndpoint\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://api.linear.app/graphql\",\n        {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${token.accessToken}`\n          },\n          body: JSON.stringify({\n            query: `\n\t\t\t\t\t\t\tquery {\n\t\t\t\t\t\t\t\tviewer {\n\t\t\t\t\t\t\t\t\tid\n\t\t\t\t\t\t\t\t\tname\n\t\t\t\t\t\t\t\t\temail\n\t\t\t\t\t\t\t\t\tavatarUrl\n\t\t\t\t\t\t\t\t\tactive\n\t\t\t\t\t\t\t\t\tcreatedAt\n\t\t\t\t\t\t\t\t\tupdatedAt\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t`\n          })\n        }\n      );\n      if (error || !profile?.data?.viewer) {\n        return null;\n      }\n      const userData = profile.data.viewer;\n      const userMap = await options.mapProfileToUser?.(userData);\n      return {\n        user: {\n          id: profile.data.viewer.id,\n          name: profile.data.viewer.name,\n          email: profile.data.viewer.email,\n          image: profile.data.viewer.avatarUrl,\n          emailVerified: true,\n          ...userMap\n        },\n        data: userData\n      };\n    },\n    options\n  };\n};\n\nconst linkedin = (options) => {\n  const authorizationEndpoint = \"https://www.linkedin.com/oauth/v2/authorization\";\n  const tokenEndpoint = \"https://www.linkedin.com/oauth/v2/accessToken\";\n  return {\n    id: \"linkedin\",\n    name: \"Linkedin\",\n    createAuthorizationURL: async ({\n      state,\n      scopes,\n      redirectURI,\n      loginHint\n    }) => {\n      const _scopes = options.disableDefaultScope ? [] : [\"profile\", \"email\", \"openid\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return await createAuthorizationURL({\n        id: \"linkedin\",\n        options,\n        authorizationEndpoint,\n        scopes: _scopes,\n        state,\n        loginHint,\n        redirectURI\n      });\n    },\n    validateAuthorizationCode: async ({ code, redirectURI }) => {\n      return await validateAuthorizationCode({\n        code,\n        redirectURI,\n        options,\n        tokenEndpoint\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://api.linkedin.com/v2/userinfo\",\n        {\n          method: \"GET\",\n          headers: {\n            Authorization: `Bearer ${token.accessToken}`\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.sub,\n          name: profile.name,\n          email: profile.email,\n          emailVerified: profile.email_verified || false,\n          image: profile.picture,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst cleanDoubleSlashes = (input = \"\") => {\n  return input.split(\"://\").map((str) => str.replace(/\\/{2,}/g, \"/\")).join(\"://\");\n};\nconst issuerToEndpoints = (issuer) => {\n  let baseUrl = issuer || \"https://gitlab.com\";\n  return {\n    authorizationEndpoint: cleanDoubleSlashes(`${baseUrl}/oauth/authorize`),\n    tokenEndpoint: cleanDoubleSlashes(`${baseUrl}/oauth/token`),\n    userinfoEndpoint: cleanDoubleSlashes(`${baseUrl}/api/v4/user`)\n  };\n};\nconst gitlab = (options) => {\n  const { authorizationEndpoint, tokenEndpoint, userinfoEndpoint } = issuerToEndpoints(options.issuer);\n  const issuerId = \"gitlab\";\n  const issuerName = \"Gitlab\";\n  return {\n    id: issuerId,\n    name: issuerName,\n    createAuthorizationURL: async ({\n      state,\n      scopes,\n      codeVerifier,\n      loginHint,\n      redirectURI\n    }) => {\n      const _scopes = options.disableDefaultScope ? [] : [\"read_user\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return await createAuthorizationURL({\n        id: issuerId,\n        options,\n        authorizationEndpoint,\n        scopes: _scopes,\n        state,\n        redirectURI,\n        codeVerifier,\n        loginHint\n      });\n    },\n    validateAuthorizationCode: async ({ code, redirectURI, codeVerifier }) => {\n      return validateAuthorizationCode({\n        code,\n        redirectURI,\n        options,\n        codeVerifier,\n        tokenEndpoint\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://gitlab.com/oauth/token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        userinfoEndpoint,\n        { headers: { authorization: `Bearer ${token.accessToken}` } }\n      );\n      if (error || profile.state !== \"active\" || profile.locked) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.id.toString(),\n          name: profile.name ?? profile.username,\n          email: profile.email,\n          image: profile.avatar_url,\n          emailVerified: true,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst tiktok = (options) => {\n  return {\n    id: \"tiktok\",\n    name: \"TikTok\",\n    createAuthorizationURL({ state, scopes, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"user.info.profile\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return new URL(\n        `https://www.tiktok.com/v2/auth/authorize?scope=${_scopes.join(\n          \",\"\n        )}&response_type=code&client_key=${options.clientKey}&client_secret=${options.clientSecret}&redirect_uri=${encodeURIComponent(\n          options.redirectURI || redirectURI\n        )}&state=${state}`\n      );\n    },\n    validateAuthorizationCode: async ({ code, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        redirectURI: options.redirectURI || redirectURI,\n        options,\n        tokenEndpoint: \"https://open.tiktokapis.com/v2/oauth/token/\"\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://open.tiktokapis.com/v2/oauth/token/\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const fields = [\n        \"open_id\",\n        \"avatar_large_url\",\n        \"display_name\",\n        \"username\"\n      ];\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        `https://open.tiktokapis.com/v2/user/info/?fields=${fields.join(\",\")}`,\n        {\n          headers: {\n            authorization: `Bearer ${token.accessToken}`\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      return {\n        user: {\n          email: profile.data.user.email || profile.data.user.username,\n          id: profile.data.user.open_id,\n          name: profile.data.user.display_name || profile.data.user.username,\n          image: profile.data.user.avatar_large_url,\n          /** @note Tiktok does not provide emailVerified or even email*/\n          emailVerified: profile.data.user.email ? true : false\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst reddit = (options) => {\n  return {\n    id: \"reddit\",\n    name: \"Reddit\",\n    createAuthorizationURL({ state, scopes, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"identity\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return createAuthorizationURL({\n        id: \"reddit\",\n        options,\n        authorizationEndpoint: \"https://www.reddit.com/api/v1/authorize\",\n        scopes: _scopes,\n        state,\n        redirectURI,\n        duration: options.duration\n      });\n    },\n    validateAuthorizationCode: async ({ code, redirectURI }) => {\n      const body = new URLSearchParams({\n        grant_type: \"authorization_code\",\n        code,\n        redirect_uri: options.redirectURI || redirectURI\n      });\n      const headers = {\n        \"content-type\": \"application/x-www-form-urlencoded\",\n        accept: \"text/plain\",\n        \"user-agent\": \"better-auth\",\n        Authorization: `Basic ${_better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_3__.base64.encode(\n          `${options.clientId}:${options.clientSecret}`\n        )}`\n      };\n      const { data, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://www.reddit.com/api/v1/access_token\",\n        {\n          method: \"POST\",\n          headers,\n          body: body.toString()\n        }\n      );\n      if (error) {\n        throw error;\n      }\n      return getOAuth2Tokens(data);\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://www.reddit.com/api/v1/access_token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://oauth.reddit.com/api/v1/me\",\n        {\n          headers: {\n            Authorization: `Bearer ${token.accessToken}`,\n            \"User-Agent\": \"better-auth\"\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.id,\n          name: profile.name,\n          email: profile.oauth_client_id,\n          emailVerified: profile.has_verified_email,\n          image: profile.icon_img?.split(\"?\")[0],\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst roblox = (options) => {\n  return {\n    id: \"roblox\",\n    name: \"Roblox\",\n    createAuthorizationURL({ state, scopes, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"openid\", \"profile\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return new URL(\n        `https://apis.roblox.com/oauth/v1/authorize?scope=${_scopes.join(\n          \"+\"\n        )}&response_type=code&client_id=${options.clientId}&redirect_uri=${encodeURIComponent(\n          options.redirectURI || redirectURI\n        )}&state=${state}&prompt=${options.prompt || \"select_account+consent\"}`\n      );\n    },\n    validateAuthorizationCode: async ({ code, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        redirectURI: options.redirectURI || redirectURI,\n        options,\n        tokenEndpoint: \"https://apis.roblox.com/oauth/v1/token\",\n        authentication: \"post\"\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://apis.roblox.com/oauth/v1/token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://apis.roblox.com/oauth/v1/userinfo\",\n        {\n          headers: {\n            authorization: `Bearer ${token.accessToken}`\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.sub,\n          name: profile.nickname || profile.preferred_username || \"\",\n          image: profile.picture,\n          email: profile.preferred_username || null,\n          // Roblox does not provide email\n          emailVerified: true,\n          ...userMap\n        },\n        data: {\n          ...profile\n        }\n      };\n    },\n    options\n  };\n};\n\nvar LANG = /* @__PURE__ */ ((LANG2) => {\n  LANG2[LANG2[\"RUS\"] = 0] = \"RUS\";\n  LANG2[LANG2[\"UKR\"] = 1] = \"UKR\";\n  LANG2[LANG2[\"ENG\"] = 3] = \"ENG\";\n  LANG2[LANG2[\"SPA\"] = 4] = \"SPA\";\n  LANG2[LANG2[\"GERMAN\"] = 6] = \"GERMAN\";\n  LANG2[LANG2[\"POL\"] = 15] = \"POL\";\n  LANG2[LANG2[\"FRA\"] = 16] = \"FRA\";\n  LANG2[LANG2[\"TURKEY\"] = 82] = \"TURKEY\";\n  return LANG2;\n})(LANG || {});\nconst vk = (options) => {\n  return {\n    id: \"vk\",\n    name: \"VK\",\n    async createAuthorizationURL({ state, scopes, codeVerifier, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"email\", \"phone\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      const authorizationEndpoint = \"https://id.vk.com/authorize\";\n      return createAuthorizationURL({\n        id: \"vk\",\n        options,\n        authorizationEndpoint,\n        scopes: _scopes,\n        state,\n        redirectURI,\n        codeVerifier\n      });\n    },\n    validateAuthorizationCode: async ({\n      code,\n      codeVerifier,\n      redirectURI,\n      deviceId\n    }) => {\n      return validateAuthorizationCode({\n        code,\n        codeVerifier,\n        redirectURI: options.redirectURI || redirectURI,\n        options,\n        deviceId,\n        tokenEndpoint: \"https://id.vk.com/oauth2/auth\"\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://id.vk.com/oauth2/auth\"\n      });\n    },\n    async getUserInfo(data) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(data);\n      }\n      if (!data.accessToken) {\n        return null;\n      }\n      const formBody = new URLSearchParams({\n        access_token: data.accessToken,\n        client_id: options.clientId\n      }).toString();\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://id.vk.com/oauth2/user_info\",\n        {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/x-www-form-urlencoded\"\n          },\n          body: formBody\n        }\n      );\n      if (error) {\n        return null;\n      }\n      if (!profile.user.email) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.user.user_id,\n          first_name: profile.user.first_name,\n          last_name: profile.user.last_name,\n          email: profile.user.email,\n          image: profile.user.avatar,\n          /** @note VK does not provide emailVerified*/\n          emailVerified: !!profile.user.email,\n          birthday: profile.user.birthday,\n          sex: profile.user.sex,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst zoom = (userOptions) => {\n  const options = {\n    pkce: true,\n    ...userOptions\n  };\n  return {\n    id: \"zoom\",\n    name: \"Zoom\",\n    createAuthorizationURL: async ({ state, redirectURI, codeVerifier }) => {\n      const params = new URLSearchParams({\n        response_type: \"code\",\n        redirect_uri: options.redirectURI ? options.redirectURI : redirectURI,\n        client_id: options.clientId,\n        state\n      });\n      if (options.pkce) {\n        const codeChallenge = await generateCodeChallenge(codeVerifier);\n        params.set(\"code_challenge_method\", \"S256\");\n        params.set(\"code_challenge\", codeChallenge);\n      }\n      const url = new URL(\"https://zoom.us/oauth/authorize\");\n      url.search = params.toString();\n      return url;\n    },\n    validateAuthorizationCode: async ({ code, redirectURI, codeVerifier }) => {\n      return validateAuthorizationCode({\n        code,\n        redirectURI: options.redirectURI || redirectURI,\n        codeVerifier,\n        options,\n        tokenEndpoint: \"https://zoom.us/oauth/token\",\n        authentication: \"post\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://api.zoom.us/v2/users/me\",\n        {\n          headers: {\n            authorization: `Bearer ${token.accessToken}`\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.id,\n          name: profile.display_name,\n          image: profile.pic_url,\n          email: profile.email,\n          emailVerified: Boolean(profile.verified),\n          ...userMap\n        },\n        data: {\n          ...profile\n        }\n      };\n    }\n  };\n};\n\nconst socialProviders = {\n  apple,\n  discord,\n  facebook,\n  github,\n  microsoft,\n  google,\n  huggingface,\n  slack,\n  spotify,\n  twitch,\n  twitter,\n  dropbox,\n  kick,\n  linear,\n  linkedin,\n  gitlab,\n  tiktok,\n  reddit,\n  roblox,\n  vk,\n  zoom,\n  notion\n};\nconst socialProviderList = Object.keys(socialProviders);\nconst SocialProviderListEnum = zod_v4__WEBPACK_IMPORTED_MODULE_20__[\"enum\"](socialProviderList).or(zod_v4__WEBPACK_IMPORTED_MODULE_20__.string());\n\nconst signInSocial = createAuthEndpoint(\n  \"/sign-in/social\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      /**\n       * Callback URL to redirect to after the user\n       * has signed in.\n       */\n      callbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"Callback URL to redirect to after the user has signed in\"\n      }).optional(),\n      /**\n       * callback url to redirect if the user is newly registered.\n       *\n       * useful if you have different routes for existing users and new users\n       */\n      newUserCallbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional(),\n      /**\n       * Callback url to redirect to if an error happens\n       *\n       * If it's initiated from the client sdk this defaults to\n       * the current url.\n       */\n      errorCallbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"Callback URL to redirect to if an error happens\"\n      }).optional(),\n      /**\n       * OAuth2 provider to use`\n       */\n      provider: SocialProviderListEnum,\n      /**\n       * Disable automatic redirection to the provider\n       *\n       * This is useful if you want to handle the redirection\n       * yourself like in a popup or a different tab.\n       */\n      disableRedirect: zod_v4__WEBPACK_IMPORTED_MODULE_20__.boolean().meta({\n        description: \"Disable automatic redirection to the provider. Useful for handling the redirection yourself\"\n      }).optional(),\n      /**\n       * ID token from the provider\n       *\n       * This is used to sign in the user\n       * if the user is already signed in with the\n       * provider in the frontend.\n       *\n       * Only applicable if the provider supports\n       * it. Currently only `apple` and `google` is\n       * supported out of the box.\n       */\n      idToken: zod_v4__WEBPACK_IMPORTED_MODULE_20__.optional(\n        zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n          /**\n           * ID token from the provider\n           */\n          token: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n            description: \"ID token from the provider\"\n          }),\n          /**\n           * The nonce used to generate the token\n           */\n          nonce: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n            description: \"Nonce used to generate the token\"\n          }).optional(),\n          /**\n           * Access token from the provider\n           */\n          accessToken: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n            description: \"Access token from the provider\"\n          }).optional(),\n          /**\n           * Refresh token from the provider\n           */\n          refreshToken: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n            description: \"Refresh token from the provider\"\n          }).optional(),\n          /**\n           * Expiry date of the token\n           */\n          expiresAt: zod_v4__WEBPACK_IMPORTED_MODULE_20__.number().meta({\n            description: \"Expiry date of the token\"\n          }).optional()\n        })\n      ),\n      scopes: zod_v4__WEBPACK_IMPORTED_MODULE_20__.array(zod_v4__WEBPACK_IMPORTED_MODULE_20__.string()).meta({\n        description: \"Array of scopes to request from the provider. This will override the default scopes passed.\"\n      }).optional(),\n      /**\n       * Explicitly request sign-up\n       *\n       * Should be used to allow sign up when\n       * disableImplicitSignUp for this provider is\n       * true\n       */\n      requestSignUp: zod_v4__WEBPACK_IMPORTED_MODULE_20__.boolean().meta({\n        description: \"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider\"\n      }).optional(),\n      /**\n       * The login hint to use for the authorization code request\n       */\n      loginHint: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The login hint to use for the authorization code request\"\n      }).optional()\n    }),\n    metadata: {\n      openapi: {\n        description: \"Sign in with a social provider\",\n        operationId: \"socialSignIn\",\n        responses: {\n          \"200\": {\n            description: \"Success - Returns either session details or redirect URL\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  // todo: we need support for multiple schema\n                  type: \"object\",\n                  description: \"Session response when idToken is provided\",\n                  properties: {\n                    redirect: {\n                      type: \"boolean\",\n                      enum: [false]\n                    },\n                    token: {\n                      type: \"string\",\n                      description: \"Session token\",\n                      url: {\n                        type: \"null\",\n                        nullable: true\n                      },\n                      user: {\n                        type: \"object\",\n                        properties: {\n                          id: { type: \"string\" },\n                          email: { type: \"string\" },\n                          name: {\n                            type: \"string\",\n                            nullable: true\n                          },\n                          image: {\n                            type: \"string\",\n                            nullable: true\n                          },\n                          emailVerified: {\n                            type: \"boolean\"\n                          },\n                          createdAt: {\n                            type: \"string\",\n                            format: \"date-time\"\n                          },\n                          updatedAt: {\n                            type: \"string\",\n                            format: \"date-time\"\n                          }\n                        },\n                        required: [\n                          \"id\",\n                          \"email\",\n                          \"emailVerified\",\n                          \"createdAt\",\n                          \"updatedAt\"\n                        ]\n                      }\n                    }\n                  },\n                  required: [\"redirect\", \"token\", \"user\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (c) => {\n    const provider = c.context.socialProviders.find(\n      (p) => p.id === c.body.provider\n    );\n    if (!provider) {\n      c.context.logger.error(\n        \"Provider not found. Make sure to add the provider in your auth config\",\n        {\n          provider: c.body.provider\n        }\n      );\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"NOT_FOUND\", {\n        message: BASE_ERROR_CODES.PROVIDER_NOT_FOUND\n      });\n    }\n    if (c.body.idToken) {\n      if (!provider.verifyIdToken) {\n        c.context.logger.error(\n          \"Provider does not support id token verification\",\n          {\n            provider: c.body.provider\n          }\n        );\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"NOT_FOUND\", {\n          message: BASE_ERROR_CODES.ID_TOKEN_NOT_SUPPORTED\n        });\n      }\n      const { token, nonce } = c.body.idToken;\n      const valid = await provider.verifyIdToken(token, nonce);\n      if (!valid) {\n        c.context.logger.error(\"Invalid id token\", {\n          provider: c.body.provider\n        });\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n          message: BASE_ERROR_CODES.INVALID_TOKEN\n        });\n      }\n      const userInfo = await provider.getUserInfo({\n        idToken: token,\n        accessToken: c.body.idToken.accessToken,\n        refreshToken: c.body.idToken.refreshToken\n      });\n      if (!userInfo || !userInfo?.user) {\n        c.context.logger.error(\"Failed to get user info\", {\n          provider: c.body.provider\n        });\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n          message: BASE_ERROR_CODES.FAILED_TO_GET_USER_INFO\n        });\n      }\n      if (!userInfo.user.email) {\n        c.context.logger.error(\"User email not found\", {\n          provider: c.body.provider\n        });\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n          message: BASE_ERROR_CODES.USER_EMAIL_NOT_FOUND\n        });\n      }\n      const data = await handleOAuthUserInfo(c, {\n        userInfo: {\n          ...userInfo.user,\n          email: userInfo.user.email,\n          id: userInfo.user.id,\n          name: userInfo.user.name || \"\",\n          image: userInfo.user.image,\n          emailVerified: userInfo.user.emailVerified || false\n        },\n        account: {\n          providerId: provider.id,\n          accountId: userInfo.user.id,\n          accessToken: c.body.idToken.accessToken\n        },\n        callbackURL: c.body.callbackURL,\n        disableSignUp: provider.disableImplicitSignUp && !c.body.requestSignUp || provider.disableSignUp\n      });\n      if (data.error) {\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n          message: data.error\n        });\n      }\n      await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.setSessionCookie)(c, data.data);\n      return c.json({\n        redirect: false,\n        token: data.data.session.token,\n        url: void 0,\n        user: {\n          id: data.data.user.id,\n          email: data.data.user.email,\n          name: data.data.user.name,\n          image: data.data.user.image,\n          emailVerified: data.data.user.emailVerified,\n          createdAt: data.data.user.createdAt,\n          updatedAt: data.data.user.updatedAt\n        }\n      });\n    }\n    const { codeVerifier, state } = await generateState(c);\n    const url = await provider.createAuthorizationURL({\n      state,\n      codeVerifier,\n      redirectURI: `${c.context.baseURL}/callback/${provider.id}`,\n      scopes: c.body.scopes,\n      loginHint: c.body.loginHint\n    });\n    return c.json({\n      url: url.toString(),\n      redirect: !c.body.disableRedirect\n    });\n  }\n);\nconst signInEmail = createAuthEndpoint(\n  \"/sign-in/email\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      /**\n       * Email of the user\n       */\n      email: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"Email of the user\"\n      }),\n      /**\n       * Password of the user\n       */\n      password: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"Password of the user\"\n      }),\n      /**\n       * Callback URL to use as a redirect for email\n       * verification and for possible redirects\n       */\n      callbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"Callback URL to use as a redirect for email verification\"\n      }).optional(),\n      /**\n       * If this is false, the session will not be remembered\n       * @default true\n       */\n      rememberMe: zod_v4__WEBPACK_IMPORTED_MODULE_20__.boolean().meta({\n        description: \"If this is false, the session will not be remembered. Default is `true`.\"\n      }).default(true).optional()\n    }),\n    metadata: {\n      openapi: {\n        description: \"Sign in with email and password\",\n        responses: {\n          \"200\": {\n            description: \"Success - Returns either session details or redirect URL\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  // todo: we need support for multiple schema\n                  type: \"object\",\n                  description: \"Session response when idToken is provided\",\n                  properties: {\n                    redirect: {\n                      type: \"boolean\",\n                      enum: [false]\n                    },\n                    token: {\n                      type: \"string\",\n                      description: \"Session token\"\n                    },\n                    url: {\n                      type: \"null\",\n                      nullable: true\n                    },\n                    user: {\n                      type: \"object\",\n                      properties: {\n                        id: { type: \"string\" },\n                        email: { type: \"string\" },\n                        name: {\n                          type: \"string\",\n                          nullable: true\n                        },\n                        image: {\n                          type: \"string\",\n                          nullable: true\n                        },\n                        emailVerified: {\n                          type: \"boolean\"\n                        },\n                        createdAt: {\n                          type: \"string\",\n                          format: \"date-time\"\n                        },\n                        updatedAt: {\n                          type: \"string\",\n                          format: \"date-time\"\n                        }\n                      },\n                      required: [\n                        \"id\",\n                        \"email\",\n                        \"emailVerified\",\n                        \"createdAt\",\n                        \"updatedAt\"\n                      ]\n                    }\n                  },\n                  required: [\"redirect\", \"token\", \"user\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    if (!ctx.context.options?.emailAndPassword?.enabled) {\n      ctx.context.logger.error(\n        \"Email and password is not enabled. Make sure to enable it in the options on you `auth.ts` file. Check `https://better-auth.com/docs/authentication/email-password` for more!\"\n      );\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Email and password is not enabled\"\n      });\n    }\n    const { email, password } = ctx.body;\n    const isValidEmail = zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().email().safeParse(email);\n    if (!isValidEmail.success) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.INVALID_EMAIL\n      });\n    }\n    const user = await ctx.context.internalAdapter.findUserByEmail(email, {\n      includeAccounts: true\n    });\n    if (!user) {\n      await ctx.context.password.hash(password);\n      ctx.context.logger.error(\"User not found\", { email });\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n        message: BASE_ERROR_CODES.INVALID_EMAIL_OR_PASSWORD\n      });\n    }\n    const credentialAccount = user.accounts.find(\n      (a) => a.providerId === \"credential\"\n    );\n    if (!credentialAccount) {\n      ctx.context.logger.error(\"Credential account not found\", { email });\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n        message: BASE_ERROR_CODES.INVALID_EMAIL_OR_PASSWORD\n      });\n    }\n    const currentPassword = credentialAccount?.password;\n    if (!currentPassword) {\n      ctx.context.logger.error(\"Password not found\", { email });\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n        message: BASE_ERROR_CODES.INVALID_EMAIL_OR_PASSWORD\n      });\n    }\n    const validPassword = await ctx.context.password.verify({\n      hash: currentPassword,\n      password\n    });\n    if (!validPassword) {\n      ctx.context.logger.error(\"Invalid password\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n        message: BASE_ERROR_CODES.INVALID_EMAIL_OR_PASSWORD\n      });\n    }\n    if (ctx.context.options?.emailAndPassword?.requireEmailVerification && !user.user.emailVerified) {\n      if (!ctx.context.options?.emailVerification?.sendVerificationEmail) {\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"FORBIDDEN\", {\n          message: BASE_ERROR_CODES.EMAIL_NOT_VERIFIED\n        });\n      }\n      if (ctx.context.options?.emailVerification?.sendOnSignIn) {\n        const token = await createEmailVerificationToken(\n          ctx.context.secret,\n          user.user.email,\n          void 0,\n          ctx.context.options.emailVerification?.expiresIn\n        );\n        const url = `${ctx.context.baseURL}/verify-email?token=${token}&callbackURL=${ctx.body.callbackURL || \"/\"}`;\n        await ctx.context.options.emailVerification.sendVerificationEmail(\n          {\n            user: user.user,\n            url,\n            token\n          },\n          ctx.request\n        );\n      }\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"FORBIDDEN\", {\n        message: BASE_ERROR_CODES.EMAIL_NOT_VERIFIED\n      });\n    }\n    const session = await ctx.context.internalAdapter.createSession(\n      user.user.id,\n      ctx,\n      ctx.body.rememberMe === false\n    );\n    if (!session) {\n      ctx.context.logger.error(\"Failed to create session\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n        message: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION\n      });\n    }\n    await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.setSessionCookie)(\n      ctx,\n      {\n        session,\n        user: user.user\n      },\n      ctx.body.rememberMe === false\n    );\n    return ctx.json({\n      redirect: !!ctx.body.callbackURL,\n      token: session.token,\n      url: ctx.body.callbackURL,\n      user: {\n        id: user.user.id,\n        email: user.user.email,\n        name: user.user.name,\n        image: user.user.image,\n        emailVerified: user.user.emailVerified,\n        createdAt: user.user.createdAt,\n        updatedAt: user.user.updatedAt\n      }\n    });\n  }\n);\n\nconst schema = zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n  code: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional(),\n  error: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional(),\n  device_id: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional(),\n  error_description: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional(),\n  state: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional(),\n  user: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional()\n});\nconst callbackOAuth = createAuthEndpoint(\n  \"/callback/:id\",\n  {\n    method: [\"GET\", \"POST\"],\n    body: schema.optional(),\n    query: schema.optional(),\n    metadata: HIDE_METADATA\n  },\n  async (c) => {\n    let queryOrBody;\n    const defaultErrorURL = c.context.options.onAPIError?.errorURL || `${c.context.baseURL}/error`;\n    try {\n      if (c.method === \"GET\") {\n        queryOrBody = schema.parse(c.query);\n      } else if (c.method === \"POST\") {\n        queryOrBody = schema.parse(c.body);\n      } else {\n        throw new Error(\"Unsupported method\");\n      }\n    } catch (e) {\n      c.context.logger.error(\"INVALID_CALLBACK_REQUEST\", e);\n      throw c.redirect(`${defaultErrorURL}?error=invalid_callback_request`);\n    }\n    const { code, error, state, error_description, device_id } = queryOrBody;\n    if (error) {\n      throw c.redirect(\n        `${defaultErrorURL}?error=${error}&error_description=${error_description}`\n      );\n    }\n    if (!state) {\n      c.context.logger.error(\"State not found\", error);\n      throw c.redirect(`${defaultErrorURL}?error=state_not_found`);\n    }\n    const {\n      codeVerifier,\n      callbackURL,\n      link,\n      errorURL,\n      newUserURL,\n      requestSignUp\n    } = await parseState(c);\n    function redirectOnError(error2) {\n      let url = errorURL || defaultErrorURL;\n      if (url.includes(\"?\")) {\n        url = `${url}&error=${error2}`;\n      } else {\n        url = `${url}?error=${error2}`;\n      }\n      throw c.redirect(url);\n    }\n    if (!code) {\n      c.context.logger.error(\"Code not found\");\n      throw redirectOnError(\"no_code\");\n    }\n    const provider = c.context.socialProviders.find(\n      (p) => p.id === c.params.id\n    );\n    if (!provider) {\n      c.context.logger.error(\n        \"Oauth provider with id\",\n        c.params.id,\n        \"not found\"\n      );\n      throw redirectOnError(\"oauth_provider_not_found\");\n    }\n    let tokens;\n    try {\n      tokens = await provider.validateAuthorizationCode({\n        code,\n        codeVerifier,\n        deviceId: device_id,\n        redirectURI: `${c.context.baseURL}/callback/${provider.id}`\n      });\n    } catch (e) {\n      c.context.logger.error(\"\", e);\n      throw redirectOnError(\"invalid_code\");\n    }\n    const userInfo = await provider.getUserInfo({\n      ...tokens,\n      user: c.body?.user ? (0,_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_11__.s)(c.body.user) : void 0\n    }).then((res) => res?.user);\n    if (!userInfo) {\n      c.context.logger.error(\"Unable to get user info\");\n      return redirectOnError(\"unable_to_get_user_info\");\n    }\n    if (!callbackURL) {\n      c.context.logger.error(\"No callback URL found\");\n      throw redirectOnError(\"no_callback_url\");\n    }\n    if (link) {\n      const trustedProviders = c.context.options.account?.accountLinking?.trustedProviders;\n      const isTrustedProvider = trustedProviders?.includes(\n        provider.id\n      );\n      if (!isTrustedProvider && !userInfo.emailVerified || c.context.options.account?.accountLinking?.enabled === false) {\n        c.context.logger.error(\"Unable to link account - untrusted provider\");\n        return redirectOnError(\"unable_to_link_account\");\n      }\n      const existingAccount = await c.context.internalAdapter.findAccount(\n        userInfo.id\n      );\n      if (existingAccount) {\n        if (existingAccount.userId.toString() !== link.userId.toString()) {\n          return redirectOnError(\"account_already_linked_to_different_user\");\n        }\n        const updateData = Object.fromEntries(\n          Object.entries({\n            accessToken: await setTokenUtil(tokens.accessToken, c.context),\n            refreshToken: await setTokenUtil(tokens.refreshToken, c.context),\n            idToken: tokens.idToken,\n            accessTokenExpiresAt: tokens.accessTokenExpiresAt,\n            refreshTokenExpiresAt: tokens.refreshTokenExpiresAt,\n            scope: tokens.scopes?.join(\",\")\n          }).filter(([_, value]) => value !== void 0)\n        );\n        await c.context.internalAdapter.updateAccount(\n          existingAccount.id,\n          updateData\n        );\n      } else {\n        const newAccount = await c.context.internalAdapter.createAccount(\n          {\n            userId: link.userId,\n            providerId: provider.id,\n            accountId: userInfo.id,\n            ...tokens,\n            accessToken: await setTokenUtil(tokens.accessToken, c.context),\n            refreshToken: await setTokenUtil(tokens.refreshToken, c.context),\n            scope: tokens.scopes?.join(\",\")\n          },\n          c\n        );\n        if (!newAccount) {\n          return redirectOnError(\"unable_to_link_account\");\n        }\n      }\n      let toRedirectTo2;\n      try {\n        const url = callbackURL;\n        toRedirectTo2 = url.toString();\n      } catch {\n        toRedirectTo2 = callbackURL;\n      }\n      throw c.redirect(toRedirectTo2);\n    }\n    if (!userInfo.email) {\n      c.context.logger.error(\n        \"Provider did not return email. This could be due to misconfiguration in the provider settings.\"\n      );\n      return redirectOnError(\"email_not_found\");\n    }\n    const result = await handleOAuthUserInfo(c, {\n      userInfo: {\n        ...userInfo,\n        email: userInfo.email,\n        name: userInfo.name || userInfo.email\n      },\n      account: {\n        providerId: provider.id,\n        accountId: userInfo.id,\n        ...tokens,\n        scope: tokens.scopes?.join(\",\")\n      },\n      callbackURL,\n      disableSignUp: provider.disableImplicitSignUp && !requestSignUp || provider.options?.disableSignUp,\n      overrideUserInfo: provider.options?.overrideUserInfoOnSignIn\n    });\n    if (result.error) {\n      c.context.logger.error(result.error.split(\" \").join(\"_\"));\n      return redirectOnError(result.error.split(\" \").join(\"_\"));\n    }\n    const { session, user } = result.data;\n    await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.setSessionCookie)(c, {\n      session,\n      user\n    });\n    let toRedirectTo;\n    try {\n      const url = result.isRegister ? newUserURL || callbackURL : callbackURL;\n      toRedirectTo = url.toString();\n    } catch {\n      toRedirectTo = result.isRegister ? newUserURL || callbackURL : callbackURL;\n    }\n    throw c.redirect(toRedirectTo);\n  }\n);\n\nconst signOut = createAuthEndpoint(\n  \"/sign-out\",\n  {\n    method: \"POST\",\n    requireHeaders: true,\n    metadata: {\n      openapi: {\n        description: \"Sign out the current user\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    success: {\n                      type: \"boolean\"\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    const sessionCookieToken = await ctx.getSignedCookie(\n      ctx.context.authCookies.sessionToken.name,\n      ctx.context.secret\n    );\n    if (!sessionCookieToken) {\n      (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.deleteSessionCookie)(ctx);\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.FAILED_TO_GET_SESSION\n      });\n    }\n    await ctx.context.internalAdapter.deleteSession(sessionCookieToken);\n    (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.deleteSessionCookie)(ctx);\n    return ctx.json({\n      success: true\n    });\n  }\n);\n\nfunction redirectError(ctx, callbackURL, query) {\n  const url = callbackURL ? new URL(callbackURL, ctx.baseURL) : new URL(`${ctx.baseURL}/error`);\n  if (query)\n    Object.entries(query).forEach(([k, v]) => url.searchParams.set(k, v));\n  return url.href;\n}\nfunction redirectCallback(ctx, callbackURL, query) {\n  const url = new URL(callbackURL, ctx.baseURL);\n  if (query)\n    Object.entries(query).forEach(([k, v]) => url.searchParams.set(k, v));\n  return url.href;\n}\nconst requestPasswordReset = createAuthEndpoint(\n  \"/request-password-reset\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      /**\n       * The email address of the user to send a password reset email to.\n       */\n      email: zod_v4__WEBPACK_IMPORTED_MODULE_20__.email().meta({\n        description: \"The email address of the user to send a password reset email to\"\n      }),\n      /**\n       * The URL to redirect the user to reset their password.\n       * If the token isn't valid or expired, it'll be redirected with a query parameter `?\n       * error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?\n       * token=VALID_TOKEN\n       */\n      redirectTo: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN\"\n      }).optional()\n    }),\n    metadata: {\n      openapi: {\n        description: \"Send a password reset email to the user\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    status: {\n                      type: \"boolean\"\n                    },\n                    message: {\n                      type: \"string\"\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    if (!ctx.context.options.emailAndPassword?.sendResetPassword) {\n      ctx.context.logger.error(\n        \"Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!\"\n      );\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Reset password isn't enabled\"\n      });\n    }\n    const { email, redirectTo } = ctx.body;\n    const user = await ctx.context.internalAdapter.findUserByEmail(email, {\n      includeAccounts: true\n    });\n    if (!user) {\n      ctx.context.logger.error(\"Reset Password: User not found\", { email });\n      return ctx.json({\n        status: true,\n        message: \"If this email exists in our system, check your email for the reset link\"\n      });\n    }\n    const defaultExpiresIn = 60 * 60 * 1;\n    const expiresAt = (0,_better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_1__.g)(\n      ctx.context.options.emailAndPassword.resetPasswordTokenExpiresIn || defaultExpiresIn,\n      \"sec\"\n    );\n    const verificationToken = (0,_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_15__.g)(24);\n    await ctx.context.internalAdapter.createVerificationValue(\n      {\n        value: user.user.id,\n        identifier: `reset-password:${verificationToken}`,\n        expiresAt\n      },\n      ctx\n    );\n    const callbackURL = redirectTo ? encodeURIComponent(redirectTo) : \"\";\n    const url = `${ctx.context.baseURL}/reset-password/${verificationToken}?callbackURL=${callbackURL}`;\n    await ctx.context.options.emailAndPassword.sendResetPassword(\n      {\n        user: user.user,\n        url,\n        token: verificationToken\n      },\n      ctx.request\n    );\n    return ctx.json({\n      status: true\n    });\n  }\n);\nconst forgetPassword = createAuthEndpoint(\n  \"/forget-password\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      /**\n       * The email address of the user to send a password reset email to.\n       */\n      email: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().email().meta({\n        description: \"The email address of the user to send a password reset email to\"\n      }),\n      /**\n       * The URL to redirect the user to reset their password.\n       * If the token isn't valid or expired, it'll be redirected with a query parameter `?\n       * error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?\n       * token=VALID_TOKEN\n       */\n      redirectTo: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN\"\n      }).optional()\n    }),\n    metadata: {\n      openapi: {\n        description: \"Send a password reset email to the user\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    status: {\n                      type: \"boolean\"\n                    },\n                    message: {\n                      type: \"string\"\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    if (!ctx.context.options.emailAndPassword?.sendResetPassword) {\n      ctx.context.logger.error(\n        \"Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!\"\n      );\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Reset password isn't enabled\"\n      });\n    }\n    const { email, redirectTo } = ctx.body;\n    const user = await ctx.context.internalAdapter.findUserByEmail(email, {\n      includeAccounts: true\n    });\n    if (!user) {\n      ctx.context.logger.error(\"Reset Password: User not found\", { email });\n      return ctx.json({\n        status: true,\n        message: \"If this email exists in our system, check your email for the reset link\"\n      });\n    }\n    const defaultExpiresIn = 60 * 60 * 1;\n    const expiresAt = (0,_better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_1__.g)(\n      ctx.context.options.emailAndPassword.resetPasswordTokenExpiresIn || defaultExpiresIn,\n      \"sec\"\n    );\n    const verificationToken = (0,_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_15__.g)(24);\n    await ctx.context.internalAdapter.createVerificationValue(\n      {\n        value: user.user.id,\n        identifier: `reset-password:${verificationToken}`,\n        expiresAt\n      },\n      ctx\n    );\n    const callbackURL = redirectTo ? encodeURIComponent(redirectTo) : \"\";\n    const url = `${ctx.context.baseURL}/reset-password/${verificationToken}?callbackURL=${callbackURL}`;\n    await ctx.context.options.emailAndPassword.sendResetPassword(\n      {\n        user: user.user,\n        url,\n        token: verificationToken\n      },\n      ctx.request\n    );\n    return ctx.json({\n      status: true\n    });\n  }\n);\nconst requestPasswordResetCallback = createAuthEndpoint(\n  \"/reset-password/:token\",\n  {\n    method: \"GET\",\n    query: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      callbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The URL to redirect the user to reset their password\"\n      })\n    }),\n    use: [originCheck((ctx) => ctx.query.callbackURL)],\n    metadata: {\n      openapi: {\n        description: \"Redirects the user to the callback URL with the token\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    token: {\n                      type: \"string\"\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    const { token } = ctx.params;\n    const { callbackURL } = ctx.query;\n    if (!token || !callbackURL) {\n      throw ctx.redirect(\n        redirectError(ctx.context, callbackURL, { error: \"INVALID_TOKEN\" })\n      );\n    }\n    const verification = await ctx.context.internalAdapter.findVerificationValue(\n      `reset-password:${token}`\n    );\n    if (!verification || verification.expiresAt < /* @__PURE__ */ new Date()) {\n      throw ctx.redirect(\n        redirectError(ctx.context, callbackURL, { error: \"INVALID_TOKEN\" })\n      );\n    }\n    throw ctx.redirect(redirectCallback(ctx.context, callbackURL, { token }));\n  }\n);\nconst forgetPasswordCallback = requestPasswordResetCallback;\nconst resetPassword = createAuthEndpoint(\n  \"/reset-password\",\n  {\n    method: \"POST\",\n    query: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      token: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional()\n    }).optional(),\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      newPassword: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The new password to set\"\n      }),\n      token: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The token to reset the password\"\n      }).optional()\n    }),\n    metadata: {\n      openapi: {\n        description: \"Reset the password for a user\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    status: {\n                      type: \"boolean\"\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    const token = ctx.body.token || ctx.query?.token;\n    if (!token) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.INVALID_TOKEN\n      });\n    }\n    const { newPassword } = ctx.body;\n    const minLength = ctx.context.password?.config.minPasswordLength;\n    const maxLength = ctx.context.password?.config.maxPasswordLength;\n    if (newPassword.length < minLength) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.PASSWORD_TOO_SHORT\n      });\n    }\n    if (newPassword.length > maxLength) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.PASSWORD_TOO_LONG\n      });\n    }\n    const id = `reset-password:${token}`;\n    const verification = await ctx.context.internalAdapter.findVerificationValue(id);\n    if (!verification || verification.expiresAt < /* @__PURE__ */ new Date()) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.INVALID_TOKEN\n      });\n    }\n    const userId = verification.value;\n    const hashedPassword = await ctx.context.password.hash(newPassword);\n    const accounts = await ctx.context.internalAdapter.findAccounts(userId);\n    const account = accounts.find((ac) => ac.providerId === \"credential\");\n    if (!account) {\n      await ctx.context.internalAdapter.createAccount(\n        {\n          userId,\n          providerId: \"credential\",\n          password: hashedPassword,\n          accountId: userId\n        },\n        ctx\n      );\n    } else {\n      await ctx.context.internalAdapter.updatePassword(\n        userId,\n        hashedPassword,\n        ctx\n      );\n    }\n    await ctx.context.internalAdapter.deleteVerificationValue(verification.id);\n    if (ctx.context.options.emailAndPassword?.onPasswordReset) {\n      const user = await ctx.context.internalAdapter.findUserById(userId);\n      if (user) {\n        await ctx.context.options.emailAndPassword.onPasswordReset(\n          {\n            user\n          },\n          ctx.request\n        );\n      }\n    }\n    if (ctx.context.options.emailAndPassword?.revokeSessionsOnPasswordReset) {\n      await ctx.context.internalAdapter.deleteSessions(userId);\n    }\n    return ctx.json({\n      status: true\n    });\n  }\n);\n\nconst updateUser = () => createAuthEndpoint(\n  \"/update-user\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.record(\n      zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"Field name must be a string\"\n      }),\n      zod_v4__WEBPACK_IMPORTED_MODULE_20__.any()\n    ),\n    use: [sessionMiddleware],\n    metadata: {\n      $Infer: {\n        body: {}\n      },\n      openapi: {\n        description: \"Update the current user\",\n        requestBody: {\n          content: {\n            \"application/json\": {\n              schema: {\n                type: \"object\",\n                properties: {\n                  name: {\n                    type: \"string\",\n                    description: \"The name of the user\"\n                  },\n                  image: {\n                    type: \"string\",\n                    description: \"The image of the user\"\n                  }\n                }\n              }\n            }\n          }\n        },\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    status: {\n                      type: \"boolean\",\n                      description: \"Indicates if the update was successful\"\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    const body = ctx.body;\n    if (body.email) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.EMAIL_CAN_NOT_BE_UPDATED\n      });\n    }\n    const { name, image, ...rest } = body;\n    const session = ctx.context.session;\n    if (image === void 0 && name === void 0 && Object.keys(rest).length === 0) {\n      return ctx.json({\n        status: true\n      });\n    }\n    const additionalFields = (0,_better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_16__.f)(\n      ctx.context.options,\n      rest,\n      \"update\"\n    );\n    const user = await ctx.context.internalAdapter.updateUser(\n      session.user.id,\n      {\n        name,\n        image,\n        ...additionalFields\n      },\n      ctx\n    );\n    await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.setSessionCookie)(ctx, {\n      session: session.session,\n      user\n    });\n    return ctx.json({\n      status: true\n    });\n  }\n);\nconst changePassword = createAuthEndpoint(\n  \"/change-password\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      /**\n       * The new password to set\n       */\n      newPassword: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The new password to set\"\n      }),\n      /**\n       * The current password of the user\n       */\n      currentPassword: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The current password is required\"\n      }),\n      /**\n       * revoke all sessions that are not the\n       * current one logged in by the user\n       */\n      revokeOtherSessions: zod_v4__WEBPACK_IMPORTED_MODULE_20__.boolean().meta({\n        description: \"Must be a boolean value\"\n      }).optional()\n    }),\n    use: [sessionMiddleware],\n    metadata: {\n      openapi: {\n        description: \"Change the password of the user\",\n        responses: {\n          \"200\": {\n            description: \"Password successfully changed\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    token: {\n                      type: \"string\",\n                      nullable: true,\n                      // Only present if revokeOtherSessions is true\n                      description: \"New session token if other sessions were revoked\"\n                    },\n                    user: {\n                      type: \"object\",\n                      properties: {\n                        id: {\n                          type: \"string\",\n                          description: \"The unique identifier of the user\"\n                        },\n                        email: {\n                          type: \"string\",\n                          format: \"email\",\n                          description: \"The email address of the user\"\n                        },\n                        name: {\n                          type: \"string\",\n                          description: \"The name of the user\"\n                        },\n                        image: {\n                          type: \"string\",\n                          format: \"uri\",\n                          nullable: true,\n                          description: \"The profile image URL of the user\"\n                        },\n                        emailVerified: {\n                          type: \"boolean\",\n                          description: \"Whether the email has been verified\"\n                        },\n                        createdAt: {\n                          type: \"string\",\n                          format: \"date-time\",\n                          description: \"When the user was created\"\n                        },\n                        updatedAt: {\n                          type: \"string\",\n                          format: \"date-time\",\n                          description: \"When the user was last updated\"\n                        }\n                      },\n                      required: [\n                        \"id\",\n                        \"email\",\n                        \"name\",\n                        \"emailVerified\",\n                        \"createdAt\",\n                        \"updatedAt\"\n                      ]\n                    }\n                  },\n                  required: [\"user\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    const { newPassword, currentPassword, revokeOtherSessions } = ctx.body;\n    const session = ctx.context.session;\n    const minPasswordLength = ctx.context.password.config.minPasswordLength;\n    if (newPassword.length < minPasswordLength) {\n      ctx.context.logger.error(\"Password is too short\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.PASSWORD_TOO_SHORT\n      });\n    }\n    const maxPasswordLength = ctx.context.password.config.maxPasswordLength;\n    if (newPassword.length > maxPasswordLength) {\n      ctx.context.logger.error(\"Password is too long\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.PASSWORD_TOO_LONG\n      });\n    }\n    const accounts = await ctx.context.internalAdapter.findAccounts(\n      session.user.id\n    );\n    const account = accounts.find(\n      (account2) => account2.providerId === \"credential\" && account2.password\n    );\n    if (!account || !account.password) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.CREDENTIAL_ACCOUNT_NOT_FOUND\n      });\n    }\n    const passwordHash = await ctx.context.password.hash(newPassword);\n    const verify = await ctx.context.password.verify({\n      hash: account.password,\n      password: currentPassword\n    });\n    if (!verify) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.INVALID_PASSWORD\n      });\n    }\n    await ctx.context.internalAdapter.updateAccount(account.id, {\n      password: passwordHash\n    });\n    let token = null;\n    if (revokeOtherSessions) {\n      await ctx.context.internalAdapter.deleteSessions(session.user.id);\n      const newSession = await ctx.context.internalAdapter.createSession(\n        session.user.id,\n        ctx\n      );\n      if (!newSession) {\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"INTERNAL_SERVER_ERROR\", {\n          message: BASE_ERROR_CODES.FAILED_TO_GET_SESSION\n        });\n      }\n      await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.setSessionCookie)(ctx, {\n        session: newSession,\n        user: session.user\n      });\n      token = newSession.token;\n    }\n    return ctx.json({\n      token,\n      user: {\n        id: session.user.id,\n        email: session.user.email,\n        name: session.user.name,\n        image: session.user.image,\n        emailVerified: session.user.emailVerified,\n        createdAt: session.user.createdAt,\n        updatedAt: session.user.updatedAt\n      }\n    });\n  }\n);\nconst setPassword = createAuthEndpoint(\n  \"/set-password\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      /**\n       * The new password to set\n       */\n      newPassword: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The new password to set is required\"\n      })\n    }),\n    metadata: {\n      SERVER_ONLY: true\n    },\n    use: [sessionMiddleware]\n  },\n  async (ctx) => {\n    const { newPassword } = ctx.body;\n    const session = ctx.context.session;\n    const minPasswordLength = ctx.context.password.config.minPasswordLength;\n    if (newPassword.length < minPasswordLength) {\n      ctx.context.logger.error(\"Password is too short\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.PASSWORD_TOO_SHORT\n      });\n    }\n    const maxPasswordLength = ctx.context.password.config.maxPasswordLength;\n    if (newPassword.length > maxPasswordLength) {\n      ctx.context.logger.error(\"Password is too long\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.PASSWORD_TOO_LONG\n      });\n    }\n    const accounts = await ctx.context.internalAdapter.findAccounts(\n      session.user.id\n    );\n    const account = accounts.find(\n      (account2) => account2.providerId === \"credential\" && account2.password\n    );\n    const passwordHash = await ctx.context.password.hash(newPassword);\n    if (!account) {\n      await ctx.context.internalAdapter.linkAccount(\n        {\n          userId: session.user.id,\n          providerId: \"credential\",\n          accountId: session.user.id,\n          password: passwordHash\n        },\n        ctx\n      );\n      return ctx.json({\n        status: true\n      });\n    }\n    throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n      message: \"user already has a password\"\n    });\n  }\n);\nconst deleteUser = createAuthEndpoint(\n  \"/delete-user\",\n  {\n    method: \"POST\",\n    use: [sessionMiddleware],\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      /**\n       * The callback URL to redirect to after the user is deleted\n       * this is only used on delete user callback\n       */\n      callbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The callback URL to redirect to after the user is deleted\"\n      }).optional(),\n      /**\n       * The password of the user. If the password isn't provided, session freshness\n       * will be checked.\n       */\n      password: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The password of the user is required to delete the user\"\n      }).optional(),\n      /**\n       * The token to delete the user. If the token is provided, the user will be deleted\n       */\n      token: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The token to delete the user is required\"\n      }).optional()\n    }),\n    metadata: {\n      openapi: {\n        description: \"Delete the user\",\n        responses: {\n          \"200\": {\n            description: \"User deletion processed successfully\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    success: {\n                      type: \"boolean\",\n                      description: \"Indicates if the operation was successful\"\n                    },\n                    message: {\n                      type: \"string\",\n                      enum: [\"User deleted\", \"Verification email sent\"],\n                      description: \"Status message of the deletion process\"\n                    }\n                  },\n                  required: [\"success\", \"message\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    if (!ctx.context.options.user?.deleteUser?.enabled) {\n      ctx.context.logger.error(\n        \"Delete user is disabled. Enable it in the options\",\n        {\n          session: ctx.context.session\n        }\n      );\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"NOT_FOUND\");\n    }\n    const session = ctx.context.session;\n    if (ctx.body.password) {\n      const accounts = await ctx.context.internalAdapter.findAccounts(\n        session.user.id\n      );\n      const account = accounts.find(\n        (account2) => account2.providerId === \"credential\" && account2.password\n      );\n      if (!account || !account.password) {\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n          message: BASE_ERROR_CODES.CREDENTIAL_ACCOUNT_NOT_FOUND\n        });\n      }\n      const verify = await ctx.context.password.verify({\n        hash: account.password,\n        password: ctx.body.password\n      });\n      if (!verify) {\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n          message: BASE_ERROR_CODES.INVALID_PASSWORD\n        });\n      }\n    }\n    if (ctx.body.token) {\n      await deleteUserCallback({\n        ...ctx,\n        query: {\n          token: ctx.body.token\n        }\n      });\n      return ctx.json({\n        success: true,\n        message: \"User deleted\"\n      });\n    }\n    if (ctx.context.options.user.deleteUser?.sendDeleteAccountVerification) {\n      const token = (0,_better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_8__.g)(32, \"0-9\", \"a-z\");\n      await ctx.context.internalAdapter.createVerificationValue(\n        {\n          value: session.user.id,\n          identifier: `delete-account-${token}`,\n          expiresAt: new Date(\n            Date.now() + (ctx.context.options.user.deleteUser?.deleteTokenExpiresIn || 60 * 60 * 24) * 1e3\n          )\n        },\n        ctx\n      );\n      const url = `${ctx.context.baseURL}/delete-user/callback?token=${token}&callbackURL=${ctx.body.callbackURL || \"/\"}`;\n      await ctx.context.options.user.deleteUser.sendDeleteAccountVerification(\n        {\n          user: session.user,\n          url,\n          token\n        },\n        ctx.request\n      );\n      return ctx.json({\n        success: true,\n        message: \"Verification email sent\"\n      });\n    }\n    if (!ctx.body.password && ctx.context.sessionConfig.freshAge !== 0) {\n      const currentAge = session.session.createdAt.getTime();\n      const freshAge = ctx.context.sessionConfig.freshAge * 1e3;\n      const now = Date.now();\n      if (now - currentAge > freshAge * 1e3) {\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n          message: BASE_ERROR_CODES.SESSION_EXPIRED\n        });\n      }\n    }\n    const beforeDelete = ctx.context.options.user.deleteUser?.beforeDelete;\n    if (beforeDelete) {\n      await beforeDelete(session.user, ctx.request);\n    }\n    await ctx.context.internalAdapter.deleteUser(session.user.id);\n    await ctx.context.internalAdapter.deleteSessions(session.user.id);\n    await ctx.context.internalAdapter.deleteAccounts(session.user.id);\n    (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.deleteSessionCookie)(ctx);\n    const afterDelete = ctx.context.options.user.deleteUser?.afterDelete;\n    if (afterDelete) {\n      await afterDelete(session.user, ctx.request);\n    }\n    return ctx.json({\n      success: true,\n      message: \"User deleted\"\n    });\n  }\n);\nconst deleteUserCallback = createAuthEndpoint(\n  \"/delete-user/callback\",\n  {\n    method: \"GET\",\n    query: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      token: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The token to verify the deletion request\"\n      }),\n      callbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The URL to redirect to after deletion\"\n      }).optional()\n    }),\n    use: [originCheck((ctx) => ctx.query.callbackURL)],\n    metadata: {\n      openapi: {\n        description: \"Callback to complete user deletion with verification token\",\n        responses: {\n          \"200\": {\n            description: \"User successfully deleted\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    success: {\n                      type: \"boolean\",\n                      description: \"Indicates if the deletion was successful\"\n                    },\n                    message: {\n                      type: \"string\",\n                      enum: [\"User deleted\"],\n                      description: \"Confirmation message\"\n                    }\n                  },\n                  required: [\"success\", \"message\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    if (!ctx.context.options.user?.deleteUser?.enabled) {\n      ctx.context.logger.error(\n        \"Delete user is disabled. Enable it in the options\"\n      );\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"NOT_FOUND\");\n    }\n    const session = await getSessionFromCtx(ctx);\n    if (!session) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"NOT_FOUND\", {\n        message: BASE_ERROR_CODES.FAILED_TO_GET_USER_INFO\n      });\n    }\n    const token = await ctx.context.internalAdapter.findVerificationValue(\n      `delete-account-${ctx.query.token}`\n    );\n    if (!token || token.expiresAt < /* @__PURE__ */ new Date()) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"NOT_FOUND\", {\n        message: BASE_ERROR_CODES.INVALID_TOKEN\n      });\n    }\n    if (token.value !== session.user.id) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"NOT_FOUND\", {\n        message: BASE_ERROR_CODES.INVALID_TOKEN\n      });\n    }\n    const beforeDelete = ctx.context.options.user.deleteUser?.beforeDelete;\n    if (beforeDelete) {\n      await beforeDelete(session.user, ctx.request);\n    }\n    await ctx.context.internalAdapter.deleteUser(session.user.id);\n    await ctx.context.internalAdapter.deleteSessions(session.user.id);\n    await ctx.context.internalAdapter.deleteAccounts(session.user.id);\n    await ctx.context.internalAdapter.deleteVerificationValue(token.id);\n    (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.deleteSessionCookie)(ctx);\n    const afterDelete = ctx.context.options.user.deleteUser?.afterDelete;\n    if (afterDelete) {\n      await afterDelete(session.user, ctx.request);\n    }\n    if (ctx.query.callbackURL) {\n      throw ctx.redirect(ctx.query.callbackURL || \"/\");\n    }\n    return ctx.json({\n      success: true,\n      message: \"User deleted\"\n    });\n  }\n);\nconst changeEmail = createAuthEndpoint(\n  \"/change-email\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      newEmail: zod_v4__WEBPACK_IMPORTED_MODULE_20__.email().meta({\n        description: \"The new email address to set must be a valid email address\"\n      }),\n      callbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The URL to redirect to after email verification\"\n      }).optional()\n    }),\n    use: [sessionMiddleware],\n    metadata: {\n      openapi: {\n        responses: {\n          \"200\": {\n            description: \"Email change request processed successfully\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    status: {\n                      type: \"boolean\",\n                      description: \"Indicates if the request was successful\"\n                    },\n                    message: {\n                      type: \"string\",\n                      enum: [\"Email updated\", \"Verification email sent\"],\n                      description: \"Status message of the email change process\",\n                      nullable: true\n                    }\n                  },\n                  required: [\"status\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    if (!ctx.context.options.user?.changeEmail?.enabled) {\n      ctx.context.logger.error(\"Change email is disabled.\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Change email is disabled\"\n      });\n    }\n    const newEmail = ctx.body.newEmail.toLowerCase();\n    if (newEmail === ctx.context.session.user.email) {\n      ctx.context.logger.error(\"Email is the same\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Email is the same\"\n      });\n    }\n    const existingUser = await ctx.context.internalAdapter.findUserByEmail(newEmail);\n    if (existingUser) {\n      ctx.context.logger.error(\"Email already exists\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Couldn't update your email\"\n      });\n    }\n    if (ctx.context.session.user.emailVerified !== true) {\n      const existing = await ctx.context.internalAdapter.findUserByEmail(newEmail);\n      if (existing) {\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNPROCESSABLE_ENTITY\", {\n          message: BASE_ERROR_CODES.USER_ALREADY_EXISTS\n        });\n      }\n      await ctx.context.internalAdapter.updateUserByEmail(\n        ctx.context.session.user.email,\n        {\n          email: newEmail\n        },\n        ctx\n      );\n      await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.setSessionCookie)(ctx, {\n        session: ctx.context.session.session,\n        user: {\n          ...ctx.context.session.user,\n          email: newEmail\n        }\n      });\n      if (ctx.context.options.emailVerification?.sendVerificationEmail) {\n        const token2 = await createEmailVerificationToken(\n          ctx.context.secret,\n          newEmail,\n          void 0,\n          ctx.context.options.emailVerification?.expiresIn\n        );\n        const url2 = `${ctx.context.baseURL}/verify-email?token=${token2}&callbackURL=${ctx.body.callbackURL || \"/\"}`;\n        await ctx.context.options.emailVerification.sendVerificationEmail(\n          {\n            user: {\n              ...ctx.context.session.user,\n              email: newEmail\n            },\n            url: url2,\n            token: token2\n          },\n          ctx.request\n        );\n      }\n      return ctx.json({\n        status: true\n      });\n    }\n    if (!ctx.context.options.user.changeEmail.sendChangeEmailVerification) {\n      ctx.context.logger.error(\"Verification email isn't enabled.\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Verification email isn't enabled\"\n      });\n    }\n    const token = await createEmailVerificationToken(\n      ctx.context.secret,\n      ctx.context.session.user.email,\n      newEmail,\n      ctx.context.options.emailVerification?.expiresIn\n    );\n    const url = `${ctx.context.baseURL}/verify-email?token=${token}&callbackURL=${ctx.body.callbackURL || \"/\"}`;\n    await ctx.context.options.user.changeEmail.sendChangeEmailVerification(\n      {\n        user: ctx.context.session.user,\n        newEmail,\n        url,\n        token\n      },\n      ctx.request\n    );\n    return ctx.json({\n      status: true\n    });\n  }\n);\n\nfunction sanitize(input) {\n  return input.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\").replace(/\"/g, \"&quot;\").replace(/'/g, \"&#39;\");\n}\nconst html = (errorCode = \"Unknown\") => `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Authentication Error</title>\n    <style>\n        :root {\n            --bg-color: #f8f9fa;\n            --text-color: #212529;\n            --accent-color: #000000;\n            --error-color: #dc3545;\n            --border-color: #e9ecef;\n        }\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n            background-color: var(--bg-color);\n            color: var(--text-color);\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 100vh;\n            margin: 0;\n            line-height: 1.5;\n        }\n        .error-container {\n            background-color: #ffffff;\n            border-radius: 12px;\n            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);\n            padding: 2.5rem;\n            text-align: center;\n            max-width: 90%;\n            width: 400px;\n        }\n        h1 {\n            color: var(--error-color);\n            font-size: 1.75rem;\n            margin-bottom: 1rem;\n            font-weight: 600;\n        }\n        p {\n            margin-bottom: 1.5rem;\n            color: #495057;\n        }\n        .btn {\n            background-color: var(--accent-color);\n            color: #ffffff;\n            text-decoration: none;\n            padding: 0.75rem 1.5rem;\n            border-radius: 6px;\n            transition: all 0.3s ease;\n            display: inline-block;\n            font-weight: 500;\n            border: 2px solid var(--accent-color);\n        }\n        .btn:hover {\n            background-color: #131721;\n        }\n        .error-code {\n            font-size: 0.875rem;\n            color: #6c757d;\n            margin-top: 1.5rem;\n            padding-top: 1.5rem;\n            border-top: 1px solid var(--border-color);\n        }\n        .icon {\n            font-size: 3rem;\n            margin-bottom: 1rem;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"error-container\">\n        <div class=\"icon\">\\u26A0\\uFE0F</div>\n        <h1>Better Auth Error</h1>\n        <p>We encountered an issue while processing your request. Please try again or contact the application owner if the problem persists.</p>\n        <a href=\"/\" id=\"returnLink\" class=\"btn\">Return to Application</a>\n        <div class=\"error-code\">Error Code: <span id=\"errorCode\">${sanitize(\n  errorCode\n)}</span></div>\n    </div>\n</body>\n</html>`;\nconst error = createAuthEndpoint(\n  \"/error\",\n  {\n    method: \"GET\",\n    metadata: {\n      ...HIDE_METADATA,\n      openapi: {\n        description: \"Displays an error page\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"text/html\": {\n                schema: {\n                  type: \"string\",\n                  description: \"The HTML content of the error page\"\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (c) => {\n    const query = new URL(c.request?.url || \"\").searchParams.get(\"error\") || \"Unknown\";\n    return new Response(html(query), {\n      headers: {\n        \"Content-Type\": \"text/html\"\n      }\n    });\n  }\n);\n\nconst ok = createAuthEndpoint(\n  \"/ok\",\n  {\n    method: \"GET\",\n    metadata: {\n      ...HIDE_METADATA,\n      openapi: {\n        description: \"Check if the API is working\",\n        responses: {\n          \"200\": {\n            description: \"API is working\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    ok: {\n                      type: \"boolean\",\n                      description: \"Indicates if the API is working\"\n                    }\n                  },\n                  required: [\"ok\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    return ctx.json({\n      ok: true\n    });\n  }\n);\n\nconst listUserAccounts = createAuthEndpoint(\n  \"/list-accounts\",\n  {\n    method: \"GET\",\n    use: [sessionMiddleware],\n    metadata: {\n      openapi: {\n        description: \"List all accounts linked to the user\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"array\",\n                  items: {\n                    type: \"object\",\n                    properties: {\n                      id: {\n                        type: \"string\"\n                      },\n                      provider: {\n                        type: \"string\"\n                      },\n                      createdAt: {\n                        type: \"string\",\n                        format: \"date-time\"\n                      },\n                      updatedAt: {\n                        type: \"string\",\n                        format: \"date-time\"\n                      }\n                    },\n                    accountId: {\n                      type: \"string\"\n                    },\n                    scopes: {\n                      type: \"array\",\n                      items: {\n                        type: \"string\"\n                      }\n                    }\n                  },\n                  required: [\n                    \"id\",\n                    \"provider\",\n                    \"createdAt\",\n                    \"updatedAt\",\n                    \"accountId\",\n                    \"scopes\"\n                  ]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (c) => {\n    const session = c.context.session;\n    const accounts = await c.context.internalAdapter.findAccounts(\n      session.user.id\n    );\n    return c.json(\n      accounts.map((a) => ({\n        id: a.id,\n        provider: a.providerId,\n        createdAt: a.createdAt,\n        updatedAt: a.updatedAt,\n        accountId: a.accountId,\n        scopes: a.scope?.split(\",\") || []\n      }))\n    );\n  }\n);\nconst linkSocialAccount = createAuthEndpoint(\n  \"/link-social\",\n  {\n    method: \"POST\",\n    requireHeaders: true,\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      /**\n       * Callback URL to redirect to after the user has signed in.\n       */\n      callbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The URL to redirect to after the user has signed in\"\n      }).optional(),\n      /**\n       * OAuth2 provider to use\n       */\n      provider: SocialProviderListEnum,\n      /**\n       * ID Token for direct authentication without redirect\n       */\n      idToken: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n        token: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string(),\n        nonce: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional(),\n        accessToken: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional(),\n        refreshToken: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional(),\n        scopes: zod_v4__WEBPACK_IMPORTED_MODULE_20__.array(zod_v4__WEBPACK_IMPORTED_MODULE_20__.string()).optional()\n      }).optional(),\n      /**\n       * Whether to allow sign up for new users\n       */\n      requestSignUp: zod_v4__WEBPACK_IMPORTED_MODULE_20__.boolean().optional(),\n      /**\n       * Additional scopes to request when linking the account.\n       * This is useful for requesting additional permissions when\n       * linking a social account compared to the initial authentication.\n       */\n      scopes: zod_v4__WEBPACK_IMPORTED_MODULE_20__.array(zod_v4__WEBPACK_IMPORTED_MODULE_20__.string()).meta({\n        description: \"Additional scopes to request from the provider\"\n      }).optional(),\n      /**\n       * The URL to redirect to if there is an error during the link process.\n       */\n      errorCallbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The URL to redirect to if there is an error during the link process\"\n      }).optional()\n    }),\n    use: [sessionMiddleware],\n    metadata: {\n      openapi: {\n        description: \"Link a social account to the user\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    url: {\n                      type: \"string\",\n                      description: \"The authorization URL to redirect the user to\"\n                    },\n                    redirect: {\n                      type: \"boolean\",\n                      description: \"Indicates if the user should be redirected to the authorization URL\"\n                    },\n                    status: {\n                      type: \"boolean\"\n                    }\n                  },\n                  required: [\"redirect\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (c) => {\n    const session = c.context.session;\n    const provider = c.context.socialProviders.find(\n      (p) => p.id === c.body.provider\n    );\n    if (!provider) {\n      c.context.logger.error(\n        \"Provider not found. Make sure to add the provider in your auth config\",\n        {\n          provider: c.body.provider\n        }\n      );\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"NOT_FOUND\", {\n        message: BASE_ERROR_CODES.PROVIDER_NOT_FOUND\n      });\n    }\n    if (c.body.idToken) {\n      if (!provider.verifyIdToken) {\n        c.context.logger.error(\n          \"Provider does not support id token verification\",\n          {\n            provider: c.body.provider\n          }\n        );\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"NOT_FOUND\", {\n          message: BASE_ERROR_CODES.ID_TOKEN_NOT_SUPPORTED\n        });\n      }\n      const { token, nonce } = c.body.idToken;\n      const valid = await provider.verifyIdToken(token, nonce);\n      if (!valid) {\n        c.context.logger.error(\"Invalid id token\", {\n          provider: c.body.provider\n        });\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n          message: BASE_ERROR_CODES.INVALID_TOKEN\n        });\n      }\n      const linkingUserInfo = await provider.getUserInfo({\n        idToken: token,\n        accessToken: c.body.idToken.accessToken,\n        refreshToken: c.body.idToken.refreshToken\n      });\n      if (!linkingUserInfo || !linkingUserInfo?.user) {\n        c.context.logger.error(\"Failed to get user info\", {\n          provider: c.body.provider\n        });\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n          message: BASE_ERROR_CODES.FAILED_TO_GET_USER_INFO\n        });\n      }\n      if (!linkingUserInfo.user.email) {\n        c.context.logger.error(\"User email not found\", {\n          provider: c.body.provider\n        });\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n          message: BASE_ERROR_CODES.USER_EMAIL_NOT_FOUND\n        });\n      }\n      const existingAccounts = await c.context.internalAdapter.findAccounts(\n        session.user.id\n      );\n      const hasBeenLinked = existingAccounts.find(\n        (a) => a.providerId === provider.id && a.accountId === linkingUserInfo.user.id\n      );\n      if (hasBeenLinked) {\n        return c.json({\n          redirect: false,\n          url: \"\",\n          // this is for type inference\n          status: true\n        });\n      }\n      const trustedProviders = c.context.options.account?.accountLinking?.trustedProviders;\n      const isTrustedProvider = trustedProviders?.includes(provider.id);\n      if (!isTrustedProvider && !linkingUserInfo.user.emailVerified || c.context.options.account?.accountLinking?.enabled === false) {\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n          message: \"Account not linked - linking not allowed\"\n        });\n      }\n      if (linkingUserInfo.user.email !== session.user.email && c.context.options.account?.accountLinking?.allowDifferentEmails !== true) {\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n          message: \"Account not linked - different emails not allowed\"\n        });\n      }\n      try {\n        await c.context.internalAdapter.createAccount(\n          {\n            userId: session.user.id,\n            providerId: provider.id,\n            accountId: linkingUserInfo.user.id.toString(),\n            accessToken: c.body.idToken.accessToken,\n            idToken: token,\n            refreshToken: c.body.idToken.refreshToken,\n            scope: c.body.idToken.scopes?.join(\",\")\n          },\n          c\n        );\n      } catch (e) {\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"EXPECTATION_FAILED\", {\n          message: \"Account not linked - unable to create account\"\n        });\n      }\n      if (c.context.options.account?.accountLinking?.updateUserInfoOnLink === true) {\n        try {\n          await c.context.internalAdapter.updateUser(session.user.id, {\n            name: linkingUserInfo.user?.name,\n            image: linkingUserInfo.user?.image\n          });\n        } catch (e) {\n          console.warn(\"Could not update user - \" + e.toString());\n        }\n      }\n      return c.json({\n        redirect: false,\n        url: \"\",\n        // this is for type inference\n        status: true\n      });\n    }\n    const state = await generateState(c, {\n      userId: session.user.id,\n      email: session.user.email\n    });\n    const url = await provider.createAuthorizationURL({\n      state: state.state,\n      codeVerifier: state.codeVerifier,\n      redirectURI: `${c.context.baseURL}/callback/${provider.id}`,\n      scopes: c.body.scopes\n    });\n    return c.json({\n      url: url.toString(),\n      redirect: true\n    });\n  }\n);\nconst unlinkAccount = createAuthEndpoint(\n  \"/unlink-account\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      providerId: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string(),\n      accountId: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional()\n    }),\n    use: [freshSessionMiddleware],\n    metadata: {\n      openapi: {\n        description: \"Unlink an account\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    status: {\n                      type: \"boolean\"\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    const { providerId, accountId } = ctx.body;\n    const accounts = await ctx.context.internalAdapter.findAccounts(\n      ctx.context.session.user.id\n    );\n    if (accounts.length === 1 && !ctx.context.options.account?.accountLinking?.allowUnlinkingAll) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.FAILED_TO_UNLINK_LAST_ACCOUNT\n      });\n    }\n    const accountExist = accounts.find(\n      (account) => accountId ? account.accountId === accountId && account.providerId === providerId : account.providerId === providerId\n    );\n    if (!accountExist) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.ACCOUNT_NOT_FOUND\n      });\n    }\n    await ctx.context.internalAdapter.deleteAccount(accountExist.id);\n    return ctx.json({\n      status: true\n    });\n  }\n);\nconst getAccessToken = createAuthEndpoint(\n  \"/get-access-token\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      providerId: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The provider ID for the OAuth provider\"\n      }),\n      accountId: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The account ID associated with the refresh token\"\n      }).optional(),\n      userId: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The user ID associated with the account\"\n      }).optional()\n    }),\n    metadata: {\n      openapi: {\n        description: \"Get a valid access token, doing a refresh if needed\",\n        responses: {\n          200: {\n            description: \"A Valid access token\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    tokenType: {\n                      type: \"string\"\n                    },\n                    idToken: {\n                      type: \"string\"\n                    },\n                    accessToken: {\n                      type: \"string\"\n                    },\n                    refreshToken: {\n                      type: \"string\"\n                    },\n                    accessTokenExpiresAt: {\n                      type: \"string\",\n                      format: \"date-time\"\n                    },\n                    refreshTokenExpiresAt: {\n                      type: \"string\",\n                      format: \"date-time\"\n                    }\n                  }\n                }\n              }\n            }\n          },\n          400: {\n            description: \"Invalid refresh token or provider configuration\"\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    const { providerId, accountId, userId } = ctx.body;\n    const req = ctx.request;\n    const session = await getSessionFromCtx(ctx);\n    if (req && !session) {\n      throw ctx.error(\"UNAUTHORIZED\");\n    }\n    let resolvedUserId = session?.user?.id || userId;\n    if (!resolvedUserId) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: `Either userId or session is required`\n      });\n    }\n    if (!ctx.context.socialProviders.find((p) => p.id === providerId)) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: `Provider ${providerId} is not supported.`\n      });\n    }\n    const accounts = await ctx.context.internalAdapter.findAccounts(resolvedUserId);\n    const account = accounts.find(\n      (acc) => accountId ? acc.id === accountId && acc.providerId === providerId : acc.providerId === providerId\n    );\n    if (!account) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Account not found\"\n      });\n    }\n    const provider = ctx.context.socialProviders.find(\n      (p) => p.id === providerId\n    );\n    if (!provider) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: `Provider ${providerId} not found.`\n      });\n    }\n    try {\n      let newTokens = null;\n      const accessTokenExpired = account.accessTokenExpiresAt && new Date(account.accessTokenExpiresAt).getTime() - Date.now() < 5e3;\n      if (account.refreshToken && accessTokenExpired && provider.refreshAccessToken) {\n        newTokens = await provider.refreshAccessToken(\n          account.refreshToken\n        );\n        await ctx.context.internalAdapter.updateAccount(account.id, {\n          accessToken: await setTokenUtil(newTokens.accessToken, ctx.context),\n          accessTokenExpiresAt: newTokens.accessTokenExpiresAt,\n          refreshToken: await setTokenUtil(newTokens.refreshToken, ctx.context),\n          refreshTokenExpiresAt: newTokens.refreshTokenExpiresAt\n        });\n      }\n      const tokens = {\n        accessToken: await decryptOAuthToken(\n          newTokens?.accessToken ?? account.accessToken ?? \"\",\n          ctx.context\n        ),\n        accessTokenExpiresAt: newTokens?.accessTokenExpiresAt ?? account.accessTokenExpiresAt ?? void 0,\n        scopes: account.scope?.split(\",\") ?? [],\n        idToken: newTokens?.idToken ?? account.idToken ?? void 0\n      };\n      return ctx.json(tokens);\n    } catch (error) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Failed to get a valid access token\",\n        cause: error\n      });\n    }\n  }\n);\nconst refreshToken = createAuthEndpoint(\n  \"/refresh-token\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      providerId: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The provider ID for the OAuth provider\"\n      }),\n      accountId: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The account ID associated with the refresh token\"\n      }).optional(),\n      userId: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The user ID associated with the account\"\n      }).optional()\n    }),\n    metadata: {\n      openapi: {\n        description: \"Refresh the access token using a refresh token\",\n        responses: {\n          200: {\n            description: \"Access token refreshed successfully\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    tokenType: {\n                      type: \"string\"\n                    },\n                    idToken: {\n                      type: \"string\"\n                    },\n                    accessToken: {\n                      type: \"string\"\n                    },\n                    refreshToken: {\n                      type: \"string\"\n                    },\n                    accessTokenExpiresAt: {\n                      type: \"string\",\n                      format: \"date-time\"\n                    },\n                    refreshTokenExpiresAt: {\n                      type: \"string\",\n                      format: \"date-time\"\n                    }\n                  }\n                }\n              }\n            }\n          },\n          400: {\n            description: \"Invalid refresh token or provider configuration\"\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    const { providerId, accountId, userId } = ctx.body;\n    const req = ctx.request;\n    const session = await getSessionFromCtx(ctx);\n    if (req && !session) {\n      throw ctx.error(\"UNAUTHORIZED\");\n    }\n    let resolvedUserId = session?.user?.id || userId;\n    if (!resolvedUserId) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: `Either userId or session is required`\n      });\n    }\n    const accounts = await ctx.context.internalAdapter.findAccounts(resolvedUserId);\n    const account = accounts.find(\n      (acc) => accountId ? acc.id === accountId && acc.providerId === providerId : acc.providerId === providerId\n    );\n    if (!account) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Account not found\"\n      });\n    }\n    const provider = ctx.context.socialProviders.find(\n      (p) => p.id === providerId\n    );\n    if (!provider) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: `Provider ${providerId} not found.`\n      });\n    }\n    if (!provider.refreshAccessToken) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: `Provider ${providerId} does not support token refreshing.`\n      });\n    }\n    try {\n      const tokens = await provider.refreshAccessToken(\n        account.refreshToken\n      );\n      await ctx.context.internalAdapter.updateAccount(account.id, {\n        accessToken: await setTokenUtil(tokens.accessToken, ctx.context),\n        refreshToken: await setTokenUtil(tokens.refreshToken, ctx.context),\n        accessTokenExpiresAt: tokens.accessTokenExpiresAt,\n        refreshTokenExpiresAt: tokens.refreshTokenExpiresAt\n      });\n      return ctx.json(tokens);\n    } catch (error) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Failed to refresh access token\",\n        cause: error\n      });\n    }\n  }\n);\nconst accountInfo = createAuthEndpoint(\n  \"/account-info\",\n  {\n    method: \"POST\",\n    use: [sessionMiddleware],\n    metadata: {\n      openapi: {\n        description: \"Get the account info provided by the provider\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    user: {\n                      type: \"object\",\n                      properties: {\n                        id: {\n                          type: \"string\"\n                        },\n                        name: {\n                          type: \"string\"\n                        },\n                        email: {\n                          type: \"string\"\n                        },\n                        image: {\n                          type: \"string\"\n                        },\n                        emailVerified: {\n                          type: \"boolean\"\n                        }\n                      },\n                      required: [\"id\", \"emailVerified\"]\n                    },\n                    data: {\n                      type: \"object\",\n                      properties: {},\n                      additionalProperties: true\n                    }\n                  },\n                  required: [\"user\", \"data\"],\n                  additionalProperties: false\n                }\n              }\n            }\n          }\n        }\n      }\n    },\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      accountId: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The provider given account id for which to get the account info\"\n      })\n    })\n  },\n  async (ctx) => {\n    const account = await ctx.context.internalAdapter.findAccount(\n      ctx.body.accountId\n    );\n    if (!account || account.userId !== ctx.context.session.user.id) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Account not found\"\n      });\n    }\n    const provider = ctx.context.socialProviders.find(\n      (p) => p.id === account.providerId\n    );\n    if (!provider) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"INTERNAL_SERVER_ERROR\", {\n        message: `Provider account provider is ${account.providerId} but it is not configured`\n      });\n    }\n    const tokens = await getAccessToken({\n      ...ctx,\n      body: {\n        accountId: account.id,\n        providerId: account.providerId\n      },\n      returnHeaders: false\n    });\n    if (!tokens.accessToken) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Access token not found\"\n      });\n    }\n    const info = await provider.getUserInfo({\n      ...tokens,\n      accessToken: tokens.accessToken\n    });\n    return ctx.json(info);\n  }\n);\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uLi8uLi9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguejNkc3hMeEUubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUE0QjtBQUM2QztBQUNmO0FBQ0w7QUFDUztBQUNvQjtBQUNoQztBQUNnRDtBQUNuRTtBQUNEO0FBQ0k7QUFDSjtBQUNGO0FBQ0k7QUFDSDtBQUMwQztBQUNxQjtBQUNDO0FBQzdCO0FBQ1g7QUFDRjtBQUNWO0FBQ047QUFDdUM7QUFDVDtBQUNEO0FBQ2xEO0FBQ29EOztBQUVsRSwwQkFBMEIsNkRBQWdCO0FBQzFDO0FBQ0EsQ0FBQztBQUNELDZCQUE2Qix5REFBZ0I7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksNkRBQWdCO0FBQ3BCO0FBQ0EsS0FBSztBQUNMO0FBQ0EsQ0FBQztBQUNELDJCQUEyQix1REFBYztBQUN6QztBQUNBLENBQUM7O0FBRUQ7QUFDQSxpTEFBaUwsZ0JBQWdCO0FBQ2pNLGdCQUFnQixLQUFLO0FBQ3JCLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGdCQUFnQjtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0Qsd0JBQXdCO0FBQ3hFLGlCQUFpQix5QkFBeUI7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsaUJBQWlCO0FBQ2hELHdCQUF3QixpQkFBaUI7QUFDekMsTUFBTTtBQUNOLHNCQUFzQixpQkFBaUI7QUFDdkM7QUFDQTtBQUNBLHlDQUF5QyxpQkFBaUI7QUFDMUQseUNBQXlDLGlCQUFpQjtBQUMxRDtBQUNBO0FBQ0Esa0JBQWtCLHFCQUFxQjtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLFNBQVMsSUFBSSxpQkFBaUI7QUFDdEQ7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLG9CQUFvQjtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQSxRQUFRO0FBQ1IscUJBQXFCLFNBQVM7QUFDOUIsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdEQUF3RCxlQUFlO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlGQUF5RixnQkFBZ0I7QUFDekc7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBLDBGQUEwRixnQkFBZ0I7QUFDMUc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLGNBQWM7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSx1QkFBdUI7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsNERBQVM7QUFDL0M7QUFDQSxvQ0FBb0MsNERBQU87QUFDM0M7QUFDQSxxQkFBcUIsNERBQVc7QUFDaEMsb0ZBQW9GLDREQUFTO0FBQzdGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQyxNQUFNLElBQUksSUFBSTtBQUN4RDtBQUNBLDJDQUEyQyxLQUFLO0FBQ2hEO0FBQ0EsMkNBQTJDLGVBQWU7QUFDMUQ7QUFDQSxnQkFBZ0IsaURBQVEsZ0JBQWdCLG9CQUFvQixNQUFNLEdBQUc7QUFDckU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxVQUFVO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLDREQUFTO0FBQy9DO0FBQ0Esb0NBQW9DLDREQUFPO0FBQzNDO0FBQ0EscUJBQXFCLDREQUFXO0FBQ2hDLG9GQUFvRiw0REFBUztBQUM3RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLE1BQU0sSUFBSSxJQUFJO0FBQ3hEO0FBQ0EsMkNBQTJDLEtBQUs7QUFDaEQ7QUFDQSwyQ0FBMkMsZUFBZTtBQUMxRDtBQUNBLGdCQUFnQixpREFBUSxnQkFBZ0Isb0JBQW9CLE1BQU0sR0FBRztBQUNyRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLDZDQUFVO0FBQ3JCLE1BQU0sMkNBQVE7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0Qiw0Q0FBZ0I7QUFDNUM7QUFDQSxTQUFTO0FBQ1Qsd0JBQXdCLDRDQUFnQjtBQUN4QztBQUNBLFNBQVM7QUFDVCxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFEQUFxRCw2REFBYSxDQUFDLDhEQUFNLFFBQVEsNkRBQU07QUFDdkY7QUFDQSw4QkFBOEIsb0VBQVU7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsd0VBQW1CO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsNERBQU87QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLHdFQUFtQjtBQUM3QixrQ0FBa0MsYUFBYTtBQUMvQztBQUNBO0FBQ0EsY0FBYyxxRUFBZ0I7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLFlBQVksbUVBQWM7QUFDMUI7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsaURBQVE7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQVE7QUFDeEI7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsaURBQVE7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsaURBQVE7QUFDdEI7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSwyQ0FBUTtBQUNsQixhQUFhLDJDQUFRO0FBQ3JCO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQVE7QUFDeEI7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLGdCQUFnQixpREFBUTtBQUN4QjtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQVE7QUFDeEI7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0Esc0JBQXNCLDBEQUFPO0FBQzdCO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyxpREFBUTtBQUN0QjtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixvQkFBb0Isc0JBQXNCLE1BQU0sZUFBZSw0QkFBNEI7QUFDNUc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsMkNBQVE7QUFDbEIsYUFBYSwwQ0FBTztBQUNwQjtBQUNBLE9BQU87QUFDUCxtQkFBbUIsMkNBQVE7QUFDM0I7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCO0FBQ0EsT0FBTztBQUNQO0FBQ0EsWUFBWSxRQUFRO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQVE7QUFDeEI7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVywyQ0FBUTtBQUNuQixhQUFhLDJDQUFRO0FBQ3JCO0FBQ0EsT0FBTztBQUNQLG1CQUFtQiwyQ0FBUTtBQUMzQjtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0Msc0JBQXNCLFNBQVMsTUFBTTtBQUNyRTtBQUNBLDhCQUE4QixzQkFBc0IsU0FBUyxNQUFNO0FBQ25FO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCO0FBQ0EsT0FBTztBQUNQO0FBQ0EsWUFBWSxRQUFRO0FBQ3BCO0FBQ0E7QUFDQSxrQkFBa0IsZ0RBQVM7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLHVCQUF1QixvREFBVTtBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQiwyQ0FBUTtBQUMzQixhQUFhLDJDQUFRO0FBQ3JCLGdCQUFnQiwyQ0FBUTtBQUN4QixLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyxzQkFBc0I7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyxzQkFBc0I7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0Isb0JBQW9CLHNCQUFzQixTQUFTLGVBQWUsNkJBQTZCO0FBQ2pIO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxZQUFZLHFFQUFnQjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGlEQUFRO0FBQzVCO0FBQ0EsV0FBVztBQUNYO0FBQ0EsY0FBYyxxRUFBZ0I7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxRQUFRO0FBQ1IsY0FBYyxxRUFBZ0I7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsaURBQVE7QUFDdEI7QUFDQSxLQUFLO0FBQ0w7QUFDQSx1QkFBdUIsNERBQW9CO0FBQzNDLGdCQUFnQiw0REFBb0I7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLGlEQUFRO0FBQ3RCO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxrRUFBa0Usa0JBQWtCO0FBQ3BGLHdCQUF3QixTQUFTO0FBQ2pDO0FBQ0EscUJBQXFCLDJDQUFRO0FBQzdCLGlCQUFpQiwyQ0FBUTtBQUN6QixrQkFBa0IsMkNBQVE7QUFDMUIsY0FBYywyQ0FBUTtBQUN0QixnQkFBZ0IsMkNBQVE7QUFDeEIsZUFBZSwyQ0FBUTtBQUN2QixVQUFVLDJDQUFRO0FBQ2xCLGFBQWEsMkNBQVE7QUFDckIsY0FBYywyQ0FBZTtBQUM3QixLQUFLO0FBQ0wsbUJBQW1CLDRDQUFTO0FBQzVCLEdBQUc7QUFDSDtBQUNBLDZCQUE2QixrQkFBa0I7QUFDL0M7QUFDQTtBQUNBO0FBQ0Esa0VBQWtFLGtCQUFrQjtBQUNwRix3QkFBd0IsU0FBUztBQUNqQztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLG1DQUFtQyxtRUFBVTtBQUM3QyxTQUFTLGdFQUFTO0FBQ2xCO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0Qyw0REFBTztBQUNuRCwyREFBMkQsNERBQU87QUFDbEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsbUVBQWdCO0FBQzNCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsbUVBQWdCO0FBQzNCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSSx5REFBTTtBQUNWO0FBQ0E7QUFDQTtBQUNBLGtFQUFrRSxrQkFBa0I7QUFDcEYsd0JBQXdCLFNBQVM7QUFDakMsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVkseURBQWE7QUFDekIsVUFBVSx5REFBTTtBQUNoQiw4REFBOEQsbUJBQW1CO0FBQ2pGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQSxRQUFRO0FBQ1IsUUFBUSx5REFBTTtBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLHlCQUF5QjtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyx5QkFBeUI7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixrQkFBa0Isc0JBQXNCLE1BQU0sZUFBZSxZQUFZO0FBQ2hHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLE1BQU0seURBQU07QUFDWix1QkFBdUIsaURBQVE7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEIsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQiw2REFBTTtBQUNyQyxTQUFTLGlCQUFpQixHQUFHLHFCQUFxQjtBQUNsRDtBQUNBLCtDQUErQyxtQkFBbUI7QUFDbEUsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLGNBQWMsUUFBUSxnRUFBVztBQUMzQztBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLGNBQWMsUUFBUSxnRUFBVztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QixnREFBUztBQUNsQztBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsNkRBQU07QUFDckMsU0FBUyxpQkFBaUIsR0FBRyxxQkFBcUI7QUFDbEQ7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsY0FBYyxRQUFRLGdFQUFXO0FBQzNDO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyw0QkFBNEI7QUFDL0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsS0FBSztBQUNMLHdDQUF3QyxpQ0FBaUM7QUFDekU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0Qiw0REFBcUI7QUFDakQsY0FBYyxtQkFBbUI7QUFDakM7QUFDQTtBQUNBLGNBQWMscUJBQXFCLFFBQVEsZ0RBQVM7QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLGdEQUFTO0FBQy9CO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyw0QkFBNEIsRUFBRSwwQkFBMEI7QUFDM0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxPQUFPLFFBQVEsZ0VBQVcsSUFBSSxlQUFlLEVBQUUsZUFBZTtBQUN4RTtBQUNBLGNBQWMsaURBQVE7QUFDdEI7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLEtBQUs7QUFDekM7QUFDQSxlQUFlLGdEQUFTO0FBQ3hCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLDRCQUE0QjtBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBEQUEwRDtBQUMxRDtBQUNBLFVBQVUsZ0NBQWdDLGlCQUFpQixnQkFBZ0I7QUFDM0U7QUFDQSxVQUFVLFNBQVMsTUFBTSxVQUFVLHlCQUF5QjtBQUM1RDtBQUNBLEtBQUs7QUFDTCx3Q0FBd0MsbUJBQW1CO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsdUJBQXVCLFFBQVEsZ0VBQVc7QUFDeEQ7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLGtCQUFrQjtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0VBQXdFLG9CQUFvQjtBQUM1RixRQUFRO0FBQ1I7QUFDQSxrRUFBa0UsV0FBVyxHQUFHLGVBQWUsR0FBRyxPQUFPO0FBQ3pHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLHVDQUF1QztBQUMxRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVixPQUFPO0FBQ1AsS0FBSztBQUNMLHdDQUF3QyxtQkFBbUI7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLHFCQUFxQixRQUFRLGdEQUFTO0FBQ3hEO0FBQ0EsWUFBWSx5REFBa0I7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLGdEQUFTO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLHVCQUF1QixRQUFRLGdFQUFXO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2Qix1Q0FBdUM7QUFDcEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTCx3Q0FBd0MsbUJBQW1CO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsdUJBQXVCLFFBQVEsZ0VBQVc7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsa0JBQWtCO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsZUFBZSxRQUFRLGdFQUFXO0FBQ2hEO0FBQ0EsbUNBQW1DLGtCQUFrQjtBQUNyRDtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxRQUFRLHlEQUFNO0FBQ2Q7QUFDQTtBQUNBLGtCQUFrQix5REFBZTtBQUNqQztBQUNBO0FBQ0Esa0JBQWtCLHlEQUFlO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsS0FBSztBQUNMLHdDQUF3QyxpQ0FBaUM7QUFDekU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0RkFBNEYsTUFBTTtBQUNsRyxjQUFjLGtCQUFrQixRQUFRLGdFQUFXO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsZ0RBQVM7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLDBDQUEwQztBQUN2RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTCxzQ0FBc0MsaUNBQWlDO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLGNBQWMsUUFBUSxnRUFBVztBQUMvQztBQUNBO0FBQ0EsbUNBQW1DLGtCQUFrQjtBQUNyRDtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QiwwQ0FBMEM7QUFDdkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0wsd0NBQXdDLGlDQUFpQztBQUN6RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsdUJBQXVCLFFBQVEsZ0VBQVc7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsa0JBQWtCO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EscUVBQXFFLE9BQU87QUFDNUUsNkRBQTZELE9BQU87QUFDcEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMLGdDQUFnQyxpQ0FBaUM7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixnREFBUztBQUM1QjtBQUNBLFlBQVksZ0VBQVc7QUFDdkIsc0RBQXNELGlCQUFpQixHQUFHLGlCQUFpQjtBQUMzRjtBQUNBO0FBQ0EscUNBQXFDLGtCQUFrQjtBQUN2RCxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsNkRBQU07QUFDMUMsOENBQThDLFVBQVUsY0FBYztBQUN0RSxjQUFjO0FBQ2QsY0FBYyx5REFBTTtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsNEJBQTRCO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLHdDQUF3QyxtQkFBbUI7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyx1QkFBdUIsUUFBUSxnRUFBVztBQUN4RDtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsa0JBQWtCO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLHVDQUF1QztBQUNwRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTCx3Q0FBd0MsbUJBQW1CO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyx1QkFBdUIsUUFBUSxnRUFBVztBQUN4RDtBQUNBLG1DQUFtQyxrQkFBa0I7QUFDckQ7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QiwwQ0FBMEM7QUFDdkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0wsd0NBQXdDLGlDQUFpQztBQUN6RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsdUJBQXVCLFFBQVEsZ0VBQVc7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsa0JBQWtCO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2Qiw0QkFBNEI7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMLHdDQUF3QyxtQkFBbUI7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEseURBQU07QUFDZDtBQUNBO0FBQ0Esc0JBQXNCLGdEQUFTO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0wsd0NBQXdDLGlDQUFpQztBQUN6RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyxxQ0FBcUMsUUFBUSxnRUFBVztBQUN0RTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQyxrQkFBa0I7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyxxQ0FBcUMsUUFBUSxnRUFBVztBQUN0RTtBQUNBO0FBQ0EsbUNBQW1DLGtCQUFrQjtBQUNyRDtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTCx3Q0FBd0MsaUNBQWlDO0FBQ3pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyx1QkFBdUIsUUFBUSxnRUFBVztBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQyxrQkFBa0I7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsdUNBQXVDO0FBQ3BFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMLHdDQUF3QyxtQkFBbUI7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyx1QkFBdUIsUUFBUSxnRUFBVztBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLGtCQUFrQjtBQUN2RCxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTCx3Q0FBd0MsbUJBQW1CO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsdUJBQXVCLFFBQVEsZ0VBQVc7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsa0JBQWtCO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHlEQUF5RCxHQUFHO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlELFFBQVE7QUFDekQseUNBQXlDLFFBQVE7QUFDakQsNENBQTRDLFFBQVE7QUFDcEQ7QUFDQTtBQUNBO0FBQ0EsVUFBVSx5REFBeUQ7QUFDbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMLHdDQUF3QyxpQ0FBaUM7QUFDekU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLHVCQUF1QixRQUFRLGdFQUFXO0FBQ3hEO0FBQ0EsVUFBVSxXQUFXLHlCQUF5QixrQkFBa0I7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsNEJBQTRCO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMERBQTBEO0FBQzFEO0FBQ0EsVUFBVSxpQ0FBaUMsa0JBQWtCLGlCQUFpQixxQkFBcUIsZ0JBQWdCO0FBQ25IO0FBQ0EsVUFBVSxTQUFTLE1BQU07QUFDekI7QUFDQSxLQUFLO0FBQ0wsd0NBQXdDLG1CQUFtQjtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLHVCQUF1QixRQUFRLGdFQUFXO0FBQ3hELDREQUE0RCxpQkFBaUI7QUFDN0U7QUFDQTtBQUNBLHFDQUFxQyxrQkFBa0I7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2Qiw0QkFBNEI7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0wsd0NBQXdDLG1CQUFtQjtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyw2REFBTTtBQUN0QyxhQUFhLGlCQUFpQixHQUFHLHFCQUFxQjtBQUN0RCxVQUFVO0FBQ1Y7QUFDQSxjQUFjLGNBQWMsUUFBUSxnRUFBVztBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsdUJBQXVCLFFBQVEsZ0VBQVc7QUFDeEQ7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLGtCQUFrQjtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2Qiw0QkFBNEI7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0REFBNEQ7QUFDNUQ7QUFDQSxVQUFVLGdDQUFnQyxpQkFBaUIsZ0JBQWdCO0FBQzNFO0FBQ0EsVUFBVSxTQUFTLE1BQU0sVUFBVSwyQ0FBMkM7QUFDOUU7QUFDQSxLQUFLO0FBQ0wsd0NBQXdDLG1CQUFtQjtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsdUJBQXVCLFFBQVEsZ0VBQVc7QUFDeEQ7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLGtCQUFrQjtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLFlBQVk7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQywwQ0FBMEM7QUFDN0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsY0FBYyx1QkFBdUIsUUFBUSxnRUFBVztBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsa0NBQWtDO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCx3Q0FBd0MsaUNBQWlDO0FBQ3pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsdUJBQXVCLFFBQVEsZ0VBQVc7QUFDeEQ7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLGtCQUFrQjtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsNENBQU0sd0JBQXdCLDJDQUFROztBQUVyRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsMkNBQVE7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsMkNBQVE7QUFDM0I7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQiwyQ0FBUTtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsMkNBQVE7QUFDaEM7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsNENBQVM7QUFDaEM7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsNkNBQVU7QUFDekIsUUFBUSwyQ0FBUTtBQUNoQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsMkNBQVE7QUFDekI7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLDJDQUFRO0FBQ3pCO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QiwyQ0FBUTtBQUMvQjtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsMkNBQVE7QUFDaEM7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLDJDQUFRO0FBQzdCO0FBQ0EsV0FBVztBQUNYLFNBQVM7QUFDVDtBQUNBLGNBQWMsMENBQU8sQ0FBQywyQ0FBUTtBQUM5QjtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQiw0Q0FBUztBQUM5QjtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsMkNBQVE7QUFDekI7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyxnQkFBZ0I7QUFDaEQsbUNBQW1DLGdCQUFnQjtBQUNuRDtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQVE7QUFDeEI7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGlEQUFRO0FBQzFCO0FBQ0EsU0FBUztBQUNUO0FBQ0EsY0FBYyxlQUFlO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULGtCQUFrQixpREFBUTtBQUMxQjtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxrQkFBa0IsaURBQVE7QUFDMUI7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Qsa0JBQWtCLGlEQUFRO0FBQzFCO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0Esa0JBQWtCLGlEQUFRO0FBQzFCO0FBQ0EsU0FBUztBQUNUO0FBQ0EsWUFBWSxxRUFBZ0I7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxZQUFZLHNCQUFzQjtBQUNsQztBQUNBO0FBQ0E7QUFDQSxzQkFBc0Isa0JBQWtCLFlBQVksWUFBWTtBQUNoRTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLDJDQUFRO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBLGFBQWEsMkNBQVE7QUFDckI7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLDJDQUFRO0FBQ3hCO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLDJDQUFRO0FBQzNCO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLDRDQUFTO0FBQzNCO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QixnQkFBZ0I7QUFDOUMsaUNBQWlDLGdCQUFnQjtBQUNqRDtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCO0FBQ0EsT0FBTztBQUNQO0FBQ0EsWUFBWSxrQkFBa0I7QUFDOUIseUJBQXlCLDJDQUFRO0FBQ2pDO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsbURBQW1ELE9BQU87QUFDMUQsZ0JBQWdCLGlEQUFRO0FBQ3hCO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRUFBaUUsT0FBTztBQUN4RSxnQkFBZ0IsaURBQVE7QUFDeEI7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsdURBQXVELE9BQU87QUFDOUQsZ0JBQWdCLGlEQUFRO0FBQ3hCO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQVE7QUFDeEI7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGlEQUFRO0FBQzFCO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsb0JBQW9CLHNCQUFzQixNQUFNLGVBQWUsNEJBQTRCO0FBQ2xIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQVE7QUFDeEI7QUFDQSxPQUFPO0FBQ1A7QUFDQSxVQUFVLHFFQUFnQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQSxlQUFlLDJDQUFRO0FBQ3ZCLFFBQVEsMkNBQVE7QUFDaEIsU0FBUywyQ0FBUTtBQUNqQixhQUFhLDJDQUFRO0FBQ3JCLHFCQUFxQiwyQ0FBUTtBQUM3QixTQUFTLDJDQUFRO0FBQ2pCLFFBQVEsMkNBQVE7QUFDaEIsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSx5RUFBeUUsa0JBQWtCO0FBQzNGO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsMEJBQTBCLGdCQUFnQjtBQUMxQztBQUNBLFlBQVksbURBQW1EO0FBQy9EO0FBQ0E7QUFDQSxXQUFXLGdCQUFnQixTQUFTLE1BQU0scUJBQXFCLGtCQUFrQjtBQUNqRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixnQkFBZ0I7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsSUFBSSxTQUFTLE9BQU87QUFDckMsUUFBUTtBQUNSLGlCQUFpQixJQUFJLFNBQVMsT0FBTztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0Isa0JBQWtCLFlBQVksWUFBWTtBQUNsRSxPQUFPO0FBQ1AsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsNkRBQWE7QUFDeEMsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxnQkFBZ0I7QUFDNUIsVUFBVSxxRUFBZ0I7QUFDMUI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLHdFQUFtQjtBQUN6QixnQkFBZ0IsaURBQVE7QUFDeEI7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLElBQUksd0VBQW1CO0FBQ3ZCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBLDJFQUEyRSxZQUFZO0FBQ3ZGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLDJDQUFRO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBLGFBQWEsMENBQU87QUFDcEI7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLDJDQUFRO0FBQzFCO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQVE7QUFDeEI7QUFDQSxPQUFPO0FBQ1A7QUFDQSxZQUFZLG9CQUFvQjtBQUNoQztBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsbUVBQW1FLE9BQU87QUFDMUU7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxzQkFBc0IsNERBQU87QUFDN0I7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLDZEQUFVO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyxrQkFBa0I7QUFDeEQ7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLG9CQUFvQixrQkFBa0Isa0JBQWtCLGVBQWUsWUFBWTtBQUN0RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsMkNBQVE7QUFDbEI7QUFDQTtBQUNBO0FBQ0EsYUFBYSwyQ0FBUTtBQUNyQjtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsMkNBQVE7QUFDMUI7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixpREFBUTtBQUN4QjtBQUNBLE9BQU87QUFDUDtBQUNBLFlBQVksb0JBQW9CO0FBQ2hDO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxtRUFBbUUsT0FBTztBQUMxRTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLHNCQUFzQiw0REFBTztBQUM3QjtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsNkRBQVU7QUFDeEM7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLGtCQUFrQjtBQUN4RDtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsb0JBQW9CLGtCQUFrQixrQkFBa0IsZUFBZSxZQUFZO0FBQ3RHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVywyQ0FBUTtBQUNuQixtQkFBbUIsMkNBQVE7QUFDM0I7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSxZQUFZLFFBQVE7QUFDcEIsWUFBWSxjQUFjO0FBQzFCO0FBQ0E7QUFDQSxrREFBa0Qsd0JBQXdCO0FBQzFFO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixNQUFNO0FBQzlCO0FBQ0E7QUFDQTtBQUNBLGtEQUFrRCx3QkFBd0I7QUFDMUU7QUFDQTtBQUNBLG9FQUFvRSxPQUFPO0FBQzNFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVywyQ0FBUTtBQUNuQixhQUFhLDJDQUFRO0FBQ3JCLEtBQUs7QUFDTCxVQUFVLDJDQUFRO0FBQ2xCLG1CQUFtQiwyQ0FBUTtBQUMzQjtBQUNBLE9BQU87QUFDUCxhQUFhLDJDQUFRO0FBQ3JCO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQVE7QUFDeEI7QUFDQSxPQUFPO0FBQ1A7QUFDQSxZQUFZLGNBQWM7QUFDMUI7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQVE7QUFDeEI7QUFDQSxPQUFPO0FBQ1A7QUFDQSxpQ0FBaUMsTUFBTTtBQUN2QztBQUNBO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSwyQ0FBUTtBQUNsQixNQUFNLDJDQUFRO0FBQ2Q7QUFDQSxPQUFPO0FBQ1AsTUFBTSx3Q0FBSztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCO0FBQ0EsT0FBTztBQUNQO0FBQ0EsWUFBWSx1QkFBdUI7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSw2QkFBNkIsNkRBQWM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLFVBQVUscUVBQWdCO0FBQzFCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLDJDQUFRO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQiwyQ0FBUTtBQUMzQjtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsMkNBQVE7QUFDL0I7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsNENBQVM7QUFDcEM7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsWUFBWSxvREFBb0Q7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQVE7QUFDeEI7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQVE7QUFDeEI7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixpREFBUTtBQUN4QjtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGlEQUFRO0FBQzFCO0FBQ0EsU0FBUztBQUNUO0FBQ0EsWUFBWSxxRUFBZ0I7QUFDNUI7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLDJDQUFRO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQiwyQ0FBUTtBQUMzQjtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEdBQUc7QUFDSDtBQUNBLFlBQVksY0FBYztBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixpREFBUTtBQUN4QjtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixpREFBUTtBQUN4QjtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxjQUFjLGlEQUFRO0FBQ3RCO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSwyQ0FBUTtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQiwyQ0FBUTtBQUMzQjtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQiwyQ0FBUTtBQUN4QjtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxhQUFhLDJDQUFRO0FBQ3JCO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGlEQUFRO0FBQzFCO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0Esa0JBQWtCLGlEQUFRO0FBQzFCO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxvQkFBb0IsNERBQW9CO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QyxNQUFNO0FBQzlDO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EscUJBQXFCLG9CQUFvQiw4QkFBOEIsTUFBTSxlQUFlLDRCQUE0QjtBQUN4SDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGlEQUFRO0FBQzFCO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksd0VBQW1CO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsMkNBQVE7QUFDbkIsYUFBYSwyQ0FBUTtBQUNyQjtBQUNBLE9BQU87QUFDUCxtQkFBbUIsMkNBQVE7QUFDM0I7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixpREFBUTtBQUN4QjtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQVE7QUFDeEI7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLHdCQUF3QixnQkFBZ0I7QUFDeEM7QUFDQTtBQUNBLGdCQUFnQixpREFBUTtBQUN4QjtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksd0VBQW1CO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsMkNBQVE7QUFDbEIsZ0JBQWdCLDBDQUFPO0FBQ3ZCO0FBQ0EsT0FBTztBQUNQLG1CQUFtQiwyQ0FBUTtBQUMzQjtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQVE7QUFDeEI7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQVE7QUFDeEI7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQVE7QUFDeEI7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsaURBQVE7QUFDMUI7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsWUFBWSxxRUFBZ0I7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixvQkFBb0Isc0JBQXNCLE9BQU8sZUFBZSw0QkFBNEI7QUFDcEg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLG9CQUFvQixzQkFBc0IsTUFBTSxlQUFlLDRCQUE0QjtBQUM5RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBLG1DQUFtQyxzQkFBc0Isc0JBQXNCLHdCQUF3Qix1QkFBdUI7QUFDOUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUVBQW1FO0FBQ25FO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLDJDQUFRO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQiwyQ0FBUTtBQUMzQjtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsMkNBQVE7QUFDdkIsZUFBZSwyQ0FBUTtBQUN2QixlQUFlLDJDQUFRO0FBQ3ZCLHFCQUFxQiwyQ0FBUTtBQUM3QixzQkFBc0IsMkNBQVE7QUFDOUIsZ0JBQWdCLDBDQUFPLENBQUMsMkNBQVE7QUFDaEMsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQiw0Q0FBUztBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYywwQ0FBTyxDQUFDLDJDQUFRO0FBQzlCO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QiwyQ0FBUTtBQUNoQztBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQVE7QUFDeEI7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGlEQUFRO0FBQzFCO0FBQ0EsU0FBUztBQUNUO0FBQ0EsY0FBYyxlQUFlO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULGtCQUFrQixpREFBUTtBQUMxQjtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxrQkFBa0IsaURBQVE7QUFDMUI7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Qsa0JBQWtCLGlEQUFRO0FBQzFCO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGlEQUFRO0FBQzFCO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxrQkFBa0IsaURBQVE7QUFDMUI7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0EsUUFBUTtBQUNSLGtCQUFrQixpREFBUTtBQUMxQjtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1gsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLGtCQUFrQixZQUFZLFlBQVk7QUFDaEU7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsMkNBQVE7QUFDbEIsa0JBQWtCLDJDQUFRO0FBQzFCLGlCQUFpQiwyQ0FBUTtBQUN6QixLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLFlBQVksd0JBQXdCO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQVE7QUFDeEI7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSwyQ0FBUTtBQUNsQixrQkFBa0IsMkNBQVE7QUFDMUI7QUFDQSxPQUFPO0FBQ1AsaUJBQWlCLDJDQUFRO0FBQ3pCO0FBQ0EsT0FBTztBQUNQLGNBQWMsMkNBQVE7QUFDdEI7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLFlBQVksZ0NBQWdDO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQVE7QUFDeEIsNkJBQTZCLFlBQVk7QUFDekMsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixpREFBUTtBQUN4QjtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCLDZCQUE2QixZQUFZO0FBQ3pDLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLGdCQUFnQixpREFBUTtBQUN4QjtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSwyQ0FBUTtBQUNsQixrQkFBa0IsMkNBQVE7QUFDMUI7QUFDQSxPQUFPO0FBQ1AsaUJBQWlCLDJDQUFRO0FBQ3pCO0FBQ0EsT0FBTztBQUNQLGNBQWMsMkNBQVE7QUFDdEI7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLFlBQVksZ0NBQWdDO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixpREFBUTtBQUN4QjtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCLDZCQUE2QixZQUFZO0FBQ3pDLE9BQU87QUFDUDtBQUNBO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCLDZCQUE2QixZQUFZO0FBQ3pDLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLE1BQU07QUFDTixnQkFBZ0IsaURBQVE7QUFDeEI7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxvQ0FBb0M7QUFDcEM7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFVBQVUsMkNBQVE7QUFDbEIsaUJBQWlCLDJDQUFRO0FBQ3pCO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixpREFBUTtBQUN4QjtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGlEQUFRO0FBQ3hCLGlEQUFpRCxvQkFBb0I7QUFDckUsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLEtBQUs7QUFDTDtBQUNBLGdCQUFnQixpREFBUTtBQUN4QjtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRTJxRCIsInNvdXJjZXMiOlsiL1VzZXJzL21pbGFuL0Rlc2t0b3AvQXBwcy9iZXR0ZXItYXV0aC9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguejNkc3hMeEUubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHogZnJvbSAnem9kL3Y0JztcbmltcG9ydCB7IGNyZWF0ZU1pZGRsZXdhcmUsIGNyZWF0ZUVuZHBvaW50LCBBUElFcnJvciB9IGZyb20gJ2JldHRlci1jYWxsJztcbmltcG9ydCB7IGcgYXMgZ2V0RGF0ZSB9IGZyb20gJy4vYmV0dGVyLWF1dGguQ1c2RDllU3gubWpzJztcbmltcG9ydCB7IGNyZWF0ZUhhc2ggfSBmcm9tICdAYmV0dGVyLWF1dGgvdXRpbHMvaGFzaCc7XG5pbXBvcnQgeyBiYXNlNjQsIGJhc2U2NFVybCB9IGZyb20gJ0BiZXR0ZXItYXV0aC91dGlscy9iYXNlNjQnO1xuaW1wb3J0IHsgc2lnbkpXVCwgc3ltbWV0cmljRW5jcnlwdCwgc3ltbWV0cmljRGVjcnlwdCB9IGZyb20gJy4uL2NyeXB0by9pbmRleC5tanMnO1xuaW1wb3J0IHsgYmV0dGVyRmV0Y2ggfSBmcm9tICdAYmV0dGVyLWZldGNoL2ZldGNoJztcbmltcG9ydCB7IGp3dFZlcmlmeSwgZGVjb2RlSnd0LCBkZWNvZGVQcm90ZWN0ZWRIZWFkZXIsIGltcG9ydEpXSywgY3JlYXRlUmVtb3RlSldLU2V0IH0gZnJvbSAnam9zZSc7XG5pbXBvcnQgJ0Bub2JsZS9jaXBoZXJzL2NoYWNoYSc7XG5pbXBvcnQgJ0Bub2JsZS9jaXBoZXJzL3V0aWxzJztcbmltcG9ydCAnQG5vYmxlL2NpcGhlcnMvd2ViY3J5cHRvJztcbmltcG9ydCAnQG5vYmxlL2hhc2hlcy9zY3J5cHQnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMvaGV4JztcbmltcG9ydCAnQG5vYmxlL2hhc2hlcy91dGlscyc7XG5pbXBvcnQgeyBnIGFzIGdlbmVyYXRlUmFuZG9tU3RyaW5nIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC5CNFFveGRnYy5tanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRPcmlnaW4sIGIgYXMgZ2V0SG9zdCwgYyBhcyBnZXRQcm90b2NvbCB9IGZyb20gJy4vYmV0dGVyLWF1dGguVlRYTkxGTVQubWpzJztcbmltcG9ydCB7IGRlbGV0ZVNlc3Npb25Db29raWUsIHNldFNlc3Npb25Db29raWUsIHNldENvb2tpZUNhY2hlIH0gZnJvbSAnLi4vY29va2llcy9pbmRleC5tanMnO1xuaW1wb3J0IHsgcyBhcyBzYWZlSlNPTlBhcnNlIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC50QjVlVTZFWS5tanMnO1xuaW1wb3J0IHsgY3JlYXRlSE1BQyB9IGZyb20gJ0BiZXR0ZXItYXV0aC91dGlscy9obWFjJztcbmltcG9ydCB7IGJpbmFyeSB9IGZyb20gJ0BiZXR0ZXItYXV0aC91dGlscy9iaW5hcnknO1xuaW1wb3J0IHsgSldURXhwaXJlZCB9IGZyb20gJ2pvc2UvZXJyb3JzJztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzL3JhbmRvbSc7XG5pbXBvcnQgeyBhIGFzIGxvZ2dlciwgZyBhcyBnZW5lcmF0ZUlkIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC5EQkdmSURuaC5tanMnO1xuaW1wb3J0IHsgZiBhcyBwYXJzZVVzZXJJbnB1dCB9IGZyb20gJy4vYmV0dGVyLWF1dGgubjJLRkd3alkubWpzJztcbmltcG9ydCB7IGIgYXMgaXNEZXZlbG9wbWVudCB9IGZyb20gJy4vYmV0dGVyLWF1dGguOHpveHpnLUYubWpzJztcbmltcG9ydCAnZGVmdSc7XG5pbXBvcnQgeyBCIGFzIEJldHRlckF1dGhFcnJvciB9IGZyb20gJy4vYmV0dGVyLWF1dGguRGR6U0pmLW4ubWpzJztcblxuY29uc3Qgb3B0aW9uc01pZGRsZXdhcmUgPSBjcmVhdGVNaWRkbGV3YXJlKGFzeW5jICgpID0+IHtcbiAgcmV0dXJuIHt9O1xufSk7XG5jb25zdCBjcmVhdGVBdXRoTWlkZGxld2FyZSA9IGNyZWF0ZU1pZGRsZXdhcmUuY3JlYXRlKHtcbiAgdXNlOiBbXG4gICAgb3B0aW9uc01pZGRsZXdhcmUsXG4gICAgLyoqXG4gICAgICogT25seSB1c2UgZm9yIHBvc3QgaG9va3NcbiAgICAgKi9cbiAgICBjcmVhdGVNaWRkbGV3YXJlKGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiB7fTtcbiAgICB9KVxuICBdXG59KTtcbmNvbnN0IGNyZWF0ZUF1dGhFbmRwb2ludCA9IGNyZWF0ZUVuZHBvaW50LmNyZWF0ZSh7XG4gIHVzZTogW29wdGlvbnNNaWRkbGV3YXJlXVxufSk7XG5cbmZ1bmN0aW9uIGVzY2FwZVJlZ0V4cENoYXIoY2hhcikge1xuICBpZiAoY2hhciA9PT0gXCItXCIgfHwgY2hhciA9PT0gXCJeXCIgfHwgY2hhciA9PT0gXCIkXCIgfHwgY2hhciA9PT0gXCIrXCIgfHwgY2hhciA9PT0gXCIuXCIgfHwgY2hhciA9PT0gXCIoXCIgfHwgY2hhciA9PT0gXCIpXCIgfHwgY2hhciA9PT0gXCJ8XCIgfHwgY2hhciA9PT0gXCJbXCIgfHwgY2hhciA9PT0gXCJdXCIgfHwgY2hhciA9PT0gXCJ7XCIgfHwgY2hhciA9PT0gXCJ9XCIgfHwgY2hhciA9PT0gXCIqXCIgfHwgY2hhciA9PT0gXCI/XCIgfHwgY2hhciA9PT0gXCJcXFxcXCIpIHtcbiAgICByZXR1cm4gYFxcXFwke2NoYXJ9YDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gY2hhcjtcbiAgfVxufVxuZnVuY3Rpb24gZXNjYXBlUmVnRXhwU3RyaW5nKHN0cikge1xuICBsZXQgcmVzdWx0ID0gXCJcIjtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHtcbiAgICByZXN1bHQgKz0gZXNjYXBlUmVnRXhwQ2hhcihzdHJbaV0pO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5mdW5jdGlvbiB0cmFuc2Zvcm0ocGF0dGVybiwgc2VwYXJhdG9yID0gdHJ1ZSkge1xuICBpZiAoQXJyYXkuaXNBcnJheShwYXR0ZXJuKSkge1xuICAgIGxldCByZWdFeHBQYXR0ZXJucyA9IHBhdHRlcm4ubWFwKChwKSA9PiBgXiR7dHJhbnNmb3JtKHAsIHNlcGFyYXRvcil9JGApO1xuICAgIHJldHVybiBgKD86JHtyZWdFeHBQYXR0ZXJucy5qb2luKFwifFwiKX0pYDtcbiAgfVxuICBsZXQgc2VwYXJhdG9yU3BsaXR0ZXIgPSBcIlwiO1xuICBsZXQgc2VwYXJhdG9yTWF0Y2hlciA9IFwiXCI7XG4gIGxldCB3aWxkY2FyZCA9IFwiLlwiO1xuICBpZiAoc2VwYXJhdG9yID09PSB0cnVlKSB7XG4gICAgc2VwYXJhdG9yU3BsaXR0ZXIgPSBcIi9cIjtcbiAgICBzZXBhcmF0b3JNYXRjaGVyID0gXCJbL1xcXFxcXFxcXVwiO1xuICAgIHdpbGRjYXJkID0gXCJbXi9cXFxcXFxcXF1cIjtcbiAgfSBlbHNlIGlmIChzZXBhcmF0b3IpIHtcbiAgICBzZXBhcmF0b3JTcGxpdHRlciA9IHNlcGFyYXRvcjtcbiAgICBzZXBhcmF0b3JNYXRjaGVyID0gZXNjYXBlUmVnRXhwU3RyaW5nKHNlcGFyYXRvclNwbGl0dGVyKTtcbiAgICBpZiAoc2VwYXJhdG9yTWF0Y2hlci5sZW5ndGggPiAxKSB7XG4gICAgICBzZXBhcmF0b3JNYXRjaGVyID0gYCg/OiR7c2VwYXJhdG9yTWF0Y2hlcn0pYDtcbiAgICAgIHdpbGRjYXJkID0gYCgoPyEke3NlcGFyYXRvck1hdGNoZXJ9KS4pYDtcbiAgICB9IGVsc2Uge1xuICAgICAgd2lsZGNhcmQgPSBgW14ke3NlcGFyYXRvck1hdGNoZXJ9XWA7XG4gICAgfVxuICB9XG4gIGxldCByZXF1aXJlZFNlcGFyYXRvciA9IHNlcGFyYXRvciA/IGAke3NlcGFyYXRvck1hdGNoZXJ9Kz9gIDogXCJcIjtcbiAgbGV0IG9wdGlvbmFsU2VwYXJhdG9yID0gc2VwYXJhdG9yID8gYCR7c2VwYXJhdG9yTWF0Y2hlcn0qP2AgOiBcIlwiO1xuICBsZXQgc2VnbWVudHMgPSBzZXBhcmF0b3IgPyBwYXR0ZXJuLnNwbGl0KHNlcGFyYXRvclNwbGl0dGVyKSA6IFtwYXR0ZXJuXTtcbiAgbGV0IHJlc3VsdCA9IFwiXCI7XG4gIGZvciAobGV0IHMgPSAwOyBzIDwgc2VnbWVudHMubGVuZ3RoOyBzKyspIHtcbiAgICBsZXQgc2VnbWVudCA9IHNlZ21lbnRzW3NdO1xuICAgIGxldCBuZXh0U2VnbWVudCA9IHNlZ21lbnRzW3MgKyAxXTtcbiAgICBsZXQgY3VycmVudFNlcGFyYXRvciA9IFwiXCI7XG4gICAgaWYgKCFzZWdtZW50ICYmIHMgPiAwKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgaWYgKHNlcGFyYXRvcikge1xuICAgICAgaWYgKHMgPT09IHNlZ21lbnRzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgY3VycmVudFNlcGFyYXRvciA9IG9wdGlvbmFsU2VwYXJhdG9yO1xuICAgICAgfSBlbHNlIGlmIChuZXh0U2VnbWVudCAhPT0gXCIqKlwiKSB7XG4gICAgICAgIGN1cnJlbnRTZXBhcmF0b3IgPSByZXF1aXJlZFNlcGFyYXRvcjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGN1cnJlbnRTZXBhcmF0b3IgPSBcIlwiO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoc2VwYXJhdG9yICYmIHNlZ21lbnQgPT09IFwiKipcIikge1xuICAgICAgaWYgKGN1cnJlbnRTZXBhcmF0b3IpIHtcbiAgICAgICAgcmVzdWx0ICs9IHMgPT09IDAgPyBcIlwiIDogY3VycmVudFNlcGFyYXRvcjtcbiAgICAgICAgcmVzdWx0ICs9IGAoPzoke3dpbGRjYXJkfSo/JHtjdXJyZW50U2VwYXJhdG9yfSkqP2A7XG4gICAgICB9XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgZm9yIChsZXQgYyA9IDA7IGMgPCBzZWdtZW50Lmxlbmd0aDsgYysrKSB7XG4gICAgICBsZXQgY2hhciA9IHNlZ21lbnRbY107XG4gICAgICBpZiAoY2hhciA9PT0gXCJcXFxcXCIpIHtcbiAgICAgICAgaWYgKGMgPCBzZWdtZW50Lmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICByZXN1bHQgKz0gZXNjYXBlUmVnRXhwQ2hhcihzZWdtZW50W2MgKyAxXSk7XG4gICAgICAgICAgYysrO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGNoYXIgPT09IFwiP1wiKSB7XG4gICAgICAgIHJlc3VsdCArPSB3aWxkY2FyZDtcbiAgICAgIH0gZWxzZSBpZiAoY2hhciA9PT0gXCIqXCIpIHtcbiAgICAgICAgcmVzdWx0ICs9IGAke3dpbGRjYXJkfSo/YDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc3VsdCArPSBlc2NhcGVSZWdFeHBDaGFyKGNoYXIpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXN1bHQgKz0gY3VycmVudFNlcGFyYXRvcjtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuZnVuY3Rpb24gaXNNYXRjaChyZWdleHAsIHNhbXBsZSkge1xuICBpZiAodHlwZW9mIHNhbXBsZSAhPT0gXCJzdHJpbmdcIikge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoYFNhbXBsZSBtdXN0IGJlIGEgc3RyaW5nLCBidXQgJHt0eXBlb2Ygc2FtcGxlfSBnaXZlbmApO1xuICB9XG4gIHJldHVybiByZWdleHAudGVzdChzYW1wbGUpO1xufVxuZnVuY3Rpb24gd2lsZGNhcmRNYXRjaChwYXR0ZXJuLCBvcHRpb25zKSB7XG4gIGlmICh0eXBlb2YgcGF0dGVybiAhPT0gXCJzdHJpbmdcIiAmJiAhQXJyYXkuaXNBcnJheShwYXR0ZXJuKSkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXG4gICAgICBgVGhlIGZpcnN0IGFyZ3VtZW50IG11c3QgYmUgYSBzaW5nbGUgcGF0dGVybiBzdHJpbmcgb3IgYW4gYXJyYXkgb2YgcGF0dGVybnMsIGJ1dCAke3R5cGVvZiBwYXR0ZXJufSBnaXZlbmBcbiAgICApO1xuICB9XG4gIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gXCJzdHJpbmdcIiB8fCB0eXBlb2Ygb3B0aW9ucyA9PT0gXCJib29sZWFuXCIpIHtcbiAgICBvcHRpb25zID0geyBzZXBhcmF0b3I6IG9wdGlvbnMgfTtcbiAgfVxuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMiAmJiAhKHR5cGVvZiBvcHRpb25zID09PSBcInVuZGVmaW5lZFwiIHx8IHR5cGVvZiBvcHRpb25zID09PSBcIm9iamVjdFwiICYmIG9wdGlvbnMgIT09IG51bGwgJiYgIUFycmF5LmlzQXJyYXkob3B0aW9ucykpKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcbiAgICAgIGBUaGUgc2Vjb25kIGFyZ3VtZW50IG11c3QgYmUgYW4gb3B0aW9ucyBvYmplY3Qgb3IgYSBzdHJpbmcvYm9vbGVhbiBzZXBhcmF0b3IsIGJ1dCAke3R5cGVvZiBvcHRpb25zfSBnaXZlbmBcbiAgICApO1xuICB9XG4gIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICBpZiAob3B0aW9ucy5zZXBhcmF0b3IgPT09IFwiXFxcXFwiKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgXCJcXFxcIGlzIG5vdCBhIHZhbGlkIHNlcGFyYXRvciBiZWNhdXNlIGl0IGlzIHVzZWQgZm9yIGVzY2FwaW5nLiBUcnkgc2V0dGluZyB0aGUgc2VwYXJhdG9yIHRvIGB0cnVlYCBpbnN0ZWFkXCJcbiAgICApO1xuICB9XG4gIGxldCByZWdleHBQYXR0ZXJuID0gdHJhbnNmb3JtKHBhdHRlcm4sIG9wdGlvbnMuc2VwYXJhdG9yKTtcbiAgbGV0IHJlZ2V4cCA9IG5ldyBSZWdFeHAoYF4ke3JlZ2V4cFBhdHRlcm59JGAsIG9wdGlvbnMuZmxhZ3MpO1xuICBsZXQgZm4gPSBpc01hdGNoLmJpbmQobnVsbCwgcmVnZXhwKTtcbiAgZm4ub3B0aW9ucyA9IG9wdGlvbnM7XG4gIGZuLnBhdHRlcm4gPSBwYXR0ZXJuO1xuICBmbi5yZWdleHAgPSByZWdleHA7XG4gIHJldHVybiBmbjtcbn1cblxuY29uc3Qgb3JpZ2luQ2hlY2tNaWRkbGV3YXJlID0gY3JlYXRlQXV0aE1pZGRsZXdhcmUoYXN5bmMgKGN0eCkgPT4ge1xuICBpZiAoY3R4LnJlcXVlc3Q/Lm1ldGhvZCAhPT0gXCJQT1NUXCIgfHwgIWN0eC5yZXF1ZXN0KSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHsgYm9keSwgcXVlcnksIGNvbnRleHQgfSA9IGN0eDtcbiAgY29uc3Qgb3JpZ2luSGVhZGVyID0gY3R4LmhlYWRlcnM/LmdldChcIm9yaWdpblwiKSB8fCBjdHguaGVhZGVycz8uZ2V0KFwicmVmZXJlclwiKSB8fCBcIlwiO1xuICBjb25zdCBjYWxsYmFja1VSTCA9IGJvZHk/LmNhbGxiYWNrVVJMIHx8IHF1ZXJ5Py5jYWxsYmFja1VSTDtcbiAgY29uc3QgcmVkaXJlY3RVUkwgPSBib2R5Py5yZWRpcmVjdFRvO1xuICBjb25zdCBlcnJvckNhbGxiYWNrVVJMID0gYm9keT8uZXJyb3JDYWxsYmFja1VSTDtcbiAgY29uc3QgbmV3VXNlckNhbGxiYWNrVVJMID0gYm9keT8ubmV3VXNlckNhbGxiYWNrVVJMO1xuICBjb25zdCB0cnVzdGVkT3JpZ2lucyA9IEFycmF5LmlzQXJyYXkoY29udGV4dC5vcHRpb25zLnRydXN0ZWRPcmlnaW5zKSA/IGNvbnRleHQudHJ1c3RlZE9yaWdpbnMgOiBbXG4gICAgLi4uY29udGV4dC50cnVzdGVkT3JpZ2lucyxcbiAgICAuLi5hd2FpdCBjb250ZXh0Lm9wdGlvbnMudHJ1c3RlZE9yaWdpbnM/LihjdHgucmVxdWVzdCkgfHwgW11cbiAgXTtcbiAgY29uc3QgdXNlc0Nvb2tpZXMgPSBjdHguaGVhZGVycz8uaGFzKFwiY29va2llXCIpO1xuICBjb25zdCBtYXRjaGVzUGF0dGVybiA9ICh1cmwsIHBhdHRlcm4pID0+IHtcbiAgICBpZiAodXJsLnN0YXJ0c1dpdGgoXCIvXCIpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChwYXR0ZXJuLmluY2x1ZGVzKFwiKlwiKSkge1xuICAgICAgaWYgKHBhdHRlcm4uaW5jbHVkZXMoXCI6Ly9cIikpIHtcbiAgICAgICAgcmV0dXJuIHdpbGRjYXJkTWF0Y2gocGF0dGVybikoZ2V0T3JpZ2luKHVybCkgfHwgdXJsKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB3aWxkY2FyZE1hdGNoKHBhdHRlcm4pKGdldEhvc3QodXJsKSk7XG4gICAgfVxuICAgIGNvbnN0IHByb3RvY29sID0gZ2V0UHJvdG9jb2wodXJsKTtcbiAgICByZXR1cm4gcHJvdG9jb2wgPT09IFwiaHR0cDpcIiB8fCBwcm90b2NvbCA9PT0gXCJodHRwczpcIiB8fCAhcHJvdG9jb2wgPyBwYXR0ZXJuID09PSBnZXRPcmlnaW4odXJsKSA6IHVybC5zdGFydHNXaXRoKHBhdHRlcm4pO1xuICB9O1xuICBjb25zdCB2YWxpZGF0ZVVSTCA9ICh1cmwsIGxhYmVsKSA9PiB7XG4gICAgaWYgKCF1cmwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgaXNUcnVzdGVkT3JpZ2luID0gdHJ1c3RlZE9yaWdpbnMuc29tZShcbiAgICAgIChvcmlnaW4pID0+IG1hdGNoZXNQYXR0ZXJuKHVybCwgb3JpZ2luKSB8fCB1cmw/LnN0YXJ0c1dpdGgoXCIvXCIpICYmIGxhYmVsICE9PSBcIm9yaWdpblwiICYmIC9eXFwvKD8hXFwvfFxcXFx8JTJmfCU1YylbXFx3XFwtLlxcKy9AXSooPzpcXD9bXFx3XFwtLlxcKy89JiVAXSopPyQvLnRlc3QodXJsKVxuICAgICk7XG4gICAgaWYgKCFpc1RydXN0ZWRPcmlnaW4pIHtcbiAgICAgIGN0eC5jb250ZXh0LmxvZ2dlci5lcnJvcihgSW52YWxpZCAke2xhYmVsfTogJHt1cmx9YCk7XG4gICAgICBjdHguY29udGV4dC5sb2dnZXIuaW5mbyhcbiAgICAgICAgYElmIGl0J3MgYSB2YWxpZCBVUkwsIHBsZWFzZSBhZGQgJHt1cmx9IHRvIHRydXN0ZWRPcmlnaW5zIGluIHlvdXIgYXV0aCBjb25maWdcbmAsXG4gICAgICAgIGBDdXJyZW50IGxpc3Qgb2YgdHJ1c3RlZE9yaWdpbnM6ICR7dHJ1c3RlZE9yaWdpbnN9YFxuICAgICAgKTtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkZPUkJJRERFTlwiLCB7IG1lc3NhZ2U6IGBJbnZhbGlkICR7bGFiZWx9YCB9KTtcbiAgICB9XG4gIH07XG4gIGlmICh1c2VzQ29va2llcyAmJiAhY3R4LmNvbnRleHQub3B0aW9ucy5hZHZhbmNlZD8uZGlzYWJsZUNTUkZDaGVjaykge1xuICAgIHZhbGlkYXRlVVJMKG9yaWdpbkhlYWRlciwgXCJvcmlnaW5cIik7XG4gIH1cbiAgY2FsbGJhY2tVUkwgJiYgdmFsaWRhdGVVUkwoY2FsbGJhY2tVUkwsIFwiY2FsbGJhY2tVUkxcIik7XG4gIHJlZGlyZWN0VVJMICYmIHZhbGlkYXRlVVJMKHJlZGlyZWN0VVJMLCBcInJlZGlyZWN0VVJMXCIpO1xuICBlcnJvckNhbGxiYWNrVVJMICYmIHZhbGlkYXRlVVJMKGVycm9yQ2FsbGJhY2tVUkwsIFwiZXJyb3JDYWxsYmFja1VSTFwiKTtcbiAgbmV3VXNlckNhbGxiYWNrVVJMICYmIHZhbGlkYXRlVVJMKG5ld1VzZXJDYWxsYmFja1VSTCwgXCJuZXdVc2VyQ2FsbGJhY2tVUkxcIik7XG59KTtcbmNvbnN0IG9yaWdpbkNoZWNrID0gKGdldFZhbHVlKSA9PiBjcmVhdGVBdXRoTWlkZGxld2FyZShhc3luYyAoY3R4KSA9PiB7XG4gIGlmICghY3R4LnJlcXVlc3QpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgeyBjb250ZXh0IH0gPSBjdHg7XG4gIGNvbnN0IGNhbGxiYWNrVVJMID0gZ2V0VmFsdWUoY3R4KTtcbiAgY29uc3QgdHJ1c3RlZE9yaWdpbnMgPSBBcnJheS5pc0FycmF5KFxuICAgIGNvbnRleHQub3B0aW9ucy50cnVzdGVkT3JpZ2luc1xuICApID8gY29udGV4dC50cnVzdGVkT3JpZ2lucyA6IFtcbiAgICAuLi5jb250ZXh0LnRydXN0ZWRPcmlnaW5zLFxuICAgIC4uLmF3YWl0IGNvbnRleHQub3B0aW9ucy50cnVzdGVkT3JpZ2lucz8uKGN0eC5yZXF1ZXN0KSB8fCBbXVxuICBdO1xuICBjb25zdCBtYXRjaGVzUGF0dGVybiA9ICh1cmwsIHBhdHRlcm4pID0+IHtcbiAgICBpZiAodXJsLnN0YXJ0c1dpdGgoXCIvXCIpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChwYXR0ZXJuLmluY2x1ZGVzKFwiKlwiKSkge1xuICAgICAgaWYgKHBhdHRlcm4uaW5jbHVkZXMoXCI6Ly9cIikpIHtcbiAgICAgICAgcmV0dXJuIHdpbGRjYXJkTWF0Y2gocGF0dGVybikoZ2V0T3JpZ2luKHVybCkgfHwgdXJsKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB3aWxkY2FyZE1hdGNoKHBhdHRlcm4pKGdldEhvc3QodXJsKSk7XG4gICAgfVxuICAgIGNvbnN0IHByb3RvY29sID0gZ2V0UHJvdG9jb2wodXJsKTtcbiAgICByZXR1cm4gcHJvdG9jb2wgPT09IFwiaHR0cDpcIiB8fCBwcm90b2NvbCA9PT0gXCJodHRwczpcIiB8fCAhcHJvdG9jb2wgPyBwYXR0ZXJuID09PSBnZXRPcmlnaW4odXJsKSA6IHVybC5zdGFydHNXaXRoKHBhdHRlcm4pO1xuICB9O1xuICBjb25zdCB2YWxpZGF0ZVVSTCA9ICh1cmwsIGxhYmVsKSA9PiB7XG4gICAgaWYgKCF1cmwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgaXNUcnVzdGVkT3JpZ2luID0gdHJ1c3RlZE9yaWdpbnMuc29tZShcbiAgICAgIChvcmlnaW4pID0+IG1hdGNoZXNQYXR0ZXJuKHVybCwgb3JpZ2luKSB8fCB1cmw/LnN0YXJ0c1dpdGgoXCIvXCIpICYmIGxhYmVsICE9PSBcIm9yaWdpblwiICYmIC9eXFwvKD8hXFwvfFxcXFx8JTJmfCU1YylbXFx3XFwtLlxcKy9AXSooPzpcXD9bXFx3XFwtLlxcKy89JiVAXSopPyQvLnRlc3QoXG4gICAgICAgIHVybFxuICAgICAgKVxuICAgICk7XG4gICAgaWYgKCFpc1RydXN0ZWRPcmlnaW4pIHtcbiAgICAgIGN0eC5jb250ZXh0LmxvZ2dlci5lcnJvcihgSW52YWxpZCAke2xhYmVsfTogJHt1cmx9YCk7XG4gICAgICBjdHguY29udGV4dC5sb2dnZXIuaW5mbyhcbiAgICAgICAgYElmIGl0J3MgYSB2YWxpZCBVUkwsIHBsZWFzZSBhZGQgJHt1cmx9IHRvIHRydXN0ZWRPcmlnaW5zIGluIHlvdXIgYXV0aCBjb25maWdcbmAsXG4gICAgICAgIGBDdXJyZW50IGxpc3Qgb2YgdHJ1c3RlZE9yaWdpbnM6ICR7dHJ1c3RlZE9yaWdpbnN9YFxuICAgICAgKTtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkZPUkJJRERFTlwiLCB7IG1lc3NhZ2U6IGBJbnZhbGlkICR7bGFiZWx9YCB9KTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGNhbGxiYWNrcyA9IEFycmF5LmlzQXJyYXkoY2FsbGJhY2tVUkwpID8gY2FsbGJhY2tVUkwgOiBbY2FsbGJhY2tVUkxdO1xuICBmb3IgKGNvbnN0IHVybCBvZiBjYWxsYmFja3MpIHtcbiAgICB2YWxpZGF0ZVVSTCh1cmwsIFwiY2FsbGJhY2tVUkxcIik7XG4gIH1cbn0pO1xuXG5jb25zdCBCQVNFX0VSUk9SX0NPREVTID0ge1xuICBVU0VSX05PVF9GT1VORDogXCJVc2VyIG5vdCBmb3VuZFwiLFxuICBGQUlMRURfVE9fQ1JFQVRFX1VTRVI6IFwiRmFpbGVkIHRvIGNyZWF0ZSB1c2VyXCIsXG4gIEZBSUxFRF9UT19DUkVBVEVfU0VTU0lPTjogXCJGYWlsZWQgdG8gY3JlYXRlIHNlc3Npb25cIixcbiAgRkFJTEVEX1RPX1VQREFURV9VU0VSOiBcIkZhaWxlZCB0byB1cGRhdGUgdXNlclwiLFxuICBGQUlMRURfVE9fR0VUX1NFU1NJT046IFwiRmFpbGVkIHRvIGdldCBzZXNzaW9uXCIsXG4gIElOVkFMSURfUEFTU1dPUkQ6IFwiSW52YWxpZCBwYXNzd29yZFwiLFxuICBJTlZBTElEX0VNQUlMOiBcIkludmFsaWQgZW1haWxcIixcbiAgSU5WQUxJRF9FTUFJTF9PUl9QQVNTV09SRDogXCJJbnZhbGlkIGVtYWlsIG9yIHBhc3N3b3JkXCIsXG4gIFNPQ0lBTF9BQ0NPVU5UX0FMUkVBRFlfTElOS0VEOiBcIlNvY2lhbCBhY2NvdW50IGFscmVhZHkgbGlua2VkXCIsXG4gIFBST1ZJREVSX05PVF9GT1VORDogXCJQcm92aWRlciBub3QgZm91bmRcIixcbiAgSU5WQUxJRF9UT0tFTjogXCJpbnZhbGlkIHRva2VuXCIsXG4gIElEX1RPS0VOX05PVF9TVVBQT1JURUQ6IFwiaWRfdG9rZW4gbm90IHN1cHBvcnRlZFwiLFxuICBGQUlMRURfVE9fR0VUX1VTRVJfSU5GTzogXCJGYWlsZWQgdG8gZ2V0IHVzZXIgaW5mb1wiLFxuICBVU0VSX0VNQUlMX05PVF9GT1VORDogXCJVc2VyIGVtYWlsIG5vdCBmb3VuZFwiLFxuICBFTUFJTF9OT1RfVkVSSUZJRUQ6IFwiRW1haWwgbm90IHZlcmlmaWVkXCIsXG4gIFBBU1NXT1JEX1RPT19TSE9SVDogXCJQYXNzd29yZCB0b28gc2hvcnRcIixcbiAgUEFTU1dPUkRfVE9PX0xPTkc6IFwiUGFzc3dvcmQgdG9vIGxvbmdcIixcbiAgVVNFUl9BTFJFQURZX0VYSVNUUzogXCJVc2VyIGFscmVhZHkgZXhpc3RzXCIsXG4gIEVNQUlMX0NBTl9OT1RfQkVfVVBEQVRFRDogXCJFbWFpbCBjYW4gbm90IGJlIHVwZGF0ZWRcIixcbiAgQ1JFREVOVElBTF9BQ0NPVU5UX05PVF9GT1VORDogXCJDcmVkZW50aWFsIGFjY291bnQgbm90IGZvdW5kXCIsXG4gIFNFU1NJT05fRVhQSVJFRDogXCJTZXNzaW9uIGV4cGlyZWQuIFJlLWF1dGhlbnRpY2F0ZSB0byBwZXJmb3JtIHRoaXMgYWN0aW9uLlwiLFxuICBGQUlMRURfVE9fVU5MSU5LX0xBU1RfQUNDT1VOVDogXCJZb3UgY2FuJ3QgdW5saW5rIHlvdXIgbGFzdCBhY2NvdW50XCIsXG4gIEFDQ09VTlRfTk9UX0ZPVU5EOiBcIkFjY291bnQgbm90IGZvdW5kXCIsXG4gIFVTRVJfQUxSRUFEWV9IQVNfUEFTU1dPUkQ6IFwiVXNlciBhbHJlYWR5IGhhcyBhIHBhc3N3b3JkLiBQcm92aWRlIHRoYXQgdG8gZGVsZXRlIHRoZSBhY2NvdW50LlwiXG59O1xuXG5jb25zdCBnZXRTZXNzaW9uID0gKCkgPT4gY3JlYXRlQXV0aEVuZHBvaW50KFxuICBcIi9nZXQtc2Vzc2lvblwiLFxuICB7XG4gICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgIHF1ZXJ5OiB6Lm9wdGlvbmFsKFxuICAgICAgei5vYmplY3Qoe1xuICAgICAgICAvKipcbiAgICAgICAgICogSWYgY29va2llIGNhY2hlIGlzIGVuYWJsZWQsIGl0IHdpbGwgZGlzYWJsZSB0aGUgY2FjaGVcbiAgICAgICAgICogYW5kIGZldGNoIHRoZSBzZXNzaW9uIGZyb20gdGhlIGRhdGFiYXNlXG4gICAgICAgICAqL1xuICAgICAgICBkaXNhYmxlQ29va2llQ2FjaGU6IHouY29lcmNlLmJvb2xlYW4oKS5tZXRhKHtcbiAgICAgICAgICBkZXNjcmlwdGlvbjogXCJEaXNhYmxlIGNvb2tpZSBjYWNoZSBhbmQgZmV0Y2ggc2Vzc2lvbiBmcm9tIGRhdGFiYXNlXCJcbiAgICAgICAgfSkub3B0aW9uYWwoKSxcbiAgICAgICAgZGlzYWJsZVJlZnJlc2g6IHouY29lcmNlLmJvb2xlYW4oKS5tZXRhKHtcbiAgICAgICAgICBkZXNjcmlwdGlvbjogXCJEaXNhYmxlIHNlc3Npb24gcmVmcmVzaC4gVXNlZnVsIGZvciBjaGVja2luZyBzZXNzaW9uIHN0YXR1cywgd2l0aG91dCB1cGRhdGluZyB0aGUgc2Vzc2lvblwiXG4gICAgICAgIH0pLm9wdGlvbmFsKClcbiAgICAgIH0pXG4gICAgKSxcbiAgICByZXF1aXJlSGVhZGVyczogdHJ1ZSxcbiAgICBtZXRhZGF0YToge1xuICAgICAgb3BlbmFwaToge1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJHZXQgdGhlIGN1cnJlbnQgc2Vzc2lvblwiLFxuICAgICAgICByZXNwb25zZXM6IHtcbiAgICAgICAgICBcIjIwMFwiOiB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJTdWNjZXNzXCIsXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiOiB7XG4gICAgICAgICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgJHJlZjogXCIjL2NvbXBvbmVudHMvc2NoZW1hcy9TZXNzaW9uXCJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgICAgICAgICRyZWY6IFwiIy9jb21wb25lbnRzL3NjaGVtYXMvVXNlclwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICByZXF1aXJlZDogW1wic2Vzc2lvblwiLCBcInVzZXJcIl1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGFzeW5jIChjdHgpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc2Vzc2lvbkNvb2tpZVRva2VuID0gYXdhaXQgY3R4LmdldFNpZ25lZENvb2tpZShcbiAgICAgICAgY3R4LmNvbnRleHQuYXV0aENvb2tpZXMuc2Vzc2lvblRva2VuLm5hbWUsXG4gICAgICAgIGN0eC5jb250ZXh0LnNlY3JldFxuICAgICAgKTtcbiAgICAgIGlmICghc2Vzc2lvbkNvb2tpZVRva2VuKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3Qgc2Vzc2lvbkRhdGFDb29raWUgPSBjdHguZ2V0Q29va2llKFxuICAgICAgICBjdHguY29udGV4dC5hdXRoQ29va2llcy5zZXNzaW9uRGF0YS5uYW1lXG4gICAgICApO1xuICAgICAgY29uc3Qgc2Vzc2lvbkRhdGFQYXlsb2FkID0gc2Vzc2lvbkRhdGFDb29raWUgPyBzYWZlSlNPTlBhcnNlKGJpbmFyeS5kZWNvZGUoYmFzZTY0LmRlY29kZShzZXNzaW9uRGF0YUNvb2tpZSkpKSA6IG51bGw7XG4gICAgICBpZiAoc2Vzc2lvbkRhdGFQYXlsb2FkKSB7XG4gICAgICAgIGNvbnN0IGlzVmFsaWQgPSBhd2FpdCBjcmVhdGVITUFDKFwiU0hBLTI1NlwiLCBcImJhc2U2NHVybG5vcGFkXCIpLnZlcmlmeShcbiAgICAgICAgICBjdHguY29udGV4dC5zZWNyZXQsXG4gICAgICAgICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgLi4uc2Vzc2lvbkRhdGFQYXlsb2FkLnNlc3Npb24sXG4gICAgICAgICAgICBleHBpcmVzQXQ6IHNlc3Npb25EYXRhUGF5bG9hZC5leHBpcmVzQXRcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBzZXNzaW9uRGF0YVBheWxvYWQuc2lnbmF0dXJlXG4gICAgICAgICk7XG4gICAgICAgIGlmICghaXNWYWxpZCkge1xuICAgICAgICAgIGNvbnN0IGRhdGFDb29raWUgPSBjdHguY29udGV4dC5hdXRoQ29va2llcy5zZXNzaW9uRGF0YS5uYW1lO1xuICAgICAgICAgIGN0eC5zZXRDb29raWUoZGF0YUNvb2tpZSwgXCJcIiwge1xuICAgICAgICAgICAgbWF4QWdlOiAwXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIGN0eC5qc29uKG51bGwpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjb25zdCBkb250UmVtZW1iZXJNZSA9IGF3YWl0IGN0eC5nZXRTaWduZWRDb29raWUoXG4gICAgICAgIGN0eC5jb250ZXh0LmF1dGhDb29raWVzLmRvbnRSZW1lbWJlclRva2VuLm5hbWUsXG4gICAgICAgIGN0eC5jb250ZXh0LnNlY3JldFxuICAgICAgKTtcbiAgICAgIGlmIChzZXNzaW9uRGF0YVBheWxvYWQ/LnNlc3Npb24gJiYgY3R4LmNvbnRleHQub3B0aW9ucy5zZXNzaW9uPy5jb29raWVDYWNoZT8uZW5hYmxlZCAmJiAhY3R4LnF1ZXJ5Py5kaXNhYmxlQ29va2llQ2FjaGUpIHtcbiAgICAgICAgY29uc3Qgc2Vzc2lvbjIgPSBzZXNzaW9uRGF0YVBheWxvYWQuc2Vzc2lvbjtcbiAgICAgICAgY29uc3QgaGFzRXhwaXJlZCA9IHNlc3Npb25EYXRhUGF5bG9hZC5leHBpcmVzQXQgPCBEYXRlLm5vdygpIHx8IHNlc3Npb24yLnNlc3Npb24uZXhwaXJlc0F0IDwgLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCk7XG4gICAgICAgIGlmICghaGFzRXhwaXJlZCkge1xuICAgICAgICAgIGN0eC5jb250ZXh0LnNlc3Npb24gPSBzZXNzaW9uMjtcbiAgICAgICAgICByZXR1cm4gY3R4Lmpzb24oXG4gICAgICAgICAgICBzZXNzaW9uMlxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgZGF0YUNvb2tpZSA9IGN0eC5jb250ZXh0LmF1dGhDb29raWVzLnNlc3Npb25EYXRhLm5hbWU7XG4gICAgICAgICAgY3R4LnNldENvb2tpZShkYXRhQ29va2llLCBcIlwiLCB7XG4gICAgICAgICAgICBtYXhBZ2U6IDBcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5maW5kU2Vzc2lvbihzZXNzaW9uQ29va2llVG9rZW4pO1xuICAgICAgY3R4LmNvbnRleHQuc2Vzc2lvbiA9IHNlc3Npb247XG4gICAgICBpZiAoIXNlc3Npb24gfHwgc2Vzc2lvbi5zZXNzaW9uLmV4cGlyZXNBdCA8IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpKSB7XG4gICAgICAgIGRlbGV0ZVNlc3Npb25Db29raWUoY3R4KTtcbiAgICAgICAgaWYgKHNlc3Npb24pIHtcbiAgICAgICAgICBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZGVsZXRlU2Vzc2lvbihcbiAgICAgICAgICAgIHNlc3Npb24uc2Vzc2lvbi50b2tlblxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGN0eC5qc29uKG51bGwpO1xuICAgICAgfVxuICAgICAgaWYgKGRvbnRSZW1lbWJlck1lIHx8IGN0eC5xdWVyeT8uZGlzYWJsZVJlZnJlc2gpIHtcbiAgICAgICAgcmV0dXJuIGN0eC5qc29uKFxuICAgICAgICAgIHNlc3Npb25cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGV4cGlyZXNJbiA9IGN0eC5jb250ZXh0LnNlc3Npb25Db25maWcuZXhwaXJlc0luO1xuICAgICAgY29uc3QgdXBkYXRlQWdlID0gY3R4LmNvbnRleHQuc2Vzc2lvbkNvbmZpZy51cGRhdGVBZ2U7XG4gICAgICBjb25zdCBzZXNzaW9uSXNEdWVUb0JlVXBkYXRlZERhdGUgPSBzZXNzaW9uLnNlc3Npb24uZXhwaXJlc0F0LnZhbHVlT2YoKSAtIGV4cGlyZXNJbiAqIDFlMyArIHVwZGF0ZUFnZSAqIDFlMztcbiAgICAgIGNvbnN0IHNob3VsZEJlVXBkYXRlZCA9IHNlc3Npb25Jc0R1ZVRvQmVVcGRhdGVkRGF0ZSA8PSBEYXRlLm5vdygpO1xuICAgICAgaWYgKHNob3VsZEJlVXBkYXRlZCAmJiAoIWN0eC5xdWVyeT8uZGlzYWJsZVJlZnJlc2ggfHwgIWN0eC5jb250ZXh0Lm9wdGlvbnMuc2Vzc2lvbj8uZGlzYWJsZVNlc3Npb25SZWZyZXNoKSkge1xuICAgICAgICBjb25zdCB1cGRhdGVkU2Vzc2lvbiA9IGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci51cGRhdGVTZXNzaW9uKFxuICAgICAgICAgIHNlc3Npb24uc2Vzc2lvbi50b2tlbixcbiAgICAgICAgICB7XG4gICAgICAgICAgICBleHBpcmVzQXQ6IGdldERhdGUoY3R4LmNvbnRleHQuc2Vzc2lvbkNvbmZpZy5leHBpcmVzSW4sIFwic2VjXCIpLFxuICAgICAgICAgICAgdXBkYXRlZEF0OiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKVxuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgaWYgKCF1cGRhdGVkU2Vzc2lvbikge1xuICAgICAgICAgIGRlbGV0ZVNlc3Npb25Db29raWUoY3R4KTtcbiAgICAgICAgICByZXR1cm4gY3R4Lmpzb24obnVsbCwgeyBzdGF0dXM6IDQwMSB9KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtYXhBZ2UgPSAodXBkYXRlZFNlc3Npb24uZXhwaXJlc0F0LnZhbHVlT2YoKSAtIERhdGUubm93KCkpIC8gMWUzO1xuICAgICAgICBhd2FpdCBzZXRTZXNzaW9uQ29va2llKFxuICAgICAgICAgIGN0eCxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzZXNzaW9uOiB1cGRhdGVkU2Vzc2lvbixcbiAgICAgICAgICAgIHVzZXI6IHNlc3Npb24udXNlclxuICAgICAgICAgIH0sXG4gICAgICAgICAgZmFsc2UsXG4gICAgICAgICAge1xuICAgICAgICAgICAgbWF4QWdlXG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4gY3R4Lmpzb24oe1xuICAgICAgICAgIHNlc3Npb246IHVwZGF0ZWRTZXNzaW9uLFxuICAgICAgICAgIHVzZXI6IHNlc3Npb24udXNlclxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGF3YWl0IHNldENvb2tpZUNhY2hlKGN0eCwgc2Vzc2lvbik7XG4gICAgICByZXR1cm4gY3R4Lmpzb24oXG4gICAgICAgIHNlc3Npb25cbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGN0eC5jb250ZXh0LmxvZ2dlci5lcnJvcihcIklOVEVSTkFMX1NFUlZFUl9FUlJPUlwiLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJJTlRFUk5BTF9TRVJWRVJfRVJST1JcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLkZBSUxFRF9UT19HRVRfU0VTU0lPTlxuICAgICAgfSk7XG4gICAgfVxuICB9XG4pO1xuY29uc3QgZ2V0U2Vzc2lvbkZyb21DdHggPSBhc3luYyAoY3R4LCBjb25maWcpID0+IHtcbiAgaWYgKGN0eC5jb250ZXh0LnNlc3Npb24pIHtcbiAgICByZXR1cm4gY3R4LmNvbnRleHQuc2Vzc2lvbjtcbiAgfVxuICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZ2V0U2Vzc2lvbigpKHtcbiAgICAuLi5jdHgsXG4gICAgYXNSZXNwb25zZTogZmFsc2UsXG4gICAgaGVhZGVyczogY3R4LmhlYWRlcnMsXG4gICAgcmV0dXJuSGVhZGVyczogZmFsc2UsXG4gICAgcXVlcnk6IHtcbiAgICAgIC4uLmNvbmZpZyxcbiAgICAgIC4uLmN0eC5xdWVyeVxuICAgIH1cbiAgfSkuY2F0Y2goKGUpID0+IHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfSk7XG4gIGN0eC5jb250ZXh0LnNlc3Npb24gPSBzZXNzaW9uO1xuICByZXR1cm4gc2Vzc2lvbjtcbn07XG5jb25zdCBzZXNzaW9uTWlkZGxld2FyZSA9IGNyZWF0ZUF1dGhNaWRkbGV3YXJlKGFzeW5jIChjdHgpID0+IHtcbiAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGdldFNlc3Npb25Gcm9tQ3R4KGN0eCk7XG4gIGlmICghc2Vzc2lvbj8uc2Vzc2lvbikge1xuICAgIHRocm93IG5ldyBBUElFcnJvcihcIlVOQVVUSE9SSVpFRFwiKTtcbiAgfVxuICByZXR1cm4ge1xuICAgIHNlc3Npb25cbiAgfTtcbn0pO1xuY29uc3QgcmVxdWVzdE9ubHlTZXNzaW9uTWlkZGxld2FyZSA9IGNyZWF0ZUF1dGhNaWRkbGV3YXJlKFxuICBhc3luYyAoY3R4KSA9PiB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGdldFNlc3Npb25Gcm9tQ3R4KGN0eCk7XG4gICAgaWYgKCFzZXNzaW9uPy5zZXNzaW9uICYmIChjdHgucmVxdWVzdCB8fCBjdHguaGVhZGVycykpIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIlVOQVVUSE9SSVpFRFwiKTtcbiAgICB9XG4gICAgcmV0dXJuIHsgc2Vzc2lvbiB9O1xuICB9XG4pO1xuY29uc3QgZnJlc2hTZXNzaW9uTWlkZGxld2FyZSA9IGNyZWF0ZUF1dGhNaWRkbGV3YXJlKGFzeW5jIChjdHgpID0+IHtcbiAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGdldFNlc3Npb25Gcm9tQ3R4KGN0eCk7XG4gIGlmICghc2Vzc2lvbj8uc2Vzc2lvbikge1xuICAgIHRocm93IG5ldyBBUElFcnJvcihcIlVOQVVUSE9SSVpFRFwiKTtcbiAgfVxuICBpZiAoY3R4LmNvbnRleHQuc2Vzc2lvbkNvbmZpZy5mcmVzaEFnZSA9PT0gMCkge1xuICAgIHJldHVybiB7XG4gICAgICBzZXNzaW9uXG4gICAgfTtcbiAgfVxuICBjb25zdCBmcmVzaEFnZSA9IGN0eC5jb250ZXh0LnNlc3Npb25Db25maWcuZnJlc2hBZ2U7XG4gIGNvbnN0IGxhc3RVcGRhdGVkID0gc2Vzc2lvbi5zZXNzaW9uLnVwZGF0ZWRBdD8udmFsdWVPZigpIHx8IHNlc3Npb24uc2Vzc2lvbi5jcmVhdGVkQXQudmFsdWVPZigpO1xuICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICBjb25zdCBpc0ZyZXNoID0gbm93IC0gbGFzdFVwZGF0ZWQgPCBmcmVzaEFnZSAqIDFlMztcbiAgaWYgKCFpc0ZyZXNoKSB7XG4gICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiRk9SQklEREVOXCIsIHtcbiAgICAgIG1lc3NhZ2U6IFwiU2Vzc2lvbiBpcyBub3QgZnJlc2hcIlxuICAgIH0pO1xuICB9XG4gIHJldHVybiB7XG4gICAgc2Vzc2lvblxuICB9O1xufSk7XG5jb25zdCBsaXN0U2Vzc2lvbnMgPSAoKSA9PiBjcmVhdGVBdXRoRW5kcG9pbnQoXG4gIFwiL2xpc3Qtc2Vzc2lvbnNcIixcbiAge1xuICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICB1c2U6IFtzZXNzaW9uTWlkZGxld2FyZV0sXG4gICAgcmVxdWlyZUhlYWRlcnM6IHRydWUsXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgIG9wZW5hcGk6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiTGlzdCBhbGwgYWN0aXZlIHNlc3Npb25zIGZvciB0aGUgdXNlclwiLFxuICAgICAgICByZXNwb25zZXM6IHtcbiAgICAgICAgICBcIjIwMFwiOiB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJTdWNjZXNzXCIsXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiOiB7XG4gICAgICAgICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBcImFycmF5XCIsXG4gICAgICAgICAgICAgICAgICBpdGVtczoge1xuICAgICAgICAgICAgICAgICAgICAkcmVmOiBcIiMvY29tcG9uZW50cy9zY2hlbWFzL1Nlc3Npb25cIlxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgYXN5bmMgKGN0eCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzZXNzaW9ucyA9IGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5saXN0U2Vzc2lvbnMoXG4gICAgICAgIGN0eC5jb250ZXh0LnNlc3Npb24udXNlci5pZFxuICAgICAgKTtcbiAgICAgIGNvbnN0IGFjdGl2ZVNlc3Npb25zID0gc2Vzc2lvbnMuZmlsdGVyKChzZXNzaW9uKSA9PiB7XG4gICAgICAgIHJldHVybiBzZXNzaW9uLmV4cGlyZXNBdCA+IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gY3R4Lmpzb24oXG4gICAgICAgIGFjdGl2ZVNlc3Npb25zXG4gICAgICApO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGN0eC5jb250ZXh0LmxvZ2dlci5lcnJvcihlKTtcbiAgICAgIHRocm93IGN0eC5lcnJvcihcIklOVEVSTkFMX1NFUlZFUl9FUlJPUlwiKTtcbiAgICB9XG4gIH1cbik7XG5jb25zdCByZXZva2VTZXNzaW9uID0gY3JlYXRlQXV0aEVuZHBvaW50KFxuICBcIi9yZXZva2Utc2Vzc2lvblwiLFxuICB7XG4gICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICBib2R5OiB6Lm9iamVjdCh7XG4gICAgICB0b2tlbjogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIHRva2VuIHRvIHJldm9rZVwiXG4gICAgICB9KVxuICAgIH0pLFxuICAgIHVzZTogW3Nlc3Npb25NaWRkbGV3YXJlXSxcbiAgICByZXF1aXJlSGVhZGVyczogdHJ1ZSxcbiAgICBtZXRhZGF0YToge1xuICAgICAgb3BlbmFwaToge1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJSZXZva2UgYSBzaW5nbGUgc2Vzc2lvblwiLFxuICAgICAgICByZXF1ZXN0Qm9keToge1xuICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiOiB7XG4gICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgdG9rZW46IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIHRva2VuIHRvIHJldm9rZVwiXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICByZXF1aXJlZDogW1widG9rZW5cIl1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgXCIyMDBcIjoge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiU3VjY2Vzc1wiLFxuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIjoge1xuICAgICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJib29sZWFuXCIsXG4gICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiSW5kaWNhdGVzIGlmIHRoZSBzZXNzaW9uIHdhcyByZXZva2VkIHN1Y2Nlc3NmdWxseVwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICByZXF1aXJlZDogW1wic3RhdHVzXCJdXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBhc3luYyAoY3R4KSA9PiB7XG4gICAgY29uc3QgdG9rZW4gPSBjdHguYm9keS50b2tlbjtcbiAgICBjb25zdCBmaW5kU2Vzc2lvbiA9IGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5maW5kU2Vzc2lvbih0b2tlbik7XG4gICAgaWYgKCFmaW5kU2Vzc2lvbikge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBcIlNlc3Npb24gbm90IGZvdW5kXCJcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoZmluZFNlc3Npb24uc2Vzc2lvbi51c2VySWQgIT09IGN0eC5jb250ZXh0LnNlc3Npb24udXNlci5pZCkge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiVU5BVVRIT1JJWkVEXCIpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmRlbGV0ZVNlc3Npb24odG9rZW4pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjdHguY29udGV4dC5sb2dnZXIuZXJyb3IoXG4gICAgICAgIGVycm9yICYmIHR5cGVvZiBlcnJvciA9PT0gXCJvYmplY3RcIiAmJiBcIm5hbWVcIiBpbiBlcnJvciA/IGVycm9yLm5hbWUgOiBcIlwiLFxuICAgICAgICBlcnJvclxuICAgICAgKTtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIklOVEVSTkFMX1NFUlZFUl9FUlJPUlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIGN0eC5qc29uKHtcbiAgICAgIHN0YXR1czogdHJ1ZVxuICAgIH0pO1xuICB9XG4pO1xuY29uc3QgcmV2b2tlU2Vzc2lvbnMgPSBjcmVhdGVBdXRoRW5kcG9pbnQoXG4gIFwiL3Jldm9rZS1zZXNzaW9uc1wiLFxuICB7XG4gICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICB1c2U6IFtzZXNzaW9uTWlkZGxld2FyZV0sXG4gICAgcmVxdWlyZUhlYWRlcnM6IHRydWUsXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgIG9wZW5hcGk6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiUmV2b2tlIGFsbCBzZXNzaW9ucyBmb3IgdGhlIHVzZXJcIixcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgXCIyMDBcIjoge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiU3VjY2Vzc1wiLFxuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIjoge1xuICAgICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJib29sZWFuXCIsXG4gICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiSW5kaWNhdGVzIGlmIGFsbCBzZXNzaW9ucyB3ZXJlIHJldm9rZWQgc3VjY2Vzc2Z1bGx5XCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBbXCJzdGF0dXNcIl1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGFzeW5jIChjdHgpID0+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmRlbGV0ZVNlc3Npb25zKFxuICAgICAgICBjdHguY29udGV4dC5zZXNzaW9uLnVzZXIuaWRcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGN0eC5jb250ZXh0LmxvZ2dlci5lcnJvcihcbiAgICAgICAgZXJyb3IgJiYgdHlwZW9mIGVycm9yID09PSBcIm9iamVjdFwiICYmIFwibmFtZVwiIGluIGVycm9yID8gZXJyb3IubmFtZSA6IFwiXCIsXG4gICAgICAgIGVycm9yXG4gICAgICApO1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiSU5URVJOQUxfU0VSVkVSX0VSUk9SXCIpO1xuICAgIH1cbiAgICByZXR1cm4gY3R4Lmpzb24oe1xuICAgICAgc3RhdHVzOiB0cnVlXG4gICAgfSk7XG4gIH1cbik7XG5jb25zdCByZXZva2VPdGhlclNlc3Npb25zID0gY3JlYXRlQXV0aEVuZHBvaW50KFxuICBcIi9yZXZva2Utb3RoZXItc2Vzc2lvbnNcIixcbiAge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgcmVxdWlyZUhlYWRlcnM6IHRydWUsXG4gICAgdXNlOiBbc2Vzc2lvbk1pZGRsZXdhcmVdLFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICBvcGVuYXBpOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlJldm9rZSBhbGwgb3RoZXIgc2Vzc2lvbnMgZm9yIHRoZSB1c2VyIGV4Y2VwdCB0aGUgY3VycmVudCBvbmVcIixcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgXCIyMDBcIjoge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiU3VjY2Vzc1wiLFxuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIjoge1xuICAgICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJib29sZWFuXCIsXG4gICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiSW5kaWNhdGVzIGlmIGFsbCBvdGhlciBzZXNzaW9ucyB3ZXJlIHJldm9rZWQgc3VjY2Vzc2Z1bGx5XCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBbXCJzdGF0dXNcIl1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGFzeW5jIChjdHgpID0+IHtcbiAgICBjb25zdCBzZXNzaW9uID0gY3R4LmNvbnRleHQuc2Vzc2lvbjtcbiAgICBpZiAoIXNlc3Npb24udXNlcikge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiVU5BVVRIT1JJWkVEXCIpO1xuICAgIH1cbiAgICBjb25zdCBzZXNzaW9ucyA9IGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5saXN0U2Vzc2lvbnMoXG4gICAgICBzZXNzaW9uLnVzZXIuaWRcbiAgICApO1xuICAgIGNvbnN0IGFjdGl2ZVNlc3Npb25zID0gc2Vzc2lvbnMuZmlsdGVyKChzZXNzaW9uMikgPT4ge1xuICAgICAgcmV0dXJuIHNlc3Npb24yLmV4cGlyZXNBdCA+IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpO1xuICAgIH0pO1xuICAgIGNvbnN0IG90aGVyU2Vzc2lvbnMgPSBhY3RpdmVTZXNzaW9ucy5maWx0ZXIoXG4gICAgICAoc2Vzc2lvbjIpID0+IHNlc3Npb24yLnRva2VuICE9PSBjdHguY29udGV4dC5zZXNzaW9uLnNlc3Npb24udG9rZW5cbiAgICApO1xuICAgIGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgb3RoZXJTZXNzaW9ucy5tYXAoXG4gICAgICAgIChzZXNzaW9uMikgPT4gY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmRlbGV0ZVNlc3Npb24oc2Vzc2lvbjIudG9rZW4pXG4gICAgICApXG4gICAgKTtcbiAgICByZXR1cm4gY3R4Lmpzb24oe1xuICAgICAgc3RhdHVzOiB0cnVlXG4gICAgfSk7XG4gIH1cbik7XG5cbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUVtYWlsVmVyaWZpY2F0aW9uVG9rZW4oc2VjcmV0LCBlbWFpbCwgdXBkYXRlVG8sIGV4cGlyZXNJbiA9IDM2MDApIHtcbiAgY29uc3QgdG9rZW4gPSBhd2FpdCBzaWduSldUKFxuICAgIHtcbiAgICAgIGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgdXBkYXRlVG9cbiAgICB9LFxuICAgIHNlY3JldCxcbiAgICBleHBpcmVzSW5cbiAgKTtcbiAgcmV0dXJuIHRva2VuO1xufVxuYXN5bmMgZnVuY3Rpb24gc2VuZFZlcmlmaWNhdGlvbkVtYWlsRm4oY3R4LCB1c2VyKSB7XG4gIGlmICghY3R4LmNvbnRleHQub3B0aW9ucy5lbWFpbFZlcmlmaWNhdGlvbj8uc2VuZFZlcmlmaWNhdGlvbkVtYWlsKSB7XG4gICAgY3R4LmNvbnRleHQubG9nZ2VyLmVycm9yKFwiVmVyaWZpY2F0aW9uIGVtYWlsIGlzbid0IGVuYWJsZWQuXCIpO1xuICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgIG1lc3NhZ2U6IFwiVmVyaWZpY2F0aW9uIGVtYWlsIGlzbid0IGVuYWJsZWRcIlxuICAgIH0pO1xuICB9XG4gIGNvbnN0IHRva2VuID0gYXdhaXQgY3JlYXRlRW1haWxWZXJpZmljYXRpb25Ub2tlbihcbiAgICBjdHguY29udGV4dC5zZWNyZXQsXG4gICAgdXNlci5lbWFpbCxcbiAgICB2b2lkIDAsXG4gICAgY3R4LmNvbnRleHQub3B0aW9ucy5lbWFpbFZlcmlmaWNhdGlvbj8uZXhwaXJlc0luXG4gICk7XG4gIGNvbnN0IHVybCA9IGAke2N0eC5jb250ZXh0LmJhc2VVUkx9L3ZlcmlmeS1lbWFpbD90b2tlbj0ke3Rva2VufSZjYWxsYmFja1VSTD0ke2N0eC5ib2R5LmNhbGxiYWNrVVJMIHx8IFwiL1wifWA7XG4gIGF3YWl0IGN0eC5jb250ZXh0Lm9wdGlvbnMuZW1haWxWZXJpZmljYXRpb24uc2VuZFZlcmlmaWNhdGlvbkVtYWlsKFxuICAgIHtcbiAgICAgIHVzZXIsXG4gICAgICB1cmwsXG4gICAgICB0b2tlblxuICAgIH0sXG4gICAgY3R4LnJlcXVlc3RcbiAgKTtcbn1cbmNvbnN0IHNlbmRWZXJpZmljYXRpb25FbWFpbCA9IGNyZWF0ZUF1dGhFbmRwb2ludChcbiAgXCIvc2VuZC12ZXJpZmljYXRpb24tZW1haWxcIixcbiAge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgYm9keTogei5vYmplY3Qoe1xuICAgICAgZW1haWw6IHouZW1haWwoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIGVtYWlsIHRvIHNlbmQgdGhlIHZlcmlmaWNhdGlvbiBlbWFpbCB0b1wiXG4gICAgICB9KSxcbiAgICAgIGNhbGxiYWNrVVJMOiB6LnN0cmluZygpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgVVJMIHRvIHVzZSBmb3IgZW1haWwgdmVyaWZpY2F0aW9uIGNhbGxiYWNrXCJcbiAgICAgIH0pLm9wdGlvbmFsKClcbiAgICB9KSxcbiAgICBtZXRhZGF0YToge1xuICAgICAgb3BlbmFwaToge1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJTZW5kIGEgdmVyaWZpY2F0aW9uIGVtYWlsIHRvIHRoZSB1c2VyXCIsXG4gICAgICAgIHJlcXVlc3RCb2R5OiB7XG4gICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgXCJhcHBsaWNhdGlvbi9qc29uXCI6IHtcbiAgICAgICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICBlbWFpbDoge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgZW1haWwgdG8gc2VuZCB0aGUgdmVyaWZpY2F0aW9uIGVtYWlsIHRvXCIsXG4gICAgICAgICAgICAgICAgICAgIGV4YW1wbGU6IFwidXNlckBleGFtcGxlLmNvbVwiXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgY2FsbGJhY2tVUkw6IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIFVSTCB0byB1c2UgZm9yIGVtYWlsIHZlcmlmaWNhdGlvbiBjYWxsYmFja1wiLFxuICAgICAgICAgICAgICAgICAgICBleGFtcGxlOiBcImh0dHBzOi8vZXhhbXBsZS5jb20vY2FsbGJhY2tcIixcbiAgICAgICAgICAgICAgICAgICAgbnVsbGFibGU6IHRydWVcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBbXCJlbWFpbFwiXVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICByZXNwb25zZXM6IHtcbiAgICAgICAgICBcIjIwMFwiOiB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJTdWNjZXNzXCIsXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiOiB7XG4gICAgICAgICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImJvb2xlYW5cIixcbiAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJJbmRpY2F0ZXMgaWYgdGhlIGVtYWlsIHdhcyBzZW50IHN1Y2Nlc3NmdWxseVwiLFxuICAgICAgICAgICAgICAgICAgICAgIGV4YW1wbGU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCI0MDBcIjoge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiQmFkIFJlcXVlc3RcIixcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbi9qc29uXCI6IHtcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkVycm9yIG1lc3NhZ2VcIixcbiAgICAgICAgICAgICAgICAgICAgICBleGFtcGxlOiBcIlZlcmlmaWNhdGlvbiBlbWFpbCBpc24ndCBlbmFibGVkXCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgYXN5bmMgKGN0eCkgPT4ge1xuICAgIGlmICghY3R4LmNvbnRleHQub3B0aW9ucy5lbWFpbFZlcmlmaWNhdGlvbj8uc2VuZFZlcmlmaWNhdGlvbkVtYWlsKSB7XG4gICAgICBjdHguY29udGV4dC5sb2dnZXIuZXJyb3IoXCJWZXJpZmljYXRpb24gZW1haWwgaXNuJ3QgZW5hYmxlZC5cIik7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IFwiVmVyaWZpY2F0aW9uIGVtYWlsIGlzbid0IGVuYWJsZWRcIlxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IHsgZW1haWwgfSA9IGN0eC5ib2R5O1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBnZXRTZXNzaW9uRnJvbUN0eChjdHgpO1xuICAgIGlmICghc2Vzc2lvbikge1xuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5maW5kVXNlckJ5RW1haWwoZW1haWwpO1xuICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgIHJldHVybiBjdHguanNvbih7XG4gICAgICAgICAgc3RhdHVzOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgYXdhaXQgc2VuZFZlcmlmaWNhdGlvbkVtYWlsRm4oY3R4LCB1c2VyLnVzZXIpO1xuICAgICAgcmV0dXJuIGN0eC5qc29uKHtcbiAgICAgICAgc3RhdHVzOiB0cnVlXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKHNlc3Npb24/LnVzZXIuZW1haWxWZXJpZmllZCkge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBcIllvdSBjYW4gb25seSBzZW5kIGEgdmVyaWZpY2F0aW9uIGVtYWlsIHRvIGFuIHVudmVyaWZpZWQgZW1haWxcIlxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChzZXNzaW9uPy51c2VyLmVtYWlsICE9PSBlbWFpbCkge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBcIllvdSBjYW4gb25seSBzZW5kIGEgdmVyaWZpY2F0aW9uIGVtYWlsIHRvIHlvdXIgb3duIGVtYWlsXCJcbiAgICAgIH0pO1xuICAgIH1cbiAgICBhd2FpdCBzZW5kVmVyaWZpY2F0aW9uRW1haWxGbihjdHgsIHNlc3Npb24udXNlcik7XG4gICAgcmV0dXJuIGN0eC5qc29uKHtcbiAgICAgIHN0YXR1czogdHJ1ZVxuICAgIH0pO1xuICB9XG4pO1xuY29uc3QgdmVyaWZ5RW1haWwgPSBjcmVhdGVBdXRoRW5kcG9pbnQoXG4gIFwiL3ZlcmlmeS1lbWFpbFwiLFxuICB7XG4gICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgIHF1ZXJ5OiB6Lm9iamVjdCh7XG4gICAgICB0b2tlbjogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIHRva2VuIHRvIHZlcmlmeSB0aGUgZW1haWxcIlxuICAgICAgfSksXG4gICAgICBjYWxsYmFja1VSTDogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIFVSTCB0byByZWRpcmVjdCB0byBhZnRlciBlbWFpbCB2ZXJpZmljYXRpb25cIlxuICAgICAgfSkub3B0aW9uYWwoKVxuICAgIH0pLFxuICAgIHVzZTogW29yaWdpbkNoZWNrKChjdHgpID0+IGN0eC5xdWVyeS5jYWxsYmFja1VSTCldLFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICBvcGVuYXBpOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlZlcmlmeSB0aGUgZW1haWwgb2YgdGhlIHVzZXJcIixcbiAgICAgICAgcGFyYW1ldGVyczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIG5hbWU6IFwidG9rZW5cIixcbiAgICAgICAgICAgIGluOiBcInF1ZXJ5XCIsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgdG9rZW4gdG8gdmVyaWZ5IHRoZSBlbWFpbFwiLFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIlxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogXCJjYWxsYmFja1VSTFwiLFxuICAgICAgICAgICAgaW46IFwicXVlcnlcIixcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBVUkwgdG8gcmVkaXJlY3QgdG8gYWZ0ZXIgZW1haWwgdmVyaWZpY2F0aW9uXCIsXG4gICAgICAgICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIlxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgXCIyMDBcIjoge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiU3VjY2Vzc1wiLFxuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIjoge1xuICAgICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiVXNlciBJRFwiXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZW1haWw6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiVXNlciBlbWFpbFwiXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJVc2VyIG5hbWVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlVzZXIgaW1hZ2UgVVJMXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBlbWFpbFZlcmlmaWVkOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYm9vbGVhblwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJJbmRpY2F0ZXMgaWYgdGhlIHVzZXIgZW1haWwgaXMgdmVyaWZpZWRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJVc2VyIGNyZWF0aW9uIGRhdGVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRBdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJVc2VyIHVwZGF0ZSBkYXRlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICBcImlkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImVtYWlsXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiaW1hZ2VcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZW1haWxWZXJpZmllZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjcmVhdGVkQXRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidXBkYXRlZEF0XCJcbiAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYm9vbGVhblwiLFxuICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkluZGljYXRlcyBpZiB0aGUgZW1haWwgd2FzIHZlcmlmaWVkIHN1Y2Nlc3NmdWxseVwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICByZXF1aXJlZDogW1widXNlclwiLCBcInN0YXR1c1wiXVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgYXN5bmMgKGN0eCkgPT4ge1xuICAgIGZ1bmN0aW9uIHJlZGlyZWN0T25FcnJvcihlcnJvcikge1xuICAgICAgaWYgKGN0eC5xdWVyeS5jYWxsYmFja1VSTCkge1xuICAgICAgICBpZiAoY3R4LnF1ZXJ5LmNhbGxiYWNrVVJMLmluY2x1ZGVzKFwiP1wiKSkge1xuICAgICAgICAgIHRocm93IGN0eC5yZWRpcmVjdChgJHtjdHgucXVlcnkuY2FsbGJhY2tVUkx9JmVycm9yPSR7ZXJyb3J9YCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgY3R4LnJlZGlyZWN0KGAke2N0eC5xdWVyeS5jYWxsYmFja1VSTH0/ZXJyb3I9JHtlcnJvcn1gKTtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIlVOQVVUSE9SSVpFRFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IGVycm9yXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgeyB0b2tlbiB9ID0gY3R4LnF1ZXJ5O1xuICAgIGxldCBqd3Q7XG4gICAgdHJ5IHtcbiAgICAgIGp3dCA9IGF3YWl0IGp3dFZlcmlmeShcbiAgICAgICAgdG9rZW4sXG4gICAgICAgIG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShjdHguY29udGV4dC5zZWNyZXQpLFxuICAgICAgICB7XG4gICAgICAgICAgYWxnb3JpdGhtczogW1wiSFMyNTZcIl1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBpZiAoZSBpbnN0YW5jZW9mIEpXVEV4cGlyZWQpIHtcbiAgICAgICAgcmV0dXJuIHJlZGlyZWN0T25FcnJvcihcInRva2VuX2V4cGlyZWRcIik7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVkaXJlY3RPbkVycm9yKFwiaW52YWxpZF90b2tlblwiKTtcbiAgICB9XG4gICAgY29uc3Qgc2NoZW1hID0gei5vYmplY3Qoe1xuICAgICAgZW1haWw6IHouc3RyaW5nKCkuZW1haWwoKSxcbiAgICAgIHVwZGF0ZVRvOiB6LnN0cmluZygpLm9wdGlvbmFsKClcbiAgICB9KTtcbiAgICBjb25zdCBwYXJzZWQgPSBzY2hlbWEucGFyc2Uoand0LnBheWxvYWQpO1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZmluZFVzZXJCeUVtYWlsKFxuICAgICAgcGFyc2VkLmVtYWlsXG4gICAgKTtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHJldHVybiByZWRpcmVjdE9uRXJyb3IoXCJ1c2VyX25vdF9mb3VuZFwiKTtcbiAgICB9XG4gICAgaWYgKHBhcnNlZC51cGRhdGVUbykge1xuICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGdldFNlc3Npb25Gcm9tQ3R4KGN0eCk7XG4gICAgICBpZiAoIXNlc3Npb24pIHtcbiAgICAgICAgaWYgKGN0eC5xdWVyeS5jYWxsYmFja1VSTCkge1xuICAgICAgICAgIHRocm93IGN0eC5yZWRpcmVjdChgJHtjdHgucXVlcnkuY2FsbGJhY2tVUkx9P2Vycm9yPXVuYXV0aG9yaXplZGApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZWRpcmVjdE9uRXJyb3IoXCJ1bmF1dGhvcml6ZWRcIik7XG4gICAgICB9XG4gICAgICBpZiAoc2Vzc2lvbi51c2VyLmVtYWlsICE9PSBwYXJzZWQuZW1haWwpIHtcbiAgICAgICAgaWYgKGN0eC5xdWVyeS5jYWxsYmFja1VSTCkge1xuICAgICAgICAgIHRocm93IGN0eC5yZWRpcmVjdChgJHtjdHgucXVlcnkuY2FsbGJhY2tVUkx9P2Vycm9yPXVuYXV0aG9yaXplZGApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZWRpcmVjdE9uRXJyb3IoXCJ1bmF1dGhvcml6ZWRcIik7XG4gICAgICB9XG4gICAgICBjb25zdCB1cGRhdGVkVXNlcjIgPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIudXBkYXRlVXNlckJ5RW1haWwoXG4gICAgICAgIHBhcnNlZC5lbWFpbCxcbiAgICAgICAge1xuICAgICAgICAgIGVtYWlsOiBwYXJzZWQudXBkYXRlVG8sXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogZmFsc2VcbiAgICAgICAgfSxcbiAgICAgICAgY3R4XG4gICAgICApO1xuICAgICAgY29uc3QgbmV3VG9rZW4gPSBhd2FpdCBjcmVhdGVFbWFpbFZlcmlmaWNhdGlvblRva2VuKFxuICAgICAgICBjdHguY29udGV4dC5zZWNyZXQsXG4gICAgICAgIHBhcnNlZC51cGRhdGVUb1xuICAgICAgKTtcbiAgICAgIGF3YWl0IGN0eC5jb250ZXh0Lm9wdGlvbnMuZW1haWxWZXJpZmljYXRpb24/LnNlbmRWZXJpZmljYXRpb25FbWFpbD8uKFxuICAgICAgICB7XG4gICAgICAgICAgdXNlcjogdXBkYXRlZFVzZXIyLFxuICAgICAgICAgIHVybDogYCR7Y3R4LmNvbnRleHQuYmFzZVVSTH0vdmVyaWZ5LWVtYWlsP3Rva2VuPSR7bmV3VG9rZW59JmNhbGxiYWNrVVJMPSR7Y3R4LnF1ZXJ5LmNhbGxiYWNrVVJMIHx8IFwiL1wifWAsXG4gICAgICAgICAgdG9rZW46IG5ld1Rva2VuXG4gICAgICAgIH0sXG4gICAgICAgIGN0eC5yZXF1ZXN0XG4gICAgICApO1xuICAgICAgYXdhaXQgc2V0U2Vzc2lvbkNvb2tpZShjdHgsIHtcbiAgICAgICAgc2Vzc2lvbjogc2Vzc2lvbi5zZXNzaW9uLFxuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgLi4uc2Vzc2lvbi51c2VyLFxuICAgICAgICAgIGVtYWlsOiBwYXJzZWQudXBkYXRlVG8sXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogZmFsc2VcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBpZiAoY3R4LnF1ZXJ5LmNhbGxiYWNrVVJMKSB7XG4gICAgICAgIHRocm93IGN0eC5yZWRpcmVjdChjdHgucXVlcnkuY2FsbGJhY2tVUkwpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGN0eC5qc29uKHtcbiAgICAgICAgc3RhdHVzOiB0cnVlLFxuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IHVwZGF0ZWRVc2VyMi5pZCxcbiAgICAgICAgICBlbWFpbDogdXBkYXRlZFVzZXIyLmVtYWlsLFxuICAgICAgICAgIG5hbWU6IHVwZGF0ZWRVc2VyMi5uYW1lLFxuICAgICAgICAgIGltYWdlOiB1cGRhdGVkVXNlcjIuaW1hZ2UsXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogdXBkYXRlZFVzZXIyLmVtYWlsVmVyaWZpZWQsXG4gICAgICAgICAgY3JlYXRlZEF0OiB1cGRhdGVkVXNlcjIuY3JlYXRlZEF0LFxuICAgICAgICAgIHVwZGF0ZWRBdDogdXBkYXRlZFVzZXIyLnVwZGF0ZWRBdFxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGN0eC5jb250ZXh0Lm9wdGlvbnMuZW1haWxWZXJpZmljYXRpb24/Lm9uRW1haWxWZXJpZmljYXRpb24pIHtcbiAgICAgIGF3YWl0IGN0eC5jb250ZXh0Lm9wdGlvbnMuZW1haWxWZXJpZmljYXRpb24ub25FbWFpbFZlcmlmaWNhdGlvbihcbiAgICAgICAgdXNlci51c2VyLFxuICAgICAgICBjdHgucmVxdWVzdFxuICAgICAgKTtcbiAgICB9XG4gICAgY29uc3QgdXBkYXRlZFVzZXIgPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIudXBkYXRlVXNlckJ5RW1haWwoXG4gICAgICBwYXJzZWQuZW1haWwsXG4gICAgICB7XG4gICAgICAgIGVtYWlsVmVyaWZpZWQ6IHRydWVcbiAgICAgIH0sXG4gICAgICBjdHhcbiAgICApO1xuICAgIGlmIChjdHguY29udGV4dC5vcHRpb25zLmVtYWlsVmVyaWZpY2F0aW9uPy5hZnRlckVtYWlsVmVyaWZpY2F0aW9uKSB7XG4gICAgICBhd2FpdCBjdHguY29udGV4dC5vcHRpb25zLmVtYWlsVmVyaWZpY2F0aW9uLmFmdGVyRW1haWxWZXJpZmljYXRpb24oXG4gICAgICAgIHVwZGF0ZWRVc2VyLFxuICAgICAgICBjdHgucmVxdWVzdFxuICAgICAgKTtcbiAgICB9XG4gICAgaWYgKGN0eC5jb250ZXh0Lm9wdGlvbnMuZW1haWxWZXJpZmljYXRpb24/LmF1dG9TaWduSW5BZnRlclZlcmlmaWNhdGlvbikge1xuICAgICAgY29uc3QgY3VycmVudFNlc3Npb24gPSBhd2FpdCBnZXRTZXNzaW9uRnJvbUN0eChjdHgpO1xuICAgICAgaWYgKCFjdXJyZW50U2Vzc2lvbiB8fCBjdXJyZW50U2Vzc2lvbi51c2VyLmVtYWlsICE9PSBwYXJzZWQuZW1haWwpIHtcbiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5jcmVhdGVTZXNzaW9uKFxuICAgICAgICAgIHVzZXIudXNlci5pZCxcbiAgICAgICAgICBjdHhcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKCFzZXNzaW9uKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiSU5URVJOQUxfU0VSVkVSX0VSUk9SXCIsIHtcbiAgICAgICAgICAgIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBzZXNzaW9uXCJcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBhd2FpdCBzZXRTZXNzaW9uQ29va2llKGN0eCwge1xuICAgICAgICAgIHNlc3Npb24sXG4gICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgLi4udXNlci51c2VyLFxuICAgICAgICAgICAgZW1haWxWZXJpZmllZDogdHJ1ZVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhd2FpdCBzZXRTZXNzaW9uQ29va2llKGN0eCwge1xuICAgICAgICAgIHNlc3Npb246IGN1cnJlbnRTZXNzaW9uLnNlc3Npb24sXG4gICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgLi4uY3VycmVudFNlc3Npb24udXNlcixcbiAgICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IHRydWVcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoY3R4LnF1ZXJ5LmNhbGxiYWNrVVJMKSB7XG4gICAgICB0aHJvdyBjdHgucmVkaXJlY3QoY3R4LnF1ZXJ5LmNhbGxiYWNrVVJMKTtcbiAgICB9XG4gICAgcmV0dXJuIGN0eC5qc29uKHtcbiAgICAgIHN0YXR1czogdHJ1ZSxcbiAgICAgIHVzZXI6IG51bGxcbiAgICB9KTtcbiAgfVxuKTtcblxuY29uc3QgSElERV9NRVRBREFUQSA9IHtcbiAgaXNBY3Rpb246IGZhbHNlXG59O1xuXG5hc3luYyBmdW5jdGlvbiBnZW5lcmF0ZVN0YXRlKGMsIGxpbmspIHtcbiAgY29uc3QgY2FsbGJhY2tVUkwgPSBjLmJvZHk/LmNhbGxiYWNrVVJMIHx8IGMuY29udGV4dC5vcHRpb25zLmJhc2VVUkw7XG4gIGlmICghY2FsbGJhY2tVUkwpIHtcbiAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICBtZXNzYWdlOiBcImNhbGxiYWNrVVJMIGlzIHJlcXVpcmVkXCJcbiAgICB9KTtcbiAgfVxuICBjb25zdCBjb2RlVmVyaWZpZXIgPSBnZW5lcmF0ZVJhbmRvbVN0cmluZygxMjgpO1xuICBjb25zdCBzdGF0ZSA9IGdlbmVyYXRlUmFuZG9tU3RyaW5nKDMyKTtcbiAgY29uc3QgZGF0YSA9IEpTT04uc3RyaW5naWZ5KHtcbiAgICBjYWxsYmFja1VSTCxcbiAgICBjb2RlVmVyaWZpZXIsXG4gICAgZXJyb3JVUkw6IGMuYm9keT8uZXJyb3JDYWxsYmFja1VSTCxcbiAgICBuZXdVc2VyVVJMOiBjLmJvZHk/Lm5ld1VzZXJDYWxsYmFja1VSTCxcbiAgICBsaW5rLFxuICAgIC8qKlxuICAgICAqIFRoaXMgaXMgdGhlIGFjdHVhbCBleHBpcnkgdGltZSBvZiB0aGUgc3RhdGVcbiAgICAgKi9cbiAgICBleHBpcmVzQXQ6IERhdGUubm93KCkgKyAxMCAqIDYwICogMWUzLFxuICAgIHJlcXVlc3RTaWduVXA6IGMuYm9keT8ucmVxdWVzdFNpZ25VcFxuICB9KTtcbiAgY29uc3QgZXhwaXJlc0F0ID0gLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCk7XG4gIGV4cGlyZXNBdC5zZXRNaW51dGVzKGV4cGlyZXNBdC5nZXRNaW51dGVzKCkgKyAxMCk7XG4gIGNvbnN0IHZlcmlmaWNhdGlvbiA9IGF3YWl0IGMuY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuY3JlYXRlVmVyaWZpY2F0aW9uVmFsdWUoXG4gICAge1xuICAgICAgdmFsdWU6IGRhdGEsXG4gICAgICBpZGVudGlmaWVyOiBzdGF0ZSxcbiAgICAgIGV4cGlyZXNBdFxuICAgIH0sXG4gICAgY1xuICApO1xuICBpZiAoIXZlcmlmaWNhdGlvbikge1xuICAgIGMuY29udGV4dC5sb2dnZXIuZXJyb3IoXG4gICAgICBcIlVuYWJsZSB0byBjcmVhdGUgdmVyaWZpY2F0aW9uLiBNYWtlIHN1cmUgdGhlIGRhdGFiYXNlIGFkYXB0ZXIgaXMgcHJvcGVybHkgd29ya2luZyBhbmQgdGhlcmUgaXMgYSB2ZXJpZmljYXRpb24gdGFibGUgaW4gdGhlIGRhdGFiYXNlXCJcbiAgICApO1xuICAgIHRocm93IG5ldyBBUElFcnJvcihcIklOVEVSTkFMX1NFUlZFUl9FUlJPUlwiLCB7XG4gICAgICBtZXNzYWdlOiBcIlVuYWJsZSB0byBjcmVhdGUgdmVyaWZpY2F0aW9uXCJcbiAgICB9KTtcbiAgfVxuICByZXR1cm4ge1xuICAgIHN0YXRlOiB2ZXJpZmljYXRpb24uaWRlbnRpZmllcixcbiAgICBjb2RlVmVyaWZpZXJcbiAgfTtcbn1cbmFzeW5jIGZ1bmN0aW9uIHBhcnNlU3RhdGUoYykge1xuICBjb25zdCBzdGF0ZSA9IGMucXVlcnkuc3RhdGUgfHwgYy5ib2R5LnN0YXRlO1xuICBjb25zdCBkYXRhID0gYXdhaXQgYy5jb250ZXh0LmludGVybmFsQWRhcHRlci5maW5kVmVyaWZpY2F0aW9uVmFsdWUoc3RhdGUpO1xuICBpZiAoIWRhdGEpIHtcbiAgICBjLmNvbnRleHQubG9nZ2VyLmVycm9yKFwiU3RhdGUgTWlzbWF0Y2guIFZlcmlmaWNhdGlvbiBub3QgZm91bmRcIiwge1xuICAgICAgc3RhdGVcbiAgICB9KTtcbiAgICBjb25zdCBlcnJvclVSTCA9IGMuY29udGV4dC5vcHRpb25zLm9uQVBJRXJyb3I/LmVycm9yVVJMIHx8IGAke2MuY29udGV4dC5iYXNlVVJMfS9lcnJvcmA7XG4gICAgdGhyb3cgYy5yZWRpcmVjdChgJHtlcnJvclVSTH0/ZXJyb3I9cGxlYXNlX3Jlc3RhcnRfdGhlX3Byb2Nlc3NgKTtcbiAgfVxuICBjb25zdCBwYXJzZWREYXRhID0gei5vYmplY3Qoe1xuICAgIGNhbGxiYWNrVVJMOiB6LnN0cmluZygpLFxuICAgIGNvZGVWZXJpZmllcjogei5zdHJpbmcoKSxcbiAgICBlcnJvclVSTDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIG5ld1VzZXJVUkw6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBleHBpcmVzQXQ6IHoubnVtYmVyKCksXG4gICAgbGluazogei5vYmplY3Qoe1xuICAgICAgZW1haWw6IHouc3RyaW5nKCksXG4gICAgICB1c2VySWQ6IHouY29lcmNlLnN0cmluZygpXG4gICAgfSkub3B0aW9uYWwoKSxcbiAgICByZXF1ZXN0U2lnblVwOiB6LmJvb2xlYW4oKS5vcHRpb25hbCgpXG4gIH0pLnBhcnNlKEpTT04ucGFyc2UoZGF0YS52YWx1ZSkpO1xuICBpZiAoIXBhcnNlZERhdGEuZXJyb3JVUkwpIHtcbiAgICBwYXJzZWREYXRhLmVycm9yVVJMID0gYCR7Yy5jb250ZXh0LmJhc2VVUkx9L2Vycm9yYDtcbiAgfVxuICBpZiAocGFyc2VkRGF0YS5leHBpcmVzQXQgPCBEYXRlLm5vdygpKSB7XG4gICAgYXdhaXQgYy5jb250ZXh0LmludGVybmFsQWRhcHRlci5kZWxldGVWZXJpZmljYXRpb25WYWx1ZShkYXRhLmlkKTtcbiAgICBjb25zdCBlcnJvclVSTCA9IGMuY29udGV4dC5vcHRpb25zLm9uQVBJRXJyb3I/LmVycm9yVVJMIHx8IGAke2MuY29udGV4dC5iYXNlVVJMfS9lcnJvcmA7XG4gICAgdGhyb3cgYy5yZWRpcmVjdChgJHtlcnJvclVSTH0/ZXJyb3I9cGxlYXNlX3Jlc3RhcnRfdGhlX3Byb2Nlc3NgKTtcbiAgfVxuICBhd2FpdCBjLmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmRlbGV0ZVZlcmlmaWNhdGlvblZhbHVlKGRhdGEuaWQpO1xuICByZXR1cm4gcGFyc2VkRGF0YTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVDb2RlQ2hhbGxlbmdlKGNvZGVWZXJpZmllcikge1xuICBjb25zdCBjb2RlQ2hhbGxlbmdlQnl0ZXMgPSBhd2FpdCBjcmVhdGVIYXNoKFwiU0hBLTI1NlwiKS5kaWdlc3QoY29kZVZlcmlmaWVyKTtcbiAgcmV0dXJuIGJhc2U2NFVybC5lbmNvZGUobmV3IFVpbnQ4QXJyYXkoY29kZUNoYWxsZW5nZUJ5dGVzKSwge1xuICAgIHBhZGRpbmc6IGZhbHNlXG4gIH0pO1xufVxuZnVuY3Rpb24gZ2V0T0F1dGgyVG9rZW5zKGRhdGEpIHtcbiAgcmV0dXJuIHtcbiAgICB0b2tlblR5cGU6IGRhdGEudG9rZW5fdHlwZSxcbiAgICBhY2Nlc3NUb2tlbjogZGF0YS5hY2Nlc3NfdG9rZW4sXG4gICAgcmVmcmVzaFRva2VuOiBkYXRhLnJlZnJlc2hfdG9rZW4sXG4gICAgYWNjZXNzVG9rZW5FeHBpcmVzQXQ6IGRhdGEuZXhwaXJlc19pbiA/IGdldERhdGUoZGF0YS5leHBpcmVzX2luLCBcInNlY1wiKSA6IHZvaWQgMCxcbiAgICByZWZyZXNoVG9rZW5FeHBpcmVzQXQ6IGRhdGEucmVmcmVzaF90b2tlbl9leHBpcmVzX2luID8gZ2V0RGF0ZShkYXRhLnJlZnJlc2hfdG9rZW5fZXhwaXJlc19pbiwgXCJzZWNcIikgOiB2b2lkIDAsXG4gICAgc2NvcGVzOiBkYXRhPy5zY29wZSA/IHR5cGVvZiBkYXRhLnNjb3BlID09PSBcInN0cmluZ1wiID8gZGF0YS5zY29wZS5zcGxpdChcIiBcIikgOiBkYXRhLnNjb3BlIDogW10sXG4gICAgaWRUb2tlbjogZGF0YS5pZF90b2tlblxuICB9O1xufVxuY29uc3QgZW5jb2RlT0F1dGhQYXJhbWV0ZXIgPSAodmFsdWUpID0+IGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSkucmVwbGFjZSgvJTIwL2csIFwiK1wiKTtcbmZ1bmN0aW9uIGRlY3J5cHRPQXV0aFRva2VuKHRva2VuLCBjdHgpIHtcbiAgaWYgKCF0b2tlbikgcmV0dXJuIHRva2VuO1xuICBpZiAoY3R4Lm9wdGlvbnMuYWNjb3VudD8uZW5jcnlwdE9BdXRoVG9rZW5zKSB7XG4gICAgcmV0dXJuIHN5bW1ldHJpY0RlY3J5cHQoe1xuICAgICAga2V5OiBjdHguc2VjcmV0LFxuICAgICAgZGF0YTogdG9rZW5cbiAgICB9KTtcbiAgfVxuICByZXR1cm4gdG9rZW47XG59XG5mdW5jdGlvbiBzZXRUb2tlblV0aWwodG9rZW4sIGN0eCkge1xuICBpZiAoY3R4Lm9wdGlvbnMuYWNjb3VudD8uZW5jcnlwdE9BdXRoVG9rZW5zICYmIHRva2VuKSB7XG4gICAgcmV0dXJuIHN5bW1ldHJpY0VuY3J5cHQoe1xuICAgICAga2V5OiBjdHguc2VjcmV0LFxuICAgICAgZGF0YTogdG9rZW5cbiAgICB9KTtcbiAgfVxuICByZXR1cm4gdG9rZW47XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZU9BdXRoVXNlckluZm8oYywge1xuICB1c2VySW5mbyxcbiAgYWNjb3VudCxcbiAgY2FsbGJhY2tVUkwsXG4gIGRpc2FibGVTaWduVXAsXG4gIG92ZXJyaWRlVXNlckluZm9cbn0pIHtcbiAgY29uc3QgZGJVc2VyID0gYXdhaXQgYy5jb250ZXh0LmludGVybmFsQWRhcHRlci5maW5kT0F1dGhVc2VyKFxuICAgIHVzZXJJbmZvLmVtYWlsLnRvTG93ZXJDYXNlKCksXG4gICAgYWNjb3VudC5hY2NvdW50SWQsXG4gICAgYWNjb3VudC5wcm92aWRlcklkXG4gICkuY2F0Y2goKGUpID0+IHtcbiAgICBsb2dnZXIuZXJyb3IoXG4gICAgICBcIkJldHRlciBhdXRoIHdhcyB1bmFibGUgdG8gcXVlcnkgeW91ciBkYXRhYmFzZS5cXG5FcnJvcjogXCIsXG4gICAgICBlXG4gICAgKTtcbiAgICBjb25zdCBlcnJvclVSTCA9IGMuY29udGV4dC5vcHRpb25zLm9uQVBJRXJyb3I/LmVycm9yVVJMIHx8IGAke2MuY29udGV4dC5iYXNlVVJMfS9lcnJvcmA7XG4gICAgdGhyb3cgYy5yZWRpcmVjdChgJHtlcnJvclVSTH0/ZXJyb3I9aW50ZXJuYWxfc2VydmVyX2Vycm9yYCk7XG4gIH0pO1xuICBsZXQgdXNlciA9IGRiVXNlcj8udXNlcjtcbiAgbGV0IGlzUmVnaXN0ZXIgPSAhdXNlcjtcbiAgaWYgKGRiVXNlcikge1xuICAgIGNvbnN0IGhhc0JlZW5MaW5rZWQgPSBkYlVzZXIuYWNjb3VudHMuZmluZChcbiAgICAgIChhKSA9PiBhLnByb3ZpZGVySWQgPT09IGFjY291bnQucHJvdmlkZXJJZCAmJiBhLmFjY291bnRJZCA9PT0gYWNjb3VudC5hY2NvdW50SWRcbiAgICApO1xuICAgIGlmICghaGFzQmVlbkxpbmtlZCkge1xuICAgICAgY29uc3QgdHJ1c3RlZFByb3ZpZGVycyA9IGMuY29udGV4dC5vcHRpb25zLmFjY291bnQ/LmFjY291bnRMaW5raW5nPy50cnVzdGVkUHJvdmlkZXJzO1xuICAgICAgY29uc3QgaXNUcnVzdGVkUHJvdmlkZXIgPSB0cnVzdGVkUHJvdmlkZXJzPy5pbmNsdWRlcyhcbiAgICAgICAgYWNjb3VudC5wcm92aWRlcklkXG4gICAgICApO1xuICAgICAgaWYgKCFpc1RydXN0ZWRQcm92aWRlciAmJiAhdXNlckluZm8uZW1haWxWZXJpZmllZCB8fCBjLmNvbnRleHQub3B0aW9ucy5hY2NvdW50Py5hY2NvdW50TGlua2luZz8uZW5hYmxlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgaWYgKGlzRGV2ZWxvcG1lbnQpIHtcbiAgICAgICAgICBsb2dnZXIud2FybihcbiAgICAgICAgICAgIGBVc2VyIGFscmVhZHkgZXhpc3QgYnV0IGFjY291bnQgaXNuJ3QgbGlua2VkIHRvICR7YWNjb3VudC5wcm92aWRlcklkfS4gVG8gcmVhZCBtb3JlIGFib3V0IGhvdyBhY2NvdW50IGxpbmtpbmcgd29ya3MgaW4gQmV0dGVyIEF1dGggc2VlIGh0dHBzOi8vd3d3LmJldHRlci1hdXRoLmNvbS9kb2NzL2NvbmNlcHRzL3VzZXJzLWFjY291bnRzI2FjY291bnQtbGlua2luZy5gXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGVycm9yOiBcImFjY291bnQgbm90IGxpbmtlZFwiLFxuICAgICAgICAgIGRhdGE6IG51bGxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGMuY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIubGlua0FjY291bnQoXG4gICAgICAgICAge1xuICAgICAgICAgICAgcHJvdmlkZXJJZDogYWNjb3VudC5wcm92aWRlcklkLFxuICAgICAgICAgICAgYWNjb3VudElkOiB1c2VySW5mby5pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgdXNlcklkOiBkYlVzZXIudXNlci5pZCxcbiAgICAgICAgICAgIGFjY2Vzc1Rva2VuOiBhd2FpdCBzZXRUb2tlblV0aWwoYWNjb3VudC5hY2Nlc3NUb2tlbiwgYy5jb250ZXh0KSxcbiAgICAgICAgICAgIHJlZnJlc2hUb2tlbjogYXdhaXQgc2V0VG9rZW5VdGlsKGFjY291bnQucmVmcmVzaFRva2VuLCBjLmNvbnRleHQpLFxuICAgICAgICAgICAgaWRUb2tlbjogYWNjb3VudC5pZFRva2VuLFxuICAgICAgICAgICAgYWNjZXNzVG9rZW5FeHBpcmVzQXQ6IGFjY291bnQuYWNjZXNzVG9rZW5FeHBpcmVzQXQsXG4gICAgICAgICAgICByZWZyZXNoVG9rZW5FeHBpcmVzQXQ6IGFjY291bnQucmVmcmVzaFRva2VuRXhwaXJlc0F0LFxuICAgICAgICAgICAgc2NvcGU6IGFjY291bnQuc2NvcGVcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNcbiAgICAgICAgKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKFwiVW5hYmxlIHRvIGxpbmsgYWNjb3VudFwiLCBlKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBlcnJvcjogXCJ1bmFibGUgdG8gbGluayBhY2NvdW50XCIsXG4gICAgICAgICAgZGF0YTogbnVsbFxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoYy5jb250ZXh0Lm9wdGlvbnMuYWNjb3VudD8udXBkYXRlQWNjb3VudE9uU2lnbkluICE9PSBmYWxzZSkge1xuICAgICAgICBjb25zdCB1cGRhdGVEYXRhID0gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICAgIE9iamVjdC5lbnRyaWVzKHtcbiAgICAgICAgICAgIGlkVG9rZW46IGFjY291bnQuaWRUb2tlbixcbiAgICAgICAgICAgIGFjY2Vzc1Rva2VuOiBhd2FpdCBzZXRUb2tlblV0aWwoYWNjb3VudC5hY2Nlc3NUb2tlbiwgYy5jb250ZXh0KSxcbiAgICAgICAgICAgIHJlZnJlc2hUb2tlbjogYXdhaXQgc2V0VG9rZW5VdGlsKGFjY291bnQucmVmcmVzaFRva2VuLCBjLmNvbnRleHQpLFxuICAgICAgICAgICAgYWNjZXNzVG9rZW5FeHBpcmVzQXQ6IGFjY291bnQuYWNjZXNzVG9rZW5FeHBpcmVzQXQsXG4gICAgICAgICAgICByZWZyZXNoVG9rZW5FeHBpcmVzQXQ6IGFjY291bnQucmVmcmVzaFRva2VuRXhwaXJlc0F0LFxuICAgICAgICAgICAgc2NvcGU6IGFjY291bnQuc2NvcGVcbiAgICAgICAgICB9KS5maWx0ZXIoKFtfLCB2YWx1ZV0pID0+IHZhbHVlICE9PSB2b2lkIDApXG4gICAgICAgICk7XG4gICAgICAgIGlmIChPYmplY3Qua2V5cyh1cGRhdGVEYXRhKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgYXdhaXQgYy5jb250ZXh0LmludGVybmFsQWRhcHRlci51cGRhdGVBY2NvdW50KFxuICAgICAgICAgICAgaGFzQmVlbkxpbmtlZC5pZCxcbiAgICAgICAgICAgIHVwZGF0ZURhdGEsXG4gICAgICAgICAgICBjXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBpZiAob3ZlcnJpZGVVc2VySW5mbykge1xuICAgICAgY29uc3QgeyBpZDogXywgLi4ucmVzdFVzZXJJbmZvIH0gPSB1c2VySW5mbztcbiAgICAgIGF3YWl0IGMuY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIudXBkYXRlVXNlcihkYlVzZXIudXNlci5pZCwge1xuICAgICAgICAuLi5yZXN0VXNlckluZm8sXG4gICAgICAgIGVtYWlsOiB1c2VySW5mby5lbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICBlbWFpbFZlcmlmaWVkOiB1c2VySW5mby5lbWFpbC50b0xvd2VyQ2FzZSgpID09PSBkYlVzZXIudXNlci5lbWFpbCA/IGRiVXNlci51c2VyLmVtYWlsVmVyaWZpZWQgfHwgdXNlckluZm8uZW1haWxWZXJpZmllZCA6IHVzZXJJbmZvLmVtYWlsVmVyaWZpZWRcbiAgICAgIH0pO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBpZiAoZGlzYWJsZVNpZ25VcCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZXJyb3I6IFwic2lnbnVwIGRpc2FibGVkXCIsXG4gICAgICAgIGRhdGE6IG51bGwsXG4gICAgICAgIGlzUmVnaXN0ZXI6IGZhbHNlXG4gICAgICB9O1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBpZDogXywgLi4ucmVzdFVzZXJJbmZvIH0gPSB1c2VySW5mbztcbiAgICAgIHVzZXIgPSBhd2FpdCBjLmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmNyZWF0ZU9BdXRoVXNlcihcbiAgICAgICAge1xuICAgICAgICAgIC4uLnJlc3RVc2VySW5mbyxcbiAgICAgICAgICBlbWFpbDogdXNlckluZm8uZW1haWwudG9Mb3dlckNhc2UoKVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgYWNjZXNzVG9rZW46IGF3YWl0IHNldFRva2VuVXRpbChhY2NvdW50LmFjY2Vzc1Rva2VuLCBjLmNvbnRleHQpLFxuICAgICAgICAgIHJlZnJlc2hUb2tlbjogYXdhaXQgc2V0VG9rZW5VdGlsKGFjY291bnQucmVmcmVzaFRva2VuLCBjLmNvbnRleHQpLFxuICAgICAgICAgIGlkVG9rZW46IGFjY291bnQuaWRUb2tlbixcbiAgICAgICAgICBhY2Nlc3NUb2tlbkV4cGlyZXNBdDogYWNjb3VudC5hY2Nlc3NUb2tlbkV4cGlyZXNBdCxcbiAgICAgICAgICByZWZyZXNoVG9rZW5FeHBpcmVzQXQ6IGFjY291bnQucmVmcmVzaFRva2VuRXhwaXJlc0F0LFxuICAgICAgICAgIHNjb3BlOiBhY2NvdW50LnNjb3BlLFxuICAgICAgICAgIHByb3ZpZGVySWQ6IGFjY291bnQucHJvdmlkZXJJZCxcbiAgICAgICAgICBhY2NvdW50SWQ6IHVzZXJJbmZvLmlkLnRvU3RyaW5nKClcbiAgICAgICAgfSxcbiAgICAgICAgY1xuICAgICAgKS50aGVuKChyZXMpID0+IHJlcz8udXNlcik7XG4gICAgICBpZiAoIXVzZXJJbmZvLmVtYWlsVmVyaWZpZWQgJiYgdXNlciAmJiBjLmNvbnRleHQub3B0aW9ucy5lbWFpbFZlcmlmaWNhdGlvbj8uc2VuZE9uU2lnblVwKSB7XG4gICAgICAgIGNvbnN0IHRva2VuID0gYXdhaXQgY3JlYXRlRW1haWxWZXJpZmljYXRpb25Ub2tlbihcbiAgICAgICAgICBjLmNvbnRleHQuc2VjcmV0LFxuICAgICAgICAgIHVzZXIuZW1haWwsXG4gICAgICAgICAgdm9pZCAwLFxuICAgICAgICAgIGMuY29udGV4dC5vcHRpb25zLmVtYWlsVmVyaWZpY2F0aW9uPy5leHBpcmVzSW5cbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgdXJsID0gYCR7Yy5jb250ZXh0LmJhc2VVUkx9L3ZlcmlmeS1lbWFpbD90b2tlbj0ke3Rva2VufSZjYWxsYmFja1VSTD0ke2NhbGxiYWNrVVJMfWA7XG4gICAgICAgIGF3YWl0IGMuY29udGV4dC5vcHRpb25zLmVtYWlsVmVyaWZpY2F0aW9uPy5zZW5kVmVyaWZpY2F0aW9uRW1haWw/LihcbiAgICAgICAgICB7XG4gICAgICAgICAgICB1c2VyLFxuICAgICAgICAgICAgdXJsLFxuICAgICAgICAgICAgdG9rZW5cbiAgICAgICAgICB9LFxuICAgICAgICAgIGMucmVxdWVzdFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihlKTtcbiAgICAgIGlmIChlIGluc3RhbmNlb2YgQVBJRXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBlcnJvcjogZS5tZXNzYWdlLFxuICAgICAgICAgIGRhdGE6IG51bGwsXG4gICAgICAgICAgaXNSZWdpc3RlcjogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGVycm9yOiBcInVuYWJsZSB0byBjcmVhdGUgdXNlclwiLFxuICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICBpc1JlZ2lzdGVyOiBmYWxzZVxuICAgICAgfTtcbiAgICB9XG4gIH1cbiAgaWYgKCF1c2VyKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGVycm9yOiBcInVuYWJsZSB0byBjcmVhdGUgdXNlclwiLFxuICAgICAgZGF0YTogbnVsbCxcbiAgICAgIGlzUmVnaXN0ZXI6IGZhbHNlXG4gICAgfTtcbiAgfVxuICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYy5jb250ZXh0LmludGVybmFsQWRhcHRlci5jcmVhdGVTZXNzaW9uKHVzZXIuaWQsIGMpO1xuICBpZiAoIXNlc3Npb24pIHtcbiAgICByZXR1cm4ge1xuICAgICAgZXJyb3I6IFwidW5hYmxlIHRvIGNyZWF0ZSBzZXNzaW9uXCIsXG4gICAgICBkYXRhOiBudWxsLFxuICAgICAgaXNSZWdpc3RlcjogZmFsc2VcbiAgICB9O1xuICB9XG4gIHJldHVybiB7XG4gICAgZGF0YToge1xuICAgICAgc2Vzc2lvbixcbiAgICAgIHVzZXJcbiAgICB9LFxuICAgIGVycm9yOiBudWxsLFxuICAgIGlzUmVnaXN0ZXJcbiAgfTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gY3JlYXRlQXV0aG9yaXphdGlvblVSTCh7XG4gIGlkLFxuICBvcHRpb25zLFxuICBhdXRob3JpemF0aW9uRW5kcG9pbnQsXG4gIHN0YXRlLFxuICBjb2RlVmVyaWZpZXIsXG4gIHNjb3BlcyxcbiAgY2xhaW1zLFxuICByZWRpcmVjdFVSSSxcbiAgZHVyYXRpb24sXG4gIHByb21wdCxcbiAgYWNjZXNzVHlwZSxcbiAgcmVzcG9uc2VUeXBlLFxuICBkaXNwbGF5LFxuICBsb2dpbkhpbnQsXG4gIGhkLFxuICByZXNwb25zZU1vZGUsXG4gIGFkZGl0aW9uYWxQYXJhbXMsXG4gIHNjb3BlSm9pbmVyXG59KSB7XG4gIGNvbnN0IHVybCA9IG5ldyBVUkwoYXV0aG9yaXphdGlvbkVuZHBvaW50KTtcbiAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJyZXNwb25zZV90eXBlXCIsIHJlc3BvbnNlVHlwZSB8fCBcImNvZGVcIik7XG4gIHVybC5zZWFyY2hQYXJhbXMuc2V0KFwiY2xpZW50X2lkXCIsIG9wdGlvbnMuY2xpZW50SWQpO1xuICB1cmwuc2VhcmNoUGFyYW1zLnNldChcInN0YXRlXCIsIHN0YXRlKTtcbiAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJzY29wZVwiLCBzY29wZXMuam9pbihzY29wZUpvaW5lciB8fCBcIiBcIikpO1xuICB1cmwuc2VhcmNoUGFyYW1zLnNldChcInJlZGlyZWN0X3VyaVwiLCBvcHRpb25zLnJlZGlyZWN0VVJJIHx8IHJlZGlyZWN0VVJJKTtcbiAgZHVyYXRpb24gJiYgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJkdXJhdGlvblwiLCBkdXJhdGlvbik7XG4gIGRpc3BsYXkgJiYgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJkaXNwbGF5XCIsIGRpc3BsYXkpO1xuICBsb2dpbkhpbnQgJiYgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJsb2dpbl9oaW50XCIsIGxvZ2luSGludCk7XG4gIHByb21wdCAmJiB1cmwuc2VhcmNoUGFyYW1zLnNldChcInByb21wdFwiLCBwcm9tcHQpO1xuICBoZCAmJiB1cmwuc2VhcmNoUGFyYW1zLnNldChcImhkXCIsIGhkKTtcbiAgYWNjZXNzVHlwZSAmJiB1cmwuc2VhcmNoUGFyYW1zLnNldChcImFjY2Vzc190eXBlXCIsIGFjY2Vzc1R5cGUpO1xuICByZXNwb25zZU1vZGUgJiYgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJyZXNwb25zZV9tb2RlXCIsIHJlc3BvbnNlTW9kZSk7XG4gIGlmIChjb2RlVmVyaWZpZXIpIHtcbiAgICBjb25zdCBjb2RlQ2hhbGxlbmdlID0gYXdhaXQgZ2VuZXJhdGVDb2RlQ2hhbGxlbmdlKGNvZGVWZXJpZmllcik7XG4gICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJjb2RlX2NoYWxsZW5nZV9tZXRob2RcIiwgXCJTMjU2XCIpO1xuICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KFwiY29kZV9jaGFsbGVuZ2VcIiwgY29kZUNoYWxsZW5nZSk7XG4gIH1cbiAgaWYgKGNsYWltcykge1xuICAgIGNvbnN0IGNsYWltc09iaiA9IGNsYWltcy5yZWR1Y2UoXG4gICAgICAoYWNjLCBjbGFpbSkgPT4ge1xuICAgICAgICBhY2NbY2xhaW1dID0gbnVsbDtcbiAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgIH0sXG4gICAgICB7fVxuICAgICk7XG4gICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXG4gICAgICBcImNsYWltc1wiLFxuICAgICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBpZF90b2tlbjogeyBlbWFpbDogbnVsbCwgZW1haWxfdmVyaWZpZWQ6IG51bGwsIC4uLmNsYWltc09iaiB9XG4gICAgICB9KVxuICAgICk7XG4gIH1cbiAgaWYgKGFkZGl0aW9uYWxQYXJhbXMpIHtcbiAgICBPYmplY3QuZW50cmllcyhhZGRpdGlvbmFsUGFyYW1zKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KGtleSwgdmFsdWUpO1xuICAgIH0pO1xuICB9XG4gIHJldHVybiB1cmw7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGUoe1xuICBjb2RlLFxuICBjb2RlVmVyaWZpZXIsXG4gIHJlZGlyZWN0VVJJLFxuICBvcHRpb25zLFxuICB0b2tlbkVuZHBvaW50LFxuICBhdXRoZW50aWNhdGlvbixcbiAgZGV2aWNlSWQsXG4gIGhlYWRlcnMsXG4gIGFkZGl0aW9uYWxQYXJhbXMgPSB7fVxufSkge1xuICBjb25zdCBib2R5ID0gbmV3IFVSTFNlYXJjaFBhcmFtcygpO1xuICBjb25zdCByZXF1ZXN0SGVhZGVycyA9IHtcbiAgICBcImNvbnRlbnQtdHlwZVwiOiBcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiLFxuICAgIGFjY2VwdDogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgXCJ1c2VyLWFnZW50XCI6IFwiYmV0dGVyLWF1dGhcIixcbiAgICAuLi5oZWFkZXJzXG4gIH07XG4gIGJvZHkuc2V0KFwiZ3JhbnRfdHlwZVwiLCBcImF1dGhvcml6YXRpb25fY29kZVwiKTtcbiAgYm9keS5zZXQoXCJjb2RlXCIsIGNvZGUpO1xuICBjb2RlVmVyaWZpZXIgJiYgYm9keS5zZXQoXCJjb2RlX3ZlcmlmaWVyXCIsIGNvZGVWZXJpZmllcik7XG4gIG9wdGlvbnMuY2xpZW50S2V5ICYmIGJvZHkuc2V0KFwiY2xpZW50X2tleVwiLCBvcHRpb25zLmNsaWVudEtleSk7XG4gIGRldmljZUlkICYmIGJvZHkuc2V0KFwiZGV2aWNlX2lkXCIsIGRldmljZUlkKTtcbiAgYm9keS5zZXQoXCJyZWRpcmVjdF91cmlcIiwgb3B0aW9ucy5yZWRpcmVjdFVSSSB8fCByZWRpcmVjdFVSSSk7XG4gIGJvZHkuc2V0KFwiY2xpZW50X2lkXCIsIG9wdGlvbnMuY2xpZW50SWQpO1xuICBpZiAoYXV0aGVudGljYXRpb24gPT09IFwiYmFzaWNcIikge1xuICAgIGNvbnN0IGVuY29kZWRDcmVkZW50aWFscyA9IGJhc2U2NC5lbmNvZGUoXG4gICAgICBgJHtvcHRpb25zLmNsaWVudElkfToke29wdGlvbnMuY2xpZW50U2VjcmV0fWBcbiAgICApO1xuICAgIHJlcXVlc3RIZWFkZXJzW1wiYXV0aG9yaXphdGlvblwiXSA9IGBCYXNpYyAke2VuY29kZWRDcmVkZW50aWFsc31gO1xuICB9IGVsc2Uge1xuICAgIGJvZHkuc2V0KFwiY2xpZW50X3NlY3JldFwiLCBvcHRpb25zLmNsaWVudFNlY3JldCk7XG4gIH1cbiAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoYWRkaXRpb25hbFBhcmFtcykpIHtcbiAgICBpZiAoIWJvZHkuaGFzKGtleSkpIGJvZHkuYXBwZW5kKGtleSwgdmFsdWUpO1xuICB9XG4gIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IGJldHRlckZldGNoKHRva2VuRW5kcG9pbnQsIHtcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgIGJvZHksXG4gICAgaGVhZGVyczogcmVxdWVzdEhlYWRlcnNcbiAgfSk7XG4gIGlmIChlcnJvcikge1xuICAgIHRocm93IGVycm9yO1xuICB9XG4gIGNvbnN0IHRva2VucyA9IGdldE9BdXRoMlRva2VucyhkYXRhKTtcbiAgcmV0dXJuIHRva2Vucztcbn1cbmFzeW5jIGZ1bmN0aW9uIHZhbGlkYXRlVG9rZW4odG9rZW4sIGp3a3NFbmRwb2ludCkge1xuICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBiZXR0ZXJGZXRjaChqd2tzRW5kcG9pbnQsIHtcbiAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgaGVhZGVyczoge1xuICAgICAgYWNjZXB0OiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgIFwidXNlci1hZ2VudFwiOiBcImJldHRlci1hdXRoXCJcbiAgICB9XG4gIH0pO1xuICBpZiAoZXJyb3IpIHtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxuICBjb25zdCBrZXlzID0gZGF0YVtcImtleXNcIl07XG4gIGNvbnN0IGhlYWRlciA9IEpTT04ucGFyc2UoYXRvYih0b2tlbi5zcGxpdChcIi5cIilbMF0pKTtcbiAgY29uc3Qga2V5ID0ga2V5cy5maW5kKChrZXkyKSA9PiBrZXkyLmtpZCA9PT0gaGVhZGVyLmtpZCk7XG4gIGlmICgha2V5KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiS2V5IG5vdCBmb3VuZFwiKTtcbiAgfVxuICBjb25zdCB2ZXJpZmllZCA9IGF3YWl0IGp3dFZlcmlmeSh0b2tlbiwga2V5KTtcbiAgcmV0dXJuIHZlcmlmaWVkO1xufVxuXG5hc3luYyBmdW5jdGlvbiByZWZyZXNoQWNjZXNzVG9rZW4oe1xuICByZWZyZXNoVG9rZW4sXG4gIG9wdGlvbnMsXG4gIHRva2VuRW5kcG9pbnQsXG4gIGF1dGhlbnRpY2F0aW9uLFxuICBleHRyYVBhcmFtcyxcbiAgZ3JhbnRUeXBlID0gXCJyZWZyZXNoX3Rva2VuXCJcbn0pIHtcbiAgY29uc3QgYm9keSA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTtcbiAgY29uc3QgaGVhZGVycyA9IHtcbiAgICBcImNvbnRlbnQtdHlwZVwiOiBcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiLFxuICAgIGFjY2VwdDogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgfTtcbiAgYm9keS5zZXQoXCJncmFudF90eXBlXCIsIGdyYW50VHlwZSk7XG4gIGJvZHkuc2V0KFwicmVmcmVzaF90b2tlblwiLCByZWZyZXNoVG9rZW4pO1xuICBpZiAoYXV0aGVudGljYXRpb24gPT09IFwiYmFzaWNcIikge1xuICAgIGhlYWRlcnNbXCJhdXRob3JpemF0aW9uXCJdID0gYmFzZTY0LmVuY29kZShcbiAgICAgIGAke29wdGlvbnMuY2xpZW50SWR9OiR7b3B0aW9ucy5jbGllbnRTZWNyZXR9YFxuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgYm9keS5zZXQoXCJjbGllbnRfaWRcIiwgb3B0aW9ucy5jbGllbnRJZCk7XG4gICAgYm9keS5zZXQoXCJjbGllbnRfc2VjcmV0XCIsIG9wdGlvbnMuY2xpZW50U2VjcmV0KTtcbiAgfVxuICBpZiAoZXh0cmFQYXJhbXMpIHtcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhleHRyYVBhcmFtcykpIHtcbiAgICAgIGJvZHkuc2V0KGtleSwgdmFsdWUpO1xuICAgIH1cbiAgfVxuICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBiZXR0ZXJGZXRjaCh0b2tlbkVuZHBvaW50LCB7XG4gICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICBib2R5LFxuICAgIGhlYWRlcnNcbiAgfSk7XG4gIGlmIChlcnJvcikge1xuICAgIHRocm93IGVycm9yO1xuICB9XG4gIGNvbnN0IHRva2VucyA9IHtcbiAgICBhY2Nlc3NUb2tlbjogZGF0YS5hY2Nlc3NfdG9rZW4sXG4gICAgcmVmcmVzaFRva2VuOiBkYXRhLnJlZnJlc2hfdG9rZW4sXG4gICAgdG9rZW5UeXBlOiBkYXRhLnRva2VuX3R5cGUsXG4gICAgc2NvcGVzOiBkYXRhLnNjb3BlPy5zcGxpdChcIiBcIiksXG4gICAgaWRUb2tlbjogZGF0YS5pZF90b2tlblxuICB9O1xuICBpZiAoZGF0YS5leHBpcmVzX2luKSB7XG4gICAgY29uc3Qgbm93ID0gLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCk7XG4gICAgdG9rZW5zLmFjY2Vzc1Rva2VuRXhwaXJlc0F0ID0gbmV3IERhdGUoXG4gICAgICBub3cuZ2V0VGltZSgpICsgZGF0YS5leHBpcmVzX2luICogMWUzXG4gICAgKTtcbiAgfVxuICByZXR1cm4gdG9rZW5zO1xufVxuXG5jb25zdCBhcHBsZSA9IChvcHRpb25zKSA9PiB7XG4gIGNvbnN0IHRva2VuRW5kcG9pbnQgPSBcImh0dHBzOi8vYXBwbGVpZC5hcHBsZS5jb20vYXV0aC90b2tlblwiO1xuICByZXR1cm4ge1xuICAgIGlkOiBcImFwcGxlXCIsXG4gICAgbmFtZTogXCJBcHBsZVwiLFxuICAgIGFzeW5jIGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoeyBzdGF0ZSwgc2NvcGVzLCByZWRpcmVjdFVSSSB9KSB7XG4gICAgICBjb25zdCBfc2NvcGUgPSBvcHRpb25zLmRpc2FibGVEZWZhdWx0U2NvcGUgPyBbXSA6IFtcImVtYWlsXCIsIFwibmFtZVwiXTtcbiAgICAgIG9wdGlvbnMuc2NvcGUgJiYgX3Njb3BlLnB1c2goLi4ub3B0aW9ucy5zY29wZSk7XG4gICAgICBzY29wZXMgJiYgX3Njb3BlLnB1c2goLi4uc2NvcGVzKTtcbiAgICAgIGNvbnN0IHVybCA9IGF3YWl0IGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoe1xuICAgICAgICBpZDogXCJhcHBsZVwiLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQ6IFwiaHR0cHM6Ly9hcHBsZWlkLmFwcGxlLmNvbS9hdXRoL2F1dGhvcml6ZVwiLFxuICAgICAgICBzY29wZXM6IF9zY29wZSxcbiAgICAgICAgc3RhdGUsXG4gICAgICAgIHJlZGlyZWN0VVJJLFxuICAgICAgICByZXNwb25zZU1vZGU6IFwiZm9ybV9wb3N0XCIsXG4gICAgICAgIHJlc3BvbnNlVHlwZTogXCJjb2RlIGlkX3Rva2VuXCJcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHVybDtcbiAgICB9LFxuICAgIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGU6IGFzeW5jICh7IGNvZGUsIGNvZGVWZXJpZmllciwgcmVkaXJlY3RVUkkgfSkgPT4ge1xuICAgICAgcmV0dXJuIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGUoe1xuICAgICAgICBjb2RlLFxuICAgICAgICBjb2RlVmVyaWZpZXIsXG4gICAgICAgIHJlZGlyZWN0VVJJLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICB0b2tlbkVuZHBvaW50XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGFzeW5jIHZlcmlmeUlkVG9rZW4odG9rZW4sIG5vbmNlKSB7XG4gICAgICBpZiAob3B0aW9ucy5kaXNhYmxlSWRUb2tlblNpZ25Jbikge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy52ZXJpZnlJZFRva2VuKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLnZlcmlmeUlkVG9rZW4odG9rZW4sIG5vbmNlKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGRlY29kZWRIZWFkZXIgPSBkZWNvZGVQcm90ZWN0ZWRIZWFkZXIodG9rZW4pO1xuICAgICAgY29uc3QgeyBraWQsIGFsZzogand0QWxnIH0gPSBkZWNvZGVkSGVhZGVyO1xuICAgICAgaWYgKCFraWQgfHwgIWp3dEFsZykgcmV0dXJuIGZhbHNlO1xuICAgICAgY29uc3QgcHVibGljS2V5ID0gYXdhaXQgZ2V0QXBwbGVQdWJsaWNLZXkoa2lkKTtcbiAgICAgIGNvbnN0IHsgcGF5bG9hZDogand0Q2xhaW1zIH0gPSBhd2FpdCBqd3RWZXJpZnkodG9rZW4sIHB1YmxpY0tleSwge1xuICAgICAgICBhbGdvcml0aG1zOiBband0QWxnXSxcbiAgICAgICAgaXNzdWVyOiBcImh0dHBzOi8vYXBwbGVpZC5hcHBsZS5jb21cIixcbiAgICAgICAgYXVkaWVuY2U6IG9wdGlvbnMuYXBwQnVuZGxlSWRlbnRpZmllciB8fCBvcHRpb25zLmNsaWVudElkLFxuICAgICAgICBtYXhUb2tlbkFnZTogXCIxaFwiXG4gICAgICB9KTtcbiAgICAgIFtcImVtYWlsX3ZlcmlmaWVkXCIsIFwiaXNfcHJpdmF0ZV9lbWFpbFwiXS5mb3JFYWNoKChmaWVsZCkgPT4ge1xuICAgICAgICBpZiAoand0Q2xhaW1zW2ZpZWxkXSAhPT0gdm9pZCAwKSB7XG4gICAgICAgICAgand0Q2xhaW1zW2ZpZWxkXSA9IEJvb2xlYW4oand0Q2xhaW1zW2ZpZWxkXSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgaWYgKG5vbmNlICYmIGp3dENsYWltcy5ub25jZSAhPT0gbm9uY2UpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuICEhand0Q2xhaW1zO1xuICAgIH0sXG4gICAgcmVmcmVzaEFjY2Vzc1Rva2VuOiBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA/IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuIDogYXN5bmMgKHJlZnJlc2hUb2tlbikgPT4ge1xuICAgICAgcmV0dXJuIHJlZnJlc2hBY2Nlc3NUb2tlbih7XG4gICAgICAgIHJlZnJlc2hUb2tlbixcbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgIGNsaWVudElkOiBvcHRpb25zLmNsaWVudElkLFxuICAgICAgICAgIGNsaWVudEtleTogb3B0aW9ucy5jbGllbnRLZXksXG4gICAgICAgICAgY2xpZW50U2VjcmV0OiBvcHRpb25zLmNsaWVudFNlY3JldFxuICAgICAgICB9LFxuICAgICAgICB0b2tlbkVuZHBvaW50OiBcImh0dHBzOi8vYXBwbGVpZC5hcHBsZS5jb20vYXV0aC90b2tlblwiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIGFzeW5jIGdldFVzZXJJbmZvKHRva2VuKSB7XG4gICAgICBpZiAob3B0aW9ucy5nZXRVc2VySW5mbykge1xuICAgICAgICByZXR1cm4gb3B0aW9ucy5nZXRVc2VySW5mbyh0b2tlbik7XG4gICAgICB9XG4gICAgICBpZiAoIXRva2VuLmlkVG9rZW4pIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICBjb25zdCBwcm9maWxlID0gZGVjb2RlSnd0KHRva2VuLmlkVG9rZW4pO1xuICAgICAgaWYgKCFwcm9maWxlKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgbmFtZSA9IHRva2VuLnVzZXIgPyBgJHt0b2tlbi51c2VyLm5hbWU/LmZpcnN0TmFtZX0gJHt0b2tlbi51c2VyLm5hbWU/Lmxhc3ROYW1lfWAgOiBwcm9maWxlLm5hbWUgfHwgcHJvZmlsZS5lbWFpbDtcbiAgICAgIGNvbnN0IGVtYWlsVmVyaWZpZWQgPSB0eXBlb2YgcHJvZmlsZS5lbWFpbF92ZXJpZmllZCA9PT0gXCJib29sZWFuXCIgPyBwcm9maWxlLmVtYWlsX3ZlcmlmaWVkIDogcHJvZmlsZS5lbWFpbF92ZXJpZmllZCA9PT0gXCJ0cnVlXCI7XG4gICAgICBjb25zdCB1c2VyTWFwID0gYXdhaXQgb3B0aW9ucy5tYXBQcm9maWxlVG9Vc2VyPy4ocHJvZmlsZSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IHByb2ZpbGUuc3ViLFxuICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgZW1haWxWZXJpZmllZCxcbiAgICAgICAgICBlbWFpbDogcHJvZmlsZS5lbWFpbCxcbiAgICAgICAgICAuLi51c2VyTWFwXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGE6IHByb2ZpbGVcbiAgICAgIH07XG4gICAgfSxcbiAgICBvcHRpb25zXG4gIH07XG59O1xuY29uc3QgZ2V0QXBwbGVQdWJsaWNLZXkgPSBhc3luYyAoa2lkKSA9PiB7XG4gIGNvbnN0IEFQUExFX0JBU0VfVVJMID0gXCJodHRwczovL2FwcGxlaWQuYXBwbGUuY29tXCI7XG4gIGNvbnN0IEpXS1NfQVBQTEVfVVJJID0gXCIvYXV0aC9rZXlzXCI7XG4gIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgYmV0dGVyRmV0Y2goYCR7QVBQTEVfQkFTRV9VUkx9JHtKV0tTX0FQUExFX1VSSX1gKTtcbiAgaWYgKCFkYXRhPy5rZXlzKSB7XG4gICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgbWVzc2FnZTogXCJLZXlzIG5vdCBmb3VuZFwiXG4gICAgfSk7XG4gIH1cbiAgY29uc3QgandrID0gZGF0YS5rZXlzLmZpbmQoKGtleSkgPT4ga2V5LmtpZCA9PT0ga2lkKTtcbiAgaWYgKCFqd2spIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEpXSyB3aXRoIGtpZCAke2tpZH0gbm90IGZvdW5kYCk7XG4gIH1cbiAgcmV0dXJuIGF3YWl0IGltcG9ydEpXSyhqd2ssIGp3ay5hbGcpO1xufTtcblxuY29uc3QgZGlzY29yZCA9IChvcHRpb25zKSA9PiB7XG4gIHJldHVybiB7XG4gICAgaWQ6IFwiZGlzY29yZFwiLFxuICAgIG5hbWU6IFwiRGlzY29yZFwiLFxuICAgIGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoeyBzdGF0ZSwgc2NvcGVzLCByZWRpcmVjdFVSSSB9KSB7XG4gICAgICBjb25zdCBfc2NvcGVzID0gb3B0aW9ucy5kaXNhYmxlRGVmYXVsdFNjb3BlID8gW10gOiBbXCJpZGVudGlmeVwiLCBcImVtYWlsXCJdO1xuICAgICAgc2NvcGVzICYmIF9zY29wZXMucHVzaCguLi5zY29wZXMpO1xuICAgICAgb3B0aW9ucy5zY29wZSAmJiBfc2NvcGVzLnB1c2goLi4ub3B0aW9ucy5zY29wZSk7XG4gICAgICByZXR1cm4gbmV3IFVSTChcbiAgICAgICAgYGh0dHBzOi8vZGlzY29yZC5jb20vYXBpL29hdXRoMi9hdXRob3JpemU/c2NvcGU9JHtfc2NvcGVzLmpvaW4oXG4gICAgICAgICAgXCIrXCJcbiAgICAgICAgKX0mcmVzcG9uc2VfdHlwZT1jb2RlJmNsaWVudF9pZD0ke29wdGlvbnMuY2xpZW50SWR9JnJlZGlyZWN0X3VyaT0ke2VuY29kZVVSSUNvbXBvbmVudChcbiAgICAgICAgICBvcHRpb25zLnJlZGlyZWN0VVJJIHx8IHJlZGlyZWN0VVJJXG4gICAgICAgICl9JnN0YXRlPSR7c3RhdGV9JnByb21wdD0ke29wdGlvbnMucHJvbXB0IHx8IFwibm9uZVwifWBcbiAgICAgICk7XG4gICAgfSxcbiAgICB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlOiBhc3luYyAoeyBjb2RlLCByZWRpcmVjdFVSSSB9KSA9PiB7XG4gICAgICByZXR1cm4gdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZSh7XG4gICAgICAgIGNvZGUsXG4gICAgICAgIHJlZGlyZWN0VVJJLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICB0b2tlbkVuZHBvaW50OiBcImh0dHBzOi8vZGlzY29yZC5jb20vYXBpL29hdXRoMi90b2tlblwiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIHJlZnJlc2hBY2Nlc3NUb2tlbjogb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gPyBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA6IGFzeW5jIChyZWZyZXNoVG9rZW4pID0+IHtcbiAgICAgIHJldHVybiByZWZyZXNoQWNjZXNzVG9rZW4oe1xuICAgICAgICByZWZyZXNoVG9rZW4sXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICBjbGllbnRJZDogb3B0aW9ucy5jbGllbnRJZCxcbiAgICAgICAgICBjbGllbnRLZXk6IG9wdGlvbnMuY2xpZW50S2V5LFxuICAgICAgICAgIGNsaWVudFNlY3JldDogb3B0aW9ucy5jbGllbnRTZWNyZXRcbiAgICAgICAgfSxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL2Rpc2NvcmQuY29tL2FwaS9vYXV0aDIvdG9rZW5cIlxuICAgICAgfSk7XG4gICAgfSxcbiAgICBhc3luYyBnZXRVc2VySW5mbyh0b2tlbikge1xuICAgICAgaWYgKG9wdGlvbnMuZ2V0VXNlckluZm8pIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMuZ2V0VXNlckluZm8odG9rZW4pO1xuICAgICAgfVxuICAgICAgY29uc3QgeyBkYXRhOiBwcm9maWxlLCBlcnJvciB9ID0gYXdhaXQgYmV0dGVyRmV0Y2goXG4gICAgICAgIFwiaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvdXNlcnMvQG1lXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW4uYWNjZXNzVG9rZW59YFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGlmIChwcm9maWxlLmF2YXRhciA9PT0gbnVsbCkge1xuICAgICAgICBjb25zdCBkZWZhdWx0QXZhdGFyTnVtYmVyID0gcHJvZmlsZS5kaXNjcmltaW5hdG9yID09PSBcIjBcIiA/IE51bWJlcihCaWdJbnQocHJvZmlsZS5pZCkgPj4gQmlnSW50KDIyKSkgJSA2IDogcGFyc2VJbnQocHJvZmlsZS5kaXNjcmltaW5hdG9yKSAlIDU7XG4gICAgICAgIHByb2ZpbGUuaW1hZ2VfdXJsID0gYGh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2VtYmVkL2F2YXRhcnMvJHtkZWZhdWx0QXZhdGFyTnVtYmVyfS5wbmdgO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgZm9ybWF0ID0gcHJvZmlsZS5hdmF0YXIuc3RhcnRzV2l0aChcImFfXCIpID8gXCJnaWZcIiA6IFwicG5nXCI7XG4gICAgICAgIHByb2ZpbGUuaW1hZ2VfdXJsID0gYGh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F2YXRhcnMvJHtwcm9maWxlLmlkfS8ke3Byb2ZpbGUuYXZhdGFyfS4ke2Zvcm1hdH1gO1xuICAgICAgfVxuICAgICAgY29uc3QgdXNlck1hcCA9IGF3YWl0IG9wdGlvbnMubWFwUHJvZmlsZVRvVXNlcj8uKHByb2ZpbGUpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGlkOiBwcm9maWxlLmlkLFxuICAgICAgICAgIG5hbWU6IHByb2ZpbGUuZ2xvYmFsX25hbWUgfHwgcHJvZmlsZS51c2VybmFtZSB8fCBcIlwiLFxuICAgICAgICAgIGVtYWlsOiBwcm9maWxlLmVtYWlsLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IHByb2ZpbGUudmVyaWZpZWQsXG4gICAgICAgICAgaW1hZ2U6IHByb2ZpbGUuaW1hZ2VfdXJsLFxuICAgICAgICAgIC4uLnVzZXJNYXBcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YTogcHJvZmlsZVxuICAgICAgfTtcbiAgICB9LFxuICAgIG9wdGlvbnNcbiAgfTtcbn07XG5cbmNvbnN0IGZhY2Vib29rID0gKG9wdGlvbnMpID0+IHtcbiAgcmV0dXJuIHtcbiAgICBpZDogXCJmYWNlYm9va1wiLFxuICAgIG5hbWU6IFwiRmFjZWJvb2tcIixcbiAgICBhc3luYyBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHsgc3RhdGUsIHNjb3BlcywgcmVkaXJlY3RVUkksIGxvZ2luSGludCB9KSB7XG4gICAgICBjb25zdCBfc2NvcGVzID0gb3B0aW9ucy5kaXNhYmxlRGVmYXVsdFNjb3BlID8gW10gOiBbXCJlbWFpbFwiLCBcInB1YmxpY19wcm9maWxlXCJdO1xuICAgICAgb3B0aW9ucy5zY29wZSAmJiBfc2NvcGVzLnB1c2goLi4ub3B0aW9ucy5zY29wZSk7XG4gICAgICBzY29wZXMgJiYgX3Njb3Blcy5wdXNoKC4uLnNjb3Blcyk7XG4gICAgICByZXR1cm4gYXdhaXQgY3JlYXRlQXV0aG9yaXphdGlvblVSTCh7XG4gICAgICAgIGlkOiBcImZhY2Vib29rXCIsXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIGF1dGhvcml6YXRpb25FbmRwb2ludDogXCJodHRwczovL3d3dy5mYWNlYm9vay5jb20vdjIxLjAvZGlhbG9nL29hdXRoXCIsXG4gICAgICAgIHNjb3BlczogX3Njb3BlcyxcbiAgICAgICAgc3RhdGUsXG4gICAgICAgIHJlZGlyZWN0VVJJLFxuICAgICAgICBsb2dpbkhpbnQsXG4gICAgICAgIGFkZGl0aW9uYWxQYXJhbXM6IG9wdGlvbnMuY29uZmlnSWQgPyB7XG4gICAgICAgICAgY29uZmlnX2lkOiBvcHRpb25zLmNvbmZpZ0lkXG4gICAgICAgIH0gOiB7fVxuICAgICAgfSk7XG4gICAgfSxcbiAgICB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlOiBhc3luYyAoeyBjb2RlLCByZWRpcmVjdFVSSSB9KSA9PiB7XG4gICAgICByZXR1cm4gdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZSh7XG4gICAgICAgIGNvZGUsXG4gICAgICAgIHJlZGlyZWN0VVJJLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICB0b2tlbkVuZHBvaW50OiBcImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL29hdXRoL2FjY2Vzc190b2tlblwiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIGFzeW5jIHZlcmlmeUlkVG9rZW4odG9rZW4sIG5vbmNlKSB7XG4gICAgICBpZiAob3B0aW9ucy5kaXNhYmxlSWRUb2tlblNpZ25Jbikge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy52ZXJpZnlJZFRva2VuKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLnZlcmlmeUlkVG9rZW4odG9rZW4sIG5vbmNlKTtcbiAgICAgIH1cbiAgICAgIGlmICh0b2tlbi5zcGxpdChcIi5cIikubGVuZ3RoID09PSAzKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgeyBwYXlsb2FkOiBqd3RDbGFpbXMgfSA9IGF3YWl0IGp3dFZlcmlmeShcbiAgICAgICAgICAgIHRva2VuLFxuICAgICAgICAgICAgY3JlYXRlUmVtb3RlSldLU2V0KFxuICAgICAgICAgICAgICAvLyBodHRwczovL2RldmVsb3BlcnMuZmFjZWJvb2suY29tL2RvY3MvZmFjZWJvb2stbG9naW4vbGltaXRlZC1sb2dpbi90b2tlbi8jandrc1xuICAgICAgICAgICAgICBuZXcgVVJMKFxuICAgICAgICAgICAgICAgIFwiaHR0cHM6Ly9saW1pdGVkLmZhY2Vib29rLmNvbS8ud2VsbC1rbm93bi9vYXV0aC9vcGVuaWQvandrcy9cIlxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBhbGdvcml0aG1zOiBbXCJSUzI1NlwiXSxcbiAgICAgICAgICAgICAgYXVkaWVuY2U6IG9wdGlvbnMuY2xpZW50SWQsXG4gICAgICAgICAgICAgIGlzc3VlcjogXCJodHRwczovL3d3dy5mYWNlYm9vay5jb21cIlxuICAgICAgICAgICAgfVxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKG5vbmNlICYmIGp3dENsYWltcy5ub25jZSAhPT0gbm9uY2UpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuICEhand0Q2xhaW1zO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcbiAgICByZWZyZXNoQWNjZXNzVG9rZW46IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuID8gb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gOiBhc3luYyAocmVmcmVzaFRva2VuKSA9PiB7XG4gICAgICByZXR1cm4gcmVmcmVzaEFjY2Vzc1Rva2VuKHtcbiAgICAgICAgcmVmcmVzaFRva2VuLFxuICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgY2xpZW50SWQ6IG9wdGlvbnMuY2xpZW50SWQsXG4gICAgICAgICAgY2xpZW50S2V5OiBvcHRpb25zLmNsaWVudEtleSxcbiAgICAgICAgICBjbGllbnRTZWNyZXQ6IG9wdGlvbnMuY2xpZW50U2VjcmV0XG4gICAgICAgIH0sXG4gICAgICAgIHRva2VuRW5kcG9pbnQ6IFwiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vdjE4LjAvb2F1dGgvYWNjZXNzX3Rva2VuXCJcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgYXN5bmMgZ2V0VXNlckluZm8odG9rZW4pIHtcbiAgICAgIGlmIChvcHRpb25zLmdldFVzZXJJbmZvKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLmdldFVzZXJJbmZvKHRva2VuKTtcbiAgICAgIH1cbiAgICAgIGlmICh0b2tlbi5pZFRva2VuICYmIHRva2VuLmlkVG9rZW4uc3BsaXQoXCIuXCIpLmxlbmd0aCA9PT0gMykge1xuICAgICAgICBjb25zdCBwcm9maWxlMiA9IGRlY29kZUp3dCh0b2tlbi5pZFRva2VuKTtcbiAgICAgICAgY29uc3QgdXNlciA9IHtcbiAgICAgICAgICBpZDogcHJvZmlsZTIuc3ViLFxuICAgICAgICAgIG5hbWU6IHByb2ZpbGUyLm5hbWUsXG4gICAgICAgICAgZW1haWw6IHByb2ZpbGUyLmVtYWlsLFxuICAgICAgICAgIHBpY3R1cmU6IHtcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgdXJsOiBwcm9maWxlMi5waWN0dXJlLFxuICAgICAgICAgICAgICBoZWlnaHQ6IDEwMCxcbiAgICAgICAgICAgICAgd2lkdGg6IDEwMCxcbiAgICAgICAgICAgICAgaXNfc2lsaG91ZXR0ZTogZmFsc2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHVzZXJNYXAyID0gYXdhaXQgb3B0aW9ucy5tYXBQcm9maWxlVG9Vc2VyPy4oe1xuICAgICAgICAgIC4uLnVzZXIsXG4gICAgICAgICAgZW1haWxfdmVyaWZpZWQ6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgLi4udXNlcixcbiAgICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IHRydWUsXG4gICAgICAgICAgICAuLi51c2VyTWFwMlxuICAgICAgICAgIH0sXG4gICAgICAgICAgZGF0YTogcHJvZmlsZTJcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGZpZWxkcyA9IFtcbiAgICAgICAgXCJpZFwiLFxuICAgICAgICBcIm5hbWVcIixcbiAgICAgICAgXCJlbWFpbFwiLFxuICAgICAgICBcInBpY3R1cmVcIixcbiAgICAgICAgLi4ub3B0aW9ucz8uZmllbGRzIHx8IFtdXG4gICAgICBdO1xuICAgICAgY29uc3QgeyBkYXRhOiBwcm9maWxlLCBlcnJvciB9ID0gYXdhaXQgYmV0dGVyRmV0Y2goXG4gICAgICAgIFwiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vbWU/ZmllbGRzPVwiICsgZmllbGRzLmpvaW4oXCIsXCIpLFxuICAgICAgICB7XG4gICAgICAgICAgYXV0aDoge1xuICAgICAgICAgICAgdHlwZTogXCJCZWFyZXJcIixcbiAgICAgICAgICAgIHRva2VuOiB0b2tlbi5hY2Nlc3NUb2tlblxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHVzZXJNYXAgPSBhd2FpdCBvcHRpb25zLm1hcFByb2ZpbGVUb1VzZXI/Lihwcm9maWxlKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogcHJvZmlsZS5pZCxcbiAgICAgICAgICBuYW1lOiBwcm9maWxlLm5hbWUsXG4gICAgICAgICAgZW1haWw6IHByb2ZpbGUuZW1haWwsXG4gICAgICAgICAgaW1hZ2U6IHByb2ZpbGUucGljdHVyZS5kYXRhLnVybCxcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiBwcm9maWxlLmVtYWlsX3ZlcmlmaWVkLFxuICAgICAgICAgIC4uLnVzZXJNYXBcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YTogcHJvZmlsZVxuICAgICAgfTtcbiAgICB9LFxuICAgIG9wdGlvbnNcbiAgfTtcbn07XG5cbmNvbnN0IGdpdGh1YiA9IChvcHRpb25zKSA9PiB7XG4gIGNvbnN0IHRva2VuRW5kcG9pbnQgPSBcImh0dHBzOi8vZ2l0aHViLmNvbS9sb2dpbi9vYXV0aC9hY2Nlc3NfdG9rZW5cIjtcbiAgcmV0dXJuIHtcbiAgICBpZDogXCJnaXRodWJcIixcbiAgICBuYW1lOiBcIkdpdEh1YlwiLFxuICAgIGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoeyBzdGF0ZSwgc2NvcGVzLCBsb2dpbkhpbnQsIHJlZGlyZWN0VVJJIH0pIHtcbiAgICAgIGNvbnN0IF9zY29wZXMgPSBvcHRpb25zLmRpc2FibGVEZWZhdWx0U2NvcGUgPyBbXSA6IFtcInJlYWQ6dXNlclwiLCBcInVzZXI6ZW1haWxcIl07XG4gICAgICBvcHRpb25zLnNjb3BlICYmIF9zY29wZXMucHVzaCguLi5vcHRpb25zLnNjb3BlKTtcbiAgICAgIHNjb3BlcyAmJiBfc2NvcGVzLnB1c2goLi4uc2NvcGVzKTtcbiAgICAgIHJldHVybiBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHtcbiAgICAgICAgaWQ6IFwiZ2l0aHViXCIsXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIGF1dGhvcml6YXRpb25FbmRwb2ludDogXCJodHRwczovL2dpdGh1Yi5jb20vbG9naW4vb2F1dGgvYXV0aG9yaXplXCIsXG4gICAgICAgIHNjb3BlczogX3Njb3BlcyxcbiAgICAgICAgc3RhdGUsXG4gICAgICAgIHJlZGlyZWN0VVJJLFxuICAgICAgICBsb2dpbkhpbnQsXG4gICAgICAgIHByb21wdDogb3B0aW9ucy5wcm9tcHRcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZTogYXN5bmMgKHsgY29kZSwgcmVkaXJlY3RVUkkgfSkgPT4ge1xuICAgICAgcmV0dXJuIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGUoe1xuICAgICAgICBjb2RlLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgdG9rZW5FbmRwb2ludFxuICAgICAgfSk7XG4gICAgfSxcbiAgICByZWZyZXNoQWNjZXNzVG9rZW46IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuID8gb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gOiBhc3luYyAocmVmcmVzaFRva2VuKSA9PiB7XG4gICAgICByZXR1cm4gcmVmcmVzaEFjY2Vzc1Rva2VuKHtcbiAgICAgICAgcmVmcmVzaFRva2VuLFxuICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgY2xpZW50SWQ6IG9wdGlvbnMuY2xpZW50SWQsXG4gICAgICAgICAgY2xpZW50S2V5OiBvcHRpb25zLmNsaWVudEtleSxcbiAgICAgICAgICBjbGllbnRTZWNyZXQ6IG9wdGlvbnMuY2xpZW50U2VjcmV0XG4gICAgICAgIH0sXG4gICAgICAgIHRva2VuRW5kcG9pbnQ6IFwiaHR0cHM6Ly9naXRodWIuY29tL2xvZ2luL29hdXRoL2FjY2Vzc190b2tlblwiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIGFzeW5jIGdldFVzZXJJbmZvKHRva2VuKSB7XG4gICAgICBpZiAob3B0aW9ucy5nZXRVc2VySW5mbykge1xuICAgICAgICByZXR1cm4gb3B0aW9ucy5nZXRVc2VySW5mbyh0b2tlbik7XG4gICAgICB9XG4gICAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUsIGVycm9yIH0gPSBhd2FpdCBiZXR0ZXJGZXRjaChcbiAgICAgICAgXCJodHRwczovL2FwaS5naXRodWIuY29tL3VzZXJcIixcbiAgICAgICAge1xuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIFwiVXNlci1BZ2VudFwiOiBcImJldHRlci1hdXRoXCIsXG4gICAgICAgICAgICBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW4uYWNjZXNzVG9rZW59YFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgZGF0YTogZW1haWxzIH0gPSBhd2FpdCBiZXR0ZXJGZXRjaChcImh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vdXNlci9lbWFpbHNcIiwge1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VuLmFjY2Vzc1Rva2VufWAsXG4gICAgICAgICAgXCJVc2VyLUFnZW50XCI6IFwiYmV0dGVyLWF1dGhcIlxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGlmICghcHJvZmlsZS5lbWFpbCAmJiBlbWFpbHMpIHtcbiAgICAgICAgcHJvZmlsZS5lbWFpbCA9IChlbWFpbHMuZmluZCgoZSkgPT4gZS5wcmltYXJ5KSA/PyBlbWFpbHNbMF0pPy5lbWFpbDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGVtYWlsVmVyaWZpZWQgPSBlbWFpbHM/LmZpbmQoKGUpID0+IGUuZW1haWwgPT09IHByb2ZpbGUuZW1haWwpPy52ZXJpZmllZCA/PyBmYWxzZTtcbiAgICAgIGNvbnN0IHVzZXJNYXAgPSBhd2FpdCBvcHRpb25zLm1hcFByb2ZpbGVUb1VzZXI/Lihwcm9maWxlKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogcHJvZmlsZS5pZC50b1N0cmluZygpLFxuICAgICAgICAgIG5hbWU6IHByb2ZpbGUubmFtZSB8fCBwcm9maWxlLmxvZ2luLFxuICAgICAgICAgIGVtYWlsOiBwcm9maWxlLmVtYWlsLFxuICAgICAgICAgIGltYWdlOiBwcm9maWxlLmF2YXRhcl91cmwsXG4gICAgICAgICAgZW1haWxWZXJpZmllZCxcbiAgICAgICAgICAuLi51c2VyTWFwXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGE6IHByb2ZpbGVcbiAgICAgIH07XG4gICAgfSxcbiAgICBvcHRpb25zXG4gIH07XG59O1xuXG5jb25zdCBnb29nbGUgPSAob3B0aW9ucykgPT4ge1xuICByZXR1cm4ge1xuICAgIGlkOiBcImdvb2dsZVwiLFxuICAgIG5hbWU6IFwiR29vZ2xlXCIsXG4gICAgYXN5bmMgY3JlYXRlQXV0aG9yaXphdGlvblVSTCh7XG4gICAgICBzdGF0ZSxcbiAgICAgIHNjb3BlcyxcbiAgICAgIGNvZGVWZXJpZmllcixcbiAgICAgIHJlZGlyZWN0VVJJLFxuICAgICAgbG9naW5IaW50LFxuICAgICAgZGlzcGxheVxuICAgIH0pIHtcbiAgICAgIGlmICghb3B0aW9ucy5jbGllbnRJZCB8fCAhb3B0aW9ucy5jbGllbnRTZWNyZXQpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKFxuICAgICAgICAgIFwiQ2xpZW50IElkIGFuZCBDbGllbnQgU2VjcmV0IGlzIHJlcXVpcmVkIGZvciBHb29nbGUuIE1ha2Ugc3VyZSB0byBwcm92aWRlIHRoZW0gaW4gdGhlIG9wdGlvbnMuXCJcbiAgICAgICAgKTtcbiAgICAgICAgdGhyb3cgbmV3IEJldHRlckF1dGhFcnJvcihcIkNMSUVOVF9JRF9BTkRfU0VDUkVUX1JFUVVJUkVEXCIpO1xuICAgICAgfVxuICAgICAgaWYgKCFjb2RlVmVyaWZpZXIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEJldHRlckF1dGhFcnJvcihcImNvZGVWZXJpZmllciBpcyByZXF1aXJlZCBmb3IgR29vZ2xlXCIpO1xuICAgICAgfVxuICAgICAgY29uc3QgX3Njb3BlcyA9IG9wdGlvbnMuZGlzYWJsZURlZmF1bHRTY29wZSA/IFtdIDogW1wiZW1haWxcIiwgXCJwcm9maWxlXCIsIFwib3BlbmlkXCJdO1xuICAgICAgb3B0aW9ucy5zY29wZSAmJiBfc2NvcGVzLnB1c2goLi4ub3B0aW9ucy5zY29wZSk7XG4gICAgICBzY29wZXMgJiYgX3Njb3Blcy5wdXNoKC4uLnNjb3Blcyk7XG4gICAgICBpZiAob3B0aW9ucy5wcm9tcHQgPT09IFwic2VsZWN0X2FjY291bnQrY29uc2VudFwiKVxuICAgICAgICBvcHRpb25zLnByb21wdCA9IFwic2VsZWN0X2FjY291bnQgY29uc2VudFwiO1xuICAgICAgY29uc3QgdXJsID0gYXdhaXQgY3JlYXRlQXV0aG9yaXphdGlvblVSTCh7XG4gICAgICAgIGlkOiBcImdvb2dsZVwiLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQ6IFwiaHR0cHM6Ly9hY2NvdW50cy5nb29nbGUuY29tL28vb2F1dGgyL2F1dGhcIixcbiAgICAgICAgc2NvcGVzOiBfc2NvcGVzLFxuICAgICAgICBzdGF0ZSxcbiAgICAgICAgY29kZVZlcmlmaWVyLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgcHJvbXB0OiBvcHRpb25zLnByb21wdCxcbiAgICAgICAgYWNjZXNzVHlwZTogb3B0aW9ucy5hY2Nlc3NUeXBlLFxuICAgICAgICBkaXNwbGF5OiBkaXNwbGF5IHx8IG9wdGlvbnMuZGlzcGxheSxcbiAgICAgICAgbG9naW5IaW50LFxuICAgICAgICBoZDogb3B0aW9ucy5oZCxcbiAgICAgICAgYWRkaXRpb25hbFBhcmFtczoge1xuICAgICAgICAgIGluY2x1ZGVfZ3JhbnRlZF9zY29wZXM6IFwidHJ1ZVwiXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHVybDtcbiAgICB9LFxuICAgIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGU6IGFzeW5jICh7IGNvZGUsIGNvZGVWZXJpZmllciwgcmVkaXJlY3RVUkkgfSkgPT4ge1xuICAgICAgcmV0dXJuIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGUoe1xuICAgICAgICBjb2RlLFxuICAgICAgICBjb2RlVmVyaWZpZXIsXG4gICAgICAgIHJlZGlyZWN0VVJJLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICB0b2tlbkVuZHBvaW50OiBcImh0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuXCJcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgcmVmcmVzaEFjY2Vzc1Rva2VuOiBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA/IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuIDogYXN5bmMgKHJlZnJlc2hUb2tlbikgPT4ge1xuICAgICAgcmV0dXJuIHJlZnJlc2hBY2Nlc3NUb2tlbih7XG4gICAgICAgIHJlZnJlc2hUb2tlbixcbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgIGNsaWVudElkOiBvcHRpb25zLmNsaWVudElkLFxuICAgICAgICAgIGNsaWVudEtleTogb3B0aW9ucy5jbGllbnRLZXksXG4gICAgICAgICAgY2xpZW50U2VjcmV0OiBvcHRpb25zLmNsaWVudFNlY3JldFxuICAgICAgICB9LFxuICAgICAgICB0b2tlbkVuZHBvaW50OiBcImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92NC90b2tlblwiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIGFzeW5jIHZlcmlmeUlkVG9rZW4odG9rZW4sIG5vbmNlKSB7XG4gICAgICBpZiAob3B0aW9ucy5kaXNhYmxlSWRUb2tlblNpZ25Jbikge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy52ZXJpZnlJZFRva2VuKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLnZlcmlmeUlkVG9rZW4odG9rZW4sIG5vbmNlKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGdvb2dsZVB1YmxpY0tleVVybCA9IGBodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9vYXV0aDIvdjMvdG9rZW5pbmZvP2lkX3Rva2VuPSR7dG9rZW59YDtcbiAgICAgIGNvbnN0IHsgZGF0YTogdG9rZW5JbmZvIH0gPSBhd2FpdCBiZXR0ZXJGZXRjaChnb29nbGVQdWJsaWNLZXlVcmwpO1xuICAgICAgaWYgKCF0b2tlbkluZm8pIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgY29uc3QgaXNWYWxpZCA9IHRva2VuSW5mby5hdWQgPT09IG9wdGlvbnMuY2xpZW50SWQgJiYgKHRva2VuSW5mby5pc3MgPT09IFwiaHR0cHM6Ly9hY2NvdW50cy5nb29nbGUuY29tXCIgfHwgdG9rZW5JbmZvLmlzcyA9PT0gXCJhY2NvdW50cy5nb29nbGUuY29tXCIpO1xuICAgICAgcmV0dXJuIGlzVmFsaWQ7XG4gICAgfSxcbiAgICBhc3luYyBnZXRVc2VySW5mbyh0b2tlbikge1xuICAgICAgaWYgKG9wdGlvbnMuZ2V0VXNlckluZm8pIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMuZ2V0VXNlckluZm8odG9rZW4pO1xuICAgICAgfVxuICAgICAgaWYgKCF0b2tlbi5pZFRva2VuKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgdXNlciA9IGRlY29kZUp3dCh0b2tlbi5pZFRva2VuKTtcbiAgICAgIGNvbnN0IHVzZXJNYXAgPSBhd2FpdCBvcHRpb25zLm1hcFByb2ZpbGVUb1VzZXI/Lih1c2VyKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogdXNlci5zdWIsXG4gICAgICAgICAgbmFtZTogdXNlci5uYW1lLFxuICAgICAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxuICAgICAgICAgIGltYWdlOiB1c2VyLnBpY3R1cmUsXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogdXNlci5lbWFpbF92ZXJpZmllZCxcbiAgICAgICAgICAuLi51c2VyTWFwXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGE6IHVzZXJcbiAgICAgIH07XG4gICAgfSxcbiAgICBvcHRpb25zXG4gIH07XG59O1xuXG5jb25zdCBraWNrID0gKG9wdGlvbnMpID0+IHtcbiAgcmV0dXJuIHtcbiAgICBpZDogXCJraWNrXCIsXG4gICAgbmFtZTogXCJLaWNrXCIsXG4gICAgY3JlYXRlQXV0aG9yaXphdGlvblVSTCh7IHN0YXRlLCBzY29wZXMsIHJlZGlyZWN0VVJJLCBjb2RlVmVyaWZpZXIgfSkge1xuICAgICAgY29uc3QgX3Njb3BlcyA9IG9wdGlvbnMuZGlzYWJsZURlZmF1bHRTY29wZSA/IFtdIDogW1widXNlcjpyZWFkXCJdO1xuICAgICAgb3B0aW9ucy5zY29wZSAmJiBfc2NvcGVzLnB1c2goLi4ub3B0aW9ucy5zY29wZSk7XG4gICAgICBzY29wZXMgJiYgX3Njb3Blcy5wdXNoKC4uLnNjb3Blcyk7XG4gICAgICByZXR1cm4gY3JlYXRlQXV0aG9yaXphdGlvblVSTCh7XG4gICAgICAgIGlkOiBcImtpY2tcIixcbiAgICAgICAgcmVkaXJlY3RVUkksXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIGF1dGhvcml6YXRpb25FbmRwb2ludDogXCJodHRwczovL2lkLmtpY2suY29tL29hdXRoL2F1dGhvcml6ZVwiLFxuICAgICAgICBzY29wZXM6IF9zY29wZXMsXG4gICAgICAgIGNvZGVWZXJpZmllcixcbiAgICAgICAgc3RhdGVcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgYXN5bmMgdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZSh7IGNvZGUsIHJlZGlyZWN0VVJJLCBjb2RlVmVyaWZpZXIgfSkge1xuICAgICAgcmV0dXJuIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGUoe1xuICAgICAgICBjb2RlLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL2lkLmtpY2suY29tL29hdXRoL3Rva2VuXCIsXG4gICAgICAgIGNvZGVWZXJpZmllclxuICAgICAgfSk7XG4gICAgfSxcbiAgICBhc3luYyBnZXRVc2VySW5mbyh0b2tlbikge1xuICAgICAgaWYgKG9wdGlvbnMuZ2V0VXNlckluZm8pIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMuZ2V0VXNlckluZm8odG9rZW4pO1xuICAgICAgfVxuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgYmV0dGVyRmV0Y2goXCJodHRwczovL2FwaS5raWNrLmNvbS9wdWJsaWMvdjEvdXNlcnNcIiwge1xuICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW4uYWNjZXNzVG9rZW59YFxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHByb2ZpbGUgPSBkYXRhLmRhdGFbMF07XG4gICAgICBjb25zdCB1c2VyTWFwID0gYXdhaXQgb3B0aW9ucy5tYXBQcm9maWxlVG9Vc2VyPy4ocHJvZmlsZSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IHByb2ZpbGUudXNlcl9pZCxcbiAgICAgICAgICBuYW1lOiBwcm9maWxlLm5hbWUsXG4gICAgICAgICAgZW1haWw6IHByb2ZpbGUuZW1haWwsXG4gICAgICAgICAgaW1hZ2U6IHByb2ZpbGUucHJvZmlsZV9waWN0dXJlLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IHRydWUsXG4gICAgICAgICAgLi4udXNlck1hcFxuICAgICAgICB9LFxuICAgICAgICBkYXRhOiBwcm9maWxlXG4gICAgICB9O1xuICAgIH0sXG4gICAgb3B0aW9uc1xuICB9O1xufTtcblxuY29uc3QgaHVnZ2luZ2ZhY2UgPSAob3B0aW9ucykgPT4ge1xuICByZXR1cm4ge1xuICAgIGlkOiBcImh1Z2dpbmdmYWNlXCIsXG4gICAgbmFtZTogXCJIdWdnaW5nIEZhY2VcIixcbiAgICBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHsgc3RhdGUsIHNjb3BlcywgY29kZVZlcmlmaWVyLCByZWRpcmVjdFVSSSB9KSB7XG4gICAgICBjb25zdCBfc2NvcGVzID0gb3B0aW9ucy5kaXNhYmxlRGVmYXVsdFNjb3BlID8gW10gOiBbXCJvcGVuaWRcIiwgXCJwcm9maWxlXCIsIFwiZW1haWxcIl07XG4gICAgICBvcHRpb25zLnNjb3BlICYmIF9zY29wZXMucHVzaCguLi5vcHRpb25zLnNjb3BlKTtcbiAgICAgIHNjb3BlcyAmJiBfc2NvcGVzLnB1c2goLi4uc2NvcGVzKTtcbiAgICAgIHJldHVybiBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHtcbiAgICAgICAgaWQ6IFwiaHVnZ2luZ2ZhY2VcIixcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgYXV0aG9yaXphdGlvbkVuZHBvaW50OiBcImh0dHBzOi8vaHVnZ2luZ2ZhY2UuY28vb2F1dGgvYXV0aG9yaXplXCIsXG4gICAgICAgIHNjb3BlczogX3Njb3BlcyxcbiAgICAgICAgc3RhdGUsXG4gICAgICAgIGNvZGVWZXJpZmllcixcbiAgICAgICAgcmVkaXJlY3RVUklcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZTogYXN5bmMgKHsgY29kZSwgY29kZVZlcmlmaWVyLCByZWRpcmVjdFVSSSB9KSA9PiB7XG4gICAgICByZXR1cm4gdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZSh7XG4gICAgICAgIGNvZGUsXG4gICAgICAgIGNvZGVWZXJpZmllcixcbiAgICAgICAgcmVkaXJlY3RVUkksXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIHRva2VuRW5kcG9pbnQ6IFwiaHR0cHM6Ly9odWdnaW5nZmFjZS5jby9vYXV0aC90b2tlblwiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIHJlZnJlc2hBY2Nlc3NUb2tlbjogb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gPyBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA6IGFzeW5jIChyZWZyZXNoVG9rZW4pID0+IHtcbiAgICAgIHJldHVybiByZWZyZXNoQWNjZXNzVG9rZW4oe1xuICAgICAgICByZWZyZXNoVG9rZW4sXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICBjbGllbnRJZDogb3B0aW9ucy5jbGllbnRJZCxcbiAgICAgICAgICBjbGllbnRLZXk6IG9wdGlvbnMuY2xpZW50S2V5LFxuICAgICAgICAgIGNsaWVudFNlY3JldDogb3B0aW9ucy5jbGllbnRTZWNyZXRcbiAgICAgICAgfSxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL2h1Z2dpbmdmYWNlLmNvL29hdXRoL3Rva2VuXCJcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgYXN5bmMgZ2V0VXNlckluZm8odG9rZW4pIHtcbiAgICAgIGlmIChvcHRpb25zLmdldFVzZXJJbmZvKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLmdldFVzZXJJbmZvKHRva2VuKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgZGF0YTogcHJvZmlsZSwgZXJyb3IgfSA9IGF3YWl0IGJldHRlckZldGNoKFxuICAgICAgICBcImh0dHBzOi8vaHVnZ2luZ2ZhY2UuY28vb2F1dGgvdXNlcmluZm9cIixcbiAgICAgICAge1xuICAgICAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW4uYWNjZXNzVG9rZW59YFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHVzZXJNYXAgPSBhd2FpdCBvcHRpb25zLm1hcFByb2ZpbGVUb1VzZXI/Lihwcm9maWxlKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogcHJvZmlsZS5zdWIsXG4gICAgICAgICAgbmFtZTogcHJvZmlsZS5uYW1lIHx8IHByb2ZpbGUucHJlZmVycmVkX3VzZXJuYW1lLFxuICAgICAgICAgIGVtYWlsOiBwcm9maWxlLmVtYWlsLFxuICAgICAgICAgIGltYWdlOiBwcm9maWxlLnBpY3R1cmUsXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogcHJvZmlsZS5lbWFpbF92ZXJpZmllZCA/PyBmYWxzZSxcbiAgICAgICAgICAuLi51c2VyTWFwXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGE6IHByb2ZpbGVcbiAgICAgIH07XG4gICAgfSxcbiAgICBvcHRpb25zXG4gIH07XG59O1xuXG5jb25zdCBtaWNyb3NvZnQgPSAob3B0aW9ucykgPT4ge1xuICBjb25zdCB0ZW5hbnQgPSBvcHRpb25zLnRlbmFudElkIHx8IFwiY29tbW9uXCI7XG4gIGNvbnN0IGF1dGhvcml6YXRpb25FbmRwb2ludCA9IGBodHRwczovL2xvZ2luLm1pY3Jvc29mdG9ubGluZS5jb20vJHt0ZW5hbnR9L29hdXRoMi92Mi4wL2F1dGhvcml6ZWA7XG4gIGNvbnN0IHRva2VuRW5kcG9pbnQgPSBgaHR0cHM6Ly9sb2dpbi5taWNyb3NvZnRvbmxpbmUuY29tLyR7dGVuYW50fS9vYXV0aDIvdjIuMC90b2tlbmA7XG4gIHJldHVybiB7XG4gICAgaWQ6IFwibWljcm9zb2Z0XCIsXG4gICAgbmFtZTogXCJNaWNyb3NvZnQgRW50cmFJRFwiLFxuICAgIGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoZGF0YSkge1xuICAgICAgY29uc3Qgc2NvcGVzID0gb3B0aW9ucy5kaXNhYmxlRGVmYXVsdFNjb3BlID8gW10gOiBbXCJvcGVuaWRcIiwgXCJwcm9maWxlXCIsIFwiZW1haWxcIiwgXCJVc2VyLlJlYWRcIiwgXCJvZmZsaW5lX2FjY2Vzc1wiXTtcbiAgICAgIG9wdGlvbnMuc2NvcGUgJiYgc2NvcGVzLnB1c2goLi4ub3B0aW9ucy5zY29wZSk7XG4gICAgICBkYXRhLnNjb3BlcyAmJiBzY29wZXMucHVzaCguLi5kYXRhLnNjb3Blcyk7XG4gICAgICByZXR1cm4gY3JlYXRlQXV0aG9yaXphdGlvblVSTCh7XG4gICAgICAgIGlkOiBcIm1pY3Jvc29mdFwiLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQsXG4gICAgICAgIHN0YXRlOiBkYXRhLnN0YXRlLFxuICAgICAgICBjb2RlVmVyaWZpZXI6IGRhdGEuY29kZVZlcmlmaWVyLFxuICAgICAgICBzY29wZXMsXG4gICAgICAgIHJlZGlyZWN0VVJJOiBkYXRhLnJlZGlyZWN0VVJJLFxuICAgICAgICBwcm9tcHQ6IG9wdGlvbnMucHJvbXB0XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGUoeyBjb2RlLCBjb2RlVmVyaWZpZXIsIHJlZGlyZWN0VVJJIH0pIHtcbiAgICAgIHJldHVybiB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlKHtcbiAgICAgICAgY29kZSxcbiAgICAgICAgY29kZVZlcmlmaWVyLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgdG9rZW5FbmRwb2ludFxuICAgICAgfSk7XG4gICAgfSxcbiAgICBhc3luYyBnZXRVc2VySW5mbyh0b2tlbikge1xuICAgICAgaWYgKG9wdGlvbnMuZ2V0VXNlckluZm8pIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMuZ2V0VXNlckluZm8odG9rZW4pO1xuICAgICAgfVxuICAgICAgaWYgKCF0b2tlbi5pZFRva2VuKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgdXNlciA9IGRlY29kZUp3dCh0b2tlbi5pZFRva2VuKTtcbiAgICAgIGNvbnN0IHByb2ZpbGVQaG90b1NpemUgPSBvcHRpb25zLnByb2ZpbGVQaG90b1NpemUgfHwgNDg7XG4gICAgICBhd2FpdCBiZXR0ZXJGZXRjaChcbiAgICAgICAgYGh0dHBzOi8vZ3JhcGgubWljcm9zb2Z0LmNvbS92MS4wL21lL3Bob3Rvcy8ke3Byb2ZpbGVQaG90b1NpemV9eCR7cHJvZmlsZVBob3RvU2l6ZX0vJHZhbHVlYCxcbiAgICAgICAge1xuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbi5hY2Nlc3NUb2tlbn1gXG4gICAgICAgICAgfSxcbiAgICAgICAgICBhc3luYyBvblJlc3BvbnNlKGNvbnRleHQpIHtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLmRpc2FibGVQcm9maWxlUGhvdG8gfHwgIWNvbnRleHQucmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBjb250ZXh0LnJlc3BvbnNlLmNsb25lKCk7XG4gICAgICAgICAgICAgIGNvbnN0IHBpY3R1cmVCdWZmZXIgPSBhd2FpdCByZXNwb25zZS5hcnJheUJ1ZmZlcigpO1xuICAgICAgICAgICAgICBjb25zdCBwaWN0dXJlQmFzZTY0ID0gYmFzZTY0LmVuY29kZShwaWN0dXJlQnVmZmVyKTtcbiAgICAgICAgICAgICAgdXNlci5waWN0dXJlID0gYGRhdGE6aW1hZ2UvanBlZztiYXNlNjQsICR7cGljdHVyZUJhc2U2NH1gO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoXG4gICAgICAgICAgICAgICAgZSAmJiB0eXBlb2YgZSA9PT0gXCJvYmplY3RcIiAmJiBcIm5hbWVcIiBpbiBlID8gZS5uYW1lIDogXCJcIixcbiAgICAgICAgICAgICAgICBlXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgY29uc3QgdXNlck1hcCA9IGF3YWl0IG9wdGlvbnMubWFwUHJvZmlsZVRvVXNlcj8uKHVzZXIpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGlkOiB1c2VyLnN1YixcbiAgICAgICAgICBuYW1lOiB1c2VyLm5hbWUsXG4gICAgICAgICAgZW1haWw6IHVzZXIuZW1haWwsXG4gICAgICAgICAgaW1hZ2U6IHVzZXIucGljdHVyZSxcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiB0cnVlLFxuICAgICAgICAgIC4uLnVzZXJNYXBcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YTogdXNlclxuICAgICAgfTtcbiAgICB9LFxuICAgIHJlZnJlc2hBY2Nlc3NUb2tlbjogb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gPyBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA6IGFzeW5jIChyZWZyZXNoVG9rZW4pID0+IHtcbiAgICAgIGNvbnN0IHNjb3BlcyA9IG9wdGlvbnMuZGlzYWJsZURlZmF1bHRTY29wZSA/IFtdIDogW1wib3BlbmlkXCIsIFwicHJvZmlsZVwiLCBcImVtYWlsXCIsIFwiVXNlci5SZWFkXCIsIFwib2ZmbGluZV9hY2Nlc3NcIl07XG4gICAgICBvcHRpb25zLnNjb3BlICYmIHNjb3Blcy5wdXNoKC4uLm9wdGlvbnMuc2NvcGUpO1xuICAgICAgcmV0dXJuIHJlZnJlc2hBY2Nlc3NUb2tlbih7XG4gICAgICAgIHJlZnJlc2hUb2tlbixcbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgIGNsaWVudElkOiBvcHRpb25zLmNsaWVudElkLFxuICAgICAgICAgIGNsaWVudFNlY3JldDogb3B0aW9ucy5jbGllbnRTZWNyZXRcbiAgICAgICAgfSxcbiAgICAgICAgZXh0cmFQYXJhbXM6IHtcbiAgICAgICAgICBzY29wZTogc2NvcGVzLmpvaW4oXCIgXCIpXG4gICAgICAgICAgLy8gSW5jbHVkZSB0aGUgc2NvcGVzIGluIHJlcXVlc3QgdG8gbWljcm9zb2Z0XG4gICAgICAgIH0sXG4gICAgICAgIHRva2VuRW5kcG9pbnRcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgb3B0aW9uc1xuICB9O1xufTtcblxuY29uc3Qgc2xhY2sgPSAob3B0aW9ucykgPT4ge1xuICByZXR1cm4ge1xuICAgIGlkOiBcInNsYWNrXCIsXG4gICAgbmFtZTogXCJTbGFja1wiLFxuICAgIGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoeyBzdGF0ZSwgc2NvcGVzLCByZWRpcmVjdFVSSSB9KSB7XG4gICAgICBjb25zdCBfc2NvcGVzID0gb3B0aW9ucy5kaXNhYmxlRGVmYXVsdFNjb3BlID8gW10gOiBbXCJvcGVuaWRcIiwgXCJwcm9maWxlXCIsIFwiZW1haWxcIl07XG4gICAgICBzY29wZXMgJiYgX3Njb3Blcy5wdXNoKC4uLnNjb3Blcyk7XG4gICAgICBvcHRpb25zLnNjb3BlICYmIF9zY29wZXMucHVzaCguLi5vcHRpb25zLnNjb3BlKTtcbiAgICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoXCJodHRwczovL3NsYWNrLmNvbS9vcGVuaWQvY29ubmVjdC9hdXRob3JpemVcIik7XG4gICAgICB1cmwuc2VhcmNoUGFyYW1zLnNldChcInNjb3BlXCIsIF9zY29wZXMuam9pbihcIiBcIikpO1xuICAgICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJyZXNwb25zZV90eXBlXCIsIFwiY29kZVwiKTtcbiAgICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KFwiY2xpZW50X2lkXCIsIG9wdGlvbnMuY2xpZW50SWQpO1xuICAgICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJyZWRpcmVjdF91cmlcIiwgb3B0aW9ucy5yZWRpcmVjdFVSSSB8fCByZWRpcmVjdFVSSSk7XG4gICAgICB1cmwuc2VhcmNoUGFyYW1zLnNldChcInN0YXRlXCIsIHN0YXRlKTtcbiAgICAgIHJldHVybiB1cmw7XG4gICAgfSxcbiAgICB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlOiBhc3luYyAoeyBjb2RlLCByZWRpcmVjdFVSSSB9KSA9PiB7XG4gICAgICByZXR1cm4gdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZSh7XG4gICAgICAgIGNvZGUsXG4gICAgICAgIHJlZGlyZWN0VVJJLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICB0b2tlbkVuZHBvaW50OiBcImh0dHBzOi8vc2xhY2suY29tL2FwaS9vcGVuaWQuY29ubmVjdC50b2tlblwiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIHJlZnJlc2hBY2Nlc3NUb2tlbjogb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gPyBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA6IGFzeW5jIChyZWZyZXNoVG9rZW4pID0+IHtcbiAgICAgIHJldHVybiByZWZyZXNoQWNjZXNzVG9rZW4oe1xuICAgICAgICByZWZyZXNoVG9rZW4sXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICBjbGllbnRJZDogb3B0aW9ucy5jbGllbnRJZCxcbiAgICAgICAgICBjbGllbnRLZXk6IG9wdGlvbnMuY2xpZW50S2V5LFxuICAgICAgICAgIGNsaWVudFNlY3JldDogb3B0aW9ucy5jbGllbnRTZWNyZXRcbiAgICAgICAgfSxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL3NsYWNrLmNvbS9hcGkvb3BlbmlkLmNvbm5lY3QudG9rZW5cIlxuICAgICAgfSk7XG4gICAgfSxcbiAgICBhc3luYyBnZXRVc2VySW5mbyh0b2tlbikge1xuICAgICAgaWYgKG9wdGlvbnMuZ2V0VXNlckluZm8pIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMuZ2V0VXNlckluZm8odG9rZW4pO1xuICAgICAgfVxuICAgICAgY29uc3QgeyBkYXRhOiBwcm9maWxlLCBlcnJvciB9ID0gYXdhaXQgYmV0dGVyRmV0Y2goXG4gICAgICAgIFwiaHR0cHM6Ly9zbGFjay5jb20vYXBpL29wZW5pZC5jb25uZWN0LnVzZXJJbmZvXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW4uYWNjZXNzVG9rZW59YFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHVzZXJNYXAgPSBhd2FpdCBvcHRpb25zLm1hcFByb2ZpbGVUb1VzZXI/Lihwcm9maWxlKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogcHJvZmlsZVtcImh0dHBzOi8vc2xhY2suY29tL3VzZXJfaWRcIl0sXG4gICAgICAgICAgbmFtZTogcHJvZmlsZS5uYW1lIHx8IFwiXCIsXG4gICAgICAgICAgZW1haWw6IHByb2ZpbGUuZW1haWwsXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogcHJvZmlsZS5lbWFpbF92ZXJpZmllZCxcbiAgICAgICAgICBpbWFnZTogcHJvZmlsZS5waWN0dXJlIHx8IHByb2ZpbGVbXCJodHRwczovL3NsYWNrLmNvbS91c2VyX2ltYWdlXzUxMlwiXSxcbiAgICAgICAgICAuLi51c2VyTWFwXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGE6IHByb2ZpbGVcbiAgICAgIH07XG4gICAgfSxcbiAgICBvcHRpb25zXG4gIH07XG59O1xuXG5jb25zdCBub3Rpb24gPSAob3B0aW9ucykgPT4ge1xuICBjb25zdCB0b2tlbkVuZHBvaW50ID0gXCJodHRwczovL2FwaS5ub3Rpb24uY29tL3YxL29hdXRoL3Rva2VuXCI7XG4gIHJldHVybiB7XG4gICAgaWQ6IFwibm90aW9uXCIsXG4gICAgbmFtZTogXCJOb3Rpb25cIixcbiAgICBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHsgc3RhdGUsIHNjb3BlcywgbG9naW5IaW50LCByZWRpcmVjdFVSSSB9KSB7XG4gICAgICBjb25zdCBfc2NvcGVzID0gb3B0aW9ucy5kaXNhYmxlRGVmYXVsdFNjb3BlID8gW10gOiBbXTtcbiAgICAgIG9wdGlvbnMuc2NvcGUgJiYgX3Njb3Blcy5wdXNoKC4uLm9wdGlvbnMuc2NvcGUpO1xuICAgICAgc2NvcGVzICYmIF9zY29wZXMucHVzaCguLi5zY29wZXMpO1xuICAgICAgcmV0dXJuIGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoe1xuICAgICAgICBpZDogXCJub3Rpb25cIixcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgYXV0aG9yaXphdGlvbkVuZHBvaW50OiBcImh0dHBzOi8vYXBpLm5vdGlvbi5jb20vdjEvb2F1dGgvYXV0aG9yaXplXCIsXG4gICAgICAgIHNjb3BlczogX3Njb3BlcyxcbiAgICAgICAgc3RhdGUsXG4gICAgICAgIHJlZGlyZWN0VVJJLFxuICAgICAgICBsb2dpbkhpbnQsXG4gICAgICAgIGFkZGl0aW9uYWxQYXJhbXM6IHtcbiAgICAgICAgICBvd25lcjogXCJ1c2VyXCJcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSxcbiAgICB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlOiBhc3luYyAoeyBjb2RlLCByZWRpcmVjdFVSSSB9KSA9PiB7XG4gICAgICByZXR1cm4gdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZSh7XG4gICAgICAgIGNvZGUsXG4gICAgICAgIHJlZGlyZWN0VVJJLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICB0b2tlbkVuZHBvaW50LFxuICAgICAgICBhdXRoZW50aWNhdGlvbjogXCJiYXNpY1wiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIHJlZnJlc2hBY2Nlc3NUb2tlbjogb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gPyBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA6IGFzeW5jIChyZWZyZXNoVG9rZW4pID0+IHtcbiAgICAgIHJldHVybiByZWZyZXNoQWNjZXNzVG9rZW4oe1xuICAgICAgICByZWZyZXNoVG9rZW4sXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICBjbGllbnRJZDogb3B0aW9ucy5jbGllbnRJZCxcbiAgICAgICAgICBjbGllbnRLZXk6IG9wdGlvbnMuY2xpZW50S2V5LFxuICAgICAgICAgIGNsaWVudFNlY3JldDogb3B0aW9ucy5jbGllbnRTZWNyZXRcbiAgICAgICAgfSxcbiAgICAgICAgdG9rZW5FbmRwb2ludFxuICAgICAgfSk7XG4gICAgfSxcbiAgICBhc3luYyBnZXRVc2VySW5mbyh0b2tlbikge1xuICAgICAgaWYgKG9wdGlvbnMuZ2V0VXNlckluZm8pIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMuZ2V0VXNlckluZm8odG9rZW4pO1xuICAgICAgfVxuICAgICAgY29uc3QgeyBkYXRhOiBwcm9maWxlLCBlcnJvciB9ID0gYXdhaXQgYmV0dGVyRmV0Y2goXCJodHRwczovL2FwaS5ub3Rpb24uY29tL3YxL3VzZXJzL21lXCIsIHtcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbi5hY2Nlc3NUb2tlbn1gLFxuICAgICAgICAgIFwiTm90aW9uLVZlcnNpb25cIjogXCIyMDIyLTA2LTI4XCJcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBpZiAoZXJyb3IgfHwgIXByb2ZpbGUpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICBjb25zdCB1c2VyUHJvZmlsZSA9IHByb2ZpbGUuYm90Py5vd25lcj8udXNlcjtcbiAgICAgIGlmICghdXNlclByb2ZpbGUpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICBjb25zdCB1c2VyTWFwID0gYXdhaXQgb3B0aW9ucy5tYXBQcm9maWxlVG9Vc2VyPy4odXNlclByb2ZpbGUpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGlkOiB1c2VyUHJvZmlsZS5pZCxcbiAgICAgICAgICBuYW1lOiB1c2VyUHJvZmlsZS5uYW1lIHx8IFwiTm90aW9uIFVzZXJcIixcbiAgICAgICAgICBlbWFpbDogdXNlclByb2ZpbGUucGVyc29uPy5lbWFpbCB8fCBudWxsLFxuICAgICAgICAgIGltYWdlOiB1c2VyUHJvZmlsZS5hdmF0YXJfdXJsLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6ICEhdXNlclByb2ZpbGUucGVyc29uPy5lbWFpbCxcbiAgICAgICAgICAuLi51c2VyTWFwXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGE6IHVzZXJQcm9maWxlXG4gICAgICB9O1xuICAgIH0sXG4gICAgb3B0aW9uc1xuICB9O1xufTtcblxuY29uc3Qgc3BvdGlmeSA9IChvcHRpb25zKSA9PiB7XG4gIHJldHVybiB7XG4gICAgaWQ6IFwic3BvdGlmeVwiLFxuICAgIG5hbWU6IFwiU3BvdGlmeVwiLFxuICAgIGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoeyBzdGF0ZSwgc2NvcGVzLCBjb2RlVmVyaWZpZXIsIHJlZGlyZWN0VVJJIH0pIHtcbiAgICAgIGNvbnN0IF9zY29wZXMgPSBvcHRpb25zLmRpc2FibGVEZWZhdWx0U2NvcGUgPyBbXSA6IFtcInVzZXItcmVhZC1lbWFpbFwiXTtcbiAgICAgIG9wdGlvbnMuc2NvcGUgJiYgX3Njb3Blcy5wdXNoKC4uLm9wdGlvbnMuc2NvcGUpO1xuICAgICAgc2NvcGVzICYmIF9zY29wZXMucHVzaCguLi5zY29wZXMpO1xuICAgICAgcmV0dXJuIGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoe1xuICAgICAgICBpZDogXCJzcG90aWZ5XCIsXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIGF1dGhvcml6YXRpb25FbmRwb2ludDogXCJodHRwczovL2FjY291bnRzLnNwb3RpZnkuY29tL2F1dGhvcml6ZVwiLFxuICAgICAgICBzY29wZXM6IF9zY29wZXMsXG4gICAgICAgIHN0YXRlLFxuICAgICAgICBjb2RlVmVyaWZpZXIsXG4gICAgICAgIHJlZGlyZWN0VVJJXG4gICAgICB9KTtcbiAgICB9LFxuICAgIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGU6IGFzeW5jICh7IGNvZGUsIGNvZGVWZXJpZmllciwgcmVkaXJlY3RVUkkgfSkgPT4ge1xuICAgICAgcmV0dXJuIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGUoe1xuICAgICAgICBjb2RlLFxuICAgICAgICBjb2RlVmVyaWZpZXIsXG4gICAgICAgIHJlZGlyZWN0VVJJLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICB0b2tlbkVuZHBvaW50OiBcImh0dHBzOi8vYWNjb3VudHMuc3BvdGlmeS5jb20vYXBpL3Rva2VuXCJcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgcmVmcmVzaEFjY2Vzc1Rva2VuOiBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA/IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuIDogYXN5bmMgKHJlZnJlc2hUb2tlbikgPT4ge1xuICAgICAgcmV0dXJuIHJlZnJlc2hBY2Nlc3NUb2tlbih7XG4gICAgICAgIHJlZnJlc2hUb2tlbixcbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgIGNsaWVudElkOiBvcHRpb25zLmNsaWVudElkLFxuICAgICAgICAgIGNsaWVudEtleTogb3B0aW9ucy5jbGllbnRLZXksXG4gICAgICAgICAgY2xpZW50U2VjcmV0OiBvcHRpb25zLmNsaWVudFNlY3JldFxuICAgICAgICB9LFxuICAgICAgICB0b2tlbkVuZHBvaW50OiBcImh0dHBzOi8vYWNjb3VudHMuc3BvdGlmeS5jb20vYXBpL3Rva2VuXCJcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgYXN5bmMgZ2V0VXNlckluZm8odG9rZW4pIHtcbiAgICAgIGlmIChvcHRpb25zLmdldFVzZXJJbmZvKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLmdldFVzZXJJbmZvKHRva2VuKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgZGF0YTogcHJvZmlsZSwgZXJyb3IgfSA9IGF3YWl0IGJldHRlckZldGNoKFxuICAgICAgICBcImh0dHBzOi8vYXBpLnNwb3RpZnkuY29tL3YxL21lXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VuLmFjY2Vzc1Rva2VufWBcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICBjb25zdCB1c2VyTWFwID0gYXdhaXQgb3B0aW9ucy5tYXBQcm9maWxlVG9Vc2VyPy4ocHJvZmlsZSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IHByb2ZpbGUuaWQsXG4gICAgICAgICAgbmFtZTogcHJvZmlsZS5kaXNwbGF5X25hbWUsXG4gICAgICAgICAgZW1haWw6IHByb2ZpbGUuZW1haWwsXG4gICAgICAgICAgaW1hZ2U6IHByb2ZpbGUuaW1hZ2VzWzBdPy51cmwsXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogZmFsc2UsXG4gICAgICAgICAgLi4udXNlck1hcFxuICAgICAgICB9LFxuICAgICAgICBkYXRhOiBwcm9maWxlXG4gICAgICB9O1xuICAgIH0sXG4gICAgb3B0aW9uc1xuICB9O1xufTtcblxuY29uc3QgdHdpdGNoID0gKG9wdGlvbnMpID0+IHtcbiAgcmV0dXJuIHtcbiAgICBpZDogXCJ0d2l0Y2hcIixcbiAgICBuYW1lOiBcIlR3aXRjaFwiLFxuICAgIGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoeyBzdGF0ZSwgc2NvcGVzLCByZWRpcmVjdFVSSSB9KSB7XG4gICAgICBjb25zdCBfc2NvcGVzID0gb3B0aW9ucy5kaXNhYmxlRGVmYXVsdFNjb3BlID8gW10gOiBbXCJ1c2VyOnJlYWQ6ZW1haWxcIiwgXCJvcGVuaWRcIl07XG4gICAgICBvcHRpb25zLnNjb3BlICYmIF9zY29wZXMucHVzaCguLi5vcHRpb25zLnNjb3BlKTtcbiAgICAgIHNjb3BlcyAmJiBfc2NvcGVzLnB1c2goLi4uc2NvcGVzKTtcbiAgICAgIHJldHVybiBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHtcbiAgICAgICAgaWQ6IFwidHdpdGNoXCIsXG4gICAgICAgIHJlZGlyZWN0VVJJLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQ6IFwiaHR0cHM6Ly9pZC50d2l0Y2gudHYvb2F1dGgyL2F1dGhvcml6ZVwiLFxuICAgICAgICBzY29wZXM6IF9zY29wZXMsXG4gICAgICAgIHN0YXRlLFxuICAgICAgICBjbGFpbXM6IG9wdGlvbnMuY2xhaW1zIHx8IFtcbiAgICAgICAgICBcImVtYWlsXCIsXG4gICAgICAgICAgXCJlbWFpbF92ZXJpZmllZFwiLFxuICAgICAgICAgIFwicHJlZmVycmVkX3VzZXJuYW1lXCIsXG4gICAgICAgICAgXCJwaWN0dXJlXCJcbiAgICAgICAgXVxuICAgICAgfSk7XG4gICAgfSxcbiAgICB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlOiBhc3luYyAoeyBjb2RlLCByZWRpcmVjdFVSSSB9KSA9PiB7XG4gICAgICByZXR1cm4gdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZSh7XG4gICAgICAgIGNvZGUsXG4gICAgICAgIHJlZGlyZWN0VVJJLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICB0b2tlbkVuZHBvaW50OiBcImh0dHBzOi8vaWQudHdpdGNoLnR2L29hdXRoMi90b2tlblwiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIHJlZnJlc2hBY2Nlc3NUb2tlbjogb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gPyBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA6IGFzeW5jIChyZWZyZXNoVG9rZW4pID0+IHtcbiAgICAgIHJldHVybiByZWZyZXNoQWNjZXNzVG9rZW4oe1xuICAgICAgICByZWZyZXNoVG9rZW4sXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICBjbGllbnRJZDogb3B0aW9ucy5jbGllbnRJZCxcbiAgICAgICAgICBjbGllbnRLZXk6IG9wdGlvbnMuY2xpZW50S2V5LFxuICAgICAgICAgIGNsaWVudFNlY3JldDogb3B0aW9ucy5jbGllbnRTZWNyZXRcbiAgICAgICAgfSxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL2lkLnR3aXRjaC50di9vYXV0aDIvdG9rZW5cIlxuICAgICAgfSk7XG4gICAgfSxcbiAgICBhc3luYyBnZXRVc2VySW5mbyh0b2tlbikge1xuICAgICAgaWYgKG9wdGlvbnMuZ2V0VXNlckluZm8pIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMuZ2V0VXNlckluZm8odG9rZW4pO1xuICAgICAgfVxuICAgICAgY29uc3QgaWRUb2tlbiA9IHRva2VuLmlkVG9rZW47XG4gICAgICBpZiAoIWlkVG9rZW4pIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKFwiTm8gaWRUb2tlbiBmb3VuZCBpbiB0b2tlblwiKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICBjb25zdCBwcm9maWxlID0gZGVjb2RlSnd0KGlkVG9rZW4pO1xuICAgICAgY29uc3QgdXNlck1hcCA9IGF3YWl0IG9wdGlvbnMubWFwUHJvZmlsZVRvVXNlcj8uKHByb2ZpbGUpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGlkOiBwcm9maWxlLnN1YixcbiAgICAgICAgICBuYW1lOiBwcm9maWxlLnByZWZlcnJlZF91c2VybmFtZSxcbiAgICAgICAgICBlbWFpbDogcHJvZmlsZS5lbWFpbCxcbiAgICAgICAgICBpbWFnZTogcHJvZmlsZS5waWN0dXJlLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IHByb2ZpbGUuZW1haWxfdmVyaWZpZWQsXG4gICAgICAgICAgLi4udXNlck1hcFxuICAgICAgICB9LFxuICAgICAgICBkYXRhOiBwcm9maWxlXG4gICAgICB9O1xuICAgIH0sXG4gICAgb3B0aW9uc1xuICB9O1xufTtcblxuY29uc3QgdHdpdHRlciA9IChvcHRpb25zKSA9PiB7XG4gIHJldHVybiB7XG4gICAgaWQ6IFwidHdpdHRlclwiLFxuICAgIG5hbWU6IFwiVHdpdHRlclwiLFxuICAgIGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoZGF0YSkge1xuICAgICAgY29uc3QgX3Njb3BlcyA9IG9wdGlvbnMuZGlzYWJsZURlZmF1bHRTY29wZSA/IFtdIDogW1widXNlcnMucmVhZFwiLCBcInR3ZWV0LnJlYWRcIiwgXCJvZmZsaW5lLmFjY2Vzc1wiLCBcInVzZXJzLmVtYWlsXCJdO1xuICAgICAgb3B0aW9ucy5zY29wZSAmJiBfc2NvcGVzLnB1c2goLi4ub3B0aW9ucy5zY29wZSk7XG4gICAgICBkYXRhLnNjb3BlcyAmJiBfc2NvcGVzLnB1c2goLi4uZGF0YS5zY29wZXMpO1xuICAgICAgcmV0dXJuIGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoe1xuICAgICAgICBpZDogXCJ0d2l0dGVyXCIsXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIGF1dGhvcml6YXRpb25FbmRwb2ludDogXCJodHRwczovL3guY29tL2kvb2F1dGgyL2F1dGhvcml6ZVwiLFxuICAgICAgICBzY29wZXM6IF9zY29wZXMsXG4gICAgICAgIHN0YXRlOiBkYXRhLnN0YXRlLFxuICAgICAgICBjb2RlVmVyaWZpZXI6IGRhdGEuY29kZVZlcmlmaWVyLFxuICAgICAgICByZWRpcmVjdFVSSTogZGF0YS5yZWRpcmVjdFVSSVxuICAgICAgfSk7XG4gICAgfSxcbiAgICB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlOiBhc3luYyAoeyBjb2RlLCBjb2RlVmVyaWZpZXIsIHJlZGlyZWN0VVJJIH0pID0+IHtcbiAgICAgIHJldHVybiB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlKHtcbiAgICAgICAgY29kZSxcbiAgICAgICAgY29kZVZlcmlmaWVyLFxuICAgICAgICBhdXRoZW50aWNhdGlvbjogXCJiYXNpY1wiLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL2FwaS54LmNvbS8yL29hdXRoMi90b2tlblwiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIHJlZnJlc2hBY2Nlc3NUb2tlbjogb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gPyBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA6IGFzeW5jIChyZWZyZXNoVG9rZW4pID0+IHtcbiAgICAgIHJldHVybiByZWZyZXNoQWNjZXNzVG9rZW4oe1xuICAgICAgICByZWZyZXNoVG9rZW4sXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICBjbGllbnRJZDogb3B0aW9ucy5jbGllbnRJZCxcbiAgICAgICAgICBjbGllbnRLZXk6IG9wdGlvbnMuY2xpZW50S2V5LFxuICAgICAgICAgIGNsaWVudFNlY3JldDogb3B0aW9ucy5jbGllbnRTZWNyZXRcbiAgICAgICAgfSxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL2FwaS54LmNvbS8yL29hdXRoMi90b2tlblwiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIGFzeW5jIGdldFVzZXJJbmZvKHRva2VuKSB7XG4gICAgICBpZiAob3B0aW9ucy5nZXRVc2VySW5mbykge1xuICAgICAgICByZXR1cm4gb3B0aW9ucy5nZXRVc2VySW5mbyh0b2tlbik7XG4gICAgICB9XG4gICAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUsIGVycm9yOiBwcm9maWxlRXJyb3IgfSA9IGF3YWl0IGJldHRlckZldGNoKFxuICAgICAgICBcImh0dHBzOi8vYXBpLnguY29tLzIvdXNlcnMvbWU/dXNlci5maWVsZHM9cHJvZmlsZV9pbWFnZV91cmxcIixcbiAgICAgICAge1xuICAgICAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW4uYWNjZXNzVG9rZW59YFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIGlmIChwcm9maWxlRXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICBjb25zdCB7IGRhdGE6IGVtYWlsRGF0YSwgZXJyb3I6IGVtYWlsRXJyb3IgfSA9IGF3YWl0IGJldHRlckZldGNoKFwiaHR0cHM6Ly9hcGkueC5jb20vMi91c2Vycy9tZT91c2VyLmZpZWxkcz1jb25maXJtZWRfZW1haWxcIiwge1xuICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW4uYWNjZXNzVG9rZW59YFxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGxldCBlbWFpbFZlcmlmaWVkID0gZmFsc2U7XG4gICAgICBpZiAoIWVtYWlsRXJyb3IgJiYgZW1haWxEYXRhPy5kYXRhPy5jb25maXJtZWRfZW1haWwpIHtcbiAgICAgICAgcHJvZmlsZS5kYXRhLmVtYWlsID0gZW1haWxEYXRhLmRhdGEuY29uZmlybWVkX2VtYWlsO1xuICAgICAgICBlbWFpbFZlcmlmaWVkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHVzZXJNYXAgPSBhd2FpdCBvcHRpb25zLm1hcFByb2ZpbGVUb1VzZXI/Lihwcm9maWxlKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogcHJvZmlsZS5kYXRhLmlkLFxuICAgICAgICAgIG5hbWU6IHByb2ZpbGUuZGF0YS5uYW1lLFxuICAgICAgICAgIGVtYWlsOiBwcm9maWxlLmRhdGEuZW1haWwgfHwgcHJvZmlsZS5kYXRhLnVzZXJuYW1lIHx8IG51bGwsXG4gICAgICAgICAgaW1hZ2U6IHByb2ZpbGUuZGF0YS5wcm9maWxlX2ltYWdlX3VybCxcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkLFxuICAgICAgICAgIC4uLnVzZXJNYXBcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YTogcHJvZmlsZVxuICAgICAgfTtcbiAgICB9LFxuICAgIG9wdGlvbnNcbiAgfTtcbn07XG5cbmNvbnN0IGRyb3Bib3ggPSAob3B0aW9ucykgPT4ge1xuICBjb25zdCB0b2tlbkVuZHBvaW50ID0gXCJodHRwczovL2FwaS5kcm9wYm94YXBpLmNvbS9vYXV0aDIvdG9rZW5cIjtcbiAgcmV0dXJuIHtcbiAgICBpZDogXCJkcm9wYm94XCIsXG4gICAgbmFtZTogXCJEcm9wYm94XCIsXG4gICAgY3JlYXRlQXV0aG9yaXphdGlvblVSTDogYXN5bmMgKHtcbiAgICAgIHN0YXRlLFxuICAgICAgc2NvcGVzLFxuICAgICAgY29kZVZlcmlmaWVyLFxuICAgICAgcmVkaXJlY3RVUklcbiAgICB9KSA9PiB7XG4gICAgICBjb25zdCBfc2NvcGVzID0gb3B0aW9ucy5kaXNhYmxlRGVmYXVsdFNjb3BlID8gW10gOiBbXCJhY2NvdW50X2luZm8ucmVhZFwiXTtcbiAgICAgIG9wdGlvbnMuc2NvcGUgJiYgX3Njb3Blcy5wdXNoKC4uLm9wdGlvbnMuc2NvcGUpO1xuICAgICAgc2NvcGVzICYmIF9zY29wZXMucHVzaCguLi5zY29wZXMpO1xuICAgICAgY29uc3QgYWRkaXRpb25hbFBhcmFtcyA9IHt9O1xuICAgICAgaWYgKG9wdGlvbnMuYWNjZXNzVHlwZSkge1xuICAgICAgICBhZGRpdGlvbmFsUGFyYW1zLnRva2VuX2FjY2Vzc190eXBlID0gb3B0aW9ucy5hY2Nlc3NUeXBlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGF3YWl0IGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoe1xuICAgICAgICBpZDogXCJkcm9wYm94XCIsXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIGF1dGhvcml6YXRpb25FbmRwb2ludDogXCJodHRwczovL3d3dy5kcm9wYm94LmNvbS9vYXV0aDIvYXV0aG9yaXplXCIsXG4gICAgICAgIHNjb3BlczogX3Njb3BlcyxcbiAgICAgICAgc3RhdGUsXG4gICAgICAgIHJlZGlyZWN0VVJJLFxuICAgICAgICBjb2RlVmVyaWZpZXIsXG4gICAgICAgIGFkZGl0aW9uYWxQYXJhbXNcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZTogYXN5bmMgKHsgY29kZSwgY29kZVZlcmlmaWVyLCByZWRpcmVjdFVSSSB9KSA9PiB7XG4gICAgICByZXR1cm4gYXdhaXQgdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZSh7XG4gICAgICAgIGNvZGUsXG4gICAgICAgIGNvZGVWZXJpZmllcixcbiAgICAgICAgcmVkaXJlY3RVUkksXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIHRva2VuRW5kcG9pbnRcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgcmVmcmVzaEFjY2Vzc1Rva2VuOiBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA/IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuIDogYXN5bmMgKHJlZnJlc2hUb2tlbikgPT4ge1xuICAgICAgcmV0dXJuIHJlZnJlc2hBY2Nlc3NUb2tlbih7XG4gICAgICAgIHJlZnJlc2hUb2tlbixcbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgIGNsaWVudElkOiBvcHRpb25zLmNsaWVudElkLFxuICAgICAgICAgIGNsaWVudEtleTogb3B0aW9ucy5jbGllbnRLZXksXG4gICAgICAgICAgY2xpZW50U2VjcmV0OiBvcHRpb25zLmNsaWVudFNlY3JldFxuICAgICAgICB9LFxuICAgICAgICB0b2tlbkVuZHBvaW50OiBcImh0dHBzOi8vYXBpLmRyb3Bib3guY29tL29hdXRoMi90b2tlblwiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIGFzeW5jIGdldFVzZXJJbmZvKHRva2VuKSB7XG4gICAgICBpZiAob3B0aW9ucy5nZXRVc2VySW5mbykge1xuICAgICAgICByZXR1cm4gb3B0aW9ucy5nZXRVc2VySW5mbyh0b2tlbik7XG4gICAgICB9XG4gICAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUsIGVycm9yIH0gPSBhd2FpdCBiZXR0ZXJGZXRjaChcbiAgICAgICAgXCJodHRwczovL2FwaS5kcm9wYm94YXBpLmNvbS8yL3VzZXJzL2dldF9jdXJyZW50X2FjY291bnRcIixcbiAgICAgICAge1xuICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VuLmFjY2Vzc1Rva2VufWBcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICBjb25zdCB1c2VyTWFwID0gYXdhaXQgb3B0aW9ucy5tYXBQcm9maWxlVG9Vc2VyPy4ocHJvZmlsZSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IHByb2ZpbGUuYWNjb3VudF9pZCxcbiAgICAgICAgICBuYW1lOiBwcm9maWxlLm5hbWU/LmRpc3BsYXlfbmFtZSxcbiAgICAgICAgICBlbWFpbDogcHJvZmlsZS5lbWFpbCxcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiBwcm9maWxlLmVtYWlsX3ZlcmlmaWVkIHx8IGZhbHNlLFxuICAgICAgICAgIGltYWdlOiBwcm9maWxlLnByb2ZpbGVfcGhvdG9fdXJsLFxuICAgICAgICAgIC4uLnVzZXJNYXBcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YTogcHJvZmlsZVxuICAgICAgfTtcbiAgICB9LFxuICAgIG9wdGlvbnNcbiAgfTtcbn07XG5cbmNvbnN0IGxpbmVhciA9IChvcHRpb25zKSA9PiB7XG4gIGNvbnN0IHRva2VuRW5kcG9pbnQgPSBcImh0dHBzOi8vYXBpLmxpbmVhci5hcHAvb2F1dGgvdG9rZW5cIjtcbiAgcmV0dXJuIHtcbiAgICBpZDogXCJsaW5lYXJcIixcbiAgICBuYW1lOiBcIkxpbmVhclwiLFxuICAgIGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoeyBzdGF0ZSwgc2NvcGVzLCBsb2dpbkhpbnQsIHJlZGlyZWN0VVJJIH0pIHtcbiAgICAgIGNvbnN0IF9zY29wZXMgPSBvcHRpb25zLmRpc2FibGVEZWZhdWx0U2NvcGUgPyBbXSA6IFtcInJlYWRcIl07XG4gICAgICBvcHRpb25zLnNjb3BlICYmIF9zY29wZXMucHVzaCguLi5vcHRpb25zLnNjb3BlKTtcbiAgICAgIHNjb3BlcyAmJiBfc2NvcGVzLnB1c2goLi4uc2NvcGVzKTtcbiAgICAgIHJldHVybiBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHtcbiAgICAgICAgaWQ6IFwibGluZWFyXCIsXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIGF1dGhvcml6YXRpb25FbmRwb2ludDogXCJodHRwczovL2xpbmVhci5hcHAvb2F1dGgvYXV0aG9yaXplXCIsXG4gICAgICAgIHNjb3BlczogX3Njb3BlcyxcbiAgICAgICAgc3RhdGUsXG4gICAgICAgIHJlZGlyZWN0VVJJLFxuICAgICAgICBsb2dpbkhpbnRcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZTogYXN5bmMgKHsgY29kZSwgcmVkaXJlY3RVUkkgfSkgPT4ge1xuICAgICAgcmV0dXJuIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGUoe1xuICAgICAgICBjb2RlLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgdG9rZW5FbmRwb2ludFxuICAgICAgfSk7XG4gICAgfSxcbiAgICByZWZyZXNoQWNjZXNzVG9rZW46IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuID8gb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gOiBhc3luYyAocmVmcmVzaFRva2VuKSA9PiB7XG4gICAgICByZXR1cm4gcmVmcmVzaEFjY2Vzc1Rva2VuKHtcbiAgICAgICAgcmVmcmVzaFRva2VuLFxuICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgY2xpZW50SWQ6IG9wdGlvbnMuY2xpZW50SWQsXG4gICAgICAgICAgY2xpZW50S2V5OiBvcHRpb25zLmNsaWVudEtleSxcbiAgICAgICAgICBjbGllbnRTZWNyZXQ6IG9wdGlvbnMuY2xpZW50U2VjcmV0XG4gICAgICAgIH0sXG4gICAgICAgIHRva2VuRW5kcG9pbnRcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgYXN5bmMgZ2V0VXNlckluZm8odG9rZW4pIHtcbiAgICAgIGlmIChvcHRpb25zLmdldFVzZXJJbmZvKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLmdldFVzZXJJbmZvKHRva2VuKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgZGF0YTogcHJvZmlsZSwgZXJyb3IgfSA9IGF3YWl0IGJldHRlckZldGNoKFxuICAgICAgICBcImh0dHBzOi8vYXBpLmxpbmVhci5hcHAvZ3JhcGhxbFwiLFxuICAgICAgICB7XG4gICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbi5hY2Nlc3NUb2tlbn1gXG4gICAgICAgICAgfSxcbiAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICBxdWVyeTogYFxuXHRcdFx0XHRcdFx0XHRxdWVyeSB7XG5cdFx0XHRcdFx0XHRcdFx0dmlld2VyIHtcblx0XHRcdFx0XHRcdFx0XHRcdGlkXG5cdFx0XHRcdFx0XHRcdFx0XHRuYW1lXG5cdFx0XHRcdFx0XHRcdFx0XHRlbWFpbFxuXHRcdFx0XHRcdFx0XHRcdFx0YXZhdGFyVXJsXG5cdFx0XHRcdFx0XHRcdFx0XHRhY3RpdmVcblx0XHRcdFx0XHRcdFx0XHRcdGNyZWF0ZWRBdFxuXHRcdFx0XHRcdFx0XHRcdFx0dXBkYXRlZEF0XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRgXG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIGlmIChlcnJvciB8fCAhcHJvZmlsZT8uZGF0YT8udmlld2VyKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgdXNlckRhdGEgPSBwcm9maWxlLmRhdGEudmlld2VyO1xuICAgICAgY29uc3QgdXNlck1hcCA9IGF3YWl0IG9wdGlvbnMubWFwUHJvZmlsZVRvVXNlcj8uKHVzZXJEYXRhKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogcHJvZmlsZS5kYXRhLnZpZXdlci5pZCxcbiAgICAgICAgICBuYW1lOiBwcm9maWxlLmRhdGEudmlld2VyLm5hbWUsXG4gICAgICAgICAgZW1haWw6IHByb2ZpbGUuZGF0YS52aWV3ZXIuZW1haWwsXG4gICAgICAgICAgaW1hZ2U6IHByb2ZpbGUuZGF0YS52aWV3ZXIuYXZhdGFyVXJsLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IHRydWUsXG4gICAgICAgICAgLi4udXNlck1hcFxuICAgICAgICB9LFxuICAgICAgICBkYXRhOiB1c2VyRGF0YVxuICAgICAgfTtcbiAgICB9LFxuICAgIG9wdGlvbnNcbiAgfTtcbn07XG5cbmNvbnN0IGxpbmtlZGluID0gKG9wdGlvbnMpID0+IHtcbiAgY29uc3QgYXV0aG9yaXphdGlvbkVuZHBvaW50ID0gXCJodHRwczovL3d3dy5saW5rZWRpbi5jb20vb2F1dGgvdjIvYXV0aG9yaXphdGlvblwiO1xuICBjb25zdCB0b2tlbkVuZHBvaW50ID0gXCJodHRwczovL3d3dy5saW5rZWRpbi5jb20vb2F1dGgvdjIvYWNjZXNzVG9rZW5cIjtcbiAgcmV0dXJuIHtcbiAgICBpZDogXCJsaW5rZWRpblwiLFxuICAgIG5hbWU6IFwiTGlua2VkaW5cIixcbiAgICBjcmVhdGVBdXRob3JpemF0aW9uVVJMOiBhc3luYyAoe1xuICAgICAgc3RhdGUsXG4gICAgICBzY29wZXMsXG4gICAgICByZWRpcmVjdFVSSSxcbiAgICAgIGxvZ2luSGludFxuICAgIH0pID0+IHtcbiAgICAgIGNvbnN0IF9zY29wZXMgPSBvcHRpb25zLmRpc2FibGVEZWZhdWx0U2NvcGUgPyBbXSA6IFtcInByb2ZpbGVcIiwgXCJlbWFpbFwiLCBcIm9wZW5pZFwiXTtcbiAgICAgIG9wdGlvbnMuc2NvcGUgJiYgX3Njb3Blcy5wdXNoKC4uLm9wdGlvbnMuc2NvcGUpO1xuICAgICAgc2NvcGVzICYmIF9zY29wZXMucHVzaCguLi5zY29wZXMpO1xuICAgICAgcmV0dXJuIGF3YWl0IGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoe1xuICAgICAgICBpZDogXCJsaW5rZWRpblwiLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQsXG4gICAgICAgIHNjb3BlczogX3Njb3BlcyxcbiAgICAgICAgc3RhdGUsXG4gICAgICAgIGxvZ2luSGludCxcbiAgICAgICAgcmVkaXJlY3RVUklcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZTogYXN5bmMgKHsgY29kZSwgcmVkaXJlY3RVUkkgfSkgPT4ge1xuICAgICAgcmV0dXJuIGF3YWl0IHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGUoe1xuICAgICAgICBjb2RlLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgdG9rZW5FbmRwb2ludFxuICAgICAgfSk7XG4gICAgfSxcbiAgICByZWZyZXNoQWNjZXNzVG9rZW46IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuID8gb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gOiBhc3luYyAocmVmcmVzaFRva2VuKSA9PiB7XG4gICAgICByZXR1cm4gcmVmcmVzaEFjY2Vzc1Rva2VuKHtcbiAgICAgICAgcmVmcmVzaFRva2VuLFxuICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgY2xpZW50SWQ6IG9wdGlvbnMuY2xpZW50SWQsXG4gICAgICAgICAgY2xpZW50S2V5OiBvcHRpb25zLmNsaWVudEtleSxcbiAgICAgICAgICBjbGllbnRTZWNyZXQ6IG9wdGlvbnMuY2xpZW50U2VjcmV0XG4gICAgICAgIH0sXG4gICAgICAgIHRva2VuRW5kcG9pbnRcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgYXN5bmMgZ2V0VXNlckluZm8odG9rZW4pIHtcbiAgICAgIGlmIChvcHRpb25zLmdldFVzZXJJbmZvKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLmdldFVzZXJJbmZvKHRva2VuKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgZGF0YTogcHJvZmlsZSwgZXJyb3IgfSA9IGF3YWl0IGJldHRlckZldGNoKFxuICAgICAgICBcImh0dHBzOi8vYXBpLmxpbmtlZGluLmNvbS92Mi91c2VyaW5mb1wiLFxuICAgICAgICB7XG4gICAgICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbi5hY2Nlc3NUb2tlbn1gXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgdXNlck1hcCA9IGF3YWl0IG9wdGlvbnMubWFwUHJvZmlsZVRvVXNlcj8uKHByb2ZpbGUpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGlkOiBwcm9maWxlLnN1YixcbiAgICAgICAgICBuYW1lOiBwcm9maWxlLm5hbWUsXG4gICAgICAgICAgZW1haWw6IHByb2ZpbGUuZW1haWwsXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogcHJvZmlsZS5lbWFpbF92ZXJpZmllZCB8fCBmYWxzZSxcbiAgICAgICAgICBpbWFnZTogcHJvZmlsZS5waWN0dXJlLFxuICAgICAgICAgIC4uLnVzZXJNYXBcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YTogcHJvZmlsZVxuICAgICAgfTtcbiAgICB9LFxuICAgIG9wdGlvbnNcbiAgfTtcbn07XG5cbmNvbnN0IGNsZWFuRG91YmxlU2xhc2hlcyA9IChpbnB1dCA9IFwiXCIpID0+IHtcbiAgcmV0dXJuIGlucHV0LnNwbGl0KFwiOi8vXCIpLm1hcCgoc3RyKSA9PiBzdHIucmVwbGFjZSgvXFwvezIsfS9nLCBcIi9cIikpLmpvaW4oXCI6Ly9cIik7XG59O1xuY29uc3QgaXNzdWVyVG9FbmRwb2ludHMgPSAoaXNzdWVyKSA9PiB7XG4gIGxldCBiYXNlVXJsID0gaXNzdWVyIHx8IFwiaHR0cHM6Ly9naXRsYWIuY29tXCI7XG4gIHJldHVybiB7XG4gICAgYXV0aG9yaXphdGlvbkVuZHBvaW50OiBjbGVhbkRvdWJsZVNsYXNoZXMoYCR7YmFzZVVybH0vb2F1dGgvYXV0aG9yaXplYCksXG4gICAgdG9rZW5FbmRwb2ludDogY2xlYW5Eb3VibGVTbGFzaGVzKGAke2Jhc2VVcmx9L29hdXRoL3Rva2VuYCksXG4gICAgdXNlcmluZm9FbmRwb2ludDogY2xlYW5Eb3VibGVTbGFzaGVzKGAke2Jhc2VVcmx9L2FwaS92NC91c2VyYClcbiAgfTtcbn07XG5jb25zdCBnaXRsYWIgPSAob3B0aW9ucykgPT4ge1xuICBjb25zdCB7IGF1dGhvcml6YXRpb25FbmRwb2ludCwgdG9rZW5FbmRwb2ludCwgdXNlcmluZm9FbmRwb2ludCB9ID0gaXNzdWVyVG9FbmRwb2ludHMob3B0aW9ucy5pc3N1ZXIpO1xuICBjb25zdCBpc3N1ZXJJZCA9IFwiZ2l0bGFiXCI7XG4gIGNvbnN0IGlzc3Vlck5hbWUgPSBcIkdpdGxhYlwiO1xuICByZXR1cm4ge1xuICAgIGlkOiBpc3N1ZXJJZCxcbiAgICBuYW1lOiBpc3N1ZXJOYW1lLFxuICAgIGNyZWF0ZUF1dGhvcml6YXRpb25VUkw6IGFzeW5jICh7XG4gICAgICBzdGF0ZSxcbiAgICAgIHNjb3BlcyxcbiAgICAgIGNvZGVWZXJpZmllcixcbiAgICAgIGxvZ2luSGludCxcbiAgICAgIHJlZGlyZWN0VVJJXG4gICAgfSkgPT4ge1xuICAgICAgY29uc3QgX3Njb3BlcyA9IG9wdGlvbnMuZGlzYWJsZURlZmF1bHRTY29wZSA/IFtdIDogW1wicmVhZF91c2VyXCJdO1xuICAgICAgb3B0aW9ucy5zY29wZSAmJiBfc2NvcGVzLnB1c2goLi4ub3B0aW9ucy5zY29wZSk7XG4gICAgICBzY29wZXMgJiYgX3Njb3Blcy5wdXNoKC4uLnNjb3Blcyk7XG4gICAgICByZXR1cm4gYXdhaXQgY3JlYXRlQXV0aG9yaXphdGlvblVSTCh7XG4gICAgICAgIGlkOiBpc3N1ZXJJZCxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgYXV0aG9yaXphdGlvbkVuZHBvaW50LFxuICAgICAgICBzY29wZXM6IF9zY29wZXMsXG4gICAgICAgIHN0YXRlLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgY29kZVZlcmlmaWVyLFxuICAgICAgICBsb2dpbkhpbnRcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZTogYXN5bmMgKHsgY29kZSwgcmVkaXJlY3RVUkksIGNvZGVWZXJpZmllciB9KSA9PiB7XG4gICAgICByZXR1cm4gdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZSh7XG4gICAgICAgIGNvZGUsXG4gICAgICAgIHJlZGlyZWN0VVJJLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICBjb2RlVmVyaWZpZXIsXG4gICAgICAgIHRva2VuRW5kcG9pbnRcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgcmVmcmVzaEFjY2Vzc1Rva2VuOiBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA/IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuIDogYXN5bmMgKHJlZnJlc2hUb2tlbikgPT4ge1xuICAgICAgcmV0dXJuIHJlZnJlc2hBY2Nlc3NUb2tlbih7XG4gICAgICAgIHJlZnJlc2hUb2tlbixcbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgIGNsaWVudElkOiBvcHRpb25zLmNsaWVudElkLFxuICAgICAgICAgIGNsaWVudEtleTogb3B0aW9ucy5jbGllbnRLZXksXG4gICAgICAgICAgY2xpZW50U2VjcmV0OiBvcHRpb25zLmNsaWVudFNlY3JldFxuICAgICAgICB9LFxuICAgICAgICB0b2tlbkVuZHBvaW50OiBcImh0dHBzOi8vZ2l0bGFiLmNvbS9vYXV0aC90b2tlblwiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIGFzeW5jIGdldFVzZXJJbmZvKHRva2VuKSB7XG4gICAgICBpZiAob3B0aW9ucy5nZXRVc2VySW5mbykge1xuICAgICAgICByZXR1cm4gb3B0aW9ucy5nZXRVc2VySW5mbyh0b2tlbik7XG4gICAgICB9XG4gICAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUsIGVycm9yIH0gPSBhd2FpdCBiZXR0ZXJGZXRjaChcbiAgICAgICAgdXNlcmluZm9FbmRwb2ludCxcbiAgICAgICAgeyBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbi5hY2Nlc3NUb2tlbn1gIH0gfVxuICAgICAgKTtcbiAgICAgIGlmIChlcnJvciB8fCBwcm9maWxlLnN0YXRlICE9PSBcImFjdGl2ZVwiIHx8IHByb2ZpbGUubG9ja2VkKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgdXNlck1hcCA9IGF3YWl0IG9wdGlvbnMubWFwUHJvZmlsZVRvVXNlcj8uKHByb2ZpbGUpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGlkOiBwcm9maWxlLmlkLnRvU3RyaW5nKCksXG4gICAgICAgICAgbmFtZTogcHJvZmlsZS5uYW1lID8/IHByb2ZpbGUudXNlcm5hbWUsXG4gICAgICAgICAgZW1haWw6IHByb2ZpbGUuZW1haWwsXG4gICAgICAgICAgaW1hZ2U6IHByb2ZpbGUuYXZhdGFyX3VybCxcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiB0cnVlLFxuICAgICAgICAgIC4uLnVzZXJNYXBcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YTogcHJvZmlsZVxuICAgICAgfTtcbiAgICB9LFxuICAgIG9wdGlvbnNcbiAgfTtcbn07XG5cbmNvbnN0IHRpa3RvayA9IChvcHRpb25zKSA9PiB7XG4gIHJldHVybiB7XG4gICAgaWQ6IFwidGlrdG9rXCIsXG4gICAgbmFtZTogXCJUaWtUb2tcIixcbiAgICBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHsgc3RhdGUsIHNjb3BlcywgcmVkaXJlY3RVUkkgfSkge1xuICAgICAgY29uc3QgX3Njb3BlcyA9IG9wdGlvbnMuZGlzYWJsZURlZmF1bHRTY29wZSA/IFtdIDogW1widXNlci5pbmZvLnByb2ZpbGVcIl07XG4gICAgICBvcHRpb25zLnNjb3BlICYmIF9zY29wZXMucHVzaCguLi5vcHRpb25zLnNjb3BlKTtcbiAgICAgIHNjb3BlcyAmJiBfc2NvcGVzLnB1c2goLi4uc2NvcGVzKTtcbiAgICAgIHJldHVybiBuZXcgVVJMKFxuICAgICAgICBgaHR0cHM6Ly93d3cudGlrdG9rLmNvbS92Mi9hdXRoL2F1dGhvcml6ZT9zY29wZT0ke19zY29wZXMuam9pbihcbiAgICAgICAgICBcIixcIlxuICAgICAgICApfSZyZXNwb25zZV90eXBlPWNvZGUmY2xpZW50X2tleT0ke29wdGlvbnMuY2xpZW50S2V5fSZjbGllbnRfc2VjcmV0PSR7b3B0aW9ucy5jbGllbnRTZWNyZXR9JnJlZGlyZWN0X3VyaT0ke2VuY29kZVVSSUNvbXBvbmVudChcbiAgICAgICAgICBvcHRpb25zLnJlZGlyZWN0VVJJIHx8IHJlZGlyZWN0VVJJXG4gICAgICAgICl9JnN0YXRlPSR7c3RhdGV9YFxuICAgICAgKTtcbiAgICB9LFxuICAgIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGU6IGFzeW5jICh7IGNvZGUsIHJlZGlyZWN0VVJJIH0pID0+IHtcbiAgICAgIHJldHVybiB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlKHtcbiAgICAgICAgY29kZSxcbiAgICAgICAgcmVkaXJlY3RVUkk6IG9wdGlvbnMucmVkaXJlY3RVUkkgfHwgcmVkaXJlY3RVUkksXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIHRva2VuRW5kcG9pbnQ6IFwiaHR0cHM6Ly9vcGVuLnRpa3Rva2FwaXMuY29tL3YyL29hdXRoL3Rva2VuL1wiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIHJlZnJlc2hBY2Nlc3NUb2tlbjogb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gPyBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA6IGFzeW5jIChyZWZyZXNoVG9rZW4pID0+IHtcbiAgICAgIHJldHVybiByZWZyZXNoQWNjZXNzVG9rZW4oe1xuICAgICAgICByZWZyZXNoVG9rZW4sXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICBjbGllbnRJZDogb3B0aW9ucy5jbGllbnRJZCxcbiAgICAgICAgICBjbGllbnRLZXk6IG9wdGlvbnMuY2xpZW50S2V5LFxuICAgICAgICAgIGNsaWVudFNlY3JldDogb3B0aW9ucy5jbGllbnRTZWNyZXRcbiAgICAgICAgfSxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL29wZW4udGlrdG9rYXBpcy5jb20vdjIvb2F1dGgvdG9rZW4vXCJcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgYXN5bmMgZ2V0VXNlckluZm8odG9rZW4pIHtcbiAgICAgIGlmIChvcHRpb25zLmdldFVzZXJJbmZvKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLmdldFVzZXJJbmZvKHRva2VuKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGZpZWxkcyA9IFtcbiAgICAgICAgXCJvcGVuX2lkXCIsXG4gICAgICAgIFwiYXZhdGFyX2xhcmdlX3VybFwiLFxuICAgICAgICBcImRpc3BsYXlfbmFtZVwiLFxuICAgICAgICBcInVzZXJuYW1lXCJcbiAgICAgIF07XG4gICAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUsIGVycm9yIH0gPSBhd2FpdCBiZXR0ZXJGZXRjaChcbiAgICAgICAgYGh0dHBzOi8vb3Blbi50aWt0b2thcGlzLmNvbS92Mi91c2VyL2luZm8vP2ZpZWxkcz0ke2ZpZWxkcy5qb2luKFwiLFwiKX1gLFxuICAgICAgICB7XG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgYXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VuLmFjY2Vzc1Rva2VufWBcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgZW1haWw6IHByb2ZpbGUuZGF0YS51c2VyLmVtYWlsIHx8IHByb2ZpbGUuZGF0YS51c2VyLnVzZXJuYW1lLFxuICAgICAgICAgIGlkOiBwcm9maWxlLmRhdGEudXNlci5vcGVuX2lkLFxuICAgICAgICAgIG5hbWU6IHByb2ZpbGUuZGF0YS51c2VyLmRpc3BsYXlfbmFtZSB8fCBwcm9maWxlLmRhdGEudXNlci51c2VybmFtZSxcbiAgICAgICAgICBpbWFnZTogcHJvZmlsZS5kYXRhLnVzZXIuYXZhdGFyX2xhcmdlX3VybCxcbiAgICAgICAgICAvKiogQG5vdGUgVGlrdG9rIGRvZXMgbm90IHByb3ZpZGUgZW1haWxWZXJpZmllZCBvciBldmVuIGVtYWlsKi9cbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiBwcm9maWxlLmRhdGEudXNlci5lbWFpbCA/IHRydWUgOiBmYWxzZVxuICAgICAgICB9LFxuICAgICAgICBkYXRhOiBwcm9maWxlXG4gICAgICB9O1xuICAgIH0sXG4gICAgb3B0aW9uc1xuICB9O1xufTtcblxuY29uc3QgcmVkZGl0ID0gKG9wdGlvbnMpID0+IHtcbiAgcmV0dXJuIHtcbiAgICBpZDogXCJyZWRkaXRcIixcbiAgICBuYW1lOiBcIlJlZGRpdFwiLFxuICAgIGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoeyBzdGF0ZSwgc2NvcGVzLCByZWRpcmVjdFVSSSB9KSB7XG4gICAgICBjb25zdCBfc2NvcGVzID0gb3B0aW9ucy5kaXNhYmxlRGVmYXVsdFNjb3BlID8gW10gOiBbXCJpZGVudGl0eVwiXTtcbiAgICAgIG9wdGlvbnMuc2NvcGUgJiYgX3Njb3Blcy5wdXNoKC4uLm9wdGlvbnMuc2NvcGUpO1xuICAgICAgc2NvcGVzICYmIF9zY29wZXMucHVzaCguLi5zY29wZXMpO1xuICAgICAgcmV0dXJuIGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoe1xuICAgICAgICBpZDogXCJyZWRkaXRcIixcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgYXV0aG9yaXphdGlvbkVuZHBvaW50OiBcImh0dHBzOi8vd3d3LnJlZGRpdC5jb20vYXBpL3YxL2F1dGhvcml6ZVwiLFxuICAgICAgICBzY29wZXM6IF9zY29wZXMsXG4gICAgICAgIHN0YXRlLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgZHVyYXRpb246IG9wdGlvbnMuZHVyYXRpb25cbiAgICAgIH0pO1xuICAgIH0sXG4gICAgdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZTogYXN5bmMgKHsgY29kZSwgcmVkaXJlY3RVUkkgfSkgPT4ge1xuICAgICAgY29uc3QgYm9keSA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoe1xuICAgICAgICBncmFudF90eXBlOiBcImF1dGhvcml6YXRpb25fY29kZVwiLFxuICAgICAgICBjb2RlLFxuICAgICAgICByZWRpcmVjdF91cmk6IG9wdGlvbnMucmVkaXJlY3RVUkkgfHwgcmVkaXJlY3RVUklcbiAgICAgIH0pO1xuICAgICAgY29uc3QgaGVhZGVycyA9IHtcbiAgICAgICAgXCJjb250ZW50LXR5cGVcIjogXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIixcbiAgICAgICAgYWNjZXB0OiBcInRleHQvcGxhaW5cIixcbiAgICAgICAgXCJ1c2VyLWFnZW50XCI6IFwiYmV0dGVyLWF1dGhcIixcbiAgICAgICAgQXV0aG9yaXphdGlvbjogYEJhc2ljICR7YmFzZTY0LmVuY29kZShcbiAgICAgICAgICBgJHtvcHRpb25zLmNsaWVudElkfToke29wdGlvbnMuY2xpZW50U2VjcmV0fWBcbiAgICAgICAgKX1gXG4gICAgICB9O1xuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgYmV0dGVyRmV0Y2goXG4gICAgICAgIFwiaHR0cHM6Ly93d3cucmVkZGl0LmNvbS9hcGkvdjEvYWNjZXNzX3Rva2VuXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgIGhlYWRlcnMsXG4gICAgICAgICAgYm9keTogYm9keS50b1N0cmluZygpXG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG4gICAgICByZXR1cm4gZ2V0T0F1dGgyVG9rZW5zKGRhdGEpO1xuICAgIH0sXG4gICAgcmVmcmVzaEFjY2Vzc1Rva2VuOiBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA/IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuIDogYXN5bmMgKHJlZnJlc2hUb2tlbikgPT4ge1xuICAgICAgcmV0dXJuIHJlZnJlc2hBY2Nlc3NUb2tlbih7XG4gICAgICAgIHJlZnJlc2hUb2tlbixcbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgIGNsaWVudElkOiBvcHRpb25zLmNsaWVudElkLFxuICAgICAgICAgIGNsaWVudEtleTogb3B0aW9ucy5jbGllbnRLZXksXG4gICAgICAgICAgY2xpZW50U2VjcmV0OiBvcHRpb25zLmNsaWVudFNlY3JldFxuICAgICAgICB9LFxuICAgICAgICB0b2tlbkVuZHBvaW50OiBcImh0dHBzOi8vd3d3LnJlZGRpdC5jb20vYXBpL3YxL2FjY2Vzc190b2tlblwiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIGFzeW5jIGdldFVzZXJJbmZvKHRva2VuKSB7XG4gICAgICBpZiAob3B0aW9ucy5nZXRVc2VySW5mbykge1xuICAgICAgICByZXR1cm4gb3B0aW9ucy5nZXRVc2VySW5mbyh0b2tlbik7XG4gICAgICB9XG4gICAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUsIGVycm9yIH0gPSBhd2FpdCBiZXR0ZXJGZXRjaChcbiAgICAgICAgXCJodHRwczovL29hdXRoLnJlZGRpdC5jb20vYXBpL3YxL21lXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW4uYWNjZXNzVG9rZW59YCxcbiAgICAgICAgICAgIFwiVXNlci1BZ2VudFwiOiBcImJldHRlci1hdXRoXCJcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICBjb25zdCB1c2VyTWFwID0gYXdhaXQgb3B0aW9ucy5tYXBQcm9maWxlVG9Vc2VyPy4ocHJvZmlsZSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IHByb2ZpbGUuaWQsXG4gICAgICAgICAgbmFtZTogcHJvZmlsZS5uYW1lLFxuICAgICAgICAgIGVtYWlsOiBwcm9maWxlLm9hdXRoX2NsaWVudF9pZCxcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiBwcm9maWxlLmhhc192ZXJpZmllZF9lbWFpbCxcbiAgICAgICAgICBpbWFnZTogcHJvZmlsZS5pY29uX2ltZz8uc3BsaXQoXCI/XCIpWzBdLFxuICAgICAgICAgIC4uLnVzZXJNYXBcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YTogcHJvZmlsZVxuICAgICAgfTtcbiAgICB9LFxuICAgIG9wdGlvbnNcbiAgfTtcbn07XG5cbmNvbnN0IHJvYmxveCA9IChvcHRpb25zKSA9PiB7XG4gIHJldHVybiB7XG4gICAgaWQ6IFwicm9ibG94XCIsXG4gICAgbmFtZTogXCJSb2Jsb3hcIixcbiAgICBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHsgc3RhdGUsIHNjb3BlcywgcmVkaXJlY3RVUkkgfSkge1xuICAgICAgY29uc3QgX3Njb3BlcyA9IG9wdGlvbnMuZGlzYWJsZURlZmF1bHRTY29wZSA/IFtdIDogW1wib3BlbmlkXCIsIFwicHJvZmlsZVwiXTtcbiAgICAgIG9wdGlvbnMuc2NvcGUgJiYgX3Njb3Blcy5wdXNoKC4uLm9wdGlvbnMuc2NvcGUpO1xuICAgICAgc2NvcGVzICYmIF9zY29wZXMucHVzaCguLi5zY29wZXMpO1xuICAgICAgcmV0dXJuIG5ldyBVUkwoXG4gICAgICAgIGBodHRwczovL2FwaXMucm9ibG94LmNvbS9vYXV0aC92MS9hdXRob3JpemU/c2NvcGU9JHtfc2NvcGVzLmpvaW4oXG4gICAgICAgICAgXCIrXCJcbiAgICAgICAgKX0mcmVzcG9uc2VfdHlwZT1jb2RlJmNsaWVudF9pZD0ke29wdGlvbnMuY2xpZW50SWR9JnJlZGlyZWN0X3VyaT0ke2VuY29kZVVSSUNvbXBvbmVudChcbiAgICAgICAgICBvcHRpb25zLnJlZGlyZWN0VVJJIHx8IHJlZGlyZWN0VVJJXG4gICAgICAgICl9JnN0YXRlPSR7c3RhdGV9JnByb21wdD0ke29wdGlvbnMucHJvbXB0IHx8IFwic2VsZWN0X2FjY291bnQrY29uc2VudFwifWBcbiAgICAgICk7XG4gICAgfSxcbiAgICB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlOiBhc3luYyAoeyBjb2RlLCByZWRpcmVjdFVSSSB9KSA9PiB7XG4gICAgICByZXR1cm4gdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZSh7XG4gICAgICAgIGNvZGUsXG4gICAgICAgIHJlZGlyZWN0VVJJOiBvcHRpb25zLnJlZGlyZWN0VVJJIHx8IHJlZGlyZWN0VVJJLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICB0b2tlbkVuZHBvaW50OiBcImh0dHBzOi8vYXBpcy5yb2Jsb3guY29tL29hdXRoL3YxL3Rva2VuXCIsXG4gICAgICAgIGF1dGhlbnRpY2F0aW9uOiBcInBvc3RcIlxuICAgICAgfSk7XG4gICAgfSxcbiAgICByZWZyZXNoQWNjZXNzVG9rZW46IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuID8gb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gOiBhc3luYyAocmVmcmVzaFRva2VuKSA9PiB7XG4gICAgICByZXR1cm4gcmVmcmVzaEFjY2Vzc1Rva2VuKHtcbiAgICAgICAgcmVmcmVzaFRva2VuLFxuICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgY2xpZW50SWQ6IG9wdGlvbnMuY2xpZW50SWQsXG4gICAgICAgICAgY2xpZW50S2V5OiBvcHRpb25zLmNsaWVudEtleSxcbiAgICAgICAgICBjbGllbnRTZWNyZXQ6IG9wdGlvbnMuY2xpZW50U2VjcmV0XG4gICAgICAgIH0sXG4gICAgICAgIHRva2VuRW5kcG9pbnQ6IFwiaHR0cHM6Ly9hcGlzLnJvYmxveC5jb20vb2F1dGgvdjEvdG9rZW5cIlxuICAgICAgfSk7XG4gICAgfSxcbiAgICBhc3luYyBnZXRVc2VySW5mbyh0b2tlbikge1xuICAgICAgaWYgKG9wdGlvbnMuZ2V0VXNlckluZm8pIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMuZ2V0VXNlckluZm8odG9rZW4pO1xuICAgICAgfVxuICAgICAgY29uc3QgeyBkYXRhOiBwcm9maWxlLCBlcnJvciB9ID0gYXdhaXQgYmV0dGVyRmV0Y2goXG4gICAgICAgIFwiaHR0cHM6Ly9hcGlzLnJvYmxveC5jb20vb2F1dGgvdjEvdXNlcmluZm9cIixcbiAgICAgICAge1xuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbi5hY2Nlc3NUb2tlbn1gXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgdXNlck1hcCA9IGF3YWl0IG9wdGlvbnMubWFwUHJvZmlsZVRvVXNlcj8uKHByb2ZpbGUpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGlkOiBwcm9maWxlLnN1YixcbiAgICAgICAgICBuYW1lOiBwcm9maWxlLm5pY2tuYW1lIHx8IHByb2ZpbGUucHJlZmVycmVkX3VzZXJuYW1lIHx8IFwiXCIsXG4gICAgICAgICAgaW1hZ2U6IHByb2ZpbGUucGljdHVyZSxcbiAgICAgICAgICBlbWFpbDogcHJvZmlsZS5wcmVmZXJyZWRfdXNlcm5hbWUgfHwgbnVsbCxcbiAgICAgICAgICAvLyBSb2Jsb3ggZG9lcyBub3QgcHJvdmlkZSBlbWFpbFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IHRydWUsXG4gICAgICAgICAgLi4udXNlck1hcFxuICAgICAgICB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4ucHJvZmlsZVxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH0sXG4gICAgb3B0aW9uc1xuICB9O1xufTtcblxudmFyIExBTkcgPSAvKiBAX19QVVJFX18gKi8gKChMQU5HMikgPT4ge1xuICBMQU5HMltMQU5HMltcIlJVU1wiXSA9IDBdID0gXCJSVVNcIjtcbiAgTEFORzJbTEFORzJbXCJVS1JcIl0gPSAxXSA9IFwiVUtSXCI7XG4gIExBTkcyW0xBTkcyW1wiRU5HXCJdID0gM10gPSBcIkVOR1wiO1xuICBMQU5HMltMQU5HMltcIlNQQVwiXSA9IDRdID0gXCJTUEFcIjtcbiAgTEFORzJbTEFORzJbXCJHRVJNQU5cIl0gPSA2XSA9IFwiR0VSTUFOXCI7XG4gIExBTkcyW0xBTkcyW1wiUE9MXCJdID0gMTVdID0gXCJQT0xcIjtcbiAgTEFORzJbTEFORzJbXCJGUkFcIl0gPSAxNl0gPSBcIkZSQVwiO1xuICBMQU5HMltMQU5HMltcIlRVUktFWVwiXSA9IDgyXSA9IFwiVFVSS0VZXCI7XG4gIHJldHVybiBMQU5HMjtcbn0pKExBTkcgfHwge30pO1xuY29uc3QgdmsgPSAob3B0aW9ucykgPT4ge1xuICByZXR1cm4ge1xuICAgIGlkOiBcInZrXCIsXG4gICAgbmFtZTogXCJWS1wiLFxuICAgIGFzeW5jIGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoeyBzdGF0ZSwgc2NvcGVzLCBjb2RlVmVyaWZpZXIsIHJlZGlyZWN0VVJJIH0pIHtcbiAgICAgIGNvbnN0IF9zY29wZXMgPSBvcHRpb25zLmRpc2FibGVEZWZhdWx0U2NvcGUgPyBbXSA6IFtcImVtYWlsXCIsIFwicGhvbmVcIl07XG4gICAgICBvcHRpb25zLnNjb3BlICYmIF9zY29wZXMucHVzaCguLi5vcHRpb25zLnNjb3BlKTtcbiAgICAgIHNjb3BlcyAmJiBfc2NvcGVzLnB1c2goLi4uc2NvcGVzKTtcbiAgICAgIGNvbnN0IGF1dGhvcml6YXRpb25FbmRwb2ludCA9IFwiaHR0cHM6Ly9pZC52ay5jb20vYXV0aG9yaXplXCI7XG4gICAgICByZXR1cm4gY3JlYXRlQXV0aG9yaXphdGlvblVSTCh7XG4gICAgICAgIGlkOiBcInZrXCIsXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIGF1dGhvcml6YXRpb25FbmRwb2ludCxcbiAgICAgICAgc2NvcGVzOiBfc2NvcGVzLFxuICAgICAgICBzdGF0ZSxcbiAgICAgICAgcmVkaXJlY3RVUkksXG4gICAgICAgIGNvZGVWZXJpZmllclxuICAgICAgfSk7XG4gICAgfSxcbiAgICB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlOiBhc3luYyAoe1xuICAgICAgY29kZSxcbiAgICAgIGNvZGVWZXJpZmllcixcbiAgICAgIHJlZGlyZWN0VVJJLFxuICAgICAgZGV2aWNlSWRcbiAgICB9KSA9PiB7XG4gICAgICByZXR1cm4gdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZSh7XG4gICAgICAgIGNvZGUsXG4gICAgICAgIGNvZGVWZXJpZmllcixcbiAgICAgICAgcmVkaXJlY3RVUkk6IG9wdGlvbnMucmVkaXJlY3RVUkkgfHwgcmVkaXJlY3RVUkksXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIGRldmljZUlkLFxuICAgICAgICB0b2tlbkVuZHBvaW50OiBcImh0dHBzOi8vaWQudmsuY29tL29hdXRoMi9hdXRoXCJcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgcmVmcmVzaEFjY2Vzc1Rva2VuOiBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA/IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuIDogYXN5bmMgKHJlZnJlc2hUb2tlbikgPT4ge1xuICAgICAgcmV0dXJuIHJlZnJlc2hBY2Nlc3NUb2tlbih7XG4gICAgICAgIHJlZnJlc2hUb2tlbixcbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgIGNsaWVudElkOiBvcHRpb25zLmNsaWVudElkLFxuICAgICAgICAgIGNsaWVudEtleTogb3B0aW9ucy5jbGllbnRLZXksXG4gICAgICAgICAgY2xpZW50U2VjcmV0OiBvcHRpb25zLmNsaWVudFNlY3JldFxuICAgICAgICB9LFxuICAgICAgICB0b2tlbkVuZHBvaW50OiBcImh0dHBzOi8vaWQudmsuY29tL29hdXRoMi9hdXRoXCJcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgYXN5bmMgZ2V0VXNlckluZm8oZGF0YSkge1xuICAgICAgaWYgKG9wdGlvbnMuZ2V0VXNlckluZm8pIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMuZ2V0VXNlckluZm8oZGF0YSk7XG4gICAgICB9XG4gICAgICBpZiAoIWRhdGEuYWNjZXNzVG9rZW4pIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICBjb25zdCBmb3JtQm9keSA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoe1xuICAgICAgICBhY2Nlc3NfdG9rZW46IGRhdGEuYWNjZXNzVG9rZW4sXG4gICAgICAgIGNsaWVudF9pZDogb3B0aW9ucy5jbGllbnRJZFxuICAgICAgfSkudG9TdHJpbmcoKTtcbiAgICAgIGNvbnN0IHsgZGF0YTogcHJvZmlsZSwgZXJyb3IgfSA9IGF3YWl0IGJldHRlckZldGNoKFxuICAgICAgICBcImh0dHBzOi8vaWQudmsuY29tL29hdXRoMi91c2VyX2luZm9cIixcbiAgICAgICAge1xuICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIlxuICAgICAgICAgIH0sXG4gICAgICAgICAgYm9keTogZm9ybUJvZHlcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGlmICghcHJvZmlsZS51c2VyLmVtYWlsKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgdXNlck1hcCA9IGF3YWl0IG9wdGlvbnMubWFwUHJvZmlsZVRvVXNlcj8uKHByb2ZpbGUpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGlkOiBwcm9maWxlLnVzZXIudXNlcl9pZCxcbiAgICAgICAgICBmaXJzdF9uYW1lOiBwcm9maWxlLnVzZXIuZmlyc3RfbmFtZSxcbiAgICAgICAgICBsYXN0X25hbWU6IHByb2ZpbGUudXNlci5sYXN0X25hbWUsXG4gICAgICAgICAgZW1haWw6IHByb2ZpbGUudXNlci5lbWFpbCxcbiAgICAgICAgICBpbWFnZTogcHJvZmlsZS51c2VyLmF2YXRhcixcbiAgICAgICAgICAvKiogQG5vdGUgVksgZG9lcyBub3QgcHJvdmlkZSBlbWFpbFZlcmlmaWVkKi9cbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiAhIXByb2ZpbGUudXNlci5lbWFpbCxcbiAgICAgICAgICBiaXJ0aGRheTogcHJvZmlsZS51c2VyLmJpcnRoZGF5LFxuICAgICAgICAgIHNleDogcHJvZmlsZS51c2VyLnNleCxcbiAgICAgICAgICAuLi51c2VyTWFwXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGE6IHByb2ZpbGVcbiAgICAgIH07XG4gICAgfSxcbiAgICBvcHRpb25zXG4gIH07XG59O1xuXG5jb25zdCB6b29tID0gKHVzZXJPcHRpb25zKSA9PiB7XG4gIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgcGtjZTogdHJ1ZSxcbiAgICAuLi51c2VyT3B0aW9uc1xuICB9O1xuICByZXR1cm4ge1xuICAgIGlkOiBcInpvb21cIixcbiAgICBuYW1lOiBcIlpvb21cIixcbiAgICBjcmVhdGVBdXRob3JpemF0aW9uVVJMOiBhc3luYyAoeyBzdGF0ZSwgcmVkaXJlY3RVUkksIGNvZGVWZXJpZmllciB9KSA9PiB7XG4gICAgICBjb25zdCBwYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHtcbiAgICAgICAgcmVzcG9uc2VfdHlwZTogXCJjb2RlXCIsXG4gICAgICAgIHJlZGlyZWN0X3VyaTogb3B0aW9ucy5yZWRpcmVjdFVSSSA/IG9wdGlvbnMucmVkaXJlY3RVUkkgOiByZWRpcmVjdFVSSSxcbiAgICAgICAgY2xpZW50X2lkOiBvcHRpb25zLmNsaWVudElkLFxuICAgICAgICBzdGF0ZVxuICAgICAgfSk7XG4gICAgICBpZiAob3B0aW9ucy5wa2NlKSB7XG4gICAgICAgIGNvbnN0IGNvZGVDaGFsbGVuZ2UgPSBhd2FpdCBnZW5lcmF0ZUNvZGVDaGFsbGVuZ2UoY29kZVZlcmlmaWVyKTtcbiAgICAgICAgcGFyYW1zLnNldChcImNvZGVfY2hhbGxlbmdlX21ldGhvZFwiLCBcIlMyNTZcIik7XG4gICAgICAgIHBhcmFtcy5zZXQoXCJjb2RlX2NoYWxsZW5nZVwiLCBjb2RlQ2hhbGxlbmdlKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoXCJodHRwczovL3pvb20udXMvb2F1dGgvYXV0aG9yaXplXCIpO1xuICAgICAgdXJsLnNlYXJjaCA9IHBhcmFtcy50b1N0cmluZygpO1xuICAgICAgcmV0dXJuIHVybDtcbiAgICB9LFxuICAgIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGU6IGFzeW5jICh7IGNvZGUsIHJlZGlyZWN0VVJJLCBjb2RlVmVyaWZpZXIgfSkgPT4ge1xuICAgICAgcmV0dXJuIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGUoe1xuICAgICAgICBjb2RlLFxuICAgICAgICByZWRpcmVjdFVSSTogb3B0aW9ucy5yZWRpcmVjdFVSSSB8fCByZWRpcmVjdFVSSSxcbiAgICAgICAgY29kZVZlcmlmaWVyLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICB0b2tlbkVuZHBvaW50OiBcImh0dHBzOi8vem9vbS51cy9vYXV0aC90b2tlblwiLFxuICAgICAgICBhdXRoZW50aWNhdGlvbjogXCJwb3N0XCJcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgYXN5bmMgZ2V0VXNlckluZm8odG9rZW4pIHtcbiAgICAgIGlmIChvcHRpb25zLmdldFVzZXJJbmZvKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLmdldFVzZXJJbmZvKHRva2VuKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgZGF0YTogcHJvZmlsZSwgZXJyb3IgfSA9IGF3YWl0IGJldHRlckZldGNoKFxuICAgICAgICBcImh0dHBzOi8vYXBpLnpvb20udXMvdjIvdXNlcnMvbWVcIixcbiAgICAgICAge1xuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbi5hY2Nlc3NUb2tlbn1gXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgdXNlck1hcCA9IGF3YWl0IG9wdGlvbnMubWFwUHJvZmlsZVRvVXNlcj8uKHByb2ZpbGUpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGlkOiBwcm9maWxlLmlkLFxuICAgICAgICAgIG5hbWU6IHByb2ZpbGUuZGlzcGxheV9uYW1lLFxuICAgICAgICAgIGltYWdlOiBwcm9maWxlLnBpY191cmwsXG4gICAgICAgICAgZW1haWw6IHByb2ZpbGUuZW1haWwsXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogQm9vbGVhbihwcm9maWxlLnZlcmlmaWVkKSxcbiAgICAgICAgICAuLi51c2VyTWFwXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi5wcm9maWxlXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICB9O1xufTtcblxuY29uc3Qgc29jaWFsUHJvdmlkZXJzID0ge1xuICBhcHBsZSxcbiAgZGlzY29yZCxcbiAgZmFjZWJvb2ssXG4gIGdpdGh1YixcbiAgbWljcm9zb2Z0LFxuICBnb29nbGUsXG4gIGh1Z2dpbmdmYWNlLFxuICBzbGFjayxcbiAgc3BvdGlmeSxcbiAgdHdpdGNoLFxuICB0d2l0dGVyLFxuICBkcm9wYm94LFxuICBraWNrLFxuICBsaW5lYXIsXG4gIGxpbmtlZGluLFxuICBnaXRsYWIsXG4gIHRpa3RvayxcbiAgcmVkZGl0LFxuICByb2Jsb3gsXG4gIHZrLFxuICB6b29tLFxuICBub3Rpb25cbn07XG5jb25zdCBzb2NpYWxQcm92aWRlckxpc3QgPSBPYmplY3Qua2V5cyhzb2NpYWxQcm92aWRlcnMpO1xuY29uc3QgU29jaWFsUHJvdmlkZXJMaXN0RW51bSA9IHouZW51bShzb2NpYWxQcm92aWRlckxpc3QpLm9yKHouc3RyaW5nKCkpO1xuXG5jb25zdCBzaWduSW5Tb2NpYWwgPSBjcmVhdGVBdXRoRW5kcG9pbnQoXG4gIFwiL3NpZ24taW4vc29jaWFsXCIsXG4gIHtcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgIGJvZHk6IHoub2JqZWN0KHtcbiAgICAgIC8qKlxuICAgICAgICogQ2FsbGJhY2sgVVJMIHRvIHJlZGlyZWN0IHRvIGFmdGVyIHRoZSB1c2VyXG4gICAgICAgKiBoYXMgc2lnbmVkIGluLlxuICAgICAgICovXG4gICAgICBjYWxsYmFja1VSTDogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiQ2FsbGJhY2sgVVJMIHRvIHJlZGlyZWN0IHRvIGFmdGVyIHRoZSB1c2VyIGhhcyBzaWduZWQgaW5cIlxuICAgICAgfSkub3B0aW9uYWwoKSxcbiAgICAgIC8qKlxuICAgICAgICogY2FsbGJhY2sgdXJsIHRvIHJlZGlyZWN0IGlmIHRoZSB1c2VyIGlzIG5ld2x5IHJlZ2lzdGVyZWQuXG4gICAgICAgKlxuICAgICAgICogdXNlZnVsIGlmIHlvdSBoYXZlIGRpZmZlcmVudCByb3V0ZXMgZm9yIGV4aXN0aW5nIHVzZXJzIGFuZCBuZXcgdXNlcnNcbiAgICAgICAqL1xuICAgICAgbmV3VXNlckNhbGxiYWNrVVJMOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICAvKipcbiAgICAgICAqIENhbGxiYWNrIHVybCB0byByZWRpcmVjdCB0byBpZiBhbiBlcnJvciBoYXBwZW5zXG4gICAgICAgKlxuICAgICAgICogSWYgaXQncyBpbml0aWF0ZWQgZnJvbSB0aGUgY2xpZW50IHNkayB0aGlzIGRlZmF1bHRzIHRvXG4gICAgICAgKiB0aGUgY3VycmVudCB1cmwuXG4gICAgICAgKi9cbiAgICAgIGVycm9yQ2FsbGJhY2tVUkw6IHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIkNhbGxiYWNrIFVSTCB0byByZWRpcmVjdCB0byBpZiBhbiBlcnJvciBoYXBwZW5zXCJcbiAgICAgIH0pLm9wdGlvbmFsKCksXG4gICAgICAvKipcbiAgICAgICAqIE9BdXRoMiBwcm92aWRlciB0byB1c2VgXG4gICAgICAgKi9cbiAgICAgIHByb3ZpZGVyOiBTb2NpYWxQcm92aWRlckxpc3RFbnVtLFxuICAgICAgLyoqXG4gICAgICAgKiBEaXNhYmxlIGF1dG9tYXRpYyByZWRpcmVjdGlvbiB0byB0aGUgcHJvdmlkZXJcbiAgICAgICAqXG4gICAgICAgKiBUaGlzIGlzIHVzZWZ1bCBpZiB5b3Ugd2FudCB0byBoYW5kbGUgdGhlIHJlZGlyZWN0aW9uXG4gICAgICAgKiB5b3Vyc2VsZiBsaWtlIGluIGEgcG9wdXAgb3IgYSBkaWZmZXJlbnQgdGFiLlxuICAgICAgICovXG4gICAgICBkaXNhYmxlUmVkaXJlY3Q6IHouYm9vbGVhbigpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJEaXNhYmxlIGF1dG9tYXRpYyByZWRpcmVjdGlvbiB0byB0aGUgcHJvdmlkZXIuIFVzZWZ1bCBmb3IgaGFuZGxpbmcgdGhlIHJlZGlyZWN0aW9uIHlvdXJzZWxmXCJcbiAgICAgIH0pLm9wdGlvbmFsKCksXG4gICAgICAvKipcbiAgICAgICAqIElEIHRva2VuIGZyb20gdGhlIHByb3ZpZGVyXG4gICAgICAgKlxuICAgICAgICogVGhpcyBpcyB1c2VkIHRvIHNpZ24gaW4gdGhlIHVzZXJcbiAgICAgICAqIGlmIHRoZSB1c2VyIGlzIGFscmVhZHkgc2lnbmVkIGluIHdpdGggdGhlXG4gICAgICAgKiBwcm92aWRlciBpbiB0aGUgZnJvbnRlbmQuXG4gICAgICAgKlxuICAgICAgICogT25seSBhcHBsaWNhYmxlIGlmIHRoZSBwcm92aWRlciBzdXBwb3J0c1xuICAgICAgICogaXQuIEN1cnJlbnRseSBvbmx5IGBhcHBsZWAgYW5kIGBnb29nbGVgIGlzXG4gICAgICAgKiBzdXBwb3J0ZWQgb3V0IG9mIHRoZSBib3guXG4gICAgICAgKi9cbiAgICAgIGlkVG9rZW46IHoub3B0aW9uYWwoXG4gICAgICAgIHoub2JqZWN0KHtcbiAgICAgICAgICAvKipcbiAgICAgICAgICAgKiBJRCB0b2tlbiBmcm9tIHRoZSBwcm92aWRlclxuICAgICAgICAgICAqL1xuICAgICAgICAgIHRva2VuOiB6LnN0cmluZygpLm1ldGEoe1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiSUQgdG9rZW4gZnJvbSB0aGUgcHJvdmlkZXJcIlxuICAgICAgICAgIH0pLFxuICAgICAgICAgIC8qKlxuICAgICAgICAgICAqIFRoZSBub25jZSB1c2VkIHRvIGdlbmVyYXRlIHRoZSB0b2tlblxuICAgICAgICAgICAqL1xuICAgICAgICAgIG5vbmNlOiB6LnN0cmluZygpLm1ldGEoe1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiTm9uY2UgdXNlZCB0byBnZW5lcmF0ZSB0aGUgdG9rZW5cIlxuICAgICAgICAgIH0pLm9wdGlvbmFsKCksXG4gICAgICAgICAgLyoqXG4gICAgICAgICAgICogQWNjZXNzIHRva2VuIGZyb20gdGhlIHByb3ZpZGVyXG4gICAgICAgICAgICovXG4gICAgICAgICAgYWNjZXNzVG9rZW46IHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJBY2Nlc3MgdG9rZW4gZnJvbSB0aGUgcHJvdmlkZXJcIlxuICAgICAgICAgIH0pLm9wdGlvbmFsKCksXG4gICAgICAgICAgLyoqXG4gICAgICAgICAgICogUmVmcmVzaCB0b2tlbiBmcm9tIHRoZSBwcm92aWRlclxuICAgICAgICAgICAqL1xuICAgICAgICAgIHJlZnJlc2hUb2tlbjogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlJlZnJlc2ggdG9rZW4gZnJvbSB0aGUgcHJvdmlkZXJcIlxuICAgICAgICAgIH0pLm9wdGlvbmFsKCksXG4gICAgICAgICAgLyoqXG4gICAgICAgICAgICogRXhwaXJ5IGRhdGUgb2YgdGhlIHRva2VuXG4gICAgICAgICAgICovXG4gICAgICAgICAgZXhwaXJlc0F0OiB6Lm51bWJlcigpLm1ldGEoe1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiRXhwaXJ5IGRhdGUgb2YgdGhlIHRva2VuXCJcbiAgICAgICAgICB9KS5vcHRpb25hbCgpXG4gICAgICAgIH0pXG4gICAgICApLFxuICAgICAgc2NvcGVzOiB6LmFycmF5KHouc3RyaW5nKCkpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJBcnJheSBvZiBzY29wZXMgdG8gcmVxdWVzdCBmcm9tIHRoZSBwcm92aWRlci4gVGhpcyB3aWxsIG92ZXJyaWRlIHRoZSBkZWZhdWx0IHNjb3BlcyBwYXNzZWQuXCJcbiAgICAgIH0pLm9wdGlvbmFsKCksXG4gICAgICAvKipcbiAgICAgICAqIEV4cGxpY2l0bHkgcmVxdWVzdCBzaWduLXVwXG4gICAgICAgKlxuICAgICAgICogU2hvdWxkIGJlIHVzZWQgdG8gYWxsb3cgc2lnbiB1cCB3aGVuXG4gICAgICAgKiBkaXNhYmxlSW1wbGljaXRTaWduVXAgZm9yIHRoaXMgcHJvdmlkZXIgaXNcbiAgICAgICAqIHRydWVcbiAgICAgICAqL1xuICAgICAgcmVxdWVzdFNpZ25VcDogei5ib29sZWFuKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIkV4cGxpY2l0bHkgcmVxdWVzdCBzaWduLXVwLiBVc2VmdWwgd2hlbiBkaXNhYmxlSW1wbGljaXRTaWduVXAgaXMgdHJ1ZSBmb3IgdGhpcyBwcm92aWRlclwiXG4gICAgICB9KS5vcHRpb25hbCgpLFxuICAgICAgLyoqXG4gICAgICAgKiBUaGUgbG9naW4gaGludCB0byB1c2UgZm9yIHRoZSBhdXRob3JpemF0aW9uIGNvZGUgcmVxdWVzdFxuICAgICAgICovXG4gICAgICBsb2dpbkhpbnQ6IHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBsb2dpbiBoaW50IHRvIHVzZSBmb3IgdGhlIGF1dGhvcml6YXRpb24gY29kZSByZXF1ZXN0XCJcbiAgICAgIH0pLm9wdGlvbmFsKClcbiAgICB9KSxcbiAgICBtZXRhZGF0YToge1xuICAgICAgb3BlbmFwaToge1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJTaWduIGluIHdpdGggYSBzb2NpYWwgcHJvdmlkZXJcIixcbiAgICAgICAgb3BlcmF0aW9uSWQ6IFwic29jaWFsU2lnbkluXCIsXG4gICAgICAgIHJlc3BvbnNlczoge1xuICAgICAgICAgIFwiMjAwXCI6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlN1Y2Nlc3MgLSBSZXR1cm5zIGVpdGhlciBzZXNzaW9uIGRldGFpbHMgb3IgcmVkaXJlY3QgVVJMXCIsXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiOiB7XG4gICAgICAgICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAgICAgICAvLyB0b2RvOiB3ZSBuZWVkIHN1cHBvcnQgZm9yIG11bHRpcGxlIHNjaGVtYVxuICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlNlc3Npb24gcmVzcG9uc2Ugd2hlbiBpZFRva2VuIGlzIHByb3ZpZGVkXCIsXG4gICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgIHJlZGlyZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJib29sZWFuXCIsXG4gICAgICAgICAgICAgICAgICAgICAgZW51bTogW2ZhbHNlXVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB0b2tlbjoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiU2Vzc2lvbiB0b2tlblwiLFxuICAgICAgICAgICAgICAgICAgICAgIHVybDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJudWxsXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBudWxsYWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDogeyB0eXBlOiBcInN0cmluZ1wiIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGxhYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsYWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICBlbWFpbFZlcmlmaWVkOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJib29sZWFuXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFwiZGF0ZS10aW1lXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlZEF0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFwiZGF0ZS10aW1lXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgIFwiaWRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgXCJlbWFpbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBcImVtYWlsVmVyaWZpZWRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjcmVhdGVkQXRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ1cGRhdGVkQXRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBbXCJyZWRpcmVjdFwiLCBcInRva2VuXCIsIFwidXNlclwiXVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgYXN5bmMgKGMpID0+IHtcbiAgICBjb25zdCBwcm92aWRlciA9IGMuY29udGV4dC5zb2NpYWxQcm92aWRlcnMuZmluZChcbiAgICAgIChwKSA9PiBwLmlkID09PSBjLmJvZHkucHJvdmlkZXJcbiAgICApO1xuICAgIGlmICghcHJvdmlkZXIpIHtcbiAgICAgIGMuY29udGV4dC5sb2dnZXIuZXJyb3IoXG4gICAgICAgIFwiUHJvdmlkZXIgbm90IGZvdW5kLiBNYWtlIHN1cmUgdG8gYWRkIHRoZSBwcm92aWRlciBpbiB5b3VyIGF1dGggY29uZmlnXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlcjogYy5ib2R5LnByb3ZpZGVyXG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJOT1RfRk9VTkRcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLlBST1ZJREVSX05PVF9GT1VORFxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChjLmJvZHkuaWRUb2tlbikge1xuICAgICAgaWYgKCFwcm92aWRlci52ZXJpZnlJZFRva2VuKSB7XG4gICAgICAgIGMuY29udGV4dC5sb2dnZXIuZXJyb3IoXG4gICAgICAgICAgXCJQcm92aWRlciBkb2VzIG5vdCBzdXBwb3J0IGlkIHRva2VuIHZlcmlmaWNhdGlvblwiLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHByb3ZpZGVyOiBjLmJvZHkucHJvdmlkZXJcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIk5PVF9GT1VORFwiLCB7XG4gICAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5JRF9UT0tFTl9OT1RfU1VQUE9SVEVEXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgY29uc3QgeyB0b2tlbiwgbm9uY2UgfSA9IGMuYm9keS5pZFRva2VuO1xuICAgICAgY29uc3QgdmFsaWQgPSBhd2FpdCBwcm92aWRlci52ZXJpZnlJZFRva2VuKHRva2VuLCBub25jZSk7XG4gICAgICBpZiAoIXZhbGlkKSB7XG4gICAgICAgIGMuY29udGV4dC5sb2dnZXIuZXJyb3IoXCJJbnZhbGlkIGlkIHRva2VuXCIsIHtcbiAgICAgICAgICBwcm92aWRlcjogYy5ib2R5LnByb3ZpZGVyXG4gICAgICAgIH0pO1xuICAgICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJVTkFVVEhPUklaRURcIiwge1xuICAgICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuSU5WQUxJRF9UT0tFTlxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHVzZXJJbmZvID0gYXdhaXQgcHJvdmlkZXIuZ2V0VXNlckluZm8oe1xuICAgICAgICBpZFRva2VuOiB0b2tlbixcbiAgICAgICAgYWNjZXNzVG9rZW46IGMuYm9keS5pZFRva2VuLmFjY2Vzc1Rva2VuLFxuICAgICAgICByZWZyZXNoVG9rZW46IGMuYm9keS5pZFRva2VuLnJlZnJlc2hUb2tlblxuICAgICAgfSk7XG4gICAgICBpZiAoIXVzZXJJbmZvIHx8ICF1c2VySW5mbz8udXNlcikge1xuICAgICAgICBjLmNvbnRleHQubG9nZ2VyLmVycm9yKFwiRmFpbGVkIHRvIGdldCB1c2VyIGluZm9cIiwge1xuICAgICAgICAgIHByb3ZpZGVyOiBjLmJvZHkucHJvdmlkZXJcbiAgICAgICAgfSk7XG4gICAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIlVOQVVUSE9SSVpFRFwiLCB7XG4gICAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5GQUlMRURfVE9fR0VUX1VTRVJfSU5GT1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGlmICghdXNlckluZm8udXNlci5lbWFpbCkge1xuICAgICAgICBjLmNvbnRleHQubG9nZ2VyLmVycm9yKFwiVXNlciBlbWFpbCBub3QgZm91bmRcIiwge1xuICAgICAgICAgIHByb3ZpZGVyOiBjLmJvZHkucHJvdmlkZXJcbiAgICAgICAgfSk7XG4gICAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIlVOQVVUSE9SSVpFRFwiLCB7XG4gICAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5VU0VSX0VNQUlMX05PVF9GT1VORFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBoYW5kbGVPQXV0aFVzZXJJbmZvKGMsIHtcbiAgICAgICAgdXNlckluZm86IHtcbiAgICAgICAgICAuLi51c2VySW5mby51c2VyLFxuICAgICAgICAgIGVtYWlsOiB1c2VySW5mby51c2VyLmVtYWlsLFxuICAgICAgICAgIGlkOiB1c2VySW5mby51c2VyLmlkLFxuICAgICAgICAgIG5hbWU6IHVzZXJJbmZvLnVzZXIubmFtZSB8fCBcIlwiLFxuICAgICAgICAgIGltYWdlOiB1c2VySW5mby51c2VyLmltYWdlLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IHVzZXJJbmZvLnVzZXIuZW1haWxWZXJpZmllZCB8fCBmYWxzZVxuICAgICAgICB9LFxuICAgICAgICBhY2NvdW50OiB7XG4gICAgICAgICAgcHJvdmlkZXJJZDogcHJvdmlkZXIuaWQsXG4gICAgICAgICAgYWNjb3VudElkOiB1c2VySW5mby51c2VyLmlkLFxuICAgICAgICAgIGFjY2Vzc1Rva2VuOiBjLmJvZHkuaWRUb2tlbi5hY2Nlc3NUb2tlblxuICAgICAgICB9LFxuICAgICAgICBjYWxsYmFja1VSTDogYy5ib2R5LmNhbGxiYWNrVVJMLFxuICAgICAgICBkaXNhYmxlU2lnblVwOiBwcm92aWRlci5kaXNhYmxlSW1wbGljaXRTaWduVXAgJiYgIWMuYm9keS5yZXF1ZXN0U2lnblVwIHx8IHByb3ZpZGVyLmRpc2FibGVTaWduVXBcbiAgICAgIH0pO1xuICAgICAgaWYgKGRhdGEuZXJyb3IpIHtcbiAgICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiVU5BVVRIT1JJWkVEXCIsIHtcbiAgICAgICAgICBtZXNzYWdlOiBkYXRhLmVycm9yXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgYXdhaXQgc2V0U2Vzc2lvbkNvb2tpZShjLCBkYXRhLmRhdGEpO1xuICAgICAgcmV0dXJuIGMuanNvbih7XG4gICAgICAgIHJlZGlyZWN0OiBmYWxzZSxcbiAgICAgICAgdG9rZW46IGRhdGEuZGF0YS5zZXNzaW9uLnRva2VuLFxuICAgICAgICB1cmw6IHZvaWQgMCxcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGlkOiBkYXRhLmRhdGEudXNlci5pZCxcbiAgICAgICAgICBlbWFpbDogZGF0YS5kYXRhLnVzZXIuZW1haWwsXG4gICAgICAgICAgbmFtZTogZGF0YS5kYXRhLnVzZXIubmFtZSxcbiAgICAgICAgICBpbWFnZTogZGF0YS5kYXRhLnVzZXIuaW1hZ2UsXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogZGF0YS5kYXRhLnVzZXIuZW1haWxWZXJpZmllZCxcbiAgICAgICAgICBjcmVhdGVkQXQ6IGRhdGEuZGF0YS51c2VyLmNyZWF0ZWRBdCxcbiAgICAgICAgICB1cGRhdGVkQXQ6IGRhdGEuZGF0YS51c2VyLnVwZGF0ZWRBdFxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgeyBjb2RlVmVyaWZpZXIsIHN0YXRlIH0gPSBhd2FpdCBnZW5lcmF0ZVN0YXRlKGMpO1xuICAgIGNvbnN0IHVybCA9IGF3YWl0IHByb3ZpZGVyLmNyZWF0ZUF1dGhvcml6YXRpb25VUkwoe1xuICAgICAgc3RhdGUsXG4gICAgICBjb2RlVmVyaWZpZXIsXG4gICAgICByZWRpcmVjdFVSSTogYCR7Yy5jb250ZXh0LmJhc2VVUkx9L2NhbGxiYWNrLyR7cHJvdmlkZXIuaWR9YCxcbiAgICAgIHNjb3BlczogYy5ib2R5LnNjb3BlcyxcbiAgICAgIGxvZ2luSGludDogYy5ib2R5LmxvZ2luSGludFxuICAgIH0pO1xuICAgIHJldHVybiBjLmpzb24oe1xuICAgICAgdXJsOiB1cmwudG9TdHJpbmcoKSxcbiAgICAgIHJlZGlyZWN0OiAhYy5ib2R5LmRpc2FibGVSZWRpcmVjdFxuICAgIH0pO1xuICB9XG4pO1xuY29uc3Qgc2lnbkluRW1haWwgPSBjcmVhdGVBdXRoRW5kcG9pbnQoXG4gIFwiL3NpZ24taW4vZW1haWxcIixcbiAge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgYm9keTogei5vYmplY3Qoe1xuICAgICAgLyoqXG4gICAgICAgKiBFbWFpbCBvZiB0aGUgdXNlclxuICAgICAgICovXG4gICAgICBlbWFpbDogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiRW1haWwgb2YgdGhlIHVzZXJcIlxuICAgICAgfSksXG4gICAgICAvKipcbiAgICAgICAqIFBhc3N3b3JkIG9mIHRoZSB1c2VyXG4gICAgICAgKi9cbiAgICAgIHBhc3N3b3JkOiB6LnN0cmluZygpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJQYXNzd29yZCBvZiB0aGUgdXNlclwiXG4gICAgICB9KSxcbiAgICAgIC8qKlxuICAgICAgICogQ2FsbGJhY2sgVVJMIHRvIHVzZSBhcyBhIHJlZGlyZWN0IGZvciBlbWFpbFxuICAgICAgICogdmVyaWZpY2F0aW9uIGFuZCBmb3IgcG9zc2libGUgcmVkaXJlY3RzXG4gICAgICAgKi9cbiAgICAgIGNhbGxiYWNrVVJMOiB6LnN0cmluZygpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJDYWxsYmFjayBVUkwgdG8gdXNlIGFzIGEgcmVkaXJlY3QgZm9yIGVtYWlsIHZlcmlmaWNhdGlvblwiXG4gICAgICB9KS5vcHRpb25hbCgpLFxuICAgICAgLyoqXG4gICAgICAgKiBJZiB0aGlzIGlzIGZhbHNlLCB0aGUgc2Vzc2lvbiB3aWxsIG5vdCBiZSByZW1lbWJlcmVkXG4gICAgICAgKiBAZGVmYXVsdCB0cnVlXG4gICAgICAgKi9cbiAgICAgIHJlbWVtYmVyTWU6IHouYm9vbGVhbigpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJJZiB0aGlzIGlzIGZhbHNlLCB0aGUgc2Vzc2lvbiB3aWxsIG5vdCBiZSByZW1lbWJlcmVkLiBEZWZhdWx0IGlzIGB0cnVlYC5cIlxuICAgICAgfSkuZGVmYXVsdCh0cnVlKS5vcHRpb25hbCgpXG4gICAgfSksXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgIG9wZW5hcGk6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiU2lnbiBpbiB3aXRoIGVtYWlsIGFuZCBwYXNzd29yZFwiLFxuICAgICAgICByZXNwb25zZXM6IHtcbiAgICAgICAgICBcIjIwMFwiOiB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJTdWNjZXNzIC0gUmV0dXJucyBlaXRoZXIgc2Vzc2lvbiBkZXRhaWxzIG9yIHJlZGlyZWN0IFVSTFwiLFxuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIjoge1xuICAgICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgICAgLy8gdG9kbzogd2UgbmVlZCBzdXBwb3J0IGZvciBtdWx0aXBsZSBzY2hlbWFcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJTZXNzaW9uIHJlc3BvbnNlIHdoZW4gaWRUb2tlbiBpcyBwcm92aWRlZFwiLFxuICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICByZWRpcmVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYm9vbGVhblwiLFxuICAgICAgICAgICAgICAgICAgICAgIGVudW06IFtmYWxzZV1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdG9rZW46IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlNlc3Npb24gdG9rZW5cIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB1cmw6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIm51bGxcIixcbiAgICAgICAgICAgICAgICAgICAgICBudWxsYWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogeyB0eXBlOiBcInN0cmluZ1wiIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDogeyB0eXBlOiBcInN0cmluZ1wiIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG51bGxhYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbGFibGU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBlbWFpbFZlcmlmaWVkOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYm9vbGVhblwiXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogXCJkYXRlLXRpbWVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRBdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFwiZGF0ZS10aW1lXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICBcImlkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImVtYWlsXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImVtYWlsVmVyaWZpZWRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY3JlYXRlZEF0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInVwZGF0ZWRBdFwiXG4gICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFtcInJlZGlyZWN0XCIsIFwidG9rZW5cIiwgXCJ1c2VyXCJdXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBhc3luYyAoY3R4KSA9PiB7XG4gICAgaWYgKCFjdHguY29udGV4dC5vcHRpb25zPy5lbWFpbEFuZFBhc3N3b3JkPy5lbmFibGVkKSB7XG4gICAgICBjdHguY29udGV4dC5sb2dnZXIuZXJyb3IoXG4gICAgICAgIFwiRW1haWwgYW5kIHBhc3N3b3JkIGlzIG5vdCBlbmFibGVkLiBNYWtlIHN1cmUgdG8gZW5hYmxlIGl0IGluIHRoZSBvcHRpb25zIG9uIHlvdSBgYXV0aC50c2AgZmlsZS4gQ2hlY2sgYGh0dHBzOi8vYmV0dGVyLWF1dGguY29tL2RvY3MvYXV0aGVudGljYXRpb24vZW1haWwtcGFzc3dvcmRgIGZvciBtb3JlIVwiXG4gICAgICApO1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBcIkVtYWlsIGFuZCBwYXNzd29yZCBpcyBub3QgZW5hYmxlZFwiXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgeyBlbWFpbCwgcGFzc3dvcmQgfSA9IGN0eC5ib2R5O1xuICAgIGNvbnN0IGlzVmFsaWRFbWFpbCA9IHouc3RyaW5nKCkuZW1haWwoKS5zYWZlUGFyc2UoZW1haWwpO1xuICAgIGlmICghaXNWYWxpZEVtYWlsLnN1Y2Nlc3MpIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5JTlZBTElEX0VNQUlMXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5maW5kVXNlckJ5RW1haWwoZW1haWwsIHtcbiAgICAgIGluY2x1ZGVBY2NvdW50czogdHJ1ZVxuICAgIH0pO1xuICAgIGlmICghdXNlcikge1xuICAgICAgYXdhaXQgY3R4LmNvbnRleHQucGFzc3dvcmQuaGFzaChwYXNzd29yZCk7XG4gICAgICBjdHguY29udGV4dC5sb2dnZXIuZXJyb3IoXCJVc2VyIG5vdCBmb3VuZFwiLCB7IGVtYWlsIH0pO1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiVU5BVVRIT1JJWkVEXCIsIHtcbiAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5JTlZBTElEX0VNQUlMX09SX1BBU1NXT1JEXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgY3JlZGVudGlhbEFjY291bnQgPSB1c2VyLmFjY291bnRzLmZpbmQoXG4gICAgICAoYSkgPT4gYS5wcm92aWRlcklkID09PSBcImNyZWRlbnRpYWxcIlxuICAgICk7XG4gICAgaWYgKCFjcmVkZW50aWFsQWNjb3VudCkge1xuICAgICAgY3R4LmNvbnRleHQubG9nZ2VyLmVycm9yKFwiQ3JlZGVudGlhbCBhY2NvdW50IG5vdCBmb3VuZFwiLCB7IGVtYWlsIH0pO1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiVU5BVVRIT1JJWkVEXCIsIHtcbiAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5JTlZBTElEX0VNQUlMX09SX1BBU1NXT1JEXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgY3VycmVudFBhc3N3b3JkID0gY3JlZGVudGlhbEFjY291bnQ/LnBhc3N3b3JkO1xuICAgIGlmICghY3VycmVudFBhc3N3b3JkKSB7XG4gICAgICBjdHguY29udGV4dC5sb2dnZXIuZXJyb3IoXCJQYXNzd29yZCBub3QgZm91bmRcIiwgeyBlbWFpbCB9KTtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIlVOQVVUSE9SSVpFRFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuSU5WQUxJRF9FTUFJTF9PUl9QQVNTV09SRFxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IHZhbGlkUGFzc3dvcmQgPSBhd2FpdCBjdHguY29udGV4dC5wYXNzd29yZC52ZXJpZnkoe1xuICAgICAgaGFzaDogY3VycmVudFBhc3N3b3JkLFxuICAgICAgcGFzc3dvcmRcbiAgICB9KTtcbiAgICBpZiAoIXZhbGlkUGFzc3dvcmQpIHtcbiAgICAgIGN0eC5jb250ZXh0LmxvZ2dlci5lcnJvcihcIkludmFsaWQgcGFzc3dvcmRcIik7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJVTkFVVEhPUklaRURcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLklOVkFMSURfRU1BSUxfT1JfUEFTU1dPUkRcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoY3R4LmNvbnRleHQub3B0aW9ucz8uZW1haWxBbmRQYXNzd29yZD8ucmVxdWlyZUVtYWlsVmVyaWZpY2F0aW9uICYmICF1c2VyLnVzZXIuZW1haWxWZXJpZmllZCkge1xuICAgICAgaWYgKCFjdHguY29udGV4dC5vcHRpb25zPy5lbWFpbFZlcmlmaWNhdGlvbj8uc2VuZFZlcmlmaWNhdGlvbkVtYWlsKSB7XG4gICAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkZPUkJJRERFTlwiLCB7XG4gICAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5FTUFJTF9OT1RfVkVSSUZJRURcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAoY3R4LmNvbnRleHQub3B0aW9ucz8uZW1haWxWZXJpZmljYXRpb24/LnNlbmRPblNpZ25Jbikge1xuICAgICAgICBjb25zdCB0b2tlbiA9IGF3YWl0IGNyZWF0ZUVtYWlsVmVyaWZpY2F0aW9uVG9rZW4oXG4gICAgICAgICAgY3R4LmNvbnRleHQuc2VjcmV0LFxuICAgICAgICAgIHVzZXIudXNlci5lbWFpbCxcbiAgICAgICAgICB2b2lkIDAsXG4gICAgICAgICAgY3R4LmNvbnRleHQub3B0aW9ucy5lbWFpbFZlcmlmaWNhdGlvbj8uZXhwaXJlc0luXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IHVybCA9IGAke2N0eC5jb250ZXh0LmJhc2VVUkx9L3ZlcmlmeS1lbWFpbD90b2tlbj0ke3Rva2VufSZjYWxsYmFja1VSTD0ke2N0eC5ib2R5LmNhbGxiYWNrVVJMIHx8IFwiL1wifWA7XG4gICAgICAgIGF3YWl0IGN0eC5jb250ZXh0Lm9wdGlvbnMuZW1haWxWZXJpZmljYXRpb24uc2VuZFZlcmlmaWNhdGlvbkVtYWlsKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHVzZXI6IHVzZXIudXNlcixcbiAgICAgICAgICAgIHVybCxcbiAgICAgICAgICAgIHRva2VuXG4gICAgICAgICAgfSxcbiAgICAgICAgICBjdHgucmVxdWVzdFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiRk9SQklEREVOXCIsIHtcbiAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5FTUFJTF9OT1RfVkVSSUZJRURcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmNyZWF0ZVNlc3Npb24oXG4gICAgICB1c2VyLnVzZXIuaWQsXG4gICAgICBjdHgsXG4gICAgICBjdHguYm9keS5yZW1lbWJlck1lID09PSBmYWxzZVxuICAgICk7XG4gICAgaWYgKCFzZXNzaW9uKSB7XG4gICAgICBjdHguY29udGV4dC5sb2dnZXIuZXJyb3IoXCJGYWlsZWQgdG8gY3JlYXRlIHNlc3Npb25cIik7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJVTkFVVEhPUklaRURcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLkZBSUxFRF9UT19DUkVBVEVfU0VTU0lPTlxuICAgICAgfSk7XG4gICAgfVxuICAgIGF3YWl0IHNldFNlc3Npb25Db29raWUoXG4gICAgICBjdHgsXG4gICAgICB7XG4gICAgICAgIHNlc3Npb24sXG4gICAgICAgIHVzZXI6IHVzZXIudXNlclxuICAgICAgfSxcbiAgICAgIGN0eC5ib2R5LnJlbWVtYmVyTWUgPT09IGZhbHNlXG4gICAgKTtcbiAgICByZXR1cm4gY3R4Lmpzb24oe1xuICAgICAgcmVkaXJlY3Q6ICEhY3R4LmJvZHkuY2FsbGJhY2tVUkwsXG4gICAgICB0b2tlbjogc2Vzc2lvbi50b2tlbixcbiAgICAgIHVybDogY3R4LmJvZHkuY2FsbGJhY2tVUkwsXG4gICAgICB1c2VyOiB7XG4gICAgICAgIGlkOiB1c2VyLnVzZXIuaWQsXG4gICAgICAgIGVtYWlsOiB1c2VyLnVzZXIuZW1haWwsXG4gICAgICAgIG5hbWU6IHVzZXIudXNlci5uYW1lLFxuICAgICAgICBpbWFnZTogdXNlci51c2VyLmltYWdlLFxuICAgICAgICBlbWFpbFZlcmlmaWVkOiB1c2VyLnVzZXIuZW1haWxWZXJpZmllZCxcbiAgICAgICAgY3JlYXRlZEF0OiB1c2VyLnVzZXIuY3JlYXRlZEF0LFxuICAgICAgICB1cGRhdGVkQXQ6IHVzZXIudXNlci51cGRhdGVkQXRcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuKTtcblxuY29uc3Qgc2NoZW1hID0gei5vYmplY3Qoe1xuICBjb2RlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIGVycm9yOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIGRldmljZV9pZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBlcnJvcl9kZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBzdGF0ZTogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICB1c2VyOiB6LnN0cmluZygpLm9wdGlvbmFsKClcbn0pO1xuY29uc3QgY2FsbGJhY2tPQXV0aCA9IGNyZWF0ZUF1dGhFbmRwb2ludChcbiAgXCIvY2FsbGJhY2svOmlkXCIsXG4gIHtcbiAgICBtZXRob2Q6IFtcIkdFVFwiLCBcIlBPU1RcIl0sXG4gICAgYm9keTogc2NoZW1hLm9wdGlvbmFsKCksXG4gICAgcXVlcnk6IHNjaGVtYS5vcHRpb25hbCgpLFxuICAgIG1ldGFkYXRhOiBISURFX01FVEFEQVRBXG4gIH0sXG4gIGFzeW5jIChjKSA9PiB7XG4gICAgbGV0IHF1ZXJ5T3JCb2R5O1xuICAgIGNvbnN0IGRlZmF1bHRFcnJvclVSTCA9IGMuY29udGV4dC5vcHRpb25zLm9uQVBJRXJyb3I/LmVycm9yVVJMIHx8IGAke2MuY29udGV4dC5iYXNlVVJMfS9lcnJvcmA7XG4gICAgdHJ5IHtcbiAgICAgIGlmIChjLm1ldGhvZCA9PT0gXCJHRVRcIikge1xuICAgICAgICBxdWVyeU9yQm9keSA9IHNjaGVtYS5wYXJzZShjLnF1ZXJ5KTtcbiAgICAgIH0gZWxzZSBpZiAoYy5tZXRob2QgPT09IFwiUE9TVFwiKSB7XG4gICAgICAgIHF1ZXJ5T3JCb2R5ID0gc2NoZW1hLnBhcnNlKGMuYm9keSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbnN1cHBvcnRlZCBtZXRob2RcIik7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgYy5jb250ZXh0LmxvZ2dlci5lcnJvcihcIklOVkFMSURfQ0FMTEJBQ0tfUkVRVUVTVFwiLCBlKTtcbiAgICAgIHRocm93IGMucmVkaXJlY3QoYCR7ZGVmYXVsdEVycm9yVVJMfT9lcnJvcj1pbnZhbGlkX2NhbGxiYWNrX3JlcXVlc3RgKTtcbiAgICB9XG4gICAgY29uc3QgeyBjb2RlLCBlcnJvciwgc3RhdGUsIGVycm9yX2Rlc2NyaXB0aW9uLCBkZXZpY2VfaWQgfSA9IHF1ZXJ5T3JCb2R5O1xuICAgIGlmIChlcnJvcikge1xuICAgICAgdGhyb3cgYy5yZWRpcmVjdChcbiAgICAgICAgYCR7ZGVmYXVsdEVycm9yVVJMfT9lcnJvcj0ke2Vycm9yfSZlcnJvcl9kZXNjcmlwdGlvbj0ke2Vycm9yX2Rlc2NyaXB0aW9ufWBcbiAgICAgICk7XG4gICAgfVxuICAgIGlmICghc3RhdGUpIHtcbiAgICAgIGMuY29udGV4dC5sb2dnZXIuZXJyb3IoXCJTdGF0ZSBub3QgZm91bmRcIiwgZXJyb3IpO1xuICAgICAgdGhyb3cgYy5yZWRpcmVjdChgJHtkZWZhdWx0RXJyb3JVUkx9P2Vycm9yPXN0YXRlX25vdF9mb3VuZGApO1xuICAgIH1cbiAgICBjb25zdCB7XG4gICAgICBjb2RlVmVyaWZpZXIsXG4gICAgICBjYWxsYmFja1VSTCxcbiAgICAgIGxpbmssXG4gICAgICBlcnJvclVSTCxcbiAgICAgIG5ld1VzZXJVUkwsXG4gICAgICByZXF1ZXN0U2lnblVwXG4gICAgfSA9IGF3YWl0IHBhcnNlU3RhdGUoYyk7XG4gICAgZnVuY3Rpb24gcmVkaXJlY3RPbkVycm9yKGVycm9yMikge1xuICAgICAgbGV0IHVybCA9IGVycm9yVVJMIHx8IGRlZmF1bHRFcnJvclVSTDtcbiAgICAgIGlmICh1cmwuaW5jbHVkZXMoXCI/XCIpKSB7XG4gICAgICAgIHVybCA9IGAke3VybH0mZXJyb3I9JHtlcnJvcjJ9YDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHVybCA9IGAke3VybH0/ZXJyb3I9JHtlcnJvcjJ9YDtcbiAgICAgIH1cbiAgICAgIHRocm93IGMucmVkaXJlY3QodXJsKTtcbiAgICB9XG4gICAgaWYgKCFjb2RlKSB7XG4gICAgICBjLmNvbnRleHQubG9nZ2VyLmVycm9yKFwiQ29kZSBub3QgZm91bmRcIik7XG4gICAgICB0aHJvdyByZWRpcmVjdE9uRXJyb3IoXCJub19jb2RlXCIpO1xuICAgIH1cbiAgICBjb25zdCBwcm92aWRlciA9IGMuY29udGV4dC5zb2NpYWxQcm92aWRlcnMuZmluZChcbiAgICAgIChwKSA9PiBwLmlkID09PSBjLnBhcmFtcy5pZFxuICAgICk7XG4gICAgaWYgKCFwcm92aWRlcikge1xuICAgICAgYy5jb250ZXh0LmxvZ2dlci5lcnJvcihcbiAgICAgICAgXCJPYXV0aCBwcm92aWRlciB3aXRoIGlkXCIsXG4gICAgICAgIGMucGFyYW1zLmlkLFxuICAgICAgICBcIm5vdCBmb3VuZFwiXG4gICAgICApO1xuICAgICAgdGhyb3cgcmVkaXJlY3RPbkVycm9yKFwib2F1dGhfcHJvdmlkZXJfbm90X2ZvdW5kXCIpO1xuICAgIH1cbiAgICBsZXQgdG9rZW5zO1xuICAgIHRyeSB7XG4gICAgICB0b2tlbnMgPSBhd2FpdCBwcm92aWRlci52YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlKHtcbiAgICAgICAgY29kZSxcbiAgICAgICAgY29kZVZlcmlmaWVyLFxuICAgICAgICBkZXZpY2VJZDogZGV2aWNlX2lkLFxuICAgICAgICByZWRpcmVjdFVSSTogYCR7Yy5jb250ZXh0LmJhc2VVUkx9L2NhbGxiYWNrLyR7cHJvdmlkZXIuaWR9YFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgYy5jb250ZXh0LmxvZ2dlci5lcnJvcihcIlwiLCBlKTtcbiAgICAgIHRocm93IHJlZGlyZWN0T25FcnJvcihcImludmFsaWRfY29kZVwiKTtcbiAgICB9XG4gICAgY29uc3QgdXNlckluZm8gPSBhd2FpdCBwcm92aWRlci5nZXRVc2VySW5mbyh7XG4gICAgICAuLi50b2tlbnMsXG4gICAgICB1c2VyOiBjLmJvZHk/LnVzZXIgPyBzYWZlSlNPTlBhcnNlKGMuYm9keS51c2VyKSA6IHZvaWQgMFxuICAgIH0pLnRoZW4oKHJlcykgPT4gcmVzPy51c2VyKTtcbiAgICBpZiAoIXVzZXJJbmZvKSB7XG4gICAgICBjLmNvbnRleHQubG9nZ2VyLmVycm9yKFwiVW5hYmxlIHRvIGdldCB1c2VyIGluZm9cIik7XG4gICAgICByZXR1cm4gcmVkaXJlY3RPbkVycm9yKFwidW5hYmxlX3RvX2dldF91c2VyX2luZm9cIik7XG4gICAgfVxuICAgIGlmICghY2FsbGJhY2tVUkwpIHtcbiAgICAgIGMuY29udGV4dC5sb2dnZXIuZXJyb3IoXCJObyBjYWxsYmFjayBVUkwgZm91bmRcIik7XG4gICAgICB0aHJvdyByZWRpcmVjdE9uRXJyb3IoXCJub19jYWxsYmFja191cmxcIik7XG4gICAgfVxuICAgIGlmIChsaW5rKSB7XG4gICAgICBjb25zdCB0cnVzdGVkUHJvdmlkZXJzID0gYy5jb250ZXh0Lm9wdGlvbnMuYWNjb3VudD8uYWNjb3VudExpbmtpbmc/LnRydXN0ZWRQcm92aWRlcnM7XG4gICAgICBjb25zdCBpc1RydXN0ZWRQcm92aWRlciA9IHRydXN0ZWRQcm92aWRlcnM/LmluY2x1ZGVzKFxuICAgICAgICBwcm92aWRlci5pZFxuICAgICAgKTtcbiAgICAgIGlmICghaXNUcnVzdGVkUHJvdmlkZXIgJiYgIXVzZXJJbmZvLmVtYWlsVmVyaWZpZWQgfHwgYy5jb250ZXh0Lm9wdGlvbnMuYWNjb3VudD8uYWNjb3VudExpbmtpbmc/LmVuYWJsZWQgPT09IGZhbHNlKSB7XG4gICAgICAgIGMuY29udGV4dC5sb2dnZXIuZXJyb3IoXCJVbmFibGUgdG8gbGluayBhY2NvdW50IC0gdW50cnVzdGVkIHByb3ZpZGVyXCIpO1xuICAgICAgICByZXR1cm4gcmVkaXJlY3RPbkVycm9yKFwidW5hYmxlX3RvX2xpbmtfYWNjb3VudFwiKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGV4aXN0aW5nQWNjb3VudCA9IGF3YWl0IGMuY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZmluZEFjY291bnQoXG4gICAgICAgIHVzZXJJbmZvLmlkXG4gICAgICApO1xuICAgICAgaWYgKGV4aXN0aW5nQWNjb3VudCkge1xuICAgICAgICBpZiAoZXhpc3RpbmdBY2NvdW50LnVzZXJJZC50b1N0cmluZygpICE9PSBsaW5rLnVzZXJJZC50b1N0cmluZygpKSB7XG4gICAgICAgICAgcmV0dXJuIHJlZGlyZWN0T25FcnJvcihcImFjY291bnRfYWxyZWFkeV9saW5rZWRfdG9fZGlmZmVyZW50X3VzZXJcIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdXBkYXRlRGF0YSA9IE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgICBPYmplY3QuZW50cmllcyh7XG4gICAgICAgICAgICBhY2Nlc3NUb2tlbjogYXdhaXQgc2V0VG9rZW5VdGlsKHRva2Vucy5hY2Nlc3NUb2tlbiwgYy5jb250ZXh0KSxcbiAgICAgICAgICAgIHJlZnJlc2hUb2tlbjogYXdhaXQgc2V0VG9rZW5VdGlsKHRva2Vucy5yZWZyZXNoVG9rZW4sIGMuY29udGV4dCksXG4gICAgICAgICAgICBpZFRva2VuOiB0b2tlbnMuaWRUb2tlbixcbiAgICAgICAgICAgIGFjY2Vzc1Rva2VuRXhwaXJlc0F0OiB0b2tlbnMuYWNjZXNzVG9rZW5FeHBpcmVzQXQsXG4gICAgICAgICAgICByZWZyZXNoVG9rZW5FeHBpcmVzQXQ6IHRva2Vucy5yZWZyZXNoVG9rZW5FeHBpcmVzQXQsXG4gICAgICAgICAgICBzY29wZTogdG9rZW5zLnNjb3Blcz8uam9pbihcIixcIilcbiAgICAgICAgICB9KS5maWx0ZXIoKFtfLCB2YWx1ZV0pID0+IHZhbHVlICE9PSB2b2lkIDApXG4gICAgICAgICk7XG4gICAgICAgIGF3YWl0IGMuY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIudXBkYXRlQWNjb3VudChcbiAgICAgICAgICBleGlzdGluZ0FjY291bnQuaWQsXG4gICAgICAgICAgdXBkYXRlRGF0YVxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgbmV3QWNjb3VudCA9IGF3YWl0IGMuY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuY3JlYXRlQWNjb3VudChcbiAgICAgICAgICB7XG4gICAgICAgICAgICB1c2VySWQ6IGxpbmsudXNlcklkLFxuICAgICAgICAgICAgcHJvdmlkZXJJZDogcHJvdmlkZXIuaWQsXG4gICAgICAgICAgICBhY2NvdW50SWQ6IHVzZXJJbmZvLmlkLFxuICAgICAgICAgICAgLi4udG9rZW5zLFxuICAgICAgICAgICAgYWNjZXNzVG9rZW46IGF3YWl0IHNldFRva2VuVXRpbCh0b2tlbnMuYWNjZXNzVG9rZW4sIGMuY29udGV4dCksXG4gICAgICAgICAgICByZWZyZXNoVG9rZW46IGF3YWl0IHNldFRva2VuVXRpbCh0b2tlbnMucmVmcmVzaFRva2VuLCBjLmNvbnRleHQpLFxuICAgICAgICAgICAgc2NvcGU6IHRva2Vucy5zY29wZXM/LmpvaW4oXCIsXCIpXG4gICAgICAgICAgfSxcbiAgICAgICAgICBjXG4gICAgICAgICk7XG4gICAgICAgIGlmICghbmV3QWNjb3VudCkge1xuICAgICAgICAgIHJldHVybiByZWRpcmVjdE9uRXJyb3IoXCJ1bmFibGVfdG9fbGlua19hY2NvdW50XCIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBsZXQgdG9SZWRpcmVjdFRvMjtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHVybCA9IGNhbGxiYWNrVVJMO1xuICAgICAgICB0b1JlZGlyZWN0VG8yID0gdXJsLnRvU3RyaW5nKCk7XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgdG9SZWRpcmVjdFRvMiA9IGNhbGxiYWNrVVJMO1xuICAgICAgfVxuICAgICAgdGhyb3cgYy5yZWRpcmVjdCh0b1JlZGlyZWN0VG8yKTtcbiAgICB9XG4gICAgaWYgKCF1c2VySW5mby5lbWFpbCkge1xuICAgICAgYy5jb250ZXh0LmxvZ2dlci5lcnJvcihcbiAgICAgICAgXCJQcm92aWRlciBkaWQgbm90IHJldHVybiBlbWFpbC4gVGhpcyBjb3VsZCBiZSBkdWUgdG8gbWlzY29uZmlndXJhdGlvbiBpbiB0aGUgcHJvdmlkZXIgc2V0dGluZ3MuXCJcbiAgICAgICk7XG4gICAgICByZXR1cm4gcmVkaXJlY3RPbkVycm9yKFwiZW1haWxfbm90X2ZvdW5kXCIpO1xuICAgIH1cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBoYW5kbGVPQXV0aFVzZXJJbmZvKGMsIHtcbiAgICAgIHVzZXJJbmZvOiB7XG4gICAgICAgIC4uLnVzZXJJbmZvLFxuICAgICAgICBlbWFpbDogdXNlckluZm8uZW1haWwsXG4gICAgICAgIG5hbWU6IHVzZXJJbmZvLm5hbWUgfHwgdXNlckluZm8uZW1haWxcbiAgICAgIH0sXG4gICAgICBhY2NvdW50OiB7XG4gICAgICAgIHByb3ZpZGVySWQ6IHByb3ZpZGVyLmlkLFxuICAgICAgICBhY2NvdW50SWQ6IHVzZXJJbmZvLmlkLFxuICAgICAgICAuLi50b2tlbnMsXG4gICAgICAgIHNjb3BlOiB0b2tlbnMuc2NvcGVzPy5qb2luKFwiLFwiKVxuICAgICAgfSxcbiAgICAgIGNhbGxiYWNrVVJMLFxuICAgICAgZGlzYWJsZVNpZ25VcDogcHJvdmlkZXIuZGlzYWJsZUltcGxpY2l0U2lnblVwICYmICFyZXF1ZXN0U2lnblVwIHx8IHByb3ZpZGVyLm9wdGlvbnM/LmRpc2FibGVTaWduVXAsXG4gICAgICBvdmVycmlkZVVzZXJJbmZvOiBwcm92aWRlci5vcHRpb25zPy5vdmVycmlkZVVzZXJJbmZvT25TaWduSW5cbiAgICB9KTtcbiAgICBpZiAocmVzdWx0LmVycm9yKSB7XG4gICAgICBjLmNvbnRleHQubG9nZ2VyLmVycm9yKHJlc3VsdC5lcnJvci5zcGxpdChcIiBcIikuam9pbihcIl9cIikpO1xuICAgICAgcmV0dXJuIHJlZGlyZWN0T25FcnJvcihyZXN1bHQuZXJyb3Iuc3BsaXQoXCIgXCIpLmpvaW4oXCJfXCIpKTtcbiAgICB9XG4gICAgY29uc3QgeyBzZXNzaW9uLCB1c2VyIH0gPSByZXN1bHQuZGF0YTtcbiAgICBhd2FpdCBzZXRTZXNzaW9uQ29va2llKGMsIHtcbiAgICAgIHNlc3Npb24sXG4gICAgICB1c2VyXG4gICAgfSk7XG4gICAgbGV0IHRvUmVkaXJlY3RUbztcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXJsID0gcmVzdWx0LmlzUmVnaXN0ZXIgPyBuZXdVc2VyVVJMIHx8IGNhbGxiYWNrVVJMIDogY2FsbGJhY2tVUkw7XG4gICAgICB0b1JlZGlyZWN0VG8gPSB1cmwudG9TdHJpbmcoKTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHRvUmVkaXJlY3RUbyA9IHJlc3VsdC5pc1JlZ2lzdGVyID8gbmV3VXNlclVSTCB8fCBjYWxsYmFja1VSTCA6IGNhbGxiYWNrVVJMO1xuICAgIH1cbiAgICB0aHJvdyBjLnJlZGlyZWN0KHRvUmVkaXJlY3RUbyk7XG4gIH1cbik7XG5cbmNvbnN0IHNpZ25PdXQgPSBjcmVhdGVBdXRoRW5kcG9pbnQoXG4gIFwiL3NpZ24tb3V0XCIsXG4gIHtcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgIHJlcXVpcmVIZWFkZXJzOiB0cnVlLFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICBvcGVuYXBpOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlNpZ24gb3V0IHRoZSBjdXJyZW50IHVzZXJcIixcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgXCIyMDBcIjoge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiU3VjY2Vzc1wiLFxuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIjoge1xuICAgICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzczoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYm9vbGVhblwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGFzeW5jIChjdHgpID0+IHtcbiAgICBjb25zdCBzZXNzaW9uQ29va2llVG9rZW4gPSBhd2FpdCBjdHguZ2V0U2lnbmVkQ29va2llKFxuICAgICAgY3R4LmNvbnRleHQuYXV0aENvb2tpZXMuc2Vzc2lvblRva2VuLm5hbWUsXG4gICAgICBjdHguY29udGV4dC5zZWNyZXRcbiAgICApO1xuICAgIGlmICghc2Vzc2lvbkNvb2tpZVRva2VuKSB7XG4gICAgICBkZWxldGVTZXNzaW9uQ29va2llKGN0eCk7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuRkFJTEVEX1RPX0dFVF9TRVNTSU9OXG4gICAgICB9KTtcbiAgICB9XG4gICAgYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmRlbGV0ZVNlc3Npb24oc2Vzc2lvbkNvb2tpZVRva2VuKTtcbiAgICBkZWxldGVTZXNzaW9uQ29va2llKGN0eCk7XG4gICAgcmV0dXJuIGN0eC5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWVcbiAgICB9KTtcbiAgfVxuKTtcblxuZnVuY3Rpb24gcmVkaXJlY3RFcnJvcihjdHgsIGNhbGxiYWNrVVJMLCBxdWVyeSkge1xuICBjb25zdCB1cmwgPSBjYWxsYmFja1VSTCA/IG5ldyBVUkwoY2FsbGJhY2tVUkwsIGN0eC5iYXNlVVJMKSA6IG5ldyBVUkwoYCR7Y3R4LmJhc2VVUkx9L2Vycm9yYCk7XG4gIGlmIChxdWVyeSlcbiAgICBPYmplY3QuZW50cmllcyhxdWVyeSkuZm9yRWFjaCgoW2ssIHZdKSA9PiB1cmwuc2VhcmNoUGFyYW1zLnNldChrLCB2KSk7XG4gIHJldHVybiB1cmwuaHJlZjtcbn1cbmZ1bmN0aW9uIHJlZGlyZWN0Q2FsbGJhY2soY3R4LCBjYWxsYmFja1VSTCwgcXVlcnkpIHtcbiAgY29uc3QgdXJsID0gbmV3IFVSTChjYWxsYmFja1VSTCwgY3R4LmJhc2VVUkwpO1xuICBpZiAocXVlcnkpXG4gICAgT2JqZWN0LmVudHJpZXMocXVlcnkpLmZvckVhY2goKFtrLCB2XSkgPT4gdXJsLnNlYXJjaFBhcmFtcy5zZXQoaywgdikpO1xuICByZXR1cm4gdXJsLmhyZWY7XG59XG5jb25zdCByZXF1ZXN0UGFzc3dvcmRSZXNldCA9IGNyZWF0ZUF1dGhFbmRwb2ludChcbiAgXCIvcmVxdWVzdC1wYXNzd29yZC1yZXNldFwiLFxuICB7XG4gICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICBib2R5OiB6Lm9iamVjdCh7XG4gICAgICAvKipcbiAgICAgICAqIFRoZSBlbWFpbCBhZGRyZXNzIG9mIHRoZSB1c2VyIHRvIHNlbmQgYSBwYXNzd29yZCByZXNldCBlbWFpbCB0by5cbiAgICAgICAqL1xuICAgICAgZW1haWw6IHouZW1haWwoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIGVtYWlsIGFkZHJlc3Mgb2YgdGhlIHVzZXIgdG8gc2VuZCBhIHBhc3N3b3JkIHJlc2V0IGVtYWlsIHRvXCJcbiAgICAgIH0pLFxuICAgICAgLyoqXG4gICAgICAgKiBUaGUgVVJMIHRvIHJlZGlyZWN0IHRoZSB1c2VyIHRvIHJlc2V0IHRoZWlyIHBhc3N3b3JkLlxuICAgICAgICogSWYgdGhlIHRva2VuIGlzbid0IHZhbGlkIG9yIGV4cGlyZWQsIGl0J2xsIGJlIHJlZGlyZWN0ZWQgd2l0aCBhIHF1ZXJ5IHBhcmFtZXRlciBgP1xuICAgICAgICogZXJyb3I9SU5WQUxJRF9UT0tFTmAuIElmIHRoZSB0b2tlbiBpcyB2YWxpZCwgaXQnbGwgYmUgcmVkaXJlY3RlZCB3aXRoIGEgcXVlcnkgcGFyYW1ldGVyIGA/XG4gICAgICAgKiB0b2tlbj1WQUxJRF9UT0tFTlxuICAgICAgICovXG4gICAgICByZWRpcmVjdFRvOiB6LnN0cmluZygpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgVVJMIHRvIHJlZGlyZWN0IHRoZSB1c2VyIHRvIHJlc2V0IHRoZWlyIHBhc3N3b3JkLiBJZiB0aGUgdG9rZW4gaXNuJ3QgdmFsaWQgb3IgZXhwaXJlZCwgaXQnbGwgYmUgcmVkaXJlY3RlZCB3aXRoIGEgcXVlcnkgcGFyYW1ldGVyIGA/ZXJyb3I9SU5WQUxJRF9UT0tFTmAuIElmIHRoZSB0b2tlbiBpcyB2YWxpZCwgaXQnbGwgYmUgcmVkaXJlY3RlZCB3aXRoIGEgcXVlcnkgcGFyYW1ldGVyIGA/dG9rZW49VkFMSURfVE9LRU5cIlxuICAgICAgfSkub3B0aW9uYWwoKVxuICAgIH0pLFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICBvcGVuYXBpOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlNlbmQgYSBwYXNzd29yZCByZXNldCBlbWFpbCB0byB0aGUgdXNlclwiLFxuICAgICAgICByZXNwb25zZXM6IHtcbiAgICAgICAgICBcIjIwMFwiOiB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJTdWNjZXNzXCIsXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiOiB7XG4gICAgICAgICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImJvb2xlYW5cIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIlxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBhc3luYyAoY3R4KSA9PiB7XG4gICAgaWYgKCFjdHguY29udGV4dC5vcHRpb25zLmVtYWlsQW5kUGFzc3dvcmQ/LnNlbmRSZXNldFBhc3N3b3JkKSB7XG4gICAgICBjdHguY29udGV4dC5sb2dnZXIuZXJyb3IoXG4gICAgICAgIFwiUmVzZXQgcGFzc3dvcmQgaXNuJ3QgZW5hYmxlZC5QbGVhc2UgcGFzcyBhbiBlbWFpbEFuZFBhc3N3b3JkLnNlbmRSZXNldFBhc3N3b3JkIGZ1bmN0aW9uIGluIHlvdXIgYXV0aCBjb25maWchXCJcbiAgICAgICk7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IFwiUmVzZXQgcGFzc3dvcmQgaXNuJ3QgZW5hYmxlZFwiXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgeyBlbWFpbCwgcmVkaXJlY3RUbyB9ID0gY3R4LmJvZHk7XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5maW5kVXNlckJ5RW1haWwoZW1haWwsIHtcbiAgICAgIGluY2x1ZGVBY2NvdW50czogdHJ1ZVxuICAgIH0pO1xuICAgIGlmICghdXNlcikge1xuICAgICAgY3R4LmNvbnRleHQubG9nZ2VyLmVycm9yKFwiUmVzZXQgUGFzc3dvcmQ6IFVzZXIgbm90IGZvdW5kXCIsIHsgZW1haWwgfSk7XG4gICAgICByZXR1cm4gY3R4Lmpzb24oe1xuICAgICAgICBzdGF0dXM6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6IFwiSWYgdGhpcyBlbWFpbCBleGlzdHMgaW4gb3VyIHN5c3RlbSwgY2hlY2sgeW91ciBlbWFpbCBmb3IgdGhlIHJlc2V0IGxpbmtcIlxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IGRlZmF1bHRFeHBpcmVzSW4gPSA2MCAqIDYwICogMTtcbiAgICBjb25zdCBleHBpcmVzQXQgPSBnZXREYXRlKFxuICAgICAgY3R4LmNvbnRleHQub3B0aW9ucy5lbWFpbEFuZFBhc3N3b3JkLnJlc2V0UGFzc3dvcmRUb2tlbkV4cGlyZXNJbiB8fCBkZWZhdWx0RXhwaXJlc0luLFxuICAgICAgXCJzZWNcIlxuICAgICk7XG4gICAgY29uc3QgdmVyaWZpY2F0aW9uVG9rZW4gPSBnZW5lcmF0ZUlkKDI0KTtcbiAgICBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuY3JlYXRlVmVyaWZpY2F0aW9uVmFsdWUoXG4gICAgICB7XG4gICAgICAgIHZhbHVlOiB1c2VyLnVzZXIuaWQsXG4gICAgICAgIGlkZW50aWZpZXI6IGByZXNldC1wYXNzd29yZDoke3ZlcmlmaWNhdGlvblRva2VufWAsXG4gICAgICAgIGV4cGlyZXNBdFxuICAgICAgfSxcbiAgICAgIGN0eFxuICAgICk7XG4gICAgY29uc3QgY2FsbGJhY2tVUkwgPSByZWRpcmVjdFRvID8gZW5jb2RlVVJJQ29tcG9uZW50KHJlZGlyZWN0VG8pIDogXCJcIjtcbiAgICBjb25zdCB1cmwgPSBgJHtjdHguY29udGV4dC5iYXNlVVJMfS9yZXNldC1wYXNzd29yZC8ke3ZlcmlmaWNhdGlvblRva2VufT9jYWxsYmFja1VSTD0ke2NhbGxiYWNrVVJMfWA7XG4gICAgYXdhaXQgY3R4LmNvbnRleHQub3B0aW9ucy5lbWFpbEFuZFBhc3N3b3JkLnNlbmRSZXNldFBhc3N3b3JkKFxuICAgICAge1xuICAgICAgICB1c2VyOiB1c2VyLnVzZXIsXG4gICAgICAgIHVybCxcbiAgICAgICAgdG9rZW46IHZlcmlmaWNhdGlvblRva2VuXG4gICAgICB9LFxuICAgICAgY3R4LnJlcXVlc3RcbiAgICApO1xuICAgIHJldHVybiBjdHguanNvbih7XG4gICAgICBzdGF0dXM6IHRydWVcbiAgICB9KTtcbiAgfVxuKTtcbmNvbnN0IGZvcmdldFBhc3N3b3JkID0gY3JlYXRlQXV0aEVuZHBvaW50KFxuICBcIi9mb3JnZXQtcGFzc3dvcmRcIixcbiAge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgYm9keTogei5vYmplY3Qoe1xuICAgICAgLyoqXG4gICAgICAgKiBUaGUgZW1haWwgYWRkcmVzcyBvZiB0aGUgdXNlciB0byBzZW5kIGEgcGFzc3dvcmQgcmVzZXQgZW1haWwgdG8uXG4gICAgICAgKi9cbiAgICAgIGVtYWlsOiB6LnN0cmluZygpLmVtYWlsKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBlbWFpbCBhZGRyZXNzIG9mIHRoZSB1c2VyIHRvIHNlbmQgYSBwYXNzd29yZCByZXNldCBlbWFpbCB0b1wiXG4gICAgICB9KSxcbiAgICAgIC8qKlxuICAgICAgICogVGhlIFVSTCB0byByZWRpcmVjdCB0aGUgdXNlciB0byByZXNldCB0aGVpciBwYXNzd29yZC5cbiAgICAgICAqIElmIHRoZSB0b2tlbiBpc24ndCB2YWxpZCBvciBleHBpcmVkLCBpdCdsbCBiZSByZWRpcmVjdGVkIHdpdGggYSBxdWVyeSBwYXJhbWV0ZXIgYD9cbiAgICAgICAqIGVycm9yPUlOVkFMSURfVE9LRU5gLiBJZiB0aGUgdG9rZW4gaXMgdmFsaWQsIGl0J2xsIGJlIHJlZGlyZWN0ZWQgd2l0aCBhIHF1ZXJ5IHBhcmFtZXRlciBgP1xuICAgICAgICogdG9rZW49VkFMSURfVE9LRU5cbiAgICAgICAqL1xuICAgICAgcmVkaXJlY3RUbzogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIFVSTCB0byByZWRpcmVjdCB0aGUgdXNlciB0byByZXNldCB0aGVpciBwYXNzd29yZC4gSWYgdGhlIHRva2VuIGlzbid0IHZhbGlkIG9yIGV4cGlyZWQsIGl0J2xsIGJlIHJlZGlyZWN0ZWQgd2l0aCBhIHF1ZXJ5IHBhcmFtZXRlciBgP2Vycm9yPUlOVkFMSURfVE9LRU5gLiBJZiB0aGUgdG9rZW4gaXMgdmFsaWQsIGl0J2xsIGJlIHJlZGlyZWN0ZWQgd2l0aCBhIHF1ZXJ5IHBhcmFtZXRlciBgP3Rva2VuPVZBTElEX1RPS0VOXCJcbiAgICAgIH0pLm9wdGlvbmFsKClcbiAgICB9KSxcbiAgICBtZXRhZGF0YToge1xuICAgICAgb3BlbmFwaToge1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJTZW5kIGEgcGFzc3dvcmQgcmVzZXQgZW1haWwgdG8gdGhlIHVzZXJcIixcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgXCIyMDBcIjoge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiU3VjY2Vzc1wiLFxuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIjoge1xuICAgICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJib29sZWFuXCJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZToge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgYXN5bmMgKGN0eCkgPT4ge1xuICAgIGlmICghY3R4LmNvbnRleHQub3B0aW9ucy5lbWFpbEFuZFBhc3N3b3JkPy5zZW5kUmVzZXRQYXNzd29yZCkge1xuICAgICAgY3R4LmNvbnRleHQubG9nZ2VyLmVycm9yKFxuICAgICAgICBcIlJlc2V0IHBhc3N3b3JkIGlzbid0IGVuYWJsZWQuUGxlYXNlIHBhc3MgYW4gZW1haWxBbmRQYXNzd29yZC5zZW5kUmVzZXRQYXNzd29yZCBmdW5jdGlvbiBpbiB5b3VyIGF1dGggY29uZmlnIVwiXG4gICAgICApO1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBcIlJlc2V0IHBhc3N3b3JkIGlzbid0IGVuYWJsZWRcIlxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IHsgZW1haWwsIHJlZGlyZWN0VG8gfSA9IGN0eC5ib2R5O1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZmluZFVzZXJCeUVtYWlsKGVtYWlsLCB7XG4gICAgICBpbmNsdWRlQWNjb3VudHM6IHRydWVcbiAgICB9KTtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIGN0eC5jb250ZXh0LmxvZ2dlci5lcnJvcihcIlJlc2V0IFBhc3N3b3JkOiBVc2VyIG5vdCBmb3VuZFwiLCB7IGVtYWlsIH0pO1xuICAgICAgcmV0dXJuIGN0eC5qc29uKHtcbiAgICAgICAgc3RhdHVzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiBcIklmIHRoaXMgZW1haWwgZXhpc3RzIGluIG91ciBzeXN0ZW0sIGNoZWNrIHlvdXIgZW1haWwgZm9yIHRoZSByZXNldCBsaW5rXCJcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBkZWZhdWx0RXhwaXJlc0luID0gNjAgKiA2MCAqIDE7XG4gICAgY29uc3QgZXhwaXJlc0F0ID0gZ2V0RGF0ZShcbiAgICAgIGN0eC5jb250ZXh0Lm9wdGlvbnMuZW1haWxBbmRQYXNzd29yZC5yZXNldFBhc3N3b3JkVG9rZW5FeHBpcmVzSW4gfHwgZGVmYXVsdEV4cGlyZXNJbixcbiAgICAgIFwic2VjXCJcbiAgICApO1xuICAgIGNvbnN0IHZlcmlmaWNhdGlvblRva2VuID0gZ2VuZXJhdGVJZCgyNCk7XG4gICAgYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmNyZWF0ZVZlcmlmaWNhdGlvblZhbHVlKFxuICAgICAge1xuICAgICAgICB2YWx1ZTogdXNlci51c2VyLmlkLFxuICAgICAgICBpZGVudGlmaWVyOiBgcmVzZXQtcGFzc3dvcmQ6JHt2ZXJpZmljYXRpb25Ub2tlbn1gLFxuICAgICAgICBleHBpcmVzQXRcbiAgICAgIH0sXG4gICAgICBjdHhcbiAgICApO1xuICAgIGNvbnN0IGNhbGxiYWNrVVJMID0gcmVkaXJlY3RUbyA/IGVuY29kZVVSSUNvbXBvbmVudChyZWRpcmVjdFRvKSA6IFwiXCI7XG4gICAgY29uc3QgdXJsID0gYCR7Y3R4LmNvbnRleHQuYmFzZVVSTH0vcmVzZXQtcGFzc3dvcmQvJHt2ZXJpZmljYXRpb25Ub2tlbn0/Y2FsbGJhY2tVUkw9JHtjYWxsYmFja1VSTH1gO1xuICAgIGF3YWl0IGN0eC5jb250ZXh0Lm9wdGlvbnMuZW1haWxBbmRQYXNzd29yZC5zZW5kUmVzZXRQYXNzd29yZChcbiAgICAgIHtcbiAgICAgICAgdXNlcjogdXNlci51c2VyLFxuICAgICAgICB1cmwsXG4gICAgICAgIHRva2VuOiB2ZXJpZmljYXRpb25Ub2tlblxuICAgICAgfSxcbiAgICAgIGN0eC5yZXF1ZXN0XG4gICAgKTtcbiAgICByZXR1cm4gY3R4Lmpzb24oe1xuICAgICAgc3RhdHVzOiB0cnVlXG4gICAgfSk7XG4gIH1cbik7XG5jb25zdCByZXF1ZXN0UGFzc3dvcmRSZXNldENhbGxiYWNrID0gY3JlYXRlQXV0aEVuZHBvaW50KFxuICBcIi9yZXNldC1wYXNzd29yZC86dG9rZW5cIixcbiAge1xuICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICBxdWVyeTogei5vYmplY3Qoe1xuICAgICAgY2FsbGJhY2tVUkw6IHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBVUkwgdG8gcmVkaXJlY3QgdGhlIHVzZXIgdG8gcmVzZXQgdGhlaXIgcGFzc3dvcmRcIlxuICAgICAgfSlcbiAgICB9KSxcbiAgICB1c2U6IFtvcmlnaW5DaGVjaygoY3R4KSA9PiBjdHgucXVlcnkuY2FsbGJhY2tVUkwpXSxcbiAgICBtZXRhZGF0YToge1xuICAgICAgb3BlbmFwaToge1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJSZWRpcmVjdHMgdGhlIHVzZXIgdG8gdGhlIGNhbGxiYWNrIFVSTCB3aXRoIHRoZSB0b2tlblwiLFxuICAgICAgICByZXNwb25zZXM6IHtcbiAgICAgICAgICBcIjIwMFwiOiB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJTdWNjZXNzXCIsXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiOiB7XG4gICAgICAgICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICB0b2tlbjoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgYXN5bmMgKGN0eCkgPT4ge1xuICAgIGNvbnN0IHsgdG9rZW4gfSA9IGN0eC5wYXJhbXM7XG4gICAgY29uc3QgeyBjYWxsYmFja1VSTCB9ID0gY3R4LnF1ZXJ5O1xuICAgIGlmICghdG9rZW4gfHwgIWNhbGxiYWNrVVJMKSB7XG4gICAgICB0aHJvdyBjdHgucmVkaXJlY3QoXG4gICAgICAgIHJlZGlyZWN0RXJyb3IoY3R4LmNvbnRleHQsIGNhbGxiYWNrVVJMLCB7IGVycm9yOiBcIklOVkFMSURfVE9LRU5cIiB9KVxuICAgICAgKTtcbiAgICB9XG4gICAgY29uc3QgdmVyaWZpY2F0aW9uID0gYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmZpbmRWZXJpZmljYXRpb25WYWx1ZShcbiAgICAgIGByZXNldC1wYXNzd29yZDoke3Rva2VufWBcbiAgICApO1xuICAgIGlmICghdmVyaWZpY2F0aW9uIHx8IHZlcmlmaWNhdGlvbi5leHBpcmVzQXQgPCAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSkge1xuICAgICAgdGhyb3cgY3R4LnJlZGlyZWN0KFxuICAgICAgICByZWRpcmVjdEVycm9yKGN0eC5jb250ZXh0LCBjYWxsYmFja1VSTCwgeyBlcnJvcjogXCJJTlZBTElEX1RPS0VOXCIgfSlcbiAgICAgICk7XG4gICAgfVxuICAgIHRocm93IGN0eC5yZWRpcmVjdChyZWRpcmVjdENhbGxiYWNrKGN0eC5jb250ZXh0LCBjYWxsYmFja1VSTCwgeyB0b2tlbiB9KSk7XG4gIH1cbik7XG5jb25zdCBmb3JnZXRQYXNzd29yZENhbGxiYWNrID0gcmVxdWVzdFBhc3N3b3JkUmVzZXRDYWxsYmFjaztcbmNvbnN0IHJlc2V0UGFzc3dvcmQgPSBjcmVhdGVBdXRoRW5kcG9pbnQoXG4gIFwiL3Jlc2V0LXBhc3N3b3JkXCIsXG4gIHtcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgIHF1ZXJ5OiB6Lm9iamVjdCh7XG4gICAgICB0b2tlbjogei5zdHJpbmcoKS5vcHRpb25hbCgpXG4gICAgfSkub3B0aW9uYWwoKSxcbiAgICBib2R5OiB6Lm9iamVjdCh7XG4gICAgICBuZXdQYXNzd29yZDogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIG5ldyBwYXNzd29yZCB0byBzZXRcIlxuICAgICAgfSksXG4gICAgICB0b2tlbjogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIHRva2VuIHRvIHJlc2V0IHRoZSBwYXNzd29yZFwiXG4gICAgICB9KS5vcHRpb25hbCgpXG4gICAgfSksXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgIG9wZW5hcGk6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiUmVzZXQgdGhlIHBhc3N3b3JkIGZvciBhIHVzZXJcIixcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgXCIyMDBcIjoge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiU3VjY2Vzc1wiLFxuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIjoge1xuICAgICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJib29sZWFuXCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgYXN5bmMgKGN0eCkgPT4ge1xuICAgIGNvbnN0IHRva2VuID0gY3R4LmJvZHkudG9rZW4gfHwgY3R4LnF1ZXJ5Py50b2tlbjtcbiAgICBpZiAoIXRva2VuKSB7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuSU5WQUxJRF9UT0tFTlxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IHsgbmV3UGFzc3dvcmQgfSA9IGN0eC5ib2R5O1xuICAgIGNvbnN0IG1pbkxlbmd0aCA9IGN0eC5jb250ZXh0LnBhc3N3b3JkPy5jb25maWcubWluUGFzc3dvcmRMZW5ndGg7XG4gICAgY29uc3QgbWF4TGVuZ3RoID0gY3R4LmNvbnRleHQucGFzc3dvcmQ/LmNvbmZpZy5tYXhQYXNzd29yZExlbmd0aDtcbiAgICBpZiAobmV3UGFzc3dvcmQubGVuZ3RoIDwgbWluTGVuZ3RoKSB7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuUEFTU1dPUkRfVE9PX1NIT1JUXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKG5ld1Bhc3N3b3JkLmxlbmd0aCA+IG1heExlbmd0aCkge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLlBBU1NXT1JEX1RPT19MT05HXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgaWQgPSBgcmVzZXQtcGFzc3dvcmQ6JHt0b2tlbn1gO1xuICAgIGNvbnN0IHZlcmlmaWNhdGlvbiA9IGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5maW5kVmVyaWZpY2F0aW9uVmFsdWUoaWQpO1xuICAgIGlmICghdmVyaWZpY2F0aW9uIHx8IHZlcmlmaWNhdGlvbi5leHBpcmVzQXQgPCAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSkge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLklOVkFMSURfVE9LRU5cbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCB1c2VySWQgPSB2ZXJpZmljYXRpb24udmFsdWU7XG4gICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBjdHguY29udGV4dC5wYXNzd29yZC5oYXNoKG5ld1Bhc3N3b3JkKTtcbiAgICBjb25zdCBhY2NvdW50cyA9IGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5maW5kQWNjb3VudHModXNlcklkKTtcbiAgICBjb25zdCBhY2NvdW50ID0gYWNjb3VudHMuZmluZCgoYWMpID0+IGFjLnByb3ZpZGVySWQgPT09IFwiY3JlZGVudGlhbFwiKTtcbiAgICBpZiAoIWFjY291bnQpIHtcbiAgICAgIGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5jcmVhdGVBY2NvdW50KFxuICAgICAgICB7XG4gICAgICAgICAgdXNlcklkLFxuICAgICAgICAgIHByb3ZpZGVySWQ6IFwiY3JlZGVudGlhbFwiLFxuICAgICAgICAgIHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZCxcbiAgICAgICAgICBhY2NvdW50SWQ6IHVzZXJJZFxuICAgICAgICB9LFxuICAgICAgICBjdHhcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci51cGRhdGVQYXNzd29yZChcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBoYXNoZWRQYXNzd29yZCxcbiAgICAgICAgY3R4XG4gICAgICApO1xuICAgIH1cbiAgICBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZGVsZXRlVmVyaWZpY2F0aW9uVmFsdWUodmVyaWZpY2F0aW9uLmlkKTtcbiAgICBpZiAoY3R4LmNvbnRleHQub3B0aW9ucy5lbWFpbEFuZFBhc3N3b3JkPy5vblBhc3N3b3JkUmVzZXQpIHtcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZmluZFVzZXJCeUlkKHVzZXJJZCk7XG4gICAgICBpZiAodXNlcikge1xuICAgICAgICBhd2FpdCBjdHguY29udGV4dC5vcHRpb25zLmVtYWlsQW5kUGFzc3dvcmQub25QYXNzd29yZFJlc2V0KFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHVzZXJcbiAgICAgICAgICB9LFxuICAgICAgICAgIGN0eC5yZXF1ZXN0XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChjdHguY29udGV4dC5vcHRpb25zLmVtYWlsQW5kUGFzc3dvcmQ/LnJldm9rZVNlc3Npb25zT25QYXNzd29yZFJlc2V0KSB7XG4gICAgICBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZGVsZXRlU2Vzc2lvbnModXNlcklkKTtcbiAgICB9XG4gICAgcmV0dXJuIGN0eC5qc29uKHtcbiAgICAgIHN0YXR1czogdHJ1ZVxuICAgIH0pO1xuICB9XG4pO1xuXG5jb25zdCB1cGRhdGVVc2VyID0gKCkgPT4gY3JlYXRlQXV0aEVuZHBvaW50KFxuICBcIi91cGRhdGUtdXNlclwiLFxuICB7XG4gICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICBib2R5OiB6LnJlY29yZChcbiAgICAgIHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIkZpZWxkIG5hbWUgbXVzdCBiZSBhIHN0cmluZ1wiXG4gICAgICB9KSxcbiAgICAgIHouYW55KClcbiAgICApLFxuICAgIHVzZTogW3Nlc3Npb25NaWRkbGV3YXJlXSxcbiAgICBtZXRhZGF0YToge1xuICAgICAgJEluZmVyOiB7XG4gICAgICAgIGJvZHk6IHt9XG4gICAgICB9LFxuICAgICAgb3BlbmFwaToge1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJVcGRhdGUgdGhlIGN1cnJlbnQgdXNlclwiLFxuICAgICAgICByZXF1ZXN0Qm9keToge1xuICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiOiB7XG4gICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgbmFtZToge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgbmFtZSBvZiB0aGUgdXNlclwiXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgaW1hZ2U6IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIGltYWdlIG9mIHRoZSB1c2VyXCJcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHJlc3BvbnNlczoge1xuICAgICAgICAgIFwiMjAwXCI6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlN1Y2Nlc3NcIixcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbi9qc29uXCI6IHtcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYm9vbGVhblwiLFxuICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkluZGljYXRlcyBpZiB0aGUgdXBkYXRlIHdhcyBzdWNjZXNzZnVsXCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgYXN5bmMgKGN0eCkgPT4ge1xuICAgIGNvbnN0IGJvZHkgPSBjdHguYm9keTtcbiAgICBpZiAoYm9keS5lbWFpbCkge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLkVNQUlMX0NBTl9OT1RfQkVfVVBEQVRFRFxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IHsgbmFtZSwgaW1hZ2UsIC4uLnJlc3QgfSA9IGJvZHk7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGN0eC5jb250ZXh0LnNlc3Npb247XG4gICAgaWYgKGltYWdlID09PSB2b2lkIDAgJiYgbmFtZSA9PT0gdm9pZCAwICYmIE9iamVjdC5rZXlzKHJlc3QpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIGN0eC5qc29uKHtcbiAgICAgICAgc3RhdHVzOiB0cnVlXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgYWRkaXRpb25hbEZpZWxkcyA9IHBhcnNlVXNlcklucHV0KFxuICAgICAgY3R4LmNvbnRleHQub3B0aW9ucyxcbiAgICAgIHJlc3QsXG4gICAgICBcInVwZGF0ZVwiXG4gICAgKTtcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLnVwZGF0ZVVzZXIoXG4gICAgICBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICB7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGltYWdlLFxuICAgICAgICAuLi5hZGRpdGlvbmFsRmllbGRzXG4gICAgICB9LFxuICAgICAgY3R4XG4gICAgKTtcbiAgICBhd2FpdCBzZXRTZXNzaW9uQ29va2llKGN0eCwge1xuICAgICAgc2Vzc2lvbjogc2Vzc2lvbi5zZXNzaW9uLFxuICAgICAgdXNlclxuICAgIH0pO1xuICAgIHJldHVybiBjdHguanNvbih7XG4gICAgICBzdGF0dXM6IHRydWVcbiAgICB9KTtcbiAgfVxuKTtcbmNvbnN0IGNoYW5nZVBhc3N3b3JkID0gY3JlYXRlQXV0aEVuZHBvaW50KFxuICBcIi9jaGFuZ2UtcGFzc3dvcmRcIixcbiAge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgYm9keTogei5vYmplY3Qoe1xuICAgICAgLyoqXG4gICAgICAgKiBUaGUgbmV3IHBhc3N3b3JkIHRvIHNldFxuICAgICAgICovXG4gICAgICBuZXdQYXNzd29yZDogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIG5ldyBwYXNzd29yZCB0byBzZXRcIlxuICAgICAgfSksXG4gICAgICAvKipcbiAgICAgICAqIFRoZSBjdXJyZW50IHBhc3N3b3JkIG9mIHRoZSB1c2VyXG4gICAgICAgKi9cbiAgICAgIGN1cnJlbnRQYXNzd29yZDogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIGN1cnJlbnQgcGFzc3dvcmQgaXMgcmVxdWlyZWRcIlxuICAgICAgfSksXG4gICAgICAvKipcbiAgICAgICAqIHJldm9rZSBhbGwgc2Vzc2lvbnMgdGhhdCBhcmUgbm90IHRoZVxuICAgICAgICogY3VycmVudCBvbmUgbG9nZ2VkIGluIGJ5IHRoZSB1c2VyXG4gICAgICAgKi9cbiAgICAgIHJldm9rZU90aGVyU2Vzc2lvbnM6IHouYm9vbGVhbigpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJNdXN0IGJlIGEgYm9vbGVhbiB2YWx1ZVwiXG4gICAgICB9KS5vcHRpb25hbCgpXG4gICAgfSksXG4gICAgdXNlOiBbc2Vzc2lvbk1pZGRsZXdhcmVdLFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICBvcGVuYXBpOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIkNoYW5nZSB0aGUgcGFzc3dvcmQgb2YgdGhlIHVzZXJcIixcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgXCIyMDBcIjoge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiUGFzc3dvcmQgc3VjY2Vzc2Z1bGx5IGNoYW5nZWRcIixcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbi9qc29uXCI6IHtcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgIHRva2VuOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICBudWxsYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAvLyBPbmx5IHByZXNlbnQgaWYgcmV2b2tlT3RoZXJTZXNzaW9ucyBpcyB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiTmV3IHNlc3Npb24gdG9rZW4gaWYgb3RoZXIgc2Vzc2lvbnMgd2VyZSByZXZva2VkXCJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIHVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSB1c2VyXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFwiZW1haWxcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIGVtYWlsIGFkZHJlc3Mgb2YgdGhlIHVzZXJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIG5hbWUgb2YgdGhlIHVzZXJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogXCJ1cmlcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbGFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBwcm9maWxlIGltYWdlIFVSTCBvZiB0aGUgdXNlclwiXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZW1haWxWZXJpZmllZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImJvb2xlYW5cIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiV2hldGhlciB0aGUgZW1haWwgaGFzIGJlZW4gdmVyaWZpZWRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFwiZGF0ZS10aW1lXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIldoZW4gdGhlIHVzZXIgd2FzIGNyZWF0ZWRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRBdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFwiZGF0ZS10aW1lXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIldoZW4gdGhlIHVzZXIgd2FzIGxhc3QgdXBkYXRlZFwiXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogW1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJpZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJlbWFpbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImVtYWlsVmVyaWZpZWRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY3JlYXRlZEF0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInVwZGF0ZWRBdFwiXG4gICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFtcInVzZXJcIl1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGFzeW5jIChjdHgpID0+IHtcbiAgICBjb25zdCB7IG5ld1Bhc3N3b3JkLCBjdXJyZW50UGFzc3dvcmQsIHJldm9rZU90aGVyU2Vzc2lvbnMgfSA9IGN0eC5ib2R5O1xuICAgIGNvbnN0IHNlc3Npb24gPSBjdHguY29udGV4dC5zZXNzaW9uO1xuICAgIGNvbnN0IG1pblBhc3N3b3JkTGVuZ3RoID0gY3R4LmNvbnRleHQucGFzc3dvcmQuY29uZmlnLm1pblBhc3N3b3JkTGVuZ3RoO1xuICAgIGlmIChuZXdQYXNzd29yZC5sZW5ndGggPCBtaW5QYXNzd29yZExlbmd0aCkge1xuICAgICAgY3R4LmNvbnRleHQubG9nZ2VyLmVycm9yKFwiUGFzc3dvcmQgaXMgdG9vIHNob3J0XCIpO1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLlBBU1NXT1JEX1RPT19TSE9SVFxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IG1heFBhc3N3b3JkTGVuZ3RoID0gY3R4LmNvbnRleHQucGFzc3dvcmQuY29uZmlnLm1heFBhc3N3b3JkTGVuZ3RoO1xuICAgIGlmIChuZXdQYXNzd29yZC5sZW5ndGggPiBtYXhQYXNzd29yZExlbmd0aCkge1xuICAgICAgY3R4LmNvbnRleHQubG9nZ2VyLmVycm9yKFwiUGFzc3dvcmQgaXMgdG9vIGxvbmdcIik7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuUEFTU1dPUkRfVE9PX0xPTkdcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBhY2NvdW50cyA9IGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5maW5kQWNjb3VudHMoXG4gICAgICBzZXNzaW9uLnVzZXIuaWRcbiAgICApO1xuICAgIGNvbnN0IGFjY291bnQgPSBhY2NvdW50cy5maW5kKFxuICAgICAgKGFjY291bnQyKSA9PiBhY2NvdW50Mi5wcm92aWRlcklkID09PSBcImNyZWRlbnRpYWxcIiAmJiBhY2NvdW50Mi5wYXNzd29yZFxuICAgICk7XG4gICAgaWYgKCFhY2NvdW50IHx8ICFhY2NvdW50LnBhc3N3b3JkKSB7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuQ1JFREVOVElBTF9BQ0NPVU5UX05PVF9GT1VORFxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IHBhc3N3b3JkSGFzaCA9IGF3YWl0IGN0eC5jb250ZXh0LnBhc3N3b3JkLmhhc2gobmV3UGFzc3dvcmQpO1xuICAgIGNvbnN0IHZlcmlmeSA9IGF3YWl0IGN0eC5jb250ZXh0LnBhc3N3b3JkLnZlcmlmeSh7XG4gICAgICBoYXNoOiBhY2NvdW50LnBhc3N3b3JkLFxuICAgICAgcGFzc3dvcmQ6IGN1cnJlbnRQYXNzd29yZFxuICAgIH0pO1xuICAgIGlmICghdmVyaWZ5KSB7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuSU5WQUxJRF9QQVNTV09SRFxuICAgICAgfSk7XG4gICAgfVxuICAgIGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci51cGRhdGVBY2NvdW50KGFjY291bnQuaWQsIHtcbiAgICAgIHBhc3N3b3JkOiBwYXNzd29yZEhhc2hcbiAgICB9KTtcbiAgICBsZXQgdG9rZW4gPSBudWxsO1xuICAgIGlmIChyZXZva2VPdGhlclNlc3Npb25zKSB7XG4gICAgICBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZGVsZXRlU2Vzc2lvbnMoc2Vzc2lvbi51c2VyLmlkKTtcbiAgICAgIGNvbnN0IG5ld1Nlc3Npb24gPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuY3JlYXRlU2Vzc2lvbihcbiAgICAgICAgc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICBjdHhcbiAgICAgICk7XG4gICAgICBpZiAoIW5ld1Nlc3Npb24pIHtcbiAgICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiSU5URVJOQUxfU0VSVkVSX0VSUk9SXCIsIHtcbiAgICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLkZBSUxFRF9UT19HRVRfU0VTU0lPTlxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGF3YWl0IHNldFNlc3Npb25Db29raWUoY3R4LCB7XG4gICAgICAgIHNlc3Npb246IG5ld1Nlc3Npb24sXG4gICAgICAgIHVzZXI6IHNlc3Npb24udXNlclxuICAgICAgfSk7XG4gICAgICB0b2tlbiA9IG5ld1Nlc3Npb24udG9rZW47XG4gICAgfVxuICAgIHJldHVybiBjdHguanNvbih7XG4gICAgICB0b2tlbixcbiAgICAgIHVzZXI6IHtcbiAgICAgICAgaWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgZW1haWw6IHNlc3Npb24udXNlci5lbWFpbCxcbiAgICAgICAgbmFtZTogc2Vzc2lvbi51c2VyLm5hbWUsXG4gICAgICAgIGltYWdlOiBzZXNzaW9uLnVzZXIuaW1hZ2UsXG4gICAgICAgIGVtYWlsVmVyaWZpZWQ6IHNlc3Npb24udXNlci5lbWFpbFZlcmlmaWVkLFxuICAgICAgICBjcmVhdGVkQXQ6IHNlc3Npb24udXNlci5jcmVhdGVkQXQsXG4gICAgICAgIHVwZGF0ZWRBdDogc2Vzc2lvbi51c2VyLnVwZGF0ZWRBdFxuICAgICAgfVxuICAgIH0pO1xuICB9XG4pO1xuY29uc3Qgc2V0UGFzc3dvcmQgPSBjcmVhdGVBdXRoRW5kcG9pbnQoXG4gIFwiL3NldC1wYXNzd29yZFwiLFxuICB7XG4gICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICBib2R5OiB6Lm9iamVjdCh7XG4gICAgICAvKipcbiAgICAgICAqIFRoZSBuZXcgcGFzc3dvcmQgdG8gc2V0XG4gICAgICAgKi9cbiAgICAgIG5ld1Bhc3N3b3JkOiB6LnN0cmluZygpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgbmV3IHBhc3N3b3JkIHRvIHNldCBpcyByZXF1aXJlZFwiXG4gICAgICB9KVxuICAgIH0pLFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICBTRVJWRVJfT05MWTogdHJ1ZVxuICAgIH0sXG4gICAgdXNlOiBbc2Vzc2lvbk1pZGRsZXdhcmVdXG4gIH0sXG4gIGFzeW5jIChjdHgpID0+IHtcbiAgICBjb25zdCB7IG5ld1Bhc3N3b3JkIH0gPSBjdHguYm9keTtcbiAgICBjb25zdCBzZXNzaW9uID0gY3R4LmNvbnRleHQuc2Vzc2lvbjtcbiAgICBjb25zdCBtaW5QYXNzd29yZExlbmd0aCA9IGN0eC5jb250ZXh0LnBhc3N3b3JkLmNvbmZpZy5taW5QYXNzd29yZExlbmd0aDtcbiAgICBpZiAobmV3UGFzc3dvcmQubGVuZ3RoIDwgbWluUGFzc3dvcmRMZW5ndGgpIHtcbiAgICAgIGN0eC5jb250ZXh0LmxvZ2dlci5lcnJvcihcIlBhc3N3b3JkIGlzIHRvbyBzaG9ydFwiKTtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5QQVNTV09SRF9UT09fU0hPUlRcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBtYXhQYXNzd29yZExlbmd0aCA9IGN0eC5jb250ZXh0LnBhc3N3b3JkLmNvbmZpZy5tYXhQYXNzd29yZExlbmd0aDtcbiAgICBpZiAobmV3UGFzc3dvcmQubGVuZ3RoID4gbWF4UGFzc3dvcmRMZW5ndGgpIHtcbiAgICAgIGN0eC5jb250ZXh0LmxvZ2dlci5lcnJvcihcIlBhc3N3b3JkIGlzIHRvbyBsb25nXCIpO1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLlBBU1NXT1JEX1RPT19MT05HXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgYWNjb3VudHMgPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZmluZEFjY291bnRzKFxuICAgICAgc2Vzc2lvbi51c2VyLmlkXG4gICAgKTtcbiAgICBjb25zdCBhY2NvdW50ID0gYWNjb3VudHMuZmluZChcbiAgICAgIChhY2NvdW50MikgPT4gYWNjb3VudDIucHJvdmlkZXJJZCA9PT0gXCJjcmVkZW50aWFsXCIgJiYgYWNjb3VudDIucGFzc3dvcmRcbiAgICApO1xuICAgIGNvbnN0IHBhc3N3b3JkSGFzaCA9IGF3YWl0IGN0eC5jb250ZXh0LnBhc3N3b3JkLmhhc2gobmV3UGFzc3dvcmQpO1xuICAgIGlmICghYWNjb3VudCkge1xuICAgICAgYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmxpbmtBY2NvdW50KFxuICAgICAgICB7XG4gICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgcHJvdmlkZXJJZDogXCJjcmVkZW50aWFsXCIsXG4gICAgICAgICAgYWNjb3VudElkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkSGFzaFxuICAgICAgICB9LFxuICAgICAgICBjdHhcbiAgICAgICk7XG4gICAgICByZXR1cm4gY3R4Lmpzb24oe1xuICAgICAgICBzdGF0dXM6IHRydWVcbiAgICAgIH0pO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICBtZXNzYWdlOiBcInVzZXIgYWxyZWFkeSBoYXMgYSBwYXNzd29yZFwiXG4gICAgfSk7XG4gIH1cbik7XG5jb25zdCBkZWxldGVVc2VyID0gY3JlYXRlQXV0aEVuZHBvaW50KFxuICBcIi9kZWxldGUtdXNlclwiLFxuICB7XG4gICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICB1c2U6IFtzZXNzaW9uTWlkZGxld2FyZV0sXG4gICAgYm9keTogei5vYmplY3Qoe1xuICAgICAgLyoqXG4gICAgICAgKiBUaGUgY2FsbGJhY2sgVVJMIHRvIHJlZGlyZWN0IHRvIGFmdGVyIHRoZSB1c2VyIGlzIGRlbGV0ZWRcbiAgICAgICAqIHRoaXMgaXMgb25seSB1c2VkIG9uIGRlbGV0ZSB1c2VyIGNhbGxiYWNrXG4gICAgICAgKi9cbiAgICAgIGNhbGxiYWNrVVJMOiB6LnN0cmluZygpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgY2FsbGJhY2sgVVJMIHRvIHJlZGlyZWN0IHRvIGFmdGVyIHRoZSB1c2VyIGlzIGRlbGV0ZWRcIlxuICAgICAgfSkub3B0aW9uYWwoKSxcbiAgICAgIC8qKlxuICAgICAgICogVGhlIHBhc3N3b3JkIG9mIHRoZSB1c2VyLiBJZiB0aGUgcGFzc3dvcmQgaXNuJ3QgcHJvdmlkZWQsIHNlc3Npb24gZnJlc2huZXNzXG4gICAgICAgKiB3aWxsIGJlIGNoZWNrZWQuXG4gICAgICAgKi9cbiAgICAgIHBhc3N3b3JkOiB6LnN0cmluZygpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgcGFzc3dvcmQgb2YgdGhlIHVzZXIgaXMgcmVxdWlyZWQgdG8gZGVsZXRlIHRoZSB1c2VyXCJcbiAgICAgIH0pLm9wdGlvbmFsKCksXG4gICAgICAvKipcbiAgICAgICAqIFRoZSB0b2tlbiB0byBkZWxldGUgdGhlIHVzZXIuIElmIHRoZSB0b2tlbiBpcyBwcm92aWRlZCwgdGhlIHVzZXIgd2lsbCBiZSBkZWxldGVkXG4gICAgICAgKi9cbiAgICAgIHRva2VuOiB6LnN0cmluZygpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgdG9rZW4gdG8gZGVsZXRlIHRoZSB1c2VyIGlzIHJlcXVpcmVkXCJcbiAgICAgIH0pLm9wdGlvbmFsKClcbiAgICB9KSxcbiAgICBtZXRhZGF0YToge1xuICAgICAgb3BlbmFwaToge1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJEZWxldGUgdGhlIHVzZXJcIixcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgXCIyMDBcIjoge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiVXNlciBkZWxldGlvbiBwcm9jZXNzZWQgc3VjY2Vzc2Z1bGx5XCIsXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiOiB7XG4gICAgICAgICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJib29sZWFuXCIsXG4gICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiSW5kaWNhdGVzIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWxcIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICBlbnVtOiBbXCJVc2VyIGRlbGV0ZWRcIiwgXCJWZXJpZmljYXRpb24gZW1haWwgc2VudFwiXSxcbiAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJTdGF0dXMgbWVzc2FnZSBvZiB0aGUgZGVsZXRpb24gcHJvY2Vzc1wiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICByZXF1aXJlZDogW1wic3VjY2Vzc1wiLCBcIm1lc3NhZ2VcIl1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGFzeW5jIChjdHgpID0+IHtcbiAgICBpZiAoIWN0eC5jb250ZXh0Lm9wdGlvbnMudXNlcj8uZGVsZXRlVXNlcj8uZW5hYmxlZCkge1xuICAgICAgY3R4LmNvbnRleHQubG9nZ2VyLmVycm9yKFxuICAgICAgICBcIkRlbGV0ZSB1c2VyIGlzIGRpc2FibGVkLiBFbmFibGUgaXQgaW4gdGhlIG9wdGlvbnNcIixcbiAgICAgICAge1xuICAgICAgICAgIHNlc3Npb246IGN0eC5jb250ZXh0LnNlc3Npb25cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIk5PVF9GT1VORFwiKTtcbiAgICB9XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGN0eC5jb250ZXh0LnNlc3Npb247XG4gICAgaWYgKGN0eC5ib2R5LnBhc3N3b3JkKSB7XG4gICAgICBjb25zdCBhY2NvdW50cyA9IGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5maW5kQWNjb3VudHMoXG4gICAgICAgIHNlc3Npb24udXNlci5pZFxuICAgICAgKTtcbiAgICAgIGNvbnN0IGFjY291bnQgPSBhY2NvdW50cy5maW5kKFxuICAgICAgICAoYWNjb3VudDIpID0+IGFjY291bnQyLnByb3ZpZGVySWQgPT09IFwiY3JlZGVudGlhbFwiICYmIGFjY291bnQyLnBhc3N3b3JkXG4gICAgICApO1xuICAgICAgaWYgKCFhY2NvdW50IHx8ICFhY2NvdW50LnBhc3N3b3JkKSB7XG4gICAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLkNSRURFTlRJQUxfQUNDT1VOVF9OT1RfRk9VTkRcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBjb25zdCB2ZXJpZnkgPSBhd2FpdCBjdHguY29udGV4dC5wYXNzd29yZC52ZXJpZnkoe1xuICAgICAgICBoYXNoOiBhY2NvdW50LnBhc3N3b3JkLFxuICAgICAgICBwYXNzd29yZDogY3R4LmJvZHkucGFzc3dvcmRcbiAgICAgIH0pO1xuICAgICAgaWYgKCF2ZXJpZnkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuSU5WQUxJRF9QQVNTV09SRFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGN0eC5ib2R5LnRva2VuKSB7XG4gICAgICBhd2FpdCBkZWxldGVVc2VyQ2FsbGJhY2soe1xuICAgICAgICAuLi5jdHgsXG4gICAgICAgIHF1ZXJ5OiB7XG4gICAgICAgICAgdG9rZW46IGN0eC5ib2R5LnRva2VuXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGN0eC5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogXCJVc2VyIGRlbGV0ZWRcIlxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChjdHguY29udGV4dC5vcHRpb25zLnVzZXIuZGVsZXRlVXNlcj8uc2VuZERlbGV0ZUFjY291bnRWZXJpZmljYXRpb24pIHtcbiAgICAgIGNvbnN0IHRva2VuID0gZ2VuZXJhdGVSYW5kb21TdHJpbmcoMzIsIFwiMC05XCIsIFwiYS16XCIpO1xuICAgICAgYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmNyZWF0ZVZlcmlmaWNhdGlvblZhbHVlKFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICBpZGVudGlmaWVyOiBgZGVsZXRlLWFjY291bnQtJHt0b2tlbn1gLFxuICAgICAgICAgIGV4cGlyZXNBdDogbmV3IERhdGUoXG4gICAgICAgICAgICBEYXRlLm5vdygpICsgKGN0eC5jb250ZXh0Lm9wdGlvbnMudXNlci5kZWxldGVVc2VyPy5kZWxldGVUb2tlbkV4cGlyZXNJbiB8fCA2MCAqIDYwICogMjQpICogMWUzXG4gICAgICAgICAgKVxuICAgICAgICB9LFxuICAgICAgICBjdHhcbiAgICAgICk7XG4gICAgICBjb25zdCB1cmwgPSBgJHtjdHguY29udGV4dC5iYXNlVVJMfS9kZWxldGUtdXNlci9jYWxsYmFjaz90b2tlbj0ke3Rva2VufSZjYWxsYmFja1VSTD0ke2N0eC5ib2R5LmNhbGxiYWNrVVJMIHx8IFwiL1wifWA7XG4gICAgICBhd2FpdCBjdHguY29udGV4dC5vcHRpb25zLnVzZXIuZGVsZXRlVXNlci5zZW5kRGVsZXRlQWNjb3VudFZlcmlmaWNhdGlvbihcbiAgICAgICAge1xuICAgICAgICAgIHVzZXI6IHNlc3Npb24udXNlcixcbiAgICAgICAgICB1cmwsXG4gICAgICAgICAgdG9rZW5cbiAgICAgICAgfSxcbiAgICAgICAgY3R4LnJlcXVlc3RcbiAgICAgICk7XG4gICAgICByZXR1cm4gY3R4Lmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiBcIlZlcmlmaWNhdGlvbiBlbWFpbCBzZW50XCJcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoIWN0eC5ib2R5LnBhc3N3b3JkICYmIGN0eC5jb250ZXh0LnNlc3Npb25Db25maWcuZnJlc2hBZ2UgIT09IDApIHtcbiAgICAgIGNvbnN0IGN1cnJlbnRBZ2UgPSBzZXNzaW9uLnNlc3Npb24uY3JlYXRlZEF0LmdldFRpbWUoKTtcbiAgICAgIGNvbnN0IGZyZXNoQWdlID0gY3R4LmNvbnRleHQuc2Vzc2lvbkNvbmZpZy5mcmVzaEFnZSAqIDFlMztcbiAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgICBpZiAobm93IC0gY3VycmVudEFnZSA+IGZyZXNoQWdlICogMWUzKSB7XG4gICAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLlNFU1NJT05fRVhQSVJFRFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgYmVmb3JlRGVsZXRlID0gY3R4LmNvbnRleHQub3B0aW9ucy51c2VyLmRlbGV0ZVVzZXI/LmJlZm9yZURlbGV0ZTtcbiAgICBpZiAoYmVmb3JlRGVsZXRlKSB7XG4gICAgICBhd2FpdCBiZWZvcmVEZWxldGUoc2Vzc2lvbi51c2VyLCBjdHgucmVxdWVzdCk7XG4gICAgfVxuICAgIGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5kZWxldGVVc2VyKHNlc3Npb24udXNlci5pZCk7XG4gICAgYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmRlbGV0ZVNlc3Npb25zKHNlc3Npb24udXNlci5pZCk7XG4gICAgYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmRlbGV0ZUFjY291bnRzKHNlc3Npb24udXNlci5pZCk7XG4gICAgZGVsZXRlU2Vzc2lvbkNvb2tpZShjdHgpO1xuICAgIGNvbnN0IGFmdGVyRGVsZXRlID0gY3R4LmNvbnRleHQub3B0aW9ucy51c2VyLmRlbGV0ZVVzZXI/LmFmdGVyRGVsZXRlO1xuICAgIGlmIChhZnRlckRlbGV0ZSkge1xuICAgICAgYXdhaXQgYWZ0ZXJEZWxldGUoc2Vzc2lvbi51c2VyLCBjdHgucmVxdWVzdCk7XG4gICAgfVxuICAgIHJldHVybiBjdHguanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogXCJVc2VyIGRlbGV0ZWRcIlxuICAgIH0pO1xuICB9XG4pO1xuY29uc3QgZGVsZXRlVXNlckNhbGxiYWNrID0gY3JlYXRlQXV0aEVuZHBvaW50KFxuICBcIi9kZWxldGUtdXNlci9jYWxsYmFja1wiLFxuICB7XG4gICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgIHF1ZXJ5OiB6Lm9iamVjdCh7XG4gICAgICB0b2tlbjogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIHRva2VuIHRvIHZlcmlmeSB0aGUgZGVsZXRpb24gcmVxdWVzdFwiXG4gICAgICB9KSxcbiAgICAgIGNhbGxiYWNrVVJMOiB6LnN0cmluZygpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgVVJMIHRvIHJlZGlyZWN0IHRvIGFmdGVyIGRlbGV0aW9uXCJcbiAgICAgIH0pLm9wdGlvbmFsKClcbiAgICB9KSxcbiAgICB1c2U6IFtvcmlnaW5DaGVjaygoY3R4KSA9PiBjdHgucXVlcnkuY2FsbGJhY2tVUkwpXSxcbiAgICBtZXRhZGF0YToge1xuICAgICAgb3BlbmFwaToge1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJDYWxsYmFjayB0byBjb21wbGV0ZSB1c2VyIGRlbGV0aW9uIHdpdGggdmVyaWZpY2F0aW9uIHRva2VuXCIsXG4gICAgICAgIHJlc3BvbnNlczoge1xuICAgICAgICAgIFwiMjAwXCI6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlVzZXIgc3VjY2Vzc2Z1bGx5IGRlbGV0ZWRcIixcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbi9qc29uXCI6IHtcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImJvb2xlYW5cIixcbiAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJJbmRpY2F0ZXMgaWYgdGhlIGRlbGV0aW9uIHdhcyBzdWNjZXNzZnVsXCJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZToge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgZW51bTogW1wiVXNlciBkZWxldGVkXCJdLFxuICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkNvbmZpcm1hdGlvbiBtZXNzYWdlXCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBbXCJzdWNjZXNzXCIsIFwibWVzc2FnZVwiXVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgYXN5bmMgKGN0eCkgPT4ge1xuICAgIGlmICghY3R4LmNvbnRleHQub3B0aW9ucy51c2VyPy5kZWxldGVVc2VyPy5lbmFibGVkKSB7XG4gICAgICBjdHguY29udGV4dC5sb2dnZXIuZXJyb3IoXG4gICAgICAgIFwiRGVsZXRlIHVzZXIgaXMgZGlzYWJsZWQuIEVuYWJsZSBpdCBpbiB0aGUgb3B0aW9uc1wiXG4gICAgICApO1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiTk9UX0ZPVU5EXCIpO1xuICAgIH1cbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZ2V0U2Vzc2lvbkZyb21DdHgoY3R4KTtcbiAgICBpZiAoIXNlc3Npb24pIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIk5PVF9GT1VORFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuRkFJTEVEX1RPX0dFVF9VU0VSX0lORk9cbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCB0b2tlbiA9IGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5maW5kVmVyaWZpY2F0aW9uVmFsdWUoXG4gICAgICBgZGVsZXRlLWFjY291bnQtJHtjdHgucXVlcnkudG9rZW59YFxuICAgICk7XG4gICAgaWYgKCF0b2tlbiB8fCB0b2tlbi5leHBpcmVzQXQgPCAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSkge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiTk9UX0ZPVU5EXCIsIHtcbiAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5JTlZBTElEX1RPS0VOXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKHRva2VuLnZhbHVlICE9PSBzZXNzaW9uLnVzZXIuaWQpIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIk5PVF9GT1VORFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuSU5WQUxJRF9UT0tFTlxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IGJlZm9yZURlbGV0ZSA9IGN0eC5jb250ZXh0Lm9wdGlvbnMudXNlci5kZWxldGVVc2VyPy5iZWZvcmVEZWxldGU7XG4gICAgaWYgKGJlZm9yZURlbGV0ZSkge1xuICAgICAgYXdhaXQgYmVmb3JlRGVsZXRlKHNlc3Npb24udXNlciwgY3R4LnJlcXVlc3QpO1xuICAgIH1cbiAgICBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZGVsZXRlVXNlcihzZXNzaW9uLnVzZXIuaWQpO1xuICAgIGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5kZWxldGVTZXNzaW9ucyhzZXNzaW9uLnVzZXIuaWQpO1xuICAgIGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5kZWxldGVBY2NvdW50cyhzZXNzaW9uLnVzZXIuaWQpO1xuICAgIGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5kZWxldGVWZXJpZmljYXRpb25WYWx1ZSh0b2tlbi5pZCk7XG4gICAgZGVsZXRlU2Vzc2lvbkNvb2tpZShjdHgpO1xuICAgIGNvbnN0IGFmdGVyRGVsZXRlID0gY3R4LmNvbnRleHQub3B0aW9ucy51c2VyLmRlbGV0ZVVzZXI/LmFmdGVyRGVsZXRlO1xuICAgIGlmIChhZnRlckRlbGV0ZSkge1xuICAgICAgYXdhaXQgYWZ0ZXJEZWxldGUoc2Vzc2lvbi51c2VyLCBjdHgucmVxdWVzdCk7XG4gICAgfVxuICAgIGlmIChjdHgucXVlcnkuY2FsbGJhY2tVUkwpIHtcbiAgICAgIHRocm93IGN0eC5yZWRpcmVjdChjdHgucXVlcnkuY2FsbGJhY2tVUkwgfHwgXCIvXCIpO1xuICAgIH1cbiAgICByZXR1cm4gY3R4Lmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIG1lc3NhZ2U6IFwiVXNlciBkZWxldGVkXCJcbiAgICB9KTtcbiAgfVxuKTtcbmNvbnN0IGNoYW5nZUVtYWlsID0gY3JlYXRlQXV0aEVuZHBvaW50KFxuICBcIi9jaGFuZ2UtZW1haWxcIixcbiAge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgYm9keTogei5vYmplY3Qoe1xuICAgICAgbmV3RW1haWw6IHouZW1haWwoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIG5ldyBlbWFpbCBhZGRyZXNzIHRvIHNldCBtdXN0IGJlIGEgdmFsaWQgZW1haWwgYWRkcmVzc1wiXG4gICAgICB9KSxcbiAgICAgIGNhbGxiYWNrVVJMOiB6LnN0cmluZygpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgVVJMIHRvIHJlZGlyZWN0IHRvIGFmdGVyIGVtYWlsIHZlcmlmaWNhdGlvblwiXG4gICAgICB9KS5vcHRpb25hbCgpXG4gICAgfSksXG4gICAgdXNlOiBbc2Vzc2lvbk1pZGRsZXdhcmVdLFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICBvcGVuYXBpOiB7XG4gICAgICAgIHJlc3BvbnNlczoge1xuICAgICAgICAgIFwiMjAwXCI6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkVtYWlsIGNoYW5nZSByZXF1ZXN0IHByb2Nlc3NlZCBzdWNjZXNzZnVsbHlcIixcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbi9qc29uXCI6IHtcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYm9vbGVhblwiLFxuICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkluZGljYXRlcyBpZiB0aGUgcmVxdWVzdCB3YXMgc3VjY2Vzc2Z1bFwiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgIGVudW06IFtcIkVtYWlsIHVwZGF0ZWRcIiwgXCJWZXJpZmljYXRpb24gZW1haWwgc2VudFwiXSxcbiAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJTdGF0dXMgbWVzc2FnZSBvZiB0aGUgZW1haWwgY2hhbmdlIHByb2Nlc3NcIixcbiAgICAgICAgICAgICAgICAgICAgICBudWxsYWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFtcInN0YXR1c1wiXVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgYXN5bmMgKGN0eCkgPT4ge1xuICAgIGlmICghY3R4LmNvbnRleHQub3B0aW9ucy51c2VyPy5jaGFuZ2VFbWFpbD8uZW5hYmxlZCkge1xuICAgICAgY3R4LmNvbnRleHQubG9nZ2VyLmVycm9yKFwiQ2hhbmdlIGVtYWlsIGlzIGRpc2FibGVkLlwiKTtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogXCJDaGFuZ2UgZW1haWwgaXMgZGlzYWJsZWRcIlxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IG5ld0VtYWlsID0gY3R4LmJvZHkubmV3RW1haWwudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAobmV3RW1haWwgPT09IGN0eC5jb250ZXh0LnNlc3Npb24udXNlci5lbWFpbCkge1xuICAgICAgY3R4LmNvbnRleHQubG9nZ2VyLmVycm9yKFwiRW1haWwgaXMgdGhlIHNhbWVcIik7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IFwiRW1haWwgaXMgdGhlIHNhbWVcIlxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IGV4aXN0aW5nVXNlciA9IGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5maW5kVXNlckJ5RW1haWwobmV3RW1haWwpO1xuICAgIGlmIChleGlzdGluZ1VzZXIpIHtcbiAgICAgIGN0eC5jb250ZXh0LmxvZ2dlci5lcnJvcihcIkVtYWlsIGFscmVhZHkgZXhpc3RzXCIpO1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBcIkNvdWxkbid0IHVwZGF0ZSB5b3VyIGVtYWlsXCJcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoY3R4LmNvbnRleHQuc2Vzc2lvbi51c2VyLmVtYWlsVmVyaWZpZWQgIT09IHRydWUpIHtcbiAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmZpbmRVc2VyQnlFbWFpbChuZXdFbWFpbCk7XG4gICAgICBpZiAoZXhpc3RpbmcpIHtcbiAgICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiVU5QUk9DRVNTQUJMRV9FTlRJVFlcIiwge1xuICAgICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuVVNFUl9BTFJFQURZX0VYSVNUU1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci51cGRhdGVVc2VyQnlFbWFpbChcbiAgICAgICAgY3R4LmNvbnRleHQuc2Vzc2lvbi51c2VyLmVtYWlsLFxuICAgICAgICB7XG4gICAgICAgICAgZW1haWw6IG5ld0VtYWlsXG4gICAgICAgIH0sXG4gICAgICAgIGN0eFxuICAgICAgKTtcbiAgICAgIGF3YWl0IHNldFNlc3Npb25Db29raWUoY3R4LCB7XG4gICAgICAgIHNlc3Npb246IGN0eC5jb250ZXh0LnNlc3Npb24uc2Vzc2lvbixcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIC4uLmN0eC5jb250ZXh0LnNlc3Npb24udXNlcixcbiAgICAgICAgICBlbWFpbDogbmV3RW1haWxcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBpZiAoY3R4LmNvbnRleHQub3B0aW9ucy5lbWFpbFZlcmlmaWNhdGlvbj8uc2VuZFZlcmlmaWNhdGlvbkVtYWlsKSB7XG4gICAgICAgIGNvbnN0IHRva2VuMiA9IGF3YWl0IGNyZWF0ZUVtYWlsVmVyaWZpY2F0aW9uVG9rZW4oXG4gICAgICAgICAgY3R4LmNvbnRleHQuc2VjcmV0LFxuICAgICAgICAgIG5ld0VtYWlsLFxuICAgICAgICAgIHZvaWQgMCxcbiAgICAgICAgICBjdHguY29udGV4dC5vcHRpb25zLmVtYWlsVmVyaWZpY2F0aW9uPy5leHBpcmVzSW5cbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgdXJsMiA9IGAke2N0eC5jb250ZXh0LmJhc2VVUkx9L3ZlcmlmeS1lbWFpbD90b2tlbj0ke3Rva2VuMn0mY2FsbGJhY2tVUkw9JHtjdHguYm9keS5jYWxsYmFja1VSTCB8fCBcIi9cIn1gO1xuICAgICAgICBhd2FpdCBjdHguY29udGV4dC5vcHRpb25zLmVtYWlsVmVyaWZpY2F0aW9uLnNlbmRWZXJpZmljYXRpb25FbWFpbChcbiAgICAgICAgICB7XG4gICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgIC4uLmN0eC5jb250ZXh0LnNlc3Npb24udXNlcixcbiAgICAgICAgICAgICAgZW1haWw6IG5ld0VtYWlsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXJsOiB1cmwyLFxuICAgICAgICAgICAgdG9rZW46IHRva2VuMlxuICAgICAgICAgIH0sXG4gICAgICAgICAgY3R4LnJlcXVlc3RcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBjdHguanNvbih7XG4gICAgICAgIHN0YXR1czogdHJ1ZVxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmICghY3R4LmNvbnRleHQub3B0aW9ucy51c2VyLmNoYW5nZUVtYWlsLnNlbmRDaGFuZ2VFbWFpbFZlcmlmaWNhdGlvbikge1xuICAgICAgY3R4LmNvbnRleHQubG9nZ2VyLmVycm9yKFwiVmVyaWZpY2F0aW9uIGVtYWlsIGlzbid0IGVuYWJsZWQuXCIpO1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBcIlZlcmlmaWNhdGlvbiBlbWFpbCBpc24ndCBlbmFibGVkXCJcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCB0b2tlbiA9IGF3YWl0IGNyZWF0ZUVtYWlsVmVyaWZpY2F0aW9uVG9rZW4oXG4gICAgICBjdHguY29udGV4dC5zZWNyZXQsXG4gICAgICBjdHguY29udGV4dC5zZXNzaW9uLnVzZXIuZW1haWwsXG4gICAgICBuZXdFbWFpbCxcbiAgICAgIGN0eC5jb250ZXh0Lm9wdGlvbnMuZW1haWxWZXJpZmljYXRpb24/LmV4cGlyZXNJblxuICAgICk7XG4gICAgY29uc3QgdXJsID0gYCR7Y3R4LmNvbnRleHQuYmFzZVVSTH0vdmVyaWZ5LWVtYWlsP3Rva2VuPSR7dG9rZW59JmNhbGxiYWNrVVJMPSR7Y3R4LmJvZHkuY2FsbGJhY2tVUkwgfHwgXCIvXCJ9YDtcbiAgICBhd2FpdCBjdHguY29udGV4dC5vcHRpb25zLnVzZXIuY2hhbmdlRW1haWwuc2VuZENoYW5nZUVtYWlsVmVyaWZpY2F0aW9uKFxuICAgICAge1xuICAgICAgICB1c2VyOiBjdHguY29udGV4dC5zZXNzaW9uLnVzZXIsXG4gICAgICAgIG5ld0VtYWlsLFxuICAgICAgICB1cmwsXG4gICAgICAgIHRva2VuXG4gICAgICB9LFxuICAgICAgY3R4LnJlcXVlc3RcbiAgICApO1xuICAgIHJldHVybiBjdHguanNvbih7XG4gICAgICBzdGF0dXM6IHRydWVcbiAgICB9KTtcbiAgfVxuKTtcblxuZnVuY3Rpb24gc2FuaXRpemUoaW5wdXQpIHtcbiAgcmV0dXJuIGlucHV0LnJlcGxhY2UoLyYvZywgXCImYW1wO1wiKS5yZXBsYWNlKC88L2csIFwiJmx0O1wiKS5yZXBsYWNlKC8+L2csIFwiJmd0O1wiKS5yZXBsYWNlKC9cIi9nLCBcIiZxdW90O1wiKS5yZXBsYWNlKC8nL2csIFwiJiMzOTtcIik7XG59XG5jb25zdCBodG1sID0gKGVycm9yQ29kZSA9IFwiVW5rbm93blwiKSA9PiBgPCFET0NUWVBFIGh0bWw+XG48aHRtbCBsYW5nPVwiZW5cIj5cbjxoZWFkPlxuICAgIDxtZXRhIGNoYXJzZXQ9XCJVVEYtOFwiPlxuICAgIDxtZXRhIG5hbWU9XCJ2aWV3cG9ydFwiIGNvbnRlbnQ9XCJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wXCI+XG4gICAgPHRpdGxlPkF1dGhlbnRpY2F0aW9uIEVycm9yPC90aXRsZT5cbiAgICA8c3R5bGU+XG4gICAgICAgIDpyb290IHtcbiAgICAgICAgICAgIC0tYmctY29sb3I6ICNmOGY5ZmE7XG4gICAgICAgICAgICAtLXRleHQtY29sb3I6ICMyMTI1Mjk7XG4gICAgICAgICAgICAtLWFjY2VudC1jb2xvcjogIzAwMDAwMDtcbiAgICAgICAgICAgIC0tZXJyb3ItY29sb3I6ICNkYzM1NDU7XG4gICAgICAgICAgICAtLWJvcmRlci1jb2xvcjogI2U5ZWNlZjtcbiAgICAgICAgfVxuICAgICAgICBib2R5IHtcbiAgICAgICAgICAgIGZvbnQtZmFtaWx5OiAtYXBwbGUtc3lzdGVtLCBCbGlua01hY1N5c3RlbUZvbnQsICdTZWdvZSBVSScsIFJvYm90bywgJ0hlbHZldGljYSBOZXVlJywgQXJpYWwsIHNhbnMtc2VyaWY7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1iZy1jb2xvcik7XG4gICAgICAgICAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7XG4gICAgICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgICAgICAgICAgaGVpZ2h0OiAxMDB2aDtcbiAgICAgICAgICAgIG1hcmdpbjogMDtcbiAgICAgICAgICAgIGxpbmUtaGVpZ2h0OiAxLjU7XG4gICAgICAgIH1cbiAgICAgICAgLmVycm9yLWNvbnRhaW5lciB7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmZmZmO1xuICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogMTJweDtcbiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgNHB4IDZweCByZ2JhKDAsIDAsIDAsIDAuMDUpO1xuICAgICAgICAgICAgcGFkZGluZzogMi41cmVtO1xuICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgICAgICAgICAgbWF4LXdpZHRoOiA5MCU7XG4gICAgICAgICAgICB3aWR0aDogNDAwcHg7XG4gICAgICAgIH1cbiAgICAgICAgaDEge1xuICAgICAgICAgICAgY29sb3I6IHZhcigtLWVycm9yLWNvbG9yKTtcbiAgICAgICAgICAgIGZvbnQtc2l6ZTogMS43NXJlbTtcbiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDFyZW07XG4gICAgICAgICAgICBmb250LXdlaWdodDogNjAwO1xuICAgICAgICB9XG4gICAgICAgIHAge1xuICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMS41cmVtO1xuICAgICAgICAgICAgY29sb3I6ICM0OTUwNTc7XG4gICAgICAgIH1cbiAgICAgICAgLmJ0biB7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1hY2NlbnQtY29sb3IpO1xuICAgICAgICAgICAgY29sb3I6ICNmZmZmZmY7XG4gICAgICAgICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7XG4gICAgICAgICAgICBwYWRkaW5nOiAwLjc1cmVtIDEuNXJlbTtcbiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDZweDtcbiAgICAgICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjNzIGVhc2U7XG4gICAgICAgICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gICAgICAgICAgICBmb250LXdlaWdodDogNTAwO1xuICAgICAgICAgICAgYm9yZGVyOiAycHggc29saWQgdmFyKC0tYWNjZW50LWNvbG9yKTtcbiAgICAgICAgfVxuICAgICAgICAuYnRuOmhvdmVyIHtcbiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICMxMzE3MjE7XG4gICAgICAgIH1cbiAgICAgICAgLmVycm9yLWNvZGUge1xuICAgICAgICAgICAgZm9udC1zaXplOiAwLjg3NXJlbTtcbiAgICAgICAgICAgIGNvbG9yOiAjNmM3NTdkO1xuICAgICAgICAgICAgbWFyZ2luLXRvcDogMS41cmVtO1xuICAgICAgICAgICAgcGFkZGluZy10b3A6IDEuNXJlbTtcbiAgICAgICAgICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpO1xuICAgICAgICB9XG4gICAgICAgIC5pY29uIHtcbiAgICAgICAgICAgIGZvbnQtc2l6ZTogM3JlbTtcbiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDFyZW07XG4gICAgICAgIH1cbiAgICA8L3N0eWxlPlxuPC9oZWFkPlxuPGJvZHk+XG4gICAgPGRpdiBjbGFzcz1cImVycm9yLWNvbnRhaW5lclwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiaWNvblwiPlxcdTI2QTBcXHVGRTBGPC9kaXY+XG4gICAgICAgIDxoMT5CZXR0ZXIgQXV0aCBFcnJvcjwvaDE+XG4gICAgICAgIDxwPldlIGVuY291bnRlcmVkIGFuIGlzc3VlIHdoaWxlIHByb2Nlc3NpbmcgeW91ciByZXF1ZXN0LiBQbGVhc2UgdHJ5IGFnYWluIG9yIGNvbnRhY3QgdGhlIGFwcGxpY2F0aW9uIG93bmVyIGlmIHRoZSBwcm9ibGVtIHBlcnNpc3RzLjwvcD5cbiAgICAgICAgPGEgaHJlZj1cIi9cIiBpZD1cInJldHVybkxpbmtcIiBjbGFzcz1cImJ0blwiPlJldHVybiB0byBBcHBsaWNhdGlvbjwvYT5cbiAgICAgICAgPGRpdiBjbGFzcz1cImVycm9yLWNvZGVcIj5FcnJvciBDb2RlOiA8c3BhbiBpZD1cImVycm9yQ29kZVwiPiR7c2FuaXRpemUoXG4gIGVycm9yQ29kZVxuKX08L3NwYW4+PC9kaXY+XG4gICAgPC9kaXY+XG48L2JvZHk+XG48L2h0bWw+YDtcbmNvbnN0IGVycm9yID0gY3JlYXRlQXV0aEVuZHBvaW50KFxuICBcIi9lcnJvclwiLFxuICB7XG4gICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICAuLi5ISURFX01FVEFEQVRBLFxuICAgICAgb3BlbmFwaToge1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJEaXNwbGF5cyBhbiBlcnJvciBwYWdlXCIsXG4gICAgICAgIHJlc3BvbnNlczoge1xuICAgICAgICAgIFwiMjAwXCI6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlN1Y2Nlc3NcIixcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgXCJ0ZXh0L2h0bWxcIjoge1xuICAgICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBIVE1MIGNvbnRlbnQgb2YgdGhlIGVycm9yIHBhZ2VcIlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgYXN5bmMgKGMpID0+IHtcbiAgICBjb25zdCBxdWVyeSA9IG5ldyBVUkwoYy5yZXF1ZXN0Py51cmwgfHwgXCJcIikuc2VhcmNoUGFyYW1zLmdldChcImVycm9yXCIpIHx8IFwiVW5rbm93blwiO1xuICAgIHJldHVybiBuZXcgUmVzcG9uc2UoaHRtbChxdWVyeSksIHtcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJ0ZXh0L2h0bWxcIlxuICAgICAgfVxuICAgIH0pO1xuICB9XG4pO1xuXG5jb25zdCBvayA9IGNyZWF0ZUF1dGhFbmRwb2ludChcbiAgXCIvb2tcIixcbiAge1xuICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICBtZXRhZGF0YToge1xuICAgICAgLi4uSElERV9NRVRBREFUQSxcbiAgICAgIG9wZW5hcGk6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiQ2hlY2sgaWYgdGhlIEFQSSBpcyB3b3JraW5nXCIsXG4gICAgICAgIHJlc3BvbnNlczoge1xuICAgICAgICAgIFwiMjAwXCI6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkFQSSBpcyB3b3JraW5nXCIsXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiOiB7XG4gICAgICAgICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICBvazoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYm9vbGVhblwiLFxuICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkluZGljYXRlcyBpZiB0aGUgQVBJIGlzIHdvcmtpbmdcIlxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFtcIm9rXCJdXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBhc3luYyAoY3R4KSA9PiB7XG4gICAgcmV0dXJuIGN0eC5qc29uKHtcbiAgICAgIG9rOiB0cnVlXG4gICAgfSk7XG4gIH1cbik7XG5cbmNvbnN0IGxpc3RVc2VyQWNjb3VudHMgPSBjcmVhdGVBdXRoRW5kcG9pbnQoXG4gIFwiL2xpc3QtYWNjb3VudHNcIixcbiAge1xuICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICB1c2U6IFtzZXNzaW9uTWlkZGxld2FyZV0sXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgIG9wZW5hcGk6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiTGlzdCBhbGwgYWNjb3VudHMgbGlua2VkIHRvIHRoZSB1c2VyXCIsXG4gICAgICAgIHJlc3BvbnNlczoge1xuICAgICAgICAgIFwiMjAwXCI6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlN1Y2Nlc3NcIixcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbi9qc29uXCI6IHtcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYXJyYXlcIixcbiAgICAgICAgICAgICAgICAgIGl0ZW1zOiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICBpZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIlxuICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgcHJvdmlkZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCJcbiAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogXCJkYXRlLXRpbWVcIlxuICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgdXBkYXRlZEF0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBcImRhdGUtdGltZVwiXG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHNjb3Blczoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYXJyYXlcIixcbiAgICAgICAgICAgICAgICAgICAgICBpdGVtczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIlxuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBbXG4gICAgICAgICAgICAgICAgICAgIFwiaWRcIixcbiAgICAgICAgICAgICAgICAgICAgXCJwcm92aWRlclwiLFxuICAgICAgICAgICAgICAgICAgICBcImNyZWF0ZWRBdFwiLFxuICAgICAgICAgICAgICAgICAgICBcInVwZGF0ZWRBdFwiLFxuICAgICAgICAgICAgICAgICAgICBcImFjY291bnRJZFwiLFxuICAgICAgICAgICAgICAgICAgICBcInNjb3Blc1wiXG4gICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBhc3luYyAoYykgPT4ge1xuICAgIGNvbnN0IHNlc3Npb24gPSBjLmNvbnRleHQuc2Vzc2lvbjtcbiAgICBjb25zdCBhY2NvdW50cyA9IGF3YWl0IGMuY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZmluZEFjY291bnRzKFxuICAgICAgc2Vzc2lvbi51c2VyLmlkXG4gICAgKTtcbiAgICByZXR1cm4gYy5qc29uKFxuICAgICAgYWNjb3VudHMubWFwKChhKSA9PiAoe1xuICAgICAgICBpZDogYS5pZCxcbiAgICAgICAgcHJvdmlkZXI6IGEucHJvdmlkZXJJZCxcbiAgICAgICAgY3JlYXRlZEF0OiBhLmNyZWF0ZWRBdCxcbiAgICAgICAgdXBkYXRlZEF0OiBhLnVwZGF0ZWRBdCxcbiAgICAgICAgYWNjb3VudElkOiBhLmFjY291bnRJZCxcbiAgICAgICAgc2NvcGVzOiBhLnNjb3BlPy5zcGxpdChcIixcIikgfHwgW11cbiAgICAgIH0pKVxuICAgICk7XG4gIH1cbik7XG5jb25zdCBsaW5rU29jaWFsQWNjb3VudCA9IGNyZWF0ZUF1dGhFbmRwb2ludChcbiAgXCIvbGluay1zb2NpYWxcIixcbiAge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgcmVxdWlyZUhlYWRlcnM6IHRydWUsXG4gICAgYm9keTogei5vYmplY3Qoe1xuICAgICAgLyoqXG4gICAgICAgKiBDYWxsYmFjayBVUkwgdG8gcmVkaXJlY3QgdG8gYWZ0ZXIgdGhlIHVzZXIgaGFzIHNpZ25lZCBpbi5cbiAgICAgICAqL1xuICAgICAgY2FsbGJhY2tVUkw6IHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBVUkwgdG8gcmVkaXJlY3QgdG8gYWZ0ZXIgdGhlIHVzZXIgaGFzIHNpZ25lZCBpblwiXG4gICAgICB9KS5vcHRpb25hbCgpLFxuICAgICAgLyoqXG4gICAgICAgKiBPQXV0aDIgcHJvdmlkZXIgdG8gdXNlXG4gICAgICAgKi9cbiAgICAgIHByb3ZpZGVyOiBTb2NpYWxQcm92aWRlckxpc3RFbnVtLFxuICAgICAgLyoqXG4gICAgICAgKiBJRCBUb2tlbiBmb3IgZGlyZWN0IGF1dGhlbnRpY2F0aW9uIHdpdGhvdXQgcmVkaXJlY3RcbiAgICAgICAqL1xuICAgICAgaWRUb2tlbjogei5vYmplY3Qoe1xuICAgICAgICB0b2tlbjogei5zdHJpbmcoKSxcbiAgICAgICAgbm9uY2U6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICAgICAgYWNjZXNzVG9rZW46IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICAgICAgcmVmcmVzaFRva2VuOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICAgIHNjb3Blczogei5hcnJheSh6LnN0cmluZygpKS5vcHRpb25hbCgpXG4gICAgICB9KS5vcHRpb25hbCgpLFxuICAgICAgLyoqXG4gICAgICAgKiBXaGV0aGVyIHRvIGFsbG93IHNpZ24gdXAgZm9yIG5ldyB1c2Vyc1xuICAgICAgICovXG4gICAgICByZXF1ZXN0U2lnblVwOiB6LmJvb2xlYW4oKS5vcHRpb25hbCgpLFxuICAgICAgLyoqXG4gICAgICAgKiBBZGRpdGlvbmFsIHNjb3BlcyB0byByZXF1ZXN0IHdoZW4gbGlua2luZyB0aGUgYWNjb3VudC5cbiAgICAgICAqIFRoaXMgaXMgdXNlZnVsIGZvciByZXF1ZXN0aW5nIGFkZGl0aW9uYWwgcGVybWlzc2lvbnMgd2hlblxuICAgICAgICogbGlua2luZyBhIHNvY2lhbCBhY2NvdW50IGNvbXBhcmVkIHRvIHRoZSBpbml0aWFsIGF1dGhlbnRpY2F0aW9uLlxuICAgICAgICovXG4gICAgICBzY29wZXM6IHouYXJyYXkoei5zdHJpbmcoKSkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIkFkZGl0aW9uYWwgc2NvcGVzIHRvIHJlcXVlc3QgZnJvbSB0aGUgcHJvdmlkZXJcIlxuICAgICAgfSkub3B0aW9uYWwoKSxcbiAgICAgIC8qKlxuICAgICAgICogVGhlIFVSTCB0byByZWRpcmVjdCB0byBpZiB0aGVyZSBpcyBhbiBlcnJvciBkdXJpbmcgdGhlIGxpbmsgcHJvY2Vzcy5cbiAgICAgICAqL1xuICAgICAgZXJyb3JDYWxsYmFja1VSTDogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIFVSTCB0byByZWRpcmVjdCB0byBpZiB0aGVyZSBpcyBhbiBlcnJvciBkdXJpbmcgdGhlIGxpbmsgcHJvY2Vzc1wiXG4gICAgICB9KS5vcHRpb25hbCgpXG4gICAgfSksXG4gICAgdXNlOiBbc2Vzc2lvbk1pZGRsZXdhcmVdLFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICBvcGVuYXBpOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIkxpbmsgYSBzb2NpYWwgYWNjb3VudCB0byB0aGUgdXNlclwiLFxuICAgICAgICByZXNwb25zZXM6IHtcbiAgICAgICAgICBcIjIwMFwiOiB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJTdWNjZXNzXCIsXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiOiB7XG4gICAgICAgICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBhdXRob3JpemF0aW9uIFVSTCB0byByZWRpcmVjdCB0aGUgdXNlciB0b1wiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHJlZGlyZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJib29sZWFuXCIsXG4gICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiSW5kaWNhdGVzIGlmIHRoZSB1c2VyIHNob3VsZCBiZSByZWRpcmVjdGVkIHRvIHRoZSBhdXRob3JpemF0aW9uIFVSTFwiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYm9vbGVhblwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICByZXF1aXJlZDogW1wicmVkaXJlY3RcIl1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGFzeW5jIChjKSA9PiB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGMuY29udGV4dC5zZXNzaW9uO1xuICAgIGNvbnN0IHByb3ZpZGVyID0gYy5jb250ZXh0LnNvY2lhbFByb3ZpZGVycy5maW5kKFxuICAgICAgKHApID0+IHAuaWQgPT09IGMuYm9keS5wcm92aWRlclxuICAgICk7XG4gICAgaWYgKCFwcm92aWRlcikge1xuICAgICAgYy5jb250ZXh0LmxvZ2dlci5lcnJvcihcbiAgICAgICAgXCJQcm92aWRlciBub3QgZm91bmQuIE1ha2Ugc3VyZSB0byBhZGQgdGhlIHByb3ZpZGVyIGluIHlvdXIgYXV0aCBjb25maWdcIixcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGVyOiBjLmJvZHkucHJvdmlkZXJcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIk5PVF9GT1VORFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuUFJPVklERVJfTk9UX0ZPVU5EXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGMuYm9keS5pZFRva2VuKSB7XG4gICAgICBpZiAoIXByb3ZpZGVyLnZlcmlmeUlkVG9rZW4pIHtcbiAgICAgICAgYy5jb250ZXh0LmxvZ2dlci5lcnJvcihcbiAgICAgICAgICBcIlByb3ZpZGVyIGRvZXMgbm90IHN1cHBvcnQgaWQgdG9rZW4gdmVyaWZpY2F0aW9uXCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgcHJvdmlkZXI6IGMuYm9keS5wcm92aWRlclxuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiTk9UX0ZPVU5EXCIsIHtcbiAgICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLklEX1RPS0VOX05PVF9TVVBQT1JURURcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBjb25zdCB7IHRva2VuLCBub25jZSB9ID0gYy5ib2R5LmlkVG9rZW47XG4gICAgICBjb25zdCB2YWxpZCA9IGF3YWl0IHByb3ZpZGVyLnZlcmlmeUlkVG9rZW4odG9rZW4sIG5vbmNlKTtcbiAgICAgIGlmICghdmFsaWQpIHtcbiAgICAgICAgYy5jb250ZXh0LmxvZ2dlci5lcnJvcihcIkludmFsaWQgaWQgdG9rZW5cIiwge1xuICAgICAgICAgIHByb3ZpZGVyOiBjLmJvZHkucHJvdmlkZXJcbiAgICAgICAgfSk7XG4gICAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIlVOQVVUSE9SSVpFRFwiLCB7XG4gICAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5JTlZBTElEX1RPS0VOXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgY29uc3QgbGlua2luZ1VzZXJJbmZvID0gYXdhaXQgcHJvdmlkZXIuZ2V0VXNlckluZm8oe1xuICAgICAgICBpZFRva2VuOiB0b2tlbixcbiAgICAgICAgYWNjZXNzVG9rZW46IGMuYm9keS5pZFRva2VuLmFjY2Vzc1Rva2VuLFxuICAgICAgICByZWZyZXNoVG9rZW46IGMuYm9keS5pZFRva2VuLnJlZnJlc2hUb2tlblxuICAgICAgfSk7XG4gICAgICBpZiAoIWxpbmtpbmdVc2VySW5mbyB8fCAhbGlua2luZ1VzZXJJbmZvPy51c2VyKSB7XG4gICAgICAgIGMuY29udGV4dC5sb2dnZXIuZXJyb3IoXCJGYWlsZWQgdG8gZ2V0IHVzZXIgaW5mb1wiLCB7XG4gICAgICAgICAgcHJvdmlkZXI6IGMuYm9keS5wcm92aWRlclxuICAgICAgICB9KTtcbiAgICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiVU5BVVRIT1JJWkVEXCIsIHtcbiAgICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLkZBSUxFRF9UT19HRVRfVVNFUl9JTkZPXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaWYgKCFsaW5raW5nVXNlckluZm8udXNlci5lbWFpbCkge1xuICAgICAgICBjLmNvbnRleHQubG9nZ2VyLmVycm9yKFwiVXNlciBlbWFpbCBub3QgZm91bmRcIiwge1xuICAgICAgICAgIHByb3ZpZGVyOiBjLmJvZHkucHJvdmlkZXJcbiAgICAgICAgfSk7XG4gICAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIlVOQVVUSE9SSVpFRFwiLCB7XG4gICAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5VU0VSX0VNQUlMX05PVF9GT1VORFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGV4aXN0aW5nQWNjb3VudHMgPSBhd2FpdCBjLmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmZpbmRBY2NvdW50cyhcbiAgICAgICAgc2Vzc2lvbi51c2VyLmlkXG4gICAgICApO1xuICAgICAgY29uc3QgaGFzQmVlbkxpbmtlZCA9IGV4aXN0aW5nQWNjb3VudHMuZmluZChcbiAgICAgICAgKGEpID0+IGEucHJvdmlkZXJJZCA9PT0gcHJvdmlkZXIuaWQgJiYgYS5hY2NvdW50SWQgPT09IGxpbmtpbmdVc2VySW5mby51c2VyLmlkXG4gICAgICApO1xuICAgICAgaWYgKGhhc0JlZW5MaW5rZWQpIHtcbiAgICAgICAgcmV0dXJuIGMuanNvbih7XG4gICAgICAgICAgcmVkaXJlY3Q6IGZhbHNlLFxuICAgICAgICAgIHVybDogXCJcIixcbiAgICAgICAgICAvLyB0aGlzIGlzIGZvciB0eXBlIGluZmVyZW5jZVxuICAgICAgICAgIHN0YXR1czogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHRydXN0ZWRQcm92aWRlcnMgPSBjLmNvbnRleHQub3B0aW9ucy5hY2NvdW50Py5hY2NvdW50TGlua2luZz8udHJ1c3RlZFByb3ZpZGVycztcbiAgICAgIGNvbnN0IGlzVHJ1c3RlZFByb3ZpZGVyID0gdHJ1c3RlZFByb3ZpZGVycz8uaW5jbHVkZXMocHJvdmlkZXIuaWQpO1xuICAgICAgaWYgKCFpc1RydXN0ZWRQcm92aWRlciAmJiAhbGlua2luZ1VzZXJJbmZvLnVzZXIuZW1haWxWZXJpZmllZCB8fCBjLmNvbnRleHQub3B0aW9ucy5hY2NvdW50Py5hY2NvdW50TGlua2luZz8uZW5hYmxlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiVU5BVVRIT1JJWkVEXCIsIHtcbiAgICAgICAgICBtZXNzYWdlOiBcIkFjY291bnQgbm90IGxpbmtlZCAtIGxpbmtpbmcgbm90IGFsbG93ZWRcIlxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGlmIChsaW5raW5nVXNlckluZm8udXNlci5lbWFpbCAhPT0gc2Vzc2lvbi51c2VyLmVtYWlsICYmIGMuY29udGV4dC5vcHRpb25zLmFjY291bnQ/LmFjY291bnRMaW5raW5nPy5hbGxvd0RpZmZlcmVudEVtYWlscyAhPT0gdHJ1ZSkge1xuICAgICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJVTkFVVEhPUklaRURcIiwge1xuICAgICAgICAgIG1lc3NhZ2U6IFwiQWNjb3VudCBub3QgbGlua2VkIC0gZGlmZmVyZW50IGVtYWlscyBub3QgYWxsb3dlZFwiXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgYy5jb250ZXh0LmludGVybmFsQWRhcHRlci5jcmVhdGVBY2NvdW50KFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgcHJvdmlkZXJJZDogcHJvdmlkZXIuaWQsXG4gICAgICAgICAgICBhY2NvdW50SWQ6IGxpbmtpbmdVc2VySW5mby51c2VyLmlkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICBhY2Nlc3NUb2tlbjogYy5ib2R5LmlkVG9rZW4uYWNjZXNzVG9rZW4sXG4gICAgICAgICAgICBpZFRva2VuOiB0b2tlbixcbiAgICAgICAgICAgIHJlZnJlc2hUb2tlbjogYy5ib2R5LmlkVG9rZW4ucmVmcmVzaFRva2VuLFxuICAgICAgICAgICAgc2NvcGU6IGMuYm9keS5pZFRva2VuLnNjb3Blcz8uam9pbihcIixcIilcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNcbiAgICAgICAgKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiRVhQRUNUQVRJT05fRkFJTEVEXCIsIHtcbiAgICAgICAgICBtZXNzYWdlOiBcIkFjY291bnQgbm90IGxpbmtlZCAtIHVuYWJsZSB0byBjcmVhdGUgYWNjb3VudFwiXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaWYgKGMuY29udGV4dC5vcHRpb25zLmFjY291bnQ/LmFjY291bnRMaW5raW5nPy51cGRhdGVVc2VySW5mb09uTGluayA9PT0gdHJ1ZSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IGMuY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIudXBkYXRlVXNlcihzZXNzaW9uLnVzZXIuaWQsIHtcbiAgICAgICAgICAgIG5hbWU6IGxpbmtpbmdVc2VySW5mby51c2VyPy5uYW1lLFxuICAgICAgICAgICAgaW1hZ2U6IGxpbmtpbmdVc2VySW5mby51c2VyPy5pbWFnZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKFwiQ291bGQgbm90IHVwZGF0ZSB1c2VyIC0gXCIgKyBlLnRvU3RyaW5nKCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gYy5qc29uKHtcbiAgICAgICAgcmVkaXJlY3Q6IGZhbHNlLFxuICAgICAgICB1cmw6IFwiXCIsXG4gICAgICAgIC8vIHRoaXMgaXMgZm9yIHR5cGUgaW5mZXJlbmNlXG4gICAgICAgIHN0YXR1czogdHJ1ZVxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IHN0YXRlID0gYXdhaXQgZ2VuZXJhdGVTdGF0ZShjLCB7XG4gICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgIGVtYWlsOiBzZXNzaW9uLnVzZXIuZW1haWxcbiAgICB9KTtcbiAgICBjb25zdCB1cmwgPSBhd2FpdCBwcm92aWRlci5jcmVhdGVBdXRob3JpemF0aW9uVVJMKHtcbiAgICAgIHN0YXRlOiBzdGF0ZS5zdGF0ZSxcbiAgICAgIGNvZGVWZXJpZmllcjogc3RhdGUuY29kZVZlcmlmaWVyLFxuICAgICAgcmVkaXJlY3RVUkk6IGAke2MuY29udGV4dC5iYXNlVVJMfS9jYWxsYmFjay8ke3Byb3ZpZGVyLmlkfWAsXG4gICAgICBzY29wZXM6IGMuYm9keS5zY29wZXNcbiAgICB9KTtcbiAgICByZXR1cm4gYy5qc29uKHtcbiAgICAgIHVybDogdXJsLnRvU3RyaW5nKCksXG4gICAgICByZWRpcmVjdDogdHJ1ZVxuICAgIH0pO1xuICB9XG4pO1xuY29uc3QgdW5saW5rQWNjb3VudCA9IGNyZWF0ZUF1dGhFbmRwb2ludChcbiAgXCIvdW5saW5rLWFjY291bnRcIixcbiAge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgYm9keTogei5vYmplY3Qoe1xuICAgICAgcHJvdmlkZXJJZDogei5zdHJpbmcoKSxcbiAgICAgIGFjY291bnRJZDogei5zdHJpbmcoKS5vcHRpb25hbCgpXG4gICAgfSksXG4gICAgdXNlOiBbZnJlc2hTZXNzaW9uTWlkZGxld2FyZV0sXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgIG9wZW5hcGk6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVW5saW5rIGFuIGFjY291bnRcIixcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgXCIyMDBcIjoge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiU3VjY2Vzc1wiLFxuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIjoge1xuICAgICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJib29sZWFuXCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgYXN5bmMgKGN0eCkgPT4ge1xuICAgIGNvbnN0IHsgcHJvdmlkZXJJZCwgYWNjb3VudElkIH0gPSBjdHguYm9keTtcbiAgICBjb25zdCBhY2NvdW50cyA9IGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5maW5kQWNjb3VudHMoXG4gICAgICBjdHguY29udGV4dC5zZXNzaW9uLnVzZXIuaWRcbiAgICApO1xuICAgIGlmIChhY2NvdW50cy5sZW5ndGggPT09IDEgJiYgIWN0eC5jb250ZXh0Lm9wdGlvbnMuYWNjb3VudD8uYWNjb3VudExpbmtpbmc/LmFsbG93VW5saW5raW5nQWxsKSB7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuRkFJTEVEX1RPX1VOTElOS19MQVNUX0FDQ09VTlRcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBhY2NvdW50RXhpc3QgPSBhY2NvdW50cy5maW5kKFxuICAgICAgKGFjY291bnQpID0+IGFjY291bnRJZCA/IGFjY291bnQuYWNjb3VudElkID09PSBhY2NvdW50SWQgJiYgYWNjb3VudC5wcm92aWRlcklkID09PSBwcm92aWRlcklkIDogYWNjb3VudC5wcm92aWRlcklkID09PSBwcm92aWRlcklkXG4gICAgKTtcbiAgICBpZiAoIWFjY291bnRFeGlzdCkge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLkFDQ09VTlRfTk9UX0ZPVU5EXG4gICAgICB9KTtcbiAgICB9XG4gICAgYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmRlbGV0ZUFjY291bnQoYWNjb3VudEV4aXN0LmlkKTtcbiAgICByZXR1cm4gY3R4Lmpzb24oe1xuICAgICAgc3RhdHVzOiB0cnVlXG4gICAgfSk7XG4gIH1cbik7XG5jb25zdCBnZXRBY2Nlc3NUb2tlbiA9IGNyZWF0ZUF1dGhFbmRwb2ludChcbiAgXCIvZ2V0LWFjY2Vzcy10b2tlblwiLFxuICB7XG4gICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICBib2R5OiB6Lm9iamVjdCh7XG4gICAgICBwcm92aWRlcklkOiB6LnN0cmluZygpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgcHJvdmlkZXIgSUQgZm9yIHRoZSBPQXV0aCBwcm92aWRlclwiXG4gICAgICB9KSxcbiAgICAgIGFjY291bnRJZDogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIGFjY291bnQgSUQgYXNzb2NpYXRlZCB3aXRoIHRoZSByZWZyZXNoIHRva2VuXCJcbiAgICAgIH0pLm9wdGlvbmFsKCksXG4gICAgICB1c2VySWQ6IHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSB1c2VyIElEIGFzc29jaWF0ZWQgd2l0aCB0aGUgYWNjb3VudFwiXG4gICAgICB9KS5vcHRpb25hbCgpXG4gICAgfSksXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgIG9wZW5hcGk6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiR2V0IGEgdmFsaWQgYWNjZXNzIHRva2VuLCBkb2luZyBhIHJlZnJlc2ggaWYgbmVlZGVkXCIsXG4gICAgICAgIHJlc3BvbnNlczoge1xuICAgICAgICAgIDIwMDoge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiQSBWYWxpZCBhY2Nlc3MgdG9rZW5cIixcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbi9qc29uXCI6IHtcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgIHRva2VuVHlwZToge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgaWRUb2tlbjoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgYWNjZXNzVG9rZW46IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHJlZnJlc2hUb2tlbjoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgYWNjZXNzVG9rZW5FeHBpcmVzQXQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogXCJkYXRlLXRpbWVcIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICByZWZyZXNoVG9rZW5FeHBpcmVzQXQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogXCJkYXRlLXRpbWVcIlxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICA0MDA6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkludmFsaWQgcmVmcmVzaCB0b2tlbiBvciBwcm92aWRlciBjb25maWd1cmF0aW9uXCJcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGFzeW5jIChjdHgpID0+IHtcbiAgICBjb25zdCB7IHByb3ZpZGVySWQsIGFjY291bnRJZCwgdXNlcklkIH0gPSBjdHguYm9keTtcbiAgICBjb25zdCByZXEgPSBjdHgucmVxdWVzdDtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZ2V0U2Vzc2lvbkZyb21DdHgoY3R4KTtcbiAgICBpZiAocmVxICYmICFzZXNzaW9uKSB7XG4gICAgICB0aHJvdyBjdHguZXJyb3IoXCJVTkFVVEhPUklaRURcIik7XG4gICAgfVxuICAgIGxldCByZXNvbHZlZFVzZXJJZCA9IHNlc3Npb24/LnVzZXI/LmlkIHx8IHVzZXJJZDtcbiAgICBpZiAoIXJlc29sdmVkVXNlcklkKSB7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IGBFaXRoZXIgdXNlcklkIG9yIHNlc3Npb24gaXMgcmVxdWlyZWRgXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKCFjdHguY29udGV4dC5zb2NpYWxQcm92aWRlcnMuZmluZCgocCkgPT4gcC5pZCA9PT0gcHJvdmlkZXJJZCkpIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogYFByb3ZpZGVyICR7cHJvdmlkZXJJZH0gaXMgbm90IHN1cHBvcnRlZC5gXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgYWNjb3VudHMgPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZmluZEFjY291bnRzKHJlc29sdmVkVXNlcklkKTtcbiAgICBjb25zdCBhY2NvdW50ID0gYWNjb3VudHMuZmluZChcbiAgICAgIChhY2MpID0+IGFjY291bnRJZCA/IGFjYy5pZCA9PT0gYWNjb3VudElkICYmIGFjYy5wcm92aWRlcklkID09PSBwcm92aWRlcklkIDogYWNjLnByb3ZpZGVySWQgPT09IHByb3ZpZGVySWRcbiAgICApO1xuICAgIGlmICghYWNjb3VudCkge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBcIkFjY291bnQgbm90IGZvdW5kXCJcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBwcm92aWRlciA9IGN0eC5jb250ZXh0LnNvY2lhbFByb3ZpZGVycy5maW5kKFxuICAgICAgKHApID0+IHAuaWQgPT09IHByb3ZpZGVySWRcbiAgICApO1xuICAgIGlmICghcHJvdmlkZXIpIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogYFByb3ZpZGVyICR7cHJvdmlkZXJJZH0gbm90IGZvdW5kLmBcbiAgICAgIH0pO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgbGV0IG5ld1Rva2VucyA9IG51bGw7XG4gICAgICBjb25zdCBhY2Nlc3NUb2tlbkV4cGlyZWQgPSBhY2NvdW50LmFjY2Vzc1Rva2VuRXhwaXJlc0F0ICYmIG5ldyBEYXRlKGFjY291bnQuYWNjZXNzVG9rZW5FeHBpcmVzQXQpLmdldFRpbWUoKSAtIERhdGUubm93KCkgPCA1ZTM7XG4gICAgICBpZiAoYWNjb3VudC5yZWZyZXNoVG9rZW4gJiYgYWNjZXNzVG9rZW5FeHBpcmVkICYmIHByb3ZpZGVyLnJlZnJlc2hBY2Nlc3NUb2tlbikge1xuICAgICAgICBuZXdUb2tlbnMgPSBhd2FpdCBwcm92aWRlci5yZWZyZXNoQWNjZXNzVG9rZW4oXG4gICAgICAgICAgYWNjb3VudC5yZWZyZXNoVG9rZW5cbiAgICAgICAgKTtcbiAgICAgICAgYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLnVwZGF0ZUFjY291bnQoYWNjb3VudC5pZCwge1xuICAgICAgICAgIGFjY2Vzc1Rva2VuOiBhd2FpdCBzZXRUb2tlblV0aWwobmV3VG9rZW5zLmFjY2Vzc1Rva2VuLCBjdHguY29udGV4dCksXG4gICAgICAgICAgYWNjZXNzVG9rZW5FeHBpcmVzQXQ6IG5ld1Rva2Vucy5hY2Nlc3NUb2tlbkV4cGlyZXNBdCxcbiAgICAgICAgICByZWZyZXNoVG9rZW46IGF3YWl0IHNldFRva2VuVXRpbChuZXdUb2tlbnMucmVmcmVzaFRva2VuLCBjdHguY29udGV4dCksXG4gICAgICAgICAgcmVmcmVzaFRva2VuRXhwaXJlc0F0OiBuZXdUb2tlbnMucmVmcmVzaFRva2VuRXhwaXJlc0F0XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgY29uc3QgdG9rZW5zID0ge1xuICAgICAgICBhY2Nlc3NUb2tlbjogYXdhaXQgZGVjcnlwdE9BdXRoVG9rZW4oXG4gICAgICAgICAgbmV3VG9rZW5zPy5hY2Nlc3NUb2tlbiA/PyBhY2NvdW50LmFjY2Vzc1Rva2VuID8/IFwiXCIsXG4gICAgICAgICAgY3R4LmNvbnRleHRcbiAgICAgICAgKSxcbiAgICAgICAgYWNjZXNzVG9rZW5FeHBpcmVzQXQ6IG5ld1Rva2Vucz8uYWNjZXNzVG9rZW5FeHBpcmVzQXQgPz8gYWNjb3VudC5hY2Nlc3NUb2tlbkV4cGlyZXNBdCA/PyB2b2lkIDAsXG4gICAgICAgIHNjb3BlczogYWNjb3VudC5zY29wZT8uc3BsaXQoXCIsXCIpID8/IFtdLFxuICAgICAgICBpZFRva2VuOiBuZXdUb2tlbnM/LmlkVG9rZW4gPz8gYWNjb3VudC5pZFRva2VuID8/IHZvaWQgMFxuICAgICAgfTtcbiAgICAgIHJldHVybiBjdHguanNvbih0b2tlbnMpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGdldCBhIHZhbGlkIGFjY2VzcyB0b2tlblwiLFxuICAgICAgICBjYXVzZTogZXJyb3JcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuKTtcbmNvbnN0IHJlZnJlc2hUb2tlbiA9IGNyZWF0ZUF1dGhFbmRwb2ludChcbiAgXCIvcmVmcmVzaC10b2tlblwiLFxuICB7XG4gICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICBib2R5OiB6Lm9iamVjdCh7XG4gICAgICBwcm92aWRlcklkOiB6LnN0cmluZygpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgcHJvdmlkZXIgSUQgZm9yIHRoZSBPQXV0aCBwcm92aWRlclwiXG4gICAgICB9KSxcbiAgICAgIGFjY291bnRJZDogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIGFjY291bnQgSUQgYXNzb2NpYXRlZCB3aXRoIHRoZSByZWZyZXNoIHRva2VuXCJcbiAgICAgIH0pLm9wdGlvbmFsKCksXG4gICAgICB1c2VySWQ6IHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSB1c2VyIElEIGFzc29jaWF0ZWQgd2l0aCB0aGUgYWNjb3VudFwiXG4gICAgICB9KS5vcHRpb25hbCgpXG4gICAgfSksXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgIG9wZW5hcGk6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiUmVmcmVzaCB0aGUgYWNjZXNzIHRva2VuIHVzaW5nIGEgcmVmcmVzaCB0b2tlblwiLFxuICAgICAgICByZXNwb25zZXM6IHtcbiAgICAgICAgICAyMDA6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkFjY2VzcyB0b2tlbiByZWZyZXNoZWQgc3VjY2Vzc2Z1bGx5XCIsXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiOiB7XG4gICAgICAgICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICB0b2tlblR5cGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGlkVG9rZW46IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICByZWZyZXNoVG9rZW46IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuRXhwaXJlc0F0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFwiZGF0ZS10aW1lXCJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgcmVmcmVzaFRva2VuRXhwaXJlc0F0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFwiZGF0ZS10aW1lXCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgNDAwOiB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJJbnZhbGlkIHJlZnJlc2ggdG9rZW4gb3IgcHJvdmlkZXIgY29uZmlndXJhdGlvblwiXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBhc3luYyAoY3R4KSA9PiB7XG4gICAgY29uc3QgeyBwcm92aWRlcklkLCBhY2NvdW50SWQsIHVzZXJJZCB9ID0gY3R4LmJvZHk7XG4gICAgY29uc3QgcmVxID0gY3R4LnJlcXVlc3Q7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGdldFNlc3Npb25Gcm9tQ3R4KGN0eCk7XG4gICAgaWYgKHJlcSAmJiAhc2Vzc2lvbikge1xuICAgICAgdGhyb3cgY3R4LmVycm9yKFwiVU5BVVRIT1JJWkVEXCIpO1xuICAgIH1cbiAgICBsZXQgcmVzb2x2ZWRVc2VySWQgPSBzZXNzaW9uPy51c2VyPy5pZCB8fCB1c2VySWQ7XG4gICAgaWYgKCFyZXNvbHZlZFVzZXJJZCkge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBgRWl0aGVyIHVzZXJJZCBvciBzZXNzaW9uIGlzIHJlcXVpcmVkYFxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IGFjY291bnRzID0gYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmZpbmRBY2NvdW50cyhyZXNvbHZlZFVzZXJJZCk7XG4gICAgY29uc3QgYWNjb3VudCA9IGFjY291bnRzLmZpbmQoXG4gICAgICAoYWNjKSA9PiBhY2NvdW50SWQgPyBhY2MuaWQgPT09IGFjY291bnRJZCAmJiBhY2MucHJvdmlkZXJJZCA9PT0gcHJvdmlkZXJJZCA6IGFjYy5wcm92aWRlcklkID09PSBwcm92aWRlcklkXG4gICAgKTtcbiAgICBpZiAoIWFjY291bnQpIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogXCJBY2NvdW50IG5vdCBmb3VuZFwiXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgcHJvdmlkZXIgPSBjdHguY29udGV4dC5zb2NpYWxQcm92aWRlcnMuZmluZChcbiAgICAgIChwKSA9PiBwLmlkID09PSBwcm92aWRlcklkXG4gICAgKTtcbiAgICBpZiAoIXByb3ZpZGVyKSB7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IGBQcm92aWRlciAke3Byb3ZpZGVySWR9IG5vdCBmb3VuZC5gXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKCFwcm92aWRlci5yZWZyZXNoQWNjZXNzVG9rZW4pIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogYFByb3ZpZGVyICR7cHJvdmlkZXJJZH0gZG9lcyBub3Qgc3VwcG9ydCB0b2tlbiByZWZyZXNoaW5nLmBcbiAgICAgIH0pO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgY29uc3QgdG9rZW5zID0gYXdhaXQgcHJvdmlkZXIucmVmcmVzaEFjY2Vzc1Rva2VuKFxuICAgICAgICBhY2NvdW50LnJlZnJlc2hUb2tlblxuICAgICAgKTtcbiAgICAgIGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci51cGRhdGVBY2NvdW50KGFjY291bnQuaWQsIHtcbiAgICAgICAgYWNjZXNzVG9rZW46IGF3YWl0IHNldFRva2VuVXRpbCh0b2tlbnMuYWNjZXNzVG9rZW4sIGN0eC5jb250ZXh0KSxcbiAgICAgICAgcmVmcmVzaFRva2VuOiBhd2FpdCBzZXRUb2tlblV0aWwodG9rZW5zLnJlZnJlc2hUb2tlbiwgY3R4LmNvbnRleHQpLFxuICAgICAgICBhY2Nlc3NUb2tlbkV4cGlyZXNBdDogdG9rZW5zLmFjY2Vzc1Rva2VuRXhwaXJlc0F0LFxuICAgICAgICByZWZyZXNoVG9rZW5FeHBpcmVzQXQ6IHRva2Vucy5yZWZyZXNoVG9rZW5FeHBpcmVzQXRcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGN0eC5qc29uKHRva2Vucyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogXCJGYWlsZWQgdG8gcmVmcmVzaCBhY2Nlc3MgdG9rZW5cIixcbiAgICAgICAgY2F1c2U6IGVycm9yXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbik7XG5jb25zdCBhY2NvdW50SW5mbyA9IGNyZWF0ZUF1dGhFbmRwb2ludChcbiAgXCIvYWNjb3VudC1pbmZvXCIsXG4gIHtcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgIHVzZTogW3Nlc3Npb25NaWRkbGV3YXJlXSxcbiAgICBtZXRhZGF0YToge1xuICAgICAgb3BlbmFwaToge1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJHZXQgdGhlIGFjY291bnQgaW5mbyBwcm92aWRlZCBieSB0aGUgcHJvdmlkZXJcIixcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgXCIyMDBcIjoge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiU3VjY2Vzc1wiLFxuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIjoge1xuICAgICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWFnZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZW1haWxWZXJpZmllZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImJvb2xlYW5cIlxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFtcImlkXCIsIFwiZW1haWxWZXJpZmllZFwiXVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgICBhZGRpdGlvbmFsUHJvcGVydGllczogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFtcInVzZXJcIiwgXCJkYXRhXCJdLFxuICAgICAgICAgICAgICAgICAgYWRkaXRpb25hbFByb3BlcnRpZXM6IGZhbHNlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBib2R5OiB6Lm9iamVjdCh7XG4gICAgICBhY2NvdW50SWQ6IHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBwcm92aWRlciBnaXZlbiBhY2NvdW50IGlkIGZvciB3aGljaCB0byBnZXQgdGhlIGFjY291bnQgaW5mb1wiXG4gICAgICB9KVxuICAgIH0pXG4gIH0sXG4gIGFzeW5jIChjdHgpID0+IHtcbiAgICBjb25zdCBhY2NvdW50ID0gYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmZpbmRBY2NvdW50KFxuICAgICAgY3R4LmJvZHkuYWNjb3VudElkXG4gICAgKTtcbiAgICBpZiAoIWFjY291bnQgfHwgYWNjb3VudC51c2VySWQgIT09IGN0eC5jb250ZXh0LnNlc3Npb24udXNlci5pZCkge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBcIkFjY291bnQgbm90IGZvdW5kXCJcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBwcm92aWRlciA9IGN0eC5jb250ZXh0LnNvY2lhbFByb3ZpZGVycy5maW5kKFxuICAgICAgKHApID0+IHAuaWQgPT09IGFjY291bnQucHJvdmlkZXJJZFxuICAgICk7XG4gICAgaWYgKCFwcm92aWRlcikge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiSU5URVJOQUxfU0VSVkVSX0VSUk9SXCIsIHtcbiAgICAgICAgbWVzc2FnZTogYFByb3ZpZGVyIGFjY291bnQgcHJvdmlkZXIgaXMgJHthY2NvdW50LnByb3ZpZGVySWR9IGJ1dCBpdCBpcyBub3QgY29uZmlndXJlZGBcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCB0b2tlbnMgPSBhd2FpdCBnZXRBY2Nlc3NUb2tlbih7XG4gICAgICAuLi5jdHgsXG4gICAgICBib2R5OiB7XG4gICAgICAgIGFjY291bnRJZDogYWNjb3VudC5pZCxcbiAgICAgICAgcHJvdmlkZXJJZDogYWNjb3VudC5wcm92aWRlcklkXG4gICAgICB9LFxuICAgICAgcmV0dXJuSGVhZGVyczogZmFsc2VcbiAgICB9KTtcbiAgICBpZiAoIXRva2Vucy5hY2Nlc3NUb2tlbikge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBcIkFjY2VzcyB0b2tlbiBub3QgZm91bmRcIlxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IGluZm8gPSBhd2FpdCBwcm92aWRlci5nZXRVc2VySW5mbyh7XG4gICAgICAuLi50b2tlbnMsXG4gICAgICBhY2Nlc3NUb2tlbjogdG9rZW5zLmFjY2Vzc1Rva2VuXG4gICAgfSk7XG4gICAgcmV0dXJuIGN0eC5qc29uKGluZm8pO1xuICB9XG4pO1xuXG5leHBvcnQgeyBzaWduT3V0IGFzICQsIG9yaWdpbkNoZWNrTWlkZGxld2FyZSBhcyBBLCBCQVNFX0VSUk9SX0NPREVTIGFzIEIsIGVycm9yIGFzIEMsIG9rIGFzIEQsIGFjY291bnRJbmZvIGFzIEUsIGdldEFjY2Vzc1Rva2VuIGFzIEYsIHJlZnJlc2hUb2tlbiBhcyBHLCBISURFX01FVEFEQVRBIGFzIEgsIHVubGlua0FjY291bnQgYXMgSSwgZGVsZXRlVXNlckNhbGxiYWNrIGFzIEosIGxpc3RVc2VyQWNjb3VudHMgYXMgSywgbGlua1NvY2lhbEFjY291bnQgYXMgTCwgcmV2b2tlT3RoZXJTZXNzaW9ucyBhcyBNLCByZXZva2VTZXNzaW9ucyBhcyBOLCByZXZva2VTZXNzaW9uIGFzIE8sIHJlcXVlc3RQYXNzd29yZFJlc2V0Q2FsbGJhY2sgYXMgUCwgcmVxdWVzdFBhc3N3b3JkUmVzZXQgYXMgUSwgZm9yZ2V0UGFzc3dvcmRDYWxsYmFjayBhcyBSLCBkZWxldGVVc2VyIGFzIFMsIHNldFBhc3N3b3JkIGFzIFQsIGNoYW5nZVBhc3N3b3JkIGFzIFUsIGNoYW5nZUVtYWlsIGFzIFYsIHNlbmRWZXJpZmljYXRpb25FbWFpbCBhcyBXLCB2ZXJpZnlFbWFpbCBhcyBYLCByZXNldFBhc3N3b3JkIGFzIFksIGZvcmdldFBhc3N3b3JkIGFzIFosIHNpZ25JbkVtYWlsIGFzIF8sIHZhbGlkYXRlVG9rZW4gYXMgYSwgY2FsbGJhY2tPQXV0aCBhcyBhMCwgc2lnbkluU29jaWFsIGFzIGExLCByZXF1ZXN0T25seVNlc3Npb25NaWRkbGV3YXJlIGFzIGEyLCBzb2NpYWxQcm92aWRlckxpc3QgYXMgYTMsIFNvY2lhbFByb3ZpZGVyTGlzdEVudW0gYXMgYTQsIGFwcGxlIGFzIGE1LCBnZXRBcHBsZVB1YmxpY0tleSBhcyBhNiwgZGlzY29yZCBhcyBhNywgZHJvcGJveCBhcyBhOCwgZmFjZWJvb2sgYXMgYTksIGdpdGh1YiBhcyBhYSwgbGluZWFyIGFzIGFiLCBsaW5rZWRpbiBhcyBhYywgZ2l0bGFiIGFzIGFkLCBnb29nbGUgYXMgYWUsIGtpY2sgYXMgYWYsIG1pY3Jvc29mdCBhcyBhZywgbm90aW9uIGFzIGFoLCByZWRkaXQgYXMgYWksIHJvYmxveCBhcyBhaiwgc3BvdGlmeSBhcyBhaywgdGlrdG9rIGFzIGFsLCB0d2l0Y2ggYXMgYW0sIHR3aXR0ZXIgYXMgYW4sIExBTkcgYXMgYW8sIHZrIGFzIGFwLCB6b29tIGFzIGFxLCBodWdnaW5nZmFjZSBhcyBhciwgc2xhY2sgYXMgYXMsIGdlbmVyYXRlQ29kZUNoYWxsZW5nZSBhcyBiLCBjcmVhdGVBdXRob3JpemF0aW9uVVJMIGFzIGMsIGdldE9BdXRoMlRva2VucyBhcyBkLCBlbmNvZGVPQXV0aFBhcmFtZXRlciBhcyBlLCBkZWNyeXB0T0F1dGhUb2tlbiBhcyBmLCBnZW5lcmF0ZVN0YXRlIGFzIGcsIGhhbmRsZU9BdXRoVXNlckluZm8gYXMgaCwgY3JlYXRlQXV0aE1pZGRsZXdhcmUgYXMgaSwgY3JlYXRlQXV0aEVuZHBvaW50IGFzIGosIGdldFNlc3Npb25Gcm9tQ3R4IGFzIGssIHNlc3Npb25NaWRkbGV3YXJlIGFzIGwsIGdldFNlc3Npb24gYXMgbSwgZnJlc2hTZXNzaW9uTWlkZGxld2FyZSBhcyBuLCBvcmlnaW5DaGVjayBhcyBvLCBwYXJzZVN0YXRlIGFzIHAsIG9wdGlvbnNNaWRkbGV3YXJlIGFzIHEsIHJlZnJlc2hBY2Nlc3NUb2tlbiBhcyByLCBzZXRUb2tlblV0aWwgYXMgcywgc29jaWFsUHJvdmlkZXJzIGFzIHQsIHNlbmRWZXJpZmljYXRpb25FbWFpbEZuIGFzIHUsIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGUgYXMgdiwgY3JlYXRlRW1haWxWZXJpZmljYXRpb25Ub2tlbiBhcyB3LCB3aWxkY2FyZE1hdGNoIGFzIHgsIGxpc3RTZXNzaW9ucyBhcyB5LCB1cGRhdGVVc2VyIGFzIHogfTtcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(action-browser)/../../node_modules/better-auth/dist/shared/better-auth.z3dsxLxE.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/adapters/prisma-adapter/index.mjs":
/*!*****************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/adapters/prisma-adapter/index.mjs ***!
  \*****************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prismaAdapter: () => (/* binding */ prismaAdapter)\n/* harmony export */ });\n/* harmony import */ var _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../shared/better-auth.DdzSJf-n.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs\");\n/* harmony import */ var _shared_better_auth_gBl3F_xa_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../shared/better-auth.gBl3F_xa.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.gBl3F_xa.mjs\");\n/* harmony import */ var _shared_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../shared/better-auth.tB5eU6EY.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.tB5eU6EY.mjs\");\n/* harmony import */ var _shared_better_auth_DORkW_Ge_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../shared/better-auth.DORkW_Ge.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DORkW_Ge.mjs\");\n/* harmony import */ var _shared_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../shared/better-auth.DBGfIDnh.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DBGfIDnh.mjs\");\n/* harmony import */ var _better_auth_utils_random__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @better-auth/utils/random */ \"(rsc)/../../node_modules/@better-auth/utils/dist/random.mjs\");\n/* harmony import */ var better_call__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! better-call */ \"(rsc)/../../node_modules/better-call/dist/index.js\");\n/* harmony import */ var _better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @better-auth/utils/hash */ \"(rsc)/../../node_modules/@better-auth/utils/dist/hash.mjs\");\n/* harmony import */ var _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @better-auth/utils/base64 */ \"(rsc)/../../node_modules/@better-auth/utils/dist/base64.mjs\");\n/* harmony import */ var _better_auth_utils__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @better-auth/utils */ \"(rsc)/../../node_modules/@better-auth/utils/dist/index.mjs\");\n/* harmony import */ var _better_auth_utils_hex__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @better-auth/utils/hex */ \"(rsc)/../../node_modules/@better-auth/utils/dist/hex.mjs\");\n/* harmony import */ var _shared_better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../shared/better-auth.B4Qoxdgc.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst prismaAdapter = (prisma, config) => (0,_shared_better_auth_gBl3F_xa_mjs__WEBPACK_IMPORTED_MODULE_1__.c)({\n  config: {\n    adapterId: \"prisma\",\n    adapterName: \"Prisma Adapter\",\n    usePlural: config.usePlural ?? false,\n    debugLogs: config.debugLogs ?? false\n  },\n  adapter: ({ getFieldName }) => {\n    const db = prisma;\n    const convertSelect = (select, model) => {\n      if (!select || !model) return void 0;\n      return select.reduce((prev, cur) => {\n        return {\n          ...prev,\n          [getFieldName({ model, field: cur })]: true\n        };\n      }, {});\n    };\n    function operatorToPrismaOperator(operator) {\n      switch (operator) {\n        case \"starts_with\":\n          return \"startsWith\";\n        case \"ends_with\":\n          return \"endsWith\";\n        case \"ne\":\n          return \"not\";\n        default:\n          return operator;\n      }\n    }\n    const convertWhereClause = (model, where) => {\n      if (!where) return {};\n      if (where.length === 1) {\n        const w = where[0];\n        if (!w) {\n          return;\n        }\n        return {\n          [getFieldName({ model, field: w.field })]: w.operator === \"eq\" || !w.operator ? w.value : {\n            [operatorToPrismaOperator(w.operator)]: w.value\n          }\n        };\n      }\n      const and = where.filter((w) => w.connector === \"AND\" || !w.connector);\n      const or = where.filter((w) => w.connector === \"OR\");\n      const andClause = and.map((w) => {\n        return {\n          [getFieldName({ model, field: w.field })]: w.operator === \"eq\" || !w.operator ? w.value : {\n            [operatorToPrismaOperator(w.operator)]: w.value\n          }\n        };\n      });\n      const orClause = or.map((w) => {\n        return {\n          [getFieldName({ model, field: w.field })]: w.operator === \"eq\" || !w.operator ? w.value : {\n            [operatorToPrismaOperator(w.operator)]: w.value\n          }\n        };\n      });\n      return {\n        ...andClause.length ? { AND: andClause } : {},\n        ...orClause.length ? { OR: orClause } : {}\n      };\n    };\n    return {\n      async create({ model, data: values, select }) {\n        if (!db[model]) {\n          throw new _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_0__.B(\n            `Model ${model} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`\n          );\n        }\n        return await db[model].create({\n          data: values,\n          select: convertSelect(select, model)\n        });\n      },\n      async findOne({ model, where, select }) {\n        const whereClause = convertWhereClause(model, where);\n        if (!db[model]) {\n          throw new _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_0__.B(\n            `Model ${model} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`\n          );\n        }\n        return await db[model].findFirst({\n          where: whereClause,\n          select: convertSelect(select, model)\n        });\n      },\n      async findMany({ model, where, limit, offset, sortBy }) {\n        const whereClause = convertWhereClause(model, where);\n        if (!db[model]) {\n          throw new _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_0__.B(\n            `Model ${model} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`\n          );\n        }\n        return await db[model].findMany({\n          where: whereClause,\n          take: limit || 100,\n          skip: offset || 0,\n          ...sortBy?.field ? {\n            orderBy: {\n              [getFieldName({ model, field: sortBy.field })]: sortBy.direction === \"desc\" ? \"desc\" : \"asc\"\n            }\n          } : {}\n        });\n      },\n      async count({ model, where }) {\n        const whereClause = convertWhereClause(model, where);\n        if (!db[model]) {\n          throw new _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_0__.B(\n            `Model ${model} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`\n          );\n        }\n        return await db[model].count({\n          where: whereClause\n        });\n      },\n      async update({ model, where, update }) {\n        if (!db[model]) {\n          throw new _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_0__.B(\n            `Model ${model} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`\n          );\n        }\n        const whereClause = convertWhereClause(model, where);\n        return await db[model].update({\n          where: whereClause,\n          data: update\n        });\n      },\n      async updateMany({ model, where, update }) {\n        const whereClause = convertWhereClause(model, where);\n        const result = await db[model].updateMany({\n          where: whereClause,\n          data: update\n        });\n        return result ? result.count : 0;\n      },\n      async delete({ model, where }) {\n        const whereClause = convertWhereClause(model, where);\n        try {\n          await db[model].delete({\n            where: whereClause\n          });\n        } catch (e) {\n        }\n      },\n      async deleteMany({ model, where }) {\n        const whereClause = convertWhereClause(model, where);\n        const result = await db[model].deleteMany({\n          where: whereClause\n        });\n        return result ? result.count : 0;\n      },\n      options: config\n    };\n  }\n});\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3QvYWRhcHRlcnMvcHJpc21hLWFkYXB0ZXIvaW5kZXgubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBNkU7QUFDRjtBQUM1QjtBQUNBO0FBQ0E7QUFDWjtBQUNuQjtBQUNLO0FBQ1k7QUFDRjtBQUNEO0FBQ0k7QUFDQztBQUNyQjtBQUNnQjtBQUNGO0FBQ0k7QUFDSDtBQUNrQjs7QUFFL0MsMENBQTBDLG1FQUFhO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsY0FBYyxjQUFjO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixtQkFBbUI7QUFDN0M7QUFDQSxPQUFPLElBQUk7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsdUJBQXVCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsdUJBQXVCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsMEJBQTBCLHVCQUF1QjtBQUNqRDtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxnQ0FBZ0MsaUJBQWlCLElBQUk7QUFDckQsK0JBQStCLGVBQWU7QUFDOUM7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLDZCQUE2QjtBQUNsRDtBQUNBLG9CQUFvQiwrREFBZTtBQUNuQyxxQkFBcUIsT0FBTztBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULE9BQU87QUFDUCxzQkFBc0Isc0JBQXNCO0FBQzVDO0FBQ0E7QUFDQSxvQkFBb0IsK0RBQWU7QUFDbkMscUJBQXFCLE9BQU87QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxPQUFPO0FBQ1AsdUJBQXVCLHFDQUFxQztBQUM1RDtBQUNBO0FBQ0Esb0JBQW9CLCtEQUFlO0FBQ25DLHFCQUFxQixPQUFPO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsNEJBQTRCO0FBQzFEO0FBQ0EsWUFBWTtBQUNaLFNBQVM7QUFDVCxPQUFPO0FBQ1Asb0JBQW9CLGNBQWM7QUFDbEM7QUFDQTtBQUNBLG9CQUFvQiwrREFBZTtBQUNuQyxxQkFBcUIsT0FBTztBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxPQUFPO0FBQ1AscUJBQXFCLHNCQUFzQjtBQUMzQztBQUNBLG9CQUFvQiwrREFBZTtBQUNuQyxxQkFBcUIsT0FBTztBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsT0FBTztBQUNQLHlCQUF5QixzQkFBc0I7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxPQUFPO0FBQ1AscUJBQXFCLGNBQWM7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1gsVUFBVTtBQUNWO0FBQ0EsT0FBTztBQUNQLHlCQUF5QixjQUFjO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUV3QiIsInNvdXJjZXMiOlsiL1VzZXJzL21pbGFuL0Rlc2t0b3AvQXBwcy9iZXR0ZXItYXV0aC9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9hZGFwdGVycy9wcmlzbWEtYWRhcHRlci9pbmRleC5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQiBhcyBCZXR0ZXJBdXRoRXJyb3IgfSBmcm9tICcuLi8uLi9zaGFyZWQvYmV0dGVyLWF1dGguRGR6U0pmLW4ubWpzJztcbmltcG9ydCB7IGMgYXMgY3JlYXRlQWRhcHRlciB9IGZyb20gJy4uLy4uL3NoYXJlZC9iZXR0ZXItYXV0aC5nQmwzRl94YS5tanMnO1xuaW1wb3J0ICcuLi8uLi9zaGFyZWQvYmV0dGVyLWF1dGgudEI1ZVU2RVkubWpzJztcbmltcG9ydCAnLi4vLi4vc2hhcmVkL2JldHRlci1hdXRoLkRPUmtXX0dlLm1qcyc7XG5pbXBvcnQgJy4uLy4uL3NoYXJlZC9iZXR0ZXItYXV0aC5EQkdmSURuaC5tanMnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMvcmFuZG9tJztcbmltcG9ydCAnem9kL3Y0JztcbmltcG9ydCAnYmV0dGVyLWNhbGwnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMvaGFzaCc7XG5pbXBvcnQgJ0Bub2JsZS9jaXBoZXJzL2NoYWNoYSc7XG5pbXBvcnQgJ0Bub2JsZS9jaXBoZXJzL3V0aWxzJztcbmltcG9ydCAnQG5vYmxlL2NpcGhlcnMvd2ViY3J5cHRvJztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzL2Jhc2U2NCc7XG5pbXBvcnQgJ2pvc2UnO1xuaW1wb3J0ICdAbm9ibGUvaGFzaGVzL3NjcnlwdCc7XG5pbXBvcnQgJ0BiZXR0ZXItYXV0aC91dGlscyc7XG5pbXBvcnQgJ0BiZXR0ZXItYXV0aC91dGlscy9oZXgnO1xuaW1wb3J0ICdAbm9ibGUvaGFzaGVzL3V0aWxzJztcbmltcG9ydCAnLi4vLi4vc2hhcmVkL2JldHRlci1hdXRoLkI0UW94ZGdjLm1qcyc7XG5cbmNvbnN0IHByaXNtYUFkYXB0ZXIgPSAocHJpc21hLCBjb25maWcpID0+IGNyZWF0ZUFkYXB0ZXIoe1xuICBjb25maWc6IHtcbiAgICBhZGFwdGVySWQ6IFwicHJpc21hXCIsXG4gICAgYWRhcHRlck5hbWU6IFwiUHJpc21hIEFkYXB0ZXJcIixcbiAgICB1c2VQbHVyYWw6IGNvbmZpZy51c2VQbHVyYWwgPz8gZmFsc2UsXG4gICAgZGVidWdMb2dzOiBjb25maWcuZGVidWdMb2dzID8/IGZhbHNlXG4gIH0sXG4gIGFkYXB0ZXI6ICh7IGdldEZpZWxkTmFtZSB9KSA9PiB7XG4gICAgY29uc3QgZGIgPSBwcmlzbWE7XG4gICAgY29uc3QgY29udmVydFNlbGVjdCA9IChzZWxlY3QsIG1vZGVsKSA9PiB7XG4gICAgICBpZiAoIXNlbGVjdCB8fCAhbW9kZWwpIHJldHVybiB2b2lkIDA7XG4gICAgICByZXR1cm4gc2VsZWN0LnJlZHVjZSgocHJldiwgY3VyKSA9PiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgLi4ucHJldixcbiAgICAgICAgICBbZ2V0RmllbGROYW1lKHsgbW9kZWwsIGZpZWxkOiBjdXIgfSldOiB0cnVlXG4gICAgICAgIH07XG4gICAgICB9LCB7fSk7XG4gICAgfTtcbiAgICBmdW5jdGlvbiBvcGVyYXRvclRvUHJpc21hT3BlcmF0b3Iob3BlcmF0b3IpIHtcbiAgICAgIHN3aXRjaCAob3BlcmF0b3IpIHtcbiAgICAgICAgY2FzZSBcInN0YXJ0c193aXRoXCI6XG4gICAgICAgICAgcmV0dXJuIFwic3RhcnRzV2l0aFwiO1xuICAgICAgICBjYXNlIFwiZW5kc193aXRoXCI6XG4gICAgICAgICAgcmV0dXJuIFwiZW5kc1dpdGhcIjtcbiAgICAgICAgY2FzZSBcIm5lXCI6XG4gICAgICAgICAgcmV0dXJuIFwibm90XCI7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmV0dXJuIG9wZXJhdG9yO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBjb252ZXJ0V2hlcmVDbGF1c2UgPSAobW9kZWwsIHdoZXJlKSA9PiB7XG4gICAgICBpZiAoIXdoZXJlKSByZXR1cm4ge307XG4gICAgICBpZiAod2hlcmUubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIGNvbnN0IHcgPSB3aGVyZVswXTtcbiAgICAgICAgaWYgKCF3KSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgW2dldEZpZWxkTmFtZSh7IG1vZGVsLCBmaWVsZDogdy5maWVsZCB9KV06IHcub3BlcmF0b3IgPT09IFwiZXFcIiB8fCAhdy5vcGVyYXRvciA/IHcudmFsdWUgOiB7XG4gICAgICAgICAgICBbb3BlcmF0b3JUb1ByaXNtYU9wZXJhdG9yKHcub3BlcmF0b3IpXTogdy52YWx1ZVxuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGFuZCA9IHdoZXJlLmZpbHRlcigodykgPT4gdy5jb25uZWN0b3IgPT09IFwiQU5EXCIgfHwgIXcuY29ubmVjdG9yKTtcbiAgICAgIGNvbnN0IG9yID0gd2hlcmUuZmlsdGVyKCh3KSA9PiB3LmNvbm5lY3RvciA9PT0gXCJPUlwiKTtcbiAgICAgIGNvbnN0IGFuZENsYXVzZSA9IGFuZC5tYXAoKHcpID0+IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBbZ2V0RmllbGROYW1lKHsgbW9kZWwsIGZpZWxkOiB3LmZpZWxkIH0pXTogdy5vcGVyYXRvciA9PT0gXCJlcVwiIHx8ICF3Lm9wZXJhdG9yID8gdy52YWx1ZSA6IHtcbiAgICAgICAgICAgIFtvcGVyYXRvclRvUHJpc21hT3BlcmF0b3Iody5vcGVyYXRvcildOiB3LnZhbHVlXG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgICBjb25zdCBvckNsYXVzZSA9IG9yLm1hcCgodykgPT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIFtnZXRGaWVsZE5hbWUoeyBtb2RlbCwgZmllbGQ6IHcuZmllbGQgfSldOiB3Lm9wZXJhdG9yID09PSBcImVxXCIgfHwgIXcub3BlcmF0b3IgPyB3LnZhbHVlIDoge1xuICAgICAgICAgICAgW29wZXJhdG9yVG9QcmlzbWFPcGVyYXRvcih3Lm9wZXJhdG9yKV06IHcudmFsdWVcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLmFuZENsYXVzZS5sZW5ndGggPyB7IEFORDogYW5kQ2xhdXNlIH0gOiB7fSxcbiAgICAgICAgLi4ub3JDbGF1c2UubGVuZ3RoID8geyBPUjogb3JDbGF1c2UgfSA6IHt9XG4gICAgICB9O1xuICAgIH07XG4gICAgcmV0dXJuIHtcbiAgICAgIGFzeW5jIGNyZWF0ZSh7IG1vZGVsLCBkYXRhOiB2YWx1ZXMsIHNlbGVjdCB9KSB7XG4gICAgICAgIGlmICghZGJbbW9kZWxdKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEJldHRlckF1dGhFcnJvcihcbiAgICAgICAgICAgIGBNb2RlbCAke21vZGVsfSBkb2VzIG5vdCBleGlzdCBpbiB0aGUgZGF0YWJhc2UuIElmIHlvdSBoYXZlbid0IGdlbmVyYXRlZCB0aGUgUHJpc21hIGNsaWVudCwgeW91IG5lZWQgdG8gcnVuICducHggcHJpc21hIGdlbmVyYXRlJ2BcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhd2FpdCBkYlttb2RlbF0uY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB2YWx1ZXMsXG4gICAgICAgICAgc2VsZWN0OiBjb252ZXJ0U2VsZWN0KHNlbGVjdCwgbW9kZWwpXG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIGFzeW5jIGZpbmRPbmUoeyBtb2RlbCwgd2hlcmUsIHNlbGVjdCB9KSB7XG4gICAgICAgIGNvbnN0IHdoZXJlQ2xhdXNlID0gY29udmVydFdoZXJlQ2xhdXNlKG1vZGVsLCB3aGVyZSk7XG4gICAgICAgIGlmICghZGJbbW9kZWxdKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEJldHRlckF1dGhFcnJvcihcbiAgICAgICAgICAgIGBNb2RlbCAke21vZGVsfSBkb2VzIG5vdCBleGlzdCBpbiB0aGUgZGF0YWJhc2UuIElmIHlvdSBoYXZlbid0IGdlbmVyYXRlZCB0aGUgUHJpc21hIGNsaWVudCwgeW91IG5lZWQgdG8gcnVuICducHggcHJpc21hIGdlbmVyYXRlJ2BcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhd2FpdCBkYlttb2RlbF0uZmluZEZpcnN0KHtcbiAgICAgICAgICB3aGVyZTogd2hlcmVDbGF1c2UsXG4gICAgICAgICAgc2VsZWN0OiBjb252ZXJ0U2VsZWN0KHNlbGVjdCwgbW9kZWwpXG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIGFzeW5jIGZpbmRNYW55KHsgbW9kZWwsIHdoZXJlLCBsaW1pdCwgb2Zmc2V0LCBzb3J0QnkgfSkge1xuICAgICAgICBjb25zdCB3aGVyZUNsYXVzZSA9IGNvbnZlcnRXaGVyZUNsYXVzZShtb2RlbCwgd2hlcmUpO1xuICAgICAgICBpZiAoIWRiW21vZGVsXSkge1xuICAgICAgICAgIHRocm93IG5ldyBCZXR0ZXJBdXRoRXJyb3IoXG4gICAgICAgICAgICBgTW9kZWwgJHttb2RlbH0gZG9lcyBub3QgZXhpc3QgaW4gdGhlIGRhdGFiYXNlLiBJZiB5b3UgaGF2ZW4ndCBnZW5lcmF0ZWQgdGhlIFByaXNtYSBjbGllbnQsIHlvdSBuZWVkIHRvIHJ1biAnbnB4IHByaXNtYSBnZW5lcmF0ZSdgXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXdhaXQgZGJbbW9kZWxdLmZpbmRNYW55KHtcbiAgICAgICAgICB3aGVyZTogd2hlcmVDbGF1c2UsXG4gICAgICAgICAgdGFrZTogbGltaXQgfHwgMTAwLFxuICAgICAgICAgIHNraXA6IG9mZnNldCB8fCAwLFxuICAgICAgICAgIC4uLnNvcnRCeT8uZmllbGQgPyB7XG4gICAgICAgICAgICBvcmRlckJ5OiB7XG4gICAgICAgICAgICAgIFtnZXRGaWVsZE5hbWUoeyBtb2RlbCwgZmllbGQ6IHNvcnRCeS5maWVsZCB9KV06IHNvcnRCeS5kaXJlY3Rpb24gPT09IFwiZGVzY1wiID8gXCJkZXNjXCIgOiBcImFzY1wiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSA6IHt9XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIGFzeW5jIGNvdW50KHsgbW9kZWwsIHdoZXJlIH0pIHtcbiAgICAgICAgY29uc3Qgd2hlcmVDbGF1c2UgPSBjb252ZXJ0V2hlcmVDbGF1c2UobW9kZWwsIHdoZXJlKTtcbiAgICAgICAgaWYgKCFkYlttb2RlbF0pIHtcbiAgICAgICAgICB0aHJvdyBuZXcgQmV0dGVyQXV0aEVycm9yKFxuICAgICAgICAgICAgYE1vZGVsICR7bW9kZWx9IGRvZXMgbm90IGV4aXN0IGluIHRoZSBkYXRhYmFzZS4gSWYgeW91IGhhdmVuJ3QgZ2VuZXJhdGVkIHRoZSBQcmlzbWEgY2xpZW50LCB5b3UgbmVlZCB0byBydW4gJ25weCBwcmlzbWEgZ2VuZXJhdGUnYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGF3YWl0IGRiW21vZGVsXS5jb3VudCh7XG4gICAgICAgICAgd2hlcmU6IHdoZXJlQ2xhdXNlXG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIGFzeW5jIHVwZGF0ZSh7IG1vZGVsLCB3aGVyZSwgdXBkYXRlIH0pIHtcbiAgICAgICAgaWYgKCFkYlttb2RlbF0pIHtcbiAgICAgICAgICB0aHJvdyBuZXcgQmV0dGVyQXV0aEVycm9yKFxuICAgICAgICAgICAgYE1vZGVsICR7bW9kZWx9IGRvZXMgbm90IGV4aXN0IGluIHRoZSBkYXRhYmFzZS4gSWYgeW91IGhhdmVuJ3QgZ2VuZXJhdGVkIHRoZSBQcmlzbWEgY2xpZW50LCB5b3UgbmVlZCB0byBydW4gJ25weCBwcmlzbWEgZ2VuZXJhdGUnYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgd2hlcmVDbGF1c2UgPSBjb252ZXJ0V2hlcmVDbGF1c2UobW9kZWwsIHdoZXJlKTtcbiAgICAgICAgcmV0dXJuIGF3YWl0IGRiW21vZGVsXS51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB3aGVyZUNsYXVzZSxcbiAgICAgICAgICBkYXRhOiB1cGRhdGVcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgYXN5bmMgdXBkYXRlTWFueSh7IG1vZGVsLCB3aGVyZSwgdXBkYXRlIH0pIHtcbiAgICAgICAgY29uc3Qgd2hlcmVDbGF1c2UgPSBjb252ZXJ0V2hlcmVDbGF1c2UobW9kZWwsIHdoZXJlKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJbbW9kZWxdLnVwZGF0ZU1hbnkoe1xuICAgICAgICAgIHdoZXJlOiB3aGVyZUNsYXVzZSxcbiAgICAgICAgICBkYXRhOiB1cGRhdGVcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXN1bHQgPyByZXN1bHQuY291bnQgOiAwO1xuICAgICAgfSxcbiAgICAgIGFzeW5jIGRlbGV0ZSh7IG1vZGVsLCB3aGVyZSB9KSB7XG4gICAgICAgIGNvbnN0IHdoZXJlQ2xhdXNlID0gY29udmVydFdoZXJlQ2xhdXNlKG1vZGVsLCB3aGVyZSk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgZGJbbW9kZWxdLmRlbGV0ZSh7XG4gICAgICAgICAgICB3aGVyZTogd2hlcmVDbGF1c2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgYXN5bmMgZGVsZXRlTWFueSh7IG1vZGVsLCB3aGVyZSB9KSB7XG4gICAgICAgIGNvbnN0IHdoZXJlQ2xhdXNlID0gY29udmVydFdoZXJlQ2xhdXNlKG1vZGVsLCB3aGVyZSk7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiW21vZGVsXS5kZWxldGVNYW55KHtcbiAgICAgICAgICB3aGVyZTogd2hlcmVDbGF1c2VcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXN1bHQgPyByZXN1bHQuY291bnQgOiAwO1xuICAgICAgfSxcbiAgICAgIG9wdGlvbnM6IGNvbmZpZ1xuICAgIH07XG4gIH1cbn0pO1xuXG5leHBvcnQgeyBwcmlzbWFBZGFwdGVyIH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/adapters/prisma-adapter/index.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/api/index.mjs":
/*!*********************************************************!*\
  !*** ../../node_modules/better-auth/dist/api/index.mjs ***!
  \*********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   APIError: () => (/* reexport safe */ better_call__WEBPACK_IMPORTED_MODULE_0__.APIError),\n/* harmony export */   accountInfo: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.E),\n/* harmony export */   callbackOAuth: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.a0),\n/* harmony export */   changeEmail: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.V),\n/* harmony export */   changePassword: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.U),\n/* harmony export */   createAuthEndpoint: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.j),\n/* harmony export */   createAuthMiddleware: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.i),\n/* harmony export */   createEmailVerificationToken: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.w),\n/* harmony export */   deleteUser: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.S),\n/* harmony export */   deleteUserCallback: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.J),\n/* harmony export */   error: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.C),\n/* harmony export */   forgetPassword: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.Z),\n/* harmony export */   forgetPasswordCallback: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.R),\n/* harmony export */   freshSessionMiddleware: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.n),\n/* harmony export */   getAccessToken: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.F),\n/* harmony export */   getEndpoints: () => (/* binding */ getEndpoints),\n/* harmony export */   getSession: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.m),\n/* harmony export */   getSessionFromCtx: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.k),\n/* harmony export */   linkSocialAccount: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.L),\n/* harmony export */   listSessions: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.y),\n/* harmony export */   listUserAccounts: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.K),\n/* harmony export */   ok: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.D),\n/* harmony export */   optionsMiddleware: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.q),\n/* harmony export */   originCheck: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.o),\n/* harmony export */   originCheckMiddleware: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.A),\n/* harmony export */   refreshToken: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.G),\n/* harmony export */   requestOnlySessionMiddleware: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.a2),\n/* harmony export */   requestPasswordReset: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.Q),\n/* harmony export */   requestPasswordResetCallback: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.P),\n/* harmony export */   resetPassword: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.Y),\n/* harmony export */   revokeOtherSessions: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.M),\n/* harmony export */   revokeSession: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.O),\n/* harmony export */   revokeSessions: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.N),\n/* harmony export */   router: () => (/* binding */ router),\n/* harmony export */   sendVerificationEmail: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.W),\n/* harmony export */   sendVerificationEmailFn: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.u),\n/* harmony export */   sessionMiddleware: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.l),\n/* harmony export */   setPassword: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.T),\n/* harmony export */   signInEmail: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__._),\n/* harmony export */   signInSocial: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.a1),\n/* harmony export */   signOut: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.$),\n/* harmony export */   signUpEmail: () => (/* binding */ signUpEmail),\n/* harmony export */   unlinkAccount: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.I),\n/* harmony export */   updateUser: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.z),\n/* harmony export */   verifyEmail: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.X)\n/* harmony export */ });\n/* harmony import */ var better_call__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! better-call */ \"(rsc)/../../node_modules/better-call/dist/index.js\");\n/* harmony import */ var _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../shared/better-auth.z3dsxLxE.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.z3dsxLxE.mjs\");\n/* harmony import */ var zod_v4__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! zod/v4 */ \"(rsc)/../../node_modules/zod/v4/classic/schemas.js\");\n/* harmony import */ var _cookies_index_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../cookies/index.mjs */ \"(rsc)/../../node_modules/better-auth/dist/cookies/index.mjs\");\n/* harmony import */ var _shared_better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../shared/better-auth.n2KFGwjY.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.n2KFGwjY.mjs\");\n/* harmony import */ var _shared_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../shared/better-auth.8zoxzg-F.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs\");\n/* harmony import */ var _shared_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../shared/better-auth.DBGfIDnh.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DBGfIDnh.mjs\");\n/* harmony import */ var _shared_better_auth_DcfNPS8q_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../shared/better-auth.DcfNPS8q.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DcfNPS8q.mjs\");\n/* harmony import */ var defu__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! defu */ \"(rsc)/../../node_modules/defu/dist/defu.mjs\");\n/* harmony import */ var _shared_better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../shared/better-auth.CW6D9eSx.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.CW6D9eSx.mjs\");\n/* harmony import */ var _better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @better-auth/utils/hash */ \"(rsc)/../../node_modules/@better-auth/utils/dist/hash.mjs\");\n/* harmony import */ var _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @better-auth/utils/base64 */ \"(rsc)/../../node_modules/@better-auth/utils/dist/base64.mjs\");\n/* harmony import */ var _crypto_index_mjs__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../crypto/index.mjs */ \"(rsc)/../../node_modules/better-auth/dist/crypto/index.mjs\");\n/* harmony import */ var _better_auth_utils__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @better-auth/utils */ \"(rsc)/../../node_modules/@better-auth/utils/dist/index.mjs\");\n/* harmony import */ var _better_auth_utils_hex__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @better-auth/utils/hex */ \"(rsc)/../../node_modules/@better-auth/utils/dist/hex.mjs\");\n/* harmony import */ var _shared_better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../shared/better-auth.B4Qoxdgc.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs\");\n/* harmony import */ var _better_auth_utils_random__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @better-auth/utils/random */ \"(rsc)/../../node_modules/@better-auth/utils/dist/random.mjs\");\n/* harmony import */ var _better_fetch_fetch__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! @better-fetch/fetch */ \"(rsc)/../../node_modules/@better-fetch/fetch/dist/index.js\");\n/* harmony import */ var _shared_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../shared/better-auth.VTXNLFMT.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.VTXNLFMT.mjs\");\n/* harmony import */ var _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../shared/better-auth.DdzSJf-n.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs\");\n/* harmony import */ var _shared_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../shared/better-auth.tB5eU6EY.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.tB5eU6EY.mjs\");\n/* harmony import */ var _better_auth_utils_hmac__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! @better-auth/utils/hmac */ \"(rsc)/../../node_modules/@better-auth/utils/dist/hmac.mjs\");\n/* harmony import */ var _better_auth_utils_binary__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @better-auth/utils/binary */ \"(rsc)/../../node_modules/@better-auth/utils/dist/binary.mjs\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst signUpEmail = () => (0,_shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.j)(\n  \"/sign-up/email\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_22__.record(zod_v4__WEBPACK_IMPORTED_MODULE_22__.string(), zod_v4__WEBPACK_IMPORTED_MODULE_22__.any()),\n    metadata: {\n      $Infer: {\n        body: {}\n      },\n      openapi: {\n        description: \"Sign up a user using email and password\",\n        requestBody: {\n          content: {\n            \"application/json\": {\n              schema: {\n                type: \"object\",\n                properties: {\n                  name: {\n                    type: \"string\",\n                    description: \"The name of the user\"\n                  },\n                  email: {\n                    type: \"string\",\n                    description: \"The email of the user\"\n                  },\n                  password: {\n                    type: \"string\",\n                    description: \"The password of the user\"\n                  },\n                  image: {\n                    type: \"string\",\n                    description: \"The profile image URL of the user\"\n                  },\n                  callbackURL: {\n                    type: \"string\",\n                    description: \"The URL to use for email verification callback\"\n                  },\n                  rememberMe: {\n                    type: \"boolean\",\n                    description: \"If this is false, the session will not be remembered. Default is `true`.\"\n                  }\n                },\n                required: [\"name\", \"email\", \"password\"]\n              }\n            }\n          }\n        },\n        responses: {\n          \"200\": {\n            description: \"Successfully created user\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    token: {\n                      type: \"string\",\n                      nullable: true,\n                      description: \"Authentication token for the session\"\n                    },\n                    user: {\n                      type: \"object\",\n                      properties: {\n                        id: {\n                          type: \"string\",\n                          description: \"The unique identifier of the user\"\n                        },\n                        email: {\n                          type: \"string\",\n                          format: \"email\",\n                          description: \"The email address of the user\"\n                        },\n                        name: {\n                          type: \"string\",\n                          description: \"The name of the user\"\n                        },\n                        image: {\n                          type: \"string\",\n                          format: \"uri\",\n                          nullable: true,\n                          description: \"The profile image URL of the user\"\n                        },\n                        emailVerified: {\n                          type: \"boolean\",\n                          description: \"Whether the email has been verified\"\n                        },\n                        createdAt: {\n                          type: \"string\",\n                          format: \"date-time\",\n                          description: \"When the user was created\"\n                        },\n                        updatedAt: {\n                          type: \"string\",\n                          format: \"date-time\",\n                          description: \"When the user was last updated\"\n                        }\n                      },\n                      required: [\n                        \"id\",\n                        \"email\",\n                        \"name\",\n                        \"emailVerified\",\n                        \"createdAt\",\n                        \"updatedAt\"\n                      ]\n                    }\n                  },\n                  required: [\"user\"]\n                  // token is optional\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    if (!ctx.context.options.emailAndPassword?.enabled || ctx.context.options.emailAndPassword?.disableSignUp) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Email and password sign up is not enabled\"\n      });\n    }\n    const body = ctx.body;\n    const {\n      name,\n      email,\n      password,\n      image,\n      callbackURL,\n      rememberMe,\n      ...additionalFields\n    } = body;\n    const isValidEmail = zod_v4__WEBPACK_IMPORTED_MODULE_22__.email().safeParse(email);\n    if (!isValidEmail.success) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.B.INVALID_EMAIL\n      });\n    }\n    const minPasswordLength = ctx.context.password.config.minPasswordLength;\n    if (password.length < minPasswordLength) {\n      ctx.context.logger.error(\"Password is too short\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.B.PASSWORD_TOO_SHORT\n      });\n    }\n    const maxPasswordLength = ctx.context.password.config.maxPasswordLength;\n    if (password.length > maxPasswordLength) {\n      ctx.context.logger.error(\"Password is too long\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.B.PASSWORD_TOO_LONG\n      });\n    }\n    const dbUser = await ctx.context.internalAdapter.findUserByEmail(email);\n    if (dbUser?.user) {\n      ctx.context.logger.info(`Sign-up attempt for existing email: ${email}`);\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNPROCESSABLE_ENTITY\", {\n        message: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.B.USER_ALREADY_EXISTS\n      });\n    }\n    const additionalData = (0,_shared_better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_3__.f)(\n      ctx.context.options,\n      additionalFields\n    );\n    const hash = await ctx.context.password.hash(password);\n    let createdUser;\n    try {\n      createdUser = await ctx.context.internalAdapter.createUser(\n        {\n          email: email.toLowerCase(),\n          name,\n          image,\n          ...additionalData,\n          emailVerified: false\n        },\n        ctx\n      );\n      if (!createdUser) {\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n          message: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.B.FAILED_TO_CREATE_USER\n        });\n      }\n    } catch (e) {\n      if (_shared_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_4__.b) {\n        ctx.context.logger.error(\"Failed to create user\", e);\n      }\n      if (e instanceof better_call__WEBPACK_IMPORTED_MODULE_0__.APIError) {\n        throw e;\n      }\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNPROCESSABLE_ENTITY\", {\n        message: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.B.FAILED_TO_CREATE_USER,\n        details: e\n      });\n    }\n    if (!createdUser) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNPROCESSABLE_ENTITY\", {\n        message: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.B.FAILED_TO_CREATE_USER\n      });\n    }\n    await ctx.context.internalAdapter.linkAccount(\n      {\n        userId: createdUser.id,\n        providerId: \"credential\",\n        accountId: createdUser.id,\n        password: hash\n      },\n      ctx\n    );\n    if (ctx.context.options.emailVerification?.sendOnSignUp || ctx.context.options.emailAndPassword.requireEmailVerification) {\n      const token = await (0,_shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.w)(\n        ctx.context.secret,\n        createdUser.email,\n        void 0,\n        ctx.context.options.emailVerification?.expiresIn\n      );\n      const url = `${ctx.context.baseURL}/verify-email?token=${token}&callbackURL=${body.callbackURL || \"/\"}`;\n      await ctx.context.options.emailVerification?.sendVerificationEmail?.(\n        {\n          user: createdUser,\n          url,\n          token\n        },\n        ctx.request\n      );\n    }\n    if (ctx.context.options.emailAndPassword.autoSignIn === false || ctx.context.options.emailAndPassword.requireEmailVerification) {\n      return ctx.json({\n        token: null,\n        user: {\n          id: createdUser.id,\n          email: createdUser.email,\n          name: createdUser.name,\n          image: createdUser.image,\n          emailVerified: createdUser.emailVerified,\n          createdAt: createdUser.createdAt,\n          updatedAt: createdUser.updatedAt\n        }\n      });\n    }\n    const session = await ctx.context.internalAdapter.createSession(\n      createdUser.id,\n      ctx,\n      rememberMe === false\n    );\n    if (!session) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.B.FAILED_TO_CREATE_SESSION\n      });\n    }\n    await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_2__.setSessionCookie)(\n      ctx,\n      {\n        session,\n        user: createdUser\n      },\n      rememberMe === false\n    );\n    return ctx.json({\n      token: session.token,\n      user: {\n        id: createdUser.id,\n        email: createdUser.email,\n        name: createdUser.name,\n        image: createdUser.image,\n        emailVerified: createdUser.emailVerified,\n        createdAt: createdUser.createdAt,\n        updatedAt: createdUser.updatedAt\n      }\n    });\n  }\n);\n\nfunction shouldRateLimit(max, window, rateLimitData) {\n  const now = Date.now();\n  const windowInMs = window * 1e3;\n  const timeSinceLastRequest = now - rateLimitData.lastRequest;\n  return timeSinceLastRequest < windowInMs && rateLimitData.count >= max;\n}\nfunction rateLimitResponse(retryAfter) {\n  return new Response(\n    JSON.stringify({\n      message: \"Too many requests. Please try again later.\"\n    }),\n    {\n      status: 429,\n      statusText: \"Too Many Requests\",\n      headers: {\n        \"X-Retry-After\": retryAfter.toString()\n      }\n    }\n  );\n}\nfunction getRetryAfter(lastRequest, window) {\n  const now = Date.now();\n  const windowInMs = window * 1e3;\n  return Math.ceil((lastRequest + windowInMs - now) / 1e3);\n}\nfunction createDBStorage(ctx) {\n  const model = \"rateLimit\";\n  const db = ctx.adapter;\n  return {\n    get: async (key) => {\n      const res = await db.findMany({\n        model,\n        where: [{ field: \"key\", value: key }]\n      });\n      const data = res[0];\n      if (typeof data?.lastRequest === \"bigint\") {\n        data.lastRequest = Number(data.lastRequest);\n      }\n      return data;\n    },\n    set: async (key, value, _update) => {\n      try {\n        if (_update) {\n          await db.updateMany({\n            model,\n            where: [{ field: \"key\", value: key }],\n            update: {\n              count: value.count,\n              lastRequest: value.lastRequest\n            }\n          });\n        } else {\n          await db.create({\n            model,\n            data: {\n              key,\n              count: value.count,\n              lastRequest: value.lastRequest\n            }\n          });\n        }\n      } catch (e) {\n        ctx.logger.error(\"Error setting rate limit\", e);\n      }\n    }\n  };\n}\nconst memory = /* @__PURE__ */ new Map();\nfunction getRateLimitStorage(ctx) {\n  if (ctx.options.rateLimit?.customStorage) {\n    return ctx.options.rateLimit.customStorage;\n  }\n  if (ctx.rateLimit.storage === \"secondary-storage\") {\n    return {\n      get: async (key) => {\n        const stringified = await ctx.options.secondaryStorage?.get(key);\n        return stringified ? JSON.parse(stringified) : void 0;\n      },\n      set: async (key, value) => {\n        await ctx.options.secondaryStorage?.set?.(key, JSON.stringify(value));\n      }\n    };\n  }\n  const storage = ctx.rateLimit.storage;\n  if (storage === \"memory\") {\n    return {\n      async get(key) {\n        return memory.get(key);\n      },\n      async set(key, value, _update) {\n        memory.set(key, value);\n      }\n    };\n  }\n  return createDBStorage(ctx);\n}\nasync function onRequestRateLimit(req, ctx) {\n  if (!ctx.rateLimit.enabled) {\n    return;\n  }\n  const path = new URL(req.url).pathname.replace(\n    ctx.options.basePath || \"/api/auth\",\n    \"\"\n  );\n  let window = ctx.rateLimit.window;\n  let max = ctx.rateLimit.max;\n  const ip = (0,_shared_better_auth_DcfNPS8q_mjs__WEBPACK_IMPORTED_MODULE_6__.g)(req, ctx.options);\n  if (!ip) {\n    console.warn(\"No IP address found for rate limiting\");\n    return;\n  }\n  const key = ip + path;\n  const specialRules = getDefaultSpecialRules();\n  const specialRule = specialRules.find((rule) => rule.pathMatcher(path));\n  if (specialRule) {\n    window = specialRule.window;\n    max = specialRule.max;\n  }\n  for (const plugin of ctx.options.plugins || []) {\n    if (plugin.rateLimit) {\n      const matchedRule = plugin.rateLimit.find(\n        (rule) => rule.pathMatcher(path)\n      );\n      if (matchedRule) {\n        window = matchedRule.window;\n        max = matchedRule.max;\n        break;\n      }\n    }\n  }\n  if (ctx.rateLimit.customRules) {\n    const _path = Object.keys(ctx.rateLimit.customRules).find((p) => {\n      if (p.includes(\"*\")) {\n        const isMatch = (0,_shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.x)(p)(path);\n        return isMatch;\n      }\n      return p === path;\n    });\n    if (_path) {\n      const customRule = ctx.rateLimit.customRules[_path];\n      const resolved = typeof customRule === \"function\" ? await customRule(req) : customRule;\n      if (resolved) {\n        window = resolved.window;\n        max = resolved.max;\n      }\n    }\n  }\n  const storage = getRateLimitStorage(ctx);\n  const data = await storage.get(key);\n  const now = Date.now();\n  if (!data) {\n    await storage.set(key, {\n      key,\n      count: 1,\n      lastRequest: now\n    });\n  } else {\n    const timeSinceLastRequest = now - data.lastRequest;\n    if (shouldRateLimit(max, window, data)) {\n      const retryAfter = getRetryAfter(data.lastRequest, window);\n      return rateLimitResponse(retryAfter);\n    } else if (timeSinceLastRequest > window * 1e3) {\n      await storage.set(\n        key,\n        {\n          ...data,\n          count: 1,\n          lastRequest: now\n        },\n        true\n      );\n    } else {\n      await storage.set(\n        key,\n        {\n          ...data,\n          count: data.count + 1,\n          lastRequest: now\n        },\n        true\n      );\n    }\n  }\n}\nfunction getDefaultSpecialRules() {\n  const specialRules = [\n    {\n      pathMatcher(path) {\n        return path.startsWith(\"/sign-in\") || path.startsWith(\"/sign-up\") || path.startsWith(\"/change-password\") || path.startsWith(\"/change-email\");\n      },\n      window: 10,\n      max: 3\n    }\n  ];\n  return specialRules;\n}\n\nfunction toAuthEndpoints(endpoints, ctx) {\n  const api = {};\n  for (const [key, endpoint] of Object.entries(endpoints)) {\n    api[key] = async (context) => {\n      const authContext = await ctx;\n      let internalContext = {\n        ...context,\n        context: {\n          ...authContext,\n          returned: void 0,\n          responseHeaders: void 0,\n          session: null\n        },\n        path: endpoint.path,\n        headers: context?.headers ? new Headers(context?.headers) : void 0\n      };\n      const { beforeHooks, afterHooks } = getHooks(authContext);\n      const before = await runBeforeHooks(internalContext, beforeHooks);\n      if (\"context\" in before && before.context && typeof before.context === \"object\") {\n        const { headers, ...rest } = before.context;\n        if (headers) {\n          headers.forEach((value, key2) => {\n            internalContext.headers.set(key2, value);\n          });\n        }\n        internalContext = (0,defu__WEBPACK_IMPORTED_MODULE_7__[\"default\"])(rest, internalContext);\n      } else if (before) {\n        return before;\n      }\n      internalContext.asResponse = false;\n      internalContext.returnHeaders = true;\n      const result = await endpoint(internalContext).catch((e) => {\n        if (e instanceof better_call__WEBPACK_IMPORTED_MODULE_0__.APIError) {\n          return {\n            response: e,\n            headers: e.headers ? new Headers(e.headers) : null\n          };\n        }\n        throw e;\n      });\n      internalContext.context.returned = result.response;\n      internalContext.context.responseHeaders = result.headers;\n      const after = await runAfterHooks(internalContext, afterHooks);\n      if (after.response) {\n        result.response = after.response;\n      }\n      if (result.response instanceof better_call__WEBPACK_IMPORTED_MODULE_0__.APIError && !context?.asResponse) {\n        throw result.response;\n      }\n      const response = context?.asResponse ? (0,better_call__WEBPACK_IMPORTED_MODULE_0__.toResponse)(result.response, {\n        headers: result.headers\n      }) : context?.returnHeaders ? {\n        headers: result.headers,\n        response: result.response\n      } : result.response;\n      return response;\n    };\n    api[key].path = endpoint.path;\n    api[key].options = endpoint.options;\n  }\n  return api;\n}\nasync function runBeforeHooks(context, hooks) {\n  let modifiedContext = {};\n  for (const hook of hooks) {\n    if (hook.matcher(context)) {\n      const result = await hook.handler({\n        ...context,\n        returnHeaders: false\n      });\n      if (result && typeof result === \"object\") {\n        if (\"context\" in result && typeof result.context === \"object\") {\n          const { headers, ...rest } = result.context;\n          if (headers instanceof Headers) {\n            if (modifiedContext.headers) {\n              headers.forEach((value, key) => {\n                modifiedContext.headers?.set(key, value);\n              });\n            } else {\n              modifiedContext.headers = headers;\n            }\n          }\n          modifiedContext = (0,defu__WEBPACK_IMPORTED_MODULE_7__[\"default\"])(rest, modifiedContext);\n          continue;\n        }\n        return result;\n      }\n    }\n  }\n  return { context: modifiedContext };\n}\nasync function runAfterHooks(context, hooks) {\n  for (const hook of hooks) {\n    if (hook.matcher(context)) {\n      const result = await hook.handler(context).catch((e) => {\n        if (e instanceof better_call__WEBPACK_IMPORTED_MODULE_0__.APIError) {\n          return {\n            response: e,\n            headers: e.headers ? new Headers(e.headers) : null\n          };\n        }\n        throw e;\n      });\n      if (result.headers) {\n        result.headers.forEach((value, key) => {\n          if (!context.context.responseHeaders) {\n            context.context.responseHeaders = new Headers({\n              [key]: value\n            });\n          } else {\n            if (key.toLowerCase() === \"set-cookie\") {\n              context.context.responseHeaders.append(key, value);\n            } else {\n              context.context.responseHeaders.set(key, value);\n            }\n          }\n        });\n      }\n      if (result.response) {\n        context.context.returned = result.response;\n      }\n    }\n  }\n  return {\n    response: context.context.returned,\n    headers: context.context.responseHeaders\n  };\n}\nfunction getHooks(authContext) {\n  const plugins = authContext.options.plugins || [];\n  const beforeHooks = [];\n  const afterHooks = [];\n  if (authContext.options.hooks?.before) {\n    beforeHooks.push({\n      matcher: () => true,\n      handler: authContext.options.hooks.before\n    });\n  }\n  if (authContext.options.hooks?.after) {\n    afterHooks.push({\n      matcher: () => true,\n      handler: authContext.options.hooks.after\n    });\n  }\n  const pluginBeforeHooks = plugins.map((plugin) => {\n    if (plugin.hooks?.before) {\n      return plugin.hooks.before;\n    }\n  }).filter((plugin) => plugin !== void 0).flat();\n  const pluginAfterHooks = plugins.map((plugin) => {\n    if (plugin.hooks?.after) {\n      return plugin.hooks.after;\n    }\n  }).filter((plugin) => plugin !== void 0).flat();\n  pluginBeforeHooks.length && beforeHooks.push(...pluginBeforeHooks);\n  pluginAfterHooks.length && afterHooks.push(...pluginAfterHooks);\n  return {\n    beforeHooks,\n    afterHooks\n  };\n}\n\nfunction getEndpoints(ctx, options) {\n  const pluginEndpoints = options.plugins?.reduce(\n    (acc, plugin) => {\n      return {\n        ...acc,\n        ...plugin.endpoints\n      };\n    },\n    {}\n  );\n  const middlewares = options.plugins?.map(\n    (plugin) => plugin.middlewares?.map((m) => {\n      const middleware = async (context) => {\n        return m.middleware({\n          ...context,\n          context: {\n            ...ctx,\n            ...context.context\n          }\n        });\n      };\n      middleware.options = m.middleware.options;\n      return {\n        path: m.path,\n        middleware\n      };\n    })\n  ).filter((plugin) => plugin !== void 0).flat() || [];\n  const baseEndpoints = {\n    signInSocial: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.a1,\n    callbackOAuth: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.a0,\n    getSession: (0,_shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.m)(),\n    signOut: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.$,\n    signUpEmail: signUpEmail(),\n    signInEmail: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__._,\n    forgetPassword: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.Z,\n    resetPassword: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.Y,\n    verifyEmail: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.X,\n    sendVerificationEmail: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.W,\n    changeEmail: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.V,\n    changePassword: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.U,\n    setPassword: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.T,\n    updateUser: (0,_shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.z)(),\n    deleteUser: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.S,\n    forgetPasswordCallback: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.R,\n    requestPasswordReset: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.Q,\n    requestPasswordResetCallback: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.P,\n    listSessions: (0,_shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.y)(),\n    revokeSession: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.O,\n    revokeSessions: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.N,\n    revokeOtherSessions: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.M,\n    linkSocialAccount: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.L,\n    listUserAccounts: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.K,\n    deleteUserCallback: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.J,\n    unlinkAccount: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.I,\n    refreshToken: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.G,\n    getAccessToken: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.F,\n    accountInfo: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.E\n  };\n  const endpoints = {\n    ...baseEndpoints,\n    ...pluginEndpoints,\n    ok: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.D,\n    error: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.C\n  };\n  const api = toAuthEndpoints(endpoints, ctx);\n  return {\n    api,\n    middlewares\n  };\n}\nconst router = (ctx, options) => {\n  const { api, middlewares } = getEndpoints(ctx, options);\n  const basePath = new URL(ctx.baseURL).pathname;\n  return (0,better_call__WEBPACK_IMPORTED_MODULE_0__.createRouter)(api, {\n    routerContext: ctx,\n    openapi: {\n      disabled: true\n    },\n    basePath,\n    routerMiddleware: [\n      {\n        path: \"/**\",\n        middleware: _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_1__.A\n      },\n      ...middlewares\n    ],\n    async onRequest(req) {\n      const disabledPaths = ctx.options.disabledPaths || [];\n      const path = new URL(req.url).pathname.replace(basePath, \"\");\n      if (disabledPaths.includes(path)) {\n        return new Response(\"Not Found\", { status: 404 });\n      }\n      for (const plugin of ctx.options.plugins || []) {\n        if (plugin.onRequest) {\n          const response = await plugin.onRequest(req, ctx);\n          if (response && \"response\" in response) {\n            return response.response;\n          }\n        }\n      }\n      return onRequestRateLimit(req, ctx);\n    },\n    async onResponse(res) {\n      for (const plugin of ctx.options.plugins || []) {\n        if (plugin.onResponse) {\n          const response = await plugin.onResponse(res, ctx);\n          if (response) {\n            return response.response;\n          }\n        }\n      }\n      return res;\n    },\n    onError(e) {\n      if (e instanceof better_call__WEBPACK_IMPORTED_MODULE_0__.APIError && e.status === \"FOUND\") {\n        return;\n      }\n      if (options.onAPIError?.throw) {\n        throw e;\n      }\n      if (options.onAPIError?.onError) {\n        options.onAPIError.onError(e, ctx);\n        return;\n      }\n      const optLogLevel = options.logger?.level;\n      const log = optLogLevel === \"error\" || optLogLevel === \"warn\" || optLogLevel === \"debug\" ? _shared_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_5__.a : void 0;\n      if (options.logger?.disabled !== true) {\n        if (e && typeof e === \"object\" && \"message\" in e && typeof e.message === \"string\") {\n          if (e.message.includes(\"no column\") || e.message.includes(\"column\") || e.message.includes(\"relation\") || e.message.includes(\"table\") || e.message.includes(\"does not exist\")) {\n            ctx.logger?.error(e.message);\n            return;\n          }\n        }\n        if (e instanceof better_call__WEBPACK_IMPORTED_MODULE_0__.APIError) {\n          if (e.status === \"INTERNAL_SERVER_ERROR\") {\n            ctx.logger.error(e.status, e);\n          }\n          log?.error(e.message);\n        } else {\n          ctx.logger?.error(\n            e && typeof e === \"object\" && \"name\" in e ? e.name : \"\",\n            e\n          );\n        }\n      }\n    }\n  });\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3QvYXBpL2luZGV4Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFpRTtBQUMxQjtBQUN3dkI7QUFDdmhCO0FBQzVPO0FBQzRCO0FBQ2lCO0FBQ0Q7QUFDUDtBQUNEO0FBQ3hDO0FBQ29CO0FBQ1g7QUFDRTtBQUNOO0FBQ0U7QUFDRDtBQUNJO0FBQ3BCO0FBQ2dCO0FBQ0Y7QUFDSTtBQUNIO0FBQ2U7QUFDVDtBQUNOO0FBQ2U7QUFDQTtBQUNBO0FBQ1g7QUFDRTtBQUNkOztBQUVyQiwwQkFBMEIsbUVBQWtCO0FBQzVDO0FBQ0E7QUFDQTtBQUNBLFVBQVUsMkNBQVEsQ0FBQywyQ0FBUSxJQUFJLHdDQUFLO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FB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QVE7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpR0FBaUcsK0RBQU07QUFDdkc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsaURBQVE7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRXNrQiIsInNvdXJjZXMiOlsiL1VzZXJzL21pbGFuL0Rlc2t0b3AvQXBwcy9iZXR0ZXItYXV0aC9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9hcGkvaW5kZXgubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFQSUVycm9yLCB0b1Jlc3BvbnNlLCBjcmVhdGVSb3V0ZXIgfSBmcm9tICdiZXR0ZXItY2FsbCc7XG5leHBvcnQgeyBBUElFcnJvciB9IGZyb20gJ2JldHRlci1jYWxsJztcbmltcG9ydCB7IGogYXMgY3JlYXRlQXV0aEVuZHBvaW50LCBCIGFzIEJBU0VfRVJST1JfQ09ERVMsIHcgYXMgY3JlYXRlRW1haWxWZXJpZmljYXRpb25Ub2tlbiwgeCBhcyB3aWxkY2FyZE1hdGNoLCB5IGFzIGxpc3RTZXNzaW9ucywgeiBhcyB1cGRhdGVVc2VyLCBtIGFzIGdldFNlc3Npb24sIEEgYXMgb3JpZ2luQ2hlY2tNaWRkbGV3YXJlLCBDIGFzIGVycm9yLCBEIGFzIG9rLCBFIGFzIGFjY291bnRJbmZvLCBGIGFzIGdldEFjY2Vzc1Rva2VuLCBHIGFzIHJlZnJlc2hUb2tlbiwgSSBhcyB1bmxpbmtBY2NvdW50LCBKIGFzIGRlbGV0ZVVzZXJDYWxsYmFjaywgSyBhcyBsaXN0VXNlckFjY291bnRzLCBMIGFzIGxpbmtTb2NpYWxBY2NvdW50LCBNIGFzIHJldm9rZU90aGVyU2Vzc2lvbnMsIE4gYXMgcmV2b2tlU2Vzc2lvbnMsIE8gYXMgcmV2b2tlU2Vzc2lvbiwgUCBhcyByZXF1ZXN0UGFzc3dvcmRSZXNldENhbGxiYWNrLCBRIGFzIHJlcXVlc3RQYXNzd29yZFJlc2V0LCBSIGFzIGZvcmdldFBhc3N3b3JkQ2FsbGJhY2ssIFMgYXMgZGVsZXRlVXNlciwgVCBhcyBzZXRQYXNzd29yZCwgVSBhcyBjaGFuZ2VQYXNzd29yZCwgViBhcyBjaGFuZ2VFbWFpbCwgVyBhcyBzZW5kVmVyaWZpY2F0aW9uRW1haWwsIFggYXMgdmVyaWZ5RW1haWwsIFkgYXMgcmVzZXRQYXNzd29yZCwgWiBhcyBmb3JnZXRQYXNzd29yZCwgXyBhcyBzaWduSW5FbWFpbCwgJCBhcyBzaWduT3V0LCBhMCBhcyBjYWxsYmFja09BdXRoLCBhMSBhcyBzaWduSW5Tb2NpYWwgfSBmcm9tICcuLi9zaGFyZWQvYmV0dGVyLWF1dGguejNkc3hMeEUubWpzJztcbmV4cG9ydCB7IGkgYXMgY3JlYXRlQXV0aE1pZGRsZXdhcmUsIG4gYXMgZnJlc2hTZXNzaW9uTWlkZGxld2FyZSwgayBhcyBnZXRTZXNzaW9uRnJvbUN0eCwgcSBhcyBvcHRpb25zTWlkZGxld2FyZSwgbyBhcyBvcmlnaW5DaGVjaywgYTIgYXMgcmVxdWVzdE9ubHlTZXNzaW9uTWlkZGxld2FyZSwgdSBhcyBzZW5kVmVyaWZpY2F0aW9uRW1haWxGbiwgbCBhcyBzZXNzaW9uTWlkZGxld2FyZSB9IGZyb20gJy4uL3NoYXJlZC9iZXR0ZXItYXV0aC56M2RzeEx4RS5tanMnO1xuaW1wb3J0ICogYXMgeiBmcm9tICd6b2QvdjQnO1xuaW1wb3J0IHsgc2V0U2Vzc2lvbkNvb2tpZSB9IGZyb20gJy4uL2Nvb2tpZXMvaW5kZXgubWpzJztcbmltcG9ydCB7IGYgYXMgcGFyc2VVc2VySW5wdXQgfSBmcm9tICcuLi9zaGFyZWQvYmV0dGVyLWF1dGgubjJLRkd3alkubWpzJztcbmltcG9ydCB7IGIgYXMgaXNEZXZlbG9wbWVudCB9IGZyb20gJy4uL3NoYXJlZC9iZXR0ZXItYXV0aC44em94emctRi5tanMnO1xuaW1wb3J0IHsgYSBhcyBsb2dnZXIgfSBmcm9tICcuLi9zaGFyZWQvYmV0dGVyLWF1dGguREJHZklEbmgubWpzJztcbmltcG9ydCB7IGcgYXMgZ2V0SXAgfSBmcm9tICcuLi9zaGFyZWQvYmV0dGVyLWF1dGguRGNmTlBTOHEubWpzJztcbmltcG9ydCBkZWZ1IGZyb20gJ2RlZnUnO1xuaW1wb3J0ICcuLi9zaGFyZWQvYmV0dGVyLWF1dGguQ1c2RDllU3gubWpzJztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzL2hhc2gnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMvYmFzZTY0JztcbmltcG9ydCAnLi4vY3J5cHRvL2luZGV4Lm1qcyc7XG5pbXBvcnQgJ0Bub2JsZS9jaXBoZXJzL2NoYWNoYSc7XG5pbXBvcnQgJ0Bub2JsZS9jaXBoZXJzL3V0aWxzJztcbmltcG9ydCAnQG5vYmxlL2NpcGhlcnMvd2ViY3J5cHRvJztcbmltcG9ydCAnam9zZSc7XG5pbXBvcnQgJ0Bub2JsZS9oYXNoZXMvc2NyeXB0JztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzJztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzL2hleCc7XG5pbXBvcnQgJ0Bub2JsZS9oYXNoZXMvdXRpbHMnO1xuaW1wb3J0ICcuLi9zaGFyZWQvYmV0dGVyLWF1dGguQjRRb3hkZ2MubWpzJztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzL3JhbmRvbSc7XG5pbXBvcnQgJ0BiZXR0ZXItZmV0Y2gvZmV0Y2gnO1xuaW1wb3J0ICcuLi9zaGFyZWQvYmV0dGVyLWF1dGguVlRYTkxGTVQubWpzJztcbmltcG9ydCAnLi4vc2hhcmVkL2JldHRlci1hdXRoLkRkelNKZi1uLm1qcyc7XG5pbXBvcnQgJy4uL3NoYXJlZC9iZXR0ZXItYXV0aC50QjVlVTZFWS5tanMnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMvaG1hYyc7XG5pbXBvcnQgJ0BiZXR0ZXItYXV0aC91dGlscy9iaW5hcnknO1xuaW1wb3J0ICdqb3NlL2Vycm9ycyc7XG5cbmNvbnN0IHNpZ25VcEVtYWlsID0gKCkgPT4gY3JlYXRlQXV0aEVuZHBvaW50KFxuICBcIi9zaWduLXVwL2VtYWlsXCIsXG4gIHtcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgIGJvZHk6IHoucmVjb3JkKHouc3RyaW5nKCksIHouYW55KCkpLFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICAkSW5mZXI6IHtcbiAgICAgICAgYm9keToge31cbiAgICAgIH0sXG4gICAgICBvcGVuYXBpOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlNpZ24gdXAgYSB1c2VyIHVzaW5nIGVtYWlsIGFuZCBwYXNzd29yZFwiLFxuICAgICAgICByZXF1ZXN0Qm9keToge1xuICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiOiB7XG4gICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgbmFtZToge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgbmFtZSBvZiB0aGUgdXNlclwiXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgZW1haWw6IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIGVtYWlsIG9mIHRoZSB1c2VyXCJcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICBwYXNzd29yZDoge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgcGFzc3dvcmQgb2YgdGhlIHVzZXJcIlxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIGltYWdlOiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBwcm9maWxlIGltYWdlIFVSTCBvZiB0aGUgdXNlclwiXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgY2FsbGJhY2tVUkw6IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIFVSTCB0byB1c2UgZm9yIGVtYWlsIHZlcmlmaWNhdGlvbiBjYWxsYmFja1wiXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgcmVtZW1iZXJNZToge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImJvb2xlYW5cIixcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiSWYgdGhpcyBpcyBmYWxzZSwgdGhlIHNlc3Npb24gd2lsbCBub3QgYmUgcmVtZW1iZXJlZC4gRGVmYXVsdCBpcyBgdHJ1ZWAuXCJcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBbXCJuYW1lXCIsIFwiZW1haWxcIiwgXCJwYXNzd29yZFwiXVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICByZXNwb25zZXM6IHtcbiAgICAgICAgICBcIjIwMFwiOiB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJTdWNjZXNzZnVsbHkgY3JlYXRlZCB1c2VyXCIsXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiOiB7XG4gICAgICAgICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICB0b2tlbjoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgbnVsbGFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiQXV0aGVudGljYXRpb24gdG9rZW4gZm9yIHRoZSBzZXNzaW9uXCJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIHVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSB1c2VyXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFwiZW1haWxcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIGVtYWlsIGFkZHJlc3Mgb2YgdGhlIHVzZXJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIG5hbWUgb2YgdGhlIHVzZXJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogXCJ1cmlcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbGFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBwcm9maWxlIGltYWdlIFVSTCBvZiB0aGUgdXNlclwiXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZW1haWxWZXJpZmllZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImJvb2xlYW5cIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiV2hldGhlciB0aGUgZW1haWwgaGFzIGJlZW4gdmVyaWZpZWRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFwiZGF0ZS10aW1lXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIldoZW4gdGhlIHVzZXIgd2FzIGNyZWF0ZWRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRBdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFwiZGF0ZS10aW1lXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIldoZW4gdGhlIHVzZXIgd2FzIGxhc3QgdXBkYXRlZFwiXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogW1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJpZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJlbWFpbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImVtYWlsVmVyaWZpZWRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY3JlYXRlZEF0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInVwZGF0ZWRBdFwiXG4gICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFtcInVzZXJcIl1cbiAgICAgICAgICAgICAgICAgIC8vIHRva2VuIGlzIG9wdGlvbmFsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBhc3luYyAoY3R4KSA9PiB7XG4gICAgaWYgKCFjdHguY29udGV4dC5vcHRpb25zLmVtYWlsQW5kUGFzc3dvcmQ/LmVuYWJsZWQgfHwgY3R4LmNvbnRleHQub3B0aW9ucy5lbWFpbEFuZFBhc3N3b3JkPy5kaXNhYmxlU2lnblVwKSB7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IFwiRW1haWwgYW5kIHBhc3N3b3JkIHNpZ24gdXAgaXMgbm90IGVuYWJsZWRcIlxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IGJvZHkgPSBjdHguYm9keTtcbiAgICBjb25zdCB7XG4gICAgICBuYW1lLFxuICAgICAgZW1haWwsXG4gICAgICBwYXNzd29yZCxcbiAgICAgIGltYWdlLFxuICAgICAgY2FsbGJhY2tVUkwsXG4gICAgICByZW1lbWJlck1lLFxuICAgICAgLi4uYWRkaXRpb25hbEZpZWxkc1xuICAgIH0gPSBib2R5O1xuICAgIGNvbnN0IGlzVmFsaWRFbWFpbCA9IHouZW1haWwoKS5zYWZlUGFyc2UoZW1haWwpO1xuICAgIGlmICghaXNWYWxpZEVtYWlsLnN1Y2Nlc3MpIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5JTlZBTElEX0VNQUlMXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgbWluUGFzc3dvcmRMZW5ndGggPSBjdHguY29udGV4dC5wYXNzd29yZC5jb25maWcubWluUGFzc3dvcmRMZW5ndGg7XG4gICAgaWYgKHBhc3N3b3JkLmxlbmd0aCA8IG1pblBhc3N3b3JkTGVuZ3RoKSB7XG4gICAgICBjdHguY29udGV4dC5sb2dnZXIuZXJyb3IoXCJQYXNzd29yZCBpcyB0b28gc2hvcnRcIik7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuUEFTU1dPUkRfVE9PX1NIT1JUXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgbWF4UGFzc3dvcmRMZW5ndGggPSBjdHguY29udGV4dC5wYXNzd29yZC5jb25maWcubWF4UGFzc3dvcmRMZW5ndGg7XG4gICAgaWYgKHBhc3N3b3JkLmxlbmd0aCA+IG1heFBhc3N3b3JkTGVuZ3RoKSB7XG4gICAgICBjdHguY29udGV4dC5sb2dnZXIuZXJyb3IoXCJQYXNzd29yZCBpcyB0b28gbG9uZ1wiKTtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5QQVNTV09SRF9UT09fTE9OR1xuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IGRiVXNlciA9IGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5maW5kVXNlckJ5RW1haWwoZW1haWwpO1xuICAgIGlmIChkYlVzZXI/LnVzZXIpIHtcbiAgICAgIGN0eC5jb250ZXh0LmxvZ2dlci5pbmZvKGBTaWduLXVwIGF0dGVtcHQgZm9yIGV4aXN0aW5nIGVtYWlsOiAke2VtYWlsfWApO1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiVU5QUk9DRVNTQUJMRV9FTlRJVFlcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLlVTRVJfQUxSRUFEWV9FWElTVFNcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBhZGRpdGlvbmFsRGF0YSA9IHBhcnNlVXNlcklucHV0KFxuICAgICAgY3R4LmNvbnRleHQub3B0aW9ucyxcbiAgICAgIGFkZGl0aW9uYWxGaWVsZHNcbiAgICApO1xuICAgIGNvbnN0IGhhc2ggPSBhd2FpdCBjdHguY29udGV4dC5wYXNzd29yZC5oYXNoKHBhc3N3b3JkKTtcbiAgICBsZXQgY3JlYXRlZFVzZXI7XG4gICAgdHJ5IHtcbiAgICAgIGNyZWF0ZWRVc2VyID0gYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmNyZWF0ZVVzZXIoXG4gICAgICAgIHtcbiAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICBuYW1lLFxuICAgICAgICAgIGltYWdlLFxuICAgICAgICAgIC4uLmFkZGl0aW9uYWxEYXRhLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IGZhbHNlXG4gICAgICAgIH0sXG4gICAgICAgIGN0eFxuICAgICAgKTtcbiAgICAgIGlmICghY3JlYXRlZFVzZXIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuRkFJTEVEX1RPX0NSRUFURV9VU0VSXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGlmIChpc0RldmVsb3BtZW50KSB7XG4gICAgICAgIGN0eC5jb250ZXh0LmxvZ2dlci5lcnJvcihcIkZhaWxlZCB0byBjcmVhdGUgdXNlclwiLCBlKTtcbiAgICAgIH1cbiAgICAgIGlmIChlIGluc3RhbmNlb2YgQVBJRXJyb3IpIHtcbiAgICAgICAgdGhyb3cgZTtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIlVOUFJPQ0VTU0FCTEVfRU5USVRZXCIsIHtcbiAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5GQUlMRURfVE9fQ1JFQVRFX1VTRVIsXG4gICAgICAgIGRldGFpbHM6IGVcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoIWNyZWF0ZWRVc2VyKSB7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJVTlBST0NFU1NBQkxFX0VOVElUWVwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuRkFJTEVEX1RPX0NSRUFURV9VU0VSXG4gICAgICB9KTtcbiAgICB9XG4gICAgYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmxpbmtBY2NvdW50KFxuICAgICAge1xuICAgICAgICB1c2VySWQ6IGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgICBwcm92aWRlcklkOiBcImNyZWRlbnRpYWxcIixcbiAgICAgICAgYWNjb3VudElkOiBjcmVhdGVkVXNlci5pZCxcbiAgICAgICAgcGFzc3dvcmQ6IGhhc2hcbiAgICAgIH0sXG4gICAgICBjdHhcbiAgICApO1xuICAgIGlmIChjdHguY29udGV4dC5vcHRpb25zLmVtYWlsVmVyaWZpY2F0aW9uPy5zZW5kT25TaWduVXAgfHwgY3R4LmNvbnRleHQub3B0aW9ucy5lbWFpbEFuZFBhc3N3b3JkLnJlcXVpcmVFbWFpbFZlcmlmaWNhdGlvbikge1xuICAgICAgY29uc3QgdG9rZW4gPSBhd2FpdCBjcmVhdGVFbWFpbFZlcmlmaWNhdGlvblRva2VuKFxuICAgICAgICBjdHguY29udGV4dC5zZWNyZXQsXG4gICAgICAgIGNyZWF0ZWRVc2VyLmVtYWlsLFxuICAgICAgICB2b2lkIDAsXG4gICAgICAgIGN0eC5jb250ZXh0Lm9wdGlvbnMuZW1haWxWZXJpZmljYXRpb24/LmV4cGlyZXNJblxuICAgICAgKTtcbiAgICAgIGNvbnN0IHVybCA9IGAke2N0eC5jb250ZXh0LmJhc2VVUkx9L3ZlcmlmeS1lbWFpbD90b2tlbj0ke3Rva2VufSZjYWxsYmFja1VSTD0ke2JvZHkuY2FsbGJhY2tVUkwgfHwgXCIvXCJ9YDtcbiAgICAgIGF3YWl0IGN0eC5jb250ZXh0Lm9wdGlvbnMuZW1haWxWZXJpZmljYXRpb24/LnNlbmRWZXJpZmljYXRpb25FbWFpbD8uKFxuICAgICAgICB7XG4gICAgICAgICAgdXNlcjogY3JlYXRlZFVzZXIsXG4gICAgICAgICAgdXJsLFxuICAgICAgICAgIHRva2VuXG4gICAgICAgIH0sXG4gICAgICAgIGN0eC5yZXF1ZXN0XG4gICAgICApO1xuICAgIH1cbiAgICBpZiAoY3R4LmNvbnRleHQub3B0aW9ucy5lbWFpbEFuZFBhc3N3b3JkLmF1dG9TaWduSW4gPT09IGZhbHNlIHx8IGN0eC5jb250ZXh0Lm9wdGlvbnMuZW1haWxBbmRQYXNzd29yZC5yZXF1aXJlRW1haWxWZXJpZmljYXRpb24pIHtcbiAgICAgIHJldHVybiBjdHguanNvbih7XG4gICAgICAgIHRva2VuOiBudWxsLFxuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgICAgIGVtYWlsOiBjcmVhdGVkVXNlci5lbWFpbCxcbiAgICAgICAgICBuYW1lOiBjcmVhdGVkVXNlci5uYW1lLFxuICAgICAgICAgIGltYWdlOiBjcmVhdGVkVXNlci5pbWFnZSxcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiBjcmVhdGVkVXNlci5lbWFpbFZlcmlmaWVkLFxuICAgICAgICAgIGNyZWF0ZWRBdDogY3JlYXRlZFVzZXIuY3JlYXRlZEF0LFxuICAgICAgICAgIHVwZGF0ZWRBdDogY3JlYXRlZFVzZXIudXBkYXRlZEF0XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmNyZWF0ZVNlc3Npb24oXG4gICAgICBjcmVhdGVkVXNlci5pZCxcbiAgICAgIGN0eCxcbiAgICAgIHJlbWVtYmVyTWUgPT09IGZhbHNlXG4gICAgKTtcbiAgICBpZiAoIXNlc3Npb24pIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5GQUlMRURfVE9fQ1JFQVRFX1NFU1NJT05cbiAgICAgIH0pO1xuICAgIH1cbiAgICBhd2FpdCBzZXRTZXNzaW9uQ29va2llKFxuICAgICAgY3R4LFxuICAgICAge1xuICAgICAgICBzZXNzaW9uLFxuICAgICAgICB1c2VyOiBjcmVhdGVkVXNlclxuICAgICAgfSxcbiAgICAgIHJlbWVtYmVyTWUgPT09IGZhbHNlXG4gICAgKTtcbiAgICByZXR1cm4gY3R4Lmpzb24oe1xuICAgICAgdG9rZW46IHNlc3Npb24udG9rZW4sXG4gICAgICB1c2VyOiB7XG4gICAgICAgIGlkOiBjcmVhdGVkVXNlci5pZCxcbiAgICAgICAgZW1haWw6IGNyZWF0ZWRVc2VyLmVtYWlsLFxuICAgICAgICBuYW1lOiBjcmVhdGVkVXNlci5uYW1lLFxuICAgICAgICBpbWFnZTogY3JlYXRlZFVzZXIuaW1hZ2UsXG4gICAgICAgIGVtYWlsVmVyaWZpZWQ6IGNyZWF0ZWRVc2VyLmVtYWlsVmVyaWZpZWQsXG4gICAgICAgIGNyZWF0ZWRBdDogY3JlYXRlZFVzZXIuY3JlYXRlZEF0LFxuICAgICAgICB1cGRhdGVkQXQ6IGNyZWF0ZWRVc2VyLnVwZGF0ZWRBdFxuICAgICAgfVxuICAgIH0pO1xuICB9XG4pO1xuXG5mdW5jdGlvbiBzaG91bGRSYXRlTGltaXQobWF4LCB3aW5kb3csIHJhdGVMaW1pdERhdGEpIHtcbiAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgY29uc3Qgd2luZG93SW5NcyA9IHdpbmRvdyAqIDFlMztcbiAgY29uc3QgdGltZVNpbmNlTGFzdFJlcXVlc3QgPSBub3cgLSByYXRlTGltaXREYXRhLmxhc3RSZXF1ZXN0O1xuICByZXR1cm4gdGltZVNpbmNlTGFzdFJlcXVlc3QgPCB3aW5kb3dJbk1zICYmIHJhdGVMaW1pdERhdGEuY291bnQgPj0gbWF4O1xufVxuZnVuY3Rpb24gcmF0ZUxpbWl0UmVzcG9uc2UocmV0cnlBZnRlcikge1xuICByZXR1cm4gbmV3IFJlc3BvbnNlKFxuICAgIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgIG1lc3NhZ2U6IFwiVG9vIG1hbnkgcmVxdWVzdHMuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuXCJcbiAgICB9KSxcbiAgICB7XG4gICAgICBzdGF0dXM6IDQyOSxcbiAgICAgIHN0YXR1c1RleHQ6IFwiVG9vIE1hbnkgUmVxdWVzdHNcIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgXCJYLVJldHJ5LUFmdGVyXCI6IHJldHJ5QWZ0ZXIudG9TdHJpbmcoKVxuICAgICAgfVxuICAgIH1cbiAgKTtcbn1cbmZ1bmN0aW9uIGdldFJldHJ5QWZ0ZXIobGFzdFJlcXVlc3QsIHdpbmRvdykge1xuICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICBjb25zdCB3aW5kb3dJbk1zID0gd2luZG93ICogMWUzO1xuICByZXR1cm4gTWF0aC5jZWlsKChsYXN0UmVxdWVzdCArIHdpbmRvd0luTXMgLSBub3cpIC8gMWUzKTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZURCU3RvcmFnZShjdHgpIHtcbiAgY29uc3QgbW9kZWwgPSBcInJhdGVMaW1pdFwiO1xuICBjb25zdCBkYiA9IGN0eC5hZGFwdGVyO1xuICByZXR1cm4ge1xuICAgIGdldDogYXN5bmMgKGtleSkgPT4ge1xuICAgICAgY29uc3QgcmVzID0gYXdhaXQgZGIuZmluZE1hbnkoe1xuICAgICAgICBtb2RlbCxcbiAgICAgICAgd2hlcmU6IFt7IGZpZWxkOiBcImtleVwiLCB2YWx1ZToga2V5IH1dXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGRhdGEgPSByZXNbMF07XG4gICAgICBpZiAodHlwZW9mIGRhdGE/Lmxhc3RSZXF1ZXN0ID09PSBcImJpZ2ludFwiKSB7XG4gICAgICAgIGRhdGEubGFzdFJlcXVlc3QgPSBOdW1iZXIoZGF0YS5sYXN0UmVxdWVzdCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9LFxuICAgIHNldDogYXN5bmMgKGtleSwgdmFsdWUsIF91cGRhdGUpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmIChfdXBkYXRlKSB7XG4gICAgICAgICAgYXdhaXQgZGIudXBkYXRlTWFueSh7XG4gICAgICAgICAgICBtb2RlbCxcbiAgICAgICAgICAgIHdoZXJlOiBbeyBmaWVsZDogXCJrZXlcIiwgdmFsdWU6IGtleSB9XSxcbiAgICAgICAgICAgIHVwZGF0ZToge1xuICAgICAgICAgICAgICBjb3VudDogdmFsdWUuY291bnQsXG4gICAgICAgICAgICAgIGxhc3RSZXF1ZXN0OiB2YWx1ZS5sYXN0UmVxdWVzdFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGF3YWl0IGRiLmNyZWF0ZSh7XG4gICAgICAgICAgICBtb2RlbCxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgICBjb3VudDogdmFsdWUuY291bnQsXG4gICAgICAgICAgICAgIGxhc3RSZXF1ZXN0OiB2YWx1ZS5sYXN0UmVxdWVzdFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGN0eC5sb2dnZXIuZXJyb3IoXCJFcnJvciBzZXR0aW5nIHJhdGUgbGltaXRcIiwgZSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xufVxuY29uc3QgbWVtb3J5ID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbmZ1bmN0aW9uIGdldFJhdGVMaW1pdFN0b3JhZ2UoY3R4KSB7XG4gIGlmIChjdHgub3B0aW9ucy5yYXRlTGltaXQ/LmN1c3RvbVN0b3JhZ2UpIHtcbiAgICByZXR1cm4gY3R4Lm9wdGlvbnMucmF0ZUxpbWl0LmN1c3RvbVN0b3JhZ2U7XG4gIH1cbiAgaWYgKGN0eC5yYXRlTGltaXQuc3RvcmFnZSA9PT0gXCJzZWNvbmRhcnktc3RvcmFnZVwiKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGdldDogYXN5bmMgKGtleSkgPT4ge1xuICAgICAgICBjb25zdCBzdHJpbmdpZmllZCA9IGF3YWl0IGN0eC5vcHRpb25zLnNlY29uZGFyeVN0b3JhZ2U/LmdldChrZXkpO1xuICAgICAgICByZXR1cm4gc3RyaW5naWZpZWQgPyBKU09OLnBhcnNlKHN0cmluZ2lmaWVkKSA6IHZvaWQgMDtcbiAgICAgIH0sXG4gICAgICBzZXQ6IGFzeW5jIChrZXksIHZhbHVlKSA9PiB7XG4gICAgICAgIGF3YWl0IGN0eC5vcHRpb25zLnNlY29uZGFyeVN0b3JhZ2U/LnNldD8uKGtleSwgSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG4gIGNvbnN0IHN0b3JhZ2UgPSBjdHgucmF0ZUxpbWl0LnN0b3JhZ2U7XG4gIGlmIChzdG9yYWdlID09PSBcIm1lbW9yeVwiKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFzeW5jIGdldChrZXkpIHtcbiAgICAgICAgcmV0dXJuIG1lbW9yeS5nZXQoa2V5KTtcbiAgICAgIH0sXG4gICAgICBhc3luYyBzZXQoa2V5LCB2YWx1ZSwgX3VwZGF0ZSkge1xuICAgICAgICBtZW1vcnkuc2V0KGtleSwgdmFsdWUpO1xuICAgICAgfVxuICAgIH07XG4gIH1cbiAgcmV0dXJuIGNyZWF0ZURCU3RvcmFnZShjdHgpO1xufVxuYXN5bmMgZnVuY3Rpb24gb25SZXF1ZXN0UmF0ZUxpbWl0KHJlcSwgY3R4KSB7XG4gIGlmICghY3R4LnJhdGVMaW1pdC5lbmFibGVkKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHBhdGggPSBuZXcgVVJMKHJlcS51cmwpLnBhdGhuYW1lLnJlcGxhY2UoXG4gICAgY3R4Lm9wdGlvbnMuYmFzZVBhdGggfHwgXCIvYXBpL2F1dGhcIixcbiAgICBcIlwiXG4gICk7XG4gIGxldCB3aW5kb3cgPSBjdHgucmF0ZUxpbWl0LndpbmRvdztcbiAgbGV0IG1heCA9IGN0eC5yYXRlTGltaXQubWF4O1xuICBjb25zdCBpcCA9IGdldElwKHJlcSwgY3R4Lm9wdGlvbnMpO1xuICBpZiAoIWlwKSB7XG4gICAgY29uc29sZS53YXJuKFwiTm8gSVAgYWRkcmVzcyBmb3VuZCBmb3IgcmF0ZSBsaW1pdGluZ1wiKTtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3Qga2V5ID0gaXAgKyBwYXRoO1xuICBjb25zdCBzcGVjaWFsUnVsZXMgPSBnZXREZWZhdWx0U3BlY2lhbFJ1bGVzKCk7XG4gIGNvbnN0IHNwZWNpYWxSdWxlID0gc3BlY2lhbFJ1bGVzLmZpbmQoKHJ1bGUpID0+IHJ1bGUucGF0aE1hdGNoZXIocGF0aCkpO1xuICBpZiAoc3BlY2lhbFJ1bGUpIHtcbiAgICB3aW5kb3cgPSBzcGVjaWFsUnVsZS53aW5kb3c7XG4gICAgbWF4ID0gc3BlY2lhbFJ1bGUubWF4O1xuICB9XG4gIGZvciAoY29uc3QgcGx1Z2luIG9mIGN0eC5vcHRpb25zLnBsdWdpbnMgfHwgW10pIHtcbiAgICBpZiAocGx1Z2luLnJhdGVMaW1pdCkge1xuICAgICAgY29uc3QgbWF0Y2hlZFJ1bGUgPSBwbHVnaW4ucmF0ZUxpbWl0LmZpbmQoXG4gICAgICAgIChydWxlKSA9PiBydWxlLnBhdGhNYXRjaGVyKHBhdGgpXG4gICAgICApO1xuICAgICAgaWYgKG1hdGNoZWRSdWxlKSB7XG4gICAgICAgIHdpbmRvdyA9IG1hdGNoZWRSdWxlLndpbmRvdztcbiAgICAgICAgbWF4ID0gbWF0Y2hlZFJ1bGUubWF4O1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgaWYgKGN0eC5yYXRlTGltaXQuY3VzdG9tUnVsZXMpIHtcbiAgICBjb25zdCBfcGF0aCA9IE9iamVjdC5rZXlzKGN0eC5yYXRlTGltaXQuY3VzdG9tUnVsZXMpLmZpbmQoKHApID0+IHtcbiAgICAgIGlmIChwLmluY2x1ZGVzKFwiKlwiKSkge1xuICAgICAgICBjb25zdCBpc01hdGNoID0gd2lsZGNhcmRNYXRjaChwKShwYXRoKTtcbiAgICAgICAgcmV0dXJuIGlzTWF0Y2g7XG4gICAgICB9XG4gICAgICByZXR1cm4gcCA9PT0gcGF0aDtcbiAgICB9KTtcbiAgICBpZiAoX3BhdGgpIHtcbiAgICAgIGNvbnN0IGN1c3RvbVJ1bGUgPSBjdHgucmF0ZUxpbWl0LmN1c3RvbVJ1bGVzW19wYXRoXTtcbiAgICAgIGNvbnN0IHJlc29sdmVkID0gdHlwZW9mIGN1c3RvbVJ1bGUgPT09IFwiZnVuY3Rpb25cIiA/IGF3YWl0IGN1c3RvbVJ1bGUocmVxKSA6IGN1c3RvbVJ1bGU7XG4gICAgICBpZiAocmVzb2x2ZWQpIHtcbiAgICAgICAgd2luZG93ID0gcmVzb2x2ZWQud2luZG93O1xuICAgICAgICBtYXggPSByZXNvbHZlZC5tYXg7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGNvbnN0IHN0b3JhZ2UgPSBnZXRSYXRlTGltaXRTdG9yYWdlKGN0eCk7XG4gIGNvbnN0IGRhdGEgPSBhd2FpdCBzdG9yYWdlLmdldChrZXkpO1xuICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICBpZiAoIWRhdGEpIHtcbiAgICBhd2FpdCBzdG9yYWdlLnNldChrZXksIHtcbiAgICAgIGtleSxcbiAgICAgIGNvdW50OiAxLFxuICAgICAgbGFzdFJlcXVlc3Q6IG5vd1xuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IHRpbWVTaW5jZUxhc3RSZXF1ZXN0ID0gbm93IC0gZGF0YS5sYXN0UmVxdWVzdDtcbiAgICBpZiAoc2hvdWxkUmF0ZUxpbWl0KG1heCwgd2luZG93LCBkYXRhKSkge1xuICAgICAgY29uc3QgcmV0cnlBZnRlciA9IGdldFJldHJ5QWZ0ZXIoZGF0YS5sYXN0UmVxdWVzdCwgd2luZG93KTtcbiAgICAgIHJldHVybiByYXRlTGltaXRSZXNwb25zZShyZXRyeUFmdGVyKTtcbiAgICB9IGVsc2UgaWYgKHRpbWVTaW5jZUxhc3RSZXF1ZXN0ID4gd2luZG93ICogMWUzKSB7XG4gICAgICBhd2FpdCBzdG9yYWdlLnNldChcbiAgICAgICAga2V5LFxuICAgICAgICB7XG4gICAgICAgICAgLi4uZGF0YSxcbiAgICAgICAgICBjb3VudDogMSxcbiAgICAgICAgICBsYXN0UmVxdWVzdDogbm93XG4gICAgICAgIH0sXG4gICAgICAgIHRydWVcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGF3YWl0IHN0b3JhZ2Uuc2V0KFxuICAgICAgICBrZXksXG4gICAgICAgIHtcbiAgICAgICAgICAuLi5kYXRhLFxuICAgICAgICAgIGNvdW50OiBkYXRhLmNvdW50ICsgMSxcbiAgICAgICAgICBsYXN0UmVxdWVzdDogbm93XG4gICAgICAgIH0sXG4gICAgICAgIHRydWVcbiAgICAgICk7XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiBnZXREZWZhdWx0U3BlY2lhbFJ1bGVzKCkge1xuICBjb25zdCBzcGVjaWFsUnVsZXMgPSBbXG4gICAge1xuICAgICAgcGF0aE1hdGNoZXIocGF0aCkge1xuICAgICAgICByZXR1cm4gcGF0aC5zdGFydHNXaXRoKFwiL3NpZ24taW5cIikgfHwgcGF0aC5zdGFydHNXaXRoKFwiL3NpZ24tdXBcIikgfHwgcGF0aC5zdGFydHNXaXRoKFwiL2NoYW5nZS1wYXNzd29yZFwiKSB8fCBwYXRoLnN0YXJ0c1dpdGgoXCIvY2hhbmdlLWVtYWlsXCIpO1xuICAgICAgfSxcbiAgICAgIHdpbmRvdzogMTAsXG4gICAgICBtYXg6IDNcbiAgICB9XG4gIF07XG4gIHJldHVybiBzcGVjaWFsUnVsZXM7XG59XG5cbmZ1bmN0aW9uIHRvQXV0aEVuZHBvaW50cyhlbmRwb2ludHMsIGN0eCkge1xuICBjb25zdCBhcGkgPSB7fTtcbiAgZm9yIChjb25zdCBba2V5LCBlbmRwb2ludF0gb2YgT2JqZWN0LmVudHJpZXMoZW5kcG9pbnRzKSkge1xuICAgIGFwaVtrZXldID0gYXN5bmMgKGNvbnRleHQpID0+IHtcbiAgICAgIGNvbnN0IGF1dGhDb250ZXh0ID0gYXdhaXQgY3R4O1xuICAgICAgbGV0IGludGVybmFsQ29udGV4dCA9IHtcbiAgICAgICAgLi4uY29udGV4dCxcbiAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgIC4uLmF1dGhDb250ZXh0LFxuICAgICAgICAgIHJldHVybmVkOiB2b2lkIDAsXG4gICAgICAgICAgcmVzcG9uc2VIZWFkZXJzOiB2b2lkIDAsXG4gICAgICAgICAgc2Vzc2lvbjogbnVsbFxuICAgICAgICB9LFxuICAgICAgICBwYXRoOiBlbmRwb2ludC5wYXRoLFxuICAgICAgICBoZWFkZXJzOiBjb250ZXh0Py5oZWFkZXJzID8gbmV3IEhlYWRlcnMoY29udGV4dD8uaGVhZGVycykgOiB2b2lkIDBcbiAgICAgIH07XG4gICAgICBjb25zdCB7IGJlZm9yZUhvb2tzLCBhZnRlckhvb2tzIH0gPSBnZXRIb29rcyhhdXRoQ29udGV4dCk7XG4gICAgICBjb25zdCBiZWZvcmUgPSBhd2FpdCBydW5CZWZvcmVIb29rcyhpbnRlcm5hbENvbnRleHQsIGJlZm9yZUhvb2tzKTtcbiAgICAgIGlmIChcImNvbnRleHRcIiBpbiBiZWZvcmUgJiYgYmVmb3JlLmNvbnRleHQgJiYgdHlwZW9mIGJlZm9yZS5jb250ZXh0ID09PSBcIm9iamVjdFwiKSB7XG4gICAgICAgIGNvbnN0IHsgaGVhZGVycywgLi4ucmVzdCB9ID0gYmVmb3JlLmNvbnRleHQ7XG4gICAgICAgIGlmIChoZWFkZXJzKSB7XG4gICAgICAgICAgaGVhZGVycy5mb3JFYWNoKCh2YWx1ZSwga2V5MikgPT4ge1xuICAgICAgICAgICAgaW50ZXJuYWxDb250ZXh0LmhlYWRlcnMuc2V0KGtleTIsIHZhbHVlKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpbnRlcm5hbENvbnRleHQgPSBkZWZ1KHJlc3QsIGludGVybmFsQ29udGV4dCk7XG4gICAgICB9IGVsc2UgaWYgKGJlZm9yZSkge1xuICAgICAgICByZXR1cm4gYmVmb3JlO1xuICAgICAgfVxuICAgICAgaW50ZXJuYWxDb250ZXh0LmFzUmVzcG9uc2UgPSBmYWxzZTtcbiAgICAgIGludGVybmFsQ29udGV4dC5yZXR1cm5IZWFkZXJzID0gdHJ1ZTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGVuZHBvaW50KGludGVybmFsQ29udGV4dCkuY2F0Y2goKGUpID0+IHtcbiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBBUElFcnJvcikge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXNwb25zZTogZSxcbiAgICAgICAgICAgIGhlYWRlcnM6IGUuaGVhZGVycyA/IG5ldyBIZWFkZXJzKGUuaGVhZGVycykgOiBudWxsXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBlO1xuICAgICAgfSk7XG4gICAgICBpbnRlcm5hbENvbnRleHQuY29udGV4dC5yZXR1cm5lZCA9IHJlc3VsdC5yZXNwb25zZTtcbiAgICAgIGludGVybmFsQ29udGV4dC5jb250ZXh0LnJlc3BvbnNlSGVhZGVycyA9IHJlc3VsdC5oZWFkZXJzO1xuICAgICAgY29uc3QgYWZ0ZXIgPSBhd2FpdCBydW5BZnRlckhvb2tzKGludGVybmFsQ29udGV4dCwgYWZ0ZXJIb29rcyk7XG4gICAgICBpZiAoYWZ0ZXIucmVzcG9uc2UpIHtcbiAgICAgICAgcmVzdWx0LnJlc3BvbnNlID0gYWZ0ZXIucmVzcG9uc2U7XG4gICAgICB9XG4gICAgICBpZiAocmVzdWx0LnJlc3BvbnNlIGluc3RhbmNlb2YgQVBJRXJyb3IgJiYgIWNvbnRleHQ/LmFzUmVzcG9uc2UpIHtcbiAgICAgICAgdGhyb3cgcmVzdWx0LnJlc3BvbnNlO1xuICAgICAgfVxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBjb250ZXh0Py5hc1Jlc3BvbnNlID8gdG9SZXNwb25zZShyZXN1bHQucmVzcG9uc2UsIHtcbiAgICAgICAgaGVhZGVyczogcmVzdWx0LmhlYWRlcnNcbiAgICAgIH0pIDogY29udGV4dD8ucmV0dXJuSGVhZGVycyA/IHtcbiAgICAgICAgaGVhZGVyczogcmVzdWx0LmhlYWRlcnMsXG4gICAgICAgIHJlc3BvbnNlOiByZXN1bHQucmVzcG9uc2VcbiAgICAgIH0gOiByZXN1bHQucmVzcG9uc2U7XG4gICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfTtcbiAgICBhcGlba2V5XS5wYXRoID0gZW5kcG9pbnQucGF0aDtcbiAgICBhcGlba2V5XS5vcHRpb25zID0gZW5kcG9pbnQub3B0aW9ucztcbiAgfVxuICByZXR1cm4gYXBpO1xufVxuYXN5bmMgZnVuY3Rpb24gcnVuQmVmb3JlSG9va3MoY29udGV4dCwgaG9va3MpIHtcbiAgbGV0IG1vZGlmaWVkQ29udGV4dCA9IHt9O1xuICBmb3IgKGNvbnN0IGhvb2sgb2YgaG9va3MpIHtcbiAgICBpZiAoaG9vay5tYXRjaGVyKGNvbnRleHQpKSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBob29rLmhhbmRsZXIoe1xuICAgICAgICAuLi5jb250ZXh0LFxuICAgICAgICByZXR1cm5IZWFkZXJzOiBmYWxzZVxuICAgICAgfSk7XG4gICAgICBpZiAocmVzdWx0ICYmIHR5cGVvZiByZXN1bHQgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgaWYgKFwiY29udGV4dFwiIGluIHJlc3VsdCAmJiB0eXBlb2YgcmVzdWx0LmNvbnRleHQgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgICBjb25zdCB7IGhlYWRlcnMsIC4uLnJlc3QgfSA9IHJlc3VsdC5jb250ZXh0O1xuICAgICAgICAgIGlmIChoZWFkZXJzIGluc3RhbmNlb2YgSGVhZGVycykge1xuICAgICAgICAgICAgaWYgKG1vZGlmaWVkQ29udGV4dC5oZWFkZXJzKSB7XG4gICAgICAgICAgICAgIGhlYWRlcnMuZm9yRWFjaCgodmFsdWUsIGtleSkgPT4ge1xuICAgICAgICAgICAgICAgIG1vZGlmaWVkQ29udGV4dC5oZWFkZXJzPy5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kaWZpZWRDb250ZXh0LmhlYWRlcnMgPSBoZWFkZXJzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBtb2RpZmllZENvbnRleHQgPSBkZWZ1KHJlc3QsIG1vZGlmaWVkQ29udGV4dCk7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHsgY29udGV4dDogbW9kaWZpZWRDb250ZXh0IH07XG59XG5hc3luYyBmdW5jdGlvbiBydW5BZnRlckhvb2tzKGNvbnRleHQsIGhvb2tzKSB7XG4gIGZvciAoY29uc3QgaG9vayBvZiBob29rcykge1xuICAgIGlmIChob29rLm1hdGNoZXIoY29udGV4dCkpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGhvb2suaGFuZGxlcihjb250ZXh0KS5jYXRjaCgoZSkgPT4ge1xuICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEFQSUVycm9yKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3BvbnNlOiBlLFxuICAgICAgICAgICAgaGVhZGVyczogZS5oZWFkZXJzID8gbmV3IEhlYWRlcnMoZS5oZWFkZXJzKSA6IG51bGxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHRocm93IGU7XG4gICAgICB9KTtcbiAgICAgIGlmIChyZXN1bHQuaGVhZGVycykge1xuICAgICAgICByZXN1bHQuaGVhZGVycy5mb3JFYWNoKCh2YWx1ZSwga2V5KSA9PiB7XG4gICAgICAgICAgaWYgKCFjb250ZXh0LmNvbnRleHQucmVzcG9uc2VIZWFkZXJzKSB7XG4gICAgICAgICAgICBjb250ZXh0LmNvbnRleHQucmVzcG9uc2VIZWFkZXJzID0gbmV3IEhlYWRlcnMoe1xuICAgICAgICAgICAgICBba2V5XTogdmFsdWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoa2V5LnRvTG93ZXJDYXNlKCkgPT09IFwic2V0LWNvb2tpZVwiKSB7XG4gICAgICAgICAgICAgIGNvbnRleHQuY29udGV4dC5yZXNwb25zZUhlYWRlcnMuYXBwZW5kKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY29udGV4dC5jb250ZXh0LnJlc3BvbnNlSGVhZGVycy5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGlmIChyZXN1bHQucmVzcG9uc2UpIHtcbiAgICAgICAgY29udGV4dC5jb250ZXh0LnJldHVybmVkID0gcmVzdWx0LnJlc3BvbnNlO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4ge1xuICAgIHJlc3BvbnNlOiBjb250ZXh0LmNvbnRleHQucmV0dXJuZWQsXG4gICAgaGVhZGVyczogY29udGV4dC5jb250ZXh0LnJlc3BvbnNlSGVhZGVyc1xuICB9O1xufVxuZnVuY3Rpb24gZ2V0SG9va3MoYXV0aENvbnRleHQpIHtcbiAgY29uc3QgcGx1Z2lucyA9IGF1dGhDb250ZXh0Lm9wdGlvbnMucGx1Z2lucyB8fCBbXTtcbiAgY29uc3QgYmVmb3JlSG9va3MgPSBbXTtcbiAgY29uc3QgYWZ0ZXJIb29rcyA9IFtdO1xuICBpZiAoYXV0aENvbnRleHQub3B0aW9ucy5ob29rcz8uYmVmb3JlKSB7XG4gICAgYmVmb3JlSG9va3MucHVzaCh7XG4gICAgICBtYXRjaGVyOiAoKSA9PiB0cnVlLFxuICAgICAgaGFuZGxlcjogYXV0aENvbnRleHQub3B0aW9ucy5ob29rcy5iZWZvcmVcbiAgICB9KTtcbiAgfVxuICBpZiAoYXV0aENvbnRleHQub3B0aW9ucy5ob29rcz8uYWZ0ZXIpIHtcbiAgICBhZnRlckhvb2tzLnB1c2goe1xuICAgICAgbWF0Y2hlcjogKCkgPT4gdHJ1ZSxcbiAgICAgIGhhbmRsZXI6IGF1dGhDb250ZXh0Lm9wdGlvbnMuaG9va3MuYWZ0ZXJcbiAgICB9KTtcbiAgfVxuICBjb25zdCBwbHVnaW5CZWZvcmVIb29rcyA9IHBsdWdpbnMubWFwKChwbHVnaW4pID0+IHtcbiAgICBpZiAocGx1Z2luLmhvb2tzPy5iZWZvcmUpIHtcbiAgICAgIHJldHVybiBwbHVnaW4uaG9va3MuYmVmb3JlO1xuICAgIH1cbiAgfSkuZmlsdGVyKChwbHVnaW4pID0+IHBsdWdpbiAhPT0gdm9pZCAwKS5mbGF0KCk7XG4gIGNvbnN0IHBsdWdpbkFmdGVySG9va3MgPSBwbHVnaW5zLm1hcCgocGx1Z2luKSA9PiB7XG4gICAgaWYgKHBsdWdpbi5ob29rcz8uYWZ0ZXIpIHtcbiAgICAgIHJldHVybiBwbHVnaW4uaG9va3MuYWZ0ZXI7XG4gICAgfVxuICB9KS5maWx0ZXIoKHBsdWdpbikgPT4gcGx1Z2luICE9PSB2b2lkIDApLmZsYXQoKTtcbiAgcGx1Z2luQmVmb3JlSG9va3MubGVuZ3RoICYmIGJlZm9yZUhvb2tzLnB1c2goLi4ucGx1Z2luQmVmb3JlSG9va3MpO1xuICBwbHVnaW5BZnRlckhvb2tzLmxlbmd0aCAmJiBhZnRlckhvb2tzLnB1c2goLi4ucGx1Z2luQWZ0ZXJIb29rcyk7XG4gIHJldHVybiB7XG4gICAgYmVmb3JlSG9va3MsXG4gICAgYWZ0ZXJIb29rc1xuICB9O1xufVxuXG5mdW5jdGlvbiBnZXRFbmRwb2ludHMoY3R4LCBvcHRpb25zKSB7XG4gIGNvbnN0IHBsdWdpbkVuZHBvaW50cyA9IG9wdGlvbnMucGx1Z2lucz8ucmVkdWNlKFxuICAgIChhY2MsIHBsdWdpbikgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uYWNjLFxuICAgICAgICAuLi5wbHVnaW4uZW5kcG9pbnRzXG4gICAgICB9O1xuICAgIH0sXG4gICAge31cbiAgKTtcbiAgY29uc3QgbWlkZGxld2FyZXMgPSBvcHRpb25zLnBsdWdpbnM/Lm1hcChcbiAgICAocGx1Z2luKSA9PiBwbHVnaW4ubWlkZGxld2FyZXM/Lm1hcCgobSkgPT4ge1xuICAgICAgY29uc3QgbWlkZGxld2FyZSA9IGFzeW5jIChjb250ZXh0KSA9PiB7XG4gICAgICAgIHJldHVybiBtLm1pZGRsZXdhcmUoe1xuICAgICAgICAgIC4uLmNvbnRleHQsXG4gICAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgICAgLi4uY3R4LFxuICAgICAgICAgICAgLi4uY29udGV4dC5jb250ZXh0XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICBtaWRkbGV3YXJlLm9wdGlvbnMgPSBtLm1pZGRsZXdhcmUub3B0aW9ucztcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBhdGg6IG0ucGF0aCxcbiAgICAgICAgbWlkZGxld2FyZVxuICAgICAgfTtcbiAgICB9KVxuICApLmZpbHRlcigocGx1Z2luKSA9PiBwbHVnaW4gIT09IHZvaWQgMCkuZmxhdCgpIHx8IFtdO1xuICBjb25zdCBiYXNlRW5kcG9pbnRzID0ge1xuICAgIHNpZ25JblNvY2lhbCxcbiAgICBjYWxsYmFja09BdXRoLFxuICAgIGdldFNlc3Npb246IGdldFNlc3Npb24oKSxcbiAgICBzaWduT3V0LFxuICAgIHNpZ25VcEVtYWlsOiBzaWduVXBFbWFpbCgpLFxuICAgIHNpZ25JbkVtYWlsLFxuICAgIGZvcmdldFBhc3N3b3JkLFxuICAgIHJlc2V0UGFzc3dvcmQsXG4gICAgdmVyaWZ5RW1haWwsXG4gICAgc2VuZFZlcmlmaWNhdGlvbkVtYWlsLFxuICAgIGNoYW5nZUVtYWlsLFxuICAgIGNoYW5nZVBhc3N3b3JkLFxuICAgIHNldFBhc3N3b3JkLFxuICAgIHVwZGF0ZVVzZXI6IHVwZGF0ZVVzZXIoKSxcbiAgICBkZWxldGVVc2VyLFxuICAgIGZvcmdldFBhc3N3b3JkQ2FsbGJhY2ssXG4gICAgcmVxdWVzdFBhc3N3b3JkUmVzZXQsXG4gICAgcmVxdWVzdFBhc3N3b3JkUmVzZXRDYWxsYmFjayxcbiAgICBsaXN0U2Vzc2lvbnM6IGxpc3RTZXNzaW9ucygpLFxuICAgIHJldm9rZVNlc3Npb24sXG4gICAgcmV2b2tlU2Vzc2lvbnMsXG4gICAgcmV2b2tlT3RoZXJTZXNzaW9ucyxcbiAgICBsaW5rU29jaWFsQWNjb3VudCxcbiAgICBsaXN0VXNlckFjY291bnRzLFxuICAgIGRlbGV0ZVVzZXJDYWxsYmFjayxcbiAgICB1bmxpbmtBY2NvdW50LFxuICAgIHJlZnJlc2hUb2tlbixcbiAgICBnZXRBY2Nlc3NUb2tlbixcbiAgICBhY2NvdW50SW5mb1xuICB9O1xuICBjb25zdCBlbmRwb2ludHMgPSB7XG4gICAgLi4uYmFzZUVuZHBvaW50cyxcbiAgICAuLi5wbHVnaW5FbmRwb2ludHMsXG4gICAgb2ssXG4gICAgZXJyb3JcbiAgfTtcbiAgY29uc3QgYXBpID0gdG9BdXRoRW5kcG9pbnRzKGVuZHBvaW50cywgY3R4KTtcbiAgcmV0dXJuIHtcbiAgICBhcGksXG4gICAgbWlkZGxld2FyZXNcbiAgfTtcbn1cbmNvbnN0IHJvdXRlciA9IChjdHgsIG9wdGlvbnMpID0+IHtcbiAgY29uc3QgeyBhcGksIG1pZGRsZXdhcmVzIH0gPSBnZXRFbmRwb2ludHMoY3R4LCBvcHRpb25zKTtcbiAgY29uc3QgYmFzZVBhdGggPSBuZXcgVVJMKGN0eC5iYXNlVVJMKS5wYXRobmFtZTtcbiAgcmV0dXJuIGNyZWF0ZVJvdXRlcihhcGksIHtcbiAgICByb3V0ZXJDb250ZXh0OiBjdHgsXG4gICAgb3BlbmFwaToge1xuICAgICAgZGlzYWJsZWQ6IHRydWVcbiAgICB9LFxuICAgIGJhc2VQYXRoLFxuICAgIHJvdXRlck1pZGRsZXdhcmU6IFtcbiAgICAgIHtcbiAgICAgICAgcGF0aDogXCIvKipcIixcbiAgICAgICAgbWlkZGxld2FyZTogb3JpZ2luQ2hlY2tNaWRkbGV3YXJlXG4gICAgICB9LFxuICAgICAgLi4ubWlkZGxld2FyZXNcbiAgICBdLFxuICAgIGFzeW5jIG9uUmVxdWVzdChyZXEpIHtcbiAgICAgIGNvbnN0IGRpc2FibGVkUGF0aHMgPSBjdHgub3B0aW9ucy5kaXNhYmxlZFBhdGhzIHx8IFtdO1xuICAgICAgY29uc3QgcGF0aCA9IG5ldyBVUkwocmVxLnVybCkucGF0aG5hbWUucmVwbGFjZShiYXNlUGF0aCwgXCJcIik7XG4gICAgICBpZiAoZGlzYWJsZWRQYXRocy5pbmNsdWRlcyhwYXRoKSkge1xuICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKFwiTm90IEZvdW5kXCIsIHsgc3RhdHVzOiA0MDQgfSk7XG4gICAgICB9XG4gICAgICBmb3IgKGNvbnN0IHBsdWdpbiBvZiBjdHgub3B0aW9ucy5wbHVnaW5zIHx8IFtdKSB7XG4gICAgICAgIGlmIChwbHVnaW4ub25SZXF1ZXN0KSB7XG4gICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBwbHVnaW4ub25SZXF1ZXN0KHJlcSwgY3R4KTtcbiAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgXCJyZXNwb25zZVwiIGluIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UucmVzcG9uc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gb25SZXF1ZXN0UmF0ZUxpbWl0KHJlcSwgY3R4KTtcbiAgICB9LFxuICAgIGFzeW5jIG9uUmVzcG9uc2UocmVzKSB7XG4gICAgICBmb3IgKGNvbnN0IHBsdWdpbiBvZiBjdHgub3B0aW9ucy5wbHVnaW5zIHx8IFtdKSB7XG4gICAgICAgIGlmIChwbHVnaW4ub25SZXNwb25zZSkge1xuICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcGx1Z2luLm9uUmVzcG9uc2UocmVzLCBjdHgpO1xuICAgICAgICAgIGlmIChyZXNwb25zZSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnJlc3BvbnNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlcztcbiAgICB9LFxuICAgIG9uRXJyb3IoZSkge1xuICAgICAgaWYgKGUgaW5zdGFuY2VvZiBBUElFcnJvciAmJiBlLnN0YXR1cyA9PT0gXCJGT1VORFwiKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLm9uQVBJRXJyb3I/LnRocm93KSB7XG4gICAgICAgIHRocm93IGU7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5vbkFQSUVycm9yPy5vbkVycm9yKSB7XG4gICAgICAgIG9wdGlvbnMub25BUElFcnJvci5vbkVycm9yKGUsIGN0eCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IG9wdExvZ0xldmVsID0gb3B0aW9ucy5sb2dnZXI/LmxldmVsO1xuICAgICAgY29uc3QgbG9nID0gb3B0TG9nTGV2ZWwgPT09IFwiZXJyb3JcIiB8fCBvcHRMb2dMZXZlbCA9PT0gXCJ3YXJuXCIgfHwgb3B0TG9nTGV2ZWwgPT09IFwiZGVidWdcIiA/IGxvZ2dlciA6IHZvaWQgMDtcbiAgICAgIGlmIChvcHRpb25zLmxvZ2dlcj8uZGlzYWJsZWQgIT09IHRydWUpIHtcbiAgICAgICAgaWYgKGUgJiYgdHlwZW9mIGUgPT09IFwib2JqZWN0XCIgJiYgXCJtZXNzYWdlXCIgaW4gZSAmJiB0eXBlb2YgZS5tZXNzYWdlID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgaWYgKGUubWVzc2FnZS5pbmNsdWRlcyhcIm5vIGNvbHVtblwiKSB8fCBlLm1lc3NhZ2UuaW5jbHVkZXMoXCJjb2x1bW5cIikgfHwgZS5tZXNzYWdlLmluY2x1ZGVzKFwicmVsYXRpb25cIikgfHwgZS5tZXNzYWdlLmluY2x1ZGVzKFwidGFibGVcIikgfHwgZS5tZXNzYWdlLmluY2x1ZGVzKFwiZG9lcyBub3QgZXhpc3RcIikpIHtcbiAgICAgICAgICAgIGN0eC5sb2dnZXI/LmVycm9yKGUubWVzc2FnZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgQVBJRXJyb3IpIHtcbiAgICAgICAgICBpZiAoZS5zdGF0dXMgPT09IFwiSU5URVJOQUxfU0VSVkVSX0VSUk9SXCIpIHtcbiAgICAgICAgICAgIGN0eC5sb2dnZXIuZXJyb3IoZS5zdGF0dXMsIGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBsb2c/LmVycm9yKGUubWVzc2FnZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY3R4LmxvZ2dlcj8uZXJyb3IoXG4gICAgICAgICAgICBlICYmIHR5cGVvZiBlID09PSBcIm9iamVjdFwiICYmIFwibmFtZVwiIGluIGUgPyBlLm5hbWUgOiBcIlwiLFxuICAgICAgICAgICAgZVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufTtcblxuZXhwb3J0IHsgYWNjb3VudEluZm8sIGNhbGxiYWNrT0F1dGgsIGNoYW5nZUVtYWlsLCBjaGFuZ2VQYXNzd29yZCwgY3JlYXRlQXV0aEVuZHBvaW50LCBjcmVhdGVFbWFpbFZlcmlmaWNhdGlvblRva2VuLCBkZWxldGVVc2VyLCBkZWxldGVVc2VyQ2FsbGJhY2ssIGVycm9yLCBmb3JnZXRQYXNzd29yZCwgZm9yZ2V0UGFzc3dvcmRDYWxsYmFjaywgZ2V0QWNjZXNzVG9rZW4sIGdldEVuZHBvaW50cywgZ2V0U2Vzc2lvbiwgbGlua1NvY2lhbEFjY291bnQsIGxpc3RTZXNzaW9ucywgbGlzdFVzZXJBY2NvdW50cywgb2ssIG9yaWdpbkNoZWNrTWlkZGxld2FyZSwgcmVmcmVzaFRva2VuLCByZXF1ZXN0UGFzc3dvcmRSZXNldCwgcmVxdWVzdFBhc3N3b3JkUmVzZXRDYWxsYmFjaywgcmVzZXRQYXNzd29yZCwgcmV2b2tlT3RoZXJTZXNzaW9ucywgcmV2b2tlU2Vzc2lvbiwgcmV2b2tlU2Vzc2lvbnMsIHJvdXRlciwgc2VuZFZlcmlmaWNhdGlvbkVtYWlsLCBzZXRQYXNzd29yZCwgc2lnbkluRW1haWwsIHNpZ25JblNvY2lhbCwgc2lnbk91dCwgc2lnblVwRW1haWwsIHVubGlua0FjY291bnQsIHVwZGF0ZVVzZXIsIHZlcmlmeUVtYWlsIH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/api/index.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/chunks/bun-sqlite-dialect.mjs":
/*!*************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/chunks/bun-sqlite-dialect.mjs ***!
  \*************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BunSqliteAdapter: () => (/* binding */ BunSqliteAdapter),\n/* harmony export */   BunSqliteDialect: () => (/* binding */ BunSqliteDialect),\n/* harmony export */   BunSqliteDriver: () => (/* binding */ BunSqliteDriver),\n/* harmony export */   BunSqliteIntrospector: () => (/* binding */ BunSqliteIntrospector),\n/* harmony export */   BunSqliteQueryCompiler: () => (/* binding */ BunSqliteQueryCompiler)\n/* harmony export */ });\n/* harmony import */ var kysely__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! kysely */ \"(rsc)/../../node_modules/kysely/dist/esm/query-compiler/compiled-query.js\");\n/* harmony import */ var kysely__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! kysely */ \"(rsc)/../../node_modules/kysely/dist/esm/migration/migrator.js\");\n/* harmony import */ var kysely__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! kysely */ \"(rsc)/../../node_modules/kysely/dist/esm/raw-builder/sql.js\");\n/* harmony import */ var kysely__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! kysely */ \"(rsc)/../../node_modules/kysely/dist/esm/query-compiler/default-query-compiler.js\");\n\n\nclass BunSqliteAdapter {\n  get supportsCreateIfNotExists() {\n    return true;\n  }\n  get supportsTransactionalDdl() {\n    return false;\n  }\n  get supportsReturning() {\n    return true;\n  }\n  async acquireMigrationLock() {\n  }\n  async releaseMigrationLock() {\n  }\n  get supportsOutput() {\n    return true;\n  }\n}\nclass BunSqliteDriver {\n  #config;\n  #connectionMutex = new ConnectionMutex();\n  #db;\n  #connection;\n  constructor(config) {\n    this.#config = { ...config };\n  }\n  async init() {\n    this.#db = this.#config.database;\n    this.#connection = new BunSqliteConnection(this.#db);\n    if (this.#config.onCreateConnection) {\n      await this.#config.onCreateConnection(this.#connection);\n    }\n  }\n  async acquireConnection() {\n    await this.#connectionMutex.lock();\n    return this.#connection;\n  }\n  async beginTransaction(connection) {\n    await connection.executeQuery(kysely__WEBPACK_IMPORTED_MODULE_0__.CompiledQuery.raw(\"begin\"));\n  }\n  async commitTransaction(connection) {\n    await connection.executeQuery(kysely__WEBPACK_IMPORTED_MODULE_0__.CompiledQuery.raw(\"commit\"));\n  }\n  async rollbackTransaction(connection) {\n    await connection.executeQuery(kysely__WEBPACK_IMPORTED_MODULE_0__.CompiledQuery.raw(\"rollback\"));\n  }\n  async releaseConnection() {\n    this.#connectionMutex.unlock();\n  }\n  async destroy() {\n    this.#db?.close();\n  }\n}\nclass BunSqliteConnection {\n  #db;\n  constructor(db) {\n    this.#db = db;\n  }\n  executeQuery(compiledQuery) {\n    const { sql: sql2, parameters } = compiledQuery;\n    const stmt = this.#db.prepare(sql2);\n    return Promise.resolve({\n      rows: stmt.all(parameters)\n    });\n  }\n  async *streamQuery() {\n    throw new Error(\"Streaming query is not supported by SQLite driver.\");\n  }\n}\nclass ConnectionMutex {\n  #promise;\n  #resolve;\n  async lock() {\n    while (this.#promise) {\n      await this.#promise;\n    }\n    this.#promise = new Promise((resolve) => {\n      this.#resolve = resolve;\n    });\n  }\n  unlock() {\n    const resolve = this.#resolve;\n    this.#promise = void 0;\n    this.#resolve = void 0;\n    resolve?.();\n  }\n}\nclass BunSqliteIntrospector {\n  #db;\n  constructor(db) {\n    this.#db = db;\n  }\n  async getSchemas() {\n    return [];\n  }\n  async getTables(options = { withInternalKyselyTables: false }) {\n    let query = this.#db.selectFrom(\"sqlite_schema\").where(\"type\", \"=\", \"table\").where(\"name\", \"not like\", \"sqlite_%\").select(\"name\").$castTo();\n    if (!options.withInternalKyselyTables) {\n      query = query.where(\"name\", \"!=\", kysely__WEBPACK_IMPORTED_MODULE_1__.DEFAULT_MIGRATION_TABLE).where(\"name\", \"!=\", kysely__WEBPACK_IMPORTED_MODULE_1__.DEFAULT_MIGRATION_LOCK_TABLE);\n    }\n    const tables = await query.execute();\n    return Promise.all(tables.map(({ name }) => this.#getTableMetadata(name)));\n  }\n  async getMetadata(options) {\n    return {\n      tables: await this.getTables(options)\n    };\n  }\n  async #getTableMetadata(table) {\n    const db = this.#db;\n    const createSql = await db.selectFrom(\"sqlite_master\").where(\"name\", \"=\", table).select(\"sql\").$castTo().execute();\n    const autoIncrementCol = createSql[0]?.sql?.split(/[\\(\\),]/)?.find((it) => it.toLowerCase().includes(\"autoincrement\"))?.split(/\\s+/)?.[0]?.replace(/[\"`]/g, \"\");\n    const columns = await db.selectFrom(\n      (0,kysely__WEBPACK_IMPORTED_MODULE_2__.sql)`pragma_table_info(${table})`.as(\"table_info\")\n    ).select([\"name\", \"type\", \"notnull\", \"dflt_value\"]).execute();\n    return {\n      name: table,\n      columns: columns.map((col) => ({\n        name: col.name,\n        dataType: col.type,\n        isNullable: !col.notnull,\n        isAutoIncrementing: col.name === autoIncrementCol,\n        hasDefaultValue: col.dflt_value != null\n      })),\n      isView: true\n    };\n  }\n}\nclass BunSqliteQueryCompiler extends kysely__WEBPACK_IMPORTED_MODULE_3__.DefaultQueryCompiler {\n  getCurrentParameterPlaceholder() {\n    return \"?\";\n  }\n  getLeftIdentifierWrapper() {\n    return '\"';\n  }\n  getRightIdentifierWrapper() {\n    return '\"';\n  }\n  getAutoIncrement() {\n    return \"autoincrement\";\n  }\n}\nclass BunSqliteDialect {\n  #config;\n  constructor(config) {\n    this.#config = { ...config };\n  }\n  createDriver() {\n    return new BunSqliteDriver(this.#config);\n  }\n  createQueryCompiler() {\n    return new BunSqliteQueryCompiler();\n  }\n  createAdapter() {\n    return new BunSqliteAdapter();\n  }\n  createIntrospector(db) {\n    return new BunSqliteIntrospector(db);\n  }\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3QvY2h1bmtzL2J1bi1zcWxpdGUtZGlhbGVjdC5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQXlIOztBQUV6SDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsaURBQWE7QUFDL0M7QUFDQTtBQUNBLGtDQUFrQyxpREFBYTtBQUMvQztBQUNBO0FBQ0Esa0NBQWtDLGlEQUFhO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHdCQUF3QjtBQUNwQztBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QixpQ0FBaUM7QUFDL0Q7QUFDQTtBQUNBLHdDQUF3QywyREFBdUIsc0JBQXNCLGdFQUE0QjtBQUNqSDtBQUNBO0FBQ0EscUNBQXFDLE1BQU07QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sMkNBQUcscUJBQXFCLE1BQU07QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLHdEQUFvQjtBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUU4RyIsInNvdXJjZXMiOlsiL1VzZXJzL21pbGFuL0Rlc2t0b3AvQXBwcy9iZXR0ZXItYXV0aC9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9jaHVua3MvYnVuLXNxbGl0ZS1kaWFsZWN0Lm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21waWxlZFF1ZXJ5LCBEZWZhdWx0UXVlcnlDb21waWxlciwgREVGQVVMVF9NSUdSQVRJT05fVEFCTEUsIERFRkFVTFRfTUlHUkFUSU9OX0xPQ0tfVEFCTEUsIHNxbCB9IGZyb20gJ2t5c2VseSc7XG5cbmNsYXNzIEJ1blNxbGl0ZUFkYXB0ZXIge1xuICBnZXQgc3VwcG9ydHNDcmVhdGVJZk5vdEV4aXN0cygpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBnZXQgc3VwcG9ydHNUcmFuc2FjdGlvbmFsRGRsKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBnZXQgc3VwcG9ydHNSZXR1cm5pbmcoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgYXN5bmMgYWNxdWlyZU1pZ3JhdGlvbkxvY2soKSB7XG4gIH1cbiAgYXN5bmMgcmVsZWFzZU1pZ3JhdGlvbkxvY2soKSB7XG4gIH1cbiAgZ2V0IHN1cHBvcnRzT3V0cHV0KCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG59XG5jbGFzcyBCdW5TcWxpdGVEcml2ZXIge1xuICAjY29uZmlnO1xuICAjY29ubmVjdGlvbk11dGV4ID0gbmV3IENvbm5lY3Rpb25NdXRleCgpO1xuICAjZGI7XG4gICNjb25uZWN0aW9uO1xuICBjb25zdHJ1Y3Rvcihjb25maWcpIHtcbiAgICB0aGlzLiNjb25maWcgPSB7IC4uLmNvbmZpZyB9O1xuICB9XG4gIGFzeW5jIGluaXQoKSB7XG4gICAgdGhpcy4jZGIgPSB0aGlzLiNjb25maWcuZGF0YWJhc2U7XG4gICAgdGhpcy4jY29ubmVjdGlvbiA9IG5ldyBCdW5TcWxpdGVDb25uZWN0aW9uKHRoaXMuI2RiKTtcbiAgICBpZiAodGhpcy4jY29uZmlnLm9uQ3JlYXRlQ29ubmVjdGlvbikge1xuICAgICAgYXdhaXQgdGhpcy4jY29uZmlnLm9uQ3JlYXRlQ29ubmVjdGlvbih0aGlzLiNjb25uZWN0aW9uKTtcbiAgICB9XG4gIH1cbiAgYXN5bmMgYWNxdWlyZUNvbm5lY3Rpb24oKSB7XG4gICAgYXdhaXQgdGhpcy4jY29ubmVjdGlvbk11dGV4LmxvY2soKTtcbiAgICByZXR1cm4gdGhpcy4jY29ubmVjdGlvbjtcbiAgfVxuICBhc3luYyBiZWdpblRyYW5zYWN0aW9uKGNvbm5lY3Rpb24pIHtcbiAgICBhd2FpdCBjb25uZWN0aW9uLmV4ZWN1dGVRdWVyeShDb21waWxlZFF1ZXJ5LnJhdyhcImJlZ2luXCIpKTtcbiAgfVxuICBhc3luYyBjb21taXRUcmFuc2FjdGlvbihjb25uZWN0aW9uKSB7XG4gICAgYXdhaXQgY29ubmVjdGlvbi5leGVjdXRlUXVlcnkoQ29tcGlsZWRRdWVyeS5yYXcoXCJjb21taXRcIikpO1xuICB9XG4gIGFzeW5jIHJvbGxiYWNrVHJhbnNhY3Rpb24oY29ubmVjdGlvbikge1xuICAgIGF3YWl0IGNvbm5lY3Rpb24uZXhlY3V0ZVF1ZXJ5KENvbXBpbGVkUXVlcnkucmF3KFwicm9sbGJhY2tcIikpO1xuICB9XG4gIGFzeW5jIHJlbGVhc2VDb25uZWN0aW9uKCkge1xuICAgIHRoaXMuI2Nvbm5lY3Rpb25NdXRleC51bmxvY2soKTtcbiAgfVxuICBhc3luYyBkZXN0cm95KCkge1xuICAgIHRoaXMuI2RiPy5jbG9zZSgpO1xuICB9XG59XG5jbGFzcyBCdW5TcWxpdGVDb25uZWN0aW9uIHtcbiAgI2RiO1xuICBjb25zdHJ1Y3RvcihkYikge1xuICAgIHRoaXMuI2RiID0gZGI7XG4gIH1cbiAgZXhlY3V0ZVF1ZXJ5KGNvbXBpbGVkUXVlcnkpIHtcbiAgICBjb25zdCB7IHNxbDogc3FsMiwgcGFyYW1ldGVycyB9ID0gY29tcGlsZWRRdWVyeTtcbiAgICBjb25zdCBzdG10ID0gdGhpcy4jZGIucHJlcGFyZShzcWwyKTtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHtcbiAgICAgIHJvd3M6IHN0bXQuYWxsKHBhcmFtZXRlcnMpXG4gICAgfSk7XG4gIH1cbiAgYXN5bmMgKnN0cmVhbVF1ZXJ5KCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIlN0cmVhbWluZyBxdWVyeSBpcyBub3Qgc3VwcG9ydGVkIGJ5IFNRTGl0ZSBkcml2ZXIuXCIpO1xuICB9XG59XG5jbGFzcyBDb25uZWN0aW9uTXV0ZXgge1xuICAjcHJvbWlzZTtcbiAgI3Jlc29sdmU7XG4gIGFzeW5jIGxvY2soKSB7XG4gICAgd2hpbGUgKHRoaXMuI3Byb21pc2UpIHtcbiAgICAgIGF3YWl0IHRoaXMuI3Byb21pc2U7XG4gICAgfVxuICAgIHRoaXMuI3Byb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgdGhpcy4jcmVzb2x2ZSA9IHJlc29sdmU7XG4gICAgfSk7XG4gIH1cbiAgdW5sb2NrKCkge1xuICAgIGNvbnN0IHJlc29sdmUgPSB0aGlzLiNyZXNvbHZlO1xuICAgIHRoaXMuI3Byb21pc2UgPSB2b2lkIDA7XG4gICAgdGhpcy4jcmVzb2x2ZSA9IHZvaWQgMDtcbiAgICByZXNvbHZlPy4oKTtcbiAgfVxufVxuY2xhc3MgQnVuU3FsaXRlSW50cm9zcGVjdG9yIHtcbiAgI2RiO1xuICBjb25zdHJ1Y3RvcihkYikge1xuICAgIHRoaXMuI2RiID0gZGI7XG4gIH1cbiAgYXN5bmMgZ2V0U2NoZW1hcygpIHtcbiAgICByZXR1cm4gW107XG4gIH1cbiAgYXN5bmMgZ2V0VGFibGVzKG9wdGlvbnMgPSB7IHdpdGhJbnRlcm5hbEt5c2VseVRhYmxlczogZmFsc2UgfSkge1xuICAgIGxldCBxdWVyeSA9IHRoaXMuI2RiLnNlbGVjdEZyb20oXCJzcWxpdGVfc2NoZW1hXCIpLndoZXJlKFwidHlwZVwiLCBcIj1cIiwgXCJ0YWJsZVwiKS53aGVyZShcIm5hbWVcIiwgXCJub3QgbGlrZVwiLCBcInNxbGl0ZV8lXCIpLnNlbGVjdChcIm5hbWVcIikuJGNhc3RUbygpO1xuICAgIGlmICghb3B0aW9ucy53aXRoSW50ZXJuYWxLeXNlbHlUYWJsZXMpIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkud2hlcmUoXCJuYW1lXCIsIFwiIT1cIiwgREVGQVVMVF9NSUdSQVRJT05fVEFCTEUpLndoZXJlKFwibmFtZVwiLCBcIiE9XCIsIERFRkFVTFRfTUlHUkFUSU9OX0xPQ0tfVEFCTEUpO1xuICAgIH1cbiAgICBjb25zdCB0YWJsZXMgPSBhd2FpdCBxdWVyeS5leGVjdXRlKCk7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKHRhYmxlcy5tYXAoKHsgbmFtZSB9KSA9PiB0aGlzLiNnZXRUYWJsZU1ldGFkYXRhKG5hbWUpKSk7XG4gIH1cbiAgYXN5bmMgZ2V0TWV0YWRhdGEob3B0aW9ucykge1xuICAgIHJldHVybiB7XG4gICAgICB0YWJsZXM6IGF3YWl0IHRoaXMuZ2V0VGFibGVzKG9wdGlvbnMpXG4gICAgfTtcbiAgfVxuICBhc3luYyAjZ2V0VGFibGVNZXRhZGF0YSh0YWJsZSkge1xuICAgIGNvbnN0IGRiID0gdGhpcy4jZGI7XG4gICAgY29uc3QgY3JlYXRlU3FsID0gYXdhaXQgZGIuc2VsZWN0RnJvbShcInNxbGl0ZV9tYXN0ZXJcIikud2hlcmUoXCJuYW1lXCIsIFwiPVwiLCB0YWJsZSkuc2VsZWN0KFwic3FsXCIpLiRjYXN0VG8oKS5leGVjdXRlKCk7XG4gICAgY29uc3QgYXV0b0luY3JlbWVudENvbCA9IGNyZWF0ZVNxbFswXT8uc3FsPy5zcGxpdCgvW1xcKFxcKSxdLyk/LmZpbmQoKGl0KSA9PiBpdC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwiYXV0b2luY3JlbWVudFwiKSk/LnNwbGl0KC9cXHMrLyk/LlswXT8ucmVwbGFjZSgvW1wiYF0vZywgXCJcIik7XG4gICAgY29uc3QgY29sdW1ucyA9IGF3YWl0IGRiLnNlbGVjdEZyb20oXG4gICAgICBzcWxgcHJhZ21hX3RhYmxlX2luZm8oJHt0YWJsZX0pYC5hcyhcInRhYmxlX2luZm9cIilcbiAgICApLnNlbGVjdChbXCJuYW1lXCIsIFwidHlwZVwiLCBcIm5vdG51bGxcIiwgXCJkZmx0X3ZhbHVlXCJdKS5leGVjdXRlKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IHRhYmxlLFxuICAgICAgY29sdW1uczogY29sdW1ucy5tYXAoKGNvbCkgPT4gKHtcbiAgICAgICAgbmFtZTogY29sLm5hbWUsXG4gICAgICAgIGRhdGFUeXBlOiBjb2wudHlwZSxcbiAgICAgICAgaXNOdWxsYWJsZTogIWNvbC5ub3RudWxsLFxuICAgICAgICBpc0F1dG9JbmNyZW1lbnRpbmc6IGNvbC5uYW1lID09PSBhdXRvSW5jcmVtZW50Q29sLFxuICAgICAgICBoYXNEZWZhdWx0VmFsdWU6IGNvbC5kZmx0X3ZhbHVlICE9IG51bGxcbiAgICAgIH0pKSxcbiAgICAgIGlzVmlldzogdHJ1ZVxuICAgIH07XG4gIH1cbn1cbmNsYXNzIEJ1blNxbGl0ZVF1ZXJ5Q29tcGlsZXIgZXh0ZW5kcyBEZWZhdWx0UXVlcnlDb21waWxlciB7XG4gIGdldEN1cnJlbnRQYXJhbWV0ZXJQbGFjZWhvbGRlcigpIHtcbiAgICByZXR1cm4gXCI/XCI7XG4gIH1cbiAgZ2V0TGVmdElkZW50aWZpZXJXcmFwcGVyKCkge1xuICAgIHJldHVybiAnXCInO1xuICB9XG4gIGdldFJpZ2h0SWRlbnRpZmllcldyYXBwZXIoKSB7XG4gICAgcmV0dXJuICdcIic7XG4gIH1cbiAgZ2V0QXV0b0luY3JlbWVudCgpIHtcbiAgICByZXR1cm4gXCJhdXRvaW5jcmVtZW50XCI7XG4gIH1cbn1cbmNsYXNzIEJ1blNxbGl0ZURpYWxlY3Qge1xuICAjY29uZmlnO1xuICBjb25zdHJ1Y3Rvcihjb25maWcpIHtcbiAgICB0aGlzLiNjb25maWcgPSB7IC4uLmNvbmZpZyB9O1xuICB9XG4gIGNyZWF0ZURyaXZlcigpIHtcbiAgICByZXR1cm4gbmV3IEJ1blNxbGl0ZURyaXZlcih0aGlzLiNjb25maWcpO1xuICB9XG4gIGNyZWF0ZVF1ZXJ5Q29tcGlsZXIoKSB7XG4gICAgcmV0dXJuIG5ldyBCdW5TcWxpdGVRdWVyeUNvbXBpbGVyKCk7XG4gIH1cbiAgY3JlYXRlQWRhcHRlcigpIHtcbiAgICByZXR1cm4gbmV3IEJ1blNxbGl0ZUFkYXB0ZXIoKTtcbiAgfVxuICBjcmVhdGVJbnRyb3NwZWN0b3IoZGIpIHtcbiAgICByZXR1cm4gbmV3IEJ1blNxbGl0ZUludHJvc3BlY3RvcihkYik7XG4gIH1cbn1cblxuZXhwb3J0IHsgQnVuU3FsaXRlQWRhcHRlciwgQnVuU3FsaXRlRGlhbGVjdCwgQnVuU3FsaXRlRHJpdmVyLCBCdW5TcWxpdGVJbnRyb3NwZWN0b3IsIEJ1blNxbGl0ZVF1ZXJ5Q29tcGlsZXIgfTtcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/chunks/bun-sqlite-dialect.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/cookies/index.mjs":
/*!*************************************************************!*\
  !*** ../../node_modules/better-auth/dist/cookies/index.mjs ***!
  \*************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createCookieGetter: () => (/* binding */ createCookieGetter),\n/* harmony export */   deleteSessionCookie: () => (/* binding */ deleteSessionCookie),\n/* harmony export */   getCookieCache: () => (/* binding */ getCookieCache),\n/* harmony export */   getCookies: () => (/* binding */ getCookies),\n/* harmony export */   getSessionCookie: () => (/* binding */ getSessionCookie),\n/* harmony export */   parseCookies: () => (/* binding */ parseCookies),\n/* harmony export */   parseSetCookieHeader: () => (/* binding */ parseSetCookieHeader),\n/* harmony export */   setCookieCache: () => (/* binding */ setCookieCache),\n/* harmony export */   setCookieToHeader: () => (/* binding */ setCookieToHeader),\n/* harmony export */   setSessionCookie: () => (/* binding */ setSessionCookie)\n/* harmony export */ });\n/* harmony import */ var _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../shared/better-auth.DdzSJf-n.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs\");\n/* harmony import */ var _shared_better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../shared/better-auth.CW6D9eSx.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.CW6D9eSx.mjs\");\n/* harmony import */ var _shared_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../shared/better-auth.8zoxzg-F.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs\");\n/* harmony import */ var _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @better-auth/utils/base64 */ \"(rsc)/../../node_modules/@better-auth/utils/dist/base64.mjs\");\n/* harmony import */ var _better_auth_utils_hmac__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @better-auth/utils/hmac */ \"(rsc)/../../node_modules/@better-auth/utils/dist/hmac.mjs\");\n/* harmony import */ var _shared_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../shared/better-auth.tB5eU6EY.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.tB5eU6EY.mjs\");\n/* harmony import */ var _shared_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../shared/better-auth.VTXNLFMT.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.VTXNLFMT.mjs\");\n/* harmony import */ var _better_auth_utils_binary__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @better-auth/utils/binary */ \"(rsc)/../../node_modules/@better-auth/utils/dist/binary.mjs\");\n\n\n\n\n\n\n\n\n\nconst createTime = (value, format) => {\n  const toMilliseconds = () => {\n    switch (format) {\n      case \"ms\":\n        return value;\n      case \"s\":\n        return value * 1e3;\n      case \"m\":\n        return value * 1e3 * 60;\n      case \"h\":\n        return value * 1e3 * 60 * 60;\n      case \"d\":\n        return value * 1e3 * 60 * 60 * 24;\n      case \"w\":\n        return value * 1e3 * 60 * 60 * 24 * 7;\n      case \"y\":\n        return value * 1e3 * 60 * 60 * 24 * 365;\n    }\n  };\n  const time = {\n    t: `${value}${format}`,\n    value,\n    tFormat: format,\n    toMilliseconds,\n    toSeconds: () => time.toMilliseconds() / 1e3,\n    toMinutes: () => time.toSeconds() / 60,\n    toHours: () => time.toMinutes() / 60,\n    toDays: () => time.toHours() / 24,\n    toWeeks: () => time.toDays() / 7,\n    toYears: () => time.toDays() / 365,\n    getDate: () => new Date(Date.now() + time.toMilliseconds()),\n    add: (other) => {\n      const otherMs = typeof other === \"string\" ? parseTime(other).toMilliseconds() : other.toMilliseconds();\n      return createTime(time.toMilliseconds() + otherMs, \"ms\");\n    },\n    subtract: (other) => {\n      const otherMs = typeof other === \"string\" ? parseTime(other).toMilliseconds() : other.toMilliseconds();\n      return createTime(time.toMilliseconds() - otherMs, \"ms\");\n    },\n    multiply: (factor) => createTime(time.toMilliseconds() * factor, \"ms\"),\n    divide: (divisor) => createTime(time.toMilliseconds() / divisor, \"ms\"),\n    equals: (other) => {\n      const otherMs = typeof other === \"string\" ? parseTime(other).toMilliseconds() : other.toMilliseconds();\n      return time.toMilliseconds() === otherMs;\n    },\n    lessThan: (other) => {\n      const otherMs = typeof other === \"string\" ? parseTime(other).toMilliseconds() : other.toMilliseconds();\n      return time.toMilliseconds() < otherMs;\n    },\n    greaterThan: (other) => {\n      const otherMs = typeof other === \"string\" ? parseTime(other).toMilliseconds() : other.toMilliseconds();\n      return time.toMilliseconds() > otherMs;\n    },\n    format: (pattern) => {\n      const date = time.getDate();\n      return pattern.replace(/YYYY|MM|DD|HH|mm|ss/g, (match) => {\n        switch (match) {\n          case \"YYYY\":\n            return date.getFullYear().toString();\n          case \"MM\":\n            return (date.getMonth() + 1).toString().padStart(2, \"0\");\n          case \"DD\":\n            return date.getDate().toString().padStart(2, \"0\");\n          case \"HH\":\n            return date.getHours().toString().padStart(2, \"0\");\n          case \"mm\":\n            return date.getMinutes().toString().padStart(2, \"0\");\n          case \"ss\":\n            return date.getSeconds().toString().padStart(2, \"0\");\n          default:\n            return match;\n        }\n      });\n    },\n    fromNow: () => {\n      const ms = time.toMilliseconds();\n      if (ms < 0) return time.ago();\n      if (ms < 1e3) return \"in a few seconds\";\n      if (ms < 6e4) return `in ${Math.round(ms / 1e3)} seconds`;\n      if (ms < 36e5) return `in ${Math.round(ms / 6e4)} minutes`;\n      if (ms < 864e5) return `in ${Math.round(ms / 36e5)} hours`;\n      if (ms < 6048e5) return `in ${Math.round(ms / 864e5)} days`;\n      if (ms < 26298e5) return `in ${Math.round(ms / 6048e5)} weeks`;\n      if (ms < 315576e5) return `in ${Math.round(ms / 26298e5)} months`;\n      return `in ${Math.round(ms / 315576e5)} years`;\n    },\n    ago: () => {\n      const ms = -time.toMilliseconds();\n      if (ms < 0) return time.fromNow();\n      if (ms < 1e3) return \"a few seconds ago\";\n      if (ms < 6e4) return `${Math.round(ms / 1e3)} seconds ago`;\n      if (ms < 36e5) return `${Math.round(ms / 6e4)} minutes ago`;\n      if (ms < 864e5) return `${Math.round(ms / 36e5)} hours ago`;\n      if (ms < 6048e5) return `${Math.round(ms / 864e5)} days ago`;\n      if (ms < 26298e5) return `${Math.round(ms / 6048e5)} weeks ago`;\n      if (ms < 315576e5) return `${Math.round(ms / 26298e5)} months ago`;\n      return `${Math.round(ms / 315576e5)} years ago`;\n    }\n  };\n  return time;\n};\nconst parseTime = (time) => {\n  const match = time.match(/^(\\d+)(ms|s|m|h|d|w|y)$/);\n  if (!match) throw new Error(\"Invalid time format\");\n  return createTime(parseInt(match[1]), match[2]);\n};\n\nfunction parseSetCookieHeader(setCookie) {\n  const cookies = /* @__PURE__ */ new Map();\n  const cookieArray = setCookie.split(\", \");\n  cookieArray.forEach((cookieString) => {\n    const parts = cookieString.split(\";\").map((part) => part.trim());\n    const [nameValue, ...attributes] = parts;\n    const [name, ...valueParts] = nameValue.split(\"=\");\n    const value = valueParts.join(\"=\");\n    if (!name || value === void 0) {\n      return;\n    }\n    const attrObj = { value };\n    attributes.forEach((attribute) => {\n      const [attrName, ...attrValueParts] = attribute.split(\"=\");\n      const attrValue = attrValueParts.join(\"=\");\n      const normalizedAttrName = attrName.trim().toLowerCase();\n      switch (normalizedAttrName) {\n        case \"max-age\":\n          attrObj[\"max-age\"] = attrValue ? parseInt(attrValue.trim(), 10) : void 0;\n          break;\n        case \"expires\":\n          attrObj.expires = attrValue ? new Date(attrValue.trim()) : void 0;\n          break;\n        case \"domain\":\n          attrObj.domain = attrValue ? attrValue.trim() : void 0;\n          break;\n        case \"path\":\n          attrObj.path = attrValue ? attrValue.trim() : void 0;\n          break;\n        case \"secure\":\n          attrObj.secure = true;\n          break;\n        case \"httponly\":\n          attrObj.httponly = true;\n          break;\n        case \"samesite\":\n          attrObj.samesite = attrValue ? attrValue.trim().toLowerCase() : void 0;\n          break;\n        default:\n          attrObj[normalizedAttrName] = attrValue ? attrValue.trim() : true;\n          break;\n      }\n    });\n    cookies.set(name, attrObj);\n  });\n  return cookies;\n}\nfunction setCookieToHeader(headers) {\n  return (context) => {\n    const setCookieHeader = context.response.headers.get(\"set-cookie\");\n    if (!setCookieHeader) {\n      return;\n    }\n    const cookieMap = /* @__PURE__ */ new Map();\n    const existingCookiesHeader = headers.get(\"cookie\") || \"\";\n    existingCookiesHeader.split(\";\").forEach((cookie) => {\n      const [name, ...rest] = cookie.trim().split(\"=\");\n      if (name && rest.length > 0) {\n        cookieMap.set(name, rest.join(\"=\"));\n      }\n    });\n    const setCookieHeaders = setCookieHeader.split(\",\");\n    setCookieHeaders.forEach((header) => {\n      const cookies = parseSetCookieHeader(header);\n      cookies.forEach((value, name) => {\n        cookieMap.set(name, value.value);\n      });\n    });\n    const updatedCookies = Array.from(cookieMap.entries()).map(([name, value]) => `${name}=${value}`).join(\"; \");\n    headers.set(\"cookie\", updatedCookies);\n  };\n}\n\nfunction createCookieGetter(options) {\n  const secure = options.advanced?.useSecureCookies !== void 0 ? options.advanced?.useSecureCookies : options.baseURL !== void 0 ? options.baseURL.startsWith(\"https://\") ? true : false : _shared_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_2__.a;\n  const secureCookiePrefix = secure ? \"__Secure-\" : \"\";\n  const crossSubdomainEnabled = !!options.advanced?.crossSubDomainCookies?.enabled;\n  const domain = crossSubdomainEnabled ? options.advanced?.crossSubDomainCookies?.domain || (options.baseURL ? new URL(options.baseURL).hostname : void 0) : void 0;\n  if (crossSubdomainEnabled && !domain) {\n    throw new _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_0__.B(\n      \"baseURL is required when crossSubdomainCookies are enabled\"\n    );\n  }\n  function createCookie(cookieName, overrideAttributes = {}) {\n    const prefix = options.advanced?.cookiePrefix || \"better-auth\";\n    const name = options.advanced?.cookies?.[cookieName]?.name || `${prefix}.${cookieName}`;\n    const attributes = options.advanced?.cookies?.[cookieName]?.attributes;\n    return {\n      name: `${secureCookiePrefix}${name}`,\n      attributes: {\n        secure: !!secureCookiePrefix,\n        sameSite: \"lax\",\n        path: \"/\",\n        httpOnly: true,\n        ...crossSubdomainEnabled ? { domain } : {},\n        ...options.advanced?.defaultCookieAttributes,\n        ...overrideAttributes,\n        ...attributes\n      }\n    };\n  }\n  return createCookie;\n}\nfunction getCookies(options) {\n  const createCookie = createCookieGetter(options);\n  const sessionMaxAge = options.session?.expiresIn || createTime(7, \"d\").toSeconds();\n  const sessionToken = createCookie(\"session_token\", {\n    maxAge: sessionMaxAge\n  });\n  const sessionData = createCookie(\"session_data\", {\n    maxAge: options.session?.cookieCache?.maxAge || 60 * 5\n  });\n  const dontRememberToken = createCookie(\"dont_remember\");\n  return {\n    sessionToken: {\n      name: sessionToken.name,\n      options: sessionToken.attributes\n    },\n    /**\n     * This cookie is used to store the session data in the cookie\n     * This is useful for when you want to cache the session in the cookie\n     */\n    sessionData: {\n      name: sessionData.name,\n      options: sessionData.attributes\n    },\n    dontRememberToken: {\n      name: dontRememberToken.name,\n      options: dontRememberToken.attributes\n    }\n  };\n}\nasync function setCookieCache(ctx, session) {\n  const shouldStoreSessionDataInCookie = ctx.context.options.session?.cookieCache?.enabled;\n  if (shouldStoreSessionDataInCookie) {\n    const filteredSession = Object.entries(session.session).reduce(\n      (acc, [key, value]) => {\n        const fieldConfig = ctx.context.options.session?.additionalFields?.[key];\n        if (!fieldConfig || fieldConfig.returned !== false) {\n          acc[key] = value;\n        }\n        return acc;\n      },\n      {}\n    );\n    const sessionData = { session: filteredSession, user: session.user };\n    const expiresAtDate = (0,_shared_better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_1__.g)(\n      ctx.context.authCookies.sessionData.options.maxAge || 60,\n      \"sec\"\n    ).getTime();\n    const data = _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_3__.base64Url.encode(\n      JSON.stringify({\n        session: sessionData,\n        expiresAt: expiresAtDate,\n        signature: await (0,_better_auth_utils_hmac__WEBPACK_IMPORTED_MODULE_4__.createHMAC)(\"SHA-256\", \"base64urlnopad\").sign(\n          ctx.context.secret,\n          JSON.stringify({\n            ...sessionData,\n            expiresAt: expiresAtDate\n          })\n        )\n      }),\n      {\n        padding: false\n      }\n    );\n    if (data.length > 4093) {\n      throw new _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_0__.B(\n        \"Session data is too large to store in the cookie. Please disable session cookie caching or reduce the size of the session data\"\n      );\n    }\n    ctx.setCookie(\n      ctx.context.authCookies.sessionData.name,\n      data,\n      ctx.context.authCookies.sessionData.options\n    );\n  }\n}\nasync function setSessionCookie(ctx, session, dontRememberMe, overrides) {\n  const dontRememberMeCookie = await ctx.getSignedCookie(\n    ctx.context.authCookies.dontRememberToken.name,\n    ctx.context.secret\n  );\n  dontRememberMe = dontRememberMe !== void 0 ? dontRememberMe : !!dontRememberMeCookie;\n  const options = ctx.context.authCookies.sessionToken.options;\n  const maxAge = dontRememberMe ? void 0 : ctx.context.sessionConfig.expiresIn;\n  await ctx.setSignedCookie(\n    ctx.context.authCookies.sessionToken.name,\n    session.session.token,\n    ctx.context.secret,\n    {\n      ...options,\n      maxAge,\n      ...overrides\n    }\n  );\n  if (dontRememberMe) {\n    await ctx.setSignedCookie(\n      ctx.context.authCookies.dontRememberToken.name,\n      \"true\",\n      ctx.context.secret,\n      ctx.context.authCookies.dontRememberToken.options\n    );\n  }\n  await setCookieCache(ctx, session);\n  ctx.context.setNewSession(session);\n  if (ctx.context.options.secondaryStorage) {\n    await ctx.context.secondaryStorage?.set(\n      session.session.token,\n      JSON.stringify({\n        user: session.user,\n        session: session.session\n      }),\n      Math.floor(\n        (new Date(session.session.expiresAt).getTime() - Date.now()) / 1e3\n      )\n    );\n  }\n}\nfunction deleteSessionCookie(ctx, skipDontRememberMe) {\n  ctx.setCookie(ctx.context.authCookies.sessionToken.name, \"\", {\n    ...ctx.context.authCookies.sessionToken.options,\n    maxAge: 0\n  });\n  ctx.setCookie(ctx.context.authCookies.sessionData.name, \"\", {\n    ...ctx.context.authCookies.sessionData.options,\n    maxAge: 0\n  });\n  if (!skipDontRememberMe) {\n    ctx.setCookie(ctx.context.authCookies.dontRememberToken.name, \"\", {\n      ...ctx.context.authCookies.dontRememberToken.options,\n      maxAge: 0\n    });\n  }\n}\nfunction parseCookies(cookieHeader) {\n  const cookies = cookieHeader.split(\"; \");\n  const cookieMap = /* @__PURE__ */ new Map();\n  cookies.forEach((cookie) => {\n    const [name, value] = cookie.split(\"=\");\n    cookieMap.set(name, value);\n  });\n  return cookieMap;\n}\nconst getSessionCookie = (request, config) => {\n  if (config?.cookiePrefix) {\n    if (config.cookieName) {\n      config.cookiePrefix = `${config.cookiePrefix}-`;\n    } else {\n      config.cookiePrefix = `${config.cookiePrefix}.`;\n    }\n  }\n  const headers = \"headers\" in request ? request.headers : request;\n  const req = request instanceof Request ? request : void 0;\n  (0,_shared_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_6__.a)(req?.url, config?.path, req);\n  const cookies = headers.get(\"cookie\");\n  if (!cookies) {\n    return null;\n  }\n  const { cookieName = \"session_token\", cookiePrefix = \"better-auth.\" } = config || {};\n  const name = `${cookiePrefix}${cookieName}`;\n  const secureCookieName = `__Secure-${name}`;\n  const parsedCookie = parseCookies(cookies);\n  const sessionToken = parsedCookie.get(name) || parsedCookie.get(secureCookieName);\n  if (sessionToken) {\n    return sessionToken;\n  }\n  return null;\n};\nconst getCookieCache = async (request, config) => {\n  const headers = request instanceof Headers ? request : request.headers;\n  const cookies = headers.get(\"cookie\");\n  if (!cookies) {\n    return null;\n  }\n  const { cookieName = \"session_data\", cookiePrefix = \"better-auth\" } = config || {};\n  const name = config?.isSecure !== void 0 ? config.isSecure ? `__Secure-${cookiePrefix}.${cookieName}` : `${cookiePrefix}.${cookieName}` : _shared_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_2__.a ? `__Secure-${cookiePrefix}.${cookieName}` : `${cookiePrefix}.${cookieName}`;\n  const parsedCookie = parseCookies(cookies);\n  const sessionData = parsedCookie.get(name);\n  if (sessionData) {\n    const sessionDataPayload = (0,_shared_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_5__.s)(_better_auth_utils_binary__WEBPACK_IMPORTED_MODULE_7__.binary.decode(_better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_3__.base64Url.decode(sessionData)));\n    if (!sessionDataPayload) {\n      return null;\n    }\n    const secret = config?.secret || _shared_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_2__.e.BETTER_AUTH_SECRET;\n    if (!secret) {\n      throw new _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_0__.B(\n        \"getCookieCache requires a secret to be provided. Either pass it as an option or set the BETTER_AUTH_SECRET environment variable\"\n      );\n    }\n    const isValid = await (0,_better_auth_utils_hmac__WEBPACK_IMPORTED_MODULE_4__.createHMAC)(\"SHA-256\", \"base64urlnopad\").verify(\n      secret,\n      JSON.stringify({\n        ...sessionDataPayload.session,\n        expiresAt: sessionDataPayload.expiresAt\n      }),\n      sessionDataPayload.signature\n    );\n    if (!isValid) {\n      return null;\n    }\n    return sessionDataPayload.session;\n  }\n  return null;\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3QvY29va2llcy9pbmRleC5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQTBFO0FBQ1I7QUFDZTtBQUMzQjtBQUNEO0FBQ21CO0FBQ0g7QUFDbEI7O0FBRW5EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLE1BQU0sRUFBRSxPQUFPO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLHNCQUFzQjtBQUN2RCxrQ0FBa0Msc0JBQXNCO0FBQ3hELG1DQUFtQyx1QkFBdUI7QUFDMUQsb0NBQW9DLHdCQUF3QjtBQUM1RCxxQ0FBcUMseUJBQXlCO0FBQzlELHNDQUFzQywwQkFBMEI7QUFDaEUsbUJBQW1CLDJCQUEyQjtBQUM5QyxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsc0JBQXNCO0FBQ3BELCtCQUErQixzQkFBc0I7QUFDckQsZ0NBQWdDLHVCQUF1QjtBQUN2RCxpQ0FBaUMsd0JBQXdCO0FBQ3pELGtDQUFrQyx5QkFBeUI7QUFDM0QsbUNBQW1DLDBCQUEwQjtBQUM3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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLDREQUE0RDtBQUN0RSwyRUFBMkUsYUFBYSxHQUFHLFdBQVcsT0FBTyxhQUFhLEdBQUcsV0FBVyxJQUFJLCtEQUFZLGVBQWUsYUFBYSxHQUFHLFdBQVcsT0FBTyxhQUFhLEdBQUcsV0FBVztBQUNwTztBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsbUVBQWEsQ0FBQyw2REFBTSxRQUFRLGdFQUFTO0FBQ3BFO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQywrREFBRztBQUN4QztBQUNBLGdCQUFnQiwrREFBZTtBQUMvQjtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsbUVBQVU7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUUwTCIsInNvdXJjZXMiOlsiL1VzZXJzL21pbGFuL0Rlc2t0b3AvQXBwcy9iZXR0ZXItYXV0aC9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9jb29raWVzL2luZGV4Lm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCIGFzIEJldHRlckF1dGhFcnJvciB9IGZyb20gJy4uL3NoYXJlZC9iZXR0ZXItYXV0aC5EZHpTSmYtbi5tanMnO1xuaW1wb3J0IHsgZyBhcyBnZXREYXRlIH0gZnJvbSAnLi4vc2hhcmVkL2JldHRlci1hdXRoLkNXNkQ5ZVN4Lm1qcyc7XG5pbXBvcnQgeyBhIGFzIGlzUHJvZHVjdGlvbiwgZSBhcyBlbnYgfSBmcm9tICcuLi9zaGFyZWQvYmV0dGVyLWF1dGguOHpveHpnLUYubWpzJztcbmltcG9ydCB7IGJhc2U2NFVybCB9IGZyb20gJ0BiZXR0ZXItYXV0aC91dGlscy9iYXNlNjQnO1xuaW1wb3J0IHsgY3JlYXRlSE1BQyB9IGZyb20gJ0BiZXR0ZXItYXV0aC91dGlscy9obWFjJztcbmltcG9ydCB7IHMgYXMgc2FmZUpTT05QYXJzZSB9IGZyb20gJy4uL3NoYXJlZC9iZXR0ZXItYXV0aC50QjVlVTZFWS5tanMnO1xuaW1wb3J0IHsgYSBhcyBnZXRCYXNlVVJMIH0gZnJvbSAnLi4vc2hhcmVkL2JldHRlci1hdXRoLlZUWE5MRk1ULm1qcyc7XG5pbXBvcnQgeyBiaW5hcnkgfSBmcm9tICdAYmV0dGVyLWF1dGgvdXRpbHMvYmluYXJ5JztcblxuY29uc3QgY3JlYXRlVGltZSA9ICh2YWx1ZSwgZm9ybWF0KSA9PiB7XG4gIGNvbnN0IHRvTWlsbGlzZWNvbmRzID0gKCkgPT4ge1xuICAgIHN3aXRjaCAoZm9ybWF0KSB7XG4gICAgICBjYXNlIFwibXNcIjpcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgY2FzZSBcInNcIjpcbiAgICAgICAgcmV0dXJuIHZhbHVlICogMWUzO1xuICAgICAgY2FzZSBcIm1cIjpcbiAgICAgICAgcmV0dXJuIHZhbHVlICogMWUzICogNjA7XG4gICAgICBjYXNlIFwiaFwiOlxuICAgICAgICByZXR1cm4gdmFsdWUgKiAxZTMgKiA2MCAqIDYwO1xuICAgICAgY2FzZSBcImRcIjpcbiAgICAgICAgcmV0dXJuIHZhbHVlICogMWUzICogNjAgKiA2MCAqIDI0O1xuICAgICAgY2FzZSBcIndcIjpcbiAgICAgICAgcmV0dXJuIHZhbHVlICogMWUzICogNjAgKiA2MCAqIDI0ICogNztcbiAgICAgIGNhc2UgXCJ5XCI6XG4gICAgICAgIHJldHVybiB2YWx1ZSAqIDFlMyAqIDYwICogNjAgKiAyNCAqIDM2NTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHRpbWUgPSB7XG4gICAgdDogYCR7dmFsdWV9JHtmb3JtYXR9YCxcbiAgICB2YWx1ZSxcbiAgICB0Rm9ybWF0OiBmb3JtYXQsXG4gICAgdG9NaWxsaXNlY29uZHMsXG4gICAgdG9TZWNvbmRzOiAoKSA9PiB0aW1lLnRvTWlsbGlzZWNvbmRzKCkgLyAxZTMsXG4gICAgdG9NaW51dGVzOiAoKSA9PiB0aW1lLnRvU2Vjb25kcygpIC8gNjAsXG4gICAgdG9Ib3VyczogKCkgPT4gdGltZS50b01pbnV0ZXMoKSAvIDYwLFxuICAgIHRvRGF5czogKCkgPT4gdGltZS50b0hvdXJzKCkgLyAyNCxcbiAgICB0b1dlZWtzOiAoKSA9PiB0aW1lLnRvRGF5cygpIC8gNyxcbiAgICB0b1llYXJzOiAoKSA9PiB0aW1lLnRvRGF5cygpIC8gMzY1LFxuICAgIGdldERhdGU6ICgpID0+IG5ldyBEYXRlKERhdGUubm93KCkgKyB0aW1lLnRvTWlsbGlzZWNvbmRzKCkpLFxuICAgIGFkZDogKG90aGVyKSA9PiB7XG4gICAgICBjb25zdCBvdGhlck1zID0gdHlwZW9mIG90aGVyID09PSBcInN0cmluZ1wiID8gcGFyc2VUaW1lKG90aGVyKS50b01pbGxpc2Vjb25kcygpIDogb3RoZXIudG9NaWxsaXNlY29uZHMoKTtcbiAgICAgIHJldHVybiBjcmVhdGVUaW1lKHRpbWUudG9NaWxsaXNlY29uZHMoKSArIG90aGVyTXMsIFwibXNcIik7XG4gICAgfSxcbiAgICBzdWJ0cmFjdDogKG90aGVyKSA9PiB7XG4gICAgICBjb25zdCBvdGhlck1zID0gdHlwZW9mIG90aGVyID09PSBcInN0cmluZ1wiID8gcGFyc2VUaW1lKG90aGVyKS50b01pbGxpc2Vjb25kcygpIDogb3RoZXIudG9NaWxsaXNlY29uZHMoKTtcbiAgICAgIHJldHVybiBjcmVhdGVUaW1lKHRpbWUudG9NaWxsaXNlY29uZHMoKSAtIG90aGVyTXMsIFwibXNcIik7XG4gICAgfSxcbiAgICBtdWx0aXBseTogKGZhY3RvcikgPT4gY3JlYXRlVGltZSh0aW1lLnRvTWlsbGlzZWNvbmRzKCkgKiBmYWN0b3IsIFwibXNcIiksXG4gICAgZGl2aWRlOiAoZGl2aXNvcikgPT4gY3JlYXRlVGltZSh0aW1lLnRvTWlsbGlzZWNvbmRzKCkgLyBkaXZpc29yLCBcIm1zXCIpLFxuICAgIGVxdWFsczogKG90aGVyKSA9PiB7XG4gICAgICBjb25zdCBvdGhlck1zID0gdHlwZW9mIG90aGVyID09PSBcInN0cmluZ1wiID8gcGFyc2VUaW1lKG90aGVyKS50b01pbGxpc2Vjb25kcygpIDogb3RoZXIudG9NaWxsaXNlY29uZHMoKTtcbiAgICAgIHJldHVybiB0aW1lLnRvTWlsbGlzZWNvbmRzKCkgPT09IG90aGVyTXM7XG4gICAgfSxcbiAgICBsZXNzVGhhbjogKG90aGVyKSA9PiB7XG4gICAgICBjb25zdCBvdGhlck1zID0gdHlwZW9mIG90aGVyID09PSBcInN0cmluZ1wiID8gcGFyc2VUaW1lKG90aGVyKS50b01pbGxpc2Vjb25kcygpIDogb3RoZXIudG9NaWxsaXNlY29uZHMoKTtcbiAgICAgIHJldHVybiB0aW1lLnRvTWlsbGlzZWNvbmRzKCkgPCBvdGhlck1zO1xuICAgIH0sXG4gICAgZ3JlYXRlclRoYW46IChvdGhlcikgPT4ge1xuICAgICAgY29uc3Qgb3RoZXJNcyA9IHR5cGVvZiBvdGhlciA9PT0gXCJzdHJpbmdcIiA/IHBhcnNlVGltZShvdGhlcikudG9NaWxsaXNlY29uZHMoKSA6IG90aGVyLnRvTWlsbGlzZWNvbmRzKCk7XG4gICAgICByZXR1cm4gdGltZS50b01pbGxpc2Vjb25kcygpID4gb3RoZXJNcztcbiAgICB9LFxuICAgIGZvcm1hdDogKHBhdHRlcm4pID0+IHtcbiAgICAgIGNvbnN0IGRhdGUgPSB0aW1lLmdldERhdGUoKTtcbiAgICAgIHJldHVybiBwYXR0ZXJuLnJlcGxhY2UoL1lZWVl8TU18RER8SEh8bW18c3MvZywgKG1hdGNoKSA9PiB7XG4gICAgICAgIHN3aXRjaCAobWF0Y2gpIHtcbiAgICAgICAgICBjYXNlIFwiWVlZWVwiOlxuICAgICAgICAgICAgcmV0dXJuIGRhdGUuZ2V0RnVsbFllYXIoKS50b1N0cmluZygpO1xuICAgICAgICAgIGNhc2UgXCJNTVwiOlxuICAgICAgICAgICAgcmV0dXJuIChkYXRlLmdldE1vbnRoKCkgKyAxKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsIFwiMFwiKTtcbiAgICAgICAgICBjYXNlIFwiRERcIjpcbiAgICAgICAgICAgIHJldHVybiBkYXRlLmdldERhdGUoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsIFwiMFwiKTtcbiAgICAgICAgICBjYXNlIFwiSEhcIjpcbiAgICAgICAgICAgIHJldHVybiBkYXRlLmdldEhvdXJzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCBcIjBcIik7XG4gICAgICAgICAgY2FzZSBcIm1tXCI6XG4gICAgICAgICAgICByZXR1cm4gZGF0ZS5nZXRNaW51dGVzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCBcIjBcIik7XG4gICAgICAgICAgY2FzZSBcInNzXCI6XG4gICAgICAgICAgICByZXR1cm4gZGF0ZS5nZXRTZWNvbmRzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCBcIjBcIik7XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBtYXRjaDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSxcbiAgICBmcm9tTm93OiAoKSA9PiB7XG4gICAgICBjb25zdCBtcyA9IHRpbWUudG9NaWxsaXNlY29uZHMoKTtcbiAgICAgIGlmIChtcyA8IDApIHJldHVybiB0aW1lLmFnbygpO1xuICAgICAgaWYgKG1zIDwgMWUzKSByZXR1cm4gXCJpbiBhIGZldyBzZWNvbmRzXCI7XG4gICAgICBpZiAobXMgPCA2ZTQpIHJldHVybiBgaW4gJHtNYXRoLnJvdW5kKG1zIC8gMWUzKX0gc2Vjb25kc2A7XG4gICAgICBpZiAobXMgPCAzNmU1KSByZXR1cm4gYGluICR7TWF0aC5yb3VuZChtcyAvIDZlNCl9IG1pbnV0ZXNgO1xuICAgICAgaWYgKG1zIDwgODY0ZTUpIHJldHVybiBgaW4gJHtNYXRoLnJvdW5kKG1zIC8gMzZlNSl9IGhvdXJzYDtcbiAgICAgIGlmIChtcyA8IDYwNDhlNSkgcmV0dXJuIGBpbiAke01hdGgucm91bmQobXMgLyA4NjRlNSl9IGRheXNgO1xuICAgICAgaWYgKG1zIDwgMjYyOThlNSkgcmV0dXJuIGBpbiAke01hdGgucm91bmQobXMgLyA2MDQ4ZTUpfSB3ZWVrc2A7XG4gICAgICBpZiAobXMgPCAzMTU1NzZlNSkgcmV0dXJuIGBpbiAke01hdGgucm91bmQobXMgLyAyNjI5OGU1KX0gbW9udGhzYDtcbiAgICAgIHJldHVybiBgaW4gJHtNYXRoLnJvdW5kKG1zIC8gMzE1NTc2ZTUpfSB5ZWFyc2A7XG4gICAgfSxcbiAgICBhZ286ICgpID0+IHtcbiAgICAgIGNvbnN0IG1zID0gLXRpbWUudG9NaWxsaXNlY29uZHMoKTtcbiAgICAgIGlmIChtcyA8IDApIHJldHVybiB0aW1lLmZyb21Ob3coKTtcbiAgICAgIGlmIChtcyA8IDFlMykgcmV0dXJuIFwiYSBmZXcgc2Vjb25kcyBhZ29cIjtcbiAgICAgIGlmIChtcyA8IDZlNCkgcmV0dXJuIGAke01hdGgucm91bmQobXMgLyAxZTMpfSBzZWNvbmRzIGFnb2A7XG4gICAgICBpZiAobXMgPCAzNmU1KSByZXR1cm4gYCR7TWF0aC5yb3VuZChtcyAvIDZlNCl9IG1pbnV0ZXMgYWdvYDtcbiAgICAgIGlmIChtcyA8IDg2NGU1KSByZXR1cm4gYCR7TWF0aC5yb3VuZChtcyAvIDM2ZTUpfSBob3VycyBhZ29gO1xuICAgICAgaWYgKG1zIDwgNjA0OGU1KSByZXR1cm4gYCR7TWF0aC5yb3VuZChtcyAvIDg2NGU1KX0gZGF5cyBhZ29gO1xuICAgICAgaWYgKG1zIDwgMjYyOThlNSkgcmV0dXJuIGAke01hdGgucm91bmQobXMgLyA2MDQ4ZTUpfSB3ZWVrcyBhZ29gO1xuICAgICAgaWYgKG1zIDwgMzE1NTc2ZTUpIHJldHVybiBgJHtNYXRoLnJvdW5kKG1zIC8gMjYyOThlNSl9IG1vbnRocyBhZ29gO1xuICAgICAgcmV0dXJuIGAke01hdGgucm91bmQobXMgLyAzMTU1NzZlNSl9IHllYXJzIGFnb2A7XG4gICAgfVxuICB9O1xuICByZXR1cm4gdGltZTtcbn07XG5jb25zdCBwYXJzZVRpbWUgPSAodGltZSkgPT4ge1xuICBjb25zdCBtYXRjaCA9IHRpbWUubWF0Y2goL14oXFxkKykobXN8c3xtfGh8ZHx3fHkpJC8pO1xuICBpZiAoIW1hdGNoKSB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHRpbWUgZm9ybWF0XCIpO1xuICByZXR1cm4gY3JlYXRlVGltZShwYXJzZUludChtYXRjaFsxXSksIG1hdGNoWzJdKTtcbn07XG5cbmZ1bmN0aW9uIHBhcnNlU2V0Q29va2llSGVhZGVyKHNldENvb2tpZSkge1xuICBjb25zdCBjb29raWVzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgY29uc3QgY29va2llQXJyYXkgPSBzZXRDb29raWUuc3BsaXQoXCIsIFwiKTtcbiAgY29va2llQXJyYXkuZm9yRWFjaCgoY29va2llU3RyaW5nKSA9PiB7XG4gICAgY29uc3QgcGFydHMgPSBjb29raWVTdHJpbmcuc3BsaXQoXCI7XCIpLm1hcCgocGFydCkgPT4gcGFydC50cmltKCkpO1xuICAgIGNvbnN0IFtuYW1lVmFsdWUsIC4uLmF0dHJpYnV0ZXNdID0gcGFydHM7XG4gICAgY29uc3QgW25hbWUsIC4uLnZhbHVlUGFydHNdID0gbmFtZVZhbHVlLnNwbGl0KFwiPVwiKTtcbiAgICBjb25zdCB2YWx1ZSA9IHZhbHVlUGFydHMuam9pbihcIj1cIik7XG4gICAgaWYgKCFuYW1lIHx8IHZhbHVlID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgYXR0ck9iaiA9IHsgdmFsdWUgfTtcbiAgICBhdHRyaWJ1dGVzLmZvckVhY2goKGF0dHJpYnV0ZSkgPT4ge1xuICAgICAgY29uc3QgW2F0dHJOYW1lLCAuLi5hdHRyVmFsdWVQYXJ0c10gPSBhdHRyaWJ1dGUuc3BsaXQoXCI9XCIpO1xuICAgICAgY29uc3QgYXR0clZhbHVlID0gYXR0clZhbHVlUGFydHMuam9pbihcIj1cIik7XG4gICAgICBjb25zdCBub3JtYWxpemVkQXR0ck5hbWUgPSBhdHRyTmFtZS50cmltKCkudG9Mb3dlckNhc2UoKTtcbiAgICAgIHN3aXRjaCAobm9ybWFsaXplZEF0dHJOYW1lKSB7XG4gICAgICAgIGNhc2UgXCJtYXgtYWdlXCI6XG4gICAgICAgICAgYXR0ck9ialtcIm1heC1hZ2VcIl0gPSBhdHRyVmFsdWUgPyBwYXJzZUludChhdHRyVmFsdWUudHJpbSgpLCAxMCkgOiB2b2lkIDA7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJleHBpcmVzXCI6XG4gICAgICAgICAgYXR0ck9iai5leHBpcmVzID0gYXR0clZhbHVlID8gbmV3IERhdGUoYXR0clZhbHVlLnRyaW0oKSkgOiB2b2lkIDA7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJkb21haW5cIjpcbiAgICAgICAgICBhdHRyT2JqLmRvbWFpbiA9IGF0dHJWYWx1ZSA/IGF0dHJWYWx1ZS50cmltKCkgOiB2b2lkIDA7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJwYXRoXCI6XG4gICAgICAgICAgYXR0ck9iai5wYXRoID0gYXR0clZhbHVlID8gYXR0clZhbHVlLnRyaW0oKSA6IHZvaWQgMDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInNlY3VyZVwiOlxuICAgICAgICAgIGF0dHJPYmouc2VjdXJlID0gdHJ1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImh0dHBvbmx5XCI6XG4gICAgICAgICAgYXR0ck9iai5odHRwb25seSA9IHRydWU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJzYW1lc2l0ZVwiOlxuICAgICAgICAgIGF0dHJPYmouc2FtZXNpdGUgPSBhdHRyVmFsdWUgPyBhdHRyVmFsdWUudHJpbSgpLnRvTG93ZXJDYXNlKCkgOiB2b2lkIDA7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgYXR0ck9ialtub3JtYWxpemVkQXR0ck5hbWVdID0gYXR0clZhbHVlID8gYXR0clZhbHVlLnRyaW0oKSA6IHRydWU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfSk7XG4gICAgY29va2llcy5zZXQobmFtZSwgYXR0ck9iaik7XG4gIH0pO1xuICByZXR1cm4gY29va2llcztcbn1cbmZ1bmN0aW9uIHNldENvb2tpZVRvSGVhZGVyKGhlYWRlcnMpIHtcbiAgcmV0dXJuIChjb250ZXh0KSA9PiB7XG4gICAgY29uc3Qgc2V0Q29va2llSGVhZGVyID0gY29udGV4dC5yZXNwb25zZS5oZWFkZXJzLmdldChcInNldC1jb29raWVcIik7XG4gICAgaWYgKCFzZXRDb29raWVIZWFkZXIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgY29va2llTWFwID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgICBjb25zdCBleGlzdGluZ0Nvb2tpZXNIZWFkZXIgPSBoZWFkZXJzLmdldChcImNvb2tpZVwiKSB8fCBcIlwiO1xuICAgIGV4aXN0aW5nQ29va2llc0hlYWRlci5zcGxpdChcIjtcIikuZm9yRWFjaCgoY29va2llKSA9PiB7XG4gICAgICBjb25zdCBbbmFtZSwgLi4ucmVzdF0gPSBjb29raWUudHJpbSgpLnNwbGl0KFwiPVwiKTtcbiAgICAgIGlmIChuYW1lICYmIHJlc3QubGVuZ3RoID4gMCkge1xuICAgICAgICBjb29raWVNYXAuc2V0KG5hbWUsIHJlc3Quam9pbihcIj1cIikpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGNvbnN0IHNldENvb2tpZUhlYWRlcnMgPSBzZXRDb29raWVIZWFkZXIuc3BsaXQoXCIsXCIpO1xuICAgIHNldENvb2tpZUhlYWRlcnMuZm9yRWFjaCgoaGVhZGVyKSA9PiB7XG4gICAgICBjb25zdCBjb29raWVzID0gcGFyc2VTZXRDb29raWVIZWFkZXIoaGVhZGVyKTtcbiAgICAgIGNvb2tpZXMuZm9yRWFjaCgodmFsdWUsIG5hbWUpID0+IHtcbiAgICAgICAgY29va2llTWFwLnNldChuYW1lLCB2YWx1ZS52YWx1ZSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBjb25zdCB1cGRhdGVkQ29va2llcyA9IEFycmF5LmZyb20oY29va2llTWFwLmVudHJpZXMoKSkubWFwKChbbmFtZSwgdmFsdWVdKSA9PiBgJHtuYW1lfT0ke3ZhbHVlfWApLmpvaW4oXCI7IFwiKTtcbiAgICBoZWFkZXJzLnNldChcImNvb2tpZVwiLCB1cGRhdGVkQ29va2llcyk7XG4gIH07XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUNvb2tpZUdldHRlcihvcHRpb25zKSB7XG4gIGNvbnN0IHNlY3VyZSA9IG9wdGlvbnMuYWR2YW5jZWQ/LnVzZVNlY3VyZUNvb2tpZXMgIT09IHZvaWQgMCA/IG9wdGlvbnMuYWR2YW5jZWQ/LnVzZVNlY3VyZUNvb2tpZXMgOiBvcHRpb25zLmJhc2VVUkwgIT09IHZvaWQgMCA/IG9wdGlvbnMuYmFzZVVSTC5zdGFydHNXaXRoKFwiaHR0cHM6Ly9cIikgPyB0cnVlIDogZmFsc2UgOiBpc1Byb2R1Y3Rpb247XG4gIGNvbnN0IHNlY3VyZUNvb2tpZVByZWZpeCA9IHNlY3VyZSA/IFwiX19TZWN1cmUtXCIgOiBcIlwiO1xuICBjb25zdCBjcm9zc1N1YmRvbWFpbkVuYWJsZWQgPSAhIW9wdGlvbnMuYWR2YW5jZWQ/LmNyb3NzU3ViRG9tYWluQ29va2llcz8uZW5hYmxlZDtcbiAgY29uc3QgZG9tYWluID0gY3Jvc3NTdWJkb21haW5FbmFibGVkID8gb3B0aW9ucy5hZHZhbmNlZD8uY3Jvc3NTdWJEb21haW5Db29raWVzPy5kb21haW4gfHwgKG9wdGlvbnMuYmFzZVVSTCA/IG5ldyBVUkwob3B0aW9ucy5iYXNlVVJMKS5ob3N0bmFtZSA6IHZvaWQgMCkgOiB2b2lkIDA7XG4gIGlmIChjcm9zc1N1YmRvbWFpbkVuYWJsZWQgJiYgIWRvbWFpbikge1xuICAgIHRocm93IG5ldyBCZXR0ZXJBdXRoRXJyb3IoXG4gICAgICBcImJhc2VVUkwgaXMgcmVxdWlyZWQgd2hlbiBjcm9zc1N1YmRvbWFpbkNvb2tpZXMgYXJlIGVuYWJsZWRcIlxuICAgICk7XG4gIH1cbiAgZnVuY3Rpb24gY3JlYXRlQ29va2llKGNvb2tpZU5hbWUsIG92ZXJyaWRlQXR0cmlidXRlcyA9IHt9KSB7XG4gICAgY29uc3QgcHJlZml4ID0gb3B0aW9ucy5hZHZhbmNlZD8uY29va2llUHJlZml4IHx8IFwiYmV0dGVyLWF1dGhcIjtcbiAgICBjb25zdCBuYW1lID0gb3B0aW9ucy5hZHZhbmNlZD8uY29va2llcz8uW2Nvb2tpZU5hbWVdPy5uYW1lIHx8IGAke3ByZWZpeH0uJHtjb29raWVOYW1lfWA7XG4gICAgY29uc3QgYXR0cmlidXRlcyA9IG9wdGlvbnMuYWR2YW5jZWQ/LmNvb2tpZXM/Lltjb29raWVOYW1lXT8uYXR0cmlidXRlcztcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogYCR7c2VjdXJlQ29va2llUHJlZml4fSR7bmFtZX1gLFxuICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICBzZWN1cmU6ICEhc2VjdXJlQ29va2llUHJlZml4LFxuICAgICAgICBzYW1lU2l0ZTogXCJsYXhcIixcbiAgICAgICAgcGF0aDogXCIvXCIsXG4gICAgICAgIGh0dHBPbmx5OiB0cnVlLFxuICAgICAgICAuLi5jcm9zc1N1YmRvbWFpbkVuYWJsZWQgPyB7IGRvbWFpbiB9IDoge30sXG4gICAgICAgIC4uLm9wdGlvbnMuYWR2YW5jZWQ/LmRlZmF1bHRDb29raWVBdHRyaWJ1dGVzLFxuICAgICAgICAuLi5vdmVycmlkZUF0dHJpYnV0ZXMsXG4gICAgICAgIC4uLmF0dHJpYnV0ZXNcbiAgICAgIH1cbiAgICB9O1xuICB9XG4gIHJldHVybiBjcmVhdGVDb29raWU7XG59XG5mdW5jdGlvbiBnZXRDb29raWVzKG9wdGlvbnMpIHtcbiAgY29uc3QgY3JlYXRlQ29va2llID0gY3JlYXRlQ29va2llR2V0dGVyKG9wdGlvbnMpO1xuICBjb25zdCBzZXNzaW9uTWF4QWdlID0gb3B0aW9ucy5zZXNzaW9uPy5leHBpcmVzSW4gfHwgY3JlYXRlVGltZSg3LCBcImRcIikudG9TZWNvbmRzKCk7XG4gIGNvbnN0IHNlc3Npb25Ub2tlbiA9IGNyZWF0ZUNvb2tpZShcInNlc3Npb25fdG9rZW5cIiwge1xuICAgIG1heEFnZTogc2Vzc2lvbk1heEFnZVxuICB9KTtcbiAgY29uc3Qgc2Vzc2lvbkRhdGEgPSBjcmVhdGVDb29raWUoXCJzZXNzaW9uX2RhdGFcIiwge1xuICAgIG1heEFnZTogb3B0aW9ucy5zZXNzaW9uPy5jb29raWVDYWNoZT8ubWF4QWdlIHx8IDYwICogNVxuICB9KTtcbiAgY29uc3QgZG9udFJlbWVtYmVyVG9rZW4gPSBjcmVhdGVDb29raWUoXCJkb250X3JlbWVtYmVyXCIpO1xuICByZXR1cm4ge1xuICAgIHNlc3Npb25Ub2tlbjoge1xuICAgICAgbmFtZTogc2Vzc2lvblRva2VuLm5hbWUsXG4gICAgICBvcHRpb25zOiBzZXNzaW9uVG9rZW4uYXR0cmlidXRlc1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogVGhpcyBjb29raWUgaXMgdXNlZCB0byBzdG9yZSB0aGUgc2Vzc2lvbiBkYXRhIGluIHRoZSBjb29raWVcbiAgICAgKiBUaGlzIGlzIHVzZWZ1bCBmb3Igd2hlbiB5b3Ugd2FudCB0byBjYWNoZSB0aGUgc2Vzc2lvbiBpbiB0aGUgY29va2llXG4gICAgICovXG4gICAgc2Vzc2lvbkRhdGE6IHtcbiAgICAgIG5hbWU6IHNlc3Npb25EYXRhLm5hbWUsXG4gICAgICBvcHRpb25zOiBzZXNzaW9uRGF0YS5hdHRyaWJ1dGVzXG4gICAgfSxcbiAgICBkb250UmVtZW1iZXJUb2tlbjoge1xuICAgICAgbmFtZTogZG9udFJlbWVtYmVyVG9rZW4ubmFtZSxcbiAgICAgIG9wdGlvbnM6IGRvbnRSZW1lbWJlclRva2VuLmF0dHJpYnV0ZXNcbiAgICB9XG4gIH07XG59XG5hc3luYyBmdW5jdGlvbiBzZXRDb29raWVDYWNoZShjdHgsIHNlc3Npb24pIHtcbiAgY29uc3Qgc2hvdWxkU3RvcmVTZXNzaW9uRGF0YUluQ29va2llID0gY3R4LmNvbnRleHQub3B0aW9ucy5zZXNzaW9uPy5jb29raWVDYWNoZT8uZW5hYmxlZDtcbiAgaWYgKHNob3VsZFN0b3JlU2Vzc2lvbkRhdGFJbkNvb2tpZSkge1xuICAgIGNvbnN0IGZpbHRlcmVkU2Vzc2lvbiA9IE9iamVjdC5lbnRyaWVzKHNlc3Npb24uc2Vzc2lvbikucmVkdWNlKFxuICAgICAgKGFjYywgW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICAgIGNvbnN0IGZpZWxkQ29uZmlnID0gY3R4LmNvbnRleHQub3B0aW9ucy5zZXNzaW9uPy5hZGRpdGlvbmFsRmllbGRzPy5ba2V5XTtcbiAgICAgICAgaWYgKCFmaWVsZENvbmZpZyB8fCBmaWVsZENvbmZpZy5yZXR1cm5lZCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICBhY2Nba2V5XSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgICB9LFxuICAgICAge31cbiAgICApO1xuICAgIGNvbnN0IHNlc3Npb25EYXRhID0geyBzZXNzaW9uOiBmaWx0ZXJlZFNlc3Npb24sIHVzZXI6IHNlc3Npb24udXNlciB9O1xuICAgIGNvbnN0IGV4cGlyZXNBdERhdGUgPSBnZXREYXRlKFxuICAgICAgY3R4LmNvbnRleHQuYXV0aENvb2tpZXMuc2Vzc2lvbkRhdGEub3B0aW9ucy5tYXhBZ2UgfHwgNjAsXG4gICAgICBcInNlY1wiXG4gICAgKS5nZXRUaW1lKCk7XG4gICAgY29uc3QgZGF0YSA9IGJhc2U2NFVybC5lbmNvZGUoXG4gICAgICBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIHNlc3Npb246IHNlc3Npb25EYXRhLFxuICAgICAgICBleHBpcmVzQXQ6IGV4cGlyZXNBdERhdGUsXG4gICAgICAgIHNpZ25hdHVyZTogYXdhaXQgY3JlYXRlSE1BQyhcIlNIQS0yNTZcIiwgXCJiYXNlNjR1cmxub3BhZFwiKS5zaWduKFxuICAgICAgICAgIGN0eC5jb250ZXh0LnNlY3JldCxcbiAgICAgICAgICBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAuLi5zZXNzaW9uRGF0YSxcbiAgICAgICAgICAgIGV4cGlyZXNBdDogZXhwaXJlc0F0RGF0ZVxuICAgICAgICAgIH0pXG4gICAgICAgIClcbiAgICAgIH0pLFxuICAgICAge1xuICAgICAgICBwYWRkaW5nOiBmYWxzZVxuICAgICAgfVxuICAgICk7XG4gICAgaWYgKGRhdGEubGVuZ3RoID4gNDA5Mykge1xuICAgICAgdGhyb3cgbmV3IEJldHRlckF1dGhFcnJvcihcbiAgICAgICAgXCJTZXNzaW9uIGRhdGEgaXMgdG9vIGxhcmdlIHRvIHN0b3JlIGluIHRoZSBjb29raWUuIFBsZWFzZSBkaXNhYmxlIHNlc3Npb24gY29va2llIGNhY2hpbmcgb3IgcmVkdWNlIHRoZSBzaXplIG9mIHRoZSBzZXNzaW9uIGRhdGFcIlxuICAgICAgKTtcbiAgICB9XG4gICAgY3R4LnNldENvb2tpZShcbiAgICAgIGN0eC5jb250ZXh0LmF1dGhDb29raWVzLnNlc3Npb25EYXRhLm5hbWUsXG4gICAgICBkYXRhLFxuICAgICAgY3R4LmNvbnRleHQuYXV0aENvb2tpZXMuc2Vzc2lvbkRhdGEub3B0aW9uc1xuICAgICk7XG4gIH1cbn1cbmFzeW5jIGZ1bmN0aW9uIHNldFNlc3Npb25Db29raWUoY3R4LCBzZXNzaW9uLCBkb250UmVtZW1iZXJNZSwgb3ZlcnJpZGVzKSB7XG4gIGNvbnN0IGRvbnRSZW1lbWJlck1lQ29va2llID0gYXdhaXQgY3R4LmdldFNpZ25lZENvb2tpZShcbiAgICBjdHguY29udGV4dC5hdXRoQ29va2llcy5kb250UmVtZW1iZXJUb2tlbi5uYW1lLFxuICAgIGN0eC5jb250ZXh0LnNlY3JldFxuICApO1xuICBkb250UmVtZW1iZXJNZSA9IGRvbnRSZW1lbWJlck1lICE9PSB2b2lkIDAgPyBkb250UmVtZW1iZXJNZSA6ICEhZG9udFJlbWVtYmVyTWVDb29raWU7XG4gIGNvbnN0IG9wdGlvbnMgPSBjdHguY29udGV4dC5hdXRoQ29va2llcy5zZXNzaW9uVG9rZW4ub3B0aW9ucztcbiAgY29uc3QgbWF4QWdlID0gZG9udFJlbWVtYmVyTWUgPyB2b2lkIDAgOiBjdHguY29udGV4dC5zZXNzaW9uQ29uZmlnLmV4cGlyZXNJbjtcbiAgYXdhaXQgY3R4LnNldFNpZ25lZENvb2tpZShcbiAgICBjdHguY29udGV4dC5hdXRoQ29va2llcy5zZXNzaW9uVG9rZW4ubmFtZSxcbiAgICBzZXNzaW9uLnNlc3Npb24udG9rZW4sXG4gICAgY3R4LmNvbnRleHQuc2VjcmV0LFxuICAgIHtcbiAgICAgIC4uLm9wdGlvbnMsXG4gICAgICBtYXhBZ2UsXG4gICAgICAuLi5vdmVycmlkZXNcbiAgICB9XG4gICk7XG4gIGlmIChkb250UmVtZW1iZXJNZSkge1xuICAgIGF3YWl0IGN0eC5zZXRTaWduZWRDb29raWUoXG4gICAgICBjdHguY29udGV4dC5hdXRoQ29va2llcy5kb250UmVtZW1iZXJUb2tlbi5uYW1lLFxuICAgICAgXCJ0cnVlXCIsXG4gICAgICBjdHguY29udGV4dC5zZWNyZXQsXG4gICAgICBjdHguY29udGV4dC5hdXRoQ29va2llcy5kb250UmVtZW1iZXJUb2tlbi5vcHRpb25zXG4gICAgKTtcbiAgfVxuICBhd2FpdCBzZXRDb29raWVDYWNoZShjdHgsIHNlc3Npb24pO1xuICBjdHguY29udGV4dC5zZXROZXdTZXNzaW9uKHNlc3Npb24pO1xuICBpZiAoY3R4LmNvbnRleHQub3B0aW9ucy5zZWNvbmRhcnlTdG9yYWdlKSB7XG4gICAgYXdhaXQgY3R4LmNvbnRleHQuc2Vjb25kYXJ5U3RvcmFnZT8uc2V0KFxuICAgICAgc2Vzc2lvbi5zZXNzaW9uLnRva2VuLFxuICAgICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICB1c2VyOiBzZXNzaW9uLnVzZXIsXG4gICAgICAgIHNlc3Npb246IHNlc3Npb24uc2Vzc2lvblxuICAgICAgfSksXG4gICAgICBNYXRoLmZsb29yKFxuICAgICAgICAobmV3IERhdGUoc2Vzc2lvbi5zZXNzaW9uLmV4cGlyZXNBdCkuZ2V0VGltZSgpIC0gRGF0ZS5ub3coKSkgLyAxZTNcbiAgICAgIClcbiAgICApO1xuICB9XG59XG5mdW5jdGlvbiBkZWxldGVTZXNzaW9uQ29va2llKGN0eCwgc2tpcERvbnRSZW1lbWJlck1lKSB7XG4gIGN0eC5zZXRDb29raWUoY3R4LmNvbnRleHQuYXV0aENvb2tpZXMuc2Vzc2lvblRva2VuLm5hbWUsIFwiXCIsIHtcbiAgICAuLi5jdHguY29udGV4dC5hdXRoQ29va2llcy5zZXNzaW9uVG9rZW4ub3B0aW9ucyxcbiAgICBtYXhBZ2U6IDBcbiAgfSk7XG4gIGN0eC5zZXRDb29raWUoY3R4LmNvbnRleHQuYXV0aENvb2tpZXMuc2Vzc2lvbkRhdGEubmFtZSwgXCJcIiwge1xuICAgIC4uLmN0eC5jb250ZXh0LmF1dGhDb29raWVzLnNlc3Npb25EYXRhLm9wdGlvbnMsXG4gICAgbWF4QWdlOiAwXG4gIH0pO1xuICBpZiAoIXNraXBEb250UmVtZW1iZXJNZSkge1xuICAgIGN0eC5zZXRDb29raWUoY3R4LmNvbnRleHQuYXV0aENvb2tpZXMuZG9udFJlbWVtYmVyVG9rZW4ubmFtZSwgXCJcIiwge1xuICAgICAgLi4uY3R4LmNvbnRleHQuYXV0aENvb2tpZXMuZG9udFJlbWVtYmVyVG9rZW4ub3B0aW9ucyxcbiAgICAgIG1heEFnZTogMFxuICAgIH0pO1xuICB9XG59XG5mdW5jdGlvbiBwYXJzZUNvb2tpZXMoY29va2llSGVhZGVyKSB7XG4gIGNvbnN0IGNvb2tpZXMgPSBjb29raWVIZWFkZXIuc3BsaXQoXCI7IFwiKTtcbiAgY29uc3QgY29va2llTWFwID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTtcbiAgY29va2llcy5mb3JFYWNoKChjb29raWUpID0+IHtcbiAgICBjb25zdCBbbmFtZSwgdmFsdWVdID0gY29va2llLnNwbGl0KFwiPVwiKTtcbiAgICBjb29raWVNYXAuc2V0KG5hbWUsIHZhbHVlKTtcbiAgfSk7XG4gIHJldHVybiBjb29raWVNYXA7XG59XG5jb25zdCBnZXRTZXNzaW9uQ29va2llID0gKHJlcXVlc3QsIGNvbmZpZykgPT4ge1xuICBpZiAoY29uZmlnPy5jb29raWVQcmVmaXgpIHtcbiAgICBpZiAoY29uZmlnLmNvb2tpZU5hbWUpIHtcbiAgICAgIGNvbmZpZy5jb29raWVQcmVmaXggPSBgJHtjb25maWcuY29va2llUHJlZml4fS1gO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25maWcuY29va2llUHJlZml4ID0gYCR7Y29uZmlnLmNvb2tpZVByZWZpeH0uYDtcbiAgICB9XG4gIH1cbiAgY29uc3QgaGVhZGVycyA9IFwiaGVhZGVyc1wiIGluIHJlcXVlc3QgPyByZXF1ZXN0LmhlYWRlcnMgOiByZXF1ZXN0O1xuICBjb25zdCByZXEgPSByZXF1ZXN0IGluc3RhbmNlb2YgUmVxdWVzdCA/IHJlcXVlc3QgOiB2b2lkIDA7XG4gIGdldEJhc2VVUkwocmVxPy51cmwsIGNvbmZpZz8ucGF0aCwgcmVxKTtcbiAgY29uc3QgY29va2llcyA9IGhlYWRlcnMuZ2V0KFwiY29va2llXCIpO1xuICBpZiAoIWNvb2tpZXMpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBjb25zdCB7IGNvb2tpZU5hbWUgPSBcInNlc3Npb25fdG9rZW5cIiwgY29va2llUHJlZml4ID0gXCJiZXR0ZXItYXV0aC5cIiB9ID0gY29uZmlnIHx8IHt9O1xuICBjb25zdCBuYW1lID0gYCR7Y29va2llUHJlZml4fSR7Y29va2llTmFtZX1gO1xuICBjb25zdCBzZWN1cmVDb29raWVOYW1lID0gYF9fU2VjdXJlLSR7bmFtZX1gO1xuICBjb25zdCBwYXJzZWRDb29raWUgPSBwYXJzZUNvb2tpZXMoY29va2llcyk7XG4gIGNvbnN0IHNlc3Npb25Ub2tlbiA9IHBhcnNlZENvb2tpZS5nZXQobmFtZSkgfHwgcGFyc2VkQ29va2llLmdldChzZWN1cmVDb29raWVOYW1lKTtcbiAgaWYgKHNlc3Npb25Ub2tlbikge1xuICAgIHJldHVybiBzZXNzaW9uVG9rZW47XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59O1xuY29uc3QgZ2V0Q29va2llQ2FjaGUgPSBhc3luYyAocmVxdWVzdCwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGhlYWRlcnMgPSByZXF1ZXN0IGluc3RhbmNlb2YgSGVhZGVycyA/IHJlcXVlc3QgOiByZXF1ZXN0LmhlYWRlcnM7XG4gIGNvbnN0IGNvb2tpZXMgPSBoZWFkZXJzLmdldChcImNvb2tpZVwiKTtcbiAgaWYgKCFjb29raWVzKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgY29uc3QgeyBjb29raWVOYW1lID0gXCJzZXNzaW9uX2RhdGFcIiwgY29va2llUHJlZml4ID0gXCJiZXR0ZXItYXV0aFwiIH0gPSBjb25maWcgfHwge307XG4gIGNvbnN0IG5hbWUgPSBjb25maWc/LmlzU2VjdXJlICE9PSB2b2lkIDAgPyBjb25maWcuaXNTZWN1cmUgPyBgX19TZWN1cmUtJHtjb29raWVQcmVmaXh9LiR7Y29va2llTmFtZX1gIDogYCR7Y29va2llUHJlZml4fS4ke2Nvb2tpZU5hbWV9YCA6IGlzUHJvZHVjdGlvbiA/IGBfX1NlY3VyZS0ke2Nvb2tpZVByZWZpeH0uJHtjb29raWVOYW1lfWAgOiBgJHtjb29raWVQcmVmaXh9LiR7Y29va2llTmFtZX1gO1xuICBjb25zdCBwYXJzZWRDb29raWUgPSBwYXJzZUNvb2tpZXMoY29va2llcyk7XG4gIGNvbnN0IHNlc3Npb25EYXRhID0gcGFyc2VkQ29va2llLmdldChuYW1lKTtcbiAgaWYgKHNlc3Npb25EYXRhKSB7XG4gICAgY29uc3Qgc2Vzc2lvbkRhdGFQYXlsb2FkID0gc2FmZUpTT05QYXJzZShiaW5hcnkuZGVjb2RlKGJhc2U2NFVybC5kZWNvZGUoc2Vzc2lvbkRhdGEpKSk7XG4gICAgaWYgKCFzZXNzaW9uRGF0YVBheWxvYWQpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBzZWNyZXQgPSBjb25maWc/LnNlY3JldCB8fCBlbnYuQkVUVEVSX0FVVEhfU0VDUkVUO1xuICAgIGlmICghc2VjcmV0KSB7XG4gICAgICB0aHJvdyBuZXcgQmV0dGVyQXV0aEVycm9yKFxuICAgICAgICBcImdldENvb2tpZUNhY2hlIHJlcXVpcmVzIGEgc2VjcmV0IHRvIGJlIHByb3ZpZGVkLiBFaXRoZXIgcGFzcyBpdCBhcyBhbiBvcHRpb24gb3Igc2V0IHRoZSBCRVRURVJfQVVUSF9TRUNSRVQgZW52aXJvbm1lbnQgdmFyaWFibGVcIlxuICAgICAgKTtcbiAgICB9XG4gICAgY29uc3QgaXNWYWxpZCA9IGF3YWl0IGNyZWF0ZUhNQUMoXCJTSEEtMjU2XCIsIFwiYmFzZTY0dXJsbm9wYWRcIikudmVyaWZ5KFxuICAgICAgc2VjcmV0LFxuICAgICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAuLi5zZXNzaW9uRGF0YVBheWxvYWQuc2Vzc2lvbixcbiAgICAgICAgZXhwaXJlc0F0OiBzZXNzaW9uRGF0YVBheWxvYWQuZXhwaXJlc0F0XG4gICAgICB9KSxcbiAgICAgIHNlc3Npb25EYXRhUGF5bG9hZC5zaWduYXR1cmVcbiAgICApO1xuICAgIGlmICghaXNWYWxpZCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiBzZXNzaW9uRGF0YVBheWxvYWQuc2Vzc2lvbjtcbiAgfVxuICByZXR1cm4gbnVsbDtcbn07XG5cbmV4cG9ydCB7IGNyZWF0ZUNvb2tpZUdldHRlciwgZGVsZXRlU2Vzc2lvbkNvb2tpZSwgZ2V0Q29va2llQ2FjaGUsIGdldENvb2tpZXMsIGdldFNlc3Npb25Db29raWUsIHBhcnNlQ29va2llcywgcGFyc2VTZXRDb29raWVIZWFkZXIsIHNldENvb2tpZUNhY2hlLCBzZXRDb29raWVUb0hlYWRlciwgc2V0U2Vzc2lvbkNvb2tpZSB9O1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/cookies/index.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/crypto/index.mjs":
/*!************************************************************!*\
  !*** ../../node_modules/better-auth/dist/crypto/index.mjs ***!
  \************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   compareHash: () => (/* binding */ compareHash),\n/* harmony export */   constantTimeEqual: () => (/* binding */ constantTimeEqual),\n/* harmony export */   generateRandomString: () => (/* reexport safe */ _shared_better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_4__.g),\n/* harmony export */   hashPassword: () => (/* binding */ hashPassword),\n/* harmony export */   hashToBase64: () => (/* binding */ hashToBase64),\n/* harmony export */   signJWT: () => (/* binding */ signJWT),\n/* harmony export */   symmetricDecrypt: () => (/* binding */ symmetricDecrypt),\n/* harmony export */   symmetricEncrypt: () => (/* binding */ symmetricEncrypt),\n/* harmony export */   verifyPassword: () => (/* binding */ verifyPassword)\n/* harmony export */ });\n/* harmony import */ var _better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @better-auth/utils/hash */ \"(rsc)/../../node_modules/@better-auth/utils/dist/hash.mjs\");\n/* harmony import */ var _noble_ciphers_chacha__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @noble/ciphers/chacha */ \"(rsc)/../../node_modules/@noble/ciphers/esm/chacha.js\");\n/* harmony import */ var _noble_ciphers_utils__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @noble/ciphers/utils */ \"(rsc)/../../node_modules/@noble/ciphers/esm/utils.js\");\n/* harmony import */ var _noble_ciphers_webcrypto__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @noble/ciphers/webcrypto */ \"(rsc)/../../node_modules/@noble/ciphers/esm/webcrypto.js\");\n/* harmony import */ var _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @better-auth/utils/base64 */ \"(rsc)/../../node_modules/@better-auth/utils/dist/base64.mjs\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! jose */ \"(rsc)/../../node_modules/jose/dist/node/esm/jwt/sign.js\");\n/* harmony import */ var _noble_hashes_scrypt__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @noble/hashes/scrypt */ \"(rsc)/../../node_modules/@noble/hashes/esm/scrypt.js\");\n/* harmony import */ var _better_auth_utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @better-auth/utils */ \"(rsc)/../../node_modules/@better-auth/utils/dist/index.mjs\");\n/* harmony import */ var _better_auth_utils_hex__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @better-auth/utils/hex */ \"(rsc)/../../node_modules/@better-auth/utils/dist/hex.mjs\");\n/* harmony import */ var _noble_hashes_utils__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @noble/hashes/utils */ \"(rsc)/../../node_modules/@noble/hashes/esm/utils.js\");\n/* harmony import */ var _shared_better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../shared/better-auth.B4Qoxdgc.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs\");\n/* harmony import */ var _better_auth_utils_random__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @better-auth/utils/random */ \"(rsc)/../../node_modules/@better-auth/utils/dist/random.mjs\");\n\n\n\n\n\n\n\n\n\n\n\n\n\nasync function signJWT(payload, secret, expiresIn = 3600) {\n  const jwt = await new jose__WEBPACK_IMPORTED_MODULE_6__.SignJWT(payload).setProtectedHeader({ alg: \"HS256\" }).setIssuedAt().setExpirationTime(Math.floor(Date.now() / 1e3) + expiresIn).sign(new TextEncoder().encode(secret));\n  return jwt;\n}\n\nfunction constantTimeEqual(a, b) {\n  const aBuffer = new Uint8Array(a);\n  const bBuffer = new Uint8Array(b);\n  if (aBuffer.length !== bBuffer.length) {\n    return false;\n  }\n  let c = 0;\n  for (let i = 0; i < aBuffer.length; i++) {\n    c |= aBuffer[i] ^ bBuffer[i];\n  }\n  return c === 0;\n}\n\nasync function hashToBase64(data) {\n  const buffer = await (0,_better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_0__.createHash)(\"SHA-256\").digest(data);\n  return _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_1__.base64.encode(buffer);\n}\nasync function compareHash(data, hash) {\n  const buffer = await (0,_better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_0__.createHash)(\"SHA-256\").digest(\n    typeof data === \"string\" ? new TextEncoder().encode(data) : data\n  );\n  const hashBuffer = _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_1__.base64.decode(hash);\n  return constantTimeEqual(buffer, hashBuffer);\n}\n\nconst config = {\n  N: 16384,\n  r: 16,\n  p: 1,\n  dkLen: 64\n};\nasync function generateKey(password, salt) {\n  return await (0,_noble_hashes_scrypt__WEBPACK_IMPORTED_MODULE_7__.scryptAsync)(password.normalize(\"NFKC\"), salt, {\n    N: config.N,\n    p: config.p,\n    r: config.r,\n    dkLen: config.dkLen,\n    maxmem: 128 * config.N * config.r * 2\n  });\n}\nconst hashPassword = async (password) => {\n  const salt = _better_auth_utils_hex__WEBPACK_IMPORTED_MODULE_3__.hex.encode((0,_better_auth_utils__WEBPACK_IMPORTED_MODULE_2__.getRandomValues)(new Uint8Array(16)));\n  const key = await generateKey(password, salt);\n  return `${salt}:${_better_auth_utils_hex__WEBPACK_IMPORTED_MODULE_3__.hex.encode(key)}`;\n};\nconst verifyPassword = async ({\n  hash,\n  password\n}) => {\n  const [salt, key] = hash.split(\":\");\n  const targetKey = await generateKey(password, salt);\n  return constantTimeEqual(targetKey, (0,_noble_hashes_utils__WEBPACK_IMPORTED_MODULE_8__.hexToBytes)(key));\n};\n\nconst symmetricEncrypt = async ({\n  key,\n  data\n}) => {\n  const keyAsBytes = await (0,_better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_0__.createHash)(\"SHA-256\").digest(key);\n  const dataAsBytes = (0,_noble_ciphers_utils__WEBPACK_IMPORTED_MODULE_9__.utf8ToBytes)(data);\n  const chacha = (0,_noble_ciphers_webcrypto__WEBPACK_IMPORTED_MODULE_10__.managedNonce)(_noble_ciphers_chacha__WEBPACK_IMPORTED_MODULE_11__.xchacha20poly1305)(new Uint8Array(keyAsBytes));\n  return (0,_noble_ciphers_utils__WEBPACK_IMPORTED_MODULE_9__.bytesToHex)(chacha.encrypt(dataAsBytes));\n};\nconst symmetricDecrypt = async ({\n  key,\n  data\n}) => {\n  const keyAsBytes = await (0,_better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_0__.createHash)(\"SHA-256\").digest(key);\n  const dataAsBytes = (0,_noble_ciphers_utils__WEBPACK_IMPORTED_MODULE_9__.hexToBytes)(data);\n  const chacha = (0,_noble_ciphers_webcrypto__WEBPACK_IMPORTED_MODULE_10__.managedNonce)(_noble_ciphers_chacha__WEBPACK_IMPORTED_MODULE_11__.xchacha20poly1305)(new Uint8Array(keyAsBytes));\n  return new TextDecoder().decode(chacha.decrypt(dataAsBytes));\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3QvY3J5cHRvL2luZGV4Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBcUQ7QUFDSztBQUNpQztBQUNuQztBQUNMO0FBQ3BCO0FBQ29CO0FBQ0U7QUFDUjtBQUNJO0FBQzhCO0FBQzVDOztBQUVuQztBQUNBLHdCQUF3Qix5Q0FBTywrQkFBK0IsY0FBYztBQUM1RTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLG9CQUFvQjtBQUN0QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHVCQUF1QixtRUFBVTtBQUNqQyxTQUFTLDZEQUFNO0FBQ2Y7QUFDQTtBQUNBLHVCQUF1QixtRUFBVTtBQUNqQztBQUNBO0FBQ0EscUJBQXFCLDZEQUFNO0FBQzNCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLGlFQUFXO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLGVBQWUsdURBQUcsUUFBUSxtRUFBZTtBQUN6QztBQUNBLFlBQVksS0FBSyxHQUFHLHVEQUFHLGFBQWE7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLHNDQUFzQywrREFBVTtBQUNoRDs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0QsMkJBQTJCLG1FQUFVO0FBQ3JDLHNCQUFzQixpRUFBVztBQUNqQyxpQkFBaUIsdUVBQVksQ0FBQyxxRUFBaUI7QUFDL0MsU0FBUyxnRUFBVTtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRCwyQkFBMkIsbUVBQVU7QUFDckMsc0JBQXNCLGdFQUFZO0FBQ2xDLGlCQUFpQix1RUFBWSxDQUFDLHFFQUFpQjtBQUMvQztBQUNBOztBQUVtSSIsInNvdXJjZXMiOlsiL1VzZXJzL21pbGFuL0Rlc2t0b3AvQXBwcy9iZXR0ZXItYXV0aC9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9jcnlwdG8vaW5kZXgubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUhhc2ggfSBmcm9tICdAYmV0dGVyLWF1dGgvdXRpbHMvaGFzaCc7XG5pbXBvcnQgeyB4Y2hhY2hhMjBwb2x5MTMwNSB9IGZyb20gJ0Bub2JsZS9jaXBoZXJzL2NoYWNoYSc7XG5pbXBvcnQgeyB1dGY4VG9CeXRlcywgYnl0ZXNUb0hleCwgaGV4VG9CeXRlcyBhcyBoZXhUb0J5dGVzJDEgfSBmcm9tICdAbm9ibGUvY2lwaGVycy91dGlscyc7XG5pbXBvcnQgeyBtYW5hZ2VkTm9uY2UgfSBmcm9tICdAbm9ibGUvY2lwaGVycy93ZWJjcnlwdG8nO1xuaW1wb3J0IHsgYmFzZTY0IH0gZnJvbSAnQGJldHRlci1hdXRoL3V0aWxzL2Jhc2U2NCc7XG5pbXBvcnQgeyBTaWduSldUIH0gZnJvbSAnam9zZSc7XG5pbXBvcnQgeyBzY3J5cHRBc3luYyB9IGZyb20gJ0Bub2JsZS9oYXNoZXMvc2NyeXB0JztcbmltcG9ydCB7IGdldFJhbmRvbVZhbHVlcyB9IGZyb20gJ0BiZXR0ZXItYXV0aC91dGlscyc7XG5pbXBvcnQgeyBoZXggfSBmcm9tICdAYmV0dGVyLWF1dGgvdXRpbHMvaGV4JztcbmltcG9ydCB7IGhleFRvQnl0ZXMgfSBmcm9tICdAbm9ibGUvaGFzaGVzL3V0aWxzJztcbmV4cG9ydCB7IGcgYXMgZ2VuZXJhdGVSYW5kb21TdHJpbmcgfSBmcm9tICcuLi9zaGFyZWQvYmV0dGVyLWF1dGguQjRRb3hkZ2MubWpzJztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzL3JhbmRvbSc7XG5cbmFzeW5jIGZ1bmN0aW9uIHNpZ25KV1QocGF5bG9hZCwgc2VjcmV0LCBleHBpcmVzSW4gPSAzNjAwKSB7XG4gIGNvbnN0IGp3dCA9IGF3YWl0IG5ldyBTaWduSldUKHBheWxvYWQpLnNldFByb3RlY3RlZEhlYWRlcih7IGFsZzogXCJIUzI1NlwiIH0pLnNldElzc3VlZEF0KCkuc2V0RXhwaXJhdGlvblRpbWUoTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMWUzKSArIGV4cGlyZXNJbikuc2lnbihuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoc2VjcmV0KSk7XG4gIHJldHVybiBqd3Q7XG59XG5cbmZ1bmN0aW9uIGNvbnN0YW50VGltZUVxdWFsKGEsIGIpIHtcbiAgY29uc3QgYUJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KGEpO1xuICBjb25zdCBiQnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoYik7XG4gIGlmIChhQnVmZmVyLmxlbmd0aCAhPT0gYkJ1ZmZlci5sZW5ndGgpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgbGV0IGMgPSAwO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGFCdWZmZXIubGVuZ3RoOyBpKyspIHtcbiAgICBjIHw9IGFCdWZmZXJbaV0gXiBiQnVmZmVyW2ldO1xuICB9XG4gIHJldHVybiBjID09PSAwO1xufVxuXG5hc3luYyBmdW5jdGlvbiBoYXNoVG9CYXNlNjQoZGF0YSkge1xuICBjb25zdCBidWZmZXIgPSBhd2FpdCBjcmVhdGVIYXNoKFwiU0hBLTI1NlwiKS5kaWdlc3QoZGF0YSk7XG4gIHJldHVybiBiYXNlNjQuZW5jb2RlKGJ1ZmZlcik7XG59XG5hc3luYyBmdW5jdGlvbiBjb21wYXJlSGFzaChkYXRhLCBoYXNoKSB7XG4gIGNvbnN0IGJ1ZmZlciA9IGF3YWl0IGNyZWF0ZUhhc2goXCJTSEEtMjU2XCIpLmRpZ2VzdChcbiAgICB0eXBlb2YgZGF0YSA9PT0gXCJzdHJpbmdcIiA/IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShkYXRhKSA6IGRhdGFcbiAgKTtcbiAgY29uc3QgaGFzaEJ1ZmZlciA9IGJhc2U2NC5kZWNvZGUoaGFzaCk7XG4gIHJldHVybiBjb25zdGFudFRpbWVFcXVhbChidWZmZXIsIGhhc2hCdWZmZXIpO1xufVxuXG5jb25zdCBjb25maWcgPSB7XG4gIE46IDE2Mzg0LFxuICByOiAxNixcbiAgcDogMSxcbiAgZGtMZW46IDY0XG59O1xuYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVLZXkocGFzc3dvcmQsIHNhbHQpIHtcbiAgcmV0dXJuIGF3YWl0IHNjcnlwdEFzeW5jKHBhc3N3b3JkLm5vcm1hbGl6ZShcIk5GS0NcIiksIHNhbHQsIHtcbiAgICBOOiBjb25maWcuTixcbiAgICBwOiBjb25maWcucCxcbiAgICByOiBjb25maWcucixcbiAgICBka0xlbjogY29uZmlnLmRrTGVuLFxuICAgIG1heG1lbTogMTI4ICogY29uZmlnLk4gKiBjb25maWcuciAqIDJcbiAgfSk7XG59XG5jb25zdCBoYXNoUGFzc3dvcmQgPSBhc3luYyAocGFzc3dvcmQpID0+IHtcbiAgY29uc3Qgc2FsdCA9IGhleC5lbmNvZGUoZ2V0UmFuZG9tVmFsdWVzKG5ldyBVaW50OEFycmF5KDE2KSkpO1xuICBjb25zdCBrZXkgPSBhd2FpdCBnZW5lcmF0ZUtleShwYXNzd29yZCwgc2FsdCk7XG4gIHJldHVybiBgJHtzYWx0fToke2hleC5lbmNvZGUoa2V5KX1gO1xufTtcbmNvbnN0IHZlcmlmeVBhc3N3b3JkID0gYXN5bmMgKHtcbiAgaGFzaCxcbiAgcGFzc3dvcmRcbn0pID0+IHtcbiAgY29uc3QgW3NhbHQsIGtleV0gPSBoYXNoLnNwbGl0KFwiOlwiKTtcbiAgY29uc3QgdGFyZ2V0S2V5ID0gYXdhaXQgZ2VuZXJhdGVLZXkocGFzc3dvcmQsIHNhbHQpO1xuICByZXR1cm4gY29uc3RhbnRUaW1lRXF1YWwodGFyZ2V0S2V5LCBoZXhUb0J5dGVzKGtleSkpO1xufTtcblxuY29uc3Qgc3ltbWV0cmljRW5jcnlwdCA9IGFzeW5jICh7XG4gIGtleSxcbiAgZGF0YVxufSkgPT4ge1xuICBjb25zdCBrZXlBc0J5dGVzID0gYXdhaXQgY3JlYXRlSGFzaChcIlNIQS0yNTZcIikuZGlnZXN0KGtleSk7XG4gIGNvbnN0IGRhdGFBc0J5dGVzID0gdXRmOFRvQnl0ZXMoZGF0YSk7XG4gIGNvbnN0IGNoYWNoYSA9IG1hbmFnZWROb25jZSh4Y2hhY2hhMjBwb2x5MTMwNSkobmV3IFVpbnQ4QXJyYXkoa2V5QXNCeXRlcykpO1xuICByZXR1cm4gYnl0ZXNUb0hleChjaGFjaGEuZW5jcnlwdChkYXRhQXNCeXRlcykpO1xufTtcbmNvbnN0IHN5bW1ldHJpY0RlY3J5cHQgPSBhc3luYyAoe1xuICBrZXksXG4gIGRhdGFcbn0pID0+IHtcbiAgY29uc3Qga2V5QXNCeXRlcyA9IGF3YWl0IGNyZWF0ZUhhc2goXCJTSEEtMjU2XCIpLmRpZ2VzdChrZXkpO1xuICBjb25zdCBkYXRhQXNCeXRlcyA9IGhleFRvQnl0ZXMkMShkYXRhKTtcbiAgY29uc3QgY2hhY2hhID0gbWFuYWdlZE5vbmNlKHhjaGFjaGEyMHBvbHkxMzA1KShuZXcgVWludDhBcnJheShrZXlBc0J5dGVzKSk7XG4gIHJldHVybiBuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUoY2hhY2hhLmRlY3J5cHQoZGF0YUFzQnl0ZXMpKTtcbn07XG5cbmV4cG9ydCB7IGNvbXBhcmVIYXNoLCBjb25zdGFudFRpbWVFcXVhbCwgaGFzaFBhc3N3b3JkLCBoYXNoVG9CYXNlNjQsIHNpZ25KV1QsIHN5bW1ldHJpY0RlY3J5cHQsIHN5bW1ldHJpY0VuY3J5cHQsIHZlcmlmeVBhc3N3b3JkIH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/crypto/index.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/index.mjs":
/*!*****************************************************!*\
  !*** ../../node_modules/better-auth/dist/index.mjs ***!
  \*****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BetterAuthError: () => (/* reexport safe */ _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_1__.B),\n/* harmony export */   HIDE_METADATA: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_3__.H),\n/* harmony export */   MissingDependencyError: () => (/* reexport safe */ _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_1__.M),\n/* harmony export */   betterAuth: () => (/* reexport safe */ _shared_better_auth_Cbhy6WDJ_mjs__WEBPACK_IMPORTED_MODULE_0__.b),\n/* harmony export */   capitalizeFirstLetter: () => (/* reexport safe */ _shared_better_auth_D_2CmEwz_mjs__WEBPACK_IMPORTED_MODULE_2__.c),\n/* harmony export */   createLogger: () => (/* reexport safe */ _shared_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_4__.c),\n/* harmony export */   generateId: () => (/* reexport safe */ _shared_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_4__.g),\n/* harmony export */   generateState: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_3__.g),\n/* harmony export */   levels: () => (/* reexport safe */ _shared_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_4__.l),\n/* harmony export */   logger: () => (/* reexport safe */ _shared_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_4__.a),\n/* harmony export */   parseState: () => (/* reexport safe */ _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_3__.p),\n/* harmony export */   shouldPublishLog: () => (/* reexport safe */ _shared_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_4__.s)\n/* harmony export */ });\n/* harmony import */ var _shared_better_auth_Cbhy6WDJ_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./shared/better-auth.Cbhy6WDJ.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.Cbhy6WDJ.mjs\");\n/* harmony import */ var _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./shared/better-auth.DdzSJf-n.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs\");\n/* harmony import */ var _shared_better_auth_D_2CmEwz_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./shared/better-auth.D-2CmEwz.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.D-2CmEwz.mjs\");\n/* harmony import */ var _shared_better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./shared/better-auth.z3dsxLxE.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.z3dsxLxE.mjs\");\n/* harmony import */ var _shared_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./shared/better-auth.DBGfIDnh.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DBGfIDnh.mjs\");\n/* harmony import */ var _api_index_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./api/index.mjs */ \"(rsc)/../../node_modules/better-auth/dist/api/index.mjs\");\n/* harmony import */ var better_call__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! better-call */ \"(rsc)/../../node_modules/better-call/dist/index.js\");\n/* harmony import */ var _cookies_index_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./cookies/index.mjs */ \"(rsc)/../../node_modules/better-auth/dist/cookies/index.mjs\");\n/* harmony import */ var _shared_better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./shared/better-auth.CW6D9eSx.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.CW6D9eSx.mjs\");\n/* harmony import */ var _shared_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./shared/better-auth.8zoxzg-F.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs\");\n/* harmony import */ var _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @better-auth/utils/base64 */ \"(rsc)/../../node_modules/@better-auth/utils/dist/base64.mjs\");\n/* harmony import */ var _better_auth_utils_hmac__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @better-auth/utils/hmac */ \"(rsc)/../../node_modules/@better-auth/utils/dist/hmac.mjs\");\n/* harmony import */ var _shared_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./shared/better-auth.tB5eU6EY.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.tB5eU6EY.mjs\");\n/* harmony import */ var _shared_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./shared/better-auth.VTXNLFMT.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.VTXNLFMT.mjs\");\n/* harmony import */ var _better_auth_utils_binary__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @better-auth/utils/binary */ \"(rsc)/../../node_modules/@better-auth/utils/dist/binary.mjs\");\n/* harmony import */ var _shared_better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./shared/better-auth.n2KFGwjY.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.n2KFGwjY.mjs\");\n/* harmony import */ var _shared_better_auth_DcfNPS8q_mjs__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./shared/better-auth.DcfNPS8q.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DcfNPS8q.mjs\");\n/* harmony import */ var defu__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! defu */ \"(rsc)/../../node_modules/defu/dist/defu.mjs\");\n/* harmony import */ var _crypto_index_mjs__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./crypto/index.mjs */ \"(rsc)/../../node_modules/better-auth/dist/crypto/index.mjs\");\n/* harmony import */ var _better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! @better-auth/utils/hash */ \"(rsc)/../../node_modules/@better-auth/utils/dist/hash.mjs\");\n/* harmony import */ var _better_auth_utils__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! @better-auth/utils */ \"(rsc)/../../node_modules/@better-auth/utils/dist/index.mjs\");\n/* harmony import */ var _better_auth_utils_hex__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @better-auth/utils/hex */ \"(rsc)/../../node_modules/@better-auth/utils/dist/hex.mjs\");\n/* harmony import */ var _shared_better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./shared/better-auth.B4Qoxdgc.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs\");\n/* harmony import */ var _better_auth_utils_random__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! @better-auth/utils/random */ \"(rsc)/../../node_modules/@better-auth/utils/dist/random.mjs\");\n/* harmony import */ var _shared_better_auth_ByruPN9q_mjs__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./shared/better-auth.ByruPN9q.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.ByruPN9q.mjs\");\n/* harmony import */ var _shared_better_auth_DORkW_Ge_mjs__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./shared/better-auth.DORkW_Ge.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DORkW_Ge.mjs\");\n/* harmony import */ var _shared_better_auth_DwzM_9N1_mjs__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./shared/better-auth.DwzM-9N1.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DwzM-9N1.mjs\");\n/* harmony import */ var _shared_better_auth_gBl3F_xa_mjs__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./shared/better-auth.gBl3F_xa.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.gBl3F_xa.mjs\");\n/* harmony import */ var _shared_better_auth_DGpadpzN_mjs__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./shared/better-auth.DGpadpzN.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DGpadpzN.mjs\");\n/* harmony import */ var _shared_better_auth_YwDQhoPc_mjs__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./shared/better-auth.YwDQhoPc.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.YwDQhoPc.mjs\");\n/* harmony import */ var _better_fetch_fetch__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! @better-fetch/fetch */ \"(rsc)/../../node_modules/@better-fetch/fetch/dist/index.js\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3QvaW5kZXgubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBb0U7QUFDa0M7QUFDdkI7QUFDNkI7QUFDNEI7QUFDL0c7QUFDSjtBQUNMO0FBQ2E7QUFDYztBQUNBO0FBQ1I7QUFDRjtBQUNVO0FBQ0E7QUFDUjtBQUNRO0FBQ0E7QUFDN0I7QUFDYztBQUNLO0FBQ0Y7QUFDRDtBQUNJO0FBQ3BCO0FBQ2dCO0FBQ0Y7QUFDSTtBQUNIO0FBQ2M7QUFDUjtBQUNRO0FBQ0E7QUFDQTtBQUMzQjtBQUMyQjtBQUNBO0FBQ0E7QUFDZDtBQUNSIiwic291cmNlcyI6WyIvVXNlcnMvbWlsYW4vRGVza3RvcC9BcHBzL2JldHRlci1hdXRoL25vZGVfbW9kdWxlcy9iZXR0ZXItYXV0aC9kaXN0L2luZGV4Lm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgeyBiIGFzIGJldHRlckF1dGggfSBmcm9tICcuL3NoYXJlZC9iZXR0ZXItYXV0aC5DYmh5NldESi5tanMnO1xuZXhwb3J0IHsgQiBhcyBCZXR0ZXJBdXRoRXJyb3IsIE0gYXMgTWlzc2luZ0RlcGVuZGVuY3lFcnJvciB9IGZyb20gJy4vc2hhcmVkL2JldHRlci1hdXRoLkRkelNKZi1uLm1qcyc7XG5leHBvcnQgeyBjIGFzIGNhcGl0YWxpemVGaXJzdExldHRlciB9IGZyb20gJy4vc2hhcmVkL2JldHRlci1hdXRoLkQtMkNtRXd6Lm1qcyc7XG5leHBvcnQgeyBIIGFzIEhJREVfTUVUQURBVEEsIGcgYXMgZ2VuZXJhdGVTdGF0ZSwgcCBhcyBwYXJzZVN0YXRlIH0gZnJvbSAnLi9zaGFyZWQvYmV0dGVyLWF1dGguejNkc3hMeEUubWpzJztcbmV4cG9ydCB7IGMgYXMgY3JlYXRlTG9nZ2VyLCBnIGFzIGdlbmVyYXRlSWQsIGwgYXMgbGV2ZWxzLCBhIGFzIGxvZ2dlciwgcyBhcyBzaG91bGRQdWJsaXNoTG9nIH0gZnJvbSAnLi9zaGFyZWQvYmV0dGVyLWF1dGguREJHZklEbmgubWpzJztcbmltcG9ydCAnLi9hcGkvaW5kZXgubWpzJztcbmltcG9ydCAnYmV0dGVyLWNhbGwnO1xuaW1wb3J0ICd6b2QvdjQnO1xuaW1wb3J0ICcuL2Nvb2tpZXMvaW5kZXgubWpzJztcbmltcG9ydCAnLi9zaGFyZWQvYmV0dGVyLWF1dGguQ1c2RDllU3gubWpzJztcbmltcG9ydCAnLi9zaGFyZWQvYmV0dGVyLWF1dGguOHpveHpnLUYubWpzJztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzL2Jhc2U2NCc7XG5pbXBvcnQgJ0BiZXR0ZXItYXV0aC91dGlscy9obWFjJztcbmltcG9ydCAnLi9zaGFyZWQvYmV0dGVyLWF1dGgudEI1ZVU2RVkubWpzJztcbmltcG9ydCAnLi9zaGFyZWQvYmV0dGVyLWF1dGguVlRYTkxGTVQubWpzJztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzL2JpbmFyeSc7XG5pbXBvcnQgJy4vc2hhcmVkL2JldHRlci1hdXRoLm4yS0ZHd2pZLm1qcyc7XG5pbXBvcnQgJy4vc2hhcmVkL2JldHRlci1hdXRoLkRjZk5QUzhxLm1qcyc7XG5pbXBvcnQgJ2RlZnUnO1xuaW1wb3J0ICcuL2NyeXB0by9pbmRleC5tanMnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMvaGFzaCc7XG5pbXBvcnQgJ0Bub2JsZS9jaXBoZXJzL2NoYWNoYSc7XG5pbXBvcnQgJ0Bub2JsZS9jaXBoZXJzL3V0aWxzJztcbmltcG9ydCAnQG5vYmxlL2NpcGhlcnMvd2ViY3J5cHRvJztcbmltcG9ydCAnam9zZSc7XG5pbXBvcnQgJ0Bub2JsZS9oYXNoZXMvc2NyeXB0JztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzJztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzL2hleCc7XG5pbXBvcnQgJ0Bub2JsZS9oYXNoZXMvdXRpbHMnO1xuaW1wb3J0ICcuL3NoYXJlZC9iZXR0ZXItYXV0aC5CNFFveGRnYy5tanMnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMvcmFuZG9tJztcbmltcG9ydCAnLi9zaGFyZWQvYmV0dGVyLWF1dGguQnlydVBOOXEubWpzJztcbmltcG9ydCAnLi9zaGFyZWQvYmV0dGVyLWF1dGguRE9Sa1dfR2UubWpzJztcbmltcG9ydCAnLi9zaGFyZWQvYmV0dGVyLWF1dGguRHd6TS05TjEubWpzJztcbmltcG9ydCAna3lzZWx5JztcbmltcG9ydCAnLi9zaGFyZWQvYmV0dGVyLWF1dGguZ0JsM0ZfeGEubWpzJztcbmltcG9ydCAnLi9zaGFyZWQvYmV0dGVyLWF1dGguREdwYWRwek4ubWpzJztcbmltcG9ydCAnLi9zaGFyZWQvYmV0dGVyLWF1dGguWXdEUWhvUGMubWpzJztcbmltcG9ydCAnQGJldHRlci1mZXRjaC9mZXRjaCc7XG5pbXBvcnQgJ2pvc2UvZXJyb3JzJztcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/index.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   a: () => (/* binding */ isProduction),\n/* harmony export */   b: () => (/* binding */ isDevelopment),\n/* harmony export */   e: () => (/* binding */ env),\n/* harmony export */   i: () => (/* binding */ isTest)\n/* harmony export */ });\nconst _envShim = /* @__PURE__ */ Object.create(null);\nconst _getEnv = (useShim) => globalThis.process?.env || //@ts-expect-error\nglobalThis.Deno?.env.toObject() || //@ts-expect-error\nglobalThis.__env__ || (useShim ? _envShim : globalThis);\nconst env = new Proxy(_envShim, {\n  get(_, prop) {\n    const env2 = _getEnv();\n    return env2[prop] ?? _envShim[prop];\n  },\n  has(_, prop) {\n    const env2 = _getEnv();\n    return prop in env2 || prop in _envShim;\n  },\n  set(_, prop, value) {\n    const env2 = _getEnv(true);\n    env2[prop] = value;\n    return true;\n  },\n  deleteProperty(_, prop) {\n    if (!prop) {\n      return false;\n    }\n    const env2 = _getEnv(true);\n    delete env2[prop];\n    return true;\n  },\n  ownKeys() {\n    const env2 = _getEnv(true);\n    return Object.keys(env2);\n  }\n});\nfunction toBoolean(val) {\n  return val ? val !== \"false\" : false;\n}\nconst nodeENV = typeof process !== \"undefined\" && process.env && \"development\" || \"\";\nconst isProduction = nodeENV === \"production\";\nconst isDevelopment = nodeENV === \"dev\" || nodeENV === \"development\";\nconst isTest = nodeENV === \"test\" || toBoolean(env.TEST);\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLjh6b3h6Zy1GLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsaUVBQWlFLGFBQW9CO0FBQ3JGO0FBQ0E7QUFDQTs7QUFFd0UiLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWxhbi9EZXNrdG9wL0FwcHMvYmV0dGVyLWF1dGgvbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLjh6b3h6Zy1GLm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBfZW52U2hpbSA9IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpO1xuY29uc3QgX2dldEVudiA9ICh1c2VTaGltKSA9PiBnbG9iYWxUaGlzLnByb2Nlc3M/LmVudiB8fCAvL0B0cy1leHBlY3QtZXJyb3Jcbmdsb2JhbFRoaXMuRGVubz8uZW52LnRvT2JqZWN0KCkgfHwgLy9AdHMtZXhwZWN0LWVycm9yXG5nbG9iYWxUaGlzLl9fZW52X18gfHwgKHVzZVNoaW0gPyBfZW52U2hpbSA6IGdsb2JhbFRoaXMpO1xuY29uc3QgZW52ID0gbmV3IFByb3h5KF9lbnZTaGltLCB7XG4gIGdldChfLCBwcm9wKSB7XG4gICAgY29uc3QgZW52MiA9IF9nZXRFbnYoKTtcbiAgICByZXR1cm4gZW52Mltwcm9wXSA/PyBfZW52U2hpbVtwcm9wXTtcbiAgfSxcbiAgaGFzKF8sIHByb3ApIHtcbiAgICBjb25zdCBlbnYyID0gX2dldEVudigpO1xuICAgIHJldHVybiBwcm9wIGluIGVudjIgfHwgcHJvcCBpbiBfZW52U2hpbTtcbiAgfSxcbiAgc2V0KF8sIHByb3AsIHZhbHVlKSB7XG4gICAgY29uc3QgZW52MiA9IF9nZXRFbnYodHJ1ZSk7XG4gICAgZW52Mltwcm9wXSA9IHZhbHVlO1xuICAgIHJldHVybiB0cnVlO1xuICB9LFxuICBkZWxldGVQcm9wZXJ0eShfLCBwcm9wKSB7XG4gICAgaWYgKCFwcm9wKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IGVudjIgPSBfZ2V0RW52KHRydWUpO1xuICAgIGRlbGV0ZSBlbnYyW3Byb3BdO1xuICAgIHJldHVybiB0cnVlO1xuICB9LFxuICBvd25LZXlzKCkge1xuICAgIGNvbnN0IGVudjIgPSBfZ2V0RW52KHRydWUpO1xuICAgIHJldHVybiBPYmplY3Qua2V5cyhlbnYyKTtcbiAgfVxufSk7XG5mdW5jdGlvbiB0b0Jvb2xlYW4odmFsKSB7XG4gIHJldHVybiB2YWwgPyB2YWwgIT09IFwiZmFsc2VcIiA6IGZhbHNlO1xufVxuY29uc3Qgbm9kZUVOViA9IHR5cGVvZiBwcm9jZXNzICE9PSBcInVuZGVmaW5lZFwiICYmIHByb2Nlc3MuZW52ICYmIHByb2Nlc3MuZW52Lk5PREVfRU5WIHx8IFwiXCI7XG5jb25zdCBpc1Byb2R1Y3Rpb24gPSBub2RlRU5WID09PSBcInByb2R1Y3Rpb25cIjtcbmNvbnN0IGlzRGV2ZWxvcG1lbnQgPSBub2RlRU5WID09PSBcImRldlwiIHx8IG5vZGVFTlYgPT09IFwiZGV2ZWxvcG1lbnRcIjtcbmNvbnN0IGlzVGVzdCA9IG5vZGVFTlYgPT09IFwidGVzdFwiIHx8IHRvQm9vbGVhbihlbnYuVEVTVCk7XG5cbmV4cG9ydCB7IGlzUHJvZHVjdGlvbiBhcyBhLCBpc0RldmVsb3BtZW50IGFzIGIsIGVudiBhcyBlLCBpc1Rlc3QgYXMgaSB9O1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   g: () => (/* binding */ generateRandomString)\n/* harmony export */ });\n/* harmony import */ var _better_auth_utils_random__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @better-auth/utils/random */ \"(rsc)/../../node_modules/@better-auth/utils/dist/random.mjs\");\n\n\nconst generateRandomString = (0,_better_auth_utils_random__WEBPACK_IMPORTED_MODULE_0__.createRandomStringGenerator)(\n  \"a-z\",\n  \"0-9\",\n  \"A-Z\",\n  \"-_\"\n);\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLkI0UW94ZGdjLm1qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUF3RTs7QUFFeEUsNkJBQTZCLHNGQUEyQjtBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVxQyIsInNvdXJjZXMiOlsiL1VzZXJzL21pbGFuL0Rlc2t0b3AvQXBwcy9iZXR0ZXItYXV0aC9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguQjRRb3hkZ2MubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZVJhbmRvbVN0cmluZ0dlbmVyYXRvciB9IGZyb20gJ0BiZXR0ZXItYXV0aC91dGlscy9yYW5kb20nO1xuXG5jb25zdCBnZW5lcmF0ZVJhbmRvbVN0cmluZyA9IGNyZWF0ZVJhbmRvbVN0cmluZ0dlbmVyYXRvcihcbiAgXCJhLXpcIixcbiAgXCIwLTlcIixcbiAgXCJBLVpcIixcbiAgXCItX1wiXG4pO1xuXG5leHBvcnQgeyBnZW5lcmF0ZVJhbmRvbVN0cmluZyBhcyBnIH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/shared/better-auth.ByruPN9q.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.ByruPN9q.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   a: () => (/* binding */ getAdapter),\n/* harmony export */   b: () => (/* binding */ convertToDB),\n/* harmony export */   c: () => (/* binding */ createInternalAdapter),\n/* harmony export */   d: () => (/* binding */ convertFromDB),\n/* harmony export */   e: () => (/* binding */ getMigrations),\n/* harmony export */   f: () => (/* binding */ getSchema),\n/* harmony export */   g: () => (/* binding */ getWithHooks),\n/* harmony export */   m: () => (/* binding */ matchType)\n/* harmony export */ });\n/* harmony import */ var _better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./better-auth.CW6D9eSx.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.CW6D9eSx.mjs\");\n/* harmony import */ var _better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./better-auth.n2KFGwjY.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.n2KFGwjY.mjs\");\n/* harmony import */ var _better_auth_DcfNPS8q_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./better-auth.DcfNPS8q.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DcfNPS8q.mjs\");\n/* harmony import */ var _better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./better-auth.tB5eU6EY.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.tB5eU6EY.mjs\");\n/* harmony import */ var _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./better-auth.DBGfIDnh.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DBGfIDnh.mjs\");\n/* harmony import */ var better_call__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! better-call */ \"(rsc)/../../node_modules/better-call/dist/index.js\");\n/* harmony import */ var _better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @better-auth/utils/hash */ \"(rsc)/../../node_modules/@better-auth/utils/dist/hash.mjs\");\n/* harmony import */ var _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @better-auth/utils/base64 */ \"(rsc)/../../node_modules/@better-auth/utils/dist/base64.mjs\");\n/* harmony import */ var _better_auth_utils__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @better-auth/utils */ \"(rsc)/../../node_modules/@better-auth/utils/dist/index.mjs\");\n/* harmony import */ var _better_auth_utils_hex__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @better-auth/utils/hex */ \"(rsc)/../../node_modules/@better-auth/utils/dist/hex.mjs\");\n/* harmony import */ var _better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./better-auth.B4Qoxdgc.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs\");\n/* harmony import */ var _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./better-auth.8zoxzg-F.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs\");\n/* harmony import */ var _better_auth_utils_random__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @better-auth/utils/random */ \"(rsc)/../../node_modules/@better-auth/utils/dist/random.mjs\");\n/* harmony import */ var _better_auth_DORkW_Ge_mjs__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./better-auth.DORkW_Ge.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DORkW_Ge.mjs\");\n/* harmony import */ var _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./better-auth.DdzSJf-n.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs\");\n/* harmony import */ var _better_auth_DwzM_9N1_mjs__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./better-auth.DwzM-9N1.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DwzM-9N1.mjs\");\n/* harmony import */ var _better_auth_DGpadpzN_mjs__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./better-auth.DGpadpzN.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DGpadpzN.mjs\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction getWithHooks(adapter, ctx) {\n  const hooks = ctx.hooks;\n  async function createWithHooks(data, model, customCreateFn, context) {\n    let actualData = data;\n    for (const hook of hooks || []) {\n      const toRun = hook[model]?.create?.before;\n      if (toRun) {\n        const result = await toRun(actualData, context);\n        if (result === false) {\n          return null;\n        }\n        const isObject = typeof result === \"object\" && \"data\" in result;\n        if (isObject) {\n          actualData = {\n            ...actualData,\n            ...result.data\n          };\n        }\n      }\n    }\n    const customCreated = customCreateFn ? await customCreateFn.fn(actualData) : null;\n    const created = !customCreateFn || customCreateFn.executeMainFn ? await adapter.create({\n      model,\n      data: actualData,\n      forceAllowId: true\n    }) : customCreated;\n    for (const hook of hooks || []) {\n      const toRun = hook[model]?.create?.after;\n      if (toRun) {\n        await toRun(created, context);\n      }\n    }\n    return created;\n  }\n  async function updateWithHooks(data, where, model, customUpdateFn, context) {\n    let actualData = data;\n    for (const hook of hooks || []) {\n      const toRun = hook[model]?.update?.before;\n      if (toRun) {\n        const result = await toRun(data, context);\n        if (result === false) {\n          return null;\n        }\n        const isObject = typeof result === \"object\";\n        actualData = isObject ? result.data : result;\n      }\n    }\n    const customUpdated = customUpdateFn ? await customUpdateFn.fn(actualData) : null;\n    const updated = !customUpdateFn || customUpdateFn.executeMainFn ? await adapter.update({\n      model,\n      update: actualData,\n      where\n    }) : customUpdated;\n    for (const hook of hooks || []) {\n      const toRun = hook[model]?.update?.after;\n      if (toRun) {\n        await toRun(updated, context);\n      }\n    }\n    return updated;\n  }\n  async function updateManyWithHooks(data, where, model, customUpdateFn, context) {\n    let actualData = data;\n    for (const hook of hooks || []) {\n      const toRun = hook[model]?.update?.before;\n      if (toRun) {\n        const result = await toRun(data, context);\n        if (result === false) {\n          return null;\n        }\n        const isObject = typeof result === \"object\";\n        actualData = isObject ? result.data : result;\n      }\n    }\n    const customUpdated = customUpdateFn ? await customUpdateFn.fn(actualData) : null;\n    const updated = !customUpdateFn || customUpdateFn.executeMainFn ? await adapter.updateMany({\n      model,\n      update: actualData,\n      where\n    }) : customUpdated;\n    for (const hook of hooks || []) {\n      const toRun = hook[model]?.update?.after;\n      if (toRun) {\n        await toRun(updated, context);\n      }\n    }\n    return updated;\n  }\n  return {\n    createWithHooks,\n    updateWithHooks,\n    updateManyWithHooks\n  };\n}\n\nconst createInternalAdapter = (adapter, ctx) => {\n  const options = ctx.options;\n  const secondaryStorage = options.secondaryStorage;\n  const sessionExpiration = options.session?.expiresIn || 60 * 60 * 24 * 7;\n  const { createWithHooks, updateWithHooks, updateManyWithHooks } = getWithHooks(adapter, ctx);\n  return {\n    createOAuthUser: async (user, account, context) => {\n      const createdUser = await createWithHooks(\n        {\n          createdAt: /* @__PURE__ */ new Date(),\n          updatedAt: /* @__PURE__ */ new Date(),\n          ...user\n        },\n        \"user\",\n        void 0,\n        context\n      );\n      const createdAccount = await createWithHooks(\n        {\n          ...account,\n          userId: createdUser.id || user.id,\n          createdAt: /* @__PURE__ */ new Date(),\n          updatedAt: /* @__PURE__ */ new Date()\n        },\n        \"account\",\n        void 0,\n        context\n      );\n      return {\n        user: createdUser,\n        account: createdAccount\n      };\n    },\n    createUser: async (user, context) => {\n      const createdUser = await createWithHooks(\n        {\n          createdAt: /* @__PURE__ */ new Date(),\n          updatedAt: /* @__PURE__ */ new Date(),\n          emailVerified: false,\n          ...user,\n          email: user.email?.toLowerCase()\n        },\n        \"user\",\n        void 0,\n        context\n      );\n      return createdUser;\n    },\n    createAccount: async (account, context) => {\n      const createdAccount = await createWithHooks(\n        {\n          createdAt: /* @__PURE__ */ new Date(),\n          updatedAt: /* @__PURE__ */ new Date(),\n          ...account\n        },\n        \"account\",\n        void 0,\n        context\n      );\n      return createdAccount;\n    },\n    listSessions: async (userId) => {\n      if (secondaryStorage) {\n        const currentList = await secondaryStorage.get(\n          `active-sessions-${userId}`\n        );\n        if (!currentList) return [];\n        const list = (0,_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_3__.s)(currentList) || [];\n        const now = Date.now();\n        const validSessions = list.filter((s) => s.expiresAt > now);\n        const sessions2 = [];\n        for (const session of validSessions) {\n          const sessionStringified = await secondaryStorage.get(session.token);\n          if (sessionStringified) {\n            const s = JSON.parse(sessionStringified);\n            const parsedSession = (0,_better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_1__.d)(ctx.options, {\n              ...s.session,\n              expiresAt: new Date(s.session.expiresAt)\n            });\n            sessions2.push(parsedSession);\n          }\n        }\n        return sessions2;\n      }\n      const sessions = await adapter.findMany({\n        model: \"session\",\n        where: [\n          {\n            field: \"userId\",\n            value: userId\n          }\n        ]\n      });\n      return sessions;\n    },\n    listUsers: async (limit, offset, sortBy, where) => {\n      const users = await adapter.findMany({\n        model: \"user\",\n        limit,\n        offset,\n        sortBy,\n        where\n      });\n      return users;\n    },\n    countTotalUsers: async (where) => {\n      const total = await adapter.count({\n        model: \"user\",\n        where\n      });\n      if (typeof total === \"string\") {\n        return parseInt(total);\n      }\n      return total;\n    },\n    deleteUser: async (userId) => {\n      if (secondaryStorage) {\n        await secondaryStorage.delete(`active-sessions-${userId}`);\n      }\n      if (!secondaryStorage || options.session?.storeSessionInDatabase) {\n        await adapter.deleteMany({\n          model: \"session\",\n          where: [\n            {\n              field: \"userId\",\n              value: userId\n            }\n          ]\n        });\n      }\n      await adapter.deleteMany({\n        model: \"account\",\n        where: [\n          {\n            field: \"userId\",\n            value: userId\n          }\n        ]\n      });\n      await adapter.delete({\n        model: \"user\",\n        where: [\n          {\n            field: \"id\",\n            value: userId\n          }\n        ]\n      });\n    },\n    createSession: async (userId, ctx2, dontRememberMe, override, overrideAll) => {\n      const headers = ctx2.headers || ctx2.request?.headers;\n      const { id: _, ...rest } = override || {};\n      const data = {\n        ipAddress: ctx2.request || ctx2.headers ? (0,_better_auth_DcfNPS8q_mjs__WEBPACK_IMPORTED_MODULE_2__.g)(ctx2.request || ctx2.headers, ctx2.context.options) || \"\" : \"\",\n        userAgent: headers?.get(\"user-agent\") || \"\",\n        ...rest,\n        /**\n         * If the user doesn't want to be remembered\n         * set the session to expire in 1 day.\n         * The cookie will be set to expire at the end of the session\n         */\n        expiresAt: dontRememberMe ? (0,_better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_0__.g)(60 * 60 * 24, \"sec\") : (0,_better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_0__.g)(sessionExpiration, \"sec\"),\n        userId,\n        token: (0,_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_4__.g)(32),\n        createdAt: /* @__PURE__ */ new Date(),\n        updatedAt: /* @__PURE__ */ new Date(),\n        ...overrideAll ? rest : {}\n      };\n      const res = await createWithHooks(\n        data,\n        \"session\",\n        secondaryStorage ? {\n          fn: async (sessionData) => {\n            const currentList = await secondaryStorage.get(\n              `active-sessions-${userId}`\n            );\n            let list = [];\n            const now = Date.now();\n            if (currentList) {\n              list = (0,_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_3__.s)(currentList) || [];\n              list = list.filter((session) => session.expiresAt > now);\n            }\n            list.push({\n              token: data.token,\n              expiresAt: now + sessionExpiration * 1e3\n            });\n            await secondaryStorage.set(\n              `active-sessions-${userId}`,\n              JSON.stringify(list),\n              sessionExpiration\n            );\n            return sessionData;\n          },\n          executeMainFn: options.session?.storeSessionInDatabase\n        } : void 0,\n        ctx2\n      );\n      return res;\n    },\n    findSession: async (token) => {\n      if (secondaryStorage) {\n        const sessionStringified = await secondaryStorage.get(token);\n        if (!sessionStringified && !options.session?.storeSessionInDatabase) {\n          return null;\n        }\n        if (sessionStringified) {\n          const s = JSON.parse(sessionStringified);\n          const parsedSession2 = (0,_better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_1__.d)(ctx.options, {\n            ...s.session,\n            expiresAt: new Date(s.session.expiresAt),\n            createdAt: new Date(s.session.createdAt),\n            updatedAt: new Date(s.session.updatedAt)\n          });\n          const parsedUser2 = (0,_better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_1__.b)(ctx.options, {\n            ...s.user,\n            createdAt: new Date(s.user.createdAt),\n            updatedAt: new Date(s.user.updatedAt)\n          });\n          return {\n            session: parsedSession2,\n            user: parsedUser2\n          };\n        }\n      }\n      const session = await adapter.findOne({\n        model: \"session\",\n        where: [\n          {\n            value: token,\n            field: \"token\"\n          }\n        ]\n      });\n      if (!session) {\n        return null;\n      }\n      const user = await adapter.findOne({\n        model: \"user\",\n        where: [\n          {\n            value: session.userId,\n            field: \"id\"\n          }\n        ]\n      });\n      if (!user) {\n        return null;\n      }\n      const parsedSession = (0,_better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_1__.d)(ctx.options, session);\n      const parsedUser = (0,_better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_1__.b)(ctx.options, user);\n      return {\n        session: parsedSession,\n        user: parsedUser\n      };\n    },\n    findSessions: async (sessionTokens) => {\n      if (secondaryStorage) {\n        const sessions2 = [];\n        for (const sessionToken of sessionTokens) {\n          const sessionStringified = await secondaryStorage.get(sessionToken);\n          if (sessionStringified) {\n            const s = JSON.parse(sessionStringified);\n            const session = {\n              session: {\n                ...s.session,\n                expiresAt: new Date(s.session.expiresAt)\n              },\n              user: {\n                ...s.user,\n                createdAt: new Date(s.user.createdAt),\n                updatedAt: new Date(s.user.updatedAt)\n              }\n            };\n            sessions2.push(session);\n          }\n        }\n        return sessions2;\n      }\n      const sessions = await adapter.findMany({\n        model: \"session\",\n        where: [\n          {\n            field: \"token\",\n            value: sessionTokens,\n            operator: \"in\"\n          }\n        ]\n      });\n      const userIds = sessions.map((session) => {\n        return session.userId;\n      });\n      if (!userIds.length) return [];\n      const users = await adapter.findMany({\n        model: \"user\",\n        where: [\n          {\n            field: \"id\",\n            value: userIds,\n            operator: \"in\"\n          }\n        ]\n      });\n      return sessions.map((session) => {\n        const user = users.find((u) => u.id === session.userId);\n        if (!user) return null;\n        return {\n          session,\n          user\n        };\n      });\n    },\n    updateSession: async (sessionToken, session, context) => {\n      const updatedSession = await updateWithHooks(\n        session,\n        [{ field: \"token\", value: sessionToken }],\n        \"session\",\n        secondaryStorage ? {\n          async fn(data) {\n            const currentSession = await secondaryStorage.get(sessionToken);\n            let updatedSession2 = null;\n            if (currentSession) {\n              const parsedSession = JSON.parse(currentSession);\n              updatedSession2 = {\n                ...parsedSession.session,\n                ...data\n              };\n              return updatedSession2;\n            } else {\n              return null;\n            }\n          },\n          executeMainFn: options.session?.storeSessionInDatabase\n        } : void 0,\n        context\n      );\n      return updatedSession;\n    },\n    deleteSession: async (token) => {\n      if (secondaryStorage) {\n        await secondaryStorage.delete(token);\n        if (!options.session?.storeSessionInDatabase || ctx.options.session?.preserveSessionInDatabase) {\n          return;\n        }\n      }\n      await adapter.delete({\n        model: \"session\",\n        where: [\n          {\n            field: \"token\",\n            value: token\n          }\n        ]\n      });\n    },\n    deleteAccounts: async (userId) => {\n      await adapter.deleteMany({\n        model: \"account\",\n        where: [\n          {\n            field: \"userId\",\n            value: userId\n          }\n        ]\n      });\n    },\n    deleteAccount: async (accountId) => {\n      await adapter.delete({\n        model: \"account\",\n        where: [\n          {\n            field: \"id\",\n            value: accountId\n          }\n        ]\n      });\n    },\n    deleteSessions: async (userIdOrSessionTokens) => {\n      if (secondaryStorage) {\n        if (typeof userIdOrSessionTokens === \"string\") {\n          const activeSession = await secondaryStorage.get(\n            `active-sessions-${userIdOrSessionTokens}`\n          );\n          const sessions = activeSession ? (0,_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_3__.s)(activeSession) : [];\n          if (!sessions) return;\n          for (const session of sessions) {\n            await secondaryStorage.delete(session.token);\n          }\n        } else {\n          for (const sessionToken of userIdOrSessionTokens) {\n            const session = await secondaryStorage.get(sessionToken);\n            if (session) {\n              await secondaryStorage.delete(sessionToken);\n            }\n          }\n        }\n        if (!options.session?.storeSessionInDatabase || ctx.options.session?.preserveSessionInDatabase) {\n          return;\n        }\n      }\n      await adapter.deleteMany({\n        model: \"session\",\n        where: [\n          {\n            field: Array.isArray(userIdOrSessionTokens) ? \"token\" : \"userId\",\n            value: userIdOrSessionTokens,\n            operator: Array.isArray(userIdOrSessionTokens) ? \"in\" : void 0\n          }\n        ]\n      });\n    },\n    findOAuthUser: async (email, accountId, providerId) => {\n      const account = await adapter.findMany({\n        model: \"account\",\n        where: [\n          {\n            value: accountId,\n            field: \"accountId\"\n          }\n        ]\n      }).then((accounts) => {\n        return accounts.find((a) => a.providerId === providerId);\n      });\n      if (account) {\n        const user = await adapter.findOne({\n          model: \"user\",\n          where: [\n            {\n              value: account.userId,\n              field: \"id\"\n            }\n          ]\n        });\n        if (user) {\n          return {\n            user,\n            accounts: [account]\n          };\n        } else {\n          const user2 = await adapter.findOne({\n            model: \"user\",\n            where: [\n              {\n                value: email.toLowerCase(),\n                field: \"email\"\n              }\n            ]\n          });\n          if (user2) {\n            return {\n              user: user2,\n              accounts: [account]\n            };\n          }\n          return null;\n        }\n      } else {\n        const user = await adapter.findOne({\n          model: \"user\",\n          where: [\n            {\n              value: email.toLowerCase(),\n              field: \"email\"\n            }\n          ]\n        });\n        if (user) {\n          const accounts = await adapter.findMany({\n            model: \"account\",\n            where: [\n              {\n                value: user.id,\n                field: \"userId\"\n              }\n            ]\n          });\n          return {\n            user,\n            accounts: accounts || []\n          };\n        } else {\n          return null;\n        }\n      }\n    },\n    findUserByEmail: async (email, options2) => {\n      const user = await adapter.findOne({\n        model: \"user\",\n        where: [\n          {\n            value: email.toLowerCase(),\n            field: \"email\"\n          }\n        ]\n      });\n      if (!user) return null;\n      if (options2?.includeAccounts) {\n        const accounts = await adapter.findMany({\n          model: \"account\",\n          where: [\n            {\n              value: user.id,\n              field: \"userId\"\n            }\n          ]\n        });\n        return {\n          user,\n          accounts\n        };\n      }\n      return {\n        user,\n        accounts: []\n      };\n    },\n    findUserById: async (userId) => {\n      const user = await adapter.findOne({\n        model: \"user\",\n        where: [\n          {\n            field: \"id\",\n            value: userId\n          }\n        ]\n      });\n      return user;\n    },\n    linkAccount: async (account, context) => {\n      const _account = await createWithHooks(\n        {\n          ...account,\n          createdAt: /* @__PURE__ */ new Date(),\n          updatedAt: /* @__PURE__ */ new Date()\n        },\n        \"account\",\n        void 0,\n        context\n      );\n      return _account;\n    },\n    updateUser: async (userId, data, context) => {\n      const user = await updateWithHooks(\n        data,\n        [\n          {\n            field: \"id\",\n            value: userId\n          }\n        ],\n        \"user\",\n        void 0,\n        context\n      );\n      if (secondaryStorage && user) {\n        const listRaw = await secondaryStorage.get(`active-sessions-${userId}`);\n        if (listRaw) {\n          const now = Date.now();\n          const list = (0,_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_3__.s)(listRaw) || [];\n          const validSessions = list.filter((s) => s.expiresAt > now);\n          await Promise.all(\n            validSessions.map(async ({ token }) => {\n              const cached = await secondaryStorage.get(token);\n              if (!cached) return;\n              const parsed = (0,_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_3__.s)(cached);\n              if (!parsed) return;\n              const sessionTTL = Math.max(\n                Math.floor(\n                  (new Date(parsed.session.expiresAt).getTime() - now) / 1e3\n                ),\n                0\n              );\n              await secondaryStorage.set(\n                token,\n                JSON.stringify({\n                  session: parsed.session,\n                  user\n                }),\n                sessionTTL\n              );\n            })\n          );\n        }\n      }\n      return user;\n    },\n    updateUserByEmail: async (email, data, context) => {\n      const user = await updateWithHooks(\n        data,\n        [\n          {\n            field: \"email\",\n            value: email.toLowerCase()\n          }\n        ],\n        \"user\",\n        void 0,\n        context\n      );\n      return user;\n    },\n    updatePassword: async (userId, password, context) => {\n      await updateManyWithHooks(\n        {\n          password\n        },\n        [\n          {\n            field: \"userId\",\n            value: userId\n          },\n          {\n            field: \"providerId\",\n            value: \"credential\"\n          }\n        ],\n        \"account\",\n        void 0,\n        context\n      );\n    },\n    findAccounts: async (userId) => {\n      const accounts = await adapter.findMany({\n        model: \"account\",\n        where: [\n          {\n            field: \"userId\",\n            value: userId\n          }\n        ]\n      });\n      return accounts;\n    },\n    findAccount: async (accountId) => {\n      const account = await adapter.findOne({\n        model: \"account\",\n        where: [\n          {\n            field: \"accountId\",\n            value: accountId\n          }\n        ]\n      });\n      return account;\n    },\n    findAccountByProviderId: async (accountId, providerId) => {\n      const account = await adapter.findOne({\n        model: \"account\",\n        where: [\n          {\n            field: \"accountId\",\n            value: accountId\n          },\n          {\n            field: \"providerId\",\n            value: providerId\n          }\n        ]\n      });\n      return account;\n    },\n    findAccountByUserId: async (userId) => {\n      const account = await adapter.findMany({\n        model: \"account\",\n        where: [\n          {\n            field: \"userId\",\n            value: userId\n          }\n        ]\n      });\n      return account;\n    },\n    updateAccount: async (id, data, context) => {\n      const account = await updateWithHooks(\n        data,\n        [{ field: \"id\", value: id }],\n        \"account\",\n        void 0,\n        context\n      );\n      return account;\n    },\n    createVerificationValue: async (data, context) => {\n      const verification = await createWithHooks(\n        {\n          createdAt: /* @__PURE__ */ new Date(),\n          updatedAt: /* @__PURE__ */ new Date(),\n          ...data\n        },\n        \"verification\",\n        void 0,\n        context\n      );\n      return verification;\n    },\n    findVerificationValue: async (identifier) => {\n      const verification = await adapter.findMany({\n        model: \"verification\",\n        where: [\n          {\n            field: \"identifier\",\n            value: identifier\n          }\n        ],\n        sortBy: {\n          field: \"createdAt\",\n          direction: \"desc\"\n        },\n        limit: 1\n      });\n      if (!options.verification?.disableCleanup) {\n        await adapter.deleteMany({\n          model: \"verification\",\n          where: [\n            {\n              field: \"expiresAt\",\n              value: /* @__PURE__ */ new Date(),\n              operator: \"lt\"\n            }\n          ]\n        });\n      }\n      const lastVerification = verification[0];\n      return lastVerification;\n    },\n    deleteVerificationValue: async (id) => {\n      await adapter.delete({\n        model: \"verification\",\n        where: [\n          {\n            field: \"id\",\n            value: id\n          }\n        ]\n      });\n    },\n    deleteVerificationByIdentifier: async (identifier) => {\n      await adapter.delete({\n        model: \"verification\",\n        where: [\n          {\n            field: \"identifier\",\n            value: identifier\n          }\n        ]\n      });\n    },\n    updateVerificationValue: async (id, data, context) => {\n      const verification = await updateWithHooks(\n        data,\n        [{ field: \"id\", value: id }],\n        \"verification\",\n        void 0,\n        context\n      );\n      return verification;\n    }\n  };\n};\n\nasync function getAdapter(options) {\n  if (!options.database) {\n    const tables = (0,_better_auth_DORkW_Ge_mjs__WEBPACK_IMPORTED_MODULE_13__.g)(options);\n    const memoryDB = Object.keys(tables).reduce((acc, key) => {\n      acc[key] = [];\n      return acc;\n    }, {});\n    _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_4__.a.warn(\n      \"No database configuration provided. Using memory adapter in development\"\n    );\n    return (0,_better_auth_DGpadpzN_mjs__WEBPACK_IMPORTED_MODULE_16__.m)(memoryDB)(options);\n  }\n  if (typeof options.database === \"function\") {\n    return options.database(options);\n  }\n  const { kysely, databaseType } = await (0,_better_auth_DwzM_9N1_mjs__WEBPACK_IMPORTED_MODULE_15__.c)(options);\n  if (!kysely) {\n    throw new _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_14__.B(\"Failed to initialize database adapter\");\n  }\n  return (0,_better_auth_DwzM_9N1_mjs__WEBPACK_IMPORTED_MODULE_15__.k)(kysely, {\n    type: databaseType || \"sqlite\",\n    debugLogs: \"debugLogs\" in options.database ? options.database.debugLogs : false\n  })(options);\n}\nfunction convertToDB(fields, values) {\n  let result = values.id ? {\n    id: values.id\n  } : {};\n  for (const key in fields) {\n    const field = fields[key];\n    const value = values[key];\n    if (value === void 0) {\n      continue;\n    }\n    result[field.fieldName || key] = value;\n  }\n  return result;\n}\nfunction convertFromDB(fields, values) {\n  if (!values) {\n    return null;\n  }\n  let result = {\n    id: values.id\n  };\n  for (const [key, value] of Object.entries(fields)) {\n    result[key] = values[value.fieldName || key];\n  }\n  return result;\n}\n\nfunction getSchema(config) {\n  const tables = (0,_better_auth_DORkW_Ge_mjs__WEBPACK_IMPORTED_MODULE_13__.g)(config);\n  let schema = {};\n  for (const key in tables) {\n    const table = tables[key];\n    const fields = table.fields;\n    let actualFields = {};\n    Object.entries(fields).forEach(([key2, field]) => {\n      actualFields[field.fieldName || key2] = field;\n      if (field.references) {\n        const refTable = tables[field.references.model];\n        if (refTable) {\n          actualFields[field.fieldName || key2].references = {\n            model: refTable.modelName,\n            field: field.references.field\n          };\n        }\n      }\n    });\n    if (schema[table.modelName]) {\n      schema[table.modelName].fields = {\n        ...schema[table.modelName].fields,\n        ...actualFields\n      };\n      continue;\n    }\n    schema[table.modelName] = {\n      fields: actualFields,\n      order: table.order || Infinity\n    };\n  }\n  return schema;\n}\n\nconst postgresMap = {\n  string: [\"character varying\", \"varchar\", \"text\"],\n  number: [\n    \"int4\",\n    \"integer\",\n    \"bigint\",\n    \"smallint\",\n    \"numeric\",\n    \"real\",\n    \"double precision\"\n  ],\n  boolean: [\"bool\", \"boolean\"],\n  date: [\"timestamp\", \"date\"]\n};\nconst mysqlMap = {\n  string: [\"varchar\", \"text\"],\n  number: [\n    \"integer\",\n    \"int\",\n    \"bigint\",\n    \"smallint\",\n    \"decimal\",\n    \"float\",\n    \"double\"\n  ],\n  boolean: [\"boolean\", \"tinyint\"],\n  date: [\"timestamp\", \"datetime\", \"date\"]\n};\nconst sqliteMap = {\n  string: [\"TEXT\"],\n  number: [\"INTEGER\", \"REAL\"],\n  boolean: [\"INTEGER\", \"BOOLEAN\"],\n  // 0 or 1\n  date: [\"DATE\", \"INTEGER\"]\n};\nconst mssqlMap = {\n  string: [\"text\", \"varchar\"],\n  number: [\"int\", \"bigint\", \"smallint\", \"decimal\", \"float\", \"double\"],\n  boolean: [\"bit\", \"smallint\"],\n  date: [\"datetime\", \"date\"]\n};\nconst map = {\n  postgres: postgresMap,\n  mysql: mysqlMap,\n  sqlite: sqliteMap,\n  mssql: mssqlMap\n};\nfunction matchType(columnDataType, fieldType, dbType) {\n  function normalize(type) {\n    return type.toLowerCase().split(\"(\")[0].trim();\n  }\n  if (fieldType === \"string[]\" || fieldType === \"number[]\") {\n    return columnDataType.toLowerCase().includes(\"json\");\n  }\n  const types = map[dbType];\n  const expected = Array.isArray(fieldType) ? types[\"string\"].map((t) => t.toLowerCase()) : types[fieldType].map((t) => t.toLowerCase());\n  return expected.includes(normalize(columnDataType));\n}\nasync function getMigrations(config) {\n  const betterAuthSchema = getSchema(config);\n  const logger = (0,_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_4__.c)(config.logger);\n  let { kysely: db, databaseType: dbType } = await (0,_better_auth_DwzM_9N1_mjs__WEBPACK_IMPORTED_MODULE_15__.c)(config);\n  if (!dbType) {\n    logger.warn(\n      \"Could not determine database type, defaulting to sqlite. Please provide a type in the database options to avoid this.\"\n    );\n    dbType = \"sqlite\";\n  }\n  if (!db) {\n    logger.error(\n      \"Only kysely adapter is supported for migrations. You can use `generate` command to generate the schema, if you're using a different adapter.\"\n    );\n    process.exit(1);\n  }\n  const tableMetadata = await db.introspection.getTables();\n  const toBeCreated = [];\n  const toBeAdded = [];\n  for (const [key, value] of Object.entries(betterAuthSchema)) {\n    const table = tableMetadata.find((t) => t.name === key);\n    if (!table) {\n      const tIndex = toBeCreated.findIndex((t) => t.table === key);\n      const tableData = {\n        table: key,\n        fields: value.fields,\n        order: value.order || Infinity\n      };\n      const insertIndex = toBeCreated.findIndex(\n        (t) => (t.order || Infinity) > tableData.order\n      );\n      if (insertIndex === -1) {\n        if (tIndex === -1) {\n          toBeCreated.push(tableData);\n        } else {\n          toBeCreated[tIndex].fields = {\n            ...toBeCreated[tIndex].fields,\n            ...value.fields\n          };\n        }\n      } else {\n        toBeCreated.splice(insertIndex, 0, tableData);\n      }\n      continue;\n    }\n    let toBeAddedFields = {};\n    for (const [fieldName, field] of Object.entries(value.fields)) {\n      const column = table.columns.find((c) => c.name === fieldName);\n      if (!column) {\n        toBeAddedFields[fieldName] = field;\n        continue;\n      }\n      if (matchType(column.dataType, field.type, dbType)) {\n        continue;\n      } else {\n        logger.warn(\n          `Field ${fieldName} in table ${key} has a different type in the database. Expected ${field.type} but got ${column.dataType}.`\n        );\n      }\n    }\n    if (Object.keys(toBeAddedFields).length > 0) {\n      toBeAdded.push({\n        table: key,\n        fields: toBeAddedFields,\n        order: value.order || Infinity\n      });\n    }\n  }\n  const migrations = [];\n  function getType(field, fieldName) {\n    const type = field.type;\n    const typeMap = {\n      string: {\n        sqlite: \"text\",\n        postgres: \"text\",\n        mysql: field.unique ? \"varchar(255)\" : field.references ? \"varchar(36)\" : \"text\",\n        mssql: field.unique || field.sortable ? \"varchar(255)\" : field.references ? \"varchar(36)\" : \"text\"\n      },\n      boolean: {\n        sqlite: \"integer\",\n        postgres: \"boolean\",\n        mysql: \"boolean\",\n        mssql: \"smallint\"\n      },\n      number: {\n        sqlite: field.bigint ? \"bigint\" : \"integer\",\n        postgres: field.bigint ? \"bigint\" : \"integer\",\n        mysql: field.bigint ? \"bigint\" : \"integer\",\n        mssql: field.bigint ? \"bigint\" : \"integer\"\n      },\n      date: {\n        sqlite: \"date\",\n        postgres: \"timestamp\",\n        mysql: \"datetime\",\n        mssql: \"datetime\"\n      },\n      id: {\n        postgres: config.advanced?.database?.useNumberId ? \"serial\" : \"text\",\n        mysql: config.advanced?.database?.useNumberId ? \"integer\" : \"varchar(36)\",\n        mssql: config.advanced?.database?.useNumberId ? \"integer\" : \"varchar(36)\",\n        sqlite: config.advanced?.database?.useNumberId ? \"integer\" : \"text\"\n      }\n    };\n    if (fieldName === \"id\" || field.references?.field === \"id\") {\n      return typeMap.id[dbType];\n    }\n    if (dbType === \"sqlite\" && (type === \"string[]\" || type === \"number[]\")) {\n      return \"text\";\n    }\n    if (type === \"string[]\" || type === \"number[]\") {\n      return \"jsonb\";\n    }\n    if (Array.isArray(type)) {\n      return \"text\";\n    }\n    return typeMap[type][dbType || \"sqlite\"];\n  }\n  if (toBeAdded.length) {\n    for (const table of toBeAdded) {\n      for (const [fieldName, field] of Object.entries(table.fields)) {\n        const type = getType(field, fieldName);\n        const exec = db.schema.alterTable(table.table).addColumn(fieldName, type, (col) => {\n          col = field.required !== false ? col.notNull() : col;\n          if (field.references) {\n            col = col.references(\n              `${field.references.model}.${field.references.field}`\n            );\n          }\n          if (field.unique) {\n            col = col.unique();\n          }\n          return col;\n        });\n        migrations.push(exec);\n      }\n    }\n  }\n  if (toBeCreated.length) {\n    for (const table of toBeCreated) {\n      let dbT = db.schema.createTable(table.table).addColumn(\n        \"id\",\n        config.advanced?.database?.useNumberId ? dbType === \"postgres\" ? \"serial\" : \"integer\" : dbType === \"mysql\" || dbType === \"mssql\" ? \"varchar(36)\" : \"text\",\n        (col) => {\n          if (config.advanced?.database?.useNumberId) {\n            if (dbType === \"postgres\") {\n              return col.primaryKey().notNull();\n            }\n            return col.autoIncrement().primaryKey().notNull();\n          }\n          return col.primaryKey().notNull();\n        }\n      );\n      for (const [fieldName, field] of Object.entries(table.fields)) {\n        const type = getType(field, fieldName);\n        dbT = dbT.addColumn(fieldName, type, (col) => {\n          col = field.required !== false ? col.notNull() : col;\n          if (field.references) {\n            col = col.references(\n              `${field.references.model}.${field.references.field}`\n            );\n          }\n          if (field.unique) {\n            col = col.unique();\n          }\n          return col;\n        });\n      }\n      migrations.push(dbT);\n    }\n  }\n  async function runMigrations() {\n    for (const migration of migrations) {\n      await migration.execute();\n    }\n  }\n  async function compileMigrations() {\n    const compiled = migrations.map((m) => m.compile().sql);\n    return compiled.join(\";\\n\\n\") + \";\";\n  }\n  return { toBeCreated, toBeAdded, runMigrations, compileMigrations };\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLkJ5cnVQTjlxLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQTBEO0FBQ2lDO0FBQ25DO0FBQ1E7QUFDNkI7QUFDN0U7QUFDSztBQUNZO0FBQ0Y7QUFDRDtBQUNJO0FBQ0M7QUFDckI7QUFDZ0I7QUFDRjtBQUNJO0FBQ0g7QUFDTztBQUNBO0FBQ0Q7QUFDNkI7QUFDRTtBQUN3QjtBQUMxQjtBQUNoRDs7QUFFaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLHdEQUF3RDtBQUNsRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNB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QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLFdBQVc7QUFDdEM7QUFDQSxXQUFXO0FBQ1g7O0FBRW9LIiwic291cmNlcyI6WyIvVXNlcnMvbWlsYW4vRGVza3RvcC9BcHBzL2JldHRlci1hdXRoL25vZGVfbW9kdWxlcy9iZXR0ZXItYXV0aC9kaXN0L3NoYXJlZC9iZXR0ZXItYXV0aC5CeXJ1UE45cS5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZyBhcyBnZXREYXRlIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC5DVzZEOWVTeC5tanMnO1xuaW1wb3J0IHsgZCBhcyBwYXJzZVNlc3Npb25PdXRwdXQsIGIgYXMgcGFyc2VVc2VyT3V0cHV0IH0gZnJvbSAnLi9iZXR0ZXItYXV0aC5uMktGR3dqWS5tanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRJcCB9IGZyb20gJy4vYmV0dGVyLWF1dGguRGNmTlBTOHEubWpzJztcbmltcG9ydCB7IHMgYXMgc2FmZUpTT05QYXJzZSB9IGZyb20gJy4vYmV0dGVyLWF1dGgudEI1ZVU2RVkubWpzJztcbmltcG9ydCB7IGcgYXMgZ2VuZXJhdGVJZCwgYSBhcyBsb2dnZXIsIGMgYXMgY3JlYXRlTG9nZ2VyIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC5EQkdmSURuaC5tanMnO1xuaW1wb3J0ICd6b2QvdjQnO1xuaW1wb3J0ICdiZXR0ZXItY2FsbCc7XG5pbXBvcnQgJ0BiZXR0ZXItYXV0aC91dGlscy9oYXNoJztcbmltcG9ydCAnQG5vYmxlL2NpcGhlcnMvY2hhY2hhJztcbmltcG9ydCAnQG5vYmxlL2NpcGhlcnMvdXRpbHMnO1xuaW1wb3J0ICdAbm9ibGUvY2lwaGVycy93ZWJjcnlwdG8nO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMvYmFzZTY0JztcbmltcG9ydCAnam9zZSc7XG5pbXBvcnQgJ0Bub2JsZS9oYXNoZXMvc2NyeXB0JztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzJztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzL2hleCc7XG5pbXBvcnQgJ0Bub2JsZS9oYXNoZXMvdXRpbHMnO1xuaW1wb3J0ICcuL2JldHRlci1hdXRoLkI0UW94ZGdjLm1qcyc7XG5pbXBvcnQgJy4vYmV0dGVyLWF1dGguOHpveHpnLUYubWpzJztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzL3JhbmRvbSc7XG5pbXBvcnQgeyBnIGFzIGdldEF1dGhUYWJsZXMgfSBmcm9tICcuL2JldHRlci1hdXRoLkRPUmtXX0dlLm1qcyc7XG5pbXBvcnQgeyBCIGFzIEJldHRlckF1dGhFcnJvciB9IGZyb20gJy4vYmV0dGVyLWF1dGguRGR6U0pmLW4ubWpzJztcbmltcG9ydCB7IGMgYXMgY3JlYXRlS3lzZWx5QWRhcHRlciwgayBhcyBreXNlbHlBZGFwdGVyIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC5Ed3pNLTlOMS5tanMnO1xuaW1wb3J0IHsgbSBhcyBtZW1vcnlBZGFwdGVyIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC5ER3BhZHB6Ti5tanMnO1xuaW1wb3J0ICdreXNlbHknO1xuXG5mdW5jdGlvbiBnZXRXaXRoSG9va3MoYWRhcHRlciwgY3R4KSB7XG4gIGNvbnN0IGhvb2tzID0gY3R4Lmhvb2tzO1xuICBhc3luYyBmdW5jdGlvbiBjcmVhdGVXaXRoSG9va3MoZGF0YSwgbW9kZWwsIGN1c3RvbUNyZWF0ZUZuLCBjb250ZXh0KSB7XG4gICAgbGV0IGFjdHVhbERhdGEgPSBkYXRhO1xuICAgIGZvciAoY29uc3QgaG9vayBvZiBob29rcyB8fCBbXSkge1xuICAgICAgY29uc3QgdG9SdW4gPSBob29rW21vZGVsXT8uY3JlYXRlPy5iZWZvcmU7XG4gICAgICBpZiAodG9SdW4pIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdG9SdW4oYWN0dWFsRGF0YSwgY29udGV4dCk7XG4gICAgICAgIGlmIChyZXN1bHQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaXNPYmplY3QgPSB0eXBlb2YgcmVzdWx0ID09PSBcIm9iamVjdFwiICYmIFwiZGF0YVwiIGluIHJlc3VsdDtcbiAgICAgICAgaWYgKGlzT2JqZWN0KSB7XG4gICAgICAgICAgYWN0dWFsRGF0YSA9IHtcbiAgICAgICAgICAgIC4uLmFjdHVhbERhdGEsXG4gICAgICAgICAgICAuLi5yZXN1bHQuZGF0YVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgY3VzdG9tQ3JlYXRlZCA9IGN1c3RvbUNyZWF0ZUZuID8gYXdhaXQgY3VzdG9tQ3JlYXRlRm4uZm4oYWN0dWFsRGF0YSkgOiBudWxsO1xuICAgIGNvbnN0IGNyZWF0ZWQgPSAhY3VzdG9tQ3JlYXRlRm4gfHwgY3VzdG9tQ3JlYXRlRm4uZXhlY3V0ZU1haW5GbiA/IGF3YWl0IGFkYXB0ZXIuY3JlYXRlKHtcbiAgICAgIG1vZGVsLFxuICAgICAgZGF0YTogYWN0dWFsRGF0YSxcbiAgICAgIGZvcmNlQWxsb3dJZDogdHJ1ZVxuICAgIH0pIDogY3VzdG9tQ3JlYXRlZDtcbiAgICBmb3IgKGNvbnN0IGhvb2sgb2YgaG9va3MgfHwgW10pIHtcbiAgICAgIGNvbnN0IHRvUnVuID0gaG9va1ttb2RlbF0/LmNyZWF0ZT8uYWZ0ZXI7XG4gICAgICBpZiAodG9SdW4pIHtcbiAgICAgICAgYXdhaXQgdG9SdW4oY3JlYXRlZCwgY29udGV4dCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjcmVhdGVkO1xuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVdpdGhIb29rcyhkYXRhLCB3aGVyZSwgbW9kZWwsIGN1c3RvbVVwZGF0ZUZuLCBjb250ZXh0KSB7XG4gICAgbGV0IGFjdHVhbERhdGEgPSBkYXRhO1xuICAgIGZvciAoY29uc3QgaG9vayBvZiBob29rcyB8fCBbXSkge1xuICAgICAgY29uc3QgdG9SdW4gPSBob29rW21vZGVsXT8udXBkYXRlPy5iZWZvcmU7XG4gICAgICBpZiAodG9SdW4pIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdG9SdW4oZGF0YSwgY29udGV4dCk7XG4gICAgICAgIGlmIChyZXN1bHQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaXNPYmplY3QgPSB0eXBlb2YgcmVzdWx0ID09PSBcIm9iamVjdFwiO1xuICAgICAgICBhY3R1YWxEYXRhID0gaXNPYmplY3QgPyByZXN1bHQuZGF0YSA6IHJlc3VsdDtcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgY3VzdG9tVXBkYXRlZCA9IGN1c3RvbVVwZGF0ZUZuID8gYXdhaXQgY3VzdG9tVXBkYXRlRm4uZm4oYWN0dWFsRGF0YSkgOiBudWxsO1xuICAgIGNvbnN0IHVwZGF0ZWQgPSAhY3VzdG9tVXBkYXRlRm4gfHwgY3VzdG9tVXBkYXRlRm4uZXhlY3V0ZU1haW5GbiA/IGF3YWl0IGFkYXB0ZXIudXBkYXRlKHtcbiAgICAgIG1vZGVsLFxuICAgICAgdXBkYXRlOiBhY3R1YWxEYXRhLFxuICAgICAgd2hlcmVcbiAgICB9KSA6IGN1c3RvbVVwZGF0ZWQ7XG4gICAgZm9yIChjb25zdCBob29rIG9mIGhvb2tzIHx8IFtdKSB7XG4gICAgICBjb25zdCB0b1J1biA9IGhvb2tbbW9kZWxdPy51cGRhdGU/LmFmdGVyO1xuICAgICAgaWYgKHRvUnVuKSB7XG4gICAgICAgIGF3YWl0IHRvUnVuKHVwZGF0ZWQsIGNvbnRleHQpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdXBkYXRlZDtcbiAgfVxuICBhc3luYyBmdW5jdGlvbiB1cGRhdGVNYW55V2l0aEhvb2tzKGRhdGEsIHdoZXJlLCBtb2RlbCwgY3VzdG9tVXBkYXRlRm4sIGNvbnRleHQpIHtcbiAgICBsZXQgYWN0dWFsRGF0YSA9IGRhdGE7XG4gICAgZm9yIChjb25zdCBob29rIG9mIGhvb2tzIHx8IFtdKSB7XG4gICAgICBjb25zdCB0b1J1biA9IGhvb2tbbW9kZWxdPy51cGRhdGU/LmJlZm9yZTtcbiAgICAgIGlmICh0b1J1bikge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0b1J1bihkYXRhLCBjb250ZXh0KTtcbiAgICAgICAgaWYgKHJlc3VsdCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpc09iamVjdCA9IHR5cGVvZiByZXN1bHQgPT09IFwib2JqZWN0XCI7XG4gICAgICAgIGFjdHVhbERhdGEgPSBpc09iamVjdCA/IHJlc3VsdC5kYXRhIDogcmVzdWx0O1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBjdXN0b21VcGRhdGVkID0gY3VzdG9tVXBkYXRlRm4gPyBhd2FpdCBjdXN0b21VcGRhdGVGbi5mbihhY3R1YWxEYXRhKSA6IG51bGw7XG4gICAgY29uc3QgdXBkYXRlZCA9ICFjdXN0b21VcGRhdGVGbiB8fCBjdXN0b21VcGRhdGVGbi5leGVjdXRlTWFpbkZuID8gYXdhaXQgYWRhcHRlci51cGRhdGVNYW55KHtcbiAgICAgIG1vZGVsLFxuICAgICAgdXBkYXRlOiBhY3R1YWxEYXRhLFxuICAgICAgd2hlcmVcbiAgICB9KSA6IGN1c3RvbVVwZGF0ZWQ7XG4gICAgZm9yIChjb25zdCBob29rIG9mIGhvb2tzIHx8IFtdKSB7XG4gICAgICBjb25zdCB0b1J1biA9IGhvb2tbbW9kZWxdPy51cGRhdGU/LmFmdGVyO1xuICAgICAgaWYgKHRvUnVuKSB7XG4gICAgICAgIGF3YWl0IHRvUnVuKHVwZGF0ZWQsIGNvbnRleHQpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdXBkYXRlZDtcbiAgfVxuICByZXR1cm4ge1xuICAgIGNyZWF0ZVdpdGhIb29rcyxcbiAgICB1cGRhdGVXaXRoSG9va3MsXG4gICAgdXBkYXRlTWFueVdpdGhIb29rc1xuICB9O1xufVxuXG5jb25zdCBjcmVhdGVJbnRlcm5hbEFkYXB0ZXIgPSAoYWRhcHRlciwgY3R4KSA9PiB7XG4gIGNvbnN0IG9wdGlvbnMgPSBjdHgub3B0aW9ucztcbiAgY29uc3Qgc2Vjb25kYXJ5U3RvcmFnZSA9IG9wdGlvbnMuc2Vjb25kYXJ5U3RvcmFnZTtcbiAgY29uc3Qgc2Vzc2lvbkV4cGlyYXRpb24gPSBvcHRpb25zLnNlc3Npb24/LmV4cGlyZXNJbiB8fCA2MCAqIDYwICogMjQgKiA3O1xuICBjb25zdCB7IGNyZWF0ZVdpdGhIb29rcywgdXBkYXRlV2l0aEhvb2tzLCB1cGRhdGVNYW55V2l0aEhvb2tzIH0gPSBnZXRXaXRoSG9va3MoYWRhcHRlciwgY3R4KTtcbiAgcmV0dXJuIHtcbiAgICBjcmVhdGVPQXV0aFVzZXI6IGFzeW5jICh1c2VyLCBhY2NvdW50LCBjb250ZXh0KSA9PiB7XG4gICAgICBjb25zdCBjcmVhdGVkVXNlciA9IGF3YWl0IGNyZWF0ZVdpdGhIb29rcyhcbiAgICAgICAge1xuICAgICAgICAgIGNyZWF0ZWRBdDogLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCksXG4gICAgICAgICAgdXBkYXRlZEF0OiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSxcbiAgICAgICAgICAuLi51c2VyXG4gICAgICAgIH0sXG4gICAgICAgIFwidXNlclwiLFxuICAgICAgICB2b2lkIDAsXG4gICAgICAgIGNvbnRleHRcbiAgICAgICk7XG4gICAgICBjb25zdCBjcmVhdGVkQWNjb3VudCA9IGF3YWl0IGNyZWF0ZVdpdGhIb29rcyhcbiAgICAgICAge1xuICAgICAgICAgIC4uLmFjY291bnQsXG4gICAgICAgICAgdXNlcklkOiBjcmVhdGVkVXNlci5pZCB8fCB1c2VyLmlkLFxuICAgICAgICAgIGNyZWF0ZWRBdDogLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCksXG4gICAgICAgICAgdXBkYXRlZEF0OiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKVxuICAgICAgICB9LFxuICAgICAgICBcImFjY291bnRcIixcbiAgICAgICAgdm9pZCAwLFxuICAgICAgICBjb250ZXh0XG4gICAgICApO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXNlcjogY3JlYXRlZFVzZXIsXG4gICAgICAgIGFjY291bnQ6IGNyZWF0ZWRBY2NvdW50XG4gICAgICB9O1xuICAgIH0sXG4gICAgY3JlYXRlVXNlcjogYXN5bmMgKHVzZXIsIGNvbnRleHQpID0+IHtcbiAgICAgIGNvbnN0IGNyZWF0ZWRVc2VyID0gYXdhaXQgY3JlYXRlV2l0aEhvb2tzKFxuICAgICAgICB7XG4gICAgICAgICAgY3JlYXRlZEF0OiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSxcbiAgICAgICAgICB1cGRhdGVkQXQ6IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IGZhbHNlLFxuICAgICAgICAgIC4uLnVzZXIsXG4gICAgICAgICAgZW1haWw6IHVzZXIuZW1haWw/LnRvTG93ZXJDYXNlKClcbiAgICAgICAgfSxcbiAgICAgICAgXCJ1c2VyXCIsXG4gICAgICAgIHZvaWQgMCxcbiAgICAgICAgY29udGV4dFxuICAgICAgKTtcbiAgICAgIHJldHVybiBjcmVhdGVkVXNlcjtcbiAgICB9LFxuICAgIGNyZWF0ZUFjY291bnQ6IGFzeW5jIChhY2NvdW50LCBjb250ZXh0KSA9PiB7XG4gICAgICBjb25zdCBjcmVhdGVkQWNjb3VudCA9IGF3YWl0IGNyZWF0ZVdpdGhIb29rcyhcbiAgICAgICAge1xuICAgICAgICAgIGNyZWF0ZWRBdDogLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCksXG4gICAgICAgICAgdXBkYXRlZEF0OiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSxcbiAgICAgICAgICAuLi5hY2NvdW50XG4gICAgICAgIH0sXG4gICAgICAgIFwiYWNjb3VudFwiLFxuICAgICAgICB2b2lkIDAsXG4gICAgICAgIGNvbnRleHRcbiAgICAgICk7XG4gICAgICByZXR1cm4gY3JlYXRlZEFjY291bnQ7XG4gICAgfSxcbiAgICBsaXN0U2Vzc2lvbnM6IGFzeW5jICh1c2VySWQpID0+IHtcbiAgICAgIGlmIChzZWNvbmRhcnlTdG9yYWdlKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRMaXN0ID0gYXdhaXQgc2Vjb25kYXJ5U3RvcmFnZS5nZXQoXG4gICAgICAgICAgYGFjdGl2ZS1zZXNzaW9ucy0ke3VzZXJJZH1gXG4gICAgICAgICk7XG4gICAgICAgIGlmICghY3VycmVudExpc3QpIHJldHVybiBbXTtcbiAgICAgICAgY29uc3QgbGlzdCA9IHNhZmVKU09OUGFyc2UoY3VycmVudExpc3QpIHx8IFtdO1xuICAgICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgICAgICBjb25zdCB2YWxpZFNlc3Npb25zID0gbGlzdC5maWx0ZXIoKHMpID0+IHMuZXhwaXJlc0F0ID4gbm93KTtcbiAgICAgICAgY29uc3Qgc2Vzc2lvbnMyID0gW107XG4gICAgICAgIGZvciAoY29uc3Qgc2Vzc2lvbiBvZiB2YWxpZFNlc3Npb25zKSB7XG4gICAgICAgICAgY29uc3Qgc2Vzc2lvblN0cmluZ2lmaWVkID0gYXdhaXQgc2Vjb25kYXJ5U3RvcmFnZS5nZXQoc2Vzc2lvbi50b2tlbik7XG4gICAgICAgICAgaWYgKHNlc3Npb25TdHJpbmdpZmllZCkge1xuICAgICAgICAgICAgY29uc3QgcyA9IEpTT04ucGFyc2Uoc2Vzc2lvblN0cmluZ2lmaWVkKTtcbiAgICAgICAgICAgIGNvbnN0IHBhcnNlZFNlc3Npb24gPSBwYXJzZVNlc3Npb25PdXRwdXQoY3R4Lm9wdGlvbnMsIHtcbiAgICAgICAgICAgICAgLi4ucy5zZXNzaW9uLFxuICAgICAgICAgICAgICBleHBpcmVzQXQ6IG5ldyBEYXRlKHMuc2Vzc2lvbi5leHBpcmVzQXQpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHNlc3Npb25zMi5wdXNoKHBhcnNlZFNlc3Npb24pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc2Vzc2lvbnMyO1xuICAgICAgfVxuICAgICAgY29uc3Qgc2Vzc2lvbnMgPSBhd2FpdCBhZGFwdGVyLmZpbmRNYW55KHtcbiAgICAgICAgbW9kZWw6IFwic2Vzc2lvblwiLFxuICAgICAgICB3aGVyZTogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiBcInVzZXJJZFwiLFxuICAgICAgICAgICAgdmFsdWU6IHVzZXJJZFxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gc2Vzc2lvbnM7XG4gICAgfSxcbiAgICBsaXN0VXNlcnM6IGFzeW5jIChsaW1pdCwgb2Zmc2V0LCBzb3J0QnksIHdoZXJlKSA9PiB7XG4gICAgICBjb25zdCB1c2VycyA9IGF3YWl0IGFkYXB0ZXIuZmluZE1hbnkoe1xuICAgICAgICBtb2RlbDogXCJ1c2VyXCIsXG4gICAgICAgIGxpbWl0LFxuICAgICAgICBvZmZzZXQsXG4gICAgICAgIHNvcnRCeSxcbiAgICAgICAgd2hlcmVcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHVzZXJzO1xuICAgIH0sXG4gICAgY291bnRUb3RhbFVzZXJzOiBhc3luYyAod2hlcmUpID0+IHtcbiAgICAgIGNvbnN0IHRvdGFsID0gYXdhaXQgYWRhcHRlci5jb3VudCh7XG4gICAgICAgIG1vZGVsOiBcInVzZXJcIixcbiAgICAgICAgd2hlcmVcbiAgICAgIH0pO1xuICAgICAgaWYgKHR5cGVvZiB0b3RhbCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICByZXR1cm4gcGFyc2VJbnQodG90YWwpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRvdGFsO1xuICAgIH0sXG4gICAgZGVsZXRlVXNlcjogYXN5bmMgKHVzZXJJZCkgPT4ge1xuICAgICAgaWYgKHNlY29uZGFyeVN0b3JhZ2UpIHtcbiAgICAgICAgYXdhaXQgc2Vjb25kYXJ5U3RvcmFnZS5kZWxldGUoYGFjdGl2ZS1zZXNzaW9ucy0ke3VzZXJJZH1gKTtcbiAgICAgIH1cbiAgICAgIGlmICghc2Vjb25kYXJ5U3RvcmFnZSB8fCBvcHRpb25zLnNlc3Npb24/LnN0b3JlU2Vzc2lvbkluRGF0YWJhc2UpIHtcbiAgICAgICAgYXdhaXQgYWRhcHRlci5kZWxldGVNYW55KHtcbiAgICAgICAgICBtb2RlbDogXCJzZXNzaW9uXCIsXG4gICAgICAgICAgd2hlcmU6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgZmllbGQ6IFwidXNlcklkXCIsXG4gICAgICAgICAgICAgIHZhbHVlOiB1c2VySWRcbiAgICAgICAgICAgIH1cbiAgICAgICAgICBdXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgYXdhaXQgYWRhcHRlci5kZWxldGVNYW55KHtcbiAgICAgICAgbW9kZWw6IFwiYWNjb3VudFwiLFxuICAgICAgICB3aGVyZTogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiBcInVzZXJJZFwiLFxuICAgICAgICAgICAgdmFsdWU6IHVzZXJJZFxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfSk7XG4gICAgICBhd2FpdCBhZGFwdGVyLmRlbGV0ZSh7XG4gICAgICAgIG1vZGVsOiBcInVzZXJcIixcbiAgICAgICAgd2hlcmU6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogXCJpZFwiLFxuICAgICAgICAgICAgdmFsdWU6IHVzZXJJZFxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfSk7XG4gICAgfSxcbiAgICBjcmVhdGVTZXNzaW9uOiBhc3luYyAodXNlcklkLCBjdHgyLCBkb250UmVtZW1iZXJNZSwgb3ZlcnJpZGUsIG92ZXJyaWRlQWxsKSA9PiB7XG4gICAgICBjb25zdCBoZWFkZXJzID0gY3R4Mi5oZWFkZXJzIHx8IGN0eDIucmVxdWVzdD8uaGVhZGVycztcbiAgICAgIGNvbnN0IHsgaWQ6IF8sIC4uLnJlc3QgfSA9IG92ZXJyaWRlIHx8IHt9O1xuICAgICAgY29uc3QgZGF0YSA9IHtcbiAgICAgICAgaXBBZGRyZXNzOiBjdHgyLnJlcXVlc3QgfHwgY3R4Mi5oZWFkZXJzID8gZ2V0SXAoY3R4Mi5yZXF1ZXN0IHx8IGN0eDIuaGVhZGVycywgY3R4Mi5jb250ZXh0Lm9wdGlvbnMpIHx8IFwiXCIgOiBcIlwiLFxuICAgICAgICB1c2VyQWdlbnQ6IGhlYWRlcnM/LmdldChcInVzZXItYWdlbnRcIikgfHwgXCJcIixcbiAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIElmIHRoZSB1c2VyIGRvZXNuJ3Qgd2FudCB0byBiZSByZW1lbWJlcmVkXG4gICAgICAgICAqIHNldCB0aGUgc2Vzc2lvbiB0byBleHBpcmUgaW4gMSBkYXkuXG4gICAgICAgICAqIFRoZSBjb29raWUgd2lsbCBiZSBzZXQgdG8gZXhwaXJlIGF0IHRoZSBlbmQgb2YgdGhlIHNlc3Npb25cbiAgICAgICAgICovXG4gICAgICAgIGV4cGlyZXNBdDogZG9udFJlbWVtYmVyTWUgPyBnZXREYXRlKDYwICogNjAgKiAyNCwgXCJzZWNcIikgOiBnZXREYXRlKHNlc3Npb25FeHBpcmF0aW9uLCBcInNlY1wiKSxcbiAgICAgICAgdXNlcklkLFxuICAgICAgICB0b2tlbjogZ2VuZXJhdGVJZCgzMiksXG4gICAgICAgIGNyZWF0ZWRBdDogLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCksXG4gICAgICAgIC4uLm92ZXJyaWRlQWxsID8gcmVzdCA6IHt9XG4gICAgICB9O1xuICAgICAgY29uc3QgcmVzID0gYXdhaXQgY3JlYXRlV2l0aEhvb2tzKFxuICAgICAgICBkYXRhLFxuICAgICAgICBcInNlc3Npb25cIixcbiAgICAgICAgc2Vjb25kYXJ5U3RvcmFnZSA/IHtcbiAgICAgICAgICBmbjogYXN5bmMgKHNlc3Npb25EYXRhKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50TGlzdCA9IGF3YWl0IHNlY29uZGFyeVN0b3JhZ2UuZ2V0KFxuICAgICAgICAgICAgICBgYWN0aXZlLXNlc3Npb25zLSR7dXNlcklkfWBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBsZXQgbGlzdCA9IFtdO1xuICAgICAgICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgIGlmIChjdXJyZW50TGlzdCkge1xuICAgICAgICAgICAgICBsaXN0ID0gc2FmZUpTT05QYXJzZShjdXJyZW50TGlzdCkgfHwgW107XG4gICAgICAgICAgICAgIGxpc3QgPSBsaXN0LmZpbHRlcigoc2Vzc2lvbikgPT4gc2Vzc2lvbi5leHBpcmVzQXQgPiBub3cpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGlzdC5wdXNoKHtcbiAgICAgICAgICAgICAgdG9rZW46IGRhdGEudG9rZW4sXG4gICAgICAgICAgICAgIGV4cGlyZXNBdDogbm93ICsgc2Vzc2lvbkV4cGlyYXRpb24gKiAxZTNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgYXdhaXQgc2Vjb25kYXJ5U3RvcmFnZS5zZXQoXG4gICAgICAgICAgICAgIGBhY3RpdmUtc2Vzc2lvbnMtJHt1c2VySWR9YCxcbiAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkobGlzdCksXG4gICAgICAgICAgICAgIHNlc3Npb25FeHBpcmF0aW9uXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuIHNlc3Npb25EYXRhO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZXhlY3V0ZU1haW5Gbjogb3B0aW9ucy5zZXNzaW9uPy5zdG9yZVNlc3Npb25JbkRhdGFiYXNlXG4gICAgICAgIH0gOiB2b2lkIDAsXG4gICAgICAgIGN0eDJcbiAgICAgICk7XG4gICAgICByZXR1cm4gcmVzO1xuICAgIH0sXG4gICAgZmluZFNlc3Npb246IGFzeW5jICh0b2tlbikgPT4ge1xuICAgICAgaWYgKHNlY29uZGFyeVN0b3JhZ2UpIHtcbiAgICAgICAgY29uc3Qgc2Vzc2lvblN0cmluZ2lmaWVkID0gYXdhaXQgc2Vjb25kYXJ5U3RvcmFnZS5nZXQodG9rZW4pO1xuICAgICAgICBpZiAoIXNlc3Npb25TdHJpbmdpZmllZCAmJiAhb3B0aW9ucy5zZXNzaW9uPy5zdG9yZVNlc3Npb25JbkRhdGFiYXNlKSB7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNlc3Npb25TdHJpbmdpZmllZCkge1xuICAgICAgICAgIGNvbnN0IHMgPSBKU09OLnBhcnNlKHNlc3Npb25TdHJpbmdpZmllZCk7XG4gICAgICAgICAgY29uc3QgcGFyc2VkU2Vzc2lvbjIgPSBwYXJzZVNlc3Npb25PdXRwdXQoY3R4Lm9wdGlvbnMsIHtcbiAgICAgICAgICAgIC4uLnMuc2Vzc2lvbixcbiAgICAgICAgICAgIGV4cGlyZXNBdDogbmV3IERhdGUocy5zZXNzaW9uLmV4cGlyZXNBdCksXG4gICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKHMuc2Vzc2lvbi5jcmVhdGVkQXQpLFxuICAgICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZShzLnNlc3Npb24udXBkYXRlZEF0KVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbnN0IHBhcnNlZFVzZXIyID0gcGFyc2VVc2VyT3V0cHV0KGN0eC5vcHRpb25zLCB7XG4gICAgICAgICAgICAuLi5zLnVzZXIsXG4gICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKHMudXNlci5jcmVhdGVkQXQpLFxuICAgICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZShzLnVzZXIudXBkYXRlZEF0KVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzZXNzaW9uOiBwYXJzZWRTZXNzaW9uMixcbiAgICAgICAgICAgIHVzZXI6IHBhcnNlZFVzZXIyXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGFkYXB0ZXIuZmluZE9uZSh7XG4gICAgICAgIG1vZGVsOiBcInNlc3Npb25cIixcbiAgICAgICAgd2hlcmU6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogdG9rZW4sXG4gICAgICAgICAgICBmaWVsZDogXCJ0b2tlblwiXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9KTtcbiAgICAgIGlmICghc2Vzc2lvbikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBhZGFwdGVyLmZpbmRPbmUoe1xuICAgICAgICBtb2RlbDogXCJ1c2VyXCIsXG4gICAgICAgIHdoZXJlOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6IHNlc3Npb24udXNlcklkLFxuICAgICAgICAgICAgZmllbGQ6IFwiaWRcIlxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfSk7XG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICBjb25zdCBwYXJzZWRTZXNzaW9uID0gcGFyc2VTZXNzaW9uT3V0cHV0KGN0eC5vcHRpb25zLCBzZXNzaW9uKTtcbiAgICAgIGNvbnN0IHBhcnNlZFVzZXIgPSBwYXJzZVVzZXJPdXRwdXQoY3R4Lm9wdGlvbnMsIHVzZXIpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc2Vzc2lvbjogcGFyc2VkU2Vzc2lvbixcbiAgICAgICAgdXNlcjogcGFyc2VkVXNlclxuICAgICAgfTtcbiAgICB9LFxuICAgIGZpbmRTZXNzaW9uczogYXN5bmMgKHNlc3Npb25Ub2tlbnMpID0+IHtcbiAgICAgIGlmIChzZWNvbmRhcnlTdG9yYWdlKSB7XG4gICAgICAgIGNvbnN0IHNlc3Npb25zMiA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IHNlc3Npb25Ub2tlbiBvZiBzZXNzaW9uVG9rZW5zKSB7XG4gICAgICAgICAgY29uc3Qgc2Vzc2lvblN0cmluZ2lmaWVkID0gYXdhaXQgc2Vjb25kYXJ5U3RvcmFnZS5nZXQoc2Vzc2lvblRva2VuKTtcbiAgICAgICAgICBpZiAoc2Vzc2lvblN0cmluZ2lmaWVkKSB7XG4gICAgICAgICAgICBjb25zdCBzID0gSlNPTi5wYXJzZShzZXNzaW9uU3RyaW5naWZpZWQpO1xuICAgICAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IHtcbiAgICAgICAgICAgICAgc2Vzc2lvbjoge1xuICAgICAgICAgICAgICAgIC4uLnMuc2Vzc2lvbixcbiAgICAgICAgICAgICAgICBleHBpcmVzQXQ6IG5ldyBEYXRlKHMuc2Vzc2lvbi5leHBpcmVzQXQpXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAuLi5zLnVzZXIsXG4gICAgICAgICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZShzLnVzZXIuY3JlYXRlZEF0KSxcbiAgICAgICAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKHMudXNlci51cGRhdGVkQXQpXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBzZXNzaW9uczIucHVzaChzZXNzaW9uKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHNlc3Npb25zMjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHNlc3Npb25zID0gYXdhaXQgYWRhcHRlci5maW5kTWFueSh7XG4gICAgICAgIG1vZGVsOiBcInNlc3Npb25cIixcbiAgICAgICAgd2hlcmU6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogXCJ0b2tlblwiLFxuICAgICAgICAgICAgdmFsdWU6IHNlc3Npb25Ub2tlbnMsXG4gICAgICAgICAgICBvcGVyYXRvcjogXCJpblwiXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHVzZXJJZHMgPSBzZXNzaW9ucy5tYXAoKHNlc3Npb24pID0+IHtcbiAgICAgICAgcmV0dXJuIHNlc3Npb24udXNlcklkO1xuICAgICAgfSk7XG4gICAgICBpZiAoIXVzZXJJZHMubGVuZ3RoKSByZXR1cm4gW107XG4gICAgICBjb25zdCB1c2VycyA9IGF3YWl0IGFkYXB0ZXIuZmluZE1hbnkoe1xuICAgICAgICBtb2RlbDogXCJ1c2VyXCIsXG4gICAgICAgIHdoZXJlOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6IFwiaWRcIixcbiAgICAgICAgICAgIHZhbHVlOiB1c2VySWRzLFxuICAgICAgICAgICAgb3BlcmF0b3I6IFwiaW5cIlxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gc2Vzc2lvbnMubWFwKChzZXNzaW9uKSA9PiB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSB1c2Vycy5maW5kKCh1KSA9PiB1LmlkID09PSBzZXNzaW9uLnVzZXJJZCk7XG4gICAgICAgIGlmICghdXNlcikgcmV0dXJuIG51bGw7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc2Vzc2lvbixcbiAgICAgICAgICB1c2VyXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHVwZGF0ZVNlc3Npb246IGFzeW5jIChzZXNzaW9uVG9rZW4sIHNlc3Npb24sIGNvbnRleHQpID0+IHtcbiAgICAgIGNvbnN0IHVwZGF0ZWRTZXNzaW9uID0gYXdhaXQgdXBkYXRlV2l0aEhvb2tzKFxuICAgICAgICBzZXNzaW9uLFxuICAgICAgICBbeyBmaWVsZDogXCJ0b2tlblwiLCB2YWx1ZTogc2Vzc2lvblRva2VuIH1dLFxuICAgICAgICBcInNlc3Npb25cIixcbiAgICAgICAgc2Vjb25kYXJ5U3RvcmFnZSA/IHtcbiAgICAgICAgICBhc3luYyBmbihkYXRhKSB7XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50U2Vzc2lvbiA9IGF3YWl0IHNlY29uZGFyeVN0b3JhZ2UuZ2V0KHNlc3Npb25Ub2tlbik7XG4gICAgICAgICAgICBsZXQgdXBkYXRlZFNlc3Npb24yID0gbnVsbDtcbiAgICAgICAgICAgIGlmIChjdXJyZW50U2Vzc2lvbikge1xuICAgICAgICAgICAgICBjb25zdCBwYXJzZWRTZXNzaW9uID0gSlNPTi5wYXJzZShjdXJyZW50U2Vzc2lvbik7XG4gICAgICAgICAgICAgIHVwZGF0ZWRTZXNzaW9uMiA9IHtcbiAgICAgICAgICAgICAgICAuLi5wYXJzZWRTZXNzaW9uLnNlc3Npb24sXG4gICAgICAgICAgICAgICAgLi4uZGF0YVxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICByZXR1cm4gdXBkYXRlZFNlc3Npb24yO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBleGVjdXRlTWFpbkZuOiBvcHRpb25zLnNlc3Npb24/LnN0b3JlU2Vzc2lvbkluRGF0YWJhc2VcbiAgICAgICAgfSA6IHZvaWQgMCxcbiAgICAgICAgY29udGV4dFxuICAgICAgKTtcbiAgICAgIHJldHVybiB1cGRhdGVkU2Vzc2lvbjtcbiAgICB9LFxuICAgIGRlbGV0ZVNlc3Npb246IGFzeW5jICh0b2tlbikgPT4ge1xuICAgICAgaWYgKHNlY29uZGFyeVN0b3JhZ2UpIHtcbiAgICAgICAgYXdhaXQgc2Vjb25kYXJ5U3RvcmFnZS5kZWxldGUodG9rZW4pO1xuICAgICAgICBpZiAoIW9wdGlvbnMuc2Vzc2lvbj8uc3RvcmVTZXNzaW9uSW5EYXRhYmFzZSB8fCBjdHgub3B0aW9ucy5zZXNzaW9uPy5wcmVzZXJ2ZVNlc3Npb25JbkRhdGFiYXNlKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBhd2FpdCBhZGFwdGVyLmRlbGV0ZSh7XG4gICAgICAgIG1vZGVsOiBcInNlc3Npb25cIixcbiAgICAgICAgd2hlcmU6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogXCJ0b2tlblwiLFxuICAgICAgICAgICAgdmFsdWU6IHRva2VuXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9KTtcbiAgICB9LFxuICAgIGRlbGV0ZUFjY291bnRzOiBhc3luYyAodXNlcklkKSA9PiB7XG4gICAgICBhd2FpdCBhZGFwdGVyLmRlbGV0ZU1hbnkoe1xuICAgICAgICBtb2RlbDogXCJhY2NvdW50XCIsXG4gICAgICAgIHdoZXJlOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6IFwidXNlcklkXCIsXG4gICAgICAgICAgICB2YWx1ZTogdXNlcklkXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9KTtcbiAgICB9LFxuICAgIGRlbGV0ZUFjY291bnQ6IGFzeW5jIChhY2NvdW50SWQpID0+IHtcbiAgICAgIGF3YWl0IGFkYXB0ZXIuZGVsZXRlKHtcbiAgICAgICAgbW9kZWw6IFwiYWNjb3VudFwiLFxuICAgICAgICB3aGVyZTogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiBcImlkXCIsXG4gICAgICAgICAgICB2YWx1ZTogYWNjb3VudElkXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9KTtcbiAgICB9LFxuICAgIGRlbGV0ZVNlc3Npb25zOiBhc3luYyAodXNlcklkT3JTZXNzaW9uVG9rZW5zKSA9PiB7XG4gICAgICBpZiAoc2Vjb25kYXJ5U3RvcmFnZSkge1xuICAgICAgICBpZiAodHlwZW9mIHVzZXJJZE9yU2Vzc2lvblRva2VucyA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgIGNvbnN0IGFjdGl2ZVNlc3Npb24gPSBhd2FpdCBzZWNvbmRhcnlTdG9yYWdlLmdldChcbiAgICAgICAgICAgIGBhY3RpdmUtc2Vzc2lvbnMtJHt1c2VySWRPclNlc3Npb25Ub2tlbnN9YFxuICAgICAgICAgICk7XG4gICAgICAgICAgY29uc3Qgc2Vzc2lvbnMgPSBhY3RpdmVTZXNzaW9uID8gc2FmZUpTT05QYXJzZShhY3RpdmVTZXNzaW9uKSA6IFtdO1xuICAgICAgICAgIGlmICghc2Vzc2lvbnMpIHJldHVybjtcbiAgICAgICAgICBmb3IgKGNvbnN0IHNlc3Npb24gb2Ygc2Vzc2lvbnMpIHtcbiAgICAgICAgICAgIGF3YWl0IHNlY29uZGFyeVN0b3JhZ2UuZGVsZXRlKHNlc3Npb24udG9rZW4pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBmb3IgKGNvbnN0IHNlc3Npb25Ub2tlbiBvZiB1c2VySWRPclNlc3Npb25Ub2tlbnMpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBzZWNvbmRhcnlTdG9yYWdlLmdldChzZXNzaW9uVG9rZW4pO1xuICAgICAgICAgICAgaWYgKHNlc3Npb24pIHtcbiAgICAgICAgICAgICAgYXdhaXQgc2Vjb25kYXJ5U3RvcmFnZS5kZWxldGUoc2Vzc2lvblRva2VuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFvcHRpb25zLnNlc3Npb24/LnN0b3JlU2Vzc2lvbkluRGF0YWJhc2UgfHwgY3R4Lm9wdGlvbnMuc2Vzc2lvbj8ucHJlc2VydmVTZXNzaW9uSW5EYXRhYmFzZSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgYXdhaXQgYWRhcHRlci5kZWxldGVNYW55KHtcbiAgICAgICAgbW9kZWw6IFwic2Vzc2lvblwiLFxuICAgICAgICB3aGVyZTogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiBBcnJheS5pc0FycmF5KHVzZXJJZE9yU2Vzc2lvblRva2VucykgPyBcInRva2VuXCIgOiBcInVzZXJJZFwiLFxuICAgICAgICAgICAgdmFsdWU6IHVzZXJJZE9yU2Vzc2lvblRva2VucyxcbiAgICAgICAgICAgIG9wZXJhdG9yOiBBcnJheS5pc0FycmF5KHVzZXJJZE9yU2Vzc2lvblRva2VucykgPyBcImluXCIgOiB2b2lkIDBcbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZmluZE9BdXRoVXNlcjogYXN5bmMgKGVtYWlsLCBhY2NvdW50SWQsIHByb3ZpZGVySWQpID0+IHtcbiAgICAgIGNvbnN0IGFjY291bnQgPSBhd2FpdCBhZGFwdGVyLmZpbmRNYW55KHtcbiAgICAgICAgbW9kZWw6IFwiYWNjb3VudFwiLFxuICAgICAgICB3aGVyZTogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiBhY2NvdW50SWQsXG4gICAgICAgICAgICBmaWVsZDogXCJhY2NvdW50SWRcIlxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfSkudGhlbigoYWNjb3VudHMpID0+IHtcbiAgICAgICAgcmV0dXJuIGFjY291bnRzLmZpbmQoKGEpID0+IGEucHJvdmlkZXJJZCA9PT0gcHJvdmlkZXJJZCk7XG4gICAgICB9KTtcbiAgICAgIGlmIChhY2NvdW50KSB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBhZGFwdGVyLmZpbmRPbmUoe1xuICAgICAgICAgIG1vZGVsOiBcInVzZXJcIixcbiAgICAgICAgICB3aGVyZTogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB2YWx1ZTogYWNjb3VudC51c2VySWQsXG4gICAgICAgICAgICAgIGZpZWxkOiBcImlkXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICBdXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAodXNlcikge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB1c2VyLFxuICAgICAgICAgICAgYWNjb3VudHM6IFthY2NvdW50XVxuICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgdXNlcjIgPSBhd2FpdCBhZGFwdGVyLmZpbmRPbmUoe1xuICAgICAgICAgICAgbW9kZWw6IFwidXNlclwiLFxuICAgICAgICAgICAgd2hlcmU6IFtcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhbHVlOiBlbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgICAgIGZpZWxkOiBcImVtYWlsXCJcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGlmICh1c2VyMikge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgdXNlcjogdXNlcjIsXG4gICAgICAgICAgICAgIGFjY291bnRzOiBbYWNjb3VudF1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgYWRhcHRlci5maW5kT25lKHtcbiAgICAgICAgICBtb2RlbDogXCJ1c2VyXCIsXG4gICAgICAgICAgd2hlcmU6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdmFsdWU6IGVtYWlsLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICAgIGZpZWxkOiBcImVtYWlsXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICBdXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAodXNlcikge1xuICAgICAgICAgIGNvbnN0IGFjY291bnRzID0gYXdhaXQgYWRhcHRlci5maW5kTWFueSh7XG4gICAgICAgICAgICBtb2RlbDogXCJhY2NvdW50XCIsXG4gICAgICAgICAgICB3aGVyZTogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IHVzZXIuaWQsXG4gICAgICAgICAgICAgICAgZmllbGQ6IFwidXNlcklkXCJcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB1c2VyLFxuICAgICAgICAgICAgYWNjb3VudHM6IGFjY291bnRzIHx8IFtdXG4gICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgZmluZFVzZXJCeUVtYWlsOiBhc3luYyAoZW1haWwsIG9wdGlvbnMyKSA9PiB7XG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgYWRhcHRlci5maW5kT25lKHtcbiAgICAgICAgbW9kZWw6IFwidXNlclwiLFxuICAgICAgICB3aGVyZTogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiBlbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgZmllbGQ6IFwiZW1haWxcIlxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfSk7XG4gICAgICBpZiAoIXVzZXIpIHJldHVybiBudWxsO1xuICAgICAgaWYgKG9wdGlvbnMyPy5pbmNsdWRlQWNjb3VudHMpIHtcbiAgICAgICAgY29uc3QgYWNjb3VudHMgPSBhd2FpdCBhZGFwdGVyLmZpbmRNYW55KHtcbiAgICAgICAgICBtb2RlbDogXCJhY2NvdW50XCIsXG4gICAgICAgICAgd2hlcmU6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdmFsdWU6IHVzZXIuaWQsXG4gICAgICAgICAgICAgIGZpZWxkOiBcInVzZXJJZFwiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB1c2VyLFxuICAgICAgICAgIGFjY291bnRzXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VyLFxuICAgICAgICBhY2NvdW50czogW11cbiAgICAgIH07XG4gICAgfSxcbiAgICBmaW5kVXNlckJ5SWQ6IGFzeW5jICh1c2VySWQpID0+IHtcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBhZGFwdGVyLmZpbmRPbmUoe1xuICAgICAgICBtb2RlbDogXCJ1c2VyXCIsXG4gICAgICAgIHdoZXJlOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6IFwiaWRcIixcbiAgICAgICAgICAgIHZhbHVlOiB1c2VySWRcbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHVzZXI7XG4gICAgfSxcbiAgICBsaW5rQWNjb3VudDogYXN5bmMgKGFjY291bnQsIGNvbnRleHQpID0+IHtcbiAgICAgIGNvbnN0IF9hY2NvdW50ID0gYXdhaXQgY3JlYXRlV2l0aEhvb2tzKFxuICAgICAgICB7XG4gICAgICAgICAgLi4uYWNjb3VudCxcbiAgICAgICAgICBjcmVhdGVkQXQ6IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpLFxuICAgICAgICAgIHVwZGF0ZWRBdDogLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKClcbiAgICAgICAgfSxcbiAgICAgICAgXCJhY2NvdW50XCIsXG4gICAgICAgIHZvaWQgMCxcbiAgICAgICAgY29udGV4dFxuICAgICAgKTtcbiAgICAgIHJldHVybiBfYWNjb3VudDtcbiAgICB9LFxuICAgIHVwZGF0ZVVzZXI6IGFzeW5jICh1c2VySWQsIGRhdGEsIGNvbnRleHQpID0+IHtcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB1cGRhdGVXaXRoSG9va3MoXG4gICAgICAgIGRhdGEsXG4gICAgICAgIFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogXCJpZFwiLFxuICAgICAgICAgICAgdmFsdWU6IHVzZXJJZFxuICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgXCJ1c2VyXCIsXG4gICAgICAgIHZvaWQgMCxcbiAgICAgICAgY29udGV4dFxuICAgICAgKTtcbiAgICAgIGlmIChzZWNvbmRhcnlTdG9yYWdlICYmIHVzZXIpIHtcbiAgICAgICAgY29uc3QgbGlzdFJhdyA9IGF3YWl0IHNlY29uZGFyeVN0b3JhZ2UuZ2V0KGBhY3RpdmUtc2Vzc2lvbnMtJHt1c2VySWR9YCk7XG4gICAgICAgIGlmIChsaXN0UmF3KSB7XG4gICAgICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICBjb25zdCBsaXN0ID0gc2FmZUpTT05QYXJzZShsaXN0UmF3KSB8fCBbXTtcbiAgICAgICAgICBjb25zdCB2YWxpZFNlc3Npb25zID0gbGlzdC5maWx0ZXIoKHMpID0+IHMuZXhwaXJlc0F0ID4gbm93KTtcbiAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgICAgIHZhbGlkU2Vzc2lvbnMubWFwKGFzeW5jICh7IHRva2VuIH0pID0+IHtcbiAgICAgICAgICAgICAgY29uc3QgY2FjaGVkID0gYXdhaXQgc2Vjb25kYXJ5U3RvcmFnZS5nZXQodG9rZW4pO1xuICAgICAgICAgICAgICBpZiAoIWNhY2hlZCkgcmV0dXJuO1xuICAgICAgICAgICAgICBjb25zdCBwYXJzZWQgPSBzYWZlSlNPTlBhcnNlKGNhY2hlZCk7XG4gICAgICAgICAgICAgIGlmICghcGFyc2VkKSByZXR1cm47XG4gICAgICAgICAgICAgIGNvbnN0IHNlc3Npb25UVEwgPSBNYXRoLm1heChcbiAgICAgICAgICAgICAgICBNYXRoLmZsb29yKFxuICAgICAgICAgICAgICAgICAgKG5ldyBEYXRlKHBhcnNlZC5zZXNzaW9uLmV4cGlyZXNBdCkuZ2V0VGltZSgpIC0gbm93KSAvIDFlM1xuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgMFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICBhd2FpdCBzZWNvbmRhcnlTdG9yYWdlLnNldChcbiAgICAgICAgICAgICAgICB0b2tlbixcbiAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgICBzZXNzaW9uOiBwYXJzZWQuc2Vzc2lvbixcbiAgICAgICAgICAgICAgICAgIHVzZXJcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBzZXNzaW9uVFRMXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB1c2VyO1xuICAgIH0sXG4gICAgdXBkYXRlVXNlckJ5RW1haWw6IGFzeW5jIChlbWFpbCwgZGF0YSwgY29udGV4dCkgPT4ge1xuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHVwZGF0ZVdpdGhIb29rcyhcbiAgICAgICAgZGF0YSxcbiAgICAgICAgW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiBcImVtYWlsXCIsXG4gICAgICAgICAgICB2YWx1ZTogZW1haWwudG9Mb3dlckNhc2UoKVxuICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgXCJ1c2VyXCIsXG4gICAgICAgIHZvaWQgMCxcbiAgICAgICAgY29udGV4dFxuICAgICAgKTtcbiAgICAgIHJldHVybiB1c2VyO1xuICAgIH0sXG4gICAgdXBkYXRlUGFzc3dvcmQ6IGFzeW5jICh1c2VySWQsIHBhc3N3b3JkLCBjb250ZXh0KSA9PiB7XG4gICAgICBhd2FpdCB1cGRhdGVNYW55V2l0aEhvb2tzKFxuICAgICAgICB7XG4gICAgICAgICAgcGFzc3dvcmRcbiAgICAgICAgfSxcbiAgICAgICAgW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiBcInVzZXJJZFwiLFxuICAgICAgICAgICAgdmFsdWU6IHVzZXJJZFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6IFwicHJvdmlkZXJJZFwiLFxuICAgICAgICAgICAgdmFsdWU6IFwiY3JlZGVudGlhbFwiXG4gICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBcImFjY291bnRcIixcbiAgICAgICAgdm9pZCAwLFxuICAgICAgICBjb250ZXh0XG4gICAgICApO1xuICAgIH0sXG4gICAgZmluZEFjY291bnRzOiBhc3luYyAodXNlcklkKSA9PiB7XG4gICAgICBjb25zdCBhY2NvdW50cyA9IGF3YWl0IGFkYXB0ZXIuZmluZE1hbnkoe1xuICAgICAgICBtb2RlbDogXCJhY2NvdW50XCIsXG4gICAgICAgIHdoZXJlOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6IFwidXNlcklkXCIsXG4gICAgICAgICAgICB2YWx1ZTogdXNlcklkXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBhY2NvdW50cztcbiAgICB9LFxuICAgIGZpbmRBY2NvdW50OiBhc3luYyAoYWNjb3VudElkKSA9PiB7XG4gICAgICBjb25zdCBhY2NvdW50ID0gYXdhaXQgYWRhcHRlci5maW5kT25lKHtcbiAgICAgICAgbW9kZWw6IFwiYWNjb3VudFwiLFxuICAgICAgICB3aGVyZTogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiBcImFjY291bnRJZFwiLFxuICAgICAgICAgICAgdmFsdWU6IGFjY291bnRJZFxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gYWNjb3VudDtcbiAgICB9LFxuICAgIGZpbmRBY2NvdW50QnlQcm92aWRlcklkOiBhc3luYyAoYWNjb3VudElkLCBwcm92aWRlcklkKSA9PiB7XG4gICAgICBjb25zdCBhY2NvdW50ID0gYXdhaXQgYWRhcHRlci5maW5kT25lKHtcbiAgICAgICAgbW9kZWw6IFwiYWNjb3VudFwiLFxuICAgICAgICB3aGVyZTogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiBcImFjY291bnRJZFwiLFxuICAgICAgICAgICAgdmFsdWU6IGFjY291bnRJZFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6IFwicHJvdmlkZXJJZFwiLFxuICAgICAgICAgICAgdmFsdWU6IHByb3ZpZGVySWRcbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGFjY291bnQ7XG4gICAgfSxcbiAgICBmaW5kQWNjb3VudEJ5VXNlcklkOiBhc3luYyAodXNlcklkKSA9PiB7XG4gICAgICBjb25zdCBhY2NvdW50ID0gYXdhaXQgYWRhcHRlci5maW5kTWFueSh7XG4gICAgICAgIG1vZGVsOiBcImFjY291bnRcIixcbiAgICAgICAgd2hlcmU6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogXCJ1c2VySWRcIixcbiAgICAgICAgICAgIHZhbHVlOiB1c2VySWRcbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGFjY291bnQ7XG4gICAgfSxcbiAgICB1cGRhdGVBY2NvdW50OiBhc3luYyAoaWQsIGRhdGEsIGNvbnRleHQpID0+IHtcbiAgICAgIGNvbnN0IGFjY291bnQgPSBhd2FpdCB1cGRhdGVXaXRoSG9va3MoXG4gICAgICAgIGRhdGEsXG4gICAgICAgIFt7IGZpZWxkOiBcImlkXCIsIHZhbHVlOiBpZCB9XSxcbiAgICAgICAgXCJhY2NvdW50XCIsXG4gICAgICAgIHZvaWQgMCxcbiAgICAgICAgY29udGV4dFxuICAgICAgKTtcbiAgICAgIHJldHVybiBhY2NvdW50O1xuICAgIH0sXG4gICAgY3JlYXRlVmVyaWZpY2F0aW9uVmFsdWU6IGFzeW5jIChkYXRhLCBjb250ZXh0KSA9PiB7XG4gICAgICBjb25zdCB2ZXJpZmljYXRpb24gPSBhd2FpdCBjcmVhdGVXaXRoSG9va3MoXG4gICAgICAgIHtcbiAgICAgICAgICBjcmVhdGVkQXQ6IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpLFxuICAgICAgICAgIHVwZGF0ZWRBdDogLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCksXG4gICAgICAgICAgLi4uZGF0YVxuICAgICAgICB9LFxuICAgICAgICBcInZlcmlmaWNhdGlvblwiLFxuICAgICAgICB2b2lkIDAsXG4gICAgICAgIGNvbnRleHRcbiAgICAgICk7XG4gICAgICByZXR1cm4gdmVyaWZpY2F0aW9uO1xuICAgIH0sXG4gICAgZmluZFZlcmlmaWNhdGlvblZhbHVlOiBhc3luYyAoaWRlbnRpZmllcikgPT4ge1xuICAgICAgY29uc3QgdmVyaWZpY2F0aW9uID0gYXdhaXQgYWRhcHRlci5maW5kTWFueSh7XG4gICAgICAgIG1vZGVsOiBcInZlcmlmaWNhdGlvblwiLFxuICAgICAgICB3aGVyZTogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiBcImlkZW50aWZpZXJcIixcbiAgICAgICAgICAgIHZhbHVlOiBpZGVudGlmaWVyXG4gICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBzb3J0Qnk6IHtcbiAgICAgICAgICBmaWVsZDogXCJjcmVhdGVkQXRcIixcbiAgICAgICAgICBkaXJlY3Rpb246IFwiZGVzY1wiXG4gICAgICAgIH0sXG4gICAgICAgIGxpbWl0OiAxXG4gICAgICB9KTtcbiAgICAgIGlmICghb3B0aW9ucy52ZXJpZmljYXRpb24/LmRpc2FibGVDbGVhbnVwKSB7XG4gICAgICAgIGF3YWl0IGFkYXB0ZXIuZGVsZXRlTWFueSh7XG4gICAgICAgICAgbW9kZWw6IFwidmVyaWZpY2F0aW9uXCIsXG4gICAgICAgICAgd2hlcmU6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgZmllbGQ6IFwiZXhwaXJlc0F0XCIsXG4gICAgICAgICAgICAgIHZhbHVlOiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSxcbiAgICAgICAgICAgICAgb3BlcmF0b3I6IFwibHRcIlxuICAgICAgICAgICAgfVxuICAgICAgICAgIF1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBjb25zdCBsYXN0VmVyaWZpY2F0aW9uID0gdmVyaWZpY2F0aW9uWzBdO1xuICAgICAgcmV0dXJuIGxhc3RWZXJpZmljYXRpb247XG4gICAgfSxcbiAgICBkZWxldGVWZXJpZmljYXRpb25WYWx1ZTogYXN5bmMgKGlkKSA9PiB7XG4gICAgICBhd2FpdCBhZGFwdGVyLmRlbGV0ZSh7XG4gICAgICAgIG1vZGVsOiBcInZlcmlmaWNhdGlvblwiLFxuICAgICAgICB3aGVyZTogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiBcImlkXCIsXG4gICAgICAgICAgICB2YWx1ZTogaWRcbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZGVsZXRlVmVyaWZpY2F0aW9uQnlJZGVudGlmaWVyOiBhc3luYyAoaWRlbnRpZmllcikgPT4ge1xuICAgICAgYXdhaXQgYWRhcHRlci5kZWxldGUoe1xuICAgICAgICBtb2RlbDogXCJ2ZXJpZmljYXRpb25cIixcbiAgICAgICAgd2hlcmU6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogXCJpZGVudGlmaWVyXCIsXG4gICAgICAgICAgICB2YWx1ZTogaWRlbnRpZmllclxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfSk7XG4gICAgfSxcbiAgICB1cGRhdGVWZXJpZmljYXRpb25WYWx1ZTogYXN5bmMgKGlkLCBkYXRhLCBjb250ZXh0KSA9PiB7XG4gICAgICBjb25zdCB2ZXJpZmljYXRpb24gPSBhd2FpdCB1cGRhdGVXaXRoSG9va3MoXG4gICAgICAgIGRhdGEsXG4gICAgICAgIFt7IGZpZWxkOiBcImlkXCIsIHZhbHVlOiBpZCB9XSxcbiAgICAgICAgXCJ2ZXJpZmljYXRpb25cIixcbiAgICAgICAgdm9pZCAwLFxuICAgICAgICBjb250ZXh0XG4gICAgICApO1xuICAgICAgcmV0dXJuIHZlcmlmaWNhdGlvbjtcbiAgICB9XG4gIH07XG59O1xuXG5hc3luYyBmdW5jdGlvbiBnZXRBZGFwdGVyKG9wdGlvbnMpIHtcbiAgaWYgKCFvcHRpb25zLmRhdGFiYXNlKSB7XG4gICAgY29uc3QgdGFibGVzID0gZ2V0QXV0aFRhYmxlcyhvcHRpb25zKTtcbiAgICBjb25zdCBtZW1vcnlEQiA9IE9iamVjdC5rZXlzKHRhYmxlcykucmVkdWNlKChhY2MsIGtleSkgPT4ge1xuICAgICAgYWNjW2tleV0gPSBbXTtcbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwge30pO1xuICAgIGxvZ2dlci53YXJuKFxuICAgICAgXCJObyBkYXRhYmFzZSBjb25maWd1cmF0aW9uIHByb3ZpZGVkLiBVc2luZyBtZW1vcnkgYWRhcHRlciBpbiBkZXZlbG9wbWVudFwiXG4gICAgKTtcbiAgICByZXR1cm4gbWVtb3J5QWRhcHRlcihtZW1vcnlEQikob3B0aW9ucyk7XG4gIH1cbiAgaWYgKHR5cGVvZiBvcHRpb25zLmRhdGFiYXNlID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICByZXR1cm4gb3B0aW9ucy5kYXRhYmFzZShvcHRpb25zKTtcbiAgfVxuICBjb25zdCB7IGt5c2VseSwgZGF0YWJhc2VUeXBlIH0gPSBhd2FpdCBjcmVhdGVLeXNlbHlBZGFwdGVyKG9wdGlvbnMpO1xuICBpZiAoIWt5c2VseSkge1xuICAgIHRocm93IG5ldyBCZXR0ZXJBdXRoRXJyb3IoXCJGYWlsZWQgdG8gaW5pdGlhbGl6ZSBkYXRhYmFzZSBhZGFwdGVyXCIpO1xuICB9XG4gIHJldHVybiBreXNlbHlBZGFwdGVyKGt5c2VseSwge1xuICAgIHR5cGU6IGRhdGFiYXNlVHlwZSB8fCBcInNxbGl0ZVwiLFxuICAgIGRlYnVnTG9nczogXCJkZWJ1Z0xvZ3NcIiBpbiBvcHRpb25zLmRhdGFiYXNlID8gb3B0aW9ucy5kYXRhYmFzZS5kZWJ1Z0xvZ3MgOiBmYWxzZVxuICB9KShvcHRpb25zKTtcbn1cbmZ1bmN0aW9uIGNvbnZlcnRUb0RCKGZpZWxkcywgdmFsdWVzKSB7XG4gIGxldCByZXN1bHQgPSB2YWx1ZXMuaWQgPyB7XG4gICAgaWQ6IHZhbHVlcy5pZFxuICB9IDoge307XG4gIGZvciAoY29uc3Qga2V5IGluIGZpZWxkcykge1xuICAgIGNvbnN0IGZpZWxkID0gZmllbGRzW2tleV07XG4gICAgY29uc3QgdmFsdWUgPSB2YWx1ZXNba2V5XTtcbiAgICBpZiAodmFsdWUgPT09IHZvaWQgMCkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIHJlc3VsdFtmaWVsZC5maWVsZE5hbWUgfHwga2V5XSA9IHZhbHVlO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5mdW5jdGlvbiBjb252ZXJ0RnJvbURCKGZpZWxkcywgdmFsdWVzKSB7XG4gIGlmICghdmFsdWVzKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgbGV0IHJlc3VsdCA9IHtcbiAgICBpZDogdmFsdWVzLmlkXG4gIH07XG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGZpZWxkcykpIHtcbiAgICByZXN1bHRba2V5XSA9IHZhbHVlc1t2YWx1ZS5maWVsZE5hbWUgfHwga2V5XTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5mdW5jdGlvbiBnZXRTY2hlbWEoY29uZmlnKSB7XG4gIGNvbnN0IHRhYmxlcyA9IGdldEF1dGhUYWJsZXMoY29uZmlnKTtcbiAgbGV0IHNjaGVtYSA9IHt9O1xuICBmb3IgKGNvbnN0IGtleSBpbiB0YWJsZXMpIHtcbiAgICBjb25zdCB0YWJsZSA9IHRhYmxlc1trZXldO1xuICAgIGNvbnN0IGZpZWxkcyA9IHRhYmxlLmZpZWxkcztcbiAgICBsZXQgYWN0dWFsRmllbGRzID0ge307XG4gICAgT2JqZWN0LmVudHJpZXMoZmllbGRzKS5mb3JFYWNoKChba2V5MiwgZmllbGRdKSA9PiB7XG4gICAgICBhY3R1YWxGaWVsZHNbZmllbGQuZmllbGROYW1lIHx8IGtleTJdID0gZmllbGQ7XG4gICAgICBpZiAoZmllbGQucmVmZXJlbmNlcykge1xuICAgICAgICBjb25zdCByZWZUYWJsZSA9IHRhYmxlc1tmaWVsZC5yZWZlcmVuY2VzLm1vZGVsXTtcbiAgICAgICAgaWYgKHJlZlRhYmxlKSB7XG4gICAgICAgICAgYWN0dWFsRmllbGRzW2ZpZWxkLmZpZWxkTmFtZSB8fCBrZXkyXS5yZWZlcmVuY2VzID0ge1xuICAgICAgICAgICAgbW9kZWw6IHJlZlRhYmxlLm1vZGVsTmFtZSxcbiAgICAgICAgICAgIGZpZWxkOiBmaWVsZC5yZWZlcmVuY2VzLmZpZWxkXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIGlmIChzY2hlbWFbdGFibGUubW9kZWxOYW1lXSkge1xuICAgICAgc2NoZW1hW3RhYmxlLm1vZGVsTmFtZV0uZmllbGRzID0ge1xuICAgICAgICAuLi5zY2hlbWFbdGFibGUubW9kZWxOYW1lXS5maWVsZHMsXG4gICAgICAgIC4uLmFjdHVhbEZpZWxkc1xuICAgICAgfTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBzY2hlbWFbdGFibGUubW9kZWxOYW1lXSA9IHtcbiAgICAgIGZpZWxkczogYWN0dWFsRmllbGRzLFxuICAgICAgb3JkZXI6IHRhYmxlLm9yZGVyIHx8IEluZmluaXR5XG4gICAgfTtcbiAgfVxuICByZXR1cm4gc2NoZW1hO1xufVxuXG5jb25zdCBwb3N0Z3Jlc01hcCA9IHtcbiAgc3RyaW5nOiBbXCJjaGFyYWN0ZXIgdmFyeWluZ1wiLCBcInZhcmNoYXJcIiwgXCJ0ZXh0XCJdLFxuICBudW1iZXI6IFtcbiAgICBcImludDRcIixcbiAgICBcImludGVnZXJcIixcbiAgICBcImJpZ2ludFwiLFxuICAgIFwic21hbGxpbnRcIixcbiAgICBcIm51bWVyaWNcIixcbiAgICBcInJlYWxcIixcbiAgICBcImRvdWJsZSBwcmVjaXNpb25cIlxuICBdLFxuICBib29sZWFuOiBbXCJib29sXCIsIFwiYm9vbGVhblwiXSxcbiAgZGF0ZTogW1widGltZXN0YW1wXCIsIFwiZGF0ZVwiXVxufTtcbmNvbnN0IG15c3FsTWFwID0ge1xuICBzdHJpbmc6IFtcInZhcmNoYXJcIiwgXCJ0ZXh0XCJdLFxuICBudW1iZXI6IFtcbiAgICBcImludGVnZXJcIixcbiAgICBcImludFwiLFxuICAgIFwiYmlnaW50XCIsXG4gICAgXCJzbWFsbGludFwiLFxuICAgIFwiZGVjaW1hbFwiLFxuICAgIFwiZmxvYXRcIixcbiAgICBcImRvdWJsZVwiXG4gIF0sXG4gIGJvb2xlYW46IFtcImJvb2xlYW5cIiwgXCJ0aW55aW50XCJdLFxuICBkYXRlOiBbXCJ0aW1lc3RhbXBcIiwgXCJkYXRldGltZVwiLCBcImRhdGVcIl1cbn07XG5jb25zdCBzcWxpdGVNYXAgPSB7XG4gIHN0cmluZzogW1wiVEVYVFwiXSxcbiAgbnVtYmVyOiBbXCJJTlRFR0VSXCIsIFwiUkVBTFwiXSxcbiAgYm9vbGVhbjogW1wiSU5URUdFUlwiLCBcIkJPT0xFQU5cIl0sXG4gIC8vIDAgb3IgMVxuICBkYXRlOiBbXCJEQVRFXCIsIFwiSU5URUdFUlwiXVxufTtcbmNvbnN0IG1zc3FsTWFwID0ge1xuICBzdHJpbmc6IFtcInRleHRcIiwgXCJ2YXJjaGFyXCJdLFxuICBudW1iZXI6IFtcImludFwiLCBcImJpZ2ludFwiLCBcInNtYWxsaW50XCIsIFwiZGVjaW1hbFwiLCBcImZsb2F0XCIsIFwiZG91YmxlXCJdLFxuICBib29sZWFuOiBbXCJiaXRcIiwgXCJzbWFsbGludFwiXSxcbiAgZGF0ZTogW1wiZGF0ZXRpbWVcIiwgXCJkYXRlXCJdXG59O1xuY29uc3QgbWFwID0ge1xuICBwb3N0Z3JlczogcG9zdGdyZXNNYXAsXG4gIG15c3FsOiBteXNxbE1hcCxcbiAgc3FsaXRlOiBzcWxpdGVNYXAsXG4gIG1zc3FsOiBtc3NxbE1hcFxufTtcbmZ1bmN0aW9uIG1hdGNoVHlwZShjb2x1bW5EYXRhVHlwZSwgZmllbGRUeXBlLCBkYlR5cGUpIHtcbiAgZnVuY3Rpb24gbm9ybWFsaXplKHR5cGUpIHtcbiAgICByZXR1cm4gdHlwZS50b0xvd2VyQ2FzZSgpLnNwbGl0KFwiKFwiKVswXS50cmltKCk7XG4gIH1cbiAgaWYgKGZpZWxkVHlwZSA9PT0gXCJzdHJpbmdbXVwiIHx8IGZpZWxkVHlwZSA9PT0gXCJudW1iZXJbXVwiKSB7XG4gICAgcmV0dXJuIGNvbHVtbkRhdGFUeXBlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJqc29uXCIpO1xuICB9XG4gIGNvbnN0IHR5cGVzID0gbWFwW2RiVHlwZV07XG4gIGNvbnN0IGV4cGVjdGVkID0gQXJyYXkuaXNBcnJheShmaWVsZFR5cGUpID8gdHlwZXNbXCJzdHJpbmdcIl0ubWFwKCh0KSA9PiB0LnRvTG93ZXJDYXNlKCkpIDogdHlwZXNbZmllbGRUeXBlXS5tYXAoKHQpID0+IHQudG9Mb3dlckNhc2UoKSk7XG4gIHJldHVybiBleHBlY3RlZC5pbmNsdWRlcyhub3JtYWxpemUoY29sdW1uRGF0YVR5cGUpKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldE1pZ3JhdGlvbnMoY29uZmlnKSB7XG4gIGNvbnN0IGJldHRlckF1dGhTY2hlbWEgPSBnZXRTY2hlbWEoY29uZmlnKTtcbiAgY29uc3QgbG9nZ2VyID0gY3JlYXRlTG9nZ2VyKGNvbmZpZy5sb2dnZXIpO1xuICBsZXQgeyBreXNlbHk6IGRiLCBkYXRhYmFzZVR5cGU6IGRiVHlwZSB9ID0gYXdhaXQgY3JlYXRlS3lzZWx5QWRhcHRlcihjb25maWcpO1xuICBpZiAoIWRiVHlwZSkge1xuICAgIGxvZ2dlci53YXJuKFxuICAgICAgXCJDb3VsZCBub3QgZGV0ZXJtaW5lIGRhdGFiYXNlIHR5cGUsIGRlZmF1bHRpbmcgdG8gc3FsaXRlLiBQbGVhc2UgcHJvdmlkZSBhIHR5cGUgaW4gdGhlIGRhdGFiYXNlIG9wdGlvbnMgdG8gYXZvaWQgdGhpcy5cIlxuICAgICk7XG4gICAgZGJUeXBlID0gXCJzcWxpdGVcIjtcbiAgfVxuICBpZiAoIWRiKSB7XG4gICAgbG9nZ2VyLmVycm9yKFxuICAgICAgXCJPbmx5IGt5c2VseSBhZGFwdGVyIGlzIHN1cHBvcnRlZCBmb3IgbWlncmF0aW9ucy4gWW91IGNhbiB1c2UgYGdlbmVyYXRlYCBjb21tYW5kIHRvIGdlbmVyYXRlIHRoZSBzY2hlbWEsIGlmIHlvdSdyZSB1c2luZyBhIGRpZmZlcmVudCBhZGFwdGVyLlwiXG4gICAgKTtcbiAgICBwcm9jZXNzLmV4aXQoMSk7XG4gIH1cbiAgY29uc3QgdGFibGVNZXRhZGF0YSA9IGF3YWl0IGRiLmludHJvc3BlY3Rpb24uZ2V0VGFibGVzKCk7XG4gIGNvbnN0IHRvQmVDcmVhdGVkID0gW107XG4gIGNvbnN0IHRvQmVBZGRlZCA9IFtdO1xuICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhiZXR0ZXJBdXRoU2NoZW1hKSkge1xuICAgIGNvbnN0IHRhYmxlID0gdGFibGVNZXRhZGF0YS5maW5kKCh0KSA9PiB0Lm5hbWUgPT09IGtleSk7XG4gICAgaWYgKCF0YWJsZSkge1xuICAgICAgY29uc3QgdEluZGV4ID0gdG9CZUNyZWF0ZWQuZmluZEluZGV4KCh0KSA9PiB0LnRhYmxlID09PSBrZXkpO1xuICAgICAgY29uc3QgdGFibGVEYXRhID0ge1xuICAgICAgICB0YWJsZToga2V5LFxuICAgICAgICBmaWVsZHM6IHZhbHVlLmZpZWxkcyxcbiAgICAgICAgb3JkZXI6IHZhbHVlLm9yZGVyIHx8IEluZmluaXR5XG4gICAgICB9O1xuICAgICAgY29uc3QgaW5zZXJ0SW5kZXggPSB0b0JlQ3JlYXRlZC5maW5kSW5kZXgoXG4gICAgICAgICh0KSA9PiAodC5vcmRlciB8fCBJbmZpbml0eSkgPiB0YWJsZURhdGEub3JkZXJcbiAgICAgICk7XG4gICAgICBpZiAoaW5zZXJ0SW5kZXggPT09IC0xKSB7XG4gICAgICAgIGlmICh0SW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgdG9CZUNyZWF0ZWQucHVzaCh0YWJsZURhdGEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRvQmVDcmVhdGVkW3RJbmRleF0uZmllbGRzID0ge1xuICAgICAgICAgICAgLi4udG9CZUNyZWF0ZWRbdEluZGV4XS5maWVsZHMsXG4gICAgICAgICAgICAuLi52YWx1ZS5maWVsZHNcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0b0JlQ3JlYXRlZC5zcGxpY2UoaW5zZXJ0SW5kZXgsIDAsIHRhYmxlRGF0YSk7XG4gICAgICB9XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgbGV0IHRvQmVBZGRlZEZpZWxkcyA9IHt9O1xuICAgIGZvciAoY29uc3QgW2ZpZWxkTmFtZSwgZmllbGRdIG9mIE9iamVjdC5lbnRyaWVzKHZhbHVlLmZpZWxkcykpIHtcbiAgICAgIGNvbnN0IGNvbHVtbiA9IHRhYmxlLmNvbHVtbnMuZmluZCgoYykgPT4gYy5uYW1lID09PSBmaWVsZE5hbWUpO1xuICAgICAgaWYgKCFjb2x1bW4pIHtcbiAgICAgICAgdG9CZUFkZGVkRmllbGRzW2ZpZWxkTmFtZV0gPSBmaWVsZDtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAobWF0Y2hUeXBlKGNvbHVtbi5kYXRhVHlwZSwgZmllbGQudHlwZSwgZGJUeXBlKSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxvZ2dlci53YXJuKFxuICAgICAgICAgIGBGaWVsZCAke2ZpZWxkTmFtZX0gaW4gdGFibGUgJHtrZXl9IGhhcyBhIGRpZmZlcmVudCB0eXBlIGluIHRoZSBkYXRhYmFzZS4gRXhwZWN0ZWQgJHtmaWVsZC50eXBlfSBidXQgZ290ICR7Y29sdW1uLmRhdGFUeXBlfS5gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChPYmplY3Qua2V5cyh0b0JlQWRkZWRGaWVsZHMpLmxlbmd0aCA+IDApIHtcbiAgICAgIHRvQmVBZGRlZC5wdXNoKHtcbiAgICAgICAgdGFibGU6IGtleSxcbiAgICAgICAgZmllbGRzOiB0b0JlQWRkZWRGaWVsZHMsXG4gICAgICAgIG9yZGVyOiB2YWx1ZS5vcmRlciB8fCBJbmZpbml0eVxuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIGNvbnN0IG1pZ3JhdGlvbnMgPSBbXTtcbiAgZnVuY3Rpb24gZ2V0VHlwZShmaWVsZCwgZmllbGROYW1lKSB7XG4gICAgY29uc3QgdHlwZSA9IGZpZWxkLnR5cGU7XG4gICAgY29uc3QgdHlwZU1hcCA9IHtcbiAgICAgIHN0cmluZzoge1xuICAgICAgICBzcWxpdGU6IFwidGV4dFwiLFxuICAgICAgICBwb3N0Z3JlczogXCJ0ZXh0XCIsXG4gICAgICAgIG15c3FsOiBmaWVsZC51bmlxdWUgPyBcInZhcmNoYXIoMjU1KVwiIDogZmllbGQucmVmZXJlbmNlcyA/IFwidmFyY2hhcigzNilcIiA6IFwidGV4dFwiLFxuICAgICAgICBtc3NxbDogZmllbGQudW5pcXVlIHx8IGZpZWxkLnNvcnRhYmxlID8gXCJ2YXJjaGFyKDI1NSlcIiA6IGZpZWxkLnJlZmVyZW5jZXMgPyBcInZhcmNoYXIoMzYpXCIgOiBcInRleHRcIlxuICAgICAgfSxcbiAgICAgIGJvb2xlYW46IHtcbiAgICAgICAgc3FsaXRlOiBcImludGVnZXJcIixcbiAgICAgICAgcG9zdGdyZXM6IFwiYm9vbGVhblwiLFxuICAgICAgICBteXNxbDogXCJib29sZWFuXCIsXG4gICAgICAgIG1zc3FsOiBcInNtYWxsaW50XCJcbiAgICAgIH0sXG4gICAgICBudW1iZXI6IHtcbiAgICAgICAgc3FsaXRlOiBmaWVsZC5iaWdpbnQgPyBcImJpZ2ludFwiIDogXCJpbnRlZ2VyXCIsXG4gICAgICAgIHBvc3RncmVzOiBmaWVsZC5iaWdpbnQgPyBcImJpZ2ludFwiIDogXCJpbnRlZ2VyXCIsXG4gICAgICAgIG15c3FsOiBmaWVsZC5iaWdpbnQgPyBcImJpZ2ludFwiIDogXCJpbnRlZ2VyXCIsXG4gICAgICAgIG1zc3FsOiBmaWVsZC5iaWdpbnQgPyBcImJpZ2ludFwiIDogXCJpbnRlZ2VyXCJcbiAgICAgIH0sXG4gICAgICBkYXRlOiB7XG4gICAgICAgIHNxbGl0ZTogXCJkYXRlXCIsXG4gICAgICAgIHBvc3RncmVzOiBcInRpbWVzdGFtcFwiLFxuICAgICAgICBteXNxbDogXCJkYXRldGltZVwiLFxuICAgICAgICBtc3NxbDogXCJkYXRldGltZVwiXG4gICAgICB9LFxuICAgICAgaWQ6IHtcbiAgICAgICAgcG9zdGdyZXM6IGNvbmZpZy5hZHZhbmNlZD8uZGF0YWJhc2U/LnVzZU51bWJlcklkID8gXCJzZXJpYWxcIiA6IFwidGV4dFwiLFxuICAgICAgICBteXNxbDogY29uZmlnLmFkdmFuY2VkPy5kYXRhYmFzZT8udXNlTnVtYmVySWQgPyBcImludGVnZXJcIiA6IFwidmFyY2hhcigzNilcIixcbiAgICAgICAgbXNzcWw6IGNvbmZpZy5hZHZhbmNlZD8uZGF0YWJhc2U/LnVzZU51bWJlcklkID8gXCJpbnRlZ2VyXCIgOiBcInZhcmNoYXIoMzYpXCIsXG4gICAgICAgIHNxbGl0ZTogY29uZmlnLmFkdmFuY2VkPy5kYXRhYmFzZT8udXNlTnVtYmVySWQgPyBcImludGVnZXJcIiA6IFwidGV4dFwiXG4gICAgICB9XG4gICAgfTtcbiAgICBpZiAoZmllbGROYW1lID09PSBcImlkXCIgfHwgZmllbGQucmVmZXJlbmNlcz8uZmllbGQgPT09IFwiaWRcIikge1xuICAgICAgcmV0dXJuIHR5cGVNYXAuaWRbZGJUeXBlXTtcbiAgICB9XG4gICAgaWYgKGRiVHlwZSA9PT0gXCJzcWxpdGVcIiAmJiAodHlwZSA9PT0gXCJzdHJpbmdbXVwiIHx8IHR5cGUgPT09IFwibnVtYmVyW11cIikpIHtcbiAgICAgIHJldHVybiBcInRleHRcIjtcbiAgICB9XG4gICAgaWYgKHR5cGUgPT09IFwic3RyaW5nW11cIiB8fCB0eXBlID09PSBcIm51bWJlcltdXCIpIHtcbiAgICAgIHJldHVybiBcImpzb25iXCI7XG4gICAgfVxuICAgIGlmIChBcnJheS5pc0FycmF5KHR5cGUpKSB7XG4gICAgICByZXR1cm4gXCJ0ZXh0XCI7XG4gICAgfVxuICAgIHJldHVybiB0eXBlTWFwW3R5cGVdW2RiVHlwZSB8fCBcInNxbGl0ZVwiXTtcbiAgfVxuICBpZiAodG9CZUFkZGVkLmxlbmd0aCkge1xuICAgIGZvciAoY29uc3QgdGFibGUgb2YgdG9CZUFkZGVkKSB7XG4gICAgICBmb3IgKGNvbnN0IFtmaWVsZE5hbWUsIGZpZWxkXSBvZiBPYmplY3QuZW50cmllcyh0YWJsZS5maWVsZHMpKSB7XG4gICAgICAgIGNvbnN0IHR5cGUgPSBnZXRUeXBlKGZpZWxkLCBmaWVsZE5hbWUpO1xuICAgICAgICBjb25zdCBleGVjID0gZGIuc2NoZW1hLmFsdGVyVGFibGUodGFibGUudGFibGUpLmFkZENvbHVtbihmaWVsZE5hbWUsIHR5cGUsIChjb2wpID0+IHtcbiAgICAgICAgICBjb2wgPSBmaWVsZC5yZXF1aXJlZCAhPT0gZmFsc2UgPyBjb2wubm90TnVsbCgpIDogY29sO1xuICAgICAgICAgIGlmIChmaWVsZC5yZWZlcmVuY2VzKSB7XG4gICAgICAgICAgICBjb2wgPSBjb2wucmVmZXJlbmNlcyhcbiAgICAgICAgICAgICAgYCR7ZmllbGQucmVmZXJlbmNlcy5tb2RlbH0uJHtmaWVsZC5yZWZlcmVuY2VzLmZpZWxkfWBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChmaWVsZC51bmlxdWUpIHtcbiAgICAgICAgICAgIGNvbCA9IGNvbC51bmlxdWUoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGNvbDtcbiAgICAgICAgfSk7XG4gICAgICAgIG1pZ3JhdGlvbnMucHVzaChleGVjKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgaWYgKHRvQmVDcmVhdGVkLmxlbmd0aCkge1xuICAgIGZvciAoY29uc3QgdGFibGUgb2YgdG9CZUNyZWF0ZWQpIHtcbiAgICAgIGxldCBkYlQgPSBkYi5zY2hlbWEuY3JlYXRlVGFibGUodGFibGUudGFibGUpLmFkZENvbHVtbihcbiAgICAgICAgXCJpZFwiLFxuICAgICAgICBjb25maWcuYWR2YW5jZWQ/LmRhdGFiYXNlPy51c2VOdW1iZXJJZCA/IGRiVHlwZSA9PT0gXCJwb3N0Z3Jlc1wiID8gXCJzZXJpYWxcIiA6IFwiaW50ZWdlclwiIDogZGJUeXBlID09PSBcIm15c3FsXCIgfHwgZGJUeXBlID09PSBcIm1zc3FsXCIgPyBcInZhcmNoYXIoMzYpXCIgOiBcInRleHRcIixcbiAgICAgICAgKGNvbCkgPT4ge1xuICAgICAgICAgIGlmIChjb25maWcuYWR2YW5jZWQ/LmRhdGFiYXNlPy51c2VOdW1iZXJJZCkge1xuICAgICAgICAgICAgaWYgKGRiVHlwZSA9PT0gXCJwb3N0Z3Jlc1wiKSB7XG4gICAgICAgICAgICAgIHJldHVybiBjb2wucHJpbWFyeUtleSgpLm5vdE51bGwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjb2wuYXV0b0luY3JlbWVudCgpLnByaW1hcnlLZXkoKS5ub3ROdWxsKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBjb2wucHJpbWFyeUtleSgpLm5vdE51bGwoKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIGZvciAoY29uc3QgW2ZpZWxkTmFtZSwgZmllbGRdIG9mIE9iamVjdC5lbnRyaWVzKHRhYmxlLmZpZWxkcykpIHtcbiAgICAgICAgY29uc3QgdHlwZSA9IGdldFR5cGUoZmllbGQsIGZpZWxkTmFtZSk7XG4gICAgICAgIGRiVCA9IGRiVC5hZGRDb2x1bW4oZmllbGROYW1lLCB0eXBlLCAoY29sKSA9PiB7XG4gICAgICAgICAgY29sID0gZmllbGQucmVxdWlyZWQgIT09IGZhbHNlID8gY29sLm5vdE51bGwoKSA6IGNvbDtcbiAgICAgICAgICBpZiAoZmllbGQucmVmZXJlbmNlcykge1xuICAgICAgICAgICAgY29sID0gY29sLnJlZmVyZW5jZXMoXG4gICAgICAgICAgICAgIGAke2ZpZWxkLnJlZmVyZW5jZXMubW9kZWx9LiR7ZmllbGQucmVmZXJlbmNlcy5maWVsZH1gXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZmllbGQudW5pcXVlKSB7XG4gICAgICAgICAgICBjb2wgPSBjb2wudW5pcXVlKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBjb2w7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgbWlncmF0aW9ucy5wdXNoKGRiVCk7XG4gICAgfVxuICB9XG4gIGFzeW5jIGZ1bmN0aW9uIHJ1bk1pZ3JhdGlvbnMoKSB7XG4gICAgZm9yIChjb25zdCBtaWdyYXRpb24gb2YgbWlncmF0aW9ucykge1xuICAgICAgYXdhaXQgbWlncmF0aW9uLmV4ZWN1dGUoKTtcbiAgICB9XG4gIH1cbiAgYXN5bmMgZnVuY3Rpb24gY29tcGlsZU1pZ3JhdGlvbnMoKSB7XG4gICAgY29uc3QgY29tcGlsZWQgPSBtaWdyYXRpb25zLm1hcCgobSkgPT4gbS5jb21waWxlKCkuc3FsKTtcbiAgICByZXR1cm4gY29tcGlsZWQuam9pbihcIjtcXG5cXG5cIikgKyBcIjtcIjtcbiAgfVxuICByZXR1cm4geyB0b0JlQ3JlYXRlZCwgdG9CZUFkZGVkLCBydW5NaWdyYXRpb25zLCBjb21waWxlTWlncmF0aW9ucyB9O1xufVxuXG5leHBvcnQgeyBnZXRBZGFwdGVyIGFzIGEsIGNvbnZlcnRUb0RCIGFzIGIsIGNyZWF0ZUludGVybmFsQWRhcHRlciBhcyBjLCBjb252ZXJ0RnJvbURCIGFzIGQsIGdldE1pZ3JhdGlvbnMgYXMgZSwgZ2V0U2NoZW1hIGFzIGYsIGdldFdpdGhIb29rcyBhcyBnLCBtYXRjaFR5cGUgYXMgbSB9O1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/shared/better-auth.ByruPN9q.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/shared/better-auth.CW6D9eSx.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.CW6D9eSx.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   g: () => (/* binding */ getDate)\n/* harmony export */ });\nconst getDate = (span, unit = \"ms\") => {\n  return new Date(Date.now() + (unit === \"sec\" ? span * 1e3 : span));\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLkNXNkQ5ZVN4Lm1qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQUE7QUFDQTtBQUNBOztBQUV3QiIsInNvdXJjZXMiOlsiL1VzZXJzL21pbGFuL0Rlc2t0b3AvQXBwcy9iZXR0ZXItYXV0aC9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguQ1c2RDllU3gubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGdldERhdGUgPSAoc3BhbiwgdW5pdCA9IFwibXNcIikgPT4ge1xuICByZXR1cm4gbmV3IERhdGUoRGF0ZS5ub3coKSArICh1bml0ID09PSBcInNlY1wiID8gc3BhbiAqIDFlMyA6IHNwYW4pKTtcbn07XG5cbmV4cG9ydCB7IGdldERhdGUgYXMgZyB9O1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/shared/better-auth.CW6D9eSx.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/shared/better-auth.Cbhy6WDJ.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.Cbhy6WDJ.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   b: () => (/* binding */ betterAuth)\n/* harmony export */ });\n/* harmony import */ var _api_index_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../api/index.mjs */ \"(rsc)/../../node_modules/better-auth/dist/api/index.mjs\");\n/* harmony import */ var defu__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! defu */ \"(rsc)/../../node_modules/defu/dist/defu.mjs\");\n/* harmony import */ var _crypto_index_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../crypto/index.mjs */ \"(rsc)/../../node_modules/better-auth/dist/crypto/index.mjs\");\n/* harmony import */ var _better_auth_ByruPN9q_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./better-auth.ByruPN9q.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.ByruPN9q.mjs\");\n/* harmony import */ var _better_auth_DORkW_Ge_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./better-auth.DORkW_Ge.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DORkW_Ge.mjs\");\n/* harmony import */ var _better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./better-auth.n2KFGwjY.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.n2KFGwjY.mjs\");\n/* harmony import */ var _cookies_index_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../cookies/index.mjs */ \"(rsc)/../../node_modules/better-auth/dist/cookies/index.mjs\");\n/* harmony import */ var _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./better-auth.DBGfIDnh.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DBGfIDnh.mjs\");\n/* harmony import */ var _better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./better-auth.z3dsxLxE.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.z3dsxLxE.mjs\");\n/* harmony import */ var better_call__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! better-call */ \"(rsc)/../../node_modules/better-call/dist/index.js\");\n/* harmony import */ var _better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @better-auth/utils/hash */ \"(rsc)/../../node_modules/@better-auth/utils/dist/hash.mjs\");\n/* harmony import */ var _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @better-auth/utils/base64 */ \"(rsc)/../../node_modules/@better-auth/utils/dist/base64.mjs\");\n/* harmony import */ var _better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./better-auth.B4Qoxdgc.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs\");\n/* harmony import */ var _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./better-auth.8zoxzg-F.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs\");\n/* harmony import */ var _better_auth_YwDQhoPc_mjs__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./better-auth.YwDQhoPc.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.YwDQhoPc.mjs\");\n/* harmony import */ var _better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./better-auth.VTXNLFMT.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.VTXNLFMT.mjs\");\n/* harmony import */ var _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./better-auth.DdzSJf-n.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst DEFAULT_SECRET = \"better-auth-secret-123456789\";\n\nconst init = async (options) => {\n  const adapter = await (0,_better_auth_ByruPN9q_mjs__WEBPACK_IMPORTED_MODULE_3__.a)(options);\n  const plugins = options.plugins || [];\n  const internalPlugins = getInternalPlugins(options);\n  const logger = (0,_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_7__.c)(options.logger);\n  const baseURL = (0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_15__.a)(options.baseURL, options.basePath);\n  const secret = options.secret || _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_13__.e.BETTER_AUTH_SECRET || _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_13__.e.AUTH_SECRET || DEFAULT_SECRET;\n  if (secret === DEFAULT_SECRET) {\n    if (_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_13__.a) {\n      logger.error(\n        \"You are using the default secret. Please set `BETTER_AUTH_SECRET` in your environment variables or pass `secret` in your auth config.\"\n      );\n    }\n  }\n  options = {\n    ...options,\n    secret,\n    baseURL: baseURL ? new URL(baseURL).origin : \"\",\n    basePath: options.basePath || \"/api/auth\",\n    plugins: plugins.concat(internalPlugins)\n  };\n  const cookies = (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_6__.getCookies)(options);\n  const tables = (0,_better_auth_DORkW_Ge_mjs__WEBPACK_IMPORTED_MODULE_4__.g)(options);\n  const providers = Object.keys(options.socialProviders || {}).map((key) => {\n    const value = options.socialProviders?.[key];\n    if (!value || value.enabled === false) {\n      return null;\n    }\n    if (!value.clientId) {\n      logger.warn(\n        `Social provider ${key} is missing clientId or clientSecret`\n      );\n    }\n    const provider = _better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_8__.t[key](\n      value\n      // TODO: fix this\n    );\n    provider.disableImplicitSignUp = value.disableImplicitSignUp;\n    return provider;\n  }).filter((x) => x !== null);\n  const generateIdFunc = ({ model, size }) => {\n    if (typeof options.advanced?.generateId === \"function\") {\n      return options.advanced.generateId({ model, size });\n    }\n    if (typeof options?.advanced?.database?.generateId === \"function\") {\n      return options.advanced.database.generateId({ model, size });\n    }\n    return (0,_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_7__.g)(size);\n  };\n  const ctx = {\n    appName: options.appName || \"Better Auth\",\n    socialProviders: providers,\n    options,\n    tables,\n    trustedOrigins: getTrustedOrigins(options),\n    baseURL: baseURL || \"\",\n    sessionConfig: {\n      updateAge: options.session?.updateAge !== void 0 ? options.session.updateAge : 24 * 60 * 60,\n      // 24 hours\n      expiresIn: options.session?.expiresIn || 60 * 60 * 24 * 7,\n      // 7 days\n      freshAge: options.session?.freshAge === void 0 ? 60 * 60 * 24 : options.session.freshAge\n    },\n    secret,\n    rateLimit: {\n      ...options.rateLimit,\n      enabled: options.rateLimit?.enabled ?? _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_13__.a,\n      window: options.rateLimit?.window || 10,\n      max: options.rateLimit?.max || 100,\n      storage: options.rateLimit?.storage || (options.secondaryStorage ? \"secondary-storage\" : \"memory\")\n    },\n    authCookies: cookies,\n    logger,\n    generateId: generateIdFunc,\n    session: null,\n    secondaryStorage: options.secondaryStorage,\n    password: {\n      hash: options.emailAndPassword?.password?.hash || _crypto_index_mjs__WEBPACK_IMPORTED_MODULE_2__.hashPassword,\n      verify: options.emailAndPassword?.password?.verify || _crypto_index_mjs__WEBPACK_IMPORTED_MODULE_2__.verifyPassword,\n      config: {\n        minPasswordLength: options.emailAndPassword?.minPasswordLength || 8,\n        maxPasswordLength: options.emailAndPassword?.maxPasswordLength || 128\n      },\n      checkPassword: _better_auth_YwDQhoPc_mjs__WEBPACK_IMPORTED_MODULE_14__.c\n    },\n    setNewSession(session) {\n      this.newSession = session;\n    },\n    newSession: null,\n    adapter,\n    internalAdapter: (0,_better_auth_ByruPN9q_mjs__WEBPACK_IMPORTED_MODULE_3__.c)(adapter, {\n      options,\n      hooks: options.databaseHooks ? [options.databaseHooks] : []}),\n    createAuthCookie: (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_6__.createCookieGetter)(options),\n    async runMigrations() {\n      if (!options.database || \"updateMany\" in options.database) {\n        throw new _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_16__.B(\n          \"Database is not provided or it's an adapter. Migrations are only supported with a database instance.\"\n        );\n      }\n      const { runMigrations } = await (0,_better_auth_ByruPN9q_mjs__WEBPACK_IMPORTED_MODULE_3__.e)(options);\n      await runMigrations();\n    }\n  };\n  let { context } = runPluginInit(ctx);\n  return context;\n};\nfunction runPluginInit(ctx) {\n  let options = ctx.options;\n  const plugins = options.plugins || [];\n  let context = ctx;\n  const dbHooks = [];\n  for (const plugin of plugins) {\n    if (plugin.init) {\n      const result = plugin.init(context);\n      if (typeof result === \"object\") {\n        if (result.options) {\n          const { databaseHooks, ...restOpts } = result.options;\n          if (databaseHooks) {\n            dbHooks.push(databaseHooks);\n          }\n          options = (0,defu__WEBPACK_IMPORTED_MODULE_1__.defu)(options, restOpts);\n        }\n        if (result.context) {\n          context = {\n            ...context,\n            ...result.context\n          };\n        }\n      }\n    }\n  }\n  dbHooks.push(options.databaseHooks);\n  context.internalAdapter = (0,_better_auth_ByruPN9q_mjs__WEBPACK_IMPORTED_MODULE_3__.c)(ctx.adapter, {\n    options,\n    hooks: dbHooks.filter((u) => u !== void 0),\n    generateId: ctx.generateId\n  });\n  context.options = options;\n  return { context };\n}\nfunction getInternalPlugins(options) {\n  const plugins = [];\n  if (options.advanced?.crossSubDomainCookies?.enabled) ;\n  return plugins;\n}\nfunction getTrustedOrigins(options) {\n  const baseURL = (0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_15__.a)(options.baseURL, options.basePath);\n  if (!baseURL) {\n    return [];\n  }\n  const trustedOrigins = [new URL(baseURL).origin];\n  if (options.trustedOrigins && Array.isArray(options.trustedOrigins)) {\n    trustedOrigins.push(...options.trustedOrigins);\n  }\n  const envTrustedOrigins = _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_13__.e.BETTER_AUTH_TRUSTED_ORIGINS;\n  if (envTrustedOrigins) {\n    trustedOrigins.push(...envTrustedOrigins.split(\",\"));\n  }\n  if (trustedOrigins.filter((x) => !x).length) {\n    throw new _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_16__.B(\n      \"A provided trusted origin is invalid, make sure your trusted origins list is properly defined.\"\n    );\n  }\n  return trustedOrigins;\n}\n\nconst betterAuth = (options) => {\n  const authContext = init(options);\n  const { api } = (0,_api_index_mjs__WEBPACK_IMPORTED_MODULE_0__.getEndpoints)(authContext, options);\n  const errorCodes = options.plugins?.reduce((acc, plugin) => {\n    if (plugin.$ERROR_CODES) {\n      return {\n        ...acc,\n        ...plugin.$ERROR_CODES\n      };\n    }\n    return acc;\n  }, {});\n  return {\n    handler: async (request) => {\n      const ctx = await authContext;\n      const basePath = ctx.options.basePath || \"/api/auth\";\n      if (!ctx.options.baseURL) {\n        const baseURL = (0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_15__.a)(void 0, basePath, request);\n        if (baseURL) {\n          ctx.baseURL = baseURL;\n          ctx.options.baseURL = (0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_15__.g)(ctx.baseURL) || void 0;\n        } else {\n          throw new _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_16__.B(\n            \"Could not get base URL from request. Please provide a valid base URL.\"\n          );\n        }\n      }\n      ctx.trustedOrigins = [\n        ...options.trustedOrigins ? Array.isArray(options.trustedOrigins) ? options.trustedOrigins : await options.trustedOrigins(request) : [],\n        ctx.options.baseURL\n      ];\n      const { handler } = (0,_api_index_mjs__WEBPACK_IMPORTED_MODULE_0__.router)(ctx, options);\n      return handler(request);\n    },\n    api,\n    options,\n    $context: authContext,\n    $Infer: {},\n    $ERROR_CODES: {\n      ...errorCodes,\n      ..._better_auth_z3dsxLxE_mjs__WEBPACK_IMPORTED_MODULE_8__.B\n    }\n  };\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLkNiaHk2V0RKLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBd0Q7QUFDNUI7QUFDdUM7QUFDMEM7QUFDN0M7QUFDaEQ7QUFDb0I7QUFDa0M7QUFDVTtBQUNTO0FBQ3BFO0FBQ1k7QUFDRjtBQUNEO0FBQ0k7QUFDQztBQUNyQjtBQUNzQjtBQUNxQztBQUNUO0FBQ2E7QUFDWDs7QUFFbEU7O0FBRUE7QUFDQSx3QkFBd0IsNERBQVU7QUFDbEM7QUFDQTtBQUNBLGlCQUFpQiw0REFBWTtBQUM3QixrQkFBa0IsNkRBQVU7QUFDNUIsbUNBQW1DLHlEQUFHLHVCQUF1Qix5REFBRztBQUNoRTtBQUNBLFFBQVEseURBQVk7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLDhEQUFVO0FBQzVCLGlCQUFpQiw0REFBYTtBQUM5Qiw2REFBNkQ7QUFDN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLEtBQUs7QUFDaEM7QUFDQTtBQUNBLHFCQUFxQix3REFBZTtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILDRCQUE0QixhQUFhO0FBQ3pDO0FBQ0EsMkNBQTJDLGFBQWE7QUFDeEQ7QUFDQTtBQUNBLG9EQUFvRCxhQUFhO0FBQ2pFO0FBQ0EsV0FBVyw0REFBVTtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLDZDQUE2Qyx5REFBWTtBQUN6RDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0RBQXdELDJEQUFZO0FBQ3BFLDREQUE0RCw2REFBYztBQUMxRTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsbUJBQW1CO0FBQ25CLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxxQkFBcUIsNERBQXFCO0FBQzFDO0FBQ0Esa0VBQWtFO0FBQ2xFLHNCQUFzQixzRUFBa0I7QUFDeEM7QUFDQTtBQUNBLGtCQUFrQix5REFBZTtBQUNqQztBQUNBO0FBQ0E7QUFDQSxjQUFjLGdCQUFnQixRQUFRLDREQUFhO0FBQ25EO0FBQ0E7QUFDQTtBQUNBLFFBQVEsVUFBVTtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsNkJBQTZCO0FBQy9DO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQiwwQ0FBSTtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLDREQUFxQjtBQUNqRDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsNkRBQVU7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIseURBQUc7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLHlEQUFlO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFVBQVUsTUFBTSxFQUFFLDREQUFZO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHLElBQUk7QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLDZEQUFVO0FBQ2xDO0FBQ0E7QUFDQSxnQ0FBZ0MsNkRBQVM7QUFDekMsVUFBVTtBQUNWLG9CQUFvQix5REFBZTtBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyxVQUFVLEVBQUUsc0RBQU07QUFDaEM7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQSxTQUFTLHdEQUFnQjtBQUN6QjtBQUNBO0FBQ0E7O0FBRTJCIiwic291cmNlcyI6WyIvVXNlcnMvbWlsYW4vRGVza3RvcC9BcHBzL2JldHRlci1hdXRoL25vZGVfbW9kdWxlcy9iZXR0ZXItYXV0aC9kaXN0L3NoYXJlZC9iZXR0ZXItYXV0aC5DYmh5NldESi5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ2V0RW5kcG9pbnRzLCByb3V0ZXIgfSBmcm9tICcuLi9hcGkvaW5kZXgubWpzJztcbmltcG9ydCB7IGRlZnUgfSBmcm9tICdkZWZ1JztcbmltcG9ydCB7IHZlcmlmeVBhc3N3b3JkLCBoYXNoUGFzc3dvcmQgfSBmcm9tICcuLi9jcnlwdG8vaW5kZXgubWpzJztcbmltcG9ydCB7IGEgYXMgZ2V0QWRhcHRlciwgYyBhcyBjcmVhdGVJbnRlcm5hbEFkYXB0ZXIsIGUgYXMgZ2V0TWlncmF0aW9ucyB9IGZyb20gJy4vYmV0dGVyLWF1dGguQnlydVBOOXEubWpzJztcbmltcG9ydCB7IGcgYXMgZ2V0QXV0aFRhYmxlcyB9IGZyb20gJy4vYmV0dGVyLWF1dGguRE9Sa1dfR2UubWpzJztcbmltcG9ydCAnem9kL3Y0JztcbmltcG9ydCAnLi9iZXR0ZXItYXV0aC5uMktGR3dqWS5tanMnO1xuaW1wb3J0IHsgZ2V0Q29va2llcywgY3JlYXRlQ29va2llR2V0dGVyIH0gZnJvbSAnLi4vY29va2llcy9pbmRleC5tanMnO1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVMb2dnZXIsIGcgYXMgZ2VuZXJhdGVJZCB9IGZyb20gJy4vYmV0dGVyLWF1dGguREJHZklEbmgubWpzJztcbmltcG9ydCB7IHQgYXMgc29jaWFsUHJvdmlkZXJzLCBCIGFzIEJBU0VfRVJST1JfQ09ERVMgfSBmcm9tICcuL2JldHRlci1hdXRoLnozZHN4THhFLm1qcyc7XG5pbXBvcnQgJ2JldHRlci1jYWxsJztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzL2hhc2gnO1xuaW1wb3J0ICdAbm9ibGUvY2lwaGVycy9jaGFjaGEnO1xuaW1wb3J0ICdAbm9ibGUvY2lwaGVycy91dGlscyc7XG5pbXBvcnQgJ0Bub2JsZS9jaXBoZXJzL3dlYmNyeXB0byc7XG5pbXBvcnQgJ0BiZXR0ZXItYXV0aC91dGlscy9iYXNlNjQnO1xuaW1wb3J0ICdqb3NlJztcbmltcG9ydCAnLi9iZXR0ZXItYXV0aC5CNFFveGRnYy5tanMnO1xuaW1wb3J0IHsgZSBhcyBlbnYsIGEgYXMgaXNQcm9kdWN0aW9uIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC44em94emctRi5tanMnO1xuaW1wb3J0IHsgYyBhcyBjaGVja1Bhc3N3b3JkIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC5Zd0RRaG9QYy5tanMnO1xuaW1wb3J0IHsgYSBhcyBnZXRCYXNlVVJMLCBnIGFzIGdldE9yaWdpbiB9IGZyb20gJy4vYmV0dGVyLWF1dGguVlRYTkxGTVQubWpzJztcbmltcG9ydCB7IEIgYXMgQmV0dGVyQXV0aEVycm9yIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC5EZHpTSmYtbi5tanMnO1xuXG5jb25zdCBERUZBVUxUX1NFQ1JFVCA9IFwiYmV0dGVyLWF1dGgtc2VjcmV0LTEyMzQ1Njc4OVwiO1xuXG5jb25zdCBpbml0ID0gYXN5bmMgKG9wdGlvbnMpID0+IHtcbiAgY29uc3QgYWRhcHRlciA9IGF3YWl0IGdldEFkYXB0ZXIob3B0aW9ucyk7XG4gIGNvbnN0IHBsdWdpbnMgPSBvcHRpb25zLnBsdWdpbnMgfHwgW107XG4gIGNvbnN0IGludGVybmFsUGx1Z2lucyA9IGdldEludGVybmFsUGx1Z2lucyhvcHRpb25zKTtcbiAgY29uc3QgbG9nZ2VyID0gY3JlYXRlTG9nZ2VyKG9wdGlvbnMubG9nZ2VyKTtcbiAgY29uc3QgYmFzZVVSTCA9IGdldEJhc2VVUkwob3B0aW9ucy5iYXNlVVJMLCBvcHRpb25zLmJhc2VQYXRoKTtcbiAgY29uc3Qgc2VjcmV0ID0gb3B0aW9ucy5zZWNyZXQgfHwgZW52LkJFVFRFUl9BVVRIX1NFQ1JFVCB8fCBlbnYuQVVUSF9TRUNSRVQgfHwgREVGQVVMVF9TRUNSRVQ7XG4gIGlmIChzZWNyZXQgPT09IERFRkFVTFRfU0VDUkVUKSB7XG4gICAgaWYgKGlzUHJvZHVjdGlvbikge1xuICAgICAgbG9nZ2VyLmVycm9yKFxuICAgICAgICBcIllvdSBhcmUgdXNpbmcgdGhlIGRlZmF1bHQgc2VjcmV0LiBQbGVhc2Ugc2V0IGBCRVRURVJfQVVUSF9TRUNSRVRgIGluIHlvdXIgZW52aXJvbm1lbnQgdmFyaWFibGVzIG9yIHBhc3MgYHNlY3JldGAgaW4geW91ciBhdXRoIGNvbmZpZy5cIlxuICAgICAgKTtcbiAgICB9XG4gIH1cbiAgb3B0aW9ucyA9IHtcbiAgICAuLi5vcHRpb25zLFxuICAgIHNlY3JldCxcbiAgICBiYXNlVVJMOiBiYXNlVVJMID8gbmV3IFVSTChiYXNlVVJMKS5vcmlnaW4gOiBcIlwiLFxuICAgIGJhc2VQYXRoOiBvcHRpb25zLmJhc2VQYXRoIHx8IFwiL2FwaS9hdXRoXCIsXG4gICAgcGx1Z2luczogcGx1Z2lucy5jb25jYXQoaW50ZXJuYWxQbHVnaW5zKVxuICB9O1xuICBjb25zdCBjb29raWVzID0gZ2V0Q29va2llcyhvcHRpb25zKTtcbiAgY29uc3QgdGFibGVzID0gZ2V0QXV0aFRhYmxlcyhvcHRpb25zKTtcbiAgY29uc3QgcHJvdmlkZXJzID0gT2JqZWN0LmtleXMob3B0aW9ucy5zb2NpYWxQcm92aWRlcnMgfHwge30pLm1hcCgoa2V5KSA9PiB7XG4gICAgY29uc3QgdmFsdWUgPSBvcHRpb25zLnNvY2lhbFByb3ZpZGVycz8uW2tleV07XG4gICAgaWYgKCF2YWx1ZSB8fCB2YWx1ZS5lbmFibGVkID09PSBmYWxzZSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGlmICghdmFsdWUuY2xpZW50SWQpIHtcbiAgICAgIGxvZ2dlci53YXJuKFxuICAgICAgICBgU29jaWFsIHByb3ZpZGVyICR7a2V5fSBpcyBtaXNzaW5nIGNsaWVudElkIG9yIGNsaWVudFNlY3JldGBcbiAgICAgICk7XG4gICAgfVxuICAgIGNvbnN0IHByb3ZpZGVyID0gc29jaWFsUHJvdmlkZXJzW2tleV0oXG4gICAgICB2YWx1ZVxuICAgICAgLy8gVE9ETzogZml4IHRoaXNcbiAgICApO1xuICAgIHByb3ZpZGVyLmRpc2FibGVJbXBsaWNpdFNpZ25VcCA9IHZhbHVlLmRpc2FibGVJbXBsaWNpdFNpZ25VcDtcbiAgICByZXR1cm4gcHJvdmlkZXI7XG4gIH0pLmZpbHRlcigoeCkgPT4geCAhPT0gbnVsbCk7XG4gIGNvbnN0IGdlbmVyYXRlSWRGdW5jID0gKHsgbW9kZWwsIHNpemUgfSkgPT4ge1xuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5hZHZhbmNlZD8uZ2VuZXJhdGVJZCA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICByZXR1cm4gb3B0aW9ucy5hZHZhbmNlZC5nZW5lcmF0ZUlkKHsgbW9kZWwsIHNpemUgfSk7XG4gICAgfVxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucz8uYWR2YW5jZWQ/LmRhdGFiYXNlPy5nZW5lcmF0ZUlkID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIHJldHVybiBvcHRpb25zLmFkdmFuY2VkLmRhdGFiYXNlLmdlbmVyYXRlSWQoeyBtb2RlbCwgc2l6ZSB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGdlbmVyYXRlSWQoc2l6ZSk7XG4gIH07XG4gIGNvbnN0IGN0eCA9IHtcbiAgICBhcHBOYW1lOiBvcHRpb25zLmFwcE5hbWUgfHwgXCJCZXR0ZXIgQXV0aFwiLFxuICAgIHNvY2lhbFByb3ZpZGVyczogcHJvdmlkZXJzLFxuICAgIG9wdGlvbnMsXG4gICAgdGFibGVzLFxuICAgIHRydXN0ZWRPcmlnaW5zOiBnZXRUcnVzdGVkT3JpZ2lucyhvcHRpb25zKSxcbiAgICBiYXNlVVJMOiBiYXNlVVJMIHx8IFwiXCIsXG4gICAgc2Vzc2lvbkNvbmZpZzoge1xuICAgICAgdXBkYXRlQWdlOiBvcHRpb25zLnNlc3Npb24/LnVwZGF0ZUFnZSAhPT0gdm9pZCAwID8gb3B0aW9ucy5zZXNzaW9uLnVwZGF0ZUFnZSA6IDI0ICogNjAgKiA2MCxcbiAgICAgIC8vIDI0IGhvdXJzXG4gICAgICBleHBpcmVzSW46IG9wdGlvbnMuc2Vzc2lvbj8uZXhwaXJlc0luIHx8IDYwICogNjAgKiAyNCAqIDcsXG4gICAgICAvLyA3IGRheXNcbiAgICAgIGZyZXNoQWdlOiBvcHRpb25zLnNlc3Npb24/LmZyZXNoQWdlID09PSB2b2lkIDAgPyA2MCAqIDYwICogMjQgOiBvcHRpb25zLnNlc3Npb24uZnJlc2hBZ2VcbiAgICB9LFxuICAgIHNlY3JldCxcbiAgICByYXRlTGltaXQ6IHtcbiAgICAgIC4uLm9wdGlvbnMucmF0ZUxpbWl0LFxuICAgICAgZW5hYmxlZDogb3B0aW9ucy5yYXRlTGltaXQ/LmVuYWJsZWQgPz8gaXNQcm9kdWN0aW9uLFxuICAgICAgd2luZG93OiBvcHRpb25zLnJhdGVMaW1pdD8ud2luZG93IHx8IDEwLFxuICAgICAgbWF4OiBvcHRpb25zLnJhdGVMaW1pdD8ubWF4IHx8IDEwMCxcbiAgICAgIHN0b3JhZ2U6IG9wdGlvbnMucmF0ZUxpbWl0Py5zdG9yYWdlIHx8IChvcHRpb25zLnNlY29uZGFyeVN0b3JhZ2UgPyBcInNlY29uZGFyeS1zdG9yYWdlXCIgOiBcIm1lbW9yeVwiKVxuICAgIH0sXG4gICAgYXV0aENvb2tpZXM6IGNvb2tpZXMsXG4gICAgbG9nZ2VyLFxuICAgIGdlbmVyYXRlSWQ6IGdlbmVyYXRlSWRGdW5jLFxuICAgIHNlc3Npb246IG51bGwsXG4gICAgc2Vjb25kYXJ5U3RvcmFnZTogb3B0aW9ucy5zZWNvbmRhcnlTdG9yYWdlLFxuICAgIHBhc3N3b3JkOiB7XG4gICAgICBoYXNoOiBvcHRpb25zLmVtYWlsQW5kUGFzc3dvcmQ/LnBhc3N3b3JkPy5oYXNoIHx8IGhhc2hQYXNzd29yZCxcbiAgICAgIHZlcmlmeTogb3B0aW9ucy5lbWFpbEFuZFBhc3N3b3JkPy5wYXNzd29yZD8udmVyaWZ5IHx8IHZlcmlmeVBhc3N3b3JkLFxuICAgICAgY29uZmlnOiB7XG4gICAgICAgIG1pblBhc3N3b3JkTGVuZ3RoOiBvcHRpb25zLmVtYWlsQW5kUGFzc3dvcmQ/Lm1pblBhc3N3b3JkTGVuZ3RoIHx8IDgsXG4gICAgICAgIG1heFBhc3N3b3JkTGVuZ3RoOiBvcHRpb25zLmVtYWlsQW5kUGFzc3dvcmQ/Lm1heFBhc3N3b3JkTGVuZ3RoIHx8IDEyOFxuICAgICAgfSxcbiAgICAgIGNoZWNrUGFzc3dvcmRcbiAgICB9LFxuICAgIHNldE5ld1Nlc3Npb24oc2Vzc2lvbikge1xuICAgICAgdGhpcy5uZXdTZXNzaW9uID0gc2Vzc2lvbjtcbiAgICB9LFxuICAgIG5ld1Nlc3Npb246IG51bGwsXG4gICAgYWRhcHRlcixcbiAgICBpbnRlcm5hbEFkYXB0ZXI6IGNyZWF0ZUludGVybmFsQWRhcHRlcihhZGFwdGVyLCB7XG4gICAgICBvcHRpb25zLFxuICAgICAgaG9va3M6IG9wdGlvbnMuZGF0YWJhc2VIb29rcyA/IFtvcHRpb25zLmRhdGFiYXNlSG9va3NdIDogW119KSxcbiAgICBjcmVhdGVBdXRoQ29va2llOiBjcmVhdGVDb29raWVHZXR0ZXIob3B0aW9ucyksXG4gICAgYXN5bmMgcnVuTWlncmF0aW9ucygpIHtcbiAgICAgIGlmICghb3B0aW9ucy5kYXRhYmFzZSB8fCBcInVwZGF0ZU1hbnlcIiBpbiBvcHRpb25zLmRhdGFiYXNlKSB7XG4gICAgICAgIHRocm93IG5ldyBCZXR0ZXJBdXRoRXJyb3IoXG4gICAgICAgICAgXCJEYXRhYmFzZSBpcyBub3QgcHJvdmlkZWQgb3IgaXQncyBhbiBhZGFwdGVyLiBNaWdyYXRpb25zIGFyZSBvbmx5IHN1cHBvcnRlZCB3aXRoIGEgZGF0YWJhc2UgaW5zdGFuY2UuXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgcnVuTWlncmF0aW9ucyB9ID0gYXdhaXQgZ2V0TWlncmF0aW9ucyhvcHRpb25zKTtcbiAgICAgIGF3YWl0IHJ1bk1pZ3JhdGlvbnMoKTtcbiAgICB9XG4gIH07XG4gIGxldCB7IGNvbnRleHQgfSA9IHJ1blBsdWdpbkluaXQoY3R4KTtcbiAgcmV0dXJuIGNvbnRleHQ7XG59O1xuZnVuY3Rpb24gcnVuUGx1Z2luSW5pdChjdHgpIHtcbiAgbGV0IG9wdGlvbnMgPSBjdHgub3B0aW9ucztcbiAgY29uc3QgcGx1Z2lucyA9IG9wdGlvbnMucGx1Z2lucyB8fCBbXTtcbiAgbGV0IGNvbnRleHQgPSBjdHg7XG4gIGNvbnN0IGRiSG9va3MgPSBbXTtcbiAgZm9yIChjb25zdCBwbHVnaW4gb2YgcGx1Z2lucykge1xuICAgIGlmIChwbHVnaW4uaW5pdCkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gcGx1Z2luLmluaXQoY29udGV4dCk7XG4gICAgICBpZiAodHlwZW9mIHJlc3VsdCA9PT0gXCJvYmplY3RcIikge1xuICAgICAgICBpZiAocmVzdWx0Lm9wdGlvbnMpIHtcbiAgICAgICAgICBjb25zdCB7IGRhdGFiYXNlSG9va3MsIC4uLnJlc3RPcHRzIH0gPSByZXN1bHQub3B0aW9ucztcbiAgICAgICAgICBpZiAoZGF0YWJhc2VIb29rcykge1xuICAgICAgICAgICAgZGJIb29rcy5wdXNoKGRhdGFiYXNlSG9va3MpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBvcHRpb25zID0gZGVmdShvcHRpb25zLCByZXN0T3B0cyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlc3VsdC5jb250ZXh0KSB7XG4gICAgICAgICAgY29udGV4dCA9IHtcbiAgICAgICAgICAgIC4uLmNvbnRleHQsXG4gICAgICAgICAgICAuLi5yZXN1bHQuY29udGV4dFxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgZGJIb29rcy5wdXNoKG9wdGlvbnMuZGF0YWJhc2VIb29rcyk7XG4gIGNvbnRleHQuaW50ZXJuYWxBZGFwdGVyID0gY3JlYXRlSW50ZXJuYWxBZGFwdGVyKGN0eC5hZGFwdGVyLCB7XG4gICAgb3B0aW9ucyxcbiAgICBob29rczogZGJIb29rcy5maWx0ZXIoKHUpID0+IHUgIT09IHZvaWQgMCksXG4gICAgZ2VuZXJhdGVJZDogY3R4LmdlbmVyYXRlSWRcbiAgfSk7XG4gIGNvbnRleHQub3B0aW9ucyA9IG9wdGlvbnM7XG4gIHJldHVybiB7IGNvbnRleHQgfTtcbn1cbmZ1bmN0aW9uIGdldEludGVybmFsUGx1Z2lucyhvcHRpb25zKSB7XG4gIGNvbnN0IHBsdWdpbnMgPSBbXTtcbiAgaWYgKG9wdGlvbnMuYWR2YW5jZWQ/LmNyb3NzU3ViRG9tYWluQ29va2llcz8uZW5hYmxlZCkgO1xuICByZXR1cm4gcGx1Z2lucztcbn1cbmZ1bmN0aW9uIGdldFRydXN0ZWRPcmlnaW5zKG9wdGlvbnMpIHtcbiAgY29uc3QgYmFzZVVSTCA9IGdldEJhc2VVUkwob3B0aW9ucy5iYXNlVVJMLCBvcHRpb25zLmJhc2VQYXRoKTtcbiAgaWYgKCFiYXNlVVJMKSB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG4gIGNvbnN0IHRydXN0ZWRPcmlnaW5zID0gW25ldyBVUkwoYmFzZVVSTCkub3JpZ2luXTtcbiAgaWYgKG9wdGlvbnMudHJ1c3RlZE9yaWdpbnMgJiYgQXJyYXkuaXNBcnJheShvcHRpb25zLnRydXN0ZWRPcmlnaW5zKSkge1xuICAgIHRydXN0ZWRPcmlnaW5zLnB1c2goLi4ub3B0aW9ucy50cnVzdGVkT3JpZ2lucyk7XG4gIH1cbiAgY29uc3QgZW52VHJ1c3RlZE9yaWdpbnMgPSBlbnYuQkVUVEVSX0FVVEhfVFJVU1RFRF9PUklHSU5TO1xuICBpZiAoZW52VHJ1c3RlZE9yaWdpbnMpIHtcbiAgICB0cnVzdGVkT3JpZ2lucy5wdXNoKC4uLmVudlRydXN0ZWRPcmlnaW5zLnNwbGl0KFwiLFwiKSk7XG4gIH1cbiAgaWYgKHRydXN0ZWRPcmlnaW5zLmZpbHRlcigoeCkgPT4gIXgpLmxlbmd0aCkge1xuICAgIHRocm93IG5ldyBCZXR0ZXJBdXRoRXJyb3IoXG4gICAgICBcIkEgcHJvdmlkZWQgdHJ1c3RlZCBvcmlnaW4gaXMgaW52YWxpZCwgbWFrZSBzdXJlIHlvdXIgdHJ1c3RlZCBvcmlnaW5zIGxpc3QgaXMgcHJvcGVybHkgZGVmaW5lZC5cIlxuICAgICk7XG4gIH1cbiAgcmV0dXJuIHRydXN0ZWRPcmlnaW5zO1xufVxuXG5jb25zdCBiZXR0ZXJBdXRoID0gKG9wdGlvbnMpID0+IHtcbiAgY29uc3QgYXV0aENvbnRleHQgPSBpbml0KG9wdGlvbnMpO1xuICBjb25zdCB7IGFwaSB9ID0gZ2V0RW5kcG9pbnRzKGF1dGhDb250ZXh0LCBvcHRpb25zKTtcbiAgY29uc3QgZXJyb3JDb2RlcyA9IG9wdGlvbnMucGx1Z2lucz8ucmVkdWNlKChhY2MsIHBsdWdpbikgPT4ge1xuICAgIGlmIChwbHVnaW4uJEVSUk9SX0NPREVTKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5hY2MsXG4gICAgICAgIC4uLnBsdWdpbi4kRVJST1JfQ09ERVNcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBhY2M7XG4gIH0sIHt9KTtcbiAgcmV0dXJuIHtcbiAgICBoYW5kbGVyOiBhc3luYyAocmVxdWVzdCkgPT4ge1xuICAgICAgY29uc3QgY3R4ID0gYXdhaXQgYXV0aENvbnRleHQ7XG4gICAgICBjb25zdCBiYXNlUGF0aCA9IGN0eC5vcHRpb25zLmJhc2VQYXRoIHx8IFwiL2FwaS9hdXRoXCI7XG4gICAgICBpZiAoIWN0eC5vcHRpb25zLmJhc2VVUkwpIHtcbiAgICAgICAgY29uc3QgYmFzZVVSTCA9IGdldEJhc2VVUkwodm9pZCAwLCBiYXNlUGF0aCwgcmVxdWVzdCk7XG4gICAgICAgIGlmIChiYXNlVVJMKSB7XG4gICAgICAgICAgY3R4LmJhc2VVUkwgPSBiYXNlVVJMO1xuICAgICAgICAgIGN0eC5vcHRpb25zLmJhc2VVUkwgPSBnZXRPcmlnaW4oY3R4LmJhc2VVUkwpIHx8IHZvaWQgMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgQmV0dGVyQXV0aEVycm9yKFxuICAgICAgICAgICAgXCJDb3VsZCBub3QgZ2V0IGJhc2UgVVJMIGZyb20gcmVxdWVzdC4gUGxlYXNlIHByb3ZpZGUgYSB2YWxpZCBiYXNlIFVSTC5cIlxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGN0eC50cnVzdGVkT3JpZ2lucyA9IFtcbiAgICAgICAgLi4ub3B0aW9ucy50cnVzdGVkT3JpZ2lucyA/IEFycmF5LmlzQXJyYXkob3B0aW9ucy50cnVzdGVkT3JpZ2lucykgPyBvcHRpb25zLnRydXN0ZWRPcmlnaW5zIDogYXdhaXQgb3B0aW9ucy50cnVzdGVkT3JpZ2lucyhyZXF1ZXN0KSA6IFtdLFxuICAgICAgICBjdHgub3B0aW9ucy5iYXNlVVJMXG4gICAgICBdO1xuICAgICAgY29uc3QgeyBoYW5kbGVyIH0gPSByb3V0ZXIoY3R4LCBvcHRpb25zKTtcbiAgICAgIHJldHVybiBoYW5kbGVyKHJlcXVlc3QpO1xuICAgIH0sXG4gICAgYXBpLFxuICAgIG9wdGlvbnMsXG4gICAgJGNvbnRleHQ6IGF1dGhDb250ZXh0LFxuICAgICRJbmZlcjoge30sXG4gICAgJEVSUk9SX0NPREVTOiB7XG4gICAgICAuLi5lcnJvckNvZGVzLFxuICAgICAgLi4uQkFTRV9FUlJPUl9DT0RFU1xuICAgIH1cbiAgfTtcbn07XG5cbmV4cG9ydCB7IGJldHRlckF1dGggYXMgYiB9O1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/shared/better-auth.Cbhy6WDJ.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/shared/better-auth.D-2CmEwz.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.D-2CmEwz.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   c: () => (/* binding */ capitalizeFirstLetter)\n/* harmony export */ });\nfunction capitalizeFirstLetter(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLkQtMkNtRXd6Lm1qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQUE7QUFDQTtBQUNBOztBQUVzQyIsInNvdXJjZXMiOlsiL1VzZXJzL21pbGFuL0Rlc2t0b3AvQXBwcy9iZXR0ZXItYXV0aC9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguRC0yQ21Fd3oubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIGNhcGl0YWxpemVGaXJzdExldHRlcihzdHIpIHtcbiAgcmV0dXJuIHN0ci5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHN0ci5zbGljZSgxKTtcbn1cblxuZXhwb3J0IHsgY2FwaXRhbGl6ZUZpcnN0TGV0dGVyIGFzIGMgfTtcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/shared/better-auth.D-2CmEwz.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DBGfIDnh.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.DBGfIDnh.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   a: () => (/* binding */ logger),\n/* harmony export */   c: () => (/* binding */ createLogger),\n/* harmony export */   g: () => (/* binding */ generateId),\n/* harmony export */   l: () => (/* binding */ levels),\n/* harmony export */   s: () => (/* binding */ shouldPublishLog)\n/* harmony export */ });\n/* harmony import */ var _better_auth_utils_random__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @better-auth/utils/random */ \"(rsc)/../../node_modules/@better-auth/utils/dist/random.mjs\");\n\n\nconst generateId = (size) => {\n  return (0,_better_auth_utils_random__WEBPACK_IMPORTED_MODULE_0__.createRandomStringGenerator)(\"a-z\", \"A-Z\", \"0-9\")(size || 32);\n};\n\nconst levels = [\"info\", \"success\", \"warn\", \"error\", \"debug\"];\nfunction shouldPublishLog(currentLogLevel, logLevel) {\n  return levels.indexOf(logLevel) <= levels.indexOf(currentLogLevel);\n}\nconst colors = {\n  reset: \"\\x1B[0m\",\n  bright: \"\\x1B[1m\",\n  dim: \"\\x1B[2m\",\n  fg: {\n    red: \"\\x1B[31m\",\n    green: \"\\x1B[32m\",\n    yellow: \"\\x1B[33m\",\n    blue: \"\\x1B[34m\",\n    magenta: \"\\x1B[35m\"}};\nconst levelColors = {\n  info: colors.fg.blue,\n  success: colors.fg.green,\n  warn: colors.fg.yellow,\n  error: colors.fg.red,\n  debug: colors.fg.magenta\n};\nconst formatMessage = (level, message) => {\n  const timestamp = (/* @__PURE__ */ new Date()).toISOString();\n  return `${colors.dim}${timestamp}${colors.reset} ${levelColors[level]}${level.toUpperCase()}${colors.reset} ${colors.bright}[Better Auth]:${colors.reset} ${message}`;\n};\nconst createLogger = (options) => {\n  const enabled = options?.disabled !== true;\n  const logLevel = options?.level ?? \"error\";\n  const LogFunc = (level, message, args = []) => {\n    if (!enabled || !shouldPublishLog(logLevel, level)) {\n      return;\n    }\n    const formattedMessage = formatMessage(level, message);\n    if (!options || typeof options.log !== \"function\") {\n      if (level === \"error\") {\n        console.error(formattedMessage, ...args);\n      } else if (level === \"warn\") {\n        console.warn(formattedMessage, ...args);\n      } else {\n        console.log(formattedMessage, ...args);\n      }\n      return;\n    }\n    options.log(level === \"success\" ? \"info\" : level, message, ...args);\n  };\n  return Object.fromEntries(\n    levels.map((level) => [\n      level,\n      (...[message, ...args]) => LogFunc(level, message, args)\n    ])\n  );\n};\nconst logger = createLogger();\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLkRCR2ZJRG5oLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBd0U7O0FBRXhFO0FBQ0EsU0FBUyxzRkFBMkI7QUFDcEM7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksV0FBVyxFQUFFLFVBQVUsRUFBRSxjQUFjLEVBQUUsbUJBQW1CLEVBQUUsb0JBQW9CLEVBQUUsY0FBYyxFQUFFLGNBQWMsZ0JBQWdCLGNBQWMsRUFBRSxRQUFRO0FBQ3RLO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUUrRiIsInNvdXJjZXMiOlsiL1VzZXJzL21pbGFuL0Rlc2t0b3AvQXBwcy9iZXR0ZXItYXV0aC9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguREJHZklEbmgubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZVJhbmRvbVN0cmluZ0dlbmVyYXRvciB9IGZyb20gJ0BiZXR0ZXItYXV0aC91dGlscy9yYW5kb20nO1xuXG5jb25zdCBnZW5lcmF0ZUlkID0gKHNpemUpID0+IHtcbiAgcmV0dXJuIGNyZWF0ZVJhbmRvbVN0cmluZ0dlbmVyYXRvcihcImEtelwiLCBcIkEtWlwiLCBcIjAtOVwiKShzaXplIHx8IDMyKTtcbn07XG5cbmNvbnN0IGxldmVscyA9IFtcImluZm9cIiwgXCJzdWNjZXNzXCIsIFwid2FyblwiLCBcImVycm9yXCIsIFwiZGVidWdcIl07XG5mdW5jdGlvbiBzaG91bGRQdWJsaXNoTG9nKGN1cnJlbnRMb2dMZXZlbCwgbG9nTGV2ZWwpIHtcbiAgcmV0dXJuIGxldmVscy5pbmRleE9mKGxvZ0xldmVsKSA8PSBsZXZlbHMuaW5kZXhPZihjdXJyZW50TG9nTGV2ZWwpO1xufVxuY29uc3QgY29sb3JzID0ge1xuICByZXNldDogXCJcXHgxQlswbVwiLFxuICBicmlnaHQ6IFwiXFx4MUJbMW1cIixcbiAgZGltOiBcIlxceDFCWzJtXCIsXG4gIGZnOiB7XG4gICAgcmVkOiBcIlxceDFCWzMxbVwiLFxuICAgIGdyZWVuOiBcIlxceDFCWzMybVwiLFxuICAgIHllbGxvdzogXCJcXHgxQlszM21cIixcbiAgICBibHVlOiBcIlxceDFCWzM0bVwiLFxuICAgIG1hZ2VudGE6IFwiXFx4MUJbMzVtXCJ9fTtcbmNvbnN0IGxldmVsQ29sb3JzID0ge1xuICBpbmZvOiBjb2xvcnMuZmcuYmx1ZSxcbiAgc3VjY2VzczogY29sb3JzLmZnLmdyZWVuLFxuICB3YXJuOiBjb2xvcnMuZmcueWVsbG93LFxuICBlcnJvcjogY29sb3JzLmZnLnJlZCxcbiAgZGVidWc6IGNvbG9ycy5mZy5tYWdlbnRhXG59O1xuY29uc3QgZm9ybWF0TWVzc2FnZSA9IChsZXZlbCwgbWVzc2FnZSkgPT4ge1xuICBjb25zdCB0aW1lc3RhbXAgPSAoLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCkpLnRvSVNPU3RyaW5nKCk7XG4gIHJldHVybiBgJHtjb2xvcnMuZGltfSR7dGltZXN0YW1wfSR7Y29sb3JzLnJlc2V0fSAke2xldmVsQ29sb3JzW2xldmVsXX0ke2xldmVsLnRvVXBwZXJDYXNlKCl9JHtjb2xvcnMucmVzZXR9ICR7Y29sb3JzLmJyaWdodH1bQmV0dGVyIEF1dGhdOiR7Y29sb3JzLnJlc2V0fSAke21lc3NhZ2V9YDtcbn07XG5jb25zdCBjcmVhdGVMb2dnZXIgPSAob3B0aW9ucykgPT4ge1xuICBjb25zdCBlbmFibGVkID0gb3B0aW9ucz8uZGlzYWJsZWQgIT09IHRydWU7XG4gIGNvbnN0IGxvZ0xldmVsID0gb3B0aW9ucz8ubGV2ZWwgPz8gXCJlcnJvclwiO1xuICBjb25zdCBMb2dGdW5jID0gKGxldmVsLCBtZXNzYWdlLCBhcmdzID0gW10pID0+IHtcbiAgICBpZiAoIWVuYWJsZWQgfHwgIXNob3VsZFB1Ymxpc2hMb2cobG9nTGV2ZWwsIGxldmVsKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBmb3JtYXR0ZWRNZXNzYWdlID0gZm9ybWF0TWVzc2FnZShsZXZlbCwgbWVzc2FnZSk7XG4gICAgaWYgKCFvcHRpb25zIHx8IHR5cGVvZiBvcHRpb25zLmxvZyAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICBpZiAobGV2ZWwgPT09IFwiZXJyb3JcIikge1xuICAgICAgICBjb25zb2xlLmVycm9yKGZvcm1hdHRlZE1lc3NhZ2UsIC4uLmFyZ3MpO1xuICAgICAgfSBlbHNlIGlmIChsZXZlbCA9PT0gXCJ3YXJuXCIpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGZvcm1hdHRlZE1lc3NhZ2UsIC4uLmFyZ3MpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coZm9ybWF0dGVkTWVzc2FnZSwgLi4uYXJncyk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIG9wdGlvbnMubG9nKGxldmVsID09PSBcInN1Y2Nlc3NcIiA/IFwiaW5mb1wiIDogbGV2ZWwsIG1lc3NhZ2UsIC4uLmFyZ3MpO1xuICB9O1xuICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgIGxldmVscy5tYXAoKGxldmVsKSA9PiBbXG4gICAgICBsZXZlbCxcbiAgICAgICguLi5bbWVzc2FnZSwgLi4uYXJnc10pID0+IExvZ0Z1bmMobGV2ZWwsIG1lc3NhZ2UsIGFyZ3MpXG4gICAgXSlcbiAgKTtcbn07XG5jb25zdCBsb2dnZXIgPSBjcmVhdGVMb2dnZXIoKTtcblxuZXhwb3J0IHsgbG9nZ2VyIGFzIGEsIGNyZWF0ZUxvZ2dlciBhcyBjLCBnZW5lcmF0ZUlkIGFzIGcsIGxldmVscyBhcyBsLCBzaG91bGRQdWJsaXNoTG9nIGFzIHMgfTtcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DBGfIDnh.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DGpadpzN.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.DGpadpzN.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   m: () => (/* binding */ memoryAdapter)\n/* harmony export */ });\n/* harmony import */ var _better_auth_utils_random__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @better-auth/utils/random */ \"(rsc)/../../node_modules/@better-auth/utils/dist/random.mjs\");\n/* harmony import */ var better_call__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! better-call */ \"(rsc)/../../node_modules/better-call/dist/index.js\");\n/* harmony import */ var _better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @better-auth/utils/hash */ \"(rsc)/../../node_modules/@better-auth/utils/dist/hash.mjs\");\n/* harmony import */ var _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @better-auth/utils/base64 */ \"(rsc)/../../node_modules/@better-auth/utils/dist/base64.mjs\");\n/* harmony import */ var _better_auth_utils__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @better-auth/utils */ \"(rsc)/../../node_modules/@better-auth/utils/dist/index.mjs\");\n/* harmony import */ var _better_auth_utils_hex__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @better-auth/utils/hex */ \"(rsc)/../../node_modules/@better-auth/utils/dist/hex.mjs\");\n/* harmony import */ var _better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./better-auth.B4Qoxdgc.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs\");\n/* harmony import */ var _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./better-auth.DBGfIDnh.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DBGfIDnh.mjs\");\n/* harmony import */ var _better_auth_gBl3F_xa_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./better-auth.gBl3F_xa.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.gBl3F_xa.mjs\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst memoryAdapter = (db, config) => (0,_better_auth_gBl3F_xa_mjs__WEBPACK_IMPORTED_MODULE_8__.c)({\n  config: {\n    adapterId: \"memory\",\n    adapterName: \"Memory Adapter\",\n    usePlural: false,\n    debugLogs: config?.debugLogs || false,\n    customTransformInput(props) {\n      if (props.options.advanced?.database?.useNumberId && props.field === \"id\" && props.action === \"create\") {\n        return db[props.model].length + 1;\n      }\n      return props.data;\n    }\n  },\n  adapter: ({ getFieldName, options, debugLog }) => {\n    function convertWhereClause(where, model) {\n      const table = db[model];\n      if (!table) {\n        _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_7__.a.error(\n          `[MemoryAdapter] Model ${model} not found in the DB`,\n          Object.keys(db)\n        );\n        throw new Error(`Model ${model} not found`);\n      }\n      return table.filter((record) => {\n        return where.every((clause) => {\n          let { field, value, operator } = clause;\n          if (operator === \"in\") {\n            if (!Array.isArray(value)) {\n              throw new Error(\"Value must be an array\");\n            }\n            return value.includes(record[field]);\n          } else if (operator === \"contains\") {\n            return record[field].includes(value);\n          } else if (operator === \"starts_with\") {\n            return record[field].startsWith(value);\n          } else if (operator === \"ends_with\") {\n            return record[field].endsWith(value);\n          } else {\n            return record[field] === value;\n          }\n        });\n      });\n    }\n    return {\n      create: async ({ model, data }) => {\n        if (options.advanced?.database?.useNumberId) {\n          data.id = db[model].length + 1;\n        }\n        if (!db[model]) {\n          db[model] = [];\n        }\n        db[model].push(data);\n        return data;\n      },\n      findOne: async ({ model, where }) => {\n        const res = convertWhereClause(where, model);\n        const record = res[0] || null;\n        return record;\n      },\n      findMany: async ({ model, where, sortBy, limit, offset }) => {\n        let table = db[model];\n        if (where) {\n          table = convertWhereClause(where, model);\n        }\n        if (sortBy) {\n          table = table.sort((a, b) => {\n            const field = getFieldName({ model, field: sortBy.field });\n            if (sortBy.direction === \"asc\") {\n              return a[field] > b[field] ? 1 : -1;\n            } else {\n              return a[field] < b[field] ? 1 : -1;\n            }\n          });\n        }\n        if (offset !== void 0) {\n          table = table.slice(offset);\n        }\n        if (limit !== void 0) {\n          table = table.slice(0, limit);\n        }\n        return table;\n      },\n      count: async ({ model }) => {\n        return db[model].length;\n      },\n      update: async ({ model, where, update }) => {\n        const res = convertWhereClause(where, model);\n        res.forEach((record) => {\n          Object.assign(record, update);\n        });\n        return res[0] || null;\n      },\n      delete: async ({ model, where }) => {\n        const table = db[model];\n        const res = convertWhereClause(where, model);\n        db[model] = table.filter((record) => !res.includes(record));\n      },\n      deleteMany: async ({ model, where }) => {\n        const table = db[model];\n        const res = convertWhereClause(where, model);\n        let count = 0;\n        db[model] = table.filter((record) => {\n          if (res.includes(record)) {\n            count++;\n            return false;\n          }\n          return !res.includes(record);\n        });\n        return count;\n      },\n      updateMany({ model, where, update }) {\n        const res = convertWhereClause(where, model);\n        res.forEach((record) => {\n          Object.assign(record, update);\n        });\n        return res[0] || null;\n      }\n    };\n  }\n});\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLkRHcGFkcHpOLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQW1DO0FBQ25CO0FBQ0s7QUFDWTtBQUNGO0FBQ0Q7QUFDSTtBQUNDO0FBQ3JCO0FBQ2dCO0FBQ0Y7QUFDSTtBQUNIO0FBQ087QUFDcUI7QUFDTzs7QUFFaEUsc0NBQXNDLDREQUFhO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsY0FBYyxpQ0FBaUM7QUFDL0M7QUFDQTtBQUNBO0FBQ0EsUUFBUSx3REFBTTtBQUNkLG1DQUFtQyxPQUFPO0FBQzFDO0FBQ0E7QUFDQSxpQ0FBaUMsT0FBTztBQUN4QztBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IseUJBQXlCO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQSxZQUFZO0FBQ1o7QUFDQSxZQUFZO0FBQ1o7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBLFNBQVM7QUFDVCxPQUFPO0FBQ1A7QUFDQTtBQUNBLHVCQUF1QixhQUFhO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1Asd0JBQXdCLGNBQWM7QUFDdEM7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLHlCQUF5QixxQ0FBcUM7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLDRCQUE0QjtBQUNyRTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxzQkFBc0IsT0FBTztBQUM3QjtBQUNBLE9BQU87QUFDUCx1QkFBdUIsc0JBQXNCO0FBQzdDO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLE9BQU87QUFDUCx1QkFBdUIsY0FBYztBQUNyQztBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsMkJBQTJCLGNBQWM7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsT0FBTztBQUNQLG1CQUFtQixzQkFBc0I7QUFDekM7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFNkIiLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWxhbi9EZXNrdG9wL0FwcHMvYmV0dGVyLWF1dGgvbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLkRHcGFkcHpOLm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ0BiZXR0ZXItYXV0aC91dGlscy9yYW5kb20nO1xuaW1wb3J0ICd6b2QvdjQnO1xuaW1wb3J0ICdiZXR0ZXItY2FsbCc7XG5pbXBvcnQgJ0BiZXR0ZXItYXV0aC91dGlscy9oYXNoJztcbmltcG9ydCAnQG5vYmxlL2NpcGhlcnMvY2hhY2hhJztcbmltcG9ydCAnQG5vYmxlL2NpcGhlcnMvdXRpbHMnO1xuaW1wb3J0ICdAbm9ibGUvY2lwaGVycy93ZWJjcnlwdG8nO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMvYmFzZTY0JztcbmltcG9ydCAnam9zZSc7XG5pbXBvcnQgJ0Bub2JsZS9oYXNoZXMvc2NyeXB0JztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzJztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzL2hleCc7XG5pbXBvcnQgJ0Bub2JsZS9oYXNoZXMvdXRpbHMnO1xuaW1wb3J0ICcuL2JldHRlci1hdXRoLkI0UW94ZGdjLm1qcyc7XG5pbXBvcnQgeyBhIGFzIGxvZ2dlciB9IGZyb20gJy4vYmV0dGVyLWF1dGguREJHZklEbmgubWpzJztcbmltcG9ydCB7IGMgYXMgY3JlYXRlQWRhcHRlciB9IGZyb20gJy4vYmV0dGVyLWF1dGguZ0JsM0ZfeGEubWpzJztcblxuY29uc3QgbWVtb3J5QWRhcHRlciA9IChkYiwgY29uZmlnKSA9PiBjcmVhdGVBZGFwdGVyKHtcbiAgY29uZmlnOiB7XG4gICAgYWRhcHRlcklkOiBcIm1lbW9yeVwiLFxuICAgIGFkYXB0ZXJOYW1lOiBcIk1lbW9yeSBBZGFwdGVyXCIsXG4gICAgdXNlUGx1cmFsOiBmYWxzZSxcbiAgICBkZWJ1Z0xvZ3M6IGNvbmZpZz8uZGVidWdMb2dzIHx8IGZhbHNlLFxuICAgIGN1c3RvbVRyYW5zZm9ybUlucHV0KHByb3BzKSB7XG4gICAgICBpZiAocHJvcHMub3B0aW9ucy5hZHZhbmNlZD8uZGF0YWJhc2U/LnVzZU51bWJlcklkICYmIHByb3BzLmZpZWxkID09PSBcImlkXCIgJiYgcHJvcHMuYWN0aW9uID09PSBcImNyZWF0ZVwiKSB7XG4gICAgICAgIHJldHVybiBkYltwcm9wcy5tb2RlbF0ubGVuZ3RoICsgMTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwcm9wcy5kYXRhO1xuICAgIH1cbiAgfSxcbiAgYWRhcHRlcjogKHsgZ2V0RmllbGROYW1lLCBvcHRpb25zLCBkZWJ1Z0xvZyB9KSA9PiB7XG4gICAgZnVuY3Rpb24gY29udmVydFdoZXJlQ2xhdXNlKHdoZXJlLCBtb2RlbCkge1xuICAgICAgY29uc3QgdGFibGUgPSBkYlttb2RlbF07XG4gICAgICBpZiAoIXRhYmxlKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcihcbiAgICAgICAgICBgW01lbW9yeUFkYXB0ZXJdIE1vZGVsICR7bW9kZWx9IG5vdCBmb3VuZCBpbiB0aGUgREJgLFxuICAgICAgICAgIE9iamVjdC5rZXlzKGRiKVxuICAgICAgICApO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE1vZGVsICR7bW9kZWx9IG5vdCBmb3VuZGApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRhYmxlLmZpbHRlcigocmVjb3JkKSA9PiB7XG4gICAgICAgIHJldHVybiB3aGVyZS5ldmVyeSgoY2xhdXNlKSA9PiB7XG4gICAgICAgICAgbGV0IHsgZmllbGQsIHZhbHVlLCBvcGVyYXRvciB9ID0gY2xhdXNlO1xuICAgICAgICAgIGlmIChvcGVyYXRvciA9PT0gXCJpblwiKSB7XG4gICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlZhbHVlIG11c3QgYmUgYW4gYXJyYXlcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdmFsdWUuaW5jbHVkZXMocmVjb3JkW2ZpZWxkXSk7XG4gICAgICAgICAgfSBlbHNlIGlmIChvcGVyYXRvciA9PT0gXCJjb250YWluc1wiKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVjb3JkW2ZpZWxkXS5pbmNsdWRlcyh2YWx1ZSk7XG4gICAgICAgICAgfSBlbHNlIGlmIChvcGVyYXRvciA9PT0gXCJzdGFydHNfd2l0aFwiKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVjb3JkW2ZpZWxkXS5zdGFydHNXaXRoKHZhbHVlKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKG9wZXJhdG9yID09PSBcImVuZHNfd2l0aFwiKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVjb3JkW2ZpZWxkXS5lbmRzV2l0aCh2YWx1ZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiByZWNvcmRbZmllbGRdID09PSB2YWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICBjcmVhdGU6IGFzeW5jICh7IG1vZGVsLCBkYXRhIH0pID0+IHtcbiAgICAgICAgaWYgKG9wdGlvbnMuYWR2YW5jZWQ/LmRhdGFiYXNlPy51c2VOdW1iZXJJZCkge1xuICAgICAgICAgIGRhdGEuaWQgPSBkYlttb2RlbF0ubGVuZ3RoICsgMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWRiW21vZGVsXSkge1xuICAgICAgICAgIGRiW21vZGVsXSA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIGRiW21vZGVsXS5wdXNoKGRhdGEpO1xuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgIH0sXG4gICAgICBmaW5kT25lOiBhc3luYyAoeyBtb2RlbCwgd2hlcmUgfSkgPT4ge1xuICAgICAgICBjb25zdCByZXMgPSBjb252ZXJ0V2hlcmVDbGF1c2Uod2hlcmUsIG1vZGVsKTtcbiAgICAgICAgY29uc3QgcmVjb3JkID0gcmVzWzBdIHx8IG51bGw7XG4gICAgICAgIHJldHVybiByZWNvcmQ7XG4gICAgICB9LFxuICAgICAgZmluZE1hbnk6IGFzeW5jICh7IG1vZGVsLCB3aGVyZSwgc29ydEJ5LCBsaW1pdCwgb2Zmc2V0IH0pID0+IHtcbiAgICAgICAgbGV0IHRhYmxlID0gZGJbbW9kZWxdO1xuICAgICAgICBpZiAod2hlcmUpIHtcbiAgICAgICAgICB0YWJsZSA9IGNvbnZlcnRXaGVyZUNsYXVzZSh3aGVyZSwgbW9kZWwpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzb3J0QnkpIHtcbiAgICAgICAgICB0YWJsZSA9IHRhYmxlLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkID0gZ2V0RmllbGROYW1lKHsgbW9kZWwsIGZpZWxkOiBzb3J0QnkuZmllbGQgfSk7XG4gICAgICAgICAgICBpZiAoc29ydEJ5LmRpcmVjdGlvbiA9PT0gXCJhc2NcIikge1xuICAgICAgICAgICAgICByZXR1cm4gYVtmaWVsZF0gPiBiW2ZpZWxkXSA/IDEgOiAtMTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJldHVybiBhW2ZpZWxkXSA8IGJbZmllbGRdID8gMSA6IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvZmZzZXQgIT09IHZvaWQgMCkge1xuICAgICAgICAgIHRhYmxlID0gdGFibGUuc2xpY2Uob2Zmc2V0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobGltaXQgIT09IHZvaWQgMCkge1xuICAgICAgICAgIHRhYmxlID0gdGFibGUuc2xpY2UoMCwgbGltaXQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0YWJsZTtcbiAgICAgIH0sXG4gICAgICBjb3VudDogYXN5bmMgKHsgbW9kZWwgfSkgPT4ge1xuICAgICAgICByZXR1cm4gZGJbbW9kZWxdLmxlbmd0aDtcbiAgICAgIH0sXG4gICAgICB1cGRhdGU6IGFzeW5jICh7IG1vZGVsLCB3aGVyZSwgdXBkYXRlIH0pID0+IHtcbiAgICAgICAgY29uc3QgcmVzID0gY29udmVydFdoZXJlQ2xhdXNlKHdoZXJlLCBtb2RlbCk7XG4gICAgICAgIHJlcy5mb3JFYWNoKChyZWNvcmQpID0+IHtcbiAgICAgICAgICBPYmplY3QuYXNzaWduKHJlY29yZCwgdXBkYXRlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXNbMF0gfHwgbnVsbDtcbiAgICAgIH0sXG4gICAgICBkZWxldGU6IGFzeW5jICh7IG1vZGVsLCB3aGVyZSB9KSA9PiB7XG4gICAgICAgIGNvbnN0IHRhYmxlID0gZGJbbW9kZWxdO1xuICAgICAgICBjb25zdCByZXMgPSBjb252ZXJ0V2hlcmVDbGF1c2Uod2hlcmUsIG1vZGVsKTtcbiAgICAgICAgZGJbbW9kZWxdID0gdGFibGUuZmlsdGVyKChyZWNvcmQpID0+ICFyZXMuaW5jbHVkZXMocmVjb3JkKSk7XG4gICAgICB9LFxuICAgICAgZGVsZXRlTWFueTogYXN5bmMgKHsgbW9kZWwsIHdoZXJlIH0pID0+IHtcbiAgICAgICAgY29uc3QgdGFibGUgPSBkYlttb2RlbF07XG4gICAgICAgIGNvbnN0IHJlcyA9IGNvbnZlcnRXaGVyZUNsYXVzZSh3aGVyZSwgbW9kZWwpO1xuICAgICAgICBsZXQgY291bnQgPSAwO1xuICAgICAgICBkYlttb2RlbF0gPSB0YWJsZS5maWx0ZXIoKHJlY29yZCkgPT4ge1xuICAgICAgICAgIGlmIChyZXMuaW5jbHVkZXMocmVjb3JkKSkge1xuICAgICAgICAgICAgY291bnQrKztcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuICFyZXMuaW5jbHVkZXMocmVjb3JkKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBjb3VudDtcbiAgICAgIH0sXG4gICAgICB1cGRhdGVNYW55KHsgbW9kZWwsIHdoZXJlLCB1cGRhdGUgfSkge1xuICAgICAgICBjb25zdCByZXMgPSBjb252ZXJ0V2hlcmVDbGF1c2Uod2hlcmUsIG1vZGVsKTtcbiAgICAgICAgcmVzLmZvckVhY2goKHJlY29yZCkgPT4ge1xuICAgICAgICAgIE9iamVjdC5hc3NpZ24ocmVjb3JkLCB1cGRhdGUpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlc1swXSB8fCBudWxsO1xuICAgICAgfVxuICAgIH07XG4gIH1cbn0pO1xuXG5leHBvcnQgeyBtZW1vcnlBZGFwdGVyIGFzIG0gfTtcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DGpadpzN.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DORkW_Ge.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.DORkW_Ge.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   g: () => (/* binding */ getAuthTables)\n/* harmony export */ });\nconst getAuthTables = (options) => {\n  const pluginSchema = options.plugins?.reduce(\n    (acc, plugin) => {\n      const schema = plugin.schema;\n      if (!schema) return acc;\n      for (const [key, value] of Object.entries(schema)) {\n        acc[key] = {\n          fields: {\n            ...acc[key]?.fields,\n            ...value.fields\n          },\n          modelName: value.modelName || key\n        };\n      }\n      return acc;\n    },\n    {}\n  );\n  const shouldAddRateLimitTable = options.rateLimit?.storage === \"database\";\n  const rateLimitTable = {\n    rateLimit: {\n      modelName: options.rateLimit?.modelName || \"rateLimit\",\n      fields: {\n        key: {\n          type: \"string\",\n          fieldName: options.rateLimit?.fields?.key || \"key\"\n        },\n        count: {\n          type: \"number\",\n          fieldName: options.rateLimit?.fields?.count || \"count\"\n        },\n        lastRequest: {\n          type: \"number\",\n          bigint: true,\n          fieldName: options.rateLimit?.fields?.lastRequest || \"lastRequest\"\n        }\n      }\n    }\n  };\n  const { user, session, account, ...pluginTables } = pluginSchema || {};\n  const sessionTable = {\n    session: {\n      modelName: options.session?.modelName || \"session\",\n      fields: {\n        expiresAt: {\n          type: \"date\",\n          required: true,\n          fieldName: options.session?.fields?.expiresAt || \"expiresAt\"\n        },\n        token: {\n          type: \"string\",\n          required: true,\n          fieldName: options.session?.fields?.token || \"token\",\n          unique: true\n        },\n        createdAt: {\n          type: \"date\",\n          required: true,\n          fieldName: options.session?.fields?.createdAt || \"createdAt\"\n        },\n        updatedAt: {\n          type: \"date\",\n          required: true,\n          fieldName: options.session?.fields?.updatedAt || \"updatedAt\"\n        },\n        ipAddress: {\n          type: \"string\",\n          required: false,\n          fieldName: options.session?.fields?.ipAddress || \"ipAddress\"\n        },\n        userAgent: {\n          type: \"string\",\n          required: false,\n          fieldName: options.session?.fields?.userAgent || \"userAgent\"\n        },\n        userId: {\n          type: \"string\",\n          fieldName: options.session?.fields?.userId || \"userId\",\n          references: {\n            model: options.user?.modelName || \"user\",\n            field: \"id\",\n            onDelete: \"cascade\"\n          },\n          required: true\n        },\n        ...session?.fields,\n        ...options.session?.additionalFields\n      },\n      order: 2\n    }\n  };\n  return {\n    user: {\n      modelName: options.user?.modelName || \"user\",\n      fields: {\n        name: {\n          type: \"string\",\n          required: true,\n          fieldName: options.user?.fields?.name || \"name\",\n          sortable: true\n        },\n        email: {\n          type: \"string\",\n          unique: true,\n          required: true,\n          fieldName: options.user?.fields?.email || \"email\",\n          sortable: true\n        },\n        emailVerified: {\n          type: \"boolean\",\n          defaultValue: () => false,\n          required: true,\n          fieldName: options.user?.fields?.emailVerified || \"emailVerified\"\n        },\n        image: {\n          type: \"string\",\n          required: false,\n          fieldName: options.user?.fields?.image || \"image\"\n        },\n        createdAt: {\n          type: \"date\",\n          defaultValue: () => /* @__PURE__ */ new Date(),\n          required: true,\n          fieldName: options.user?.fields?.createdAt || \"createdAt\"\n        },\n        updatedAt: {\n          type: \"date\",\n          defaultValue: () => /* @__PURE__ */ new Date(),\n          required: true,\n          fieldName: options.user?.fields?.updatedAt || \"updatedAt\"\n        },\n        ...user?.fields,\n        ...options.user?.additionalFields\n      },\n      order: 1\n    },\n    //only add session table if it's not stored in secondary storage\n    ...!options.secondaryStorage || options.session?.storeSessionInDatabase ? sessionTable : {},\n    account: {\n      modelName: options.account?.modelName || \"account\",\n      fields: {\n        accountId: {\n          type: \"string\",\n          required: true,\n          fieldName: options.account?.fields?.accountId || \"accountId\"\n        },\n        providerId: {\n          type: \"string\",\n          required: true,\n          fieldName: options.account?.fields?.providerId || \"providerId\"\n        },\n        userId: {\n          type: \"string\",\n          references: {\n            model: options.user?.modelName || \"user\",\n            field: \"id\",\n            onDelete: \"cascade\"\n          },\n          required: true,\n          fieldName: options.account?.fields?.userId || \"userId\"\n        },\n        accessToken: {\n          type: \"string\",\n          required: false,\n          fieldName: options.account?.fields?.accessToken || \"accessToken\"\n        },\n        refreshToken: {\n          type: \"string\",\n          required: false,\n          fieldName: options.account?.fields?.refreshToken || \"refreshToken\"\n        },\n        idToken: {\n          type: \"string\",\n          required: false,\n          fieldName: options.account?.fields?.idToken || \"idToken\"\n        },\n        accessTokenExpiresAt: {\n          type: \"date\",\n          required: false,\n          fieldName: options.account?.fields?.accessTokenExpiresAt || \"accessTokenExpiresAt\"\n        },\n        refreshTokenExpiresAt: {\n          type: \"date\",\n          required: false,\n          fieldName: options.account?.fields?.accessTokenExpiresAt || \"refreshTokenExpiresAt\"\n        },\n        scope: {\n          type: \"string\",\n          required: false,\n          fieldName: options.account?.fields?.scope || \"scope\"\n        },\n        password: {\n          type: \"string\",\n          required: false,\n          fieldName: options.account?.fields?.password || \"password\"\n        },\n        createdAt: {\n          type: \"date\",\n          required: true,\n          fieldName: options.account?.fields?.createdAt || \"createdAt\"\n        },\n        updatedAt: {\n          type: \"date\",\n          required: true,\n          fieldName: options.account?.fields?.updatedAt || \"updatedAt\"\n        },\n        ...account?.fields\n      },\n      order: 3\n    },\n    verification: {\n      modelName: options.verification?.modelName || \"verification\",\n      fields: {\n        identifier: {\n          type: \"string\",\n          required: true,\n          fieldName: options.verification?.fields?.identifier || \"identifier\"\n        },\n        value: {\n          type: \"string\",\n          required: true,\n          fieldName: options.verification?.fields?.value || \"value\"\n        },\n        expiresAt: {\n          type: \"date\",\n          required: true,\n          fieldName: options.verification?.fields?.expiresAt || \"expiresAt\"\n        },\n        createdAt: {\n          type: \"date\",\n          required: false,\n          defaultValue: () => /* @__PURE__ */ new Date(),\n          fieldName: options.verification?.fields?.createdAt || \"createdAt\"\n        },\n        updatedAt: {\n          type: \"date\",\n          required: false,\n          defaultValue: () => /* @__PURE__ */ new Date(),\n          fieldName: options.verification?.fields?.updatedAt || \"updatedAt\"\n        }\n      },\n      order: 4\n    },\n    ...pluginTables,\n    ...shouldAddRateLimitTable ? rateLimitTable : {}\n  };\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLkRPUmtXX0dlLm1qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLDBDQUEwQztBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxLQUFLO0FBQ0w7QUFDQSwrRkFBK0Y7QUFDL0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxPQUFPO0FBQ1A7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7O0FBRThCIiwic291cmNlcyI6WyIvVXNlcnMvbWlsYW4vRGVza3RvcC9BcHBzL2JldHRlci1hdXRoL25vZGVfbW9kdWxlcy9iZXR0ZXItYXV0aC9kaXN0L3NoYXJlZC9iZXR0ZXItYXV0aC5ET1JrV19HZS5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZ2V0QXV0aFRhYmxlcyA9IChvcHRpb25zKSA9PiB7XG4gIGNvbnN0IHBsdWdpblNjaGVtYSA9IG9wdGlvbnMucGx1Z2lucz8ucmVkdWNlKFxuICAgIChhY2MsIHBsdWdpbikgPT4ge1xuICAgICAgY29uc3Qgc2NoZW1hID0gcGx1Z2luLnNjaGVtYTtcbiAgICAgIGlmICghc2NoZW1hKSByZXR1cm4gYWNjO1xuICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoc2NoZW1hKSkge1xuICAgICAgICBhY2Nba2V5XSA9IHtcbiAgICAgICAgICBmaWVsZHM6IHtcbiAgICAgICAgICAgIC4uLmFjY1trZXldPy5maWVsZHMsXG4gICAgICAgICAgICAuLi52YWx1ZS5maWVsZHNcbiAgICAgICAgICB9LFxuICAgICAgICAgIG1vZGVsTmFtZTogdmFsdWUubW9kZWxOYW1lIHx8IGtleVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIGFjYztcbiAgICB9LFxuICAgIHt9XG4gICk7XG4gIGNvbnN0IHNob3VsZEFkZFJhdGVMaW1pdFRhYmxlID0gb3B0aW9ucy5yYXRlTGltaXQ/LnN0b3JhZ2UgPT09IFwiZGF0YWJhc2VcIjtcbiAgY29uc3QgcmF0ZUxpbWl0VGFibGUgPSB7XG4gICAgcmF0ZUxpbWl0OiB7XG4gICAgICBtb2RlbE5hbWU6IG9wdGlvbnMucmF0ZUxpbWl0Py5tb2RlbE5hbWUgfHwgXCJyYXRlTGltaXRcIixcbiAgICAgIGZpZWxkczoge1xuICAgICAgICBrZXk6IHtcbiAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgIGZpZWxkTmFtZTogb3B0aW9ucy5yYXRlTGltaXQ/LmZpZWxkcz8ua2V5IHx8IFwia2V5XCJcbiAgICAgICAgfSxcbiAgICAgICAgY291bnQ6IHtcbiAgICAgICAgICB0eXBlOiBcIm51bWJlclwiLFxuICAgICAgICAgIGZpZWxkTmFtZTogb3B0aW9ucy5yYXRlTGltaXQ/LmZpZWxkcz8uY291bnQgfHwgXCJjb3VudFwiXG4gICAgICAgIH0sXG4gICAgICAgIGxhc3RSZXF1ZXN0OiB7XG4gICAgICAgICAgdHlwZTogXCJudW1iZXJcIixcbiAgICAgICAgICBiaWdpbnQ6IHRydWUsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLnJhdGVMaW1pdD8uZmllbGRzPy5sYXN0UmVxdWVzdCB8fCBcImxhc3RSZXF1ZXN0XCJcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgY29uc3QgeyB1c2VyLCBzZXNzaW9uLCBhY2NvdW50LCAuLi5wbHVnaW5UYWJsZXMgfSA9IHBsdWdpblNjaGVtYSB8fCB7fTtcbiAgY29uc3Qgc2Vzc2lvblRhYmxlID0ge1xuICAgIHNlc3Npb246IHtcbiAgICAgIG1vZGVsTmFtZTogb3B0aW9ucy5zZXNzaW9uPy5tb2RlbE5hbWUgfHwgXCJzZXNzaW9uXCIsXG4gICAgICBmaWVsZHM6IHtcbiAgICAgICAgZXhwaXJlc0F0OiB7XG4gICAgICAgICAgdHlwZTogXCJkYXRlXCIsXG4gICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLnNlc3Npb24/LmZpZWxkcz8uZXhwaXJlc0F0IHx8IFwiZXhwaXJlc0F0XCJcbiAgICAgICAgfSxcbiAgICAgICAgdG9rZW46IHtcbiAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgIGZpZWxkTmFtZTogb3B0aW9ucy5zZXNzaW9uPy5maWVsZHM/LnRva2VuIHx8IFwidG9rZW5cIixcbiAgICAgICAgICB1bmlxdWU6IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAgY3JlYXRlZEF0OiB7XG4gICAgICAgICAgdHlwZTogXCJkYXRlXCIsXG4gICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLnNlc3Npb24/LmZpZWxkcz8uY3JlYXRlZEF0IHx8IFwiY3JlYXRlZEF0XCJcbiAgICAgICAgfSxcbiAgICAgICAgdXBkYXRlZEF0OiB7XG4gICAgICAgICAgdHlwZTogXCJkYXRlXCIsXG4gICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLnNlc3Npb24/LmZpZWxkcz8udXBkYXRlZEF0IHx8IFwidXBkYXRlZEF0XCJcbiAgICAgICAgfSxcbiAgICAgICAgaXBBZGRyZXNzOiB7XG4gICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLnNlc3Npb24/LmZpZWxkcz8uaXBBZGRyZXNzIHx8IFwiaXBBZGRyZXNzXCJcbiAgICAgICAgfSxcbiAgICAgICAgdXNlckFnZW50OiB7XG4gICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLnNlc3Npb24/LmZpZWxkcz8udXNlckFnZW50IHx8IFwidXNlckFnZW50XCJcbiAgICAgICAgfSxcbiAgICAgICAgdXNlcklkOiB7XG4gICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMuc2Vzc2lvbj8uZmllbGRzPy51c2VySWQgfHwgXCJ1c2VySWRcIixcbiAgICAgICAgICByZWZlcmVuY2VzOiB7XG4gICAgICAgICAgICBtb2RlbDogb3B0aW9ucy51c2VyPy5tb2RlbE5hbWUgfHwgXCJ1c2VyXCIsXG4gICAgICAgICAgICBmaWVsZDogXCJpZFwiLFxuICAgICAgICAgICAgb25EZWxldGU6IFwiY2FzY2FkZVwiXG4gICAgICAgICAgfSxcbiAgICAgICAgICByZXF1aXJlZDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICAuLi5zZXNzaW9uPy5maWVsZHMsXG4gICAgICAgIC4uLm9wdGlvbnMuc2Vzc2lvbj8uYWRkaXRpb25hbEZpZWxkc1xuICAgICAgfSxcbiAgICAgIG9yZGVyOiAyXG4gICAgfVxuICB9O1xuICByZXR1cm4ge1xuICAgIHVzZXI6IHtcbiAgICAgIG1vZGVsTmFtZTogb3B0aW9ucy51c2VyPy5tb2RlbE5hbWUgfHwgXCJ1c2VyXCIsXG4gICAgICBmaWVsZHM6IHtcbiAgICAgICAgbmFtZToge1xuICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLnVzZXI/LmZpZWxkcz8ubmFtZSB8fCBcIm5hbWVcIixcbiAgICAgICAgICBzb3J0YWJsZTogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBlbWFpbDoge1xuICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgdW5pcXVlOiB0cnVlLFxuICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgIGZpZWxkTmFtZTogb3B0aW9ucy51c2VyPy5maWVsZHM/LmVtYWlsIHx8IFwiZW1haWxcIixcbiAgICAgICAgICBzb3J0YWJsZTogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBlbWFpbFZlcmlmaWVkOiB7XG4gICAgICAgICAgdHlwZTogXCJib29sZWFuXCIsXG4gICAgICAgICAgZGVmYXVsdFZhbHVlOiAoKSA9PiBmYWxzZSxcbiAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMudXNlcj8uZmllbGRzPy5lbWFpbFZlcmlmaWVkIHx8IFwiZW1haWxWZXJpZmllZFwiXG4gICAgICAgIH0sXG4gICAgICAgIGltYWdlOiB7XG4gICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLnVzZXI/LmZpZWxkcz8uaW1hZ2UgfHwgXCJpbWFnZVwiXG4gICAgICAgIH0sXG4gICAgICAgIGNyZWF0ZWRBdDoge1xuICAgICAgICAgIHR5cGU6IFwiZGF0ZVwiLFxuICAgICAgICAgIGRlZmF1bHRWYWx1ZTogKCkgPT4gLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCksXG4gICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLnVzZXI/LmZpZWxkcz8uY3JlYXRlZEF0IHx8IFwiY3JlYXRlZEF0XCJcbiAgICAgICAgfSxcbiAgICAgICAgdXBkYXRlZEF0OiB7XG4gICAgICAgICAgdHlwZTogXCJkYXRlXCIsXG4gICAgICAgICAgZGVmYXVsdFZhbHVlOiAoKSA9PiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSxcbiAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMudXNlcj8uZmllbGRzPy51cGRhdGVkQXQgfHwgXCJ1cGRhdGVkQXRcIlxuICAgICAgICB9LFxuICAgICAgICAuLi51c2VyPy5maWVsZHMsXG4gICAgICAgIC4uLm9wdGlvbnMudXNlcj8uYWRkaXRpb25hbEZpZWxkc1xuICAgICAgfSxcbiAgICAgIG9yZGVyOiAxXG4gICAgfSxcbiAgICAvL29ubHkgYWRkIHNlc3Npb24gdGFibGUgaWYgaXQncyBub3Qgc3RvcmVkIGluIHNlY29uZGFyeSBzdG9yYWdlXG4gICAgLi4uIW9wdGlvbnMuc2Vjb25kYXJ5U3RvcmFnZSB8fCBvcHRpb25zLnNlc3Npb24/LnN0b3JlU2Vzc2lvbkluRGF0YWJhc2UgPyBzZXNzaW9uVGFibGUgOiB7fSxcbiAgICBhY2NvdW50OiB7XG4gICAgICBtb2RlbE5hbWU6IG9wdGlvbnMuYWNjb3VudD8ubW9kZWxOYW1lIHx8IFwiYWNjb3VudFwiLFxuICAgICAgZmllbGRzOiB7XG4gICAgICAgIGFjY291bnRJZDoge1xuICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLmFjY291bnQ/LmZpZWxkcz8uYWNjb3VudElkIHx8IFwiYWNjb3VudElkXCJcbiAgICAgICAgfSxcbiAgICAgICAgcHJvdmlkZXJJZDoge1xuICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLmFjY291bnQ/LmZpZWxkcz8ucHJvdmlkZXJJZCB8fCBcInByb3ZpZGVySWRcIlxuICAgICAgICB9LFxuICAgICAgICB1c2VySWQ6IHtcbiAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgIHJlZmVyZW5jZXM6IHtcbiAgICAgICAgICAgIG1vZGVsOiBvcHRpb25zLnVzZXI/Lm1vZGVsTmFtZSB8fCBcInVzZXJcIixcbiAgICAgICAgICAgIGZpZWxkOiBcImlkXCIsXG4gICAgICAgICAgICBvbkRlbGV0ZTogXCJjYXNjYWRlXCJcbiAgICAgICAgICB9LFxuICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgIGZpZWxkTmFtZTogb3B0aW9ucy5hY2NvdW50Py5maWVsZHM/LnVzZXJJZCB8fCBcInVzZXJJZFwiXG4gICAgICAgIH0sXG4gICAgICAgIGFjY2Vzc1Rva2VuOiB7XG4gICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLmFjY291bnQ/LmZpZWxkcz8uYWNjZXNzVG9rZW4gfHwgXCJhY2Nlc3NUb2tlblwiXG4gICAgICAgIH0sXG4gICAgICAgIHJlZnJlc2hUb2tlbjoge1xuICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgICAgIGZpZWxkTmFtZTogb3B0aW9ucy5hY2NvdW50Py5maWVsZHM/LnJlZnJlc2hUb2tlbiB8fCBcInJlZnJlc2hUb2tlblwiXG4gICAgICAgIH0sXG4gICAgICAgIGlkVG9rZW46IHtcbiAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMuYWNjb3VudD8uZmllbGRzPy5pZFRva2VuIHx8IFwiaWRUb2tlblwiXG4gICAgICAgIH0sXG4gICAgICAgIGFjY2Vzc1Rva2VuRXhwaXJlc0F0OiB7XG4gICAgICAgICAgdHlwZTogXCJkYXRlXCIsXG4gICAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgICAgIGZpZWxkTmFtZTogb3B0aW9ucy5hY2NvdW50Py5maWVsZHM/LmFjY2Vzc1Rva2VuRXhwaXJlc0F0IHx8IFwiYWNjZXNzVG9rZW5FeHBpcmVzQXRcIlxuICAgICAgICB9LFxuICAgICAgICByZWZyZXNoVG9rZW5FeHBpcmVzQXQ6IHtcbiAgICAgICAgICB0eXBlOiBcImRhdGVcIixcbiAgICAgICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLmFjY291bnQ/LmZpZWxkcz8uYWNjZXNzVG9rZW5FeHBpcmVzQXQgfHwgXCJyZWZyZXNoVG9rZW5FeHBpcmVzQXRcIlxuICAgICAgICB9LFxuICAgICAgICBzY29wZToge1xuICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgICAgIGZpZWxkTmFtZTogb3B0aW9ucy5hY2NvdW50Py5maWVsZHM/LnNjb3BlIHx8IFwic2NvcGVcIlxuICAgICAgICB9LFxuICAgICAgICBwYXNzd29yZDoge1xuICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgICAgIGZpZWxkTmFtZTogb3B0aW9ucy5hY2NvdW50Py5maWVsZHM/LnBhc3N3b3JkIHx8IFwicGFzc3dvcmRcIlxuICAgICAgICB9LFxuICAgICAgICBjcmVhdGVkQXQ6IHtcbiAgICAgICAgICB0eXBlOiBcImRhdGVcIixcbiAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMuYWNjb3VudD8uZmllbGRzPy5jcmVhdGVkQXQgfHwgXCJjcmVhdGVkQXRcIlxuICAgICAgICB9LFxuICAgICAgICB1cGRhdGVkQXQ6IHtcbiAgICAgICAgICB0eXBlOiBcImRhdGVcIixcbiAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMuYWNjb3VudD8uZmllbGRzPy51cGRhdGVkQXQgfHwgXCJ1cGRhdGVkQXRcIlxuICAgICAgICB9LFxuICAgICAgICAuLi5hY2NvdW50Py5maWVsZHNcbiAgICAgIH0sXG4gICAgICBvcmRlcjogM1xuICAgIH0sXG4gICAgdmVyaWZpY2F0aW9uOiB7XG4gICAgICBtb2RlbE5hbWU6IG9wdGlvbnMudmVyaWZpY2F0aW9uPy5tb2RlbE5hbWUgfHwgXCJ2ZXJpZmljYXRpb25cIixcbiAgICAgIGZpZWxkczoge1xuICAgICAgICBpZGVudGlmaWVyOiB7XG4gICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMudmVyaWZpY2F0aW9uPy5maWVsZHM/LmlkZW50aWZpZXIgfHwgXCJpZGVudGlmaWVyXCJcbiAgICAgICAgfSxcbiAgICAgICAgdmFsdWU6IHtcbiAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgIGZpZWxkTmFtZTogb3B0aW9ucy52ZXJpZmljYXRpb24/LmZpZWxkcz8udmFsdWUgfHwgXCJ2YWx1ZVwiXG4gICAgICAgIH0sXG4gICAgICAgIGV4cGlyZXNBdDoge1xuICAgICAgICAgIHR5cGU6IFwiZGF0ZVwiLFxuICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgIGZpZWxkTmFtZTogb3B0aW9ucy52ZXJpZmljYXRpb24/LmZpZWxkcz8uZXhwaXJlc0F0IHx8IFwiZXhwaXJlc0F0XCJcbiAgICAgICAgfSxcbiAgICAgICAgY3JlYXRlZEF0OiB7XG4gICAgICAgICAgdHlwZTogXCJkYXRlXCIsXG4gICAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgICAgIGRlZmF1bHRWYWx1ZTogKCkgPT4gLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCksXG4gICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLnZlcmlmaWNhdGlvbj8uZmllbGRzPy5jcmVhdGVkQXQgfHwgXCJjcmVhdGVkQXRcIlxuICAgICAgICB9LFxuICAgICAgICB1cGRhdGVkQXQ6IHtcbiAgICAgICAgICB0eXBlOiBcImRhdGVcIixcbiAgICAgICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICAgICAgZGVmYXVsdFZhbHVlOiAoKSA9PiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSxcbiAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMudmVyaWZpY2F0aW9uPy5maWVsZHM/LnVwZGF0ZWRBdCB8fCBcInVwZGF0ZWRBdFwiXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBvcmRlcjogNFxuICAgIH0sXG4gICAgLi4ucGx1Z2luVGFibGVzLFxuICAgIC4uLnNob3VsZEFkZFJhdGVMaW1pdFRhYmxlID8gcmF0ZUxpbWl0VGFibGUgOiB7fVxuICB9O1xufTtcblxuZXhwb3J0IHsgZ2V0QXV0aFRhYmxlcyBhcyBnIH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DORkW_Ge.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DcfNPS8q.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.DcfNPS8q.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   g: () => (/* binding */ getIp)\n/* harmony export */ });\n/* harmony import */ var _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./better-auth.8zoxzg-F.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs\");\n\n\nfunction getIp(req, options) {\n  if (options.advanced?.ipAddress?.disableIpTracking) {\n    return null;\n  }\n  if (_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__.i) {\n    return \"127.0.0.1\";\n  }\n  const headers = \"headers\" in req ? req.headers : req;\n  const defaultHeaders = [\"x-forwarded-for\"];\n  const ipHeaders = options.advanced?.ipAddress?.ipAddressHeaders || defaultHeaders;\n  for (const key of ipHeaders) {\n    const value = \"get\" in headers ? headers.get(key) : headers[key];\n    if (typeof value === \"string\") {\n      const ip = value.split(\",\")[0].trim();\n      if (isValidIP(ip)) {\n        return ip;\n      }\n    }\n  }\n  return null;\n}\nfunction isValidIP(ip) {\n  const ipv4Regex = /^(\\d{1,3}\\.){3}\\d{1,3}$/;\n  if (ipv4Regex.test(ip)) {\n    const parts = ip.split(\".\").map(Number);\n    return parts.every((part) => part >= 0 && part <= 255);\n  }\n  const ipv6Regex = /^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/;\n  return ipv6Regex.test(ip);\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLkRjZk5QUzhxLm1qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUF5RDs7QUFFekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLHdEQUFNO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixJQUFJLElBQUksRUFBRSxHQUFHLElBQUk7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsSUFBSSxHQUFHLEVBQUUsWUFBWSxJQUFJO0FBQzVEO0FBQ0E7O0FBRXNCIiwic291cmNlcyI6WyIvVXNlcnMvbWlsYW4vRGVza3RvcC9BcHBzL2JldHRlci1hdXRoL25vZGVfbW9kdWxlcy9iZXR0ZXItYXV0aC9kaXN0L3NoYXJlZC9iZXR0ZXItYXV0aC5EY2ZOUFM4cS5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaSBhcyBpc1Rlc3QgfSBmcm9tICcuL2JldHRlci1hdXRoLjh6b3h6Zy1GLm1qcyc7XG5cbmZ1bmN0aW9uIGdldElwKHJlcSwgb3B0aW9ucykge1xuICBpZiAob3B0aW9ucy5hZHZhbmNlZD8uaXBBZGRyZXNzPy5kaXNhYmxlSXBUcmFja2luZykge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIGlmIChpc1Rlc3QpIHtcbiAgICByZXR1cm4gXCIxMjcuMC4wLjFcIjtcbiAgfVxuICBjb25zdCBoZWFkZXJzID0gXCJoZWFkZXJzXCIgaW4gcmVxID8gcmVxLmhlYWRlcnMgOiByZXE7XG4gIGNvbnN0IGRlZmF1bHRIZWFkZXJzID0gW1wieC1mb3J3YXJkZWQtZm9yXCJdO1xuICBjb25zdCBpcEhlYWRlcnMgPSBvcHRpb25zLmFkdmFuY2VkPy5pcEFkZHJlc3M/LmlwQWRkcmVzc0hlYWRlcnMgfHwgZGVmYXVsdEhlYWRlcnM7XG4gIGZvciAoY29uc3Qga2V5IG9mIGlwSGVhZGVycykge1xuICAgIGNvbnN0IHZhbHVlID0gXCJnZXRcIiBpbiBoZWFkZXJzID8gaGVhZGVycy5nZXQoa2V5KSA6IGhlYWRlcnNba2V5XTtcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiKSB7XG4gICAgICBjb25zdCBpcCA9IHZhbHVlLnNwbGl0KFwiLFwiKVswXS50cmltKCk7XG4gICAgICBpZiAoaXNWYWxpZElQKGlwKSkge1xuICAgICAgICByZXR1cm4gaXA7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBudWxsO1xufVxuZnVuY3Rpb24gaXNWYWxpZElQKGlwKSB7XG4gIGNvbnN0IGlwdjRSZWdleCA9IC9eKFxcZHsxLDN9XFwuKXszfVxcZHsxLDN9JC87XG4gIGlmIChpcHY0UmVnZXgudGVzdChpcCkpIHtcbiAgICBjb25zdCBwYXJ0cyA9IGlwLnNwbGl0KFwiLlwiKS5tYXAoTnVtYmVyKTtcbiAgICByZXR1cm4gcGFydHMuZXZlcnkoKHBhcnQpID0+IHBhcnQgPj0gMCAmJiBwYXJ0IDw9IDI1NSk7XG4gIH1cbiAgY29uc3QgaXB2NlJlZ2V4ID0gL14oWzAtOWEtZkEtRl17MSw0fTopezd9WzAtOWEtZkEtRl17MSw0fSQvO1xuICByZXR1cm4gaXB2NlJlZ2V4LnRlc3QoaXApO1xufVxuXG5leHBvcnQgeyBnZXRJcCBhcyBnIH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DcfNPS8q.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   B: () => (/* binding */ BetterAuthError),\n/* harmony export */   M: () => (/* binding */ MissingDependencyError)\n/* harmony export */ });\nclass BetterAuthError extends Error {\n  constructor(message, cause) {\n    super(message);\n    this.name = \"BetterAuthError\";\n    this.message = message;\n    this.cause = cause;\n    this.stack = \"\";\n  }\n}\nclass MissingDependencyError extends BetterAuthError {\n  constructor(pkgName) {\n    super(\n      `The package \"${pkgName}\" is required. Make sure it is installed.`,\n      pkgName\n    );\n  }\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLkRkelNKZi1uLm1qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixRQUFRO0FBQzlCO0FBQ0E7QUFDQTtBQUNBOztBQUU2RCIsInNvdXJjZXMiOlsiL1VzZXJzL21pbGFuL0Rlc2t0b3AvQXBwcy9iZXR0ZXItYXV0aC9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguRGR6U0pmLW4ubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImNsYXNzIEJldHRlckF1dGhFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IobWVzc2FnZSwgY2F1c2UpIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB0aGlzLm5hbWUgPSBcIkJldHRlckF1dGhFcnJvclwiO1xuICAgIHRoaXMubWVzc2FnZSA9IG1lc3NhZ2U7XG4gICAgdGhpcy5jYXVzZSA9IGNhdXNlO1xuICAgIHRoaXMuc3RhY2sgPSBcIlwiO1xuICB9XG59XG5jbGFzcyBNaXNzaW5nRGVwZW5kZW5jeUVycm9yIGV4dGVuZHMgQmV0dGVyQXV0aEVycm9yIHtcbiAgY29uc3RydWN0b3IocGtnTmFtZSkge1xuICAgIHN1cGVyKFxuICAgICAgYFRoZSBwYWNrYWdlIFwiJHtwa2dOYW1lfVwiIGlzIHJlcXVpcmVkLiBNYWtlIHN1cmUgaXQgaXMgaW5zdGFsbGVkLmAsXG4gICAgICBwa2dOYW1lXG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgeyBCZXR0ZXJBdXRoRXJyb3IgYXMgQiwgTWlzc2luZ0RlcGVuZGVuY3lFcnJvciBhcyBNIH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DwzM-9N1.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.DwzM-9N1.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   c: () => (/* binding */ createKyselyAdapter),\n/* harmony export */   k: () => (/* binding */ kyselyAdapter)\n/* harmony export */ });\n/* harmony import */ var kysely__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! kysely */ \"(rsc)/../../node_modules/kysely/dist/esm/dialect/sqlite/sqlite-dialect.js\");\n/* harmony import */ var kysely__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! kysely */ \"(rsc)/../../node_modules/kysely/dist/esm/dialect/mysql/mysql-dialect.js\");\n/* harmony import */ var kysely__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! kysely */ \"(rsc)/../../node_modules/kysely/dist/esm/dialect/postgres/postgres-dialect.js\");\n/* harmony import */ var kysely__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! kysely */ \"(rsc)/../../node_modules/kysely/dist/esm/dialect/mssql/mssql-dialect.js\");\n/* harmony import */ var kysely__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! kysely */ \"(rsc)/../../node_modules/kysely/dist/esm/kysely.js\");\n/* harmony import */ var _better_auth_gBl3F_xa_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./better-auth.gBl3F_xa.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.gBl3F_xa.mjs\");\n\n\n\nfunction getDatabaseType(db) {\n  if (!db) {\n    return null;\n  }\n  if (\"dialect\" in db) {\n    return getDatabaseType(db.dialect);\n  }\n  if (\"createDriver\" in db) {\n    if (db instanceof kysely__WEBPACK_IMPORTED_MODULE_1__.SqliteDialect) {\n      return \"sqlite\";\n    }\n    if (db instanceof kysely__WEBPACK_IMPORTED_MODULE_2__.MysqlDialect) {\n      return \"mysql\";\n    }\n    if (db instanceof kysely__WEBPACK_IMPORTED_MODULE_3__.PostgresDialect) {\n      return \"postgres\";\n    }\n    if (db instanceof kysely__WEBPACK_IMPORTED_MODULE_4__.MssqlDialect) {\n      return \"mssql\";\n    }\n  }\n  if (\"aggregate\" in db) {\n    return \"sqlite\";\n  }\n  if (\"getConnection\" in db) {\n    return \"mysql\";\n  }\n  if (\"connect\" in db) {\n    return \"postgres\";\n  }\n  if (\"fileControl\" in db) {\n    return \"sqlite\";\n  }\n  return null;\n}\nconst createKyselyAdapter = async (config) => {\n  const db = config.database;\n  if (!db) {\n    return {\n      kysely: null,\n      databaseType: null\n    };\n  }\n  if (\"db\" in db) {\n    return {\n      kysely: db.db,\n      databaseType: db.type\n    };\n  }\n  if (\"dialect\" in db) {\n    return {\n      kysely: new kysely__WEBPACK_IMPORTED_MODULE_5__.Kysely({ dialect: db.dialect }),\n      databaseType: db.type\n    };\n  }\n  let dialect = void 0;\n  const databaseType = getDatabaseType(db);\n  if (\"createDriver\" in db) {\n    dialect = db;\n  }\n  if (\"aggregate\" in db) {\n    dialect = new kysely__WEBPACK_IMPORTED_MODULE_1__.SqliteDialect({\n      database: db\n    });\n  }\n  if (\"getConnection\" in db) {\n    dialect = new kysely__WEBPACK_IMPORTED_MODULE_2__.MysqlDialect(db);\n  }\n  if (\"connect\" in db) {\n    dialect = new kysely__WEBPACK_IMPORTED_MODULE_3__.PostgresDialect({\n      pool: db\n    });\n  }\n  if (\"fileControl\" in db) {\n    const { BunSqliteDialect } = await __webpack_require__.e(/*! import() */ \"vendor-chunks/better-auth\").then(__webpack_require__.bind(__webpack_require__, /*! ../chunks/bun-sqlite-dialect.mjs */ \"(rsc)/../../node_modules/better-auth/dist/chunks/bun-sqlite-dialect.mjs\"));\n    dialect = new BunSqliteDialect({\n      database: db\n    });\n  }\n  return {\n    kysely: dialect ? new kysely__WEBPACK_IMPORTED_MODULE_5__.Kysely({ dialect }) : null,\n    databaseType\n  };\n};\n\nconst kyselyAdapter = (db, config) => (0,_better_auth_gBl3F_xa_mjs__WEBPACK_IMPORTED_MODULE_0__.c)({\n  config: {\n    adapterId: \"kysely\",\n    adapterName: \"Kysely Adapter\",\n    usePlural: config?.usePlural,\n    debugLogs: config?.debugLogs,\n    supportsBooleans: config?.type === \"sqlite\" || config?.type === \"mssql\" || !config?.type ? false : true,\n    supportsDates: config?.type === \"sqlite\" || config?.type === \"mssql\" || !config?.type ? false : true,\n    supportsJSON: false\n  },\n  adapter: ({ getFieldName, schema }) => {\n    const withReturning = async (values, builder, model, where) => {\n      let res;\n      if (config?.type === \"mysql\") {\n        await builder.execute();\n        const field = values.id ? \"id\" : where.length > 0 && where[0].field ? where[0].field : \"id\";\n        if (!values.id && where.length === 0) {\n          res = await db.selectFrom(model).selectAll().orderBy(getFieldName({ model, field }), \"desc\").limit(1).executeTakeFirst();\n          return res;\n        }\n        const value = values[field] || where[0].value;\n        res = await db.selectFrom(model).selectAll().orderBy(getFieldName({ model, field }), \"desc\").where(getFieldName({ model, field }), \"=\", value).limit(1).executeTakeFirst();\n        return res;\n      }\n      if (config?.type === \"mssql\") {\n        res = await builder.outputAll(\"inserted\").executeTakeFirst();\n        return res;\n      }\n      res = await builder.returningAll().executeTakeFirst();\n      return res;\n    };\n    function transformValueToDB(value, model, field) {\n      if (field === \"id\") {\n        return value;\n      }\n      const { type = \"sqlite\" } = config || {};\n      let f = schema[model]?.fields[field];\n      if (!f) {\n        f = Object.values(schema).find((f2) => f2.modelName === model);\n      }\n      if (f.type === \"boolean\" && (type === \"sqlite\" || type === \"mssql\") && value !== null && value !== void 0) {\n        return value ? 1 : 0;\n      }\n      if (f.type === \"date\" && value && value instanceof Date) {\n        return type === \"sqlite\" ? value.toISOString() : value;\n      }\n      return value;\n    }\n    function convertWhereClause(model, w) {\n      if (!w)\n        return {\n          and: null,\n          or: null\n        };\n      const conditions = {\n        and: [],\n        or: []\n      };\n      w.forEach((condition) => {\n        let {\n          field: _field,\n          value,\n          operator = \"=\",\n          connector = \"AND\"\n        } = condition;\n        const field = getFieldName({ model, field: _field });\n        value = transformValueToDB(value, model, _field);\n        const expr = (eb) => {\n          if (operator.toLowerCase() === \"in\") {\n            return eb(field, \"in\", Array.isArray(value) ? value : [value]);\n          }\n          if (operator === \"contains\") {\n            return eb(field, \"like\", `%${value}%`);\n          }\n          if (operator === \"starts_with\") {\n            return eb(field, \"like\", `${value}%`);\n          }\n          if (operator === \"ends_with\") {\n            return eb(field, \"like\", `%${value}`);\n          }\n          if (operator === \"eq\") {\n            return eb(field, \"=\", value);\n          }\n          if (operator === \"ne\") {\n            return eb(field, \"<>\", value);\n          }\n          if (operator === \"gt\") {\n            return eb(field, \">\", value);\n          }\n          if (operator === \"gte\") {\n            return eb(field, \">=\", value);\n          }\n          if (operator === \"lt\") {\n            return eb(field, \"<\", value);\n          }\n          if (operator === \"lte\") {\n            return eb(field, \"<=\", value);\n          }\n          return eb(field, operator, value);\n        };\n        if (connector === \"OR\") {\n          conditions.or.push(expr);\n        } else {\n          conditions.and.push(expr);\n        }\n      });\n      return {\n        and: conditions.and.length ? conditions.and : null,\n        or: conditions.or.length ? conditions.or : null\n      };\n    }\n    return {\n      async create({ data, model }) {\n        const builder = db.insertInto(model).values(data);\n        return await withReturning(data, builder, model, []);\n      },\n      async findOne({ model, where, select }) {\n        const { and, or } = convertWhereClause(model, where);\n        let query = db.selectFrom(model).selectAll();\n        if (and) {\n          query = query.where((eb) => eb.and(and.map((expr) => expr(eb))));\n        }\n        if (or) {\n          query = query.where((eb) => eb.or(or.map((expr) => expr(eb))));\n        }\n        const res = await query.executeTakeFirst();\n        if (!res) return null;\n        return res;\n      },\n      async findMany({ model, where, limit, offset, sortBy }) {\n        const { and, or } = convertWhereClause(model, where);\n        let query = db.selectFrom(model);\n        if (and) {\n          query = query.where((eb) => eb.and(and.map((expr) => expr(eb))));\n        }\n        if (or) {\n          query = query.where((eb) => eb.or(or.map((expr) => expr(eb))));\n        }\n        if (config?.type === \"mssql\") {\n          if (!offset) {\n            query = query.top(limit || 100);\n          }\n        } else {\n          query = query.limit(limit || 100);\n        }\n        if (sortBy) {\n          query = query.orderBy(\n            getFieldName({ model, field: sortBy.field }),\n            sortBy.direction\n          );\n        }\n        if (offset) {\n          if (config?.type === \"mssql\") {\n            if (!sortBy) {\n              query = query.orderBy(getFieldName({ model, field: \"id\" }));\n            }\n            query = query.offset(offset).fetch(limit || 100);\n          } else {\n            query = query.offset(offset);\n          }\n        }\n        const res = await query.selectAll().execute();\n        if (!res) return [];\n        return res;\n      },\n      async update({ model, where, update: values }) {\n        const { and, or } = convertWhereClause(model, where);\n        let query = db.updateTable(model).set(values);\n        if (and) {\n          query = query.where((eb) => eb.and(and.map((expr) => expr(eb))));\n        }\n        if (or) {\n          query = query.where((eb) => eb.or(or.map((expr) => expr(eb))));\n        }\n        return await withReturning(values, query, model, where);\n      },\n      async updateMany({ model, where, update: values }) {\n        const { and, or } = convertWhereClause(model, where);\n        let query = db.updateTable(model).set(values);\n        if (and) {\n          query = query.where((eb) => eb.and(and.map((expr) => expr(eb))));\n        }\n        if (or) {\n          query = query.where((eb) => eb.or(or.map((expr) => expr(eb))));\n        }\n        const res = await query.execute();\n        return res.length;\n      },\n      async count({ model, where }) {\n        const { and, or } = convertWhereClause(model, where);\n        let query = db.selectFrom(model).select(db.fn.count(\"id\").as(\"count\"));\n        if (and) {\n          query = query.where((eb) => eb.and(and.map((expr) => expr(eb))));\n        }\n        if (or) {\n          query = query.where((eb) => eb.or(or.map((expr) => expr(eb))));\n        }\n        const res = await query.execute();\n        return res[0].count;\n      },\n      async delete({ model, where }) {\n        const { and, or } = convertWhereClause(model, where);\n        let query = db.deleteFrom(model);\n        if (and) {\n          query = query.where((eb) => eb.and(and.map((expr) => expr(eb))));\n        }\n        if (or) {\n          query = query.where((eb) => eb.or(or.map((expr) => expr(eb))));\n        }\n        await query.execute();\n      },\n      async deleteMany({ model, where }) {\n        const { and, or } = convertWhereClause(model, where);\n        let query = db.deleteFrom(model);\n        if (and) {\n          query = query.where((eb) => eb.and(and.map((expr) => expr(eb))));\n        }\n        if (or) {\n          query = query.where((eb) => eb.or(or.map((expr) => expr(eb))));\n        }\n        return (await query.execute()).length;\n      },\n      options: config\n    };\n  }\n});\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLkR3ek0tOU4xLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUE0RjtBQUM1Qjs7QUFFaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixpREFBYTtBQUNuQztBQUNBO0FBQ0Esc0JBQXNCLGdEQUFZO0FBQ2xDO0FBQ0E7QUFDQSxzQkFBc0IsbURBQWU7QUFDckM7QUFDQTtBQUNBLHNCQUFzQixnREFBWTtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsMENBQU0sR0FBRyxxQkFBcUI7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGlEQUFhO0FBQy9CO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxrQkFBa0IsZ0RBQVk7QUFDOUI7QUFDQTtBQUNBLGtCQUFrQixtREFBZTtBQUNqQztBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWSxtQkFBbUIsUUFBUSx5T0FBMEM7QUFDakY7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsMEJBQTBCLDBDQUFNLEdBQUcsU0FBUztBQUM1QztBQUNBO0FBQ0E7O0FBRUEsc0NBQXNDLDREQUFhO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsY0FBYyxzQkFBc0I7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEVBQThFLGNBQWM7QUFDNUY7QUFDQTtBQUNBO0FBQ0EsNEVBQTRFLGNBQWMsZ0NBQWdDLGNBQWM7QUFDeEk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLGtCQUFrQjtBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVixxQ0FBcUMsc0JBQXNCO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QyxNQUFNO0FBQy9DO0FBQ0E7QUFDQSx3Q0FBd0MsTUFBTTtBQUM5QztBQUNBO0FBQ0EseUNBQXlDLE1BQU07QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixhQUFhO0FBQ2xDO0FBQ0E7QUFDQSxPQUFPO0FBQ1Asc0JBQXNCLHNCQUFzQjtBQUM1QyxnQkFBZ0IsVUFBVTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCx1QkFBdUIscUNBQXFDO0FBQzVELGdCQUFnQixVQUFVO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsNEJBQTRCO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1EQUFtRCxvQkFBb0I7QUFDdkU7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AscUJBQXFCLDhCQUE4QjtBQUNuRCxnQkFBZ0IsVUFBVTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLHlCQUF5Qiw4QkFBOEI7QUFDdkQsZ0JBQWdCLFVBQVU7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLG9CQUFvQixjQUFjO0FBQ2xDLGdCQUFnQixVQUFVO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxxQkFBcUIsY0FBYztBQUNuQyxnQkFBZ0IsVUFBVTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLHlCQUF5QixjQUFjO0FBQ3ZDLGdCQUFnQixVQUFVO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFdUQiLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWxhbi9EZXNrdG9wL0FwcHMvYmV0dGVyLWF1dGgvbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLkR3ek0tOU4xLm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBLeXNlbHksIFNxbGl0ZURpYWxlY3QsIE15c3FsRGlhbGVjdCwgUG9zdGdyZXNEaWFsZWN0LCBNc3NxbERpYWxlY3QgfSBmcm9tICdreXNlbHknO1xuaW1wb3J0IHsgYyBhcyBjcmVhdGVBZGFwdGVyIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC5nQmwzRl94YS5tanMnO1xuXG5mdW5jdGlvbiBnZXREYXRhYmFzZVR5cGUoZGIpIHtcbiAgaWYgKCFkYikge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIGlmIChcImRpYWxlY3RcIiBpbiBkYikge1xuICAgIHJldHVybiBnZXREYXRhYmFzZVR5cGUoZGIuZGlhbGVjdCk7XG4gIH1cbiAgaWYgKFwiY3JlYXRlRHJpdmVyXCIgaW4gZGIpIHtcbiAgICBpZiAoZGIgaW5zdGFuY2VvZiBTcWxpdGVEaWFsZWN0KSB7XG4gICAgICByZXR1cm4gXCJzcWxpdGVcIjtcbiAgICB9XG4gICAgaWYgKGRiIGluc3RhbmNlb2YgTXlzcWxEaWFsZWN0KSB7XG4gICAgICByZXR1cm4gXCJteXNxbFwiO1xuICAgIH1cbiAgICBpZiAoZGIgaW5zdGFuY2VvZiBQb3N0Z3Jlc0RpYWxlY3QpIHtcbiAgICAgIHJldHVybiBcInBvc3RncmVzXCI7XG4gICAgfVxuICAgIGlmIChkYiBpbnN0YW5jZW9mIE1zc3FsRGlhbGVjdCkge1xuICAgICAgcmV0dXJuIFwibXNzcWxcIjtcbiAgICB9XG4gIH1cbiAgaWYgKFwiYWdncmVnYXRlXCIgaW4gZGIpIHtcbiAgICByZXR1cm4gXCJzcWxpdGVcIjtcbiAgfVxuICBpZiAoXCJnZXRDb25uZWN0aW9uXCIgaW4gZGIpIHtcbiAgICByZXR1cm4gXCJteXNxbFwiO1xuICB9XG4gIGlmIChcImNvbm5lY3RcIiBpbiBkYikge1xuICAgIHJldHVybiBcInBvc3RncmVzXCI7XG4gIH1cbiAgaWYgKFwiZmlsZUNvbnRyb2xcIiBpbiBkYikge1xuICAgIHJldHVybiBcInNxbGl0ZVwiO1xuICB9XG4gIHJldHVybiBudWxsO1xufVxuY29uc3QgY3JlYXRlS3lzZWx5QWRhcHRlciA9IGFzeW5jIChjb25maWcpID0+IHtcbiAgY29uc3QgZGIgPSBjb25maWcuZGF0YWJhc2U7XG4gIGlmICghZGIpIHtcbiAgICByZXR1cm4ge1xuICAgICAga3lzZWx5OiBudWxsLFxuICAgICAgZGF0YWJhc2VUeXBlOiBudWxsXG4gICAgfTtcbiAgfVxuICBpZiAoXCJkYlwiIGluIGRiKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGt5c2VseTogZGIuZGIsXG4gICAgICBkYXRhYmFzZVR5cGU6IGRiLnR5cGVcbiAgICB9O1xuICB9XG4gIGlmIChcImRpYWxlY3RcIiBpbiBkYikge1xuICAgIHJldHVybiB7XG4gICAgICBreXNlbHk6IG5ldyBLeXNlbHkoeyBkaWFsZWN0OiBkYi5kaWFsZWN0IH0pLFxuICAgICAgZGF0YWJhc2VUeXBlOiBkYi50eXBlXG4gICAgfTtcbiAgfVxuICBsZXQgZGlhbGVjdCA9IHZvaWQgMDtcbiAgY29uc3QgZGF0YWJhc2VUeXBlID0gZ2V0RGF0YWJhc2VUeXBlKGRiKTtcbiAgaWYgKFwiY3JlYXRlRHJpdmVyXCIgaW4gZGIpIHtcbiAgICBkaWFsZWN0ID0gZGI7XG4gIH1cbiAgaWYgKFwiYWdncmVnYXRlXCIgaW4gZGIpIHtcbiAgICBkaWFsZWN0ID0gbmV3IFNxbGl0ZURpYWxlY3Qoe1xuICAgICAgZGF0YWJhc2U6IGRiXG4gICAgfSk7XG4gIH1cbiAgaWYgKFwiZ2V0Q29ubmVjdGlvblwiIGluIGRiKSB7XG4gICAgZGlhbGVjdCA9IG5ldyBNeXNxbERpYWxlY3QoZGIpO1xuICB9XG4gIGlmIChcImNvbm5lY3RcIiBpbiBkYikge1xuICAgIGRpYWxlY3QgPSBuZXcgUG9zdGdyZXNEaWFsZWN0KHtcbiAgICAgIHBvb2w6IGRiXG4gICAgfSk7XG4gIH1cbiAgaWYgKFwiZmlsZUNvbnRyb2xcIiBpbiBkYikge1xuICAgIGNvbnN0IHsgQnVuU3FsaXRlRGlhbGVjdCB9ID0gYXdhaXQgaW1wb3J0KCcuLi9jaHVua3MvYnVuLXNxbGl0ZS1kaWFsZWN0Lm1qcycpO1xuICAgIGRpYWxlY3QgPSBuZXcgQnVuU3FsaXRlRGlhbGVjdCh7XG4gICAgICBkYXRhYmFzZTogZGJcbiAgICB9KTtcbiAgfVxuICByZXR1cm4ge1xuICAgIGt5c2VseTogZGlhbGVjdCA/IG5ldyBLeXNlbHkoeyBkaWFsZWN0IH0pIDogbnVsbCxcbiAgICBkYXRhYmFzZVR5cGVcbiAgfTtcbn07XG5cbmNvbnN0IGt5c2VseUFkYXB0ZXIgPSAoZGIsIGNvbmZpZykgPT4gY3JlYXRlQWRhcHRlcih7XG4gIGNvbmZpZzoge1xuICAgIGFkYXB0ZXJJZDogXCJreXNlbHlcIixcbiAgICBhZGFwdGVyTmFtZTogXCJLeXNlbHkgQWRhcHRlclwiLFxuICAgIHVzZVBsdXJhbDogY29uZmlnPy51c2VQbHVyYWwsXG4gICAgZGVidWdMb2dzOiBjb25maWc/LmRlYnVnTG9ncyxcbiAgICBzdXBwb3J0c0Jvb2xlYW5zOiBjb25maWc/LnR5cGUgPT09IFwic3FsaXRlXCIgfHwgY29uZmlnPy50eXBlID09PSBcIm1zc3FsXCIgfHwgIWNvbmZpZz8udHlwZSA/IGZhbHNlIDogdHJ1ZSxcbiAgICBzdXBwb3J0c0RhdGVzOiBjb25maWc/LnR5cGUgPT09IFwic3FsaXRlXCIgfHwgY29uZmlnPy50eXBlID09PSBcIm1zc3FsXCIgfHwgIWNvbmZpZz8udHlwZSA/IGZhbHNlIDogdHJ1ZSxcbiAgICBzdXBwb3J0c0pTT046IGZhbHNlXG4gIH0sXG4gIGFkYXB0ZXI6ICh7IGdldEZpZWxkTmFtZSwgc2NoZW1hIH0pID0+IHtcbiAgICBjb25zdCB3aXRoUmV0dXJuaW5nID0gYXN5bmMgKHZhbHVlcywgYnVpbGRlciwgbW9kZWwsIHdoZXJlKSA9PiB7XG4gICAgICBsZXQgcmVzO1xuICAgICAgaWYgKGNvbmZpZz8udHlwZSA9PT0gXCJteXNxbFwiKSB7XG4gICAgICAgIGF3YWl0IGJ1aWxkZXIuZXhlY3V0ZSgpO1xuICAgICAgICBjb25zdCBmaWVsZCA9IHZhbHVlcy5pZCA/IFwiaWRcIiA6IHdoZXJlLmxlbmd0aCA+IDAgJiYgd2hlcmVbMF0uZmllbGQgPyB3aGVyZVswXS5maWVsZCA6IFwiaWRcIjtcbiAgICAgICAgaWYgKCF2YWx1ZXMuaWQgJiYgd2hlcmUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgcmVzID0gYXdhaXQgZGIuc2VsZWN0RnJvbShtb2RlbCkuc2VsZWN0QWxsKCkub3JkZXJCeShnZXRGaWVsZE5hbWUoeyBtb2RlbCwgZmllbGQgfSksIFwiZGVzY1wiKS5saW1pdCgxKS5leGVjdXRlVGFrZUZpcnN0KCk7XG4gICAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB2YWx1ZSA9IHZhbHVlc1tmaWVsZF0gfHwgd2hlcmVbMF0udmFsdWU7XG4gICAgICAgIHJlcyA9IGF3YWl0IGRiLnNlbGVjdEZyb20obW9kZWwpLnNlbGVjdEFsbCgpLm9yZGVyQnkoZ2V0RmllbGROYW1lKHsgbW9kZWwsIGZpZWxkIH0pLCBcImRlc2NcIikud2hlcmUoZ2V0RmllbGROYW1lKHsgbW9kZWwsIGZpZWxkIH0pLCBcIj1cIiwgdmFsdWUpLmxpbWl0KDEpLmV4ZWN1dGVUYWtlRmlyc3QoKTtcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgIH1cbiAgICAgIGlmIChjb25maWc/LnR5cGUgPT09IFwibXNzcWxcIikge1xuICAgICAgICByZXMgPSBhd2FpdCBidWlsZGVyLm91dHB1dEFsbChcImluc2VydGVkXCIpLmV4ZWN1dGVUYWtlRmlyc3QoKTtcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgIH1cbiAgICAgIHJlcyA9IGF3YWl0IGJ1aWxkZXIucmV0dXJuaW5nQWxsKCkuZXhlY3V0ZVRha2VGaXJzdCgpO1xuICAgICAgcmV0dXJuIHJlcztcbiAgICB9O1xuICAgIGZ1bmN0aW9uIHRyYW5zZm9ybVZhbHVlVG9EQih2YWx1ZSwgbW9kZWwsIGZpZWxkKSB7XG4gICAgICBpZiAoZmllbGQgPT09IFwiaWRcIikge1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9XG4gICAgICBjb25zdCB7IHR5cGUgPSBcInNxbGl0ZVwiIH0gPSBjb25maWcgfHwge307XG4gICAgICBsZXQgZiA9IHNjaGVtYVttb2RlbF0/LmZpZWxkc1tmaWVsZF07XG4gICAgICBpZiAoIWYpIHtcbiAgICAgICAgZiA9IE9iamVjdC52YWx1ZXMoc2NoZW1hKS5maW5kKChmMikgPT4gZjIubW9kZWxOYW1lID09PSBtb2RlbCk7XG4gICAgICB9XG4gICAgICBpZiAoZi50eXBlID09PSBcImJvb2xlYW5cIiAmJiAodHlwZSA9PT0gXCJzcWxpdGVcIiB8fCB0eXBlID09PSBcIm1zc3FsXCIpICYmIHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB2b2lkIDApIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlID8gMSA6IDA7XG4gICAgICB9XG4gICAgICBpZiAoZi50eXBlID09PSBcImRhdGVcIiAmJiB2YWx1ZSAmJiB2YWx1ZSBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgICAgcmV0dXJuIHR5cGUgPT09IFwic3FsaXRlXCIgPyB2YWx1ZS50b0lTT1N0cmluZygpIDogdmFsdWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGNvbnZlcnRXaGVyZUNsYXVzZShtb2RlbCwgdykge1xuICAgICAgaWYgKCF3KVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGFuZDogbnVsbCxcbiAgICAgICAgICBvcjogbnVsbFxuICAgICAgICB9O1xuICAgICAgY29uc3QgY29uZGl0aW9ucyA9IHtcbiAgICAgICAgYW5kOiBbXSxcbiAgICAgICAgb3I6IFtdXG4gICAgICB9O1xuICAgICAgdy5mb3JFYWNoKChjb25kaXRpb24pID0+IHtcbiAgICAgICAgbGV0IHtcbiAgICAgICAgICBmaWVsZDogX2ZpZWxkLFxuICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgIG9wZXJhdG9yID0gXCI9XCIsXG4gICAgICAgICAgY29ubmVjdG9yID0gXCJBTkRcIlxuICAgICAgICB9ID0gY29uZGl0aW9uO1xuICAgICAgICBjb25zdCBmaWVsZCA9IGdldEZpZWxkTmFtZSh7IG1vZGVsLCBmaWVsZDogX2ZpZWxkIH0pO1xuICAgICAgICB2YWx1ZSA9IHRyYW5zZm9ybVZhbHVlVG9EQih2YWx1ZSwgbW9kZWwsIF9maWVsZCk7XG4gICAgICAgIGNvbnN0IGV4cHIgPSAoZWIpID0+IHtcbiAgICAgICAgICBpZiAob3BlcmF0b3IudG9Mb3dlckNhc2UoKSA9PT0gXCJpblwiKSB7XG4gICAgICAgICAgICByZXR1cm4gZWIoZmllbGQsIFwiaW5cIiwgQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZSA6IFt2YWx1ZV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAob3BlcmF0b3IgPT09IFwiY29udGFpbnNcIikge1xuICAgICAgICAgICAgcmV0dXJuIGViKGZpZWxkLCBcImxpa2VcIiwgYCUke3ZhbHVlfSVgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG9wZXJhdG9yID09PSBcInN0YXJ0c193aXRoXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBlYihmaWVsZCwgXCJsaWtlXCIsIGAke3ZhbHVlfSVgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG9wZXJhdG9yID09PSBcImVuZHNfd2l0aFwiKSB7XG4gICAgICAgICAgICByZXR1cm4gZWIoZmllbGQsIFwibGlrZVwiLCBgJSR7dmFsdWV9YCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChvcGVyYXRvciA9PT0gXCJlcVwiKSB7XG4gICAgICAgICAgICByZXR1cm4gZWIoZmllbGQsIFwiPVwiLCB2YWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChvcGVyYXRvciA9PT0gXCJuZVwiKSB7XG4gICAgICAgICAgICByZXR1cm4gZWIoZmllbGQsIFwiPD5cIiwgdmFsdWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAob3BlcmF0b3IgPT09IFwiZ3RcIikge1xuICAgICAgICAgICAgcmV0dXJuIGViKGZpZWxkLCBcIj5cIiwgdmFsdWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAob3BlcmF0b3IgPT09IFwiZ3RlXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBlYihmaWVsZCwgXCI+PVwiLCB2YWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChvcGVyYXRvciA9PT0gXCJsdFwiKSB7XG4gICAgICAgICAgICByZXR1cm4gZWIoZmllbGQsIFwiPFwiLCB2YWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChvcGVyYXRvciA9PT0gXCJsdGVcIikge1xuICAgICAgICAgICAgcmV0dXJuIGViKGZpZWxkLCBcIjw9XCIsIHZhbHVlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGViKGZpZWxkLCBvcGVyYXRvciwgdmFsdWUpO1xuICAgICAgICB9O1xuICAgICAgICBpZiAoY29ubmVjdG9yID09PSBcIk9SXCIpIHtcbiAgICAgICAgICBjb25kaXRpb25zLm9yLnB1c2goZXhwcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uZGl0aW9ucy5hbmQucHVzaChleHByKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhbmQ6IGNvbmRpdGlvbnMuYW5kLmxlbmd0aCA/IGNvbmRpdGlvbnMuYW5kIDogbnVsbCxcbiAgICAgICAgb3I6IGNvbmRpdGlvbnMub3IubGVuZ3RoID8gY29uZGl0aW9ucy5vciA6IG51bGxcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICBhc3luYyBjcmVhdGUoeyBkYXRhLCBtb2RlbCB9KSB7XG4gICAgICAgIGNvbnN0IGJ1aWxkZXIgPSBkYi5pbnNlcnRJbnRvKG1vZGVsKS52YWx1ZXMoZGF0YSk7XG4gICAgICAgIHJldHVybiBhd2FpdCB3aXRoUmV0dXJuaW5nKGRhdGEsIGJ1aWxkZXIsIG1vZGVsLCBbXSk7XG4gICAgICB9LFxuICAgICAgYXN5bmMgZmluZE9uZSh7IG1vZGVsLCB3aGVyZSwgc2VsZWN0IH0pIHtcbiAgICAgICAgY29uc3QgeyBhbmQsIG9yIH0gPSBjb252ZXJ0V2hlcmVDbGF1c2UobW9kZWwsIHdoZXJlKTtcbiAgICAgICAgbGV0IHF1ZXJ5ID0gZGIuc2VsZWN0RnJvbShtb2RlbCkuc2VsZWN0QWxsKCk7XG4gICAgICAgIGlmIChhbmQpIHtcbiAgICAgICAgICBxdWVyeSA9IHF1ZXJ5LndoZXJlKChlYikgPT4gZWIuYW5kKGFuZC5tYXAoKGV4cHIpID0+IGV4cHIoZWIpKSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcikge1xuICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkud2hlcmUoKGViKSA9PiBlYi5vcihvci5tYXAoKGV4cHIpID0+IGV4cHIoZWIpKSkpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHF1ZXJ5LmV4ZWN1dGVUYWtlRmlyc3QoKTtcbiAgICAgICAgaWYgKCFyZXMpIHJldHVybiBudWxsO1xuICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgfSxcbiAgICAgIGFzeW5jIGZpbmRNYW55KHsgbW9kZWwsIHdoZXJlLCBsaW1pdCwgb2Zmc2V0LCBzb3J0QnkgfSkge1xuICAgICAgICBjb25zdCB7IGFuZCwgb3IgfSA9IGNvbnZlcnRXaGVyZUNsYXVzZShtb2RlbCwgd2hlcmUpO1xuICAgICAgICBsZXQgcXVlcnkgPSBkYi5zZWxlY3RGcm9tKG1vZGVsKTtcbiAgICAgICAgaWYgKGFuZCkge1xuICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkud2hlcmUoKGViKSA9PiBlYi5hbmQoYW5kLm1hcCgoZXhwcikgPT4gZXhwcihlYikpKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9yKSB7XG4gICAgICAgICAgcXVlcnkgPSBxdWVyeS53aGVyZSgoZWIpID0+IGViLm9yKG9yLm1hcCgoZXhwcikgPT4gZXhwcihlYikpKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZz8udHlwZSA9PT0gXCJtc3NxbFwiKSB7XG4gICAgICAgICAgaWYgKCFvZmZzZXQpIHtcbiAgICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkudG9wKGxpbWl0IHx8IDEwMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkubGltaXQobGltaXQgfHwgMTAwKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc29ydEJ5KSB7XG4gICAgICAgICAgcXVlcnkgPSBxdWVyeS5vcmRlckJ5KFxuICAgICAgICAgICAgZ2V0RmllbGROYW1lKHsgbW9kZWwsIGZpZWxkOiBzb3J0QnkuZmllbGQgfSksXG4gICAgICAgICAgICBzb3J0QnkuZGlyZWN0aW9uXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob2Zmc2V0KSB7XG4gICAgICAgICAgaWYgKGNvbmZpZz8udHlwZSA9PT0gXCJtc3NxbFwiKSB7XG4gICAgICAgICAgICBpZiAoIXNvcnRCeSkge1xuICAgICAgICAgICAgICBxdWVyeSA9IHF1ZXJ5Lm9yZGVyQnkoZ2V0RmllbGROYW1lKHsgbW9kZWwsIGZpZWxkOiBcImlkXCIgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcXVlcnkgPSBxdWVyeS5vZmZzZXQob2Zmc2V0KS5mZXRjaChsaW1pdCB8fCAxMDApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBxdWVyeSA9IHF1ZXJ5Lm9mZnNldChvZmZzZXQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBxdWVyeS5zZWxlY3RBbGwoKS5leGVjdXRlKCk7XG4gICAgICAgIGlmICghcmVzKSByZXR1cm4gW107XG4gICAgICAgIHJldHVybiByZXM7XG4gICAgICB9LFxuICAgICAgYXN5bmMgdXBkYXRlKHsgbW9kZWwsIHdoZXJlLCB1cGRhdGU6IHZhbHVlcyB9KSB7XG4gICAgICAgIGNvbnN0IHsgYW5kLCBvciB9ID0gY29udmVydFdoZXJlQ2xhdXNlKG1vZGVsLCB3aGVyZSk7XG4gICAgICAgIGxldCBxdWVyeSA9IGRiLnVwZGF0ZVRhYmxlKG1vZGVsKS5zZXQodmFsdWVzKTtcbiAgICAgICAgaWYgKGFuZCkge1xuICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkud2hlcmUoKGViKSA9PiBlYi5hbmQoYW5kLm1hcCgoZXhwcikgPT4gZXhwcihlYikpKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9yKSB7XG4gICAgICAgICAgcXVlcnkgPSBxdWVyeS53aGVyZSgoZWIpID0+IGViLm9yKG9yLm1hcCgoZXhwcikgPT4gZXhwcihlYikpKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGF3YWl0IHdpdGhSZXR1cm5pbmcodmFsdWVzLCBxdWVyeSwgbW9kZWwsIHdoZXJlKTtcbiAgICAgIH0sXG4gICAgICBhc3luYyB1cGRhdGVNYW55KHsgbW9kZWwsIHdoZXJlLCB1cGRhdGU6IHZhbHVlcyB9KSB7XG4gICAgICAgIGNvbnN0IHsgYW5kLCBvciB9ID0gY29udmVydFdoZXJlQ2xhdXNlKG1vZGVsLCB3aGVyZSk7XG4gICAgICAgIGxldCBxdWVyeSA9IGRiLnVwZGF0ZVRhYmxlKG1vZGVsKS5zZXQodmFsdWVzKTtcbiAgICAgICAgaWYgKGFuZCkge1xuICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkud2hlcmUoKGViKSA9PiBlYi5hbmQoYW5kLm1hcCgoZXhwcikgPT4gZXhwcihlYikpKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9yKSB7XG4gICAgICAgICAgcXVlcnkgPSBxdWVyeS53aGVyZSgoZWIpID0+IGViLm9yKG9yLm1hcCgoZXhwcikgPT4gZXhwcihlYikpKSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgcXVlcnkuZXhlY3V0ZSgpO1xuICAgICAgICByZXR1cm4gcmVzLmxlbmd0aDtcbiAgICAgIH0sXG4gICAgICBhc3luYyBjb3VudCh7IG1vZGVsLCB3aGVyZSB9KSB7XG4gICAgICAgIGNvbnN0IHsgYW5kLCBvciB9ID0gY29udmVydFdoZXJlQ2xhdXNlKG1vZGVsLCB3aGVyZSk7XG4gICAgICAgIGxldCBxdWVyeSA9IGRiLnNlbGVjdEZyb20obW9kZWwpLnNlbGVjdChkYi5mbi5jb3VudChcImlkXCIpLmFzKFwiY291bnRcIikpO1xuICAgICAgICBpZiAoYW5kKSB7XG4gICAgICAgICAgcXVlcnkgPSBxdWVyeS53aGVyZSgoZWIpID0+IGViLmFuZChhbmQubWFwKChleHByKSA9PiBleHByKGViKSkpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3IpIHtcbiAgICAgICAgICBxdWVyeSA9IHF1ZXJ5LndoZXJlKChlYikgPT4gZWIub3Iob3IubWFwKChleHByKSA9PiBleHByKGViKSkpKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBxdWVyeS5leGVjdXRlKCk7XG4gICAgICAgIHJldHVybiByZXNbMF0uY291bnQ7XG4gICAgICB9LFxuICAgICAgYXN5bmMgZGVsZXRlKHsgbW9kZWwsIHdoZXJlIH0pIHtcbiAgICAgICAgY29uc3QgeyBhbmQsIG9yIH0gPSBjb252ZXJ0V2hlcmVDbGF1c2UobW9kZWwsIHdoZXJlKTtcbiAgICAgICAgbGV0IHF1ZXJ5ID0gZGIuZGVsZXRlRnJvbShtb2RlbCk7XG4gICAgICAgIGlmIChhbmQpIHtcbiAgICAgICAgICBxdWVyeSA9IHF1ZXJ5LndoZXJlKChlYikgPT4gZWIuYW5kKGFuZC5tYXAoKGV4cHIpID0+IGV4cHIoZWIpKSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcikge1xuICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkud2hlcmUoKGViKSA9PiBlYi5vcihvci5tYXAoKGV4cHIpID0+IGV4cHIoZWIpKSkpO1xuICAgICAgICB9XG4gICAgICAgIGF3YWl0IHF1ZXJ5LmV4ZWN1dGUoKTtcbiAgICAgIH0sXG4gICAgICBhc3luYyBkZWxldGVNYW55KHsgbW9kZWwsIHdoZXJlIH0pIHtcbiAgICAgICAgY29uc3QgeyBhbmQsIG9yIH0gPSBjb252ZXJ0V2hlcmVDbGF1c2UobW9kZWwsIHdoZXJlKTtcbiAgICAgICAgbGV0IHF1ZXJ5ID0gZGIuZGVsZXRlRnJvbShtb2RlbCk7XG4gICAgICAgIGlmIChhbmQpIHtcbiAgICAgICAgICBxdWVyeSA9IHF1ZXJ5LndoZXJlKChlYikgPT4gZWIuYW5kKGFuZC5tYXAoKGV4cHIpID0+IGV4cHIoZWIpKSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcikge1xuICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkud2hlcmUoKGViKSA9PiBlYi5vcihvci5tYXAoKGV4cHIpID0+IGV4cHIoZWIpKSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoYXdhaXQgcXVlcnkuZXhlY3V0ZSgpKS5sZW5ndGg7XG4gICAgICB9LFxuICAgICAgb3B0aW9uczogY29uZmlnXG4gICAgfTtcbiAgfVxufSk7XG5cbmV4cG9ydCB7IGNyZWF0ZUt5c2VseUFkYXB0ZXIgYXMgYywga3lzZWx5QWRhcHRlciBhcyBrIH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DwzM-9N1.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/shared/better-auth.VTXNLFMT.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.VTXNLFMT.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   a: () => (/* binding */ getBaseURL),\n/* harmony export */   b: () => (/* binding */ getHost),\n/* harmony export */   c: () => (/* binding */ getProtocol),\n/* harmony export */   g: () => (/* binding */ getOrigin)\n/* harmony export */ });\n/* harmony import */ var _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./better-auth.8zoxzg-F.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs\");\n/* harmony import */ var _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./better-auth.DdzSJf-n.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs\");\n\n\n\nfunction checkHasPath(url) {\n  try {\n    const parsedUrl = new URL(url);\n    return parsedUrl.pathname !== \"/\";\n  } catch (error) {\n    throw new _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_1__.B(\n      `Invalid base URL: ${url}. Please provide a valid base URL.`\n    );\n  }\n}\nfunction withPath(url, path = \"/api/auth\") {\n  const hasPath = checkHasPath(url);\n  if (hasPath) {\n    return url;\n  }\n  path = path.startsWith(\"/\") ? path : `/${path}`;\n  return `${url.replace(/\\/+$/, \"\")}${path}`;\n}\nfunction getBaseURL(url, path, request) {\n  if (url) {\n    return withPath(url, path);\n  }\n  const fromEnv = _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__.e.BETTER_AUTH_URL || _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__.e.NEXT_PUBLIC_BETTER_AUTH_URL || _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__.e.PUBLIC_BETTER_AUTH_URL || _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__.e.NUXT_PUBLIC_BETTER_AUTH_URL || _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__.e.NUXT_PUBLIC_AUTH_URL || (_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__.e.BASE_URL !== \"/\" ? _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__.e.BASE_URL : void 0);\n  if (fromEnv) {\n    return withPath(fromEnv, path);\n  }\n  const fromRequest = request?.headers.get(\"x-forwarded-host\");\n  const fromRequestProto = request?.headers.get(\"x-forwarded-proto\");\n  if (fromRequest && fromRequestProto) {\n    return withPath(`${fromRequestProto}://${fromRequest}`, path);\n  }\n  if (request) {\n    const url2 = getOrigin(request.url);\n    if (!url2) {\n      throw new _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_1__.B(\n        \"Could not get origin from request. Please provide a valid base URL.\"\n      );\n    }\n    return withPath(url2, path);\n  }\n  if (typeof window !== \"undefined\" && window.location) {\n    return withPath(window.location.origin, path);\n  }\n  return void 0;\n}\nfunction getOrigin(url) {\n  try {\n    const parsedUrl = new URL(url);\n    return parsedUrl.origin;\n  } catch (error) {\n    return null;\n  }\n}\nfunction getProtocol(url) {\n  try {\n    const parsedUrl = new URL(url);\n    return parsedUrl.protocol;\n  } catch (error) {\n    return null;\n  }\n}\nfunction getHost(url) {\n  try {\n    const parsedUrl = new URL(url);\n    return parsedUrl.host;\n  } catch (error) {\n    return url;\n  }\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLlZUWE5MRk1ULm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBc0Q7QUFDWTs7QUFFbEU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osY0FBYyx3REFBZTtBQUM3QiwyQkFBMkIsSUFBSTtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLEtBQUs7QUFDaEQsWUFBWSx3QkFBd0IsRUFBRSxLQUFLO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0Isd0RBQUcsb0JBQW9CLHdEQUFHLGdDQUFnQyx3REFBRywyQkFBMkIsd0RBQUcsZ0NBQWdDLHdEQUFHLDBCQUEwQix3REFBRyxvQkFBb0Isd0RBQUc7QUFDcE07QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLGlCQUFpQixLQUFLLFlBQVk7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0Isd0RBQWU7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRTJFIiwic291cmNlcyI6WyIvVXNlcnMvbWlsYW4vRGVza3RvcC9BcHBzL2JldHRlci1hdXRoL25vZGVfbW9kdWxlcy9iZXR0ZXItYXV0aC9kaXN0L3NoYXJlZC9iZXR0ZXItYXV0aC5WVFhOTEZNVC5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZSBhcyBlbnYgfSBmcm9tICcuL2JldHRlci1hdXRoLjh6b3h6Zy1GLm1qcyc7XG5pbXBvcnQgeyBCIGFzIEJldHRlckF1dGhFcnJvciB9IGZyb20gJy4vYmV0dGVyLWF1dGguRGR6U0pmLW4ubWpzJztcblxuZnVuY3Rpb24gY2hlY2tIYXNQYXRoKHVybCkge1xuICB0cnkge1xuICAgIGNvbnN0IHBhcnNlZFVybCA9IG5ldyBVUkwodXJsKTtcbiAgICByZXR1cm4gcGFyc2VkVXJsLnBhdGhuYW1lICE9PSBcIi9cIjtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICB0aHJvdyBuZXcgQmV0dGVyQXV0aEVycm9yKFxuICAgICAgYEludmFsaWQgYmFzZSBVUkw6ICR7dXJsfS4gUGxlYXNlIHByb3ZpZGUgYSB2YWxpZCBiYXNlIFVSTC5gXG4gICAgKTtcbiAgfVxufVxuZnVuY3Rpb24gd2l0aFBhdGgodXJsLCBwYXRoID0gXCIvYXBpL2F1dGhcIikge1xuICBjb25zdCBoYXNQYXRoID0gY2hlY2tIYXNQYXRoKHVybCk7XG4gIGlmIChoYXNQYXRoKSB7XG4gICAgcmV0dXJuIHVybDtcbiAgfVxuICBwYXRoID0gcGF0aC5zdGFydHNXaXRoKFwiL1wiKSA/IHBhdGggOiBgLyR7cGF0aH1gO1xuICByZXR1cm4gYCR7dXJsLnJlcGxhY2UoL1xcLyskLywgXCJcIil9JHtwYXRofWA7XG59XG5mdW5jdGlvbiBnZXRCYXNlVVJMKHVybCwgcGF0aCwgcmVxdWVzdCkge1xuICBpZiAodXJsKSB7XG4gICAgcmV0dXJuIHdpdGhQYXRoKHVybCwgcGF0aCk7XG4gIH1cbiAgY29uc3QgZnJvbUVudiA9IGVudi5CRVRURVJfQVVUSF9VUkwgfHwgZW52Lk5FWFRfUFVCTElDX0JFVFRFUl9BVVRIX1VSTCB8fCBlbnYuUFVCTElDX0JFVFRFUl9BVVRIX1VSTCB8fCBlbnYuTlVYVF9QVUJMSUNfQkVUVEVSX0FVVEhfVVJMIHx8IGVudi5OVVhUX1BVQkxJQ19BVVRIX1VSTCB8fCAoZW52LkJBU0VfVVJMICE9PSBcIi9cIiA/IGVudi5CQVNFX1VSTCA6IHZvaWQgMCk7XG4gIGlmIChmcm9tRW52KSB7XG4gICAgcmV0dXJuIHdpdGhQYXRoKGZyb21FbnYsIHBhdGgpO1xuICB9XG4gIGNvbnN0IGZyb21SZXF1ZXN0ID0gcmVxdWVzdD8uaGVhZGVycy5nZXQoXCJ4LWZvcndhcmRlZC1ob3N0XCIpO1xuICBjb25zdCBmcm9tUmVxdWVzdFByb3RvID0gcmVxdWVzdD8uaGVhZGVycy5nZXQoXCJ4LWZvcndhcmRlZC1wcm90b1wiKTtcbiAgaWYgKGZyb21SZXF1ZXN0ICYmIGZyb21SZXF1ZXN0UHJvdG8pIHtcbiAgICByZXR1cm4gd2l0aFBhdGgoYCR7ZnJvbVJlcXVlc3RQcm90b306Ly8ke2Zyb21SZXF1ZXN0fWAsIHBhdGgpO1xuICB9XG4gIGlmIChyZXF1ZXN0KSB7XG4gICAgY29uc3QgdXJsMiA9IGdldE9yaWdpbihyZXF1ZXN0LnVybCk7XG4gICAgaWYgKCF1cmwyKSB7XG4gICAgICB0aHJvdyBuZXcgQmV0dGVyQXV0aEVycm9yKFxuICAgICAgICBcIkNvdWxkIG5vdCBnZXQgb3JpZ2luIGZyb20gcmVxdWVzdC4gUGxlYXNlIHByb3ZpZGUgYSB2YWxpZCBiYXNlIFVSTC5cIlxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIHdpdGhQYXRoKHVybDIsIHBhdGgpO1xuICB9XG4gIGlmICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiICYmIHdpbmRvdy5sb2NhdGlvbikge1xuICAgIHJldHVybiB3aXRoUGF0aCh3aW5kb3cubG9jYXRpb24ub3JpZ2luLCBwYXRoKTtcbiAgfVxuICByZXR1cm4gdm9pZCAwO1xufVxuZnVuY3Rpb24gZ2V0T3JpZ2luKHVybCkge1xuICB0cnkge1xuICAgIGNvbnN0IHBhcnNlZFVybCA9IG5ldyBVUkwodXJsKTtcbiAgICByZXR1cm4gcGFyc2VkVXJsLm9yaWdpbjtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuZnVuY3Rpb24gZ2V0UHJvdG9jb2wodXJsKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgcGFyc2VkVXJsID0gbmV3IFVSTCh1cmwpO1xuICAgIHJldHVybiBwYXJzZWRVcmwucHJvdG9jb2w7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cbmZ1bmN0aW9uIGdldEhvc3QodXJsKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgcGFyc2VkVXJsID0gbmV3IFVSTCh1cmwpO1xuICAgIHJldHVybiBwYXJzZWRVcmwuaG9zdDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gdXJsO1xuICB9XG59XG5cbmV4cG9ydCB7IGdldEJhc2VVUkwgYXMgYSwgZ2V0SG9zdCBhcyBiLCBnZXRQcm90b2NvbCBhcyBjLCBnZXRPcmlnaW4gYXMgZyB9O1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/shared/better-auth.VTXNLFMT.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/shared/better-auth.YwDQhoPc.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.YwDQhoPc.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   c: () => (/* binding */ checkPassword),\n/* harmony export */   v: () => (/* binding */ validatePassword)\n/* harmony export */ });\n/* harmony import */ var better_call__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! better-call */ \"(rsc)/../../node_modules/better-call/dist/index.js\");\n\n\nasync function validatePassword(ctx, data) {\n  const accounts = await ctx.context.internalAdapter.findAccounts(data.userId);\n  const credentialAccount = accounts?.find(\n    (account) => account.providerId === \"credential\"\n  );\n  const currentPassword = credentialAccount?.password;\n  if (!credentialAccount || !currentPassword) {\n    return false;\n  }\n  const compare = await ctx.context.password.verify({\n    hash: currentPassword,\n    password: data.password\n  });\n  return compare;\n}\nasync function checkPassword(userId, c) {\n  const accounts = await c.context.internalAdapter.findAccounts(userId);\n  const credentialAccount = accounts?.find(\n    (account) => account.providerId === \"credential\"\n  );\n  const currentPassword = credentialAccount?.password;\n  if (!credentialAccount || !currentPassword || !c.body.password) {\n    throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n      message: \"No password credential found\"\n    });\n  }\n  const compare = await c.context.password.verify({\n    hash: currentPassword,\n    password: c.body.password\n  });\n  if (!compare) {\n    throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n      message: \"Invalid password\"\n    });\n  }\n  return true;\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLll3RFFob1BjLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBdUM7O0FBRXZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLGlEQUFRO0FBQ3RCO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsY0FBYyxpREFBUTtBQUN0QjtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRXFEIiwic291cmNlcyI6WyIvVXNlcnMvbWlsYW4vRGVza3RvcC9BcHBzL2JldHRlci1hdXRoL25vZGVfbW9kdWxlcy9iZXR0ZXItYXV0aC9kaXN0L3NoYXJlZC9iZXR0ZXItYXV0aC5Zd0RRaG9QYy5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQVBJRXJyb3IgfSBmcm9tICdiZXR0ZXItY2FsbCc7XG5cbmFzeW5jIGZ1bmN0aW9uIHZhbGlkYXRlUGFzc3dvcmQoY3R4LCBkYXRhKSB7XG4gIGNvbnN0IGFjY291bnRzID0gYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmZpbmRBY2NvdW50cyhkYXRhLnVzZXJJZCk7XG4gIGNvbnN0IGNyZWRlbnRpYWxBY2NvdW50ID0gYWNjb3VudHM/LmZpbmQoXG4gICAgKGFjY291bnQpID0+IGFjY291bnQucHJvdmlkZXJJZCA9PT0gXCJjcmVkZW50aWFsXCJcbiAgKTtcbiAgY29uc3QgY3VycmVudFBhc3N3b3JkID0gY3JlZGVudGlhbEFjY291bnQ/LnBhc3N3b3JkO1xuICBpZiAoIWNyZWRlbnRpYWxBY2NvdW50IHx8ICFjdXJyZW50UGFzc3dvcmQpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgY29uc3QgY29tcGFyZSA9IGF3YWl0IGN0eC5jb250ZXh0LnBhc3N3b3JkLnZlcmlmeSh7XG4gICAgaGFzaDogY3VycmVudFBhc3N3b3JkLFxuICAgIHBhc3N3b3JkOiBkYXRhLnBhc3N3b3JkXG4gIH0pO1xuICByZXR1cm4gY29tcGFyZTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGNoZWNrUGFzc3dvcmQodXNlcklkLCBjKSB7XG4gIGNvbnN0IGFjY291bnRzID0gYXdhaXQgYy5jb250ZXh0LmludGVybmFsQWRhcHRlci5maW5kQWNjb3VudHModXNlcklkKTtcbiAgY29uc3QgY3JlZGVudGlhbEFjY291bnQgPSBhY2NvdW50cz8uZmluZChcbiAgICAoYWNjb3VudCkgPT4gYWNjb3VudC5wcm92aWRlcklkID09PSBcImNyZWRlbnRpYWxcIlxuICApO1xuICBjb25zdCBjdXJyZW50UGFzc3dvcmQgPSBjcmVkZW50aWFsQWNjb3VudD8ucGFzc3dvcmQ7XG4gIGlmICghY3JlZGVudGlhbEFjY291bnQgfHwgIWN1cnJlbnRQYXNzd29yZCB8fCAhYy5ib2R5LnBhc3N3b3JkKSB7XG4gICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgbWVzc2FnZTogXCJObyBwYXNzd29yZCBjcmVkZW50aWFsIGZvdW5kXCJcbiAgICB9KTtcbiAgfVxuICBjb25zdCBjb21wYXJlID0gYXdhaXQgYy5jb250ZXh0LnBhc3N3b3JkLnZlcmlmeSh7XG4gICAgaGFzaDogY3VycmVudFBhc3N3b3JkLFxuICAgIHBhc3N3b3JkOiBjLmJvZHkucGFzc3dvcmRcbiAgfSk7XG4gIGlmICghY29tcGFyZSkge1xuICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgIG1lc3NhZ2U6IFwiSW52YWxpZCBwYXNzd29yZFwiXG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59XG5cbmV4cG9ydCB7IGNoZWNrUGFzc3dvcmQgYXMgYywgdmFsaWRhdGVQYXNzd29yZCBhcyB2IH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/shared/better-auth.YwDQhoPc.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/shared/better-auth.gBl3F_xa.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.gBl3F_xa.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   c: () => (/* binding */ createAdapter)\n/* harmony export */ });\n/* harmony import */ var _better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./better-auth.tB5eU6EY.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.tB5eU6EY.mjs\");\n/* harmony import */ var _better_auth_DORkW_Ge_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./better-auth.DORkW_Ge.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DORkW_Ge.mjs\");\n/* harmony import */ var _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./better-auth.DBGfIDnh.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DBGfIDnh.mjs\");\n/* harmony import */ var better_call__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! better-call */ \"(rsc)/../../node_modules/better-call/dist/index.js\");\n/* harmony import */ var _better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @better-auth/utils/hash */ \"(rsc)/../../node_modules/@better-auth/utils/dist/hash.mjs\");\n/* harmony import */ var _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @better-auth/utils/base64 */ \"(rsc)/../../node_modules/@better-auth/utils/dist/base64.mjs\");\n/* harmony import */ var _better_auth_utils__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @better-auth/utils */ \"(rsc)/../../node_modules/@better-auth/utils/dist/index.mjs\");\n/* harmony import */ var _better_auth_utils_hex__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @better-auth/utils/hex */ \"(rsc)/../../node_modules/@better-auth/utils/dist/hex.mjs\");\n/* harmony import */ var _better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./better-auth.B4Qoxdgc.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction withApplyDefault(value, field, action) {\n  if (action === \"update\") {\n    return value;\n  }\n  if (value === void 0 || value === null) {\n    if (field.defaultValue !== void 0) {\n      if (typeof field.defaultValue === \"function\") {\n        return field.defaultValue();\n      }\n      return field.defaultValue;\n    }\n  }\n  return value;\n}\n\nlet debugLogs = [];\nlet transactionId = -1;\nconst colors = {\n  reset: \"\\x1B[0m\",\n  bright: \"\\x1B[1m\",\n  dim: \"\\x1B[2m\",\n  fg: {\n    yellow: \"\\x1B[33m\",\n    magenta: \"\\x1B[35m\"},\n  bg: {\n    black: \"\\x1B[40m\"}\n};\nconst createAdapter = ({\n  adapter,\n  config: cfg\n}) => (options) => {\n  const config = {\n    ...cfg,\n    supportsBooleans: cfg.supportsBooleans ?? true,\n    supportsDates: cfg.supportsDates ?? true,\n    supportsJSON: cfg.supportsJSON ?? false,\n    adapterName: cfg.adapterName ?? cfg.adapterId,\n    supportsNumericIds: cfg.supportsNumericIds ?? true\n  };\n  if (options.advanced?.database?.useNumberId === true && config.supportsNumericIds === false) {\n    throw new Error(\n      `[${config.adapterName}] Your database or database adapter does not support numeric ids. Please disable \"useNumberId\" in your config.`\n    );\n  }\n  const schema = (0,_better_auth_DORkW_Ge_mjs__WEBPACK_IMPORTED_MODULE_1__.g)(options);\n  const getDefaultFieldName = ({\n    field,\n    model: unsafe_model\n  }) => {\n    if (field === \"id\" || field === \"_id\") {\n      return \"id\";\n    }\n    const model = getDefaultModelName(unsafe_model);\n    let f = schema[model]?.fields[field];\n    if (!f) {\n      f = Object.values(schema[model]?.fields).find(\n        (f2) => f2.fieldName === field\n      );\n    }\n    if (!f) {\n      debugLog(`Field ${field} not found in model ${model}`);\n      debugLog(`Schema:`, schema);\n      throw new Error(`Field ${field} not found in model ${model}`);\n    }\n    return field;\n  };\n  const getDefaultModelName = (model) => {\n    if (config.usePlural && model.charAt(model.length - 1) === \"s\") {\n      let pluralessModel = model.slice(0, -1);\n      let m2 = schema[pluralessModel] ? pluralessModel : void 0;\n      if (!m2) {\n        m2 = Object.entries(schema).find(\n          ([_, f]) => f.modelName === pluralessModel\n        )?.[0];\n      }\n      if (m2) {\n        return m2;\n      }\n    }\n    let m = schema[model] ? model : void 0;\n    if (!m) {\n      m = Object.entries(schema).find(([_, f]) => f.modelName === model)?.[0];\n    }\n    if (!m) {\n      debugLog(`Model \"${model}\" not found in schema`);\n      debugLog(`Schema:`, schema);\n      throw new Error(`Model \"${model}\" not found in schema`);\n    }\n    return m;\n  };\n  const getModelName = (model) => {\n    const defaultModelKey = getDefaultModelName(model);\n    const usePlural = config && config.usePlural;\n    const useCustomModelName = schema && schema[defaultModelKey] && schema[defaultModelKey].modelName !== model;\n    if (useCustomModelName) {\n      return usePlural ? `${schema[defaultModelKey].modelName}s` : schema[defaultModelKey].modelName;\n    }\n    return usePlural ? `${model}s` : model;\n  };\n  function getFieldName({\n    model: model_name,\n    field: field_name\n  }) {\n    const model = getDefaultModelName(model_name);\n    const field = getDefaultFieldName({ model, field: field_name });\n    return schema[model]?.fields[field]?.fieldName || field;\n  }\n  const debugLog = (...args) => {\n    if (config.debugLogs === true || typeof config.debugLogs === \"object\") {\n      if (typeof config.debugLogs === \"object\" && \"isRunningAdapterTests\" in config.debugLogs) {\n        if (config.debugLogs.isRunningAdapterTests) {\n          args.shift();\n          debugLogs.push(args);\n        }\n        return;\n      }\n      if (typeof config.debugLogs === \"object\" && config.debugLogs.logCondition && !config.debugLogs.logCondition?.()) {\n        return;\n      }\n      if (typeof args[0] === \"object\" && \"method\" in args[0]) {\n        const method = args.shift().method;\n        if (typeof config.debugLogs === \"object\") {\n          if (method === \"create\" && !config.debugLogs.create) {\n            return;\n          } else if (method === \"update\" && !config.debugLogs.update) {\n            return;\n          } else if (method === \"updateMany\" && !config.debugLogs.updateMany) {\n            return;\n          } else if (method === \"findOne\" && !config.debugLogs.findOne) {\n            return;\n          } else if (method === \"findMany\" && !config.debugLogs.findMany) {\n            return;\n          } else if (method === \"delete\" && !config.debugLogs.delete) {\n            return;\n          } else if (method === \"deleteMany\" && !config.debugLogs.deleteMany) {\n            return;\n          } else if (method === \"count\" && !config.debugLogs.count) {\n            return;\n          }\n        }\n        _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_2__.a.info(`[${config.adapterName}]`, ...args);\n      } else {\n        _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_2__.a.info(`[${config.adapterName}]`, ...args);\n      }\n    }\n  };\n  const idField = ({\n    customModelName,\n    forceAllowId\n  }) => {\n    const shouldGenerateId = !config.disableIdGeneration && !options.advanced?.database?.useNumberId && !forceAllowId;\n    const model = getDefaultModelName(customModelName ?? \"id\");\n    return {\n      type: options.advanced?.database?.useNumberId ? \"number\" : \"string\",\n      required: shouldGenerateId ? true : false,\n      ...shouldGenerateId ? {\n        defaultValue() {\n          if (config.disableIdGeneration) return void 0;\n          const useNumberId = options.advanced?.database?.useNumberId;\n          let generateId$1 = options.advanced?.database?.generateId;\n          if (options.advanced?.generateId !== void 0) {\n            _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_2__.a.warn(\n              \"Your Better Auth config includes advanced.generateId which is deprecated. Please use advanced.database.generateId instead. This will be removed in future releases.\"\n            );\n            generateId$1 = options.advanced?.generateId;\n          }\n          if (generateId$1 === false || useNumberId) return void 0;\n          if (generateId$1) {\n            return generateId$1({\n              model\n            });\n          }\n          if (config.customIdGenerator) {\n            return config.customIdGenerator({ model });\n          }\n          return (0,_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_2__.g)();\n        }\n      } : {}\n    };\n  };\n  const getFieldAttributes = ({\n    model,\n    field\n  }) => {\n    const defaultModelName = getDefaultModelName(model);\n    const defaultFieldName = getDefaultFieldName({\n      field,\n      model\n    });\n    const fields = schema[defaultModelName].fields;\n    fields.id = idField({ customModelName: defaultModelName });\n    return fields[defaultFieldName];\n  };\n  const adapterInstance = adapter({\n    options,\n    schema,\n    debugLog,\n    getFieldName,\n    getModelName,\n    getDefaultModelName,\n    getDefaultFieldName,\n    getFieldAttributes\n  });\n  const transformInput = async (data, unsafe_model, action, forceAllowId) => {\n    const transformedData = {};\n    const fields = schema[unsafe_model].fields;\n    const newMappedKeys = config.mapKeysTransformInput ?? {};\n    if (!config.disableIdGeneration && !options.advanced?.database?.useNumberId) {\n      fields.id = idField({\n        customModelName: unsafe_model,\n        forceAllowId: forceAllowId && \"id\" in data\n      });\n    }\n    for (const field in fields) {\n      const value = data[field];\n      const fieldAttributes = fields[field];\n      let newFieldName = newMappedKeys[field] || fields[field].fieldName || field;\n      if (value === void 0 && (!fieldAttributes.defaultValue && !fieldAttributes.transform?.input || action === \"update\")) {\n        continue;\n      }\n      let newValue = withApplyDefault(value, fieldAttributes, action);\n      if (fieldAttributes.transform?.input) {\n        newValue = await fieldAttributes.transform.input(newValue);\n      }\n      if (fieldAttributes.references?.field === \"id\" && options.advanced?.database?.useNumberId) {\n        if (Array.isArray(newValue)) {\n          newValue = newValue.map(Number);\n        } else {\n          newValue = Number(newValue);\n        }\n      } else if (config.supportsJSON === false && typeof newValue === \"object\" && //@ts-expect-error -Future proofing\n      fieldAttributes.type === \"json\") {\n        newValue = JSON.stringify(newValue);\n      } else if (config.supportsDates === false && newValue instanceof Date && fieldAttributes.type === \"date\") {\n        newValue = newValue.toISOString();\n      } else if (config.supportsBooleans === false && typeof newValue === \"boolean\") {\n        newValue = newValue ? 1 : 0;\n      }\n      if (config.customTransformInput) {\n        newValue = config.customTransformInput({\n          data: newValue,\n          action,\n          field: newFieldName,\n          fieldAttributes,\n          model: unsafe_model,\n          schema,\n          options\n        });\n      }\n      transformedData[newFieldName] = newValue;\n    }\n    return transformedData;\n  };\n  const transformOutput = async (data, unsafe_model, select = []) => {\n    if (!data) return null;\n    const newMappedKeys = config.mapKeysTransformOutput ?? {};\n    const transformedData = {};\n    const tableSchema = schema[unsafe_model].fields;\n    const idKey = Object.entries(newMappedKeys).find(\n      ([_, v]) => v === \"id\"\n    )?.[0];\n    tableSchema[idKey ?? \"id\"] = {\n      type: options.advanced?.database?.useNumberId ? \"number\" : \"string\"\n    };\n    for (const key in tableSchema) {\n      if (select.length && !select.includes(key)) {\n        continue;\n      }\n      const field = tableSchema[key];\n      if (field) {\n        const originalKey = field.fieldName || key;\n        let newValue = data[Object.entries(newMappedKeys).find(\n          ([_, v]) => v === originalKey\n        )?.[0] || originalKey];\n        if (field.transform?.output) {\n          newValue = await field.transform.output(newValue);\n        }\n        let newFieldName = newMappedKeys[key] || key;\n        if (originalKey === \"id\" || field.references?.field === \"id\") {\n          if (typeof newValue !== \"undefined\") newValue = String(newValue);\n        } else if (config.supportsJSON === false && typeof newValue === \"string\" && //@ts-expect-error - Future proofing\n        field.type === \"json\") {\n          newValue = (0,_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_0__.s)(newValue);\n        } else if (config.supportsDates === false && typeof newValue === \"string\" && field.type === \"date\") {\n          newValue = new Date(newValue);\n        } else if (config.supportsBooleans === false && typeof newValue === \"number\" && field.type === \"boolean\") {\n          newValue = newValue === 1;\n        }\n        if (config.customTransformOutput) {\n          newValue = config.customTransformOutput({\n            data: newValue,\n            field: newFieldName,\n            fieldAttributes: field,\n            select,\n            model: unsafe_model,\n            schema,\n            options\n          });\n        }\n        transformedData[newFieldName] = newValue;\n      }\n    }\n    return transformedData;\n  };\n  const transformWhereClause = ({\n    model,\n    where\n  }) => {\n    if (!where) return void 0;\n    const newMappedKeys = config.mapKeysTransformInput ?? {};\n    return where.map((w) => {\n      const {\n        field: unsafe_field,\n        value,\n        operator = \"eq\",\n        connector = \"AND\"\n      } = w;\n      if (operator === \"in\") {\n        if (!Array.isArray(value)) {\n          throw new Error(\"Value must be an array\");\n        }\n      }\n      const defaultModelName = getDefaultModelName(model);\n      const defaultFieldName = getDefaultFieldName({\n        field: unsafe_field,\n        model\n      });\n      const fieldName = newMappedKeys[defaultFieldName] || getFieldName({\n        field: defaultFieldName,\n        model: defaultModelName\n      });\n      const fieldAttr = getFieldAttributes({\n        field: defaultFieldName,\n        model: defaultModelName\n      });\n      if (defaultFieldName === \"id\" || fieldAttr.references?.field === \"id\") {\n        if (options.advanced?.database?.useNumberId) {\n          if (Array.isArray(value)) {\n            return {\n              operator,\n              connector,\n              field: fieldName,\n              value: value.map(Number)\n            };\n          }\n          return {\n            operator,\n            connector,\n            field: fieldName,\n            value: Number(value)\n          };\n        }\n      }\n      return {\n        operator,\n        connector,\n        field: fieldName,\n        value\n      };\n    });\n  };\n  return {\n    create: async ({\n      data: unsafeData,\n      model: unsafeModel,\n      select,\n      forceAllowId = false\n    }) => {\n      transactionId++;\n      let thisTransactionId = transactionId;\n      const model = getModelName(unsafeModel);\n      if (\"id\" in unsafeData && !forceAllowId) {\n        _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_2__.a.warn(\n          `[${config.adapterName}] - You are trying to create a record with an id. This is not allowed as we handle id generation for you, unless you pass in the \\`forceAllowId\\` parameter. The id will be ignored.`\n        );\n        const err = new Error();\n        const stack = err.stack?.split(\"\\n\").filter((_, i) => i !== 1).join(\"\\n\").replace(\"Error:\", \"Create method with `id` being called at:\");\n        console.log(stack);\n        unsafeData.id = void 0;\n      }\n      debugLog(\n        { method: \"create\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(1, 4)}`,\n        `${formatMethod(\"create\")} ${formatAction(\"Unsafe Input\")}:`,\n        { model, data: unsafeData }\n      );\n      const data = await transformInput(\n        unsafeData,\n        unsafeModel,\n        \"create\",\n        forceAllowId\n      );\n      debugLog(\n        { method: \"create\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(2, 4)}`,\n        `${formatMethod(\"create\")} ${formatAction(\"Parsed Input\")}:`,\n        { model, data }\n      );\n      const res = await adapterInstance.create({ data, model });\n      debugLog(\n        { method: \"create\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(3, 4)}`,\n        `${formatMethod(\"create\")} ${formatAction(\"DB Result\")}:`,\n        { model, res }\n      );\n      const transformed = await transformOutput(res, unsafeModel, select);\n      debugLog(\n        { method: \"create\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(4, 4)}`,\n        `${formatMethod(\"create\")} ${formatAction(\"Parsed Result\")}:`,\n        { model, data: transformed }\n      );\n      return transformed;\n    },\n    update: async ({\n      model: unsafeModel,\n      where: unsafeWhere,\n      update: unsafeData\n    }) => {\n      transactionId++;\n      let thisTransactionId = transactionId;\n      const model = getModelName(unsafeModel);\n      const where = transformWhereClause({\n        model: unsafeModel,\n        where: unsafeWhere\n      });\n      debugLog(\n        { method: \"update\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(1, 4)}`,\n        `${formatMethod(\"update\")} ${formatAction(\"Unsafe Input\")}:`,\n        { model, data: unsafeData }\n      );\n      const data = await transformInput(\n        unsafeData,\n        unsafeModel,\n        \"update\"\n      );\n      debugLog(\n        { method: \"update\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(2, 4)}`,\n        `${formatMethod(\"update\")} ${formatAction(\"Parsed Input\")}:`,\n        { model, data }\n      );\n      const res = await adapterInstance.update({\n        model,\n        where,\n        update: data\n      });\n      debugLog(\n        { method: \"update\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(3, 4)}`,\n        `${formatMethod(\"update\")} ${formatAction(\"DB Result\")}:`,\n        { model, data: res }\n      );\n      const transformed = await transformOutput(res, unsafeModel);\n      debugLog(\n        { method: \"update\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(4, 4)}`,\n        `${formatMethod(\"update\")} ${formatAction(\"Parsed Result\")}:`,\n        { model, data: transformed }\n      );\n      return transformed;\n    },\n    updateMany: async ({\n      model: unsafeModel,\n      where: unsafeWhere,\n      update: unsafeData\n    }) => {\n      transactionId++;\n      let thisTransactionId = transactionId;\n      const model = getModelName(unsafeModel);\n      const where = transformWhereClause({\n        model: unsafeModel,\n        where: unsafeWhere\n      });\n      debugLog(\n        { method: \"updateMany\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(1, 4)}`,\n        `${formatMethod(\"updateMany\")} ${formatAction(\"Unsafe Input\")}:`,\n        { model, data: unsafeData }\n      );\n      const data = await transformInput(unsafeData, unsafeModel, \"update\");\n      debugLog(\n        { method: \"updateMany\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(2, 4)}`,\n        `${formatMethod(\"updateMany\")} ${formatAction(\"Parsed Input\")}:`,\n        { model, data }\n      );\n      const updatedCount = await adapterInstance.updateMany({\n        model,\n        where,\n        update: data\n      });\n      debugLog(\n        { method: \"updateMany\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(3, 4)}`,\n        `${formatMethod(\"updateMany\")} ${formatAction(\"DB Result\")}:`,\n        { model, data: updatedCount }\n      );\n      debugLog(\n        { method: \"updateMany\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(4, 4)}`,\n        `${formatMethod(\"updateMany\")} ${formatAction(\"Parsed Result\")}:`,\n        { model, data: updatedCount }\n      );\n      return updatedCount;\n    },\n    findOne: async ({\n      model: unsafeModel,\n      where: unsafeWhere,\n      select\n    }) => {\n      transactionId++;\n      let thisTransactionId = transactionId;\n      const model = getModelName(unsafeModel);\n      const where = transformWhereClause({\n        model: unsafeModel,\n        where: unsafeWhere\n      });\n      debugLog(\n        { method: \"findOne\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(1, 3)}`,\n        `${formatMethod(\"findOne\")}:`,\n        { model, where, select }\n      );\n      const res = await adapterInstance.findOne({\n        model,\n        where,\n        select\n      });\n      debugLog(\n        { method: \"findOne\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(2, 3)}`,\n        `${formatMethod(\"findOne\")} ${formatAction(\"DB Result\")}:`,\n        { model, data: res }\n      );\n      const transformed = await transformOutput(\n        res,\n        unsafeModel,\n        select\n      );\n      debugLog(\n        { method: \"findOne\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(3, 3)}`,\n        `${formatMethod(\"findOne\")} ${formatAction(\"Parsed Result\")}:`,\n        { model, data: transformed }\n      );\n      return transformed;\n    },\n    findMany: async ({\n      model: unsafeModel,\n      where: unsafeWhere,\n      limit: unsafeLimit,\n      sortBy,\n      offset\n    }) => {\n      transactionId++;\n      let thisTransactionId = transactionId;\n      const limit = unsafeLimit ?? options.advanced?.database?.defaultFindManyLimit ?? 100;\n      const model = getModelName(unsafeModel);\n      const where = transformWhereClause({\n        model: unsafeModel,\n        where: unsafeWhere\n      });\n      debugLog(\n        { method: \"findMany\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(1, 3)}`,\n        `${formatMethod(\"findMany\")}:`,\n        { model, where, limit, sortBy, offset }\n      );\n      const res = await adapterInstance.findMany({\n        model,\n        where,\n        limit,\n        sortBy,\n        offset\n      });\n      debugLog(\n        { method: \"findMany\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(2, 3)}`,\n        `${formatMethod(\"findMany\")} ${formatAction(\"DB Result\")}:`,\n        { model, data: res }\n      );\n      const transformed = await Promise.all(\n        res.map(async (r) => await transformOutput(r, unsafeModel))\n      );\n      debugLog(\n        { method: \"findMany\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(3, 3)}`,\n        `${formatMethod(\"findMany\")} ${formatAction(\"Parsed Result\")}:`,\n        { model, data: transformed }\n      );\n      return transformed;\n    },\n    delete: async ({\n      model: unsafeModel,\n      where: unsafeWhere\n    }) => {\n      transactionId++;\n      let thisTransactionId = transactionId;\n      const model = getModelName(unsafeModel);\n      const where = transformWhereClause({\n        model: unsafeModel,\n        where: unsafeWhere\n      });\n      debugLog(\n        { method: \"delete\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(1, 2)}`,\n        `${formatMethod(\"delete\")}:`,\n        { model, where }\n      );\n      await adapterInstance.delete({\n        model,\n        where\n      });\n      debugLog(\n        { method: \"delete\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(2, 2)}`,\n        `${formatMethod(\"delete\")} ${formatAction(\"DB Result\")}:`,\n        { model }\n      );\n    },\n    deleteMany: async ({\n      model: unsafeModel,\n      where: unsafeWhere\n    }) => {\n      transactionId++;\n      let thisTransactionId = transactionId;\n      const model = getModelName(unsafeModel);\n      const where = transformWhereClause({\n        model: unsafeModel,\n        where: unsafeWhere\n      });\n      debugLog(\n        { method: \"deleteMany\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(1, 2)}`,\n        `${formatMethod(\"deleteMany\")} ${formatAction(\"DeleteMany\")}:`,\n        { model, where }\n      );\n      const res = await adapterInstance.deleteMany({\n        model,\n        where\n      });\n      debugLog(\n        { method: \"deleteMany\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(2, 2)}`,\n        `${formatMethod(\"deleteMany\")} ${formatAction(\"DB Result\")}:`,\n        { model, data: res }\n      );\n      return res;\n    },\n    count: async ({\n      model: unsafeModel,\n      where: unsafeWhere\n    }) => {\n      transactionId++;\n      let thisTransactionId = transactionId;\n      const model = getModelName(unsafeModel);\n      const where = transformWhereClause({\n        model: unsafeModel,\n        where: unsafeWhere\n      });\n      debugLog(\n        { method: \"count\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(1, 2)}`,\n        `${formatMethod(\"count\")}:`,\n        {\n          model,\n          where\n        }\n      );\n      const res = await adapterInstance.count({\n        model,\n        where\n      });\n      debugLog(\n        { method: \"count\" },\n        `${formatTransactionId(thisTransactionId)} ${formatStep(2, 2)}`,\n        `${formatMethod(\"count\")}:`,\n        {\n          model,\n          data: res\n        }\n      );\n      return res;\n    },\n    createSchema: adapterInstance.createSchema ? async (_, file) => {\n      const tables = (0,_better_auth_DORkW_Ge_mjs__WEBPACK_IMPORTED_MODULE_1__.g)(options);\n      if (options.secondaryStorage && !options.session?.storeSessionInDatabase) {\n        delete tables.session;\n      }\n      if (options.rateLimit && options.rateLimit.storage === \"database\" && // rate-limit will default to enabled in production,\n      // and given storage is database, it will try to use the rate-limit table,\n      // so we should make sure to generate rate-limit table schema\n      (typeof options.rateLimit.enabled === \"undefined\" || // and of course if they forcefully set to true, then they want rate-limit,\n      // thus we should also generate rate-limit table schema\n      options.rateLimit.enabled === true)) {\n        tables.ratelimit = {\n          modelName: options.rateLimit.modelName ?? \"ratelimit\",\n          fields: {\n            key: {\n              type: \"string\",\n              unique: true,\n              required: true,\n              fieldName: options.rateLimit.fields?.key ?? \"key\"\n            },\n            count: {\n              type: \"number\",\n              required: true,\n              fieldName: options.rateLimit.fields?.count ?? \"count\"\n            },\n            lastRequest: {\n              type: \"number\",\n              required: true,\n              bigint: true,\n              defaultValue: () => Date.now(),\n              fieldName: options.rateLimit.fields?.lastRequest ?? \"lastRequest\"\n            }\n          }\n        };\n      }\n      return adapterInstance.createSchema({ file, tables });\n    } : void 0,\n    options: {\n      adapterConfig: config,\n      ...adapterInstance.options ?? {}\n    },\n    id: config.adapterId,\n    // Secretly export values ONLY if this adapter has enabled adapter-test-debug-logs.\n    // This would then be used during our adapter-tests to help print debug logs if a test fails.\n    //@ts-expect-error - ^^\n    ...config.debugLogs?.isRunningAdapterTests ? {\n      adapterTestDebugLogs: {\n        resetDebugLogs() {\n          debugLogs = [];\n        },\n        printDebugLogs() {\n          const separator = `\\u2500`.repeat(80);\n          let log = debugLogs.reverse().map((log2) => {\n            log2[0] = `\n${log2[0]}`;\n            return [...log2, \"\\n\"];\n          }).reduce(\n            (prev, curr) => {\n              return [...curr, ...prev];\n            },\n            [`\n${separator}`]\n          );\n          console.log(...log);\n        }\n      }\n    } : {}\n  };\n};\nfunction formatTransactionId(transactionId2) {\n  return `${colors.fg.magenta}#${transactionId2}${colors.reset}`;\n}\nfunction formatStep(step, total) {\n  return `${colors.bg.black}${colors.fg.yellow}[${step}/${total}]${colors.reset}`;\n}\nfunction formatMethod(method) {\n  return `${colors.bright}${method}${colors.reset}`;\n}\nfunction formatAction(action) {\n  return `${colors.dim}(${action})${colors.reset}`;\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLmdCbDNGX3hhLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQWdFO0FBQ0E7QUFDVTtBQUMxRDtBQUNLO0FBQ1k7QUFDRjtBQUNEO0FBQ0k7QUFDQztBQUNyQjtBQUNnQjtBQUNGO0FBQ0k7QUFDSDtBQUNPOztBQUVwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxtQkFBbUI7QUFDN0I7QUFDQTtBQUNBLGlCQUFpQiw0REFBYTtBQUM5QjtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixPQUFPLHFCQUFxQixNQUFNO0FBQzFEO0FBQ0EsK0JBQStCLE9BQU8scUJBQXFCLE1BQU07QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLE1BQU07QUFDL0I7QUFDQSxnQ0FBZ0MsTUFBTTtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLGtDQUFrQztBQUM5RDtBQUNBLDBCQUEwQixNQUFNO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0Esd0NBQXdDLDBCQUEwQjtBQUNs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QTtBQUNBLFlBQVksZ0JBQWdCLEVBQUUsaUJBQWlCLEdBQUcsS0FBSyxHQUFHLE1BQU0sR0FBRyxhQUFhO0FBQ2hGO0FBQ0E7QUFDQSxZQUFZLGNBQWMsRUFBRSxPQUFPLEVBQUUsYUFBYTtBQUNsRDtBQUNBO0FBQ0EsWUFBWSxXQUFXLEdBQUcsT0FBTyxHQUFHLGFBQWE7QUFDakQ7O0FBRThCIiwic291cmNlcyI6WyIvVXNlcnMvbWlsYW4vRGVza3RvcC9BcHBzL2JldHRlci1hdXRoL25vZGVfbW9kdWxlcy9iZXR0ZXItYXV0aC9kaXN0L3NoYXJlZC9iZXR0ZXItYXV0aC5nQmwzRl94YS5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcyBhcyBzYWZlSlNPTlBhcnNlIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC50QjVlVTZFWS5tanMnO1xuaW1wb3J0IHsgZyBhcyBnZXRBdXRoVGFibGVzIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC5ET1JrV19HZS5tanMnO1xuaW1wb3J0IHsgYSBhcyBsb2dnZXIsIGcgYXMgZ2VuZXJhdGVJZCB9IGZyb20gJy4vYmV0dGVyLWF1dGguREJHZklEbmgubWpzJztcbmltcG9ydCAnem9kL3Y0JztcbmltcG9ydCAnYmV0dGVyLWNhbGwnO1xuaW1wb3J0ICdAYmV0dGVyLWF1dGgvdXRpbHMvaGFzaCc7XG5pbXBvcnQgJ0Bub2JsZS9jaXBoZXJzL2NoYWNoYSc7XG5pbXBvcnQgJ0Bub2JsZS9jaXBoZXJzL3V0aWxzJztcbmltcG9ydCAnQG5vYmxlL2NpcGhlcnMvd2ViY3J5cHRvJztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzL2Jhc2U2NCc7XG5pbXBvcnQgJ2pvc2UnO1xuaW1wb3J0ICdAbm9ibGUvaGFzaGVzL3NjcnlwdCc7XG5pbXBvcnQgJ0BiZXR0ZXItYXV0aC91dGlscyc7XG5pbXBvcnQgJ0BiZXR0ZXItYXV0aC91dGlscy9oZXgnO1xuaW1wb3J0ICdAbm9ibGUvaGFzaGVzL3V0aWxzJztcbmltcG9ydCAnLi9iZXR0ZXItYXV0aC5CNFFveGRnYy5tanMnO1xuXG5mdW5jdGlvbiB3aXRoQXBwbHlEZWZhdWx0KHZhbHVlLCBmaWVsZCwgYWN0aW9uKSB7XG4gIGlmIChhY3Rpb24gPT09IFwidXBkYXRlXCIpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cbiAgaWYgKHZhbHVlID09PSB2b2lkIDAgfHwgdmFsdWUgPT09IG51bGwpIHtcbiAgICBpZiAoZmllbGQuZGVmYXVsdFZhbHVlICE9PSB2b2lkIDApIHtcbiAgICAgIGlmICh0eXBlb2YgZmllbGQuZGVmYXVsdFZhbHVlID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgcmV0dXJuIGZpZWxkLmRlZmF1bHRWYWx1ZSgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZpZWxkLmRlZmF1bHRWYWx1ZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHZhbHVlO1xufVxuXG5sZXQgZGVidWdMb2dzID0gW107XG5sZXQgdHJhbnNhY3Rpb25JZCA9IC0xO1xuY29uc3QgY29sb3JzID0ge1xuICByZXNldDogXCJcXHgxQlswbVwiLFxuICBicmlnaHQ6IFwiXFx4MUJbMW1cIixcbiAgZGltOiBcIlxceDFCWzJtXCIsXG4gIGZnOiB7XG4gICAgeWVsbG93OiBcIlxceDFCWzMzbVwiLFxuICAgIG1hZ2VudGE6IFwiXFx4MUJbMzVtXCJ9LFxuICBiZzoge1xuICAgIGJsYWNrOiBcIlxceDFCWzQwbVwifVxufTtcbmNvbnN0IGNyZWF0ZUFkYXB0ZXIgPSAoe1xuICBhZGFwdGVyLFxuICBjb25maWc6IGNmZ1xufSkgPT4gKG9wdGlvbnMpID0+IHtcbiAgY29uc3QgY29uZmlnID0ge1xuICAgIC4uLmNmZyxcbiAgICBzdXBwb3J0c0Jvb2xlYW5zOiBjZmcuc3VwcG9ydHNCb29sZWFucyA/PyB0cnVlLFxuICAgIHN1cHBvcnRzRGF0ZXM6IGNmZy5zdXBwb3J0c0RhdGVzID8/IHRydWUsXG4gICAgc3VwcG9ydHNKU09OOiBjZmcuc3VwcG9ydHNKU09OID8/IGZhbHNlLFxuICAgIGFkYXB0ZXJOYW1lOiBjZmcuYWRhcHRlck5hbWUgPz8gY2ZnLmFkYXB0ZXJJZCxcbiAgICBzdXBwb3J0c051bWVyaWNJZHM6IGNmZy5zdXBwb3J0c051bWVyaWNJZHMgPz8gdHJ1ZVxuICB9O1xuICBpZiAob3B0aW9ucy5hZHZhbmNlZD8uZGF0YWJhc2U/LnVzZU51bWJlcklkID09PSB0cnVlICYmIGNvbmZpZy5zdXBwb3J0c051bWVyaWNJZHMgPT09IGZhbHNlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgYFske2NvbmZpZy5hZGFwdGVyTmFtZX1dIFlvdXIgZGF0YWJhc2Ugb3IgZGF0YWJhc2UgYWRhcHRlciBkb2VzIG5vdCBzdXBwb3J0IG51bWVyaWMgaWRzLiBQbGVhc2UgZGlzYWJsZSBcInVzZU51bWJlcklkXCIgaW4geW91ciBjb25maWcuYFxuICAgICk7XG4gIH1cbiAgY29uc3Qgc2NoZW1hID0gZ2V0QXV0aFRhYmxlcyhvcHRpb25zKTtcbiAgY29uc3QgZ2V0RGVmYXVsdEZpZWxkTmFtZSA9ICh7XG4gICAgZmllbGQsXG4gICAgbW9kZWw6IHVuc2FmZV9tb2RlbFxuICB9KSA9PiB7XG4gICAgaWYgKGZpZWxkID09PSBcImlkXCIgfHwgZmllbGQgPT09IFwiX2lkXCIpIHtcbiAgICAgIHJldHVybiBcImlkXCI7XG4gICAgfVxuICAgIGNvbnN0IG1vZGVsID0gZ2V0RGVmYXVsdE1vZGVsTmFtZSh1bnNhZmVfbW9kZWwpO1xuICAgIGxldCBmID0gc2NoZW1hW21vZGVsXT8uZmllbGRzW2ZpZWxkXTtcbiAgICBpZiAoIWYpIHtcbiAgICAgIGYgPSBPYmplY3QudmFsdWVzKHNjaGVtYVttb2RlbF0/LmZpZWxkcykuZmluZChcbiAgICAgICAgKGYyKSA9PiBmMi5maWVsZE5hbWUgPT09IGZpZWxkXG4gICAgICApO1xuICAgIH1cbiAgICBpZiAoIWYpIHtcbiAgICAgIGRlYnVnTG9nKGBGaWVsZCAke2ZpZWxkfSBub3QgZm91bmQgaW4gbW9kZWwgJHttb2RlbH1gKTtcbiAgICAgIGRlYnVnTG9nKGBTY2hlbWE6YCwgc2NoZW1hKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRmllbGQgJHtmaWVsZH0gbm90IGZvdW5kIGluIG1vZGVsICR7bW9kZWx9YCk7XG4gICAgfVxuICAgIHJldHVybiBmaWVsZDtcbiAgfTtcbiAgY29uc3QgZ2V0RGVmYXVsdE1vZGVsTmFtZSA9IChtb2RlbCkgPT4ge1xuICAgIGlmIChjb25maWcudXNlUGx1cmFsICYmIG1vZGVsLmNoYXJBdChtb2RlbC5sZW5ndGggLSAxKSA9PT0gXCJzXCIpIHtcbiAgICAgIGxldCBwbHVyYWxlc3NNb2RlbCA9IG1vZGVsLnNsaWNlKDAsIC0xKTtcbiAgICAgIGxldCBtMiA9IHNjaGVtYVtwbHVyYWxlc3NNb2RlbF0gPyBwbHVyYWxlc3NNb2RlbCA6IHZvaWQgMDtcbiAgICAgIGlmICghbTIpIHtcbiAgICAgICAgbTIgPSBPYmplY3QuZW50cmllcyhzY2hlbWEpLmZpbmQoXG4gICAgICAgICAgKFtfLCBmXSkgPT4gZi5tb2RlbE5hbWUgPT09IHBsdXJhbGVzc01vZGVsXG4gICAgICAgICk/LlswXTtcbiAgICAgIH1cbiAgICAgIGlmIChtMikge1xuICAgICAgICByZXR1cm4gbTI7XG4gICAgICB9XG4gICAgfVxuICAgIGxldCBtID0gc2NoZW1hW21vZGVsXSA/IG1vZGVsIDogdm9pZCAwO1xuICAgIGlmICghbSkge1xuICAgICAgbSA9IE9iamVjdC5lbnRyaWVzKHNjaGVtYSkuZmluZCgoW18sIGZdKSA9PiBmLm1vZGVsTmFtZSA9PT0gbW9kZWwpPy5bMF07XG4gICAgfVxuICAgIGlmICghbSkge1xuICAgICAgZGVidWdMb2coYE1vZGVsIFwiJHttb2RlbH1cIiBub3QgZm91bmQgaW4gc2NoZW1hYCk7XG4gICAgICBkZWJ1Z0xvZyhgU2NoZW1hOmAsIHNjaGVtYSk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE1vZGVsIFwiJHttb2RlbH1cIiBub3QgZm91bmQgaW4gc2NoZW1hYCk7XG4gICAgfVxuICAgIHJldHVybiBtO1xuICB9O1xuICBjb25zdCBnZXRNb2RlbE5hbWUgPSAobW9kZWwpID0+IHtcbiAgICBjb25zdCBkZWZhdWx0TW9kZWxLZXkgPSBnZXREZWZhdWx0TW9kZWxOYW1lKG1vZGVsKTtcbiAgICBjb25zdCB1c2VQbHVyYWwgPSBjb25maWcgJiYgY29uZmlnLnVzZVBsdXJhbDtcbiAgICBjb25zdCB1c2VDdXN0b21Nb2RlbE5hbWUgPSBzY2hlbWEgJiYgc2NoZW1hW2RlZmF1bHRNb2RlbEtleV0gJiYgc2NoZW1hW2RlZmF1bHRNb2RlbEtleV0ubW9kZWxOYW1lICE9PSBtb2RlbDtcbiAgICBpZiAodXNlQ3VzdG9tTW9kZWxOYW1lKSB7XG4gICAgICByZXR1cm4gdXNlUGx1cmFsID8gYCR7c2NoZW1hW2RlZmF1bHRNb2RlbEtleV0ubW9kZWxOYW1lfXNgIDogc2NoZW1hW2RlZmF1bHRNb2RlbEtleV0ubW9kZWxOYW1lO1xuICAgIH1cbiAgICByZXR1cm4gdXNlUGx1cmFsID8gYCR7bW9kZWx9c2AgOiBtb2RlbDtcbiAgfTtcbiAgZnVuY3Rpb24gZ2V0RmllbGROYW1lKHtcbiAgICBtb2RlbDogbW9kZWxfbmFtZSxcbiAgICBmaWVsZDogZmllbGRfbmFtZVxuICB9KSB7XG4gICAgY29uc3QgbW9kZWwgPSBnZXREZWZhdWx0TW9kZWxOYW1lKG1vZGVsX25hbWUpO1xuICAgIGNvbnN0IGZpZWxkID0gZ2V0RGVmYXVsdEZpZWxkTmFtZSh7IG1vZGVsLCBmaWVsZDogZmllbGRfbmFtZSB9KTtcbiAgICByZXR1cm4gc2NoZW1hW21vZGVsXT8uZmllbGRzW2ZpZWxkXT8uZmllbGROYW1lIHx8IGZpZWxkO1xuICB9XG4gIGNvbnN0IGRlYnVnTG9nID0gKC4uLmFyZ3MpID0+IHtcbiAgICBpZiAoY29uZmlnLmRlYnVnTG9ncyA9PT0gdHJ1ZSB8fCB0eXBlb2YgY29uZmlnLmRlYnVnTG9ncyA9PT0gXCJvYmplY3RcIikge1xuICAgICAgaWYgKHR5cGVvZiBjb25maWcuZGVidWdMb2dzID09PSBcIm9iamVjdFwiICYmIFwiaXNSdW5uaW5nQWRhcHRlclRlc3RzXCIgaW4gY29uZmlnLmRlYnVnTG9ncykge1xuICAgICAgICBpZiAoY29uZmlnLmRlYnVnTG9ncy5pc1J1bm5pbmdBZGFwdGVyVGVzdHMpIHtcbiAgICAgICAgICBhcmdzLnNoaWZ0KCk7XG4gICAgICAgICAgZGVidWdMb2dzLnB1c2goYXJncyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGVvZiBjb25maWcuZGVidWdMb2dzID09PSBcIm9iamVjdFwiICYmIGNvbmZpZy5kZWJ1Z0xvZ3MubG9nQ29uZGl0aW9uICYmICFjb25maWcuZGVidWdMb2dzLmxvZ0NvbmRpdGlvbj8uKCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSBcIm9iamVjdFwiICYmIFwibWV0aG9kXCIgaW4gYXJnc1swXSkge1xuICAgICAgICBjb25zdCBtZXRob2QgPSBhcmdzLnNoaWZ0KCkubWV0aG9kO1xuICAgICAgICBpZiAodHlwZW9mIGNvbmZpZy5kZWJ1Z0xvZ3MgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgICBpZiAobWV0aG9kID09PSBcImNyZWF0ZVwiICYmICFjb25maWcuZGVidWdMb2dzLmNyZWF0ZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0gZWxzZSBpZiAobWV0aG9kID09PSBcInVwZGF0ZVwiICYmICFjb25maWcuZGVidWdMb2dzLnVwZGF0ZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0gZWxzZSBpZiAobWV0aG9kID09PSBcInVwZGF0ZU1hbnlcIiAmJiAhY29uZmlnLmRlYnVnTG9ncy51cGRhdGVNYW55KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfSBlbHNlIGlmIChtZXRob2QgPT09IFwiZmluZE9uZVwiICYmICFjb25maWcuZGVidWdMb2dzLmZpbmRPbmUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9IGVsc2UgaWYgKG1ldGhvZCA9PT0gXCJmaW5kTWFueVwiICYmICFjb25maWcuZGVidWdMb2dzLmZpbmRNYW55KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfSBlbHNlIGlmIChtZXRob2QgPT09IFwiZGVsZXRlXCIgJiYgIWNvbmZpZy5kZWJ1Z0xvZ3MuZGVsZXRlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfSBlbHNlIGlmIChtZXRob2QgPT09IFwiZGVsZXRlTWFueVwiICYmICFjb25maWcuZGVidWdMb2dzLmRlbGV0ZU1hbnkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9IGVsc2UgaWYgKG1ldGhvZCA9PT0gXCJjb3VudFwiICYmICFjb25maWcuZGVidWdMb2dzLmNvdW50KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGxvZ2dlci5pbmZvKGBbJHtjb25maWcuYWRhcHRlck5hbWV9XWAsIC4uLmFyZ3MpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nZ2VyLmluZm8oYFske2NvbmZpZy5hZGFwdGVyTmFtZX1dYCwgLi4uYXJncyk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCBpZEZpZWxkID0gKHtcbiAgICBjdXN0b21Nb2RlbE5hbWUsXG4gICAgZm9yY2VBbGxvd0lkXG4gIH0pID0+IHtcbiAgICBjb25zdCBzaG91bGRHZW5lcmF0ZUlkID0gIWNvbmZpZy5kaXNhYmxlSWRHZW5lcmF0aW9uICYmICFvcHRpb25zLmFkdmFuY2VkPy5kYXRhYmFzZT8udXNlTnVtYmVySWQgJiYgIWZvcmNlQWxsb3dJZDtcbiAgICBjb25zdCBtb2RlbCA9IGdldERlZmF1bHRNb2RlbE5hbWUoY3VzdG9tTW9kZWxOYW1lID8/IFwiaWRcIik7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IG9wdGlvbnMuYWR2YW5jZWQ/LmRhdGFiYXNlPy51c2VOdW1iZXJJZCA/IFwibnVtYmVyXCIgOiBcInN0cmluZ1wiLFxuICAgICAgcmVxdWlyZWQ6IHNob3VsZEdlbmVyYXRlSWQgPyB0cnVlIDogZmFsc2UsXG4gICAgICAuLi5zaG91bGRHZW5lcmF0ZUlkID8ge1xuICAgICAgICBkZWZhdWx0VmFsdWUoKSB7XG4gICAgICAgICAgaWYgKGNvbmZpZy5kaXNhYmxlSWRHZW5lcmF0aW9uKSByZXR1cm4gdm9pZCAwO1xuICAgICAgICAgIGNvbnN0IHVzZU51bWJlcklkID0gb3B0aW9ucy5hZHZhbmNlZD8uZGF0YWJhc2U/LnVzZU51bWJlcklkO1xuICAgICAgICAgIGxldCBnZW5lcmF0ZUlkJDEgPSBvcHRpb25zLmFkdmFuY2VkPy5kYXRhYmFzZT8uZ2VuZXJhdGVJZDtcbiAgICAgICAgICBpZiAob3B0aW9ucy5hZHZhbmNlZD8uZ2VuZXJhdGVJZCAhPT0gdm9pZCAwKSB7XG4gICAgICAgICAgICBsb2dnZXIud2FybihcbiAgICAgICAgICAgICAgXCJZb3VyIEJldHRlciBBdXRoIGNvbmZpZyBpbmNsdWRlcyBhZHZhbmNlZC5nZW5lcmF0ZUlkIHdoaWNoIGlzIGRlcHJlY2F0ZWQuIFBsZWFzZSB1c2UgYWR2YW5jZWQuZGF0YWJhc2UuZ2VuZXJhdGVJZCBpbnN0ZWFkLiBUaGlzIHdpbGwgYmUgcmVtb3ZlZCBpbiBmdXR1cmUgcmVsZWFzZXMuXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBnZW5lcmF0ZUlkJDEgPSBvcHRpb25zLmFkdmFuY2VkPy5nZW5lcmF0ZUlkO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZ2VuZXJhdGVJZCQxID09PSBmYWxzZSB8fCB1c2VOdW1iZXJJZCkgcmV0dXJuIHZvaWQgMDtcbiAgICAgICAgICBpZiAoZ2VuZXJhdGVJZCQxKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2VuZXJhdGVJZCQxKHtcbiAgICAgICAgICAgICAgbW9kZWxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoY29uZmlnLmN1c3RvbUlkR2VuZXJhdG9yKSB7XG4gICAgICAgICAgICByZXR1cm4gY29uZmlnLmN1c3RvbUlkR2VuZXJhdG9yKHsgbW9kZWwgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBnZW5lcmF0ZUlkKCk7XG4gICAgICAgIH1cbiAgICAgIH0gOiB7fVxuICAgIH07XG4gIH07XG4gIGNvbnN0IGdldEZpZWxkQXR0cmlidXRlcyA9ICh7XG4gICAgbW9kZWwsXG4gICAgZmllbGRcbiAgfSkgPT4ge1xuICAgIGNvbnN0IGRlZmF1bHRNb2RlbE5hbWUgPSBnZXREZWZhdWx0TW9kZWxOYW1lKG1vZGVsKTtcbiAgICBjb25zdCBkZWZhdWx0RmllbGROYW1lID0gZ2V0RGVmYXVsdEZpZWxkTmFtZSh7XG4gICAgICBmaWVsZCxcbiAgICAgIG1vZGVsXG4gICAgfSk7XG4gICAgY29uc3QgZmllbGRzID0gc2NoZW1hW2RlZmF1bHRNb2RlbE5hbWVdLmZpZWxkcztcbiAgICBmaWVsZHMuaWQgPSBpZEZpZWxkKHsgY3VzdG9tTW9kZWxOYW1lOiBkZWZhdWx0TW9kZWxOYW1lIH0pO1xuICAgIHJldHVybiBmaWVsZHNbZGVmYXVsdEZpZWxkTmFtZV07XG4gIH07XG4gIGNvbnN0IGFkYXB0ZXJJbnN0YW5jZSA9IGFkYXB0ZXIoe1xuICAgIG9wdGlvbnMsXG4gICAgc2NoZW1hLFxuICAgIGRlYnVnTG9nLFxuICAgIGdldEZpZWxkTmFtZSxcbiAgICBnZXRNb2RlbE5hbWUsXG4gICAgZ2V0RGVmYXVsdE1vZGVsTmFtZSxcbiAgICBnZXREZWZhdWx0RmllbGROYW1lLFxuICAgIGdldEZpZWxkQXR0cmlidXRlc1xuICB9KTtcbiAgY29uc3QgdHJhbnNmb3JtSW5wdXQgPSBhc3luYyAoZGF0YSwgdW5zYWZlX21vZGVsLCBhY3Rpb24sIGZvcmNlQWxsb3dJZCkgPT4ge1xuICAgIGNvbnN0IHRyYW5zZm9ybWVkRGF0YSA9IHt9O1xuICAgIGNvbnN0IGZpZWxkcyA9IHNjaGVtYVt1bnNhZmVfbW9kZWxdLmZpZWxkcztcbiAgICBjb25zdCBuZXdNYXBwZWRLZXlzID0gY29uZmlnLm1hcEtleXNUcmFuc2Zvcm1JbnB1dCA/PyB7fTtcbiAgICBpZiAoIWNvbmZpZy5kaXNhYmxlSWRHZW5lcmF0aW9uICYmICFvcHRpb25zLmFkdmFuY2VkPy5kYXRhYmFzZT8udXNlTnVtYmVySWQpIHtcbiAgICAgIGZpZWxkcy5pZCA9IGlkRmllbGQoe1xuICAgICAgICBjdXN0b21Nb2RlbE5hbWU6IHVuc2FmZV9tb2RlbCxcbiAgICAgICAgZm9yY2VBbGxvd0lkOiBmb3JjZUFsbG93SWQgJiYgXCJpZFwiIGluIGRhdGFcbiAgICAgIH0pO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGZpZWxkIGluIGZpZWxkcykge1xuICAgICAgY29uc3QgdmFsdWUgPSBkYXRhW2ZpZWxkXTtcbiAgICAgIGNvbnN0IGZpZWxkQXR0cmlidXRlcyA9IGZpZWxkc1tmaWVsZF07XG4gICAgICBsZXQgbmV3RmllbGROYW1lID0gbmV3TWFwcGVkS2V5c1tmaWVsZF0gfHwgZmllbGRzW2ZpZWxkXS5maWVsZE5hbWUgfHwgZmllbGQ7XG4gICAgICBpZiAodmFsdWUgPT09IHZvaWQgMCAmJiAoIWZpZWxkQXR0cmlidXRlcy5kZWZhdWx0VmFsdWUgJiYgIWZpZWxkQXR0cmlidXRlcy50cmFuc2Zvcm0/LmlucHV0IHx8IGFjdGlvbiA9PT0gXCJ1cGRhdGVcIikpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBsZXQgbmV3VmFsdWUgPSB3aXRoQXBwbHlEZWZhdWx0KHZhbHVlLCBmaWVsZEF0dHJpYnV0ZXMsIGFjdGlvbik7XG4gICAgICBpZiAoZmllbGRBdHRyaWJ1dGVzLnRyYW5zZm9ybT8uaW5wdXQpIHtcbiAgICAgICAgbmV3VmFsdWUgPSBhd2FpdCBmaWVsZEF0dHJpYnV0ZXMudHJhbnNmb3JtLmlucHV0KG5ld1ZhbHVlKTtcbiAgICAgIH1cbiAgICAgIGlmIChmaWVsZEF0dHJpYnV0ZXMucmVmZXJlbmNlcz8uZmllbGQgPT09IFwiaWRcIiAmJiBvcHRpb25zLmFkdmFuY2VkPy5kYXRhYmFzZT8udXNlTnVtYmVySWQpIHtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobmV3VmFsdWUpKSB7XG4gICAgICAgICAgbmV3VmFsdWUgPSBuZXdWYWx1ZS5tYXAoTnVtYmVyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBuZXdWYWx1ZSA9IE51bWJlcihuZXdWYWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoY29uZmlnLnN1cHBvcnRzSlNPTiA9PT0gZmFsc2UgJiYgdHlwZW9mIG5ld1ZhbHVlID09PSBcIm9iamVjdFwiICYmIC8vQHRzLWV4cGVjdC1lcnJvciAtRnV0dXJlIHByb29maW5nXG4gICAgICBmaWVsZEF0dHJpYnV0ZXMudHlwZSA9PT0gXCJqc29uXCIpIHtcbiAgICAgICAgbmV3VmFsdWUgPSBKU09OLnN0cmluZ2lmeShuZXdWYWx1ZSk7XG4gICAgICB9IGVsc2UgaWYgKGNvbmZpZy5zdXBwb3J0c0RhdGVzID09PSBmYWxzZSAmJiBuZXdWYWx1ZSBpbnN0YW5jZW9mIERhdGUgJiYgZmllbGRBdHRyaWJ1dGVzLnR5cGUgPT09IFwiZGF0ZVwiKSB7XG4gICAgICAgIG5ld1ZhbHVlID0gbmV3VmFsdWUudG9JU09TdHJpbmcoKTtcbiAgICAgIH0gZWxzZSBpZiAoY29uZmlnLnN1cHBvcnRzQm9vbGVhbnMgPT09IGZhbHNlICYmIHR5cGVvZiBuZXdWYWx1ZSA9PT0gXCJib29sZWFuXCIpIHtcbiAgICAgICAgbmV3VmFsdWUgPSBuZXdWYWx1ZSA/IDEgOiAwO1xuICAgICAgfVxuICAgICAgaWYgKGNvbmZpZy5jdXN0b21UcmFuc2Zvcm1JbnB1dCkge1xuICAgICAgICBuZXdWYWx1ZSA9IGNvbmZpZy5jdXN0b21UcmFuc2Zvcm1JbnB1dCh7XG4gICAgICAgICAgZGF0YTogbmV3VmFsdWUsXG4gICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgIGZpZWxkOiBuZXdGaWVsZE5hbWUsXG4gICAgICAgICAgZmllbGRBdHRyaWJ1dGVzLFxuICAgICAgICAgIG1vZGVsOiB1bnNhZmVfbW9kZWwsXG4gICAgICAgICAgc2NoZW1hLFxuICAgICAgICAgIG9wdGlvbnNcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICB0cmFuc2Zvcm1lZERhdGFbbmV3RmllbGROYW1lXSA9IG5ld1ZhbHVlO1xuICAgIH1cbiAgICByZXR1cm4gdHJhbnNmb3JtZWREYXRhO1xuICB9O1xuICBjb25zdCB0cmFuc2Zvcm1PdXRwdXQgPSBhc3luYyAoZGF0YSwgdW5zYWZlX21vZGVsLCBzZWxlY3QgPSBbXSkgPT4ge1xuICAgIGlmICghZGF0YSkgcmV0dXJuIG51bGw7XG4gICAgY29uc3QgbmV3TWFwcGVkS2V5cyA9IGNvbmZpZy5tYXBLZXlzVHJhbnNmb3JtT3V0cHV0ID8/IHt9O1xuICAgIGNvbnN0IHRyYW5zZm9ybWVkRGF0YSA9IHt9O1xuICAgIGNvbnN0IHRhYmxlU2NoZW1hID0gc2NoZW1hW3Vuc2FmZV9tb2RlbF0uZmllbGRzO1xuICAgIGNvbnN0IGlkS2V5ID0gT2JqZWN0LmVudHJpZXMobmV3TWFwcGVkS2V5cykuZmluZChcbiAgICAgIChbXywgdl0pID0+IHYgPT09IFwiaWRcIlxuICAgICk/LlswXTtcbiAgICB0YWJsZVNjaGVtYVtpZEtleSA/PyBcImlkXCJdID0ge1xuICAgICAgdHlwZTogb3B0aW9ucy5hZHZhbmNlZD8uZGF0YWJhc2U/LnVzZU51bWJlcklkID8gXCJudW1iZXJcIiA6IFwic3RyaW5nXCJcbiAgICB9O1xuICAgIGZvciAoY29uc3Qga2V5IGluIHRhYmxlU2NoZW1hKSB7XG4gICAgICBpZiAoc2VsZWN0Lmxlbmd0aCAmJiAhc2VsZWN0LmluY2x1ZGVzKGtleSkpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBjb25zdCBmaWVsZCA9IHRhYmxlU2NoZW1hW2tleV07XG4gICAgICBpZiAoZmllbGQpIHtcbiAgICAgICAgY29uc3Qgb3JpZ2luYWxLZXkgPSBmaWVsZC5maWVsZE5hbWUgfHwga2V5O1xuICAgICAgICBsZXQgbmV3VmFsdWUgPSBkYXRhW09iamVjdC5lbnRyaWVzKG5ld01hcHBlZEtleXMpLmZpbmQoXG4gICAgICAgICAgKFtfLCB2XSkgPT4gdiA9PT0gb3JpZ2luYWxLZXlcbiAgICAgICAgKT8uWzBdIHx8IG9yaWdpbmFsS2V5XTtcbiAgICAgICAgaWYgKGZpZWxkLnRyYW5zZm9ybT8ub3V0cHV0KSB7XG4gICAgICAgICAgbmV3VmFsdWUgPSBhd2FpdCBmaWVsZC50cmFuc2Zvcm0ub3V0cHV0KG5ld1ZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgbmV3RmllbGROYW1lID0gbmV3TWFwcGVkS2V5c1trZXldIHx8IGtleTtcbiAgICAgICAgaWYgKG9yaWdpbmFsS2V5ID09PSBcImlkXCIgfHwgZmllbGQucmVmZXJlbmNlcz8uZmllbGQgPT09IFwiaWRcIikge1xuICAgICAgICAgIGlmICh0eXBlb2YgbmV3VmFsdWUgIT09IFwidW5kZWZpbmVkXCIpIG5ld1ZhbHVlID0gU3RyaW5nKG5ld1ZhbHVlKTtcbiAgICAgICAgfSBlbHNlIGlmIChjb25maWcuc3VwcG9ydHNKU09OID09PSBmYWxzZSAmJiB0eXBlb2YgbmV3VmFsdWUgPT09IFwic3RyaW5nXCIgJiYgLy9AdHMtZXhwZWN0LWVycm9yIC0gRnV0dXJlIHByb29maW5nXG4gICAgICAgIGZpZWxkLnR5cGUgPT09IFwianNvblwiKSB7XG4gICAgICAgICAgbmV3VmFsdWUgPSBzYWZlSlNPTlBhcnNlKG5ld1ZhbHVlKTtcbiAgICAgICAgfSBlbHNlIGlmIChjb25maWcuc3VwcG9ydHNEYXRlcyA9PT0gZmFsc2UgJiYgdHlwZW9mIG5ld1ZhbHVlID09PSBcInN0cmluZ1wiICYmIGZpZWxkLnR5cGUgPT09IFwiZGF0ZVwiKSB7XG4gICAgICAgICAgbmV3VmFsdWUgPSBuZXcgRGF0ZShuZXdWYWx1ZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoY29uZmlnLnN1cHBvcnRzQm9vbGVhbnMgPT09IGZhbHNlICYmIHR5cGVvZiBuZXdWYWx1ZSA9PT0gXCJudW1iZXJcIiAmJiBmaWVsZC50eXBlID09PSBcImJvb2xlYW5cIikge1xuICAgICAgICAgIG5ld1ZhbHVlID0gbmV3VmFsdWUgPT09IDE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZy5jdXN0b21UcmFuc2Zvcm1PdXRwdXQpIHtcbiAgICAgICAgICBuZXdWYWx1ZSA9IGNvbmZpZy5jdXN0b21UcmFuc2Zvcm1PdXRwdXQoe1xuICAgICAgICAgICAgZGF0YTogbmV3VmFsdWUsXG4gICAgICAgICAgICBmaWVsZDogbmV3RmllbGROYW1lLFxuICAgICAgICAgICAgZmllbGRBdHRyaWJ1dGVzOiBmaWVsZCxcbiAgICAgICAgICAgIHNlbGVjdCxcbiAgICAgICAgICAgIG1vZGVsOiB1bnNhZmVfbW9kZWwsXG4gICAgICAgICAgICBzY2hlbWEsXG4gICAgICAgICAgICBvcHRpb25zXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdHJhbnNmb3JtZWREYXRhW25ld0ZpZWxkTmFtZV0gPSBuZXdWYWx1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRyYW5zZm9ybWVkRGF0YTtcbiAgfTtcbiAgY29uc3QgdHJhbnNmb3JtV2hlcmVDbGF1c2UgPSAoe1xuICAgIG1vZGVsLFxuICAgIHdoZXJlXG4gIH0pID0+IHtcbiAgICBpZiAoIXdoZXJlKSByZXR1cm4gdm9pZCAwO1xuICAgIGNvbnN0IG5ld01hcHBlZEtleXMgPSBjb25maWcubWFwS2V5c1RyYW5zZm9ybUlucHV0ID8/IHt9O1xuICAgIHJldHVybiB3aGVyZS5tYXAoKHcpID0+IHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgZmllbGQ6IHVuc2FmZV9maWVsZCxcbiAgICAgICAgdmFsdWUsXG4gICAgICAgIG9wZXJhdG9yID0gXCJlcVwiLFxuICAgICAgICBjb25uZWN0b3IgPSBcIkFORFwiXG4gICAgICB9ID0gdztcbiAgICAgIGlmIChvcGVyYXRvciA9PT0gXCJpblwiKSB7XG4gICAgICAgIGlmICghQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJWYWx1ZSBtdXN0IGJlIGFuIGFycmF5XCIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjb25zdCBkZWZhdWx0TW9kZWxOYW1lID0gZ2V0RGVmYXVsdE1vZGVsTmFtZShtb2RlbCk7XG4gICAgICBjb25zdCBkZWZhdWx0RmllbGROYW1lID0gZ2V0RGVmYXVsdEZpZWxkTmFtZSh7XG4gICAgICAgIGZpZWxkOiB1bnNhZmVfZmllbGQsXG4gICAgICAgIG1vZGVsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGZpZWxkTmFtZSA9IG5ld01hcHBlZEtleXNbZGVmYXVsdEZpZWxkTmFtZV0gfHwgZ2V0RmllbGROYW1lKHtcbiAgICAgICAgZmllbGQ6IGRlZmF1bHRGaWVsZE5hbWUsXG4gICAgICAgIG1vZGVsOiBkZWZhdWx0TW9kZWxOYW1lXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGZpZWxkQXR0ciA9IGdldEZpZWxkQXR0cmlidXRlcyh7XG4gICAgICAgIGZpZWxkOiBkZWZhdWx0RmllbGROYW1lLFxuICAgICAgICBtb2RlbDogZGVmYXVsdE1vZGVsTmFtZVxuICAgICAgfSk7XG4gICAgICBpZiAoZGVmYXVsdEZpZWxkTmFtZSA9PT0gXCJpZFwiIHx8IGZpZWxkQXR0ci5yZWZlcmVuY2VzPy5maWVsZCA9PT0gXCJpZFwiKSB7XG4gICAgICAgIGlmIChvcHRpb25zLmFkdmFuY2VkPy5kYXRhYmFzZT8udXNlTnVtYmVySWQpIHtcbiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIG9wZXJhdG9yLFxuICAgICAgICAgICAgICBjb25uZWN0b3IsXG4gICAgICAgICAgICAgIGZpZWxkOiBmaWVsZE5hbWUsXG4gICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZS5tYXAoTnVtYmVyKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG9wZXJhdG9yLFxuICAgICAgICAgICAgY29ubmVjdG9yLFxuICAgICAgICAgICAgZmllbGQ6IGZpZWxkTmFtZSxcbiAgICAgICAgICAgIHZhbHVlOiBOdW1iZXIodmFsdWUpXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb3BlcmF0b3IsXG4gICAgICAgIGNvbm5lY3RvcixcbiAgICAgICAgZmllbGQ6IGZpZWxkTmFtZSxcbiAgICAgICAgdmFsdWVcbiAgICAgIH07XG4gICAgfSk7XG4gIH07XG4gIHJldHVybiB7XG4gICAgY3JlYXRlOiBhc3luYyAoe1xuICAgICAgZGF0YTogdW5zYWZlRGF0YSxcbiAgICAgIG1vZGVsOiB1bnNhZmVNb2RlbCxcbiAgICAgIHNlbGVjdCxcbiAgICAgIGZvcmNlQWxsb3dJZCA9IGZhbHNlXG4gICAgfSkgPT4ge1xuICAgICAgdHJhbnNhY3Rpb25JZCsrO1xuICAgICAgbGV0IHRoaXNUcmFuc2FjdGlvbklkID0gdHJhbnNhY3Rpb25JZDtcbiAgICAgIGNvbnN0IG1vZGVsID0gZ2V0TW9kZWxOYW1lKHVuc2FmZU1vZGVsKTtcbiAgICAgIGlmIChcImlkXCIgaW4gdW5zYWZlRGF0YSAmJiAhZm9yY2VBbGxvd0lkKSB7XG4gICAgICAgIGxvZ2dlci53YXJuKFxuICAgICAgICAgIGBbJHtjb25maWcuYWRhcHRlck5hbWV9XSAtIFlvdSBhcmUgdHJ5aW5nIHRvIGNyZWF0ZSBhIHJlY29yZCB3aXRoIGFuIGlkLiBUaGlzIGlzIG5vdCBhbGxvd2VkIGFzIHdlIGhhbmRsZSBpZCBnZW5lcmF0aW9uIGZvciB5b3UsIHVubGVzcyB5b3UgcGFzcyBpbiB0aGUgXFxgZm9yY2VBbGxvd0lkXFxgIHBhcmFtZXRlci4gVGhlIGlkIHdpbGwgYmUgaWdub3JlZC5gXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IGVyciA9IG5ldyBFcnJvcigpO1xuICAgICAgICBjb25zdCBzdGFjayA9IGVyci5zdGFjaz8uc3BsaXQoXCJcXG5cIikuZmlsdGVyKChfLCBpKSA9PiBpICE9PSAxKS5qb2luKFwiXFxuXCIpLnJlcGxhY2UoXCJFcnJvcjpcIiwgXCJDcmVhdGUgbWV0aG9kIHdpdGggYGlkYCBiZWluZyBjYWxsZWQgYXQ6XCIpO1xuICAgICAgICBjb25zb2xlLmxvZyhzdGFjayk7XG4gICAgICAgIHVuc2FmZURhdGEuaWQgPSB2b2lkIDA7XG4gICAgICB9XG4gICAgICBkZWJ1Z0xvZyhcbiAgICAgICAgeyBtZXRob2Q6IFwiY3JlYXRlXCIgfSxcbiAgICAgICAgYCR7Zm9ybWF0VHJhbnNhY3Rpb25JZCh0aGlzVHJhbnNhY3Rpb25JZCl9ICR7Zm9ybWF0U3RlcCgxLCA0KX1gLFxuICAgICAgICBgJHtmb3JtYXRNZXRob2QoXCJjcmVhdGVcIil9ICR7Zm9ybWF0QWN0aW9uKFwiVW5zYWZlIElucHV0XCIpfTpgLFxuICAgICAgICB7IG1vZGVsLCBkYXRhOiB1bnNhZmVEYXRhIH1cbiAgICAgICk7XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgdHJhbnNmb3JtSW5wdXQoXG4gICAgICAgIHVuc2FmZURhdGEsXG4gICAgICAgIHVuc2FmZU1vZGVsLFxuICAgICAgICBcImNyZWF0ZVwiLFxuICAgICAgICBmb3JjZUFsbG93SWRcbiAgICAgICk7XG4gICAgICBkZWJ1Z0xvZyhcbiAgICAgICAgeyBtZXRob2Q6IFwiY3JlYXRlXCIgfSxcbiAgICAgICAgYCR7Zm9ybWF0VHJhbnNhY3Rpb25JZCh0aGlzVHJhbnNhY3Rpb25JZCl9ICR7Zm9ybWF0U3RlcCgyLCA0KX1gLFxuICAgICAgICBgJHtmb3JtYXRNZXRob2QoXCJjcmVhdGVcIil9ICR7Zm9ybWF0QWN0aW9uKFwiUGFyc2VkIElucHV0XCIpfTpgLFxuICAgICAgICB7IG1vZGVsLCBkYXRhIH1cbiAgICAgICk7XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBhZGFwdGVySW5zdGFuY2UuY3JlYXRlKHsgZGF0YSwgbW9kZWwgfSk7XG4gICAgICBkZWJ1Z0xvZyhcbiAgICAgICAgeyBtZXRob2Q6IFwiY3JlYXRlXCIgfSxcbiAgICAgICAgYCR7Zm9ybWF0VHJhbnNhY3Rpb25JZCh0aGlzVHJhbnNhY3Rpb25JZCl9ICR7Zm9ybWF0U3RlcCgzLCA0KX1gLFxuICAgICAgICBgJHtmb3JtYXRNZXRob2QoXCJjcmVhdGVcIil9ICR7Zm9ybWF0QWN0aW9uKFwiREIgUmVzdWx0XCIpfTpgLFxuICAgICAgICB7IG1vZGVsLCByZXMgfVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHRyYW5zZm9ybWVkID0gYXdhaXQgdHJhbnNmb3JtT3V0cHV0KHJlcywgdW5zYWZlTW9kZWwsIHNlbGVjdCk7XG4gICAgICBkZWJ1Z0xvZyhcbiAgICAgICAgeyBtZXRob2Q6IFwiY3JlYXRlXCIgfSxcbiAgICAgICAgYCR7Zm9ybWF0VHJhbnNhY3Rpb25JZCh0aGlzVHJhbnNhY3Rpb25JZCl9ICR7Zm9ybWF0U3RlcCg0LCA0KX1gLFxuICAgICAgICBgJHtmb3JtYXRNZXRob2QoXCJjcmVhdGVcIil9ICR7Zm9ybWF0QWN0aW9uKFwiUGFyc2VkIFJlc3VsdFwiKX06YCxcbiAgICAgICAgeyBtb2RlbCwgZGF0YTogdHJhbnNmb3JtZWQgfVxuICAgICAgKTtcbiAgICAgIHJldHVybiB0cmFuc2Zvcm1lZDtcbiAgICB9LFxuICAgIHVwZGF0ZTogYXN5bmMgKHtcbiAgICAgIG1vZGVsOiB1bnNhZmVNb2RlbCxcbiAgICAgIHdoZXJlOiB1bnNhZmVXaGVyZSxcbiAgICAgIHVwZGF0ZTogdW5zYWZlRGF0YVxuICAgIH0pID0+IHtcbiAgICAgIHRyYW5zYWN0aW9uSWQrKztcbiAgICAgIGxldCB0aGlzVHJhbnNhY3Rpb25JZCA9IHRyYW5zYWN0aW9uSWQ7XG4gICAgICBjb25zdCBtb2RlbCA9IGdldE1vZGVsTmFtZSh1bnNhZmVNb2RlbCk7XG4gICAgICBjb25zdCB3aGVyZSA9IHRyYW5zZm9ybVdoZXJlQ2xhdXNlKHtcbiAgICAgICAgbW9kZWw6IHVuc2FmZU1vZGVsLFxuICAgICAgICB3aGVyZTogdW5zYWZlV2hlcmVcbiAgICAgIH0pO1xuICAgICAgZGVidWdMb2coXG4gICAgICAgIHsgbWV0aG9kOiBcInVwZGF0ZVwiIH0sXG4gICAgICAgIGAke2Zvcm1hdFRyYW5zYWN0aW9uSWQodGhpc1RyYW5zYWN0aW9uSWQpfSAke2Zvcm1hdFN0ZXAoMSwgNCl9YCxcbiAgICAgICAgYCR7Zm9ybWF0TWV0aG9kKFwidXBkYXRlXCIpfSAke2Zvcm1hdEFjdGlvbihcIlVuc2FmZSBJbnB1dFwiKX06YCxcbiAgICAgICAgeyBtb2RlbCwgZGF0YTogdW5zYWZlRGF0YSB9XG4gICAgICApO1xuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRyYW5zZm9ybUlucHV0KFxuICAgICAgICB1bnNhZmVEYXRhLFxuICAgICAgICB1bnNhZmVNb2RlbCxcbiAgICAgICAgXCJ1cGRhdGVcIlxuICAgICAgKTtcbiAgICAgIGRlYnVnTG9nKFxuICAgICAgICB7IG1ldGhvZDogXCJ1cGRhdGVcIiB9LFxuICAgICAgICBgJHtmb3JtYXRUcmFuc2FjdGlvbklkKHRoaXNUcmFuc2FjdGlvbklkKX0gJHtmb3JtYXRTdGVwKDIsIDQpfWAsXG4gICAgICAgIGAke2Zvcm1hdE1ldGhvZChcInVwZGF0ZVwiKX0gJHtmb3JtYXRBY3Rpb24oXCJQYXJzZWQgSW5wdXRcIil9OmAsXG4gICAgICAgIHsgbW9kZWwsIGRhdGEgfVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGFkYXB0ZXJJbnN0YW5jZS51cGRhdGUoe1xuICAgICAgICBtb2RlbCxcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIHVwZGF0ZTogZGF0YVxuICAgICAgfSk7XG4gICAgICBkZWJ1Z0xvZyhcbiAgICAgICAgeyBtZXRob2Q6IFwidXBkYXRlXCIgfSxcbiAgICAgICAgYCR7Zm9ybWF0VHJhbnNhY3Rpb25JZCh0aGlzVHJhbnNhY3Rpb25JZCl9ICR7Zm9ybWF0U3RlcCgzLCA0KX1gLFxuICAgICAgICBgJHtmb3JtYXRNZXRob2QoXCJ1cGRhdGVcIil9ICR7Zm9ybWF0QWN0aW9uKFwiREIgUmVzdWx0XCIpfTpgLFxuICAgICAgICB7IG1vZGVsLCBkYXRhOiByZXMgfVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHRyYW5zZm9ybWVkID0gYXdhaXQgdHJhbnNmb3JtT3V0cHV0KHJlcywgdW5zYWZlTW9kZWwpO1xuICAgICAgZGVidWdMb2coXG4gICAgICAgIHsgbWV0aG9kOiBcInVwZGF0ZVwiIH0sXG4gICAgICAgIGAke2Zvcm1hdFRyYW5zYWN0aW9uSWQodGhpc1RyYW5zYWN0aW9uSWQpfSAke2Zvcm1hdFN0ZXAoNCwgNCl9YCxcbiAgICAgICAgYCR7Zm9ybWF0TWV0aG9kKFwidXBkYXRlXCIpfSAke2Zvcm1hdEFjdGlvbihcIlBhcnNlZCBSZXN1bHRcIil9OmAsXG4gICAgICAgIHsgbW9kZWwsIGRhdGE6IHRyYW5zZm9ybWVkIH1cbiAgICAgICk7XG4gICAgICByZXR1cm4gdHJhbnNmb3JtZWQ7XG4gICAgfSxcbiAgICB1cGRhdGVNYW55OiBhc3luYyAoe1xuICAgICAgbW9kZWw6IHVuc2FmZU1vZGVsLFxuICAgICAgd2hlcmU6IHVuc2FmZVdoZXJlLFxuICAgICAgdXBkYXRlOiB1bnNhZmVEYXRhXG4gICAgfSkgPT4ge1xuICAgICAgdHJhbnNhY3Rpb25JZCsrO1xuICAgICAgbGV0IHRoaXNUcmFuc2FjdGlvbklkID0gdHJhbnNhY3Rpb25JZDtcbiAgICAgIGNvbnN0IG1vZGVsID0gZ2V0TW9kZWxOYW1lKHVuc2FmZU1vZGVsKTtcbiAgICAgIGNvbnN0IHdoZXJlID0gdHJhbnNmb3JtV2hlcmVDbGF1c2Uoe1xuICAgICAgICBtb2RlbDogdW5zYWZlTW9kZWwsXG4gICAgICAgIHdoZXJlOiB1bnNhZmVXaGVyZVxuICAgICAgfSk7XG4gICAgICBkZWJ1Z0xvZyhcbiAgICAgICAgeyBtZXRob2Q6IFwidXBkYXRlTWFueVwiIH0sXG4gICAgICAgIGAke2Zvcm1hdFRyYW5zYWN0aW9uSWQodGhpc1RyYW5zYWN0aW9uSWQpfSAke2Zvcm1hdFN0ZXAoMSwgNCl9YCxcbiAgICAgICAgYCR7Zm9ybWF0TWV0aG9kKFwidXBkYXRlTWFueVwiKX0gJHtmb3JtYXRBY3Rpb24oXCJVbnNhZmUgSW5wdXRcIil9OmAsXG4gICAgICAgIHsgbW9kZWwsIGRhdGE6IHVuc2FmZURhdGEgfVxuICAgICAgKTtcbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0cmFuc2Zvcm1JbnB1dCh1bnNhZmVEYXRhLCB1bnNhZmVNb2RlbCwgXCJ1cGRhdGVcIik7XG4gICAgICBkZWJ1Z0xvZyhcbiAgICAgICAgeyBtZXRob2Q6IFwidXBkYXRlTWFueVwiIH0sXG4gICAgICAgIGAke2Zvcm1hdFRyYW5zYWN0aW9uSWQodGhpc1RyYW5zYWN0aW9uSWQpfSAke2Zvcm1hdFN0ZXAoMiwgNCl9YCxcbiAgICAgICAgYCR7Zm9ybWF0TWV0aG9kKFwidXBkYXRlTWFueVwiKX0gJHtmb3JtYXRBY3Rpb24oXCJQYXJzZWQgSW5wdXRcIil9OmAsXG4gICAgICAgIHsgbW9kZWwsIGRhdGEgfVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHVwZGF0ZWRDb3VudCA9IGF3YWl0IGFkYXB0ZXJJbnN0YW5jZS51cGRhdGVNYW55KHtcbiAgICAgICAgbW9kZWwsXG4gICAgICAgIHdoZXJlLFxuICAgICAgICB1cGRhdGU6IGRhdGFcbiAgICAgIH0pO1xuICAgICAgZGVidWdMb2coXG4gICAgICAgIHsgbWV0aG9kOiBcInVwZGF0ZU1hbnlcIiB9LFxuICAgICAgICBgJHtmb3JtYXRUcmFuc2FjdGlvbklkKHRoaXNUcmFuc2FjdGlvbklkKX0gJHtmb3JtYXRTdGVwKDMsIDQpfWAsXG4gICAgICAgIGAke2Zvcm1hdE1ldGhvZChcInVwZGF0ZU1hbnlcIil9ICR7Zm9ybWF0QWN0aW9uKFwiREIgUmVzdWx0XCIpfTpgLFxuICAgICAgICB7IG1vZGVsLCBkYXRhOiB1cGRhdGVkQ291bnQgfVxuICAgICAgKTtcbiAgICAgIGRlYnVnTG9nKFxuICAgICAgICB7IG1ldGhvZDogXCJ1cGRhdGVNYW55XCIgfSxcbiAgICAgICAgYCR7Zm9ybWF0VHJhbnNhY3Rpb25JZCh0aGlzVHJhbnNhY3Rpb25JZCl9ICR7Zm9ybWF0U3RlcCg0LCA0KX1gLFxuICAgICAgICBgJHtmb3JtYXRNZXRob2QoXCJ1cGRhdGVNYW55XCIpfSAke2Zvcm1hdEFjdGlvbihcIlBhcnNlZCBSZXN1bHRcIil9OmAsXG4gICAgICAgIHsgbW9kZWwsIGRhdGE6IHVwZGF0ZWRDb3VudCB9XG4gICAgICApO1xuICAgICAgcmV0dXJuIHVwZGF0ZWRDb3VudDtcbiAgICB9LFxuICAgIGZpbmRPbmU6IGFzeW5jICh7XG4gICAgICBtb2RlbDogdW5zYWZlTW9kZWwsXG4gICAgICB3aGVyZTogdW5zYWZlV2hlcmUsXG4gICAgICBzZWxlY3RcbiAgICB9KSA9PiB7XG4gICAgICB0cmFuc2FjdGlvbklkKys7XG4gICAgICBsZXQgdGhpc1RyYW5zYWN0aW9uSWQgPSB0cmFuc2FjdGlvbklkO1xuICAgICAgY29uc3QgbW9kZWwgPSBnZXRNb2RlbE5hbWUodW5zYWZlTW9kZWwpO1xuICAgICAgY29uc3Qgd2hlcmUgPSB0cmFuc2Zvcm1XaGVyZUNsYXVzZSh7XG4gICAgICAgIG1vZGVsOiB1bnNhZmVNb2RlbCxcbiAgICAgICAgd2hlcmU6IHVuc2FmZVdoZXJlXG4gICAgICB9KTtcbiAgICAgIGRlYnVnTG9nKFxuICAgICAgICB7IG1ldGhvZDogXCJmaW5kT25lXCIgfSxcbiAgICAgICAgYCR7Zm9ybWF0VHJhbnNhY3Rpb25JZCh0aGlzVHJhbnNhY3Rpb25JZCl9ICR7Zm9ybWF0U3RlcCgxLCAzKX1gLFxuICAgICAgICBgJHtmb3JtYXRNZXRob2QoXCJmaW5kT25lXCIpfTpgLFxuICAgICAgICB7IG1vZGVsLCB3aGVyZSwgc2VsZWN0IH1cbiAgICAgICk7XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBhZGFwdGVySW5zdGFuY2UuZmluZE9uZSh7XG4gICAgICAgIG1vZGVsLFxuICAgICAgICB3aGVyZSxcbiAgICAgICAgc2VsZWN0XG4gICAgICB9KTtcbiAgICAgIGRlYnVnTG9nKFxuICAgICAgICB7IG1ldGhvZDogXCJmaW5kT25lXCIgfSxcbiAgICAgICAgYCR7Zm9ybWF0VHJhbnNhY3Rpb25JZCh0aGlzVHJhbnNhY3Rpb25JZCl9ICR7Zm9ybWF0U3RlcCgyLCAzKX1gLFxuICAgICAgICBgJHtmb3JtYXRNZXRob2QoXCJmaW5kT25lXCIpfSAke2Zvcm1hdEFjdGlvbihcIkRCIFJlc3VsdFwiKX06YCxcbiAgICAgICAgeyBtb2RlbCwgZGF0YTogcmVzIH1cbiAgICAgICk7XG4gICAgICBjb25zdCB0cmFuc2Zvcm1lZCA9IGF3YWl0IHRyYW5zZm9ybU91dHB1dChcbiAgICAgICAgcmVzLFxuICAgICAgICB1bnNhZmVNb2RlbCxcbiAgICAgICAgc2VsZWN0XG4gICAgICApO1xuICAgICAgZGVidWdMb2coXG4gICAgICAgIHsgbWV0aG9kOiBcImZpbmRPbmVcIiB9LFxuICAgICAgICBgJHtmb3JtYXRUcmFuc2FjdGlvbklkKHRoaXNUcmFuc2FjdGlvbklkKX0gJHtmb3JtYXRTdGVwKDMsIDMpfWAsXG4gICAgICAgIGAke2Zvcm1hdE1ldGhvZChcImZpbmRPbmVcIil9ICR7Zm9ybWF0QWN0aW9uKFwiUGFyc2VkIFJlc3VsdFwiKX06YCxcbiAgICAgICAgeyBtb2RlbCwgZGF0YTogdHJhbnNmb3JtZWQgfVxuICAgICAgKTtcbiAgICAgIHJldHVybiB0cmFuc2Zvcm1lZDtcbiAgICB9LFxuICAgIGZpbmRNYW55OiBhc3luYyAoe1xuICAgICAgbW9kZWw6IHVuc2FmZU1vZGVsLFxuICAgICAgd2hlcmU6IHVuc2FmZVdoZXJlLFxuICAgICAgbGltaXQ6IHVuc2FmZUxpbWl0LFxuICAgICAgc29ydEJ5LFxuICAgICAgb2Zmc2V0XG4gICAgfSkgPT4ge1xuICAgICAgdHJhbnNhY3Rpb25JZCsrO1xuICAgICAgbGV0IHRoaXNUcmFuc2FjdGlvbklkID0gdHJhbnNhY3Rpb25JZDtcbiAgICAgIGNvbnN0IGxpbWl0ID0gdW5zYWZlTGltaXQgPz8gb3B0aW9ucy5hZHZhbmNlZD8uZGF0YWJhc2U/LmRlZmF1bHRGaW5kTWFueUxpbWl0ID8/IDEwMDtcbiAgICAgIGNvbnN0IG1vZGVsID0gZ2V0TW9kZWxOYW1lKHVuc2FmZU1vZGVsKTtcbiAgICAgIGNvbnN0IHdoZXJlID0gdHJhbnNmb3JtV2hlcmVDbGF1c2Uoe1xuICAgICAgICBtb2RlbDogdW5zYWZlTW9kZWwsXG4gICAgICAgIHdoZXJlOiB1bnNhZmVXaGVyZVxuICAgICAgfSk7XG4gICAgICBkZWJ1Z0xvZyhcbiAgICAgICAgeyBtZXRob2Q6IFwiZmluZE1hbnlcIiB9LFxuICAgICAgICBgJHtmb3JtYXRUcmFuc2FjdGlvbklkKHRoaXNUcmFuc2FjdGlvbklkKX0gJHtmb3JtYXRTdGVwKDEsIDMpfWAsXG4gICAgICAgIGAke2Zvcm1hdE1ldGhvZChcImZpbmRNYW55XCIpfTpgLFxuICAgICAgICB7IG1vZGVsLCB3aGVyZSwgbGltaXQsIHNvcnRCeSwgb2Zmc2V0IH1cbiAgICAgICk7XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBhZGFwdGVySW5zdGFuY2UuZmluZE1hbnkoe1xuICAgICAgICBtb2RlbCxcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIGxpbWl0LFxuICAgICAgICBzb3J0QnksXG4gICAgICAgIG9mZnNldFxuICAgICAgfSk7XG4gICAgICBkZWJ1Z0xvZyhcbiAgICAgICAgeyBtZXRob2Q6IFwiZmluZE1hbnlcIiB9LFxuICAgICAgICBgJHtmb3JtYXRUcmFuc2FjdGlvbklkKHRoaXNUcmFuc2FjdGlvbklkKX0gJHtmb3JtYXRTdGVwKDIsIDMpfWAsXG4gICAgICAgIGAke2Zvcm1hdE1ldGhvZChcImZpbmRNYW55XCIpfSAke2Zvcm1hdEFjdGlvbihcIkRCIFJlc3VsdFwiKX06YCxcbiAgICAgICAgeyBtb2RlbCwgZGF0YTogcmVzIH1cbiAgICAgICk7XG4gICAgICBjb25zdCB0cmFuc2Zvcm1lZCA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgICByZXMubWFwKGFzeW5jIChyKSA9PiBhd2FpdCB0cmFuc2Zvcm1PdXRwdXQociwgdW5zYWZlTW9kZWwpKVxuICAgICAgKTtcbiAgICAgIGRlYnVnTG9nKFxuICAgICAgICB7IG1ldGhvZDogXCJmaW5kTWFueVwiIH0sXG4gICAgICAgIGAke2Zvcm1hdFRyYW5zYWN0aW9uSWQodGhpc1RyYW5zYWN0aW9uSWQpfSAke2Zvcm1hdFN0ZXAoMywgMyl9YCxcbiAgICAgICAgYCR7Zm9ybWF0TWV0aG9kKFwiZmluZE1hbnlcIil9ICR7Zm9ybWF0QWN0aW9uKFwiUGFyc2VkIFJlc3VsdFwiKX06YCxcbiAgICAgICAgeyBtb2RlbCwgZGF0YTogdHJhbnNmb3JtZWQgfVxuICAgICAgKTtcbiAgICAgIHJldHVybiB0cmFuc2Zvcm1lZDtcbiAgICB9LFxuICAgIGRlbGV0ZTogYXN5bmMgKHtcbiAgICAgIG1vZGVsOiB1bnNhZmVNb2RlbCxcbiAgICAgIHdoZXJlOiB1bnNhZmVXaGVyZVxuICAgIH0pID0+IHtcbiAgICAgIHRyYW5zYWN0aW9uSWQrKztcbiAgICAgIGxldCB0aGlzVHJhbnNhY3Rpb25JZCA9IHRyYW5zYWN0aW9uSWQ7XG4gICAgICBjb25zdCBtb2RlbCA9IGdldE1vZGVsTmFtZSh1bnNhZmVNb2RlbCk7XG4gICAgICBjb25zdCB3aGVyZSA9IHRyYW5zZm9ybVdoZXJlQ2xhdXNlKHtcbiAgICAgICAgbW9kZWw6IHVuc2FmZU1vZGVsLFxuICAgICAgICB3aGVyZTogdW5zYWZlV2hlcmVcbiAgICAgIH0pO1xuICAgICAgZGVidWdMb2coXG4gICAgICAgIHsgbWV0aG9kOiBcImRlbGV0ZVwiIH0sXG4gICAgICAgIGAke2Zvcm1hdFRyYW5zYWN0aW9uSWQodGhpc1RyYW5zYWN0aW9uSWQpfSAke2Zvcm1hdFN0ZXAoMSwgMil9YCxcbiAgICAgICAgYCR7Zm9ybWF0TWV0aG9kKFwiZGVsZXRlXCIpfTpgLFxuICAgICAgICB7IG1vZGVsLCB3aGVyZSB9XG4gICAgICApO1xuICAgICAgYXdhaXQgYWRhcHRlckluc3RhbmNlLmRlbGV0ZSh7XG4gICAgICAgIG1vZGVsLFxuICAgICAgICB3aGVyZVxuICAgICAgfSk7XG4gICAgICBkZWJ1Z0xvZyhcbiAgICAgICAgeyBtZXRob2Q6IFwiZGVsZXRlXCIgfSxcbiAgICAgICAgYCR7Zm9ybWF0VHJhbnNhY3Rpb25JZCh0aGlzVHJhbnNhY3Rpb25JZCl9ICR7Zm9ybWF0U3RlcCgyLCAyKX1gLFxuICAgICAgICBgJHtmb3JtYXRNZXRob2QoXCJkZWxldGVcIil9ICR7Zm9ybWF0QWN0aW9uKFwiREIgUmVzdWx0XCIpfTpgLFxuICAgICAgICB7IG1vZGVsIH1cbiAgICAgICk7XG4gICAgfSxcbiAgICBkZWxldGVNYW55OiBhc3luYyAoe1xuICAgICAgbW9kZWw6IHVuc2FmZU1vZGVsLFxuICAgICAgd2hlcmU6IHVuc2FmZVdoZXJlXG4gICAgfSkgPT4ge1xuICAgICAgdHJhbnNhY3Rpb25JZCsrO1xuICAgICAgbGV0IHRoaXNUcmFuc2FjdGlvbklkID0gdHJhbnNhY3Rpb25JZDtcbiAgICAgIGNvbnN0IG1vZGVsID0gZ2V0TW9kZWxOYW1lKHVuc2FmZU1vZGVsKTtcbiAgICAgIGNvbnN0IHdoZXJlID0gdHJhbnNmb3JtV2hlcmVDbGF1c2Uoe1xuICAgICAgICBtb2RlbDogdW5zYWZlTW9kZWwsXG4gICAgICAgIHdoZXJlOiB1bnNhZmVXaGVyZVxuICAgICAgfSk7XG4gICAgICBkZWJ1Z0xvZyhcbiAgICAgICAgeyBtZXRob2Q6IFwiZGVsZXRlTWFueVwiIH0sXG4gICAgICAgIGAke2Zvcm1hdFRyYW5zYWN0aW9uSWQodGhpc1RyYW5zYWN0aW9uSWQpfSAke2Zvcm1hdFN0ZXAoMSwgMil9YCxcbiAgICAgICAgYCR7Zm9ybWF0TWV0aG9kKFwiZGVsZXRlTWFueVwiKX0gJHtmb3JtYXRBY3Rpb24oXCJEZWxldGVNYW55XCIpfTpgLFxuICAgICAgICB7IG1vZGVsLCB3aGVyZSB9XG4gICAgICApO1xuICAgICAgY29uc3QgcmVzID0gYXdhaXQgYWRhcHRlckluc3RhbmNlLmRlbGV0ZU1hbnkoe1xuICAgICAgICBtb2RlbCxcbiAgICAgICAgd2hlcmVcbiAgICAgIH0pO1xuICAgICAgZGVidWdMb2coXG4gICAgICAgIHsgbWV0aG9kOiBcImRlbGV0ZU1hbnlcIiB9LFxuICAgICAgICBgJHtmb3JtYXRUcmFuc2FjdGlvbklkKHRoaXNUcmFuc2FjdGlvbklkKX0gJHtmb3JtYXRTdGVwKDIsIDIpfWAsXG4gICAgICAgIGAke2Zvcm1hdE1ldGhvZChcImRlbGV0ZU1hbnlcIil9ICR7Zm9ybWF0QWN0aW9uKFwiREIgUmVzdWx0XCIpfTpgLFxuICAgICAgICB7IG1vZGVsLCBkYXRhOiByZXMgfVxuICAgICAgKTtcbiAgICAgIHJldHVybiByZXM7XG4gICAgfSxcbiAgICBjb3VudDogYXN5bmMgKHtcbiAgICAgIG1vZGVsOiB1bnNhZmVNb2RlbCxcbiAgICAgIHdoZXJlOiB1bnNhZmVXaGVyZVxuICAgIH0pID0+IHtcbiAgICAgIHRyYW5zYWN0aW9uSWQrKztcbiAgICAgIGxldCB0aGlzVHJhbnNhY3Rpb25JZCA9IHRyYW5zYWN0aW9uSWQ7XG4gICAgICBjb25zdCBtb2RlbCA9IGdldE1vZGVsTmFtZSh1bnNhZmVNb2RlbCk7XG4gICAgICBjb25zdCB3aGVyZSA9IHRyYW5zZm9ybVdoZXJlQ2xhdXNlKHtcbiAgICAgICAgbW9kZWw6IHVuc2FmZU1vZGVsLFxuICAgICAgICB3aGVyZTogdW5zYWZlV2hlcmVcbiAgICAgIH0pO1xuICAgICAgZGVidWdMb2coXG4gICAgICAgIHsgbWV0aG9kOiBcImNvdW50XCIgfSxcbiAgICAgICAgYCR7Zm9ybWF0VHJhbnNhY3Rpb25JZCh0aGlzVHJhbnNhY3Rpb25JZCl9ICR7Zm9ybWF0U3RlcCgxLCAyKX1gLFxuICAgICAgICBgJHtmb3JtYXRNZXRob2QoXCJjb3VudFwiKX06YCxcbiAgICAgICAge1xuICAgICAgICAgIG1vZGVsLFxuICAgICAgICAgIHdoZXJlXG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBhZGFwdGVySW5zdGFuY2UuY291bnQoe1xuICAgICAgICBtb2RlbCxcbiAgICAgICAgd2hlcmVcbiAgICAgIH0pO1xuICAgICAgZGVidWdMb2coXG4gICAgICAgIHsgbWV0aG9kOiBcImNvdW50XCIgfSxcbiAgICAgICAgYCR7Zm9ybWF0VHJhbnNhY3Rpb25JZCh0aGlzVHJhbnNhY3Rpb25JZCl9ICR7Zm9ybWF0U3RlcCgyLCAyKX1gLFxuICAgICAgICBgJHtmb3JtYXRNZXRob2QoXCJjb3VudFwiKX06YCxcbiAgICAgICAge1xuICAgICAgICAgIG1vZGVsLFxuICAgICAgICAgIGRhdGE6IHJlc1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgcmV0dXJuIHJlcztcbiAgICB9LFxuICAgIGNyZWF0ZVNjaGVtYTogYWRhcHRlckluc3RhbmNlLmNyZWF0ZVNjaGVtYSA/IGFzeW5jIChfLCBmaWxlKSA9PiB7XG4gICAgICBjb25zdCB0YWJsZXMgPSBnZXRBdXRoVGFibGVzKG9wdGlvbnMpO1xuICAgICAgaWYgKG9wdGlvbnMuc2Vjb25kYXJ5U3RvcmFnZSAmJiAhb3B0aW9ucy5zZXNzaW9uPy5zdG9yZVNlc3Npb25JbkRhdGFiYXNlKSB7XG4gICAgICAgIGRlbGV0ZSB0YWJsZXMuc2Vzc2lvbjtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLnJhdGVMaW1pdCAmJiBvcHRpb25zLnJhdGVMaW1pdC5zdG9yYWdlID09PSBcImRhdGFiYXNlXCIgJiYgLy8gcmF0ZS1saW1pdCB3aWxsIGRlZmF1bHQgdG8gZW5hYmxlZCBpbiBwcm9kdWN0aW9uLFxuICAgICAgLy8gYW5kIGdpdmVuIHN0b3JhZ2UgaXMgZGF0YWJhc2UsIGl0IHdpbGwgdHJ5IHRvIHVzZSB0aGUgcmF0ZS1saW1pdCB0YWJsZSxcbiAgICAgIC8vIHNvIHdlIHNob3VsZCBtYWtlIHN1cmUgdG8gZ2VuZXJhdGUgcmF0ZS1saW1pdCB0YWJsZSBzY2hlbWFcbiAgICAgICh0eXBlb2Ygb3B0aW9ucy5yYXRlTGltaXQuZW5hYmxlZCA9PT0gXCJ1bmRlZmluZWRcIiB8fCAvLyBhbmQgb2YgY291cnNlIGlmIHRoZXkgZm9yY2VmdWxseSBzZXQgdG8gdHJ1ZSwgdGhlbiB0aGV5IHdhbnQgcmF0ZS1saW1pdCxcbiAgICAgIC8vIHRodXMgd2Ugc2hvdWxkIGFsc28gZ2VuZXJhdGUgcmF0ZS1saW1pdCB0YWJsZSBzY2hlbWFcbiAgICAgIG9wdGlvbnMucmF0ZUxpbWl0LmVuYWJsZWQgPT09IHRydWUpKSB7XG4gICAgICAgIHRhYmxlcy5yYXRlbGltaXQgPSB7XG4gICAgICAgICAgbW9kZWxOYW1lOiBvcHRpb25zLnJhdGVMaW1pdC5tb2RlbE5hbWUgPz8gXCJyYXRlbGltaXRcIixcbiAgICAgICAgICBmaWVsZHM6IHtcbiAgICAgICAgICAgIGtleToge1xuICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICB1bmlxdWU6IHRydWUsXG4gICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgICBmaWVsZE5hbWU6IG9wdGlvbnMucmF0ZUxpbWl0LmZpZWxkcz8ua2V5ID8/IFwia2V5XCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb3VudDoge1xuICAgICAgICAgICAgICB0eXBlOiBcIm51bWJlclwiLFxuICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLnJhdGVMaW1pdC5maWVsZHM/LmNvdW50ID8/IFwiY291bnRcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxhc3RSZXF1ZXN0OiB7XG4gICAgICAgICAgICAgIHR5cGU6IFwibnVtYmVyXCIsXG4gICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgICBiaWdpbnQ6IHRydWUsXG4gICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogKCkgPT4gRGF0ZS5ub3coKSxcbiAgICAgICAgICAgICAgZmllbGROYW1lOiBvcHRpb25zLnJhdGVMaW1pdC5maWVsZHM/Lmxhc3RSZXF1ZXN0ID8/IFwibGFzdFJlcXVlc3RcIlxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhZGFwdGVySW5zdGFuY2UuY3JlYXRlU2NoZW1hKHsgZmlsZSwgdGFibGVzIH0pO1xuICAgIH0gOiB2b2lkIDAsXG4gICAgb3B0aW9uczoge1xuICAgICAgYWRhcHRlckNvbmZpZzogY29uZmlnLFxuICAgICAgLi4uYWRhcHRlckluc3RhbmNlLm9wdGlvbnMgPz8ge31cbiAgICB9LFxuICAgIGlkOiBjb25maWcuYWRhcHRlcklkLFxuICAgIC8vIFNlY3JldGx5IGV4cG9ydCB2YWx1ZXMgT05MWSBpZiB0aGlzIGFkYXB0ZXIgaGFzIGVuYWJsZWQgYWRhcHRlci10ZXN0LWRlYnVnLWxvZ3MuXG4gICAgLy8gVGhpcyB3b3VsZCB0aGVuIGJlIHVzZWQgZHVyaW5nIG91ciBhZGFwdGVyLXRlc3RzIHRvIGhlbHAgcHJpbnQgZGVidWcgbG9ncyBpZiBhIHRlc3QgZmFpbHMuXG4gICAgLy9AdHMtZXhwZWN0LWVycm9yIC0gXl5cbiAgICAuLi5jb25maWcuZGVidWdMb2dzPy5pc1J1bm5pbmdBZGFwdGVyVGVzdHMgPyB7XG4gICAgICBhZGFwdGVyVGVzdERlYnVnTG9nczoge1xuICAgICAgICByZXNldERlYnVnTG9ncygpIHtcbiAgICAgICAgICBkZWJ1Z0xvZ3MgPSBbXTtcbiAgICAgICAgfSxcbiAgICAgICAgcHJpbnREZWJ1Z0xvZ3MoKSB7XG4gICAgICAgICAgY29uc3Qgc2VwYXJhdG9yID0gYFxcdTI1MDBgLnJlcGVhdCg4MCk7XG4gICAgICAgICAgbGV0IGxvZyA9IGRlYnVnTG9ncy5yZXZlcnNlKCkubWFwKChsb2cyKSA9PiB7XG4gICAgICAgICAgICBsb2cyWzBdID0gYFxuJHtsb2cyWzBdfWA7XG4gICAgICAgICAgICByZXR1cm4gWy4uLmxvZzIsIFwiXFxuXCJdO1xuICAgICAgICAgIH0pLnJlZHVjZShcbiAgICAgICAgICAgIChwcmV2LCBjdXJyKSA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiBbLi4uY3VyciwgLi4ucHJldl07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgW2BcbiR7c2VwYXJhdG9yfWBdXG4gICAgICAgICAgKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyguLi5sb2cpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSA6IHt9XG4gIH07XG59O1xuZnVuY3Rpb24gZm9ybWF0VHJhbnNhY3Rpb25JZCh0cmFuc2FjdGlvbklkMikge1xuICByZXR1cm4gYCR7Y29sb3JzLmZnLm1hZ2VudGF9IyR7dHJhbnNhY3Rpb25JZDJ9JHtjb2xvcnMucmVzZXR9YDtcbn1cbmZ1bmN0aW9uIGZvcm1hdFN0ZXAoc3RlcCwgdG90YWwpIHtcbiAgcmV0dXJuIGAke2NvbG9ycy5iZy5ibGFja30ke2NvbG9ycy5mZy55ZWxsb3d9WyR7c3RlcH0vJHt0b3RhbH1dJHtjb2xvcnMucmVzZXR9YDtcbn1cbmZ1bmN0aW9uIGZvcm1hdE1ldGhvZChtZXRob2QpIHtcbiAgcmV0dXJuIGAke2NvbG9ycy5icmlnaHR9JHttZXRob2R9JHtjb2xvcnMucmVzZXR9YDtcbn1cbmZ1bmN0aW9uIGZvcm1hdEFjdGlvbihhY3Rpb24pIHtcbiAgcmV0dXJuIGAke2NvbG9ycy5kaW19KCR7YWN0aW9ufSkke2NvbG9ycy5yZXNldH1gO1xufVxuXG5leHBvcnQgeyBjcmVhdGVBZGFwdGVyIGFzIGMgfTtcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/shared/better-auth.gBl3F_xa.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/shared/better-auth.n2KFGwjY.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.n2KFGwjY.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   a: () => (/* binding */ accountSchema),\n/* harmony export */   b: () => (/* binding */ parseUserOutput),\n/* harmony export */   c: () => (/* binding */ parseAccountOutput),\n/* harmony export */   d: () => (/* binding */ parseSessionOutput),\n/* harmony export */   e: () => (/* binding */ parseInputData),\n/* harmony export */   f: () => (/* binding */ parseUserInput),\n/* harmony export */   g: () => (/* binding */ getAllFields),\n/* harmony export */   h: () => (/* binding */ parseAdditionalUserInput),\n/* harmony export */   i: () => (/* binding */ parseAccountInput),\n/* harmony export */   j: () => (/* binding */ parseSessionInput),\n/* harmony export */   m: () => (/* binding */ mergeSchema),\n/* harmony export */   p: () => (/* binding */ parseOutputData),\n/* harmony export */   s: () => (/* binding */ sessionSchema),\n/* harmony export */   u: () => (/* binding */ userSchema),\n/* harmony export */   v: () => (/* binding */ verificationSchema)\n/* harmony export */ });\n/* harmony import */ var zod_v4__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! zod/v4 */ \"(rsc)/../../node_modules/zod/v4/classic/schemas.js\");\n/* harmony import */ var zod_v4__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! zod/v4 */ \"(rsc)/../../node_modules/zod/v4/classic/coerce.js\");\n/* harmony import */ var better_call__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! better-call */ \"(rsc)/../../node_modules/better-call/dist/index.js\");\n\n\n\nconst accountSchema = zod_v4__WEBPACK_IMPORTED_MODULE_1__.object({\n  id: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string(),\n  providerId: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string(),\n  accountId: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string(),\n  userId: zod_v4__WEBPACK_IMPORTED_MODULE_2__.string(),\n  accessToken: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string().nullish(),\n  refreshToken: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string().nullish(),\n  idToken: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string().nullish(),\n  /**\n   * Access token expires at\n   */\n  accessTokenExpiresAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date().nullish(),\n  /**\n   * Refresh token expires at\n   */\n  refreshTokenExpiresAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date().nullish(),\n  /**\n   * The scopes that the user has authorized\n   */\n  scope: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string().nullish(),\n  /**\n   * Password is only stored in the credential provider\n   */\n  password: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string().nullish(),\n  createdAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date().default(() => /* @__PURE__ */ new Date()),\n  updatedAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date().default(() => /* @__PURE__ */ new Date())\n});\nconst userSchema = zod_v4__WEBPACK_IMPORTED_MODULE_1__.object({\n  id: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string(),\n  email: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string().transform((val) => val.toLowerCase()),\n  emailVerified: zod_v4__WEBPACK_IMPORTED_MODULE_1__.boolean().default(false),\n  name: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string(),\n  image: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string().nullish(),\n  createdAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date().default(() => /* @__PURE__ */ new Date()),\n  updatedAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date().default(() => /* @__PURE__ */ new Date())\n});\nconst sessionSchema = zod_v4__WEBPACK_IMPORTED_MODULE_1__.object({\n  id: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string(),\n  userId: zod_v4__WEBPACK_IMPORTED_MODULE_2__.string(),\n  expiresAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date(),\n  createdAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date().default(() => /* @__PURE__ */ new Date()),\n  updatedAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date().default(() => /* @__PURE__ */ new Date()),\n  token: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string(),\n  ipAddress: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string().nullish(),\n  userAgent: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string().nullish()\n});\nconst verificationSchema = zod_v4__WEBPACK_IMPORTED_MODULE_1__.object({\n  id: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string(),\n  value: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string(),\n  createdAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date().default(() => /* @__PURE__ */ new Date()),\n  updatedAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date().default(() => /* @__PURE__ */ new Date()),\n  expiresAt: zod_v4__WEBPACK_IMPORTED_MODULE_1__.date(),\n  identifier: zod_v4__WEBPACK_IMPORTED_MODULE_1__.string()\n});\nfunction parseOutputData(data, schema) {\n  const fields = schema.fields;\n  const parsedData = {};\n  for (const key in data) {\n    const field = fields[key];\n    if (!field) {\n      parsedData[key] = data[key];\n      continue;\n    }\n    if (field.returned === false) {\n      continue;\n    }\n    parsedData[key] = data[key];\n  }\n  return parsedData;\n}\nfunction getAllFields(options, table) {\n  let schema = {\n    ...table === \"user\" ? options.user?.additionalFields : {},\n    ...table === \"session\" ? options.session?.additionalFields : {}\n  };\n  for (const plugin of options.plugins || []) {\n    if (plugin.schema && plugin.schema[table]) {\n      schema = {\n        ...schema,\n        ...plugin.schema[table].fields\n      };\n    }\n  }\n  return schema;\n}\nfunction parseUserOutput(options, user) {\n  const schema = getAllFields(options, \"user\");\n  return parseOutputData(user, { fields: schema });\n}\nfunction parseAccountOutput(options, account) {\n  const schema = getAllFields(options, \"account\");\n  return parseOutputData(account, { fields: schema });\n}\nfunction parseSessionOutput(options, session) {\n  const schema = getAllFields(options, \"session\");\n  return parseOutputData(session, { fields: schema });\n}\nfunction parseInputData(data, schema) {\n  const action = schema.action || \"create\";\n  const fields = schema.fields;\n  const parsedData = {};\n  for (const key in fields) {\n    if (key in data) {\n      if (fields[key].input === false) {\n        if (fields[key].defaultValue) {\n          parsedData[key] = fields[key].defaultValue;\n          continue;\n        }\n        continue;\n      }\n      if (fields[key].validator?.input && data[key] !== void 0) {\n        parsedData[key] = fields[key].validator.input.parse(data[key]);\n        continue;\n      }\n      if (fields[key].transform?.input && data[key] !== void 0) {\n        parsedData[key] = fields[key].transform?.input(data[key]);\n        continue;\n      }\n      parsedData[key] = data[key];\n      continue;\n    }\n    if (fields[key].defaultValue && action === \"create\") {\n      parsedData[key] = fields[key].defaultValue;\n      continue;\n    }\n    if (fields[key].required && action === \"create\") {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: `${key} is required`\n      });\n    }\n  }\n  return parsedData;\n}\nfunction parseUserInput(options, user, action) {\n  const schema = getAllFields(options, \"user\");\n  return parseInputData(user || {}, { fields: schema, action });\n}\nfunction parseAdditionalUserInput(options, user) {\n  const schema = getAllFields(options, \"user\");\n  return parseInputData(user || {}, { fields: schema });\n}\nfunction parseAccountInput(options, account) {\n  const schema = getAllFields(options, \"account\");\n  return parseInputData(account, { fields: schema });\n}\nfunction parseSessionInput(options, session) {\n  const schema = getAllFields(options, \"session\");\n  return parseInputData(session, { fields: schema });\n}\nfunction mergeSchema(schema, newSchema) {\n  if (!newSchema) {\n    return schema;\n  }\n  for (const table in newSchema) {\n    const newModelName = newSchema[table]?.modelName;\n    if (newModelName) {\n      schema[table].modelName = newModelName;\n    }\n    for (const field in schema[table].fields) {\n      const newField = newSchema[table]?.fields?.[field];\n      if (!newField) {\n        continue;\n      }\n      schema[table].fields[field].fieldName = newField;\n    }\n  }\n  return schema;\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLm4yS0ZHd2pZLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBNEI7QUFDVzs7QUFFdkMsc0JBQXNCLDBDQUFRO0FBQzlCLE1BQU0sMENBQVE7QUFDZCxjQUFjLDBDQUFRO0FBQ3RCLGFBQWEsMENBQVE7QUFDckIsVUFBVSwwQ0FBZTtBQUN6QixlQUFlLDBDQUFRO0FBQ3ZCLGdCQUFnQiwwQ0FBUTtBQUN4QixXQUFXLDBDQUFRO0FBQ25CO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qix3Q0FBTTtBQUM5QjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsd0NBQU07QUFDL0I7QUFDQTtBQUNBO0FBQ0EsU0FBUywwQ0FBUTtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxZQUFZLDBDQUFRO0FBQ3BCLGFBQWEsd0NBQU07QUFDbkIsYUFBYSx3Q0FBTTtBQUNuQixDQUFDO0FBQ0QsbUJBQW1CLDBDQUFRO0FBQzNCLE1BQU0sMENBQVE7QUFDZCxTQUFTLDBDQUFRO0FBQ2pCLGlCQUFpQiwyQ0FBUztBQUMxQixRQUFRLDBDQUFRO0FBQ2hCLFNBQVMsMENBQVE7QUFDakIsYUFBYSx3Q0FBTTtBQUNuQixhQUFhLHdDQUFNO0FBQ25CLENBQUM7QUFDRCxzQkFBc0IsMENBQVE7QUFDOUIsTUFBTSwwQ0FBUTtBQUNkLFVBQVUsMENBQWU7QUFDekIsYUFBYSx3Q0FBTTtBQUNuQixhQUFhLHdDQUFNO0FBQ25CLGFBQWEsd0NBQU07QUFDbkIsU0FBUywwQ0FBUTtBQUNqQixhQUFhLDBDQUFRO0FBQ3JCLGFBQWEsMENBQVE7QUFDckIsQ0FBQztBQUNELDJCQUEyQiwwQ0FBUTtBQUNuQyxNQUFNLDBDQUFRO0FBQ2QsU0FBUywwQ0FBUTtBQUNqQixhQUFhLHdDQUFNO0FBQ25CLGFBQWEsd0NBQU07QUFDbkIsYUFBYSx3Q0FBTTtBQUNuQixjQUFjLDBDQUFRO0FBQ3RCLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2REFBNkQ7QUFDN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxnQkFBZ0I7QUFDakQ7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLGdCQUFnQjtBQUNwRDtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsZ0JBQWdCO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixpREFBUTtBQUN4QixvQkFBb0IsS0FBSztBQUN6QixPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLElBQUksd0JBQXdCO0FBQzlEO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxJQUFJLGdCQUFnQjtBQUN0RDtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsZ0JBQWdCO0FBQ25EO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxnQkFBZ0I7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFd1YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWxhbi9EZXNrdG9wL0FwcHMvYmV0dGVyLWF1dGgvbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLm4yS0ZHd2pZLm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyB6IGZyb20gJ3pvZC92NCc7XG5pbXBvcnQgeyBBUElFcnJvciB9IGZyb20gJ2JldHRlci1jYWxsJztcblxuY29uc3QgYWNjb3VudFNjaGVtYSA9IHoub2JqZWN0KHtcbiAgaWQ6IHouc3RyaW5nKCksXG4gIHByb3ZpZGVySWQ6IHouc3RyaW5nKCksXG4gIGFjY291bnRJZDogei5zdHJpbmcoKSxcbiAgdXNlcklkOiB6LmNvZXJjZS5zdHJpbmcoKSxcbiAgYWNjZXNzVG9rZW46IHouc3RyaW5nKCkubnVsbGlzaCgpLFxuICByZWZyZXNoVG9rZW46IHouc3RyaW5nKCkubnVsbGlzaCgpLFxuICBpZFRva2VuOiB6LnN0cmluZygpLm51bGxpc2goKSxcbiAgLyoqXG4gICAqIEFjY2VzcyB0b2tlbiBleHBpcmVzIGF0XG4gICAqL1xuICBhY2Nlc3NUb2tlbkV4cGlyZXNBdDogei5kYXRlKCkubnVsbGlzaCgpLFxuICAvKipcbiAgICogUmVmcmVzaCB0b2tlbiBleHBpcmVzIGF0XG4gICAqL1xuICByZWZyZXNoVG9rZW5FeHBpcmVzQXQ6IHouZGF0ZSgpLm51bGxpc2goKSxcbiAgLyoqXG4gICAqIFRoZSBzY29wZXMgdGhhdCB0aGUgdXNlciBoYXMgYXV0aG9yaXplZFxuICAgKi9cbiAgc2NvcGU6IHouc3RyaW5nKCkubnVsbGlzaCgpLFxuICAvKipcbiAgICogUGFzc3dvcmQgaXMgb25seSBzdG9yZWQgaW4gdGhlIGNyZWRlbnRpYWwgcHJvdmlkZXJcbiAgICovXG4gIHBhc3N3b3JkOiB6LnN0cmluZygpLm51bGxpc2goKSxcbiAgY3JlYXRlZEF0OiB6LmRhdGUoKS5kZWZhdWx0KCgpID0+IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpKSxcbiAgdXBkYXRlZEF0OiB6LmRhdGUoKS5kZWZhdWx0KCgpID0+IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpKVxufSk7XG5jb25zdCB1c2VyU2NoZW1hID0gei5vYmplY3Qoe1xuICBpZDogei5zdHJpbmcoKSxcbiAgZW1haWw6IHouc3RyaW5nKCkudHJhbnNmb3JtKCh2YWwpID0+IHZhbC50b0xvd2VyQ2FzZSgpKSxcbiAgZW1haWxWZXJpZmllZDogei5ib29sZWFuKCkuZGVmYXVsdChmYWxzZSksXG4gIG5hbWU6IHouc3RyaW5nKCksXG4gIGltYWdlOiB6LnN0cmluZygpLm51bGxpc2goKSxcbiAgY3JlYXRlZEF0OiB6LmRhdGUoKS5kZWZhdWx0KCgpID0+IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpKSxcbiAgdXBkYXRlZEF0OiB6LmRhdGUoKS5kZWZhdWx0KCgpID0+IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpKVxufSk7XG5jb25zdCBzZXNzaW9uU2NoZW1hID0gei5vYmplY3Qoe1xuICBpZDogei5zdHJpbmcoKSxcbiAgdXNlcklkOiB6LmNvZXJjZS5zdHJpbmcoKSxcbiAgZXhwaXJlc0F0OiB6LmRhdGUoKSxcbiAgY3JlYXRlZEF0OiB6LmRhdGUoKS5kZWZhdWx0KCgpID0+IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpKSxcbiAgdXBkYXRlZEF0OiB6LmRhdGUoKS5kZWZhdWx0KCgpID0+IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpKSxcbiAgdG9rZW46IHouc3RyaW5nKCksXG4gIGlwQWRkcmVzczogei5zdHJpbmcoKS5udWxsaXNoKCksXG4gIHVzZXJBZ2VudDogei5zdHJpbmcoKS5udWxsaXNoKClcbn0pO1xuY29uc3QgdmVyaWZpY2F0aW9uU2NoZW1hID0gei5vYmplY3Qoe1xuICBpZDogei5zdHJpbmcoKSxcbiAgdmFsdWU6IHouc3RyaW5nKCksXG4gIGNyZWF0ZWRBdDogei5kYXRlKCkuZGVmYXVsdCgoKSA9PiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSksXG4gIHVwZGF0ZWRBdDogei5kYXRlKCkuZGVmYXVsdCgoKSA9PiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSksXG4gIGV4cGlyZXNBdDogei5kYXRlKCksXG4gIGlkZW50aWZpZXI6IHouc3RyaW5nKClcbn0pO1xuZnVuY3Rpb24gcGFyc2VPdXRwdXREYXRhKGRhdGEsIHNjaGVtYSkge1xuICBjb25zdCBmaWVsZHMgPSBzY2hlbWEuZmllbGRzO1xuICBjb25zdCBwYXJzZWREYXRhID0ge307XG4gIGZvciAoY29uc3Qga2V5IGluIGRhdGEpIHtcbiAgICBjb25zdCBmaWVsZCA9IGZpZWxkc1trZXldO1xuICAgIGlmICghZmllbGQpIHtcbiAgICAgIHBhcnNlZERhdGFba2V5XSA9IGRhdGFba2V5XTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBpZiAoZmllbGQucmV0dXJuZWQgPT09IGZhbHNlKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgcGFyc2VkRGF0YVtrZXldID0gZGF0YVtrZXldO1xuICB9XG4gIHJldHVybiBwYXJzZWREYXRhO1xufVxuZnVuY3Rpb24gZ2V0QWxsRmllbGRzKG9wdGlvbnMsIHRhYmxlKSB7XG4gIGxldCBzY2hlbWEgPSB7XG4gICAgLi4udGFibGUgPT09IFwidXNlclwiID8gb3B0aW9ucy51c2VyPy5hZGRpdGlvbmFsRmllbGRzIDoge30sXG4gICAgLi4udGFibGUgPT09IFwic2Vzc2lvblwiID8gb3B0aW9ucy5zZXNzaW9uPy5hZGRpdGlvbmFsRmllbGRzIDoge31cbiAgfTtcbiAgZm9yIChjb25zdCBwbHVnaW4gb2Ygb3B0aW9ucy5wbHVnaW5zIHx8IFtdKSB7XG4gICAgaWYgKHBsdWdpbi5zY2hlbWEgJiYgcGx1Z2luLnNjaGVtYVt0YWJsZV0pIHtcbiAgICAgIHNjaGVtYSA9IHtcbiAgICAgICAgLi4uc2NoZW1hLFxuICAgICAgICAuLi5wbHVnaW4uc2NoZW1hW3RhYmxlXS5maWVsZHNcbiAgICAgIH07XG4gICAgfVxuICB9XG4gIHJldHVybiBzY2hlbWE7XG59XG5mdW5jdGlvbiBwYXJzZVVzZXJPdXRwdXQob3B0aW9ucywgdXNlcikge1xuICBjb25zdCBzY2hlbWEgPSBnZXRBbGxGaWVsZHMob3B0aW9ucywgXCJ1c2VyXCIpO1xuICByZXR1cm4gcGFyc2VPdXRwdXREYXRhKHVzZXIsIHsgZmllbGRzOiBzY2hlbWEgfSk7XG59XG5mdW5jdGlvbiBwYXJzZUFjY291bnRPdXRwdXQob3B0aW9ucywgYWNjb3VudCkge1xuICBjb25zdCBzY2hlbWEgPSBnZXRBbGxGaWVsZHMob3B0aW9ucywgXCJhY2NvdW50XCIpO1xuICByZXR1cm4gcGFyc2VPdXRwdXREYXRhKGFjY291bnQsIHsgZmllbGRzOiBzY2hlbWEgfSk7XG59XG5mdW5jdGlvbiBwYXJzZVNlc3Npb25PdXRwdXQob3B0aW9ucywgc2Vzc2lvbikge1xuICBjb25zdCBzY2hlbWEgPSBnZXRBbGxGaWVsZHMob3B0aW9ucywgXCJzZXNzaW9uXCIpO1xuICByZXR1cm4gcGFyc2VPdXRwdXREYXRhKHNlc3Npb24sIHsgZmllbGRzOiBzY2hlbWEgfSk7XG59XG5mdW5jdGlvbiBwYXJzZUlucHV0RGF0YShkYXRhLCBzY2hlbWEpIHtcbiAgY29uc3QgYWN0aW9uID0gc2NoZW1hLmFjdGlvbiB8fCBcImNyZWF0ZVwiO1xuICBjb25zdCBmaWVsZHMgPSBzY2hlbWEuZmllbGRzO1xuICBjb25zdCBwYXJzZWREYXRhID0ge307XG4gIGZvciAoY29uc3Qga2V5IGluIGZpZWxkcykge1xuICAgIGlmIChrZXkgaW4gZGF0YSkge1xuICAgICAgaWYgKGZpZWxkc1trZXldLmlucHV0ID09PSBmYWxzZSkge1xuICAgICAgICBpZiAoZmllbGRzW2tleV0uZGVmYXVsdFZhbHVlKSB7XG4gICAgICAgICAgcGFyc2VkRGF0YVtrZXldID0gZmllbGRzW2tleV0uZGVmYXVsdFZhbHVlO1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgaWYgKGZpZWxkc1trZXldLnZhbGlkYXRvcj8uaW5wdXQgJiYgZGF0YVtrZXldICE9PSB2b2lkIDApIHtcbiAgICAgICAgcGFyc2VkRGF0YVtrZXldID0gZmllbGRzW2tleV0udmFsaWRhdG9yLmlucHV0LnBhcnNlKGRhdGFba2V5XSk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgaWYgKGZpZWxkc1trZXldLnRyYW5zZm9ybT8uaW5wdXQgJiYgZGF0YVtrZXldICE9PSB2b2lkIDApIHtcbiAgICAgICAgcGFyc2VkRGF0YVtrZXldID0gZmllbGRzW2tleV0udHJhbnNmb3JtPy5pbnB1dChkYXRhW2tleV0pO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIHBhcnNlZERhdGFba2V5XSA9IGRhdGFba2V5XTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBpZiAoZmllbGRzW2tleV0uZGVmYXVsdFZhbHVlICYmIGFjdGlvbiA9PT0gXCJjcmVhdGVcIikge1xuICAgICAgcGFyc2VkRGF0YVtrZXldID0gZmllbGRzW2tleV0uZGVmYXVsdFZhbHVlO1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGlmIChmaWVsZHNba2V5XS5yZXF1aXJlZCAmJiBhY3Rpb24gPT09IFwiY3JlYXRlXCIpIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogYCR7a2V5fSBpcyByZXF1aXJlZGBcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcGFyc2VkRGF0YTtcbn1cbmZ1bmN0aW9uIHBhcnNlVXNlcklucHV0KG9wdGlvbnMsIHVzZXIsIGFjdGlvbikge1xuICBjb25zdCBzY2hlbWEgPSBnZXRBbGxGaWVsZHMob3B0aW9ucywgXCJ1c2VyXCIpO1xuICByZXR1cm4gcGFyc2VJbnB1dERhdGEodXNlciB8fCB7fSwgeyBmaWVsZHM6IHNjaGVtYSwgYWN0aW9uIH0pO1xufVxuZnVuY3Rpb24gcGFyc2VBZGRpdGlvbmFsVXNlcklucHV0KG9wdGlvbnMsIHVzZXIpIHtcbiAgY29uc3Qgc2NoZW1hID0gZ2V0QWxsRmllbGRzKG9wdGlvbnMsIFwidXNlclwiKTtcbiAgcmV0dXJuIHBhcnNlSW5wdXREYXRhKHVzZXIgfHwge30sIHsgZmllbGRzOiBzY2hlbWEgfSk7XG59XG5mdW5jdGlvbiBwYXJzZUFjY291bnRJbnB1dChvcHRpb25zLCBhY2NvdW50KSB7XG4gIGNvbnN0IHNjaGVtYSA9IGdldEFsbEZpZWxkcyhvcHRpb25zLCBcImFjY291bnRcIik7XG4gIHJldHVybiBwYXJzZUlucHV0RGF0YShhY2NvdW50LCB7IGZpZWxkczogc2NoZW1hIH0pO1xufVxuZnVuY3Rpb24gcGFyc2VTZXNzaW9uSW5wdXQob3B0aW9ucywgc2Vzc2lvbikge1xuICBjb25zdCBzY2hlbWEgPSBnZXRBbGxGaWVsZHMob3B0aW9ucywgXCJzZXNzaW9uXCIpO1xuICByZXR1cm4gcGFyc2VJbnB1dERhdGEoc2Vzc2lvbiwgeyBmaWVsZHM6IHNjaGVtYSB9KTtcbn1cbmZ1bmN0aW9uIG1lcmdlU2NoZW1hKHNjaGVtYSwgbmV3U2NoZW1hKSB7XG4gIGlmICghbmV3U2NoZW1hKSB7XG4gICAgcmV0dXJuIHNjaGVtYTtcbiAgfVxuICBmb3IgKGNvbnN0IHRhYmxlIGluIG5ld1NjaGVtYSkge1xuICAgIGNvbnN0IG5ld01vZGVsTmFtZSA9IG5ld1NjaGVtYVt0YWJsZV0/Lm1vZGVsTmFtZTtcbiAgICBpZiAobmV3TW9kZWxOYW1lKSB7XG4gICAgICBzY2hlbWFbdGFibGVdLm1vZGVsTmFtZSA9IG5ld01vZGVsTmFtZTtcbiAgICB9XG4gICAgZm9yIChjb25zdCBmaWVsZCBpbiBzY2hlbWFbdGFibGVdLmZpZWxkcykge1xuICAgICAgY29uc3QgbmV3RmllbGQgPSBuZXdTY2hlbWFbdGFibGVdPy5maWVsZHM/LltmaWVsZF07XG4gICAgICBpZiAoIW5ld0ZpZWxkKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgc2NoZW1hW3RhYmxlXS5maWVsZHNbZmllbGRdLmZpZWxkTmFtZSA9IG5ld0ZpZWxkO1xuICAgIH1cbiAgfVxuICByZXR1cm4gc2NoZW1hO1xufVxuXG5leHBvcnQgeyBhY2NvdW50U2NoZW1hIGFzIGEsIHBhcnNlVXNlck91dHB1dCBhcyBiLCBwYXJzZUFjY291bnRPdXRwdXQgYXMgYywgcGFyc2VTZXNzaW9uT3V0cHV0IGFzIGQsIHBhcnNlSW5wdXREYXRhIGFzIGUsIHBhcnNlVXNlcklucHV0IGFzIGYsIGdldEFsbEZpZWxkcyBhcyBnLCBwYXJzZUFkZGl0aW9uYWxVc2VySW5wdXQgYXMgaCwgcGFyc2VBY2NvdW50SW5wdXQgYXMgaSwgcGFyc2VTZXNzaW9uSW5wdXQgYXMgaiwgbWVyZ2VTY2hlbWEgYXMgbSwgcGFyc2VPdXRwdXREYXRhIGFzIHAsIHNlc3Npb25TY2hlbWEgYXMgcywgdXNlclNjaGVtYSBhcyB1LCB2ZXJpZmljYXRpb25TY2hlbWEgYXMgdiB9O1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/shared/better-auth.n2KFGwjY.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/shared/better-auth.tB5eU6EY.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.tB5eU6EY.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   s: () => (/* binding */ safeJSONParse)\n/* harmony export */ });\nfunction safeJSONParse(data) {\n  function reviver(_, value) {\n    if (typeof value === \"string\") {\n      const iso8601Regex = /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(?:\\.\\d+)?Z$/;\n      if (iso8601Regex.test(value)) {\n        const date = new Date(value);\n        if (!isNaN(date.getTime())) {\n          return date;\n        }\n      }\n    }\n    return value;\n  }\n  try {\n    return JSON.parse(data, reviver);\n  } catch {\n    return null;\n  }\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLnRCNWVVNkVZLm1qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQUE7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRTtBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFOEIiLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWxhbi9EZXNrdG9wL0FwcHMvYmV0dGVyLWF1dGgvbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLnRCNWVVNkVZLm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBzYWZlSlNPTlBhcnNlKGRhdGEpIHtcbiAgZnVuY3Rpb24gcmV2aXZlcihfLCB2YWx1ZSkge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIGNvbnN0IGlzbzg2MDFSZWdleCA9IC9eXFxkezR9LVxcZHsyfS1cXGR7Mn1UXFxkezJ9OlxcZHsyfTpcXGR7Mn0oPzpcXC5cXGQrKT9aJC87XG4gICAgICBpZiAoaXNvODYwMVJlZ2V4LnRlc3QodmFsdWUpKSB7XG4gICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSh2YWx1ZSk7XG4gICAgICAgIGlmICghaXNOYU4oZGF0ZS5nZXRUaW1lKCkpKSB7XG4gICAgICAgICAgcmV0dXJuIGRhdGU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG4gIHRyeSB7XG4gICAgcmV0dXJuIEpTT04ucGFyc2UoZGF0YSwgcmV2aXZlcik7XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbmV4cG9ydCB7IHNhZmVKU09OUGFyc2UgYXMgcyB9O1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/shared/better-auth.tB5eU6EY.mjs\n");

/***/ }),

/***/ "(rsc)/../../node_modules/better-auth/dist/shared/better-auth.z3dsxLxE.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.z3dsxLxE.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   $: () => (/* binding */ signOut),\n/* harmony export */   A: () => (/* binding */ originCheckMiddleware),\n/* harmony export */   B: () => (/* binding */ BASE_ERROR_CODES),\n/* harmony export */   C: () => (/* binding */ error),\n/* harmony export */   D: () => (/* binding */ ok),\n/* harmony export */   E: () => (/* binding */ accountInfo),\n/* harmony export */   F: () => (/* binding */ getAccessToken),\n/* harmony export */   G: () => (/* binding */ refreshToken),\n/* harmony export */   H: () => (/* binding */ HIDE_METADATA),\n/* harmony export */   I: () => (/* binding */ unlinkAccount),\n/* harmony export */   J: () => (/* binding */ deleteUserCallback),\n/* harmony export */   K: () => (/* binding */ listUserAccounts),\n/* harmony export */   L: () => (/* binding */ linkSocialAccount),\n/* harmony export */   M: () => (/* binding */ revokeOtherSessions),\n/* harmony export */   N: () => (/* binding */ revokeSessions),\n/* harmony export */   O: () => (/* binding */ revokeSession),\n/* harmony export */   P: () => (/* binding */ requestPasswordResetCallback),\n/* harmony export */   Q: () => (/* binding */ requestPasswordReset),\n/* harmony export */   R: () => (/* binding */ forgetPasswordCallback),\n/* harmony export */   S: () => (/* binding */ deleteUser),\n/* harmony export */   T: () => (/* binding */ setPassword),\n/* harmony export */   U: () => (/* binding */ changePassword),\n/* harmony export */   V: () => (/* binding */ changeEmail),\n/* harmony export */   W: () => (/* binding */ sendVerificationEmail),\n/* harmony export */   X: () => (/* binding */ verifyEmail),\n/* harmony export */   Y: () => (/* binding */ resetPassword),\n/* harmony export */   Z: () => (/* binding */ forgetPassword),\n/* harmony export */   _: () => (/* binding */ signInEmail),\n/* harmony export */   a: () => (/* binding */ validateToken),\n/* harmony export */   a0: () => (/* binding */ callbackOAuth),\n/* harmony export */   a1: () => (/* binding */ signInSocial),\n/* harmony export */   a2: () => (/* binding */ requestOnlySessionMiddleware),\n/* harmony export */   a3: () => (/* binding */ socialProviderList),\n/* harmony export */   a4: () => (/* binding */ SocialProviderListEnum),\n/* harmony export */   a5: () => (/* binding */ apple),\n/* harmony export */   a6: () => (/* binding */ getApplePublicKey),\n/* harmony export */   a7: () => (/* binding */ discord),\n/* harmony export */   a8: () => (/* binding */ dropbox),\n/* harmony export */   a9: () => (/* binding */ facebook),\n/* harmony export */   aa: () => (/* binding */ github),\n/* harmony export */   ab: () => (/* binding */ linear),\n/* harmony export */   ac: () => (/* binding */ linkedin),\n/* harmony export */   ad: () => (/* binding */ gitlab),\n/* harmony export */   ae: () => (/* binding */ google),\n/* harmony export */   af: () => (/* binding */ kick),\n/* harmony export */   ag: () => (/* binding */ microsoft),\n/* harmony export */   ah: () => (/* binding */ notion),\n/* harmony export */   ai: () => (/* binding */ reddit),\n/* harmony export */   aj: () => (/* binding */ roblox),\n/* harmony export */   ak: () => (/* binding */ spotify),\n/* harmony export */   al: () => (/* binding */ tiktok),\n/* harmony export */   am: () => (/* binding */ twitch),\n/* harmony export */   an: () => (/* binding */ twitter),\n/* harmony export */   ao: () => (/* binding */ LANG),\n/* harmony export */   ap: () => (/* binding */ vk),\n/* harmony export */   aq: () => (/* binding */ zoom),\n/* harmony export */   ar: () => (/* binding */ huggingface),\n/* harmony export */   as: () => (/* binding */ slack),\n/* harmony export */   b: () => (/* binding */ generateCodeChallenge),\n/* harmony export */   c: () => (/* binding */ createAuthorizationURL),\n/* harmony export */   d: () => (/* binding */ getOAuth2Tokens),\n/* harmony export */   e: () => (/* binding */ encodeOAuthParameter),\n/* harmony export */   f: () => (/* binding */ decryptOAuthToken),\n/* harmony export */   g: () => (/* binding */ generateState),\n/* harmony export */   h: () => (/* binding */ handleOAuthUserInfo),\n/* harmony export */   i: () => (/* binding */ createAuthMiddleware),\n/* harmony export */   j: () => (/* binding */ createAuthEndpoint),\n/* harmony export */   k: () => (/* binding */ getSessionFromCtx),\n/* harmony export */   l: () => (/* binding */ sessionMiddleware),\n/* harmony export */   m: () => (/* binding */ getSession),\n/* harmony export */   n: () => (/* binding */ freshSessionMiddleware),\n/* harmony export */   o: () => (/* binding */ originCheck),\n/* harmony export */   p: () => (/* binding */ parseState),\n/* harmony export */   q: () => (/* binding */ optionsMiddleware),\n/* harmony export */   r: () => (/* binding */ refreshAccessToken),\n/* harmony export */   s: () => (/* binding */ setTokenUtil),\n/* harmony export */   t: () => (/* binding */ socialProviders),\n/* harmony export */   u: () => (/* binding */ sendVerificationEmailFn),\n/* harmony export */   v: () => (/* binding */ validateAuthorizationCode),\n/* harmony export */   w: () => (/* binding */ createEmailVerificationToken),\n/* harmony export */   x: () => (/* binding */ wildcardMatch),\n/* harmony export */   y: () => (/* binding */ listSessions),\n/* harmony export */   z: () => (/* binding */ updateUser)\n/* harmony export */ });\n/* harmony import */ var zod_v4__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! zod/v4 */ \"(rsc)/../../node_modules/zod/v4/classic/schemas.js\");\n/* harmony import */ var zod_v4__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! zod/v4 */ \"(rsc)/../../node_modules/zod/v4/classic/coerce.js\");\n/* harmony import */ var better_call__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! better-call */ \"(rsc)/../../node_modules/better-call/dist/index.js\");\n/* harmony import */ var _better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./better-auth.CW6D9eSx.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.CW6D9eSx.mjs\");\n/* harmony import */ var _better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @better-auth/utils/hash */ \"(rsc)/../../node_modules/@better-auth/utils/dist/hash.mjs\");\n/* harmony import */ var _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @better-auth/utils/base64 */ \"(rsc)/../../node_modules/@better-auth/utils/dist/base64.mjs\");\n/* harmony import */ var _crypto_index_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../crypto/index.mjs */ \"(rsc)/../../node_modules/better-auth/dist/crypto/index.mjs\");\n/* harmony import */ var _better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @better-fetch/fetch */ \"(rsc)/../../node_modules/@better-fetch/fetch/dist/index.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! jose */ \"(rsc)/../../node_modules/jose/dist/node/esm/jwt/verify.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! jose */ \"(rsc)/../../node_modules/jose/dist/node/esm/util/decode_protected_header.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! jose */ \"(rsc)/../../node_modules/jose/dist/node/esm/util/decode_jwt.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! jose */ \"(rsc)/../../node_modules/jose/dist/node/esm/key/import.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! jose */ \"(rsc)/../../node_modules/jose/dist/node/esm/jwks/remote.js\");\n/* harmony import */ var _better_auth_utils__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @better-auth/utils */ \"(rsc)/../../node_modules/@better-auth/utils/dist/index.mjs\");\n/* harmony import */ var _better_auth_utils_hex__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @better-auth/utils/hex */ \"(rsc)/../../node_modules/@better-auth/utils/dist/hex.mjs\");\n/* harmony import */ var _better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./better-auth.B4Qoxdgc.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.B4Qoxdgc.mjs\");\n/* harmony import */ var _better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./better-auth.VTXNLFMT.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.VTXNLFMT.mjs\");\n/* harmony import */ var _cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../cookies/index.mjs */ \"(rsc)/../../node_modules/better-auth/dist/cookies/index.mjs\");\n/* harmony import */ var _better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./better-auth.tB5eU6EY.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.tB5eU6EY.mjs\");\n/* harmony import */ var _better_auth_utils_hmac__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @better-auth/utils/hmac */ \"(rsc)/../../node_modules/@better-auth/utils/dist/hmac.mjs\");\n/* harmony import */ var _better_auth_utils_binary__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @better-auth/utils/binary */ \"(rsc)/../../node_modules/@better-auth/utils/dist/binary.mjs\");\n/* harmony import */ var jose_errors__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! jose/errors */ \"(rsc)/../../node_modules/jose/dist/node/esm/util/errors.js\");\n/* harmony import */ var _better_auth_utils_random__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @better-auth/utils/random */ \"(rsc)/../../node_modules/@better-auth/utils/dist/random.mjs\");\n/* harmony import */ var _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./better-auth.DBGfIDnh.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DBGfIDnh.mjs\");\n/* harmony import */ var _better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./better-auth.n2KFGwjY.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.n2KFGwjY.mjs\");\n/* harmony import */ var _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./better-auth.8zoxzg-F.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs\");\n/* harmony import */ var defu__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! defu */ \"(rsc)/../../node_modules/defu/dist/defu.mjs\");\n/* harmony import */ var _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./better-auth.DdzSJf-n.mjs */ \"(rsc)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst optionsMiddleware = (0,better_call__WEBPACK_IMPORTED_MODULE_0__.createMiddleware)(async () => {\n  return {};\n});\nconst createAuthMiddleware = better_call__WEBPACK_IMPORTED_MODULE_0__.createMiddleware.create({\n  use: [\n    optionsMiddleware,\n    /**\n     * Only use for post hooks\n     */\n    (0,better_call__WEBPACK_IMPORTED_MODULE_0__.createMiddleware)(async () => {\n      return {};\n    })\n  ]\n});\nconst createAuthEndpoint = better_call__WEBPACK_IMPORTED_MODULE_0__.createEndpoint.create({\n  use: [optionsMiddleware]\n});\n\nfunction escapeRegExpChar(char) {\n  if (char === \"-\" || char === \"^\" || char === \"$\" || char === \"+\" || char === \".\" || char === \"(\" || char === \")\" || char === \"|\" || char === \"[\" || char === \"]\" || char === \"{\" || char === \"}\" || char === \"*\" || char === \"?\" || char === \"\\\\\") {\n    return `\\\\${char}`;\n  } else {\n    return char;\n  }\n}\nfunction escapeRegExpString(str) {\n  let result = \"\";\n  for (let i = 0; i < str.length; i++) {\n    result += escapeRegExpChar(str[i]);\n  }\n  return result;\n}\nfunction transform(pattern, separator = true) {\n  if (Array.isArray(pattern)) {\n    let regExpPatterns = pattern.map((p) => `^${transform(p, separator)}$`);\n    return `(?:${regExpPatterns.join(\"|\")})`;\n  }\n  let separatorSplitter = \"\";\n  let separatorMatcher = \"\";\n  let wildcard = \".\";\n  if (separator === true) {\n    separatorSplitter = \"/\";\n    separatorMatcher = \"[/\\\\\\\\]\";\n    wildcard = \"[^/\\\\\\\\]\";\n  } else if (separator) {\n    separatorSplitter = separator;\n    separatorMatcher = escapeRegExpString(separatorSplitter);\n    if (separatorMatcher.length > 1) {\n      separatorMatcher = `(?:${separatorMatcher})`;\n      wildcard = `((?!${separatorMatcher}).)`;\n    } else {\n      wildcard = `[^${separatorMatcher}]`;\n    }\n  }\n  let requiredSeparator = separator ? `${separatorMatcher}+?` : \"\";\n  let optionalSeparator = separator ? `${separatorMatcher}*?` : \"\";\n  let segments = separator ? pattern.split(separatorSplitter) : [pattern];\n  let result = \"\";\n  for (let s = 0; s < segments.length; s++) {\n    let segment = segments[s];\n    let nextSegment = segments[s + 1];\n    let currentSeparator = \"\";\n    if (!segment && s > 0) {\n      continue;\n    }\n    if (separator) {\n      if (s === segments.length - 1) {\n        currentSeparator = optionalSeparator;\n      } else if (nextSegment !== \"**\") {\n        currentSeparator = requiredSeparator;\n      } else {\n        currentSeparator = \"\";\n      }\n    }\n    if (separator && segment === \"**\") {\n      if (currentSeparator) {\n        result += s === 0 ? \"\" : currentSeparator;\n        result += `(?:${wildcard}*?${currentSeparator})*?`;\n      }\n      continue;\n    }\n    for (let c = 0; c < segment.length; c++) {\n      let char = segment[c];\n      if (char === \"\\\\\") {\n        if (c < segment.length - 1) {\n          result += escapeRegExpChar(segment[c + 1]);\n          c++;\n        }\n      } else if (char === \"?\") {\n        result += wildcard;\n      } else if (char === \"*\") {\n        result += `${wildcard}*?`;\n      } else {\n        result += escapeRegExpChar(char);\n      }\n    }\n    result += currentSeparator;\n  }\n  return result;\n}\nfunction isMatch(regexp, sample) {\n  if (typeof sample !== \"string\") {\n    throw new TypeError(`Sample must be a string, but ${typeof sample} given`);\n  }\n  return regexp.test(sample);\n}\nfunction wildcardMatch(pattern, options) {\n  if (typeof pattern !== \"string\" && !Array.isArray(pattern)) {\n    throw new TypeError(\n      `The first argument must be a single pattern string or an array of patterns, but ${typeof pattern} given`\n    );\n  }\n  if (typeof options === \"string\" || typeof options === \"boolean\") {\n    options = { separator: options };\n  }\n  if (arguments.length === 2 && !(typeof options === \"undefined\" || typeof options === \"object\" && options !== null && !Array.isArray(options))) {\n    throw new TypeError(\n      `The second argument must be an options object or a string/boolean separator, but ${typeof options} given`\n    );\n  }\n  options = options || {};\n  if (options.separator === \"\\\\\") {\n    throw new Error(\n      \"\\\\ is not a valid separator because it is used for escaping. Try setting the separator to `true` instead\"\n    );\n  }\n  let regexpPattern = transform(pattern, options.separator);\n  let regexp = new RegExp(`^${regexpPattern}$`, options.flags);\n  let fn = isMatch.bind(null, regexp);\n  fn.options = options;\n  fn.pattern = pattern;\n  fn.regexp = regexp;\n  return fn;\n}\n\nconst originCheckMiddleware = createAuthMiddleware(async (ctx) => {\n  if (ctx.request?.method !== \"POST\" || !ctx.request) {\n    return;\n  }\n  const { body, query, context } = ctx;\n  const originHeader = ctx.headers?.get(\"origin\") || ctx.headers?.get(\"referer\") || \"\";\n  const callbackURL = body?.callbackURL || query?.callbackURL;\n  const redirectURL = body?.redirectTo;\n  const errorCallbackURL = body?.errorCallbackURL;\n  const newUserCallbackURL = body?.newUserCallbackURL;\n  const trustedOrigins = Array.isArray(context.options.trustedOrigins) ? context.trustedOrigins : [\n    ...context.trustedOrigins,\n    ...await context.options.trustedOrigins?.(ctx.request) || []\n  ];\n  const usesCookies = ctx.headers?.has(\"cookie\");\n  const matchesPattern = (url, pattern) => {\n    if (url.startsWith(\"/\")) {\n      return false;\n    }\n    if (pattern.includes(\"*\")) {\n      if (pattern.includes(\"://\")) {\n        return wildcardMatch(pattern)((0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_9__.g)(url) || url);\n      }\n      return wildcardMatch(pattern)((0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_9__.b)(url));\n    }\n    const protocol = (0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_9__.c)(url);\n    return protocol === \"http:\" || protocol === \"https:\" || !protocol ? pattern === (0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_9__.g)(url) : url.startsWith(pattern);\n  };\n  const validateURL = (url, label) => {\n    if (!url) {\n      return;\n    }\n    const isTrustedOrigin = trustedOrigins.some(\n      (origin) => matchesPattern(url, origin) || url?.startsWith(\"/\") && label !== \"origin\" && /^\\/(?!\\/|\\\\|%2f|%5c)[\\w\\-.\\+/@]*(?:\\?[\\w\\-.\\+/=&%@]*)?$/.test(url)\n    );\n    if (!isTrustedOrigin) {\n      ctx.context.logger.error(`Invalid ${label}: ${url}`);\n      ctx.context.logger.info(\n        `If it's a valid URL, please add ${url} to trustedOrigins in your auth config\n`,\n        `Current list of trustedOrigins: ${trustedOrigins}`\n      );\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"FORBIDDEN\", { message: `Invalid ${label}` });\n    }\n  };\n  if (usesCookies && !ctx.context.options.advanced?.disableCSRFCheck) {\n    validateURL(originHeader, \"origin\");\n  }\n  callbackURL && validateURL(callbackURL, \"callbackURL\");\n  redirectURL && validateURL(redirectURL, \"redirectURL\");\n  errorCallbackURL && validateURL(errorCallbackURL, \"errorCallbackURL\");\n  newUserCallbackURL && validateURL(newUserCallbackURL, \"newUserCallbackURL\");\n});\nconst originCheck = (getValue) => createAuthMiddleware(async (ctx) => {\n  if (!ctx.request) {\n    return;\n  }\n  const { context } = ctx;\n  const callbackURL = getValue(ctx);\n  const trustedOrigins = Array.isArray(\n    context.options.trustedOrigins\n  ) ? context.trustedOrigins : [\n    ...context.trustedOrigins,\n    ...await context.options.trustedOrigins?.(ctx.request) || []\n  ];\n  const matchesPattern = (url, pattern) => {\n    if (url.startsWith(\"/\")) {\n      return false;\n    }\n    if (pattern.includes(\"*\")) {\n      if (pattern.includes(\"://\")) {\n        return wildcardMatch(pattern)((0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_9__.g)(url) || url);\n      }\n      return wildcardMatch(pattern)((0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_9__.b)(url));\n    }\n    const protocol = (0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_9__.c)(url);\n    return protocol === \"http:\" || protocol === \"https:\" || !protocol ? pattern === (0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_9__.g)(url) : url.startsWith(pattern);\n  };\n  const validateURL = (url, label) => {\n    if (!url) {\n      return;\n    }\n    const isTrustedOrigin = trustedOrigins.some(\n      (origin) => matchesPattern(url, origin) || url?.startsWith(\"/\") && label !== \"origin\" && /^\\/(?!\\/|\\\\|%2f|%5c)[\\w\\-.\\+/@]*(?:\\?[\\w\\-.\\+/=&%@]*)?$/.test(\n        url\n      )\n    );\n    if (!isTrustedOrigin) {\n      ctx.context.logger.error(`Invalid ${label}: ${url}`);\n      ctx.context.logger.info(\n        `If it's a valid URL, please add ${url} to trustedOrigins in your auth config\n`,\n        `Current list of trustedOrigins: ${trustedOrigins}`\n      );\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"FORBIDDEN\", { message: `Invalid ${label}` });\n    }\n  };\n  const callbacks = Array.isArray(callbackURL) ? callbackURL : [callbackURL];\n  for (const url of callbacks) {\n    validateURL(url, \"callbackURL\");\n  }\n});\n\nconst BASE_ERROR_CODES = {\n  USER_NOT_FOUND: \"User not found\",\n  FAILED_TO_CREATE_USER: \"Failed to create user\",\n  FAILED_TO_CREATE_SESSION: \"Failed to create session\",\n  FAILED_TO_UPDATE_USER: \"Failed to update user\",\n  FAILED_TO_GET_SESSION: \"Failed to get session\",\n  INVALID_PASSWORD: \"Invalid password\",\n  INVALID_EMAIL: \"Invalid email\",\n  INVALID_EMAIL_OR_PASSWORD: \"Invalid email or password\",\n  SOCIAL_ACCOUNT_ALREADY_LINKED: \"Social account already linked\",\n  PROVIDER_NOT_FOUND: \"Provider not found\",\n  INVALID_TOKEN: \"invalid token\",\n  ID_TOKEN_NOT_SUPPORTED: \"id_token not supported\",\n  FAILED_TO_GET_USER_INFO: \"Failed to get user info\",\n  USER_EMAIL_NOT_FOUND: \"User email not found\",\n  EMAIL_NOT_VERIFIED: \"Email not verified\",\n  PASSWORD_TOO_SHORT: \"Password too short\",\n  PASSWORD_TOO_LONG: \"Password too long\",\n  USER_ALREADY_EXISTS: \"User already exists\",\n  EMAIL_CAN_NOT_BE_UPDATED: \"Email can not be updated\",\n  CREDENTIAL_ACCOUNT_NOT_FOUND: \"Credential account not found\",\n  SESSION_EXPIRED: \"Session expired. Re-authenticate to perform this action.\",\n  FAILED_TO_UNLINK_LAST_ACCOUNT: \"You can't unlink your last account\",\n  ACCOUNT_NOT_FOUND: \"Account not found\",\n  USER_ALREADY_HAS_PASSWORD: \"User already has a password. Provide that to delete the account.\"\n};\n\nconst getSession = () => createAuthEndpoint(\n  \"/get-session\",\n  {\n    method: \"GET\",\n    query: zod_v4__WEBPACK_IMPORTED_MODULE_20__.optional(\n      zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n        /**\n         * If cookie cache is enabled, it will disable the cache\n         * and fetch the session from the database\n         */\n        disableCookieCache: zod_v4__WEBPACK_IMPORTED_MODULE_21__.boolean().meta({\n          description: \"Disable cookie cache and fetch session from database\"\n        }).optional(),\n        disableRefresh: zod_v4__WEBPACK_IMPORTED_MODULE_21__.boolean().meta({\n          description: \"Disable session refresh. Useful for checking session status, without updating the session\"\n        }).optional()\n      })\n    ),\n    requireHeaders: true,\n    metadata: {\n      openapi: {\n        description: \"Get the current session\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    session: {\n                      $ref: \"#/components/schemas/Session\"\n                    },\n                    user: {\n                      $ref: \"#/components/schemas/User\"\n                    }\n                  },\n                  required: [\"session\", \"user\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    try {\n      const sessionCookieToken = await ctx.getSignedCookie(\n        ctx.context.authCookies.sessionToken.name,\n        ctx.context.secret\n      );\n      if (!sessionCookieToken) {\n        return null;\n      }\n      const sessionDataCookie = ctx.getCookie(\n        ctx.context.authCookies.sessionData.name\n      );\n      const sessionDataPayload = sessionDataCookie ? (0,_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_11__.s)(_better_auth_utils_binary__WEBPACK_IMPORTED_MODULE_13__.binary.decode(_better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_3__.base64.decode(sessionDataCookie))) : null;\n      if (sessionDataPayload) {\n        const isValid = await (0,_better_auth_utils_hmac__WEBPACK_IMPORTED_MODULE_12__.createHMAC)(\"SHA-256\", \"base64urlnopad\").verify(\n          ctx.context.secret,\n          JSON.stringify({\n            ...sessionDataPayload.session,\n            expiresAt: sessionDataPayload.expiresAt\n          }),\n          sessionDataPayload.signature\n        );\n        if (!isValid) {\n          const dataCookie = ctx.context.authCookies.sessionData.name;\n          ctx.setCookie(dataCookie, \"\", {\n            maxAge: 0\n          });\n          return ctx.json(null);\n        }\n      }\n      const dontRememberMe = await ctx.getSignedCookie(\n        ctx.context.authCookies.dontRememberToken.name,\n        ctx.context.secret\n      );\n      if (sessionDataPayload?.session && ctx.context.options.session?.cookieCache?.enabled && !ctx.query?.disableCookieCache) {\n        const session2 = sessionDataPayload.session;\n        const hasExpired = sessionDataPayload.expiresAt < Date.now() || session2.session.expiresAt < /* @__PURE__ */ new Date();\n        if (!hasExpired) {\n          ctx.context.session = session2;\n          return ctx.json(\n            session2\n          );\n        } else {\n          const dataCookie = ctx.context.authCookies.sessionData.name;\n          ctx.setCookie(dataCookie, \"\", {\n            maxAge: 0\n          });\n        }\n      }\n      const session = await ctx.context.internalAdapter.findSession(sessionCookieToken);\n      ctx.context.session = session;\n      if (!session || session.session.expiresAt < /* @__PURE__ */ new Date()) {\n        (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.deleteSessionCookie)(ctx);\n        if (session) {\n          await ctx.context.internalAdapter.deleteSession(\n            session.session.token\n          );\n        }\n        return ctx.json(null);\n      }\n      if (dontRememberMe || ctx.query?.disableRefresh) {\n        return ctx.json(\n          session\n        );\n      }\n      const expiresIn = ctx.context.sessionConfig.expiresIn;\n      const updateAge = ctx.context.sessionConfig.updateAge;\n      const sessionIsDueToBeUpdatedDate = session.session.expiresAt.valueOf() - expiresIn * 1e3 + updateAge * 1e3;\n      const shouldBeUpdated = sessionIsDueToBeUpdatedDate <= Date.now();\n      if (shouldBeUpdated && (!ctx.query?.disableRefresh || !ctx.context.options.session?.disableSessionRefresh)) {\n        const updatedSession = await ctx.context.internalAdapter.updateSession(\n          session.session.token,\n          {\n            expiresAt: (0,_better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_1__.g)(ctx.context.sessionConfig.expiresIn, \"sec\"),\n            updatedAt: /* @__PURE__ */ new Date()\n          }\n        );\n        if (!updatedSession) {\n          (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.deleteSessionCookie)(ctx);\n          return ctx.json(null, { status: 401 });\n        }\n        const maxAge = (updatedSession.expiresAt.valueOf() - Date.now()) / 1e3;\n        await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.setSessionCookie)(\n          ctx,\n          {\n            session: updatedSession,\n            user: session.user\n          },\n          false,\n          {\n            maxAge\n          }\n        );\n        return ctx.json({\n          session: updatedSession,\n          user: session.user\n        });\n      }\n      await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.setCookieCache)(ctx, session);\n      return ctx.json(\n        session\n      );\n    } catch (error) {\n      ctx.context.logger.error(\"INTERNAL_SERVER_ERROR\", error);\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"INTERNAL_SERVER_ERROR\", {\n        message: BASE_ERROR_CODES.FAILED_TO_GET_SESSION\n      });\n    }\n  }\n);\nconst getSessionFromCtx = async (ctx, config) => {\n  if (ctx.context.session) {\n    return ctx.context.session;\n  }\n  const session = await getSession()({\n    ...ctx,\n    asResponse: false,\n    headers: ctx.headers,\n    returnHeaders: false,\n    query: {\n      ...config,\n      ...ctx.query\n    }\n  }).catch((e) => {\n    return null;\n  });\n  ctx.context.session = session;\n  return session;\n};\nconst sessionMiddleware = createAuthMiddleware(async (ctx) => {\n  const session = await getSessionFromCtx(ctx);\n  if (!session?.session) {\n    throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\");\n  }\n  return {\n    session\n  };\n});\nconst requestOnlySessionMiddleware = createAuthMiddleware(\n  async (ctx) => {\n    const session = await getSessionFromCtx(ctx);\n    if (!session?.session && (ctx.request || ctx.headers)) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\");\n    }\n    return { session };\n  }\n);\nconst freshSessionMiddleware = createAuthMiddleware(async (ctx) => {\n  const session = await getSessionFromCtx(ctx);\n  if (!session?.session) {\n    throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\");\n  }\n  if (ctx.context.sessionConfig.freshAge === 0) {\n    return {\n      session\n    };\n  }\n  const freshAge = ctx.context.sessionConfig.freshAge;\n  const lastUpdated = session.session.updatedAt?.valueOf() || session.session.createdAt.valueOf();\n  const now = Date.now();\n  const isFresh = now - lastUpdated < freshAge * 1e3;\n  if (!isFresh) {\n    throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"FORBIDDEN\", {\n      message: \"Session is not fresh\"\n    });\n  }\n  return {\n    session\n  };\n});\nconst listSessions = () => createAuthEndpoint(\n  \"/list-sessions\",\n  {\n    method: \"GET\",\n    use: [sessionMiddleware],\n    requireHeaders: true,\n    metadata: {\n      openapi: {\n        description: \"List all active sessions for the user\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"array\",\n                  items: {\n                    $ref: \"#/components/schemas/Session\"\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    try {\n      const sessions = await ctx.context.internalAdapter.listSessions(\n        ctx.context.session.user.id\n      );\n      const activeSessions = sessions.filter((session) => {\n        return session.expiresAt > /* @__PURE__ */ new Date();\n      });\n      return ctx.json(\n        activeSessions\n      );\n    } catch (e) {\n      ctx.context.logger.error(e);\n      throw ctx.error(\"INTERNAL_SERVER_ERROR\");\n    }\n  }\n);\nconst revokeSession = createAuthEndpoint(\n  \"/revoke-session\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      token: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The token to revoke\"\n      })\n    }),\n    use: [sessionMiddleware],\n    requireHeaders: true,\n    metadata: {\n      openapi: {\n        description: \"Revoke a single session\",\n        requestBody: {\n          content: {\n            \"application/json\": {\n              schema: {\n                type: \"object\",\n                properties: {\n                  token: {\n                    type: \"string\",\n                    description: \"The token to revoke\"\n                  }\n                },\n                required: [\"token\"]\n              }\n            }\n          }\n        },\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    status: {\n                      type: \"boolean\",\n                      description: \"Indicates if the session was revoked successfully\"\n                    }\n                  },\n                  required: [\"status\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    const token = ctx.body.token;\n    const findSession = await ctx.context.internalAdapter.findSession(token);\n    if (!findSession) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Session not found\"\n      });\n    }\n    if (findSession.session.userId !== ctx.context.session.user.id) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\");\n    }\n    try {\n      await ctx.context.internalAdapter.deleteSession(token);\n    } catch (error) {\n      ctx.context.logger.error(\n        error && typeof error === \"object\" && \"name\" in error ? error.name : \"\",\n        error\n      );\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"INTERNAL_SERVER_ERROR\");\n    }\n    return ctx.json({\n      status: true\n    });\n  }\n);\nconst revokeSessions = createAuthEndpoint(\n  \"/revoke-sessions\",\n  {\n    method: \"POST\",\n    use: [sessionMiddleware],\n    requireHeaders: true,\n    metadata: {\n      openapi: {\n        description: \"Revoke all sessions for the user\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    status: {\n                      type: \"boolean\",\n                      description: \"Indicates if all sessions were revoked successfully\"\n                    }\n                  },\n                  required: [\"status\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    try {\n      await ctx.context.internalAdapter.deleteSessions(\n        ctx.context.session.user.id\n      );\n    } catch (error) {\n      ctx.context.logger.error(\n        error && typeof error === \"object\" && \"name\" in error ? error.name : \"\",\n        error\n      );\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"INTERNAL_SERVER_ERROR\");\n    }\n    return ctx.json({\n      status: true\n    });\n  }\n);\nconst revokeOtherSessions = createAuthEndpoint(\n  \"/revoke-other-sessions\",\n  {\n    method: \"POST\",\n    requireHeaders: true,\n    use: [sessionMiddleware],\n    metadata: {\n      openapi: {\n        description: \"Revoke all other sessions for the user except the current one\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    status: {\n                      type: \"boolean\",\n                      description: \"Indicates if all other sessions were revoked successfully\"\n                    }\n                  },\n                  required: [\"status\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    const session = ctx.context.session;\n    if (!session.user) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\");\n    }\n    const sessions = await ctx.context.internalAdapter.listSessions(\n      session.user.id\n    );\n    const activeSessions = sessions.filter((session2) => {\n      return session2.expiresAt > /* @__PURE__ */ new Date();\n    });\n    const otherSessions = activeSessions.filter(\n      (session2) => session2.token !== ctx.context.session.session.token\n    );\n    await Promise.all(\n      otherSessions.map(\n        (session2) => ctx.context.internalAdapter.deleteSession(session2.token)\n      )\n    );\n    return ctx.json({\n      status: true\n    });\n  }\n);\n\nasync function createEmailVerificationToken(secret, email, updateTo, expiresIn = 3600) {\n  const token = await (0,_crypto_index_mjs__WEBPACK_IMPORTED_MODULE_4__.signJWT)(\n    {\n      email: email.toLowerCase(),\n      updateTo\n    },\n    secret,\n    expiresIn\n  );\n  return token;\n}\nasync function sendVerificationEmailFn(ctx, user) {\n  if (!ctx.context.options.emailVerification?.sendVerificationEmail) {\n    ctx.context.logger.error(\"Verification email isn't enabled.\");\n    throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n      message: \"Verification email isn't enabled\"\n    });\n  }\n  const token = await createEmailVerificationToken(\n    ctx.context.secret,\n    user.email,\n    void 0,\n    ctx.context.options.emailVerification?.expiresIn\n  );\n  const url = `${ctx.context.baseURL}/verify-email?token=${token}&callbackURL=${ctx.body.callbackURL || \"/\"}`;\n  await ctx.context.options.emailVerification.sendVerificationEmail(\n    {\n      user,\n      url,\n      token\n    },\n    ctx.request\n  );\n}\nconst sendVerificationEmail = createAuthEndpoint(\n  \"/send-verification-email\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      email: zod_v4__WEBPACK_IMPORTED_MODULE_20__.email().meta({\n        description: \"The email to send the verification email to\"\n      }),\n      callbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The URL to use for email verification callback\"\n      }).optional()\n    }),\n    metadata: {\n      openapi: {\n        description: \"Send a verification email to the user\",\n        requestBody: {\n          content: {\n            \"application/json\": {\n              schema: {\n                type: \"object\",\n                properties: {\n                  email: {\n                    type: \"string\",\n                    description: \"The email to send the verification email to\",\n                    example: \"user@example.com\"\n                  },\n                  callbackURL: {\n                    type: \"string\",\n                    description: \"The URL to use for email verification callback\",\n                    example: \"https://example.com/callback\",\n                    nullable: true\n                  }\n                },\n                required: [\"email\"]\n              }\n            }\n          }\n        },\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    status: {\n                      type: \"boolean\",\n                      description: \"Indicates if the email was sent successfully\",\n                      example: true\n                    }\n                  }\n                }\n              }\n            }\n          },\n          \"400\": {\n            description: \"Bad Request\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    message: {\n                      type: \"string\",\n                      description: \"Error message\",\n                      example: \"Verification email isn't enabled\"\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    if (!ctx.context.options.emailVerification?.sendVerificationEmail) {\n      ctx.context.logger.error(\"Verification email isn't enabled.\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Verification email isn't enabled\"\n      });\n    }\n    const { email } = ctx.body;\n    const session = await getSessionFromCtx(ctx);\n    if (!session) {\n      const user = await ctx.context.internalAdapter.findUserByEmail(email);\n      if (!user) {\n        return ctx.json({\n          status: true\n        });\n      }\n      await sendVerificationEmailFn(ctx, user.user);\n      return ctx.json({\n        status: true\n      });\n    }\n    if (session?.user.emailVerified) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"You can only send a verification email to an unverified email\"\n      });\n    }\n    if (session?.user.email !== email) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"You can only send a verification email to your own email\"\n      });\n    }\n    await sendVerificationEmailFn(ctx, session.user);\n    return ctx.json({\n      status: true\n    });\n  }\n);\nconst verifyEmail = createAuthEndpoint(\n  \"/verify-email\",\n  {\n    method: \"GET\",\n    query: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      token: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The token to verify the email\"\n      }),\n      callbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The URL to redirect to after email verification\"\n      }).optional()\n    }),\n    use: [originCheck((ctx) => ctx.query.callbackURL)],\n    metadata: {\n      openapi: {\n        description: \"Verify the email of the user\",\n        parameters: [\n          {\n            name: \"token\",\n            in: \"query\",\n            description: \"The token to verify the email\",\n            required: true,\n            schema: {\n              type: \"string\"\n            }\n          },\n          {\n            name: \"callbackURL\",\n            in: \"query\",\n            description: \"The URL to redirect to after email verification\",\n            required: false,\n            schema: {\n              type: \"string\"\n            }\n          }\n        ],\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    user: {\n                      type: \"object\",\n                      properties: {\n                        id: {\n                          type: \"string\",\n                          description: \"User ID\"\n                        },\n                        email: {\n                          type: \"string\",\n                          description: \"User email\"\n                        },\n                        name: {\n                          type: \"string\",\n                          description: \"User name\"\n                        },\n                        image: {\n                          type: \"string\",\n                          description: \"User image URL\"\n                        },\n                        emailVerified: {\n                          type: \"boolean\",\n                          description: \"Indicates if the user email is verified\"\n                        },\n                        createdAt: {\n                          type: \"string\",\n                          description: \"User creation date\"\n                        },\n                        updatedAt: {\n                          type: \"string\",\n                          description: \"User update date\"\n                        }\n                      },\n                      required: [\n                        \"id\",\n                        \"email\",\n                        \"name\",\n                        \"image\",\n                        \"emailVerified\",\n                        \"createdAt\",\n                        \"updatedAt\"\n                      ]\n                    },\n                    status: {\n                      type: \"boolean\",\n                      description: \"Indicates if the email was verified successfully\"\n                    }\n                  },\n                  required: [\"user\", \"status\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    function redirectOnError(error) {\n      if (ctx.query.callbackURL) {\n        if (ctx.query.callbackURL.includes(\"?\")) {\n          throw ctx.redirect(`${ctx.query.callbackURL}&error=${error}`);\n        }\n        throw ctx.redirect(`${ctx.query.callbackURL}?error=${error}`);\n      }\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n        message: error\n      });\n    }\n    const { token } = ctx.query;\n    let jwt;\n    try {\n      jwt = await (0,jose__WEBPACK_IMPORTED_MODULE_22__.jwtVerify)(\n        token,\n        new TextEncoder().encode(ctx.context.secret),\n        {\n          algorithms: [\"HS256\"]\n        }\n      );\n    } catch (e) {\n      if (e instanceof jose_errors__WEBPACK_IMPORTED_MODULE_23__.JWTExpired) {\n        return redirectOnError(\"token_expired\");\n      }\n      return redirectOnError(\"invalid_token\");\n    }\n    const schema = zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      email: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().email(),\n      updateTo: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional()\n    });\n    const parsed = schema.parse(jwt.payload);\n    const user = await ctx.context.internalAdapter.findUserByEmail(\n      parsed.email\n    );\n    if (!user) {\n      return redirectOnError(\"user_not_found\");\n    }\n    if (parsed.updateTo) {\n      const session = await getSessionFromCtx(ctx);\n      if (!session) {\n        if (ctx.query.callbackURL) {\n          throw ctx.redirect(`${ctx.query.callbackURL}?error=unauthorized`);\n        }\n        return redirectOnError(\"unauthorized\");\n      }\n      if (session.user.email !== parsed.email) {\n        if (ctx.query.callbackURL) {\n          throw ctx.redirect(`${ctx.query.callbackURL}?error=unauthorized`);\n        }\n        return redirectOnError(\"unauthorized\");\n      }\n      const updatedUser2 = await ctx.context.internalAdapter.updateUserByEmail(\n        parsed.email,\n        {\n          email: parsed.updateTo,\n          emailVerified: false\n        },\n        ctx\n      );\n      const newToken = await createEmailVerificationToken(\n        ctx.context.secret,\n        parsed.updateTo\n      );\n      await ctx.context.options.emailVerification?.sendVerificationEmail?.(\n        {\n          user: updatedUser2,\n          url: `${ctx.context.baseURL}/verify-email?token=${newToken}&callbackURL=${ctx.query.callbackURL || \"/\"}`,\n          token: newToken\n        },\n        ctx.request\n      );\n      await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.setSessionCookie)(ctx, {\n        session: session.session,\n        user: {\n          ...session.user,\n          email: parsed.updateTo,\n          emailVerified: false\n        }\n      });\n      if (ctx.query.callbackURL) {\n        throw ctx.redirect(ctx.query.callbackURL);\n      }\n      return ctx.json({\n        status: true,\n        user: {\n          id: updatedUser2.id,\n          email: updatedUser2.email,\n          name: updatedUser2.name,\n          image: updatedUser2.image,\n          emailVerified: updatedUser2.emailVerified,\n          createdAt: updatedUser2.createdAt,\n          updatedAt: updatedUser2.updatedAt\n        }\n      });\n    }\n    if (ctx.context.options.emailVerification?.onEmailVerification) {\n      await ctx.context.options.emailVerification.onEmailVerification(\n        user.user,\n        ctx.request\n      );\n    }\n    const updatedUser = await ctx.context.internalAdapter.updateUserByEmail(\n      parsed.email,\n      {\n        emailVerified: true\n      },\n      ctx\n    );\n    if (ctx.context.options.emailVerification?.afterEmailVerification) {\n      await ctx.context.options.emailVerification.afterEmailVerification(\n        updatedUser,\n        ctx.request\n      );\n    }\n    if (ctx.context.options.emailVerification?.autoSignInAfterVerification) {\n      const currentSession = await getSessionFromCtx(ctx);\n      if (!currentSession || currentSession.user.email !== parsed.email) {\n        const session = await ctx.context.internalAdapter.createSession(\n          user.user.id,\n          ctx\n        );\n        if (!session) {\n          throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"INTERNAL_SERVER_ERROR\", {\n            message: \"Failed to create session\"\n          });\n        }\n        await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.setSessionCookie)(ctx, {\n          session,\n          user: {\n            ...user.user,\n            emailVerified: true\n          }\n        });\n      } else {\n        await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.setSessionCookie)(ctx, {\n          session: currentSession.session,\n          user: {\n            ...currentSession.user,\n            emailVerified: true\n          }\n        });\n      }\n    }\n    if (ctx.query.callbackURL) {\n      throw ctx.redirect(ctx.query.callbackURL);\n    }\n    return ctx.json({\n      status: true,\n      user: null\n    });\n  }\n);\n\nconst HIDE_METADATA = {\n  isAction: false\n};\n\nasync function generateState(c, link) {\n  const callbackURL = c.body?.callbackURL || c.context.options.baseURL;\n  if (!callbackURL) {\n    throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n      message: \"callbackURL is required\"\n    });\n  }\n  const codeVerifier = (0,_better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_8__.g)(128);\n  const state = (0,_better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_8__.g)(32);\n  const data = JSON.stringify({\n    callbackURL,\n    codeVerifier,\n    errorURL: c.body?.errorCallbackURL,\n    newUserURL: c.body?.newUserCallbackURL,\n    link,\n    /**\n     * This is the actual expiry time of the state\n     */\n    expiresAt: Date.now() + 10 * 60 * 1e3,\n    requestSignUp: c.body?.requestSignUp\n  });\n  const expiresAt = /* @__PURE__ */ new Date();\n  expiresAt.setMinutes(expiresAt.getMinutes() + 10);\n  const verification = await c.context.internalAdapter.createVerificationValue(\n    {\n      value: data,\n      identifier: state,\n      expiresAt\n    },\n    c\n  );\n  if (!verification) {\n    c.context.logger.error(\n      \"Unable to create verification. Make sure the database adapter is properly working and there is a verification table in the database\"\n    );\n    throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"INTERNAL_SERVER_ERROR\", {\n      message: \"Unable to create verification\"\n    });\n  }\n  return {\n    state: verification.identifier,\n    codeVerifier\n  };\n}\nasync function parseState(c) {\n  const state = c.query.state || c.body.state;\n  const data = await c.context.internalAdapter.findVerificationValue(state);\n  if (!data) {\n    c.context.logger.error(\"State Mismatch. Verification not found\", {\n      state\n    });\n    const errorURL = c.context.options.onAPIError?.errorURL || `${c.context.baseURL}/error`;\n    throw c.redirect(`${errorURL}?error=please_restart_the_process`);\n  }\n  const parsedData = zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n    callbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string(),\n    codeVerifier: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string(),\n    errorURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional(),\n    newUserURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional(),\n    expiresAt: zod_v4__WEBPACK_IMPORTED_MODULE_20__.number(),\n    link: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      email: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string(),\n      userId: zod_v4__WEBPACK_IMPORTED_MODULE_21__.string()\n    }).optional(),\n    requestSignUp: zod_v4__WEBPACK_IMPORTED_MODULE_20__.boolean().optional()\n  }).parse(JSON.parse(data.value));\n  if (!parsedData.errorURL) {\n    parsedData.errorURL = `${c.context.baseURL}/error`;\n  }\n  if (parsedData.expiresAt < Date.now()) {\n    await c.context.internalAdapter.deleteVerificationValue(data.id);\n    const errorURL = c.context.options.onAPIError?.errorURL || `${c.context.baseURL}/error`;\n    throw c.redirect(`${errorURL}?error=please_restart_the_process`);\n  }\n  await c.context.internalAdapter.deleteVerificationValue(data.id);\n  return parsedData;\n}\n\nasync function generateCodeChallenge(codeVerifier) {\n  const codeChallengeBytes = await (0,_better_auth_utils_hash__WEBPACK_IMPORTED_MODULE_2__.createHash)(\"SHA-256\").digest(codeVerifier);\n  return _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_3__.base64Url.encode(new Uint8Array(codeChallengeBytes), {\n    padding: false\n  });\n}\nfunction getOAuth2Tokens(data) {\n  return {\n    tokenType: data.token_type,\n    accessToken: data.access_token,\n    refreshToken: data.refresh_token,\n    accessTokenExpiresAt: data.expires_in ? (0,_better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_1__.g)(data.expires_in, \"sec\") : void 0,\n    refreshTokenExpiresAt: data.refresh_token_expires_in ? (0,_better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_1__.g)(data.refresh_token_expires_in, \"sec\") : void 0,\n    scopes: data?.scope ? typeof data.scope === \"string\" ? data.scope.split(\" \") : data.scope : [],\n    idToken: data.id_token\n  };\n}\nconst encodeOAuthParameter = (value) => encodeURIComponent(value).replace(/%20/g, \"+\");\nfunction decryptOAuthToken(token, ctx) {\n  if (!token) return token;\n  if (ctx.options.account?.encryptOAuthTokens) {\n    return (0,_crypto_index_mjs__WEBPACK_IMPORTED_MODULE_4__.symmetricDecrypt)({\n      key: ctx.secret,\n      data: token\n    });\n  }\n  return token;\n}\nfunction setTokenUtil(token, ctx) {\n  if (ctx.options.account?.encryptOAuthTokens && token) {\n    return (0,_crypto_index_mjs__WEBPACK_IMPORTED_MODULE_4__.symmetricEncrypt)({\n      key: ctx.secret,\n      data: token\n    });\n  }\n  return token;\n}\n\nasync function handleOAuthUserInfo(c, {\n  userInfo,\n  account,\n  callbackURL,\n  disableSignUp,\n  overrideUserInfo\n}) {\n  const dbUser = await c.context.internalAdapter.findOAuthUser(\n    userInfo.email.toLowerCase(),\n    account.accountId,\n    account.providerId\n  ).catch((e) => {\n    _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_15__.a.error(\n      \"Better auth was unable to query your database.\\nError: \",\n      e\n    );\n    const errorURL = c.context.options.onAPIError?.errorURL || `${c.context.baseURL}/error`;\n    throw c.redirect(`${errorURL}?error=internal_server_error`);\n  });\n  let user = dbUser?.user;\n  let isRegister = !user;\n  if (dbUser) {\n    const hasBeenLinked = dbUser.accounts.find(\n      (a) => a.providerId === account.providerId && a.accountId === account.accountId\n    );\n    if (!hasBeenLinked) {\n      const trustedProviders = c.context.options.account?.accountLinking?.trustedProviders;\n      const isTrustedProvider = trustedProviders?.includes(\n        account.providerId\n      );\n      if (!isTrustedProvider && !userInfo.emailVerified || c.context.options.account?.accountLinking?.enabled === false) {\n        if (_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_17__.b) {\n          _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_15__.a.warn(\n            `User already exist but account isn't linked to ${account.providerId}. To read more about how account linking works in Better Auth see https://www.better-auth.com/docs/concepts/users-accounts#account-linking.`\n          );\n        }\n        return {\n          error: \"account not linked\",\n          data: null\n        };\n      }\n      try {\n        await c.context.internalAdapter.linkAccount(\n          {\n            providerId: account.providerId,\n            accountId: userInfo.id.toString(),\n            userId: dbUser.user.id,\n            accessToken: await setTokenUtil(account.accessToken, c.context),\n            refreshToken: await setTokenUtil(account.refreshToken, c.context),\n            idToken: account.idToken,\n            accessTokenExpiresAt: account.accessTokenExpiresAt,\n            refreshTokenExpiresAt: account.refreshTokenExpiresAt,\n            scope: account.scope\n          },\n          c\n        );\n      } catch (e) {\n        _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_15__.a.error(\"Unable to link account\", e);\n        return {\n          error: \"unable to link account\",\n          data: null\n        };\n      }\n    } else {\n      if (c.context.options.account?.updateAccountOnSignIn !== false) {\n        const updateData = Object.fromEntries(\n          Object.entries({\n            idToken: account.idToken,\n            accessToken: await setTokenUtil(account.accessToken, c.context),\n            refreshToken: await setTokenUtil(account.refreshToken, c.context),\n            accessTokenExpiresAt: account.accessTokenExpiresAt,\n            refreshTokenExpiresAt: account.refreshTokenExpiresAt,\n            scope: account.scope\n          }).filter(([_, value]) => value !== void 0)\n        );\n        if (Object.keys(updateData).length > 0) {\n          await c.context.internalAdapter.updateAccount(\n            hasBeenLinked.id,\n            updateData,\n            c\n          );\n        }\n      }\n    }\n    if (overrideUserInfo) {\n      const { id: _, ...restUserInfo } = userInfo;\n      await c.context.internalAdapter.updateUser(dbUser.user.id, {\n        ...restUserInfo,\n        email: userInfo.email.toLowerCase(),\n        emailVerified: userInfo.email.toLowerCase() === dbUser.user.email ? dbUser.user.emailVerified || userInfo.emailVerified : userInfo.emailVerified\n      });\n    }\n  } else {\n    if (disableSignUp) {\n      return {\n        error: \"signup disabled\",\n        data: null,\n        isRegister: false\n      };\n    }\n    try {\n      const { id: _, ...restUserInfo } = userInfo;\n      user = await c.context.internalAdapter.createOAuthUser(\n        {\n          ...restUserInfo,\n          email: userInfo.email.toLowerCase()\n        },\n        {\n          accessToken: await setTokenUtil(account.accessToken, c.context),\n          refreshToken: await setTokenUtil(account.refreshToken, c.context),\n          idToken: account.idToken,\n          accessTokenExpiresAt: account.accessTokenExpiresAt,\n          refreshTokenExpiresAt: account.refreshTokenExpiresAt,\n          scope: account.scope,\n          providerId: account.providerId,\n          accountId: userInfo.id.toString()\n        },\n        c\n      ).then((res) => res?.user);\n      if (!userInfo.emailVerified && user && c.context.options.emailVerification?.sendOnSignUp) {\n        const token = await createEmailVerificationToken(\n          c.context.secret,\n          user.email,\n          void 0,\n          c.context.options.emailVerification?.expiresIn\n        );\n        const url = `${c.context.baseURL}/verify-email?token=${token}&callbackURL=${callbackURL}`;\n        await c.context.options.emailVerification?.sendVerificationEmail?.(\n          {\n            user,\n            url,\n            token\n          },\n          c.request\n        );\n      }\n    } catch (e) {\n      _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_15__.a.error(e);\n      if (e instanceof better_call__WEBPACK_IMPORTED_MODULE_0__.APIError) {\n        return {\n          error: e.message,\n          data: null,\n          isRegister: false\n        };\n      }\n      return {\n        error: \"unable to create user\",\n        data: null,\n        isRegister: false\n      };\n    }\n  }\n  if (!user) {\n    return {\n      error: \"unable to create user\",\n      data: null,\n      isRegister: false\n    };\n  }\n  const session = await c.context.internalAdapter.createSession(user.id, c);\n  if (!session) {\n    return {\n      error: \"unable to create session\",\n      data: null,\n      isRegister: false\n    };\n  }\n  return {\n    data: {\n      session,\n      user\n    },\n    error: null,\n    isRegister\n  };\n}\n\nasync function createAuthorizationURL({\n  id,\n  options,\n  authorizationEndpoint,\n  state,\n  codeVerifier,\n  scopes,\n  claims,\n  redirectURI,\n  duration,\n  prompt,\n  accessType,\n  responseType,\n  display,\n  loginHint,\n  hd,\n  responseMode,\n  additionalParams,\n  scopeJoiner\n}) {\n  const url = new URL(authorizationEndpoint);\n  url.searchParams.set(\"response_type\", responseType || \"code\");\n  url.searchParams.set(\"client_id\", options.clientId);\n  url.searchParams.set(\"state\", state);\n  url.searchParams.set(\"scope\", scopes.join(scopeJoiner || \" \"));\n  url.searchParams.set(\"redirect_uri\", options.redirectURI || redirectURI);\n  duration && url.searchParams.set(\"duration\", duration);\n  display && url.searchParams.set(\"display\", display);\n  loginHint && url.searchParams.set(\"login_hint\", loginHint);\n  prompt && url.searchParams.set(\"prompt\", prompt);\n  hd && url.searchParams.set(\"hd\", hd);\n  accessType && url.searchParams.set(\"access_type\", accessType);\n  responseMode && url.searchParams.set(\"response_mode\", responseMode);\n  if (codeVerifier) {\n    const codeChallenge = await generateCodeChallenge(codeVerifier);\n    url.searchParams.set(\"code_challenge_method\", \"S256\");\n    url.searchParams.set(\"code_challenge\", codeChallenge);\n  }\n  if (claims) {\n    const claimsObj = claims.reduce(\n      (acc, claim) => {\n        acc[claim] = null;\n        return acc;\n      },\n      {}\n    );\n    url.searchParams.set(\n      \"claims\",\n      JSON.stringify({\n        id_token: { email: null, email_verified: null, ...claimsObj }\n      })\n    );\n  }\n  if (additionalParams) {\n    Object.entries(additionalParams).forEach(([key, value]) => {\n      url.searchParams.set(key, value);\n    });\n  }\n  return url;\n}\n\nasync function validateAuthorizationCode({\n  code,\n  codeVerifier,\n  redirectURI,\n  options,\n  tokenEndpoint,\n  authentication,\n  deviceId,\n  headers,\n  additionalParams = {}\n}) {\n  const body = new URLSearchParams();\n  const requestHeaders = {\n    \"content-type\": \"application/x-www-form-urlencoded\",\n    accept: \"application/json\",\n    \"user-agent\": \"better-auth\",\n    ...headers\n  };\n  body.set(\"grant_type\", \"authorization_code\");\n  body.set(\"code\", code);\n  codeVerifier && body.set(\"code_verifier\", codeVerifier);\n  options.clientKey && body.set(\"client_key\", options.clientKey);\n  deviceId && body.set(\"device_id\", deviceId);\n  body.set(\"redirect_uri\", options.redirectURI || redirectURI);\n  body.set(\"client_id\", options.clientId);\n  if (authentication === \"basic\") {\n    const encodedCredentials = _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_3__.base64.encode(\n      `${options.clientId}:${options.clientSecret}`\n    );\n    requestHeaders[\"authorization\"] = `Basic ${encodedCredentials}`;\n  } else {\n    body.set(\"client_secret\", options.clientSecret);\n  }\n  for (const [key, value] of Object.entries(additionalParams)) {\n    if (!body.has(key)) body.append(key, value);\n  }\n  const { data, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(tokenEndpoint, {\n    method: \"POST\",\n    body,\n    headers: requestHeaders\n  });\n  if (error) {\n    throw error;\n  }\n  const tokens = getOAuth2Tokens(data);\n  return tokens;\n}\nasync function validateToken(token, jwksEndpoint) {\n  const { data, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(jwksEndpoint, {\n    method: \"GET\",\n    headers: {\n      accept: \"application/json\",\n      \"user-agent\": \"better-auth\"\n    }\n  });\n  if (error) {\n    throw error;\n  }\n  const keys = data[\"keys\"];\n  const header = JSON.parse(atob(token.split(\".\")[0]));\n  const key = keys.find((key2) => key2.kid === header.kid);\n  if (!key) {\n    throw new Error(\"Key not found\");\n  }\n  const verified = await (0,jose__WEBPACK_IMPORTED_MODULE_22__.jwtVerify)(token, key);\n  return verified;\n}\n\nasync function refreshAccessToken({\n  refreshToken,\n  options,\n  tokenEndpoint,\n  authentication,\n  extraParams,\n  grantType = \"refresh_token\"\n}) {\n  const body = new URLSearchParams();\n  const headers = {\n    \"content-type\": \"application/x-www-form-urlencoded\",\n    accept: \"application/json\"\n  };\n  body.set(\"grant_type\", grantType);\n  body.set(\"refresh_token\", refreshToken);\n  if (authentication === \"basic\") {\n    headers[\"authorization\"] = _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_3__.base64.encode(\n      `${options.clientId}:${options.clientSecret}`\n    );\n  } else {\n    body.set(\"client_id\", options.clientId);\n    body.set(\"client_secret\", options.clientSecret);\n  }\n  if (extraParams) {\n    for (const [key, value] of Object.entries(extraParams)) {\n      body.set(key, value);\n    }\n  }\n  const { data, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(tokenEndpoint, {\n    method: \"POST\",\n    body,\n    headers\n  });\n  if (error) {\n    throw error;\n  }\n  const tokens = {\n    accessToken: data.access_token,\n    refreshToken: data.refresh_token,\n    tokenType: data.token_type,\n    scopes: data.scope?.split(\" \"),\n    idToken: data.id_token\n  };\n  if (data.expires_in) {\n    const now = /* @__PURE__ */ new Date();\n    tokens.accessTokenExpiresAt = new Date(\n      now.getTime() + data.expires_in * 1e3\n    );\n  }\n  return tokens;\n}\n\nconst apple = (options) => {\n  const tokenEndpoint = \"https://appleid.apple.com/auth/token\";\n  return {\n    id: \"apple\",\n    name: \"Apple\",\n    async createAuthorizationURL({ state, scopes, redirectURI }) {\n      const _scope = options.disableDefaultScope ? [] : [\"email\", \"name\"];\n      options.scope && _scope.push(...options.scope);\n      scopes && _scope.push(...scopes);\n      const url = await createAuthorizationURL({\n        id: \"apple\",\n        options,\n        authorizationEndpoint: \"https://appleid.apple.com/auth/authorize\",\n        scopes: _scope,\n        state,\n        redirectURI,\n        responseMode: \"form_post\",\n        responseType: \"code id_token\"\n      });\n      return url;\n    },\n    validateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        codeVerifier,\n        redirectURI,\n        options,\n        tokenEndpoint\n      });\n    },\n    async verifyIdToken(token, nonce) {\n      if (options.disableIdTokenSignIn) {\n        return false;\n      }\n      if (options.verifyIdToken) {\n        return options.verifyIdToken(token, nonce);\n      }\n      const decodedHeader = (0,jose__WEBPACK_IMPORTED_MODULE_24__.decodeProtectedHeader)(token);\n      const { kid, alg: jwtAlg } = decodedHeader;\n      if (!kid || !jwtAlg) return false;\n      const publicKey = await getApplePublicKey(kid);\n      const { payload: jwtClaims } = await (0,jose__WEBPACK_IMPORTED_MODULE_22__.jwtVerify)(token, publicKey, {\n        algorithms: [jwtAlg],\n        issuer: \"https://appleid.apple.com\",\n        audience: options.appBundleIdentifier || options.clientId,\n        maxTokenAge: \"1h\"\n      });\n      [\"email_verified\", \"is_private_email\"].forEach((field) => {\n        if (jwtClaims[field] !== void 0) {\n          jwtClaims[field] = Boolean(jwtClaims[field]);\n        }\n      });\n      if (nonce && jwtClaims.nonce !== nonce) {\n        return false;\n      }\n      return !!jwtClaims;\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://appleid.apple.com/auth/token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      if (!token.idToken) {\n        return null;\n      }\n      const profile = (0,jose__WEBPACK_IMPORTED_MODULE_25__.decodeJwt)(token.idToken);\n      if (!profile) {\n        return null;\n      }\n      const name = token.user ? `${token.user.name?.firstName} ${token.user.name?.lastName}` : profile.name || profile.email;\n      const emailVerified = typeof profile.email_verified === \"boolean\" ? profile.email_verified : profile.email_verified === \"true\";\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.sub,\n          name,\n          emailVerified,\n          email: profile.email,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\nconst getApplePublicKey = async (kid) => {\n  const APPLE_BASE_URL = \"https://appleid.apple.com\";\n  const JWKS_APPLE_URI = \"/auth/keys\";\n  const { data } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(`${APPLE_BASE_URL}${JWKS_APPLE_URI}`);\n  if (!data?.keys) {\n    throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n      message: \"Keys not found\"\n    });\n  }\n  const jwk = data.keys.find((key) => key.kid === kid);\n  if (!jwk) {\n    throw new Error(`JWK with kid ${kid} not found`);\n  }\n  return await (0,jose__WEBPACK_IMPORTED_MODULE_26__.importJWK)(jwk, jwk.alg);\n};\n\nconst discord = (options) => {\n  return {\n    id: \"discord\",\n    name: \"Discord\",\n    createAuthorizationURL({ state, scopes, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"identify\", \"email\"];\n      scopes && _scopes.push(...scopes);\n      options.scope && _scopes.push(...options.scope);\n      return new URL(\n        `https://discord.com/api/oauth2/authorize?scope=${_scopes.join(\n          \"+\"\n        )}&response_type=code&client_id=${options.clientId}&redirect_uri=${encodeURIComponent(\n          options.redirectURI || redirectURI\n        )}&state=${state}&prompt=${options.prompt || \"none\"}`\n      );\n    },\n    validateAuthorizationCode: async ({ code, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        redirectURI,\n        options,\n        tokenEndpoint: \"https://discord.com/api/oauth2/token\"\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://discord.com/api/oauth2/token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://discord.com/api/users/@me\",\n        {\n          headers: {\n            authorization: `Bearer ${token.accessToken}`\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      if (profile.avatar === null) {\n        const defaultAvatarNumber = profile.discriminator === \"0\" ? Number(BigInt(profile.id) >> BigInt(22)) % 6 : parseInt(profile.discriminator) % 5;\n        profile.image_url = `https://cdn.discordapp.com/embed/avatars/${defaultAvatarNumber}.png`;\n      } else {\n        const format = profile.avatar.startsWith(\"a_\") ? \"gif\" : \"png\";\n        profile.image_url = `https://cdn.discordapp.com/avatars/${profile.id}/${profile.avatar}.${format}`;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.id,\n          name: profile.global_name || profile.username || \"\",\n          email: profile.email,\n          emailVerified: profile.verified,\n          image: profile.image_url,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst facebook = (options) => {\n  return {\n    id: \"facebook\",\n    name: \"Facebook\",\n    async createAuthorizationURL({ state, scopes, redirectURI, loginHint }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"email\", \"public_profile\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return await createAuthorizationURL({\n        id: \"facebook\",\n        options,\n        authorizationEndpoint: \"https://www.facebook.com/v21.0/dialog/oauth\",\n        scopes: _scopes,\n        state,\n        redirectURI,\n        loginHint,\n        additionalParams: options.configId ? {\n          config_id: options.configId\n        } : {}\n      });\n    },\n    validateAuthorizationCode: async ({ code, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        redirectURI,\n        options,\n        tokenEndpoint: \"https://graph.facebook.com/oauth/access_token\"\n      });\n    },\n    async verifyIdToken(token, nonce) {\n      if (options.disableIdTokenSignIn) {\n        return false;\n      }\n      if (options.verifyIdToken) {\n        return options.verifyIdToken(token, nonce);\n      }\n      if (token.split(\".\").length === 3) {\n        try {\n          const { payload: jwtClaims } = await (0,jose__WEBPACK_IMPORTED_MODULE_22__.jwtVerify)(\n            token,\n            (0,jose__WEBPACK_IMPORTED_MODULE_27__.createRemoteJWKSet)(\n              // https://developers.facebook.com/docs/facebook-login/limited-login/token/#jwks\n              new URL(\n                \"https://limited.facebook.com/.well-known/oauth/openid/jwks/\"\n              )\n            ),\n            {\n              algorithms: [\"RS256\"],\n              audience: options.clientId,\n              issuer: \"https://www.facebook.com\"\n            }\n          );\n          if (nonce && jwtClaims.nonce !== nonce) {\n            return false;\n          }\n          return !!jwtClaims;\n        } catch (error) {\n          return false;\n        }\n      }\n      return true;\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://graph.facebook.com/v18.0/oauth/access_token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      if (token.idToken && token.idToken.split(\".\").length === 3) {\n        const profile2 = (0,jose__WEBPACK_IMPORTED_MODULE_25__.decodeJwt)(token.idToken);\n        const user = {\n          id: profile2.sub,\n          name: profile2.name,\n          email: profile2.email,\n          picture: {\n            data: {\n              url: profile2.picture,\n              height: 100,\n              width: 100,\n              is_silhouette: false\n            }\n          }\n        };\n        const userMap2 = await options.mapProfileToUser?.({\n          ...user,\n          email_verified: true\n        });\n        return {\n          user: {\n            ...user,\n            emailVerified: true,\n            ...userMap2\n          },\n          data: profile2\n        };\n      }\n      const fields = [\n        \"id\",\n        \"name\",\n        \"email\",\n        \"picture\",\n        ...options?.fields || []\n      ];\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://graph.facebook.com/me?fields=\" + fields.join(\",\"),\n        {\n          auth: {\n            type: \"Bearer\",\n            token: token.accessToken\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.id,\n          name: profile.name,\n          email: profile.email,\n          image: profile.picture.data.url,\n          emailVerified: profile.email_verified,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst github = (options) => {\n  const tokenEndpoint = \"https://github.com/login/oauth/access_token\";\n  return {\n    id: \"github\",\n    name: \"GitHub\",\n    createAuthorizationURL({ state, scopes, loginHint, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"read:user\", \"user:email\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return createAuthorizationURL({\n        id: \"github\",\n        options,\n        authorizationEndpoint: \"https://github.com/login/oauth/authorize\",\n        scopes: _scopes,\n        state,\n        redirectURI,\n        loginHint,\n        prompt: options.prompt\n      });\n    },\n    validateAuthorizationCode: async ({ code, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        redirectURI,\n        options,\n        tokenEndpoint\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://github.com/login/oauth/access_token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://api.github.com/user\",\n        {\n          headers: {\n            \"User-Agent\": \"better-auth\",\n            authorization: `Bearer ${token.accessToken}`\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      const { data: emails } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\"https://api.github.com/user/emails\", {\n        headers: {\n          Authorization: `Bearer ${token.accessToken}`,\n          \"User-Agent\": \"better-auth\"\n        }\n      });\n      if (!profile.email && emails) {\n        profile.email = (emails.find((e) => e.primary) ?? emails[0])?.email;\n      }\n      const emailVerified = emails?.find((e) => e.email === profile.email)?.verified ?? false;\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.id.toString(),\n          name: profile.name || profile.login,\n          email: profile.email,\n          image: profile.avatar_url,\n          emailVerified,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst google = (options) => {\n  return {\n    id: \"google\",\n    name: \"Google\",\n    async createAuthorizationURL({\n      state,\n      scopes,\n      codeVerifier,\n      redirectURI,\n      loginHint,\n      display\n    }) {\n      if (!options.clientId || !options.clientSecret) {\n        _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_15__.a.error(\n          \"Client Id and Client Secret is required for Google. Make sure to provide them in the options.\"\n        );\n        throw new _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_19__.B(\"CLIENT_ID_AND_SECRET_REQUIRED\");\n      }\n      if (!codeVerifier) {\n        throw new _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_19__.B(\"codeVerifier is required for Google\");\n      }\n      const _scopes = options.disableDefaultScope ? [] : [\"email\", \"profile\", \"openid\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      if (options.prompt === \"select_account+consent\")\n        options.prompt = \"select_account consent\";\n      const url = await createAuthorizationURL({\n        id: \"google\",\n        options,\n        authorizationEndpoint: \"https://accounts.google.com/o/oauth2/auth\",\n        scopes: _scopes,\n        state,\n        codeVerifier,\n        redirectURI,\n        prompt: options.prompt,\n        accessType: options.accessType,\n        display: display || options.display,\n        loginHint,\n        hd: options.hd,\n        additionalParams: {\n          include_granted_scopes: \"true\"\n        }\n      });\n      return url;\n    },\n    validateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        codeVerifier,\n        redirectURI,\n        options,\n        tokenEndpoint: \"https://oauth2.googleapis.com/token\"\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://www.googleapis.com/oauth2/v4/token\"\n      });\n    },\n    async verifyIdToken(token, nonce) {\n      if (options.disableIdTokenSignIn) {\n        return false;\n      }\n      if (options.verifyIdToken) {\n        return options.verifyIdToken(token, nonce);\n      }\n      const googlePublicKeyUrl = `https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=${token}`;\n      const { data: tokenInfo } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(googlePublicKeyUrl);\n      if (!tokenInfo) {\n        return false;\n      }\n      const isValid = tokenInfo.aud === options.clientId && (tokenInfo.iss === \"https://accounts.google.com\" || tokenInfo.iss === \"accounts.google.com\");\n      return isValid;\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      if (!token.idToken) {\n        return null;\n      }\n      const user = (0,jose__WEBPACK_IMPORTED_MODULE_25__.decodeJwt)(token.idToken);\n      const userMap = await options.mapProfileToUser?.(user);\n      return {\n        user: {\n          id: user.sub,\n          name: user.name,\n          email: user.email,\n          image: user.picture,\n          emailVerified: user.email_verified,\n          ...userMap\n        },\n        data: user\n      };\n    },\n    options\n  };\n};\n\nconst kick = (options) => {\n  return {\n    id: \"kick\",\n    name: \"Kick\",\n    createAuthorizationURL({ state, scopes, redirectURI, codeVerifier }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"user:read\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return createAuthorizationURL({\n        id: \"kick\",\n        redirectURI,\n        options,\n        authorizationEndpoint: \"https://id.kick.com/oauth/authorize\",\n        scopes: _scopes,\n        codeVerifier,\n        state\n      });\n    },\n    async validateAuthorizationCode({ code, redirectURI, codeVerifier }) {\n      return validateAuthorizationCode({\n        code,\n        redirectURI,\n        options,\n        tokenEndpoint: \"https://id.kick.com/oauth/token\",\n        codeVerifier\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\"https://api.kick.com/public/v1/users\", {\n        method: \"GET\",\n        headers: {\n          Authorization: `Bearer ${token.accessToken}`\n        }\n      });\n      if (error) {\n        return null;\n      }\n      const profile = data.data[0];\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.user_id,\n          name: profile.name,\n          email: profile.email,\n          image: profile.profile_picture,\n          emailVerified: true,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst huggingface = (options) => {\n  return {\n    id: \"huggingface\",\n    name: \"Hugging Face\",\n    createAuthorizationURL({ state, scopes, codeVerifier, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"openid\", \"profile\", \"email\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return createAuthorizationURL({\n        id: \"huggingface\",\n        options,\n        authorizationEndpoint: \"https://huggingface.co/oauth/authorize\",\n        scopes: _scopes,\n        state,\n        codeVerifier,\n        redirectURI\n      });\n    },\n    validateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        codeVerifier,\n        redirectURI,\n        options,\n        tokenEndpoint: \"https://huggingface.co/oauth/token\"\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://huggingface.co/oauth/token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://huggingface.co/oauth/userinfo\",\n        {\n          method: \"GET\",\n          headers: {\n            Authorization: `Bearer ${token.accessToken}`\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.sub,\n          name: profile.name || profile.preferred_username,\n          email: profile.email,\n          image: profile.picture,\n          emailVerified: profile.email_verified ?? false,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst microsoft = (options) => {\n  const tenant = options.tenantId || \"common\";\n  const authorizationEndpoint = `https://login.microsoftonline.com/${tenant}/oauth2/v2.0/authorize`;\n  const tokenEndpoint = `https://login.microsoftonline.com/${tenant}/oauth2/v2.0/token`;\n  return {\n    id: \"microsoft\",\n    name: \"Microsoft EntraID\",\n    createAuthorizationURL(data) {\n      const scopes = options.disableDefaultScope ? [] : [\"openid\", \"profile\", \"email\", \"User.Read\", \"offline_access\"];\n      options.scope && scopes.push(...options.scope);\n      data.scopes && scopes.push(...data.scopes);\n      return createAuthorizationURL({\n        id: \"microsoft\",\n        options,\n        authorizationEndpoint,\n        state: data.state,\n        codeVerifier: data.codeVerifier,\n        scopes,\n        redirectURI: data.redirectURI,\n        prompt: options.prompt\n      });\n    },\n    validateAuthorizationCode({ code, codeVerifier, redirectURI }) {\n      return validateAuthorizationCode({\n        code,\n        codeVerifier,\n        redirectURI,\n        options,\n        tokenEndpoint\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      if (!token.idToken) {\n        return null;\n      }\n      const user = (0,jose__WEBPACK_IMPORTED_MODULE_25__.decodeJwt)(token.idToken);\n      const profilePhotoSize = options.profilePhotoSize || 48;\n      await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        `https://graph.microsoft.com/v1.0/me/photos/${profilePhotoSize}x${profilePhotoSize}/$value`,\n        {\n          headers: {\n            Authorization: `Bearer ${token.accessToken}`\n          },\n          async onResponse(context) {\n            if (options.disableProfilePhoto || !context.response.ok) {\n              return;\n            }\n            try {\n              const response = context.response.clone();\n              const pictureBuffer = await response.arrayBuffer();\n              const pictureBase64 = _better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_3__.base64.encode(pictureBuffer);\n              user.picture = `data:image/jpeg;base64, ${pictureBase64}`;\n            } catch (e) {\n              _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_15__.a.error(\n                e && typeof e === \"object\" && \"name\" in e ? e.name : \"\",\n                e\n              );\n            }\n          }\n        }\n      );\n      const userMap = await options.mapProfileToUser?.(user);\n      return {\n        user: {\n          id: user.sub,\n          name: user.name,\n          email: user.email,\n          image: user.picture,\n          emailVerified: true,\n          ...userMap\n        },\n        data: user\n      };\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      const scopes = options.disableDefaultScope ? [] : [\"openid\", \"profile\", \"email\", \"User.Read\", \"offline_access\"];\n      options.scope && scopes.push(...options.scope);\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientSecret: options.clientSecret\n        },\n        extraParams: {\n          scope: scopes.join(\" \")\n          // Include the scopes in request to microsoft\n        },\n        tokenEndpoint\n      });\n    },\n    options\n  };\n};\n\nconst slack = (options) => {\n  return {\n    id: \"slack\",\n    name: \"Slack\",\n    createAuthorizationURL({ state, scopes, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"openid\", \"profile\", \"email\"];\n      scopes && _scopes.push(...scopes);\n      options.scope && _scopes.push(...options.scope);\n      const url = new URL(\"https://slack.com/openid/connect/authorize\");\n      url.searchParams.set(\"scope\", _scopes.join(\" \"));\n      url.searchParams.set(\"response_type\", \"code\");\n      url.searchParams.set(\"client_id\", options.clientId);\n      url.searchParams.set(\"redirect_uri\", options.redirectURI || redirectURI);\n      url.searchParams.set(\"state\", state);\n      return url;\n    },\n    validateAuthorizationCode: async ({ code, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        redirectURI,\n        options,\n        tokenEndpoint: \"https://slack.com/api/openid.connect.token\"\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://slack.com/api/openid.connect.token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://slack.com/api/openid.connect.userInfo\",\n        {\n          headers: {\n            authorization: `Bearer ${token.accessToken}`\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile[\"https://slack.com/user_id\"],\n          name: profile.name || \"\",\n          email: profile.email,\n          emailVerified: profile.email_verified,\n          image: profile.picture || profile[\"https://slack.com/user_image_512\"],\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst notion = (options) => {\n  const tokenEndpoint = \"https://api.notion.com/v1/oauth/token\";\n  return {\n    id: \"notion\",\n    name: \"Notion\",\n    createAuthorizationURL({ state, scopes, loginHint, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return createAuthorizationURL({\n        id: \"notion\",\n        options,\n        authorizationEndpoint: \"https://api.notion.com/v1/oauth/authorize\",\n        scopes: _scopes,\n        state,\n        redirectURI,\n        loginHint,\n        additionalParams: {\n          owner: \"user\"\n        }\n      });\n    },\n    validateAuthorizationCode: async ({ code, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        redirectURI,\n        options,\n        tokenEndpoint,\n        authentication: \"basic\"\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\"https://api.notion.com/v1/users/me\", {\n        headers: {\n          Authorization: `Bearer ${token.accessToken}`,\n          \"Notion-Version\": \"2022-06-28\"\n        }\n      });\n      if (error || !profile) {\n        return null;\n      }\n      const userProfile = profile.bot?.owner?.user;\n      if (!userProfile) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(userProfile);\n      return {\n        user: {\n          id: userProfile.id,\n          name: userProfile.name || \"Notion User\",\n          email: userProfile.person?.email || null,\n          image: userProfile.avatar_url,\n          emailVerified: !!userProfile.person?.email,\n          ...userMap\n        },\n        data: userProfile\n      };\n    },\n    options\n  };\n};\n\nconst spotify = (options) => {\n  return {\n    id: \"spotify\",\n    name: \"Spotify\",\n    createAuthorizationURL({ state, scopes, codeVerifier, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"user-read-email\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return createAuthorizationURL({\n        id: \"spotify\",\n        options,\n        authorizationEndpoint: \"https://accounts.spotify.com/authorize\",\n        scopes: _scopes,\n        state,\n        codeVerifier,\n        redirectURI\n      });\n    },\n    validateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        codeVerifier,\n        redirectURI,\n        options,\n        tokenEndpoint: \"https://accounts.spotify.com/api/token\"\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://accounts.spotify.com/api/token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://api.spotify.com/v1/me\",\n        {\n          method: \"GET\",\n          headers: {\n            Authorization: `Bearer ${token.accessToken}`\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.id,\n          name: profile.display_name,\n          email: profile.email,\n          image: profile.images[0]?.url,\n          emailVerified: false,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst twitch = (options) => {\n  return {\n    id: \"twitch\",\n    name: \"Twitch\",\n    createAuthorizationURL({ state, scopes, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"user:read:email\", \"openid\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return createAuthorizationURL({\n        id: \"twitch\",\n        redirectURI,\n        options,\n        authorizationEndpoint: \"https://id.twitch.tv/oauth2/authorize\",\n        scopes: _scopes,\n        state,\n        claims: options.claims || [\n          \"email\",\n          \"email_verified\",\n          \"preferred_username\",\n          \"picture\"\n        ]\n      });\n    },\n    validateAuthorizationCode: async ({ code, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        redirectURI,\n        options,\n        tokenEndpoint: \"https://id.twitch.tv/oauth2/token\"\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://id.twitch.tv/oauth2/token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const idToken = token.idToken;\n      if (!idToken) {\n        _better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_15__.a.error(\"No idToken found in token\");\n        return null;\n      }\n      const profile = (0,jose__WEBPACK_IMPORTED_MODULE_25__.decodeJwt)(idToken);\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.sub,\n          name: profile.preferred_username,\n          email: profile.email,\n          image: profile.picture,\n          emailVerified: profile.email_verified,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst twitter = (options) => {\n  return {\n    id: \"twitter\",\n    name: \"Twitter\",\n    createAuthorizationURL(data) {\n      const _scopes = options.disableDefaultScope ? [] : [\"users.read\", \"tweet.read\", \"offline.access\", \"users.email\"];\n      options.scope && _scopes.push(...options.scope);\n      data.scopes && _scopes.push(...data.scopes);\n      return createAuthorizationURL({\n        id: \"twitter\",\n        options,\n        authorizationEndpoint: \"https://x.com/i/oauth2/authorize\",\n        scopes: _scopes,\n        state: data.state,\n        codeVerifier: data.codeVerifier,\n        redirectURI: data.redirectURI\n      });\n    },\n    validateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        codeVerifier,\n        authentication: \"basic\",\n        redirectURI,\n        options,\n        tokenEndpoint: \"https://api.x.com/2/oauth2/token\"\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://api.x.com/2/oauth2/token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error: profileError } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://api.x.com/2/users/me?user.fields=profile_image_url\",\n        {\n          method: \"GET\",\n          headers: {\n            Authorization: `Bearer ${token.accessToken}`\n          }\n        }\n      );\n      if (profileError) {\n        return null;\n      }\n      const { data: emailData, error: emailError } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\"https://api.x.com/2/users/me?user.fields=confirmed_email\", {\n        method: \"GET\",\n        headers: {\n          Authorization: `Bearer ${token.accessToken}`\n        }\n      });\n      let emailVerified = false;\n      if (!emailError && emailData?.data?.confirmed_email) {\n        profile.data.email = emailData.data.confirmed_email;\n        emailVerified = true;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.data.id,\n          name: profile.data.name,\n          email: profile.data.email || profile.data.username || null,\n          image: profile.data.profile_image_url,\n          emailVerified,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst dropbox = (options) => {\n  const tokenEndpoint = \"https://api.dropboxapi.com/oauth2/token\";\n  return {\n    id: \"dropbox\",\n    name: \"Dropbox\",\n    createAuthorizationURL: async ({\n      state,\n      scopes,\n      codeVerifier,\n      redirectURI\n    }) => {\n      const _scopes = options.disableDefaultScope ? [] : [\"account_info.read\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      const additionalParams = {};\n      if (options.accessType) {\n        additionalParams.token_access_type = options.accessType;\n      }\n      return await createAuthorizationURL({\n        id: \"dropbox\",\n        options,\n        authorizationEndpoint: \"https://www.dropbox.com/oauth2/authorize\",\n        scopes: _scopes,\n        state,\n        redirectURI,\n        codeVerifier,\n        additionalParams\n      });\n    },\n    validateAuthorizationCode: async ({ code, codeVerifier, redirectURI }) => {\n      return await validateAuthorizationCode({\n        code,\n        codeVerifier,\n        redirectURI,\n        options,\n        tokenEndpoint\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://api.dropbox.com/oauth2/token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://api.dropboxapi.com/2/users/get_current_account\",\n        {\n          method: \"POST\",\n          headers: {\n            Authorization: `Bearer ${token.accessToken}`\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.account_id,\n          name: profile.name?.display_name,\n          email: profile.email,\n          emailVerified: profile.email_verified || false,\n          image: profile.profile_photo_url,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst linear = (options) => {\n  const tokenEndpoint = \"https://api.linear.app/oauth/token\";\n  return {\n    id: \"linear\",\n    name: \"Linear\",\n    createAuthorizationURL({ state, scopes, loginHint, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"read\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return createAuthorizationURL({\n        id: \"linear\",\n        options,\n        authorizationEndpoint: \"https://linear.app/oauth/authorize\",\n        scopes: _scopes,\n        state,\n        redirectURI,\n        loginHint\n      });\n    },\n    validateAuthorizationCode: async ({ code, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        redirectURI,\n        options,\n        tokenEndpoint\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://api.linear.app/graphql\",\n        {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${token.accessToken}`\n          },\n          body: JSON.stringify({\n            query: `\n\t\t\t\t\t\t\tquery {\n\t\t\t\t\t\t\t\tviewer {\n\t\t\t\t\t\t\t\t\tid\n\t\t\t\t\t\t\t\t\tname\n\t\t\t\t\t\t\t\t\temail\n\t\t\t\t\t\t\t\t\tavatarUrl\n\t\t\t\t\t\t\t\t\tactive\n\t\t\t\t\t\t\t\t\tcreatedAt\n\t\t\t\t\t\t\t\t\tupdatedAt\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t`\n          })\n        }\n      );\n      if (error || !profile?.data?.viewer) {\n        return null;\n      }\n      const userData = profile.data.viewer;\n      const userMap = await options.mapProfileToUser?.(userData);\n      return {\n        user: {\n          id: profile.data.viewer.id,\n          name: profile.data.viewer.name,\n          email: profile.data.viewer.email,\n          image: profile.data.viewer.avatarUrl,\n          emailVerified: true,\n          ...userMap\n        },\n        data: userData\n      };\n    },\n    options\n  };\n};\n\nconst linkedin = (options) => {\n  const authorizationEndpoint = \"https://www.linkedin.com/oauth/v2/authorization\";\n  const tokenEndpoint = \"https://www.linkedin.com/oauth/v2/accessToken\";\n  return {\n    id: \"linkedin\",\n    name: \"Linkedin\",\n    createAuthorizationURL: async ({\n      state,\n      scopes,\n      redirectURI,\n      loginHint\n    }) => {\n      const _scopes = options.disableDefaultScope ? [] : [\"profile\", \"email\", \"openid\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return await createAuthorizationURL({\n        id: \"linkedin\",\n        options,\n        authorizationEndpoint,\n        scopes: _scopes,\n        state,\n        loginHint,\n        redirectURI\n      });\n    },\n    validateAuthorizationCode: async ({ code, redirectURI }) => {\n      return await validateAuthorizationCode({\n        code,\n        redirectURI,\n        options,\n        tokenEndpoint\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://api.linkedin.com/v2/userinfo\",\n        {\n          method: \"GET\",\n          headers: {\n            Authorization: `Bearer ${token.accessToken}`\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.sub,\n          name: profile.name,\n          email: profile.email,\n          emailVerified: profile.email_verified || false,\n          image: profile.picture,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst cleanDoubleSlashes = (input = \"\") => {\n  return input.split(\"://\").map((str) => str.replace(/\\/{2,}/g, \"/\")).join(\"://\");\n};\nconst issuerToEndpoints = (issuer) => {\n  let baseUrl = issuer || \"https://gitlab.com\";\n  return {\n    authorizationEndpoint: cleanDoubleSlashes(`${baseUrl}/oauth/authorize`),\n    tokenEndpoint: cleanDoubleSlashes(`${baseUrl}/oauth/token`),\n    userinfoEndpoint: cleanDoubleSlashes(`${baseUrl}/api/v4/user`)\n  };\n};\nconst gitlab = (options) => {\n  const { authorizationEndpoint, tokenEndpoint, userinfoEndpoint } = issuerToEndpoints(options.issuer);\n  const issuerId = \"gitlab\";\n  const issuerName = \"Gitlab\";\n  return {\n    id: issuerId,\n    name: issuerName,\n    createAuthorizationURL: async ({\n      state,\n      scopes,\n      codeVerifier,\n      loginHint,\n      redirectURI\n    }) => {\n      const _scopes = options.disableDefaultScope ? [] : [\"read_user\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return await createAuthorizationURL({\n        id: issuerId,\n        options,\n        authorizationEndpoint,\n        scopes: _scopes,\n        state,\n        redirectURI,\n        codeVerifier,\n        loginHint\n      });\n    },\n    validateAuthorizationCode: async ({ code, redirectURI, codeVerifier }) => {\n      return validateAuthorizationCode({\n        code,\n        redirectURI,\n        options,\n        codeVerifier,\n        tokenEndpoint\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://gitlab.com/oauth/token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        userinfoEndpoint,\n        { headers: { authorization: `Bearer ${token.accessToken}` } }\n      );\n      if (error || profile.state !== \"active\" || profile.locked) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.id.toString(),\n          name: profile.name ?? profile.username,\n          email: profile.email,\n          image: profile.avatar_url,\n          emailVerified: true,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst tiktok = (options) => {\n  return {\n    id: \"tiktok\",\n    name: \"TikTok\",\n    createAuthorizationURL({ state, scopes, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"user.info.profile\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return new URL(\n        `https://www.tiktok.com/v2/auth/authorize?scope=${_scopes.join(\n          \",\"\n        )}&response_type=code&client_key=${options.clientKey}&client_secret=${options.clientSecret}&redirect_uri=${encodeURIComponent(\n          options.redirectURI || redirectURI\n        )}&state=${state}`\n      );\n    },\n    validateAuthorizationCode: async ({ code, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        redirectURI: options.redirectURI || redirectURI,\n        options,\n        tokenEndpoint: \"https://open.tiktokapis.com/v2/oauth/token/\"\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://open.tiktokapis.com/v2/oauth/token/\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const fields = [\n        \"open_id\",\n        \"avatar_large_url\",\n        \"display_name\",\n        \"username\"\n      ];\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        `https://open.tiktokapis.com/v2/user/info/?fields=${fields.join(\",\")}`,\n        {\n          headers: {\n            authorization: `Bearer ${token.accessToken}`\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      return {\n        user: {\n          email: profile.data.user.email || profile.data.user.username,\n          id: profile.data.user.open_id,\n          name: profile.data.user.display_name || profile.data.user.username,\n          image: profile.data.user.avatar_large_url,\n          /** @note Tiktok does not provide emailVerified or even email*/\n          emailVerified: profile.data.user.email ? true : false\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst reddit = (options) => {\n  return {\n    id: \"reddit\",\n    name: \"Reddit\",\n    createAuthorizationURL({ state, scopes, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"identity\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return createAuthorizationURL({\n        id: \"reddit\",\n        options,\n        authorizationEndpoint: \"https://www.reddit.com/api/v1/authorize\",\n        scopes: _scopes,\n        state,\n        redirectURI,\n        duration: options.duration\n      });\n    },\n    validateAuthorizationCode: async ({ code, redirectURI }) => {\n      const body = new URLSearchParams({\n        grant_type: \"authorization_code\",\n        code,\n        redirect_uri: options.redirectURI || redirectURI\n      });\n      const headers = {\n        \"content-type\": \"application/x-www-form-urlencoded\",\n        accept: \"text/plain\",\n        \"user-agent\": \"better-auth\",\n        Authorization: `Basic ${_better_auth_utils_base64__WEBPACK_IMPORTED_MODULE_3__.base64.encode(\n          `${options.clientId}:${options.clientSecret}`\n        )}`\n      };\n      const { data, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://www.reddit.com/api/v1/access_token\",\n        {\n          method: \"POST\",\n          headers,\n          body: body.toString()\n        }\n      );\n      if (error) {\n        throw error;\n      }\n      return getOAuth2Tokens(data);\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://www.reddit.com/api/v1/access_token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://oauth.reddit.com/api/v1/me\",\n        {\n          headers: {\n            Authorization: `Bearer ${token.accessToken}`,\n            \"User-Agent\": \"better-auth\"\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.id,\n          name: profile.name,\n          email: profile.oauth_client_id,\n          emailVerified: profile.has_verified_email,\n          image: profile.icon_img?.split(\"?\")[0],\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst roblox = (options) => {\n  return {\n    id: \"roblox\",\n    name: \"Roblox\",\n    createAuthorizationURL({ state, scopes, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"openid\", \"profile\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      return new URL(\n        `https://apis.roblox.com/oauth/v1/authorize?scope=${_scopes.join(\n          \"+\"\n        )}&response_type=code&client_id=${options.clientId}&redirect_uri=${encodeURIComponent(\n          options.redirectURI || redirectURI\n        )}&state=${state}&prompt=${options.prompt || \"select_account+consent\"}`\n      );\n    },\n    validateAuthorizationCode: async ({ code, redirectURI }) => {\n      return validateAuthorizationCode({\n        code,\n        redirectURI: options.redirectURI || redirectURI,\n        options,\n        tokenEndpoint: \"https://apis.roblox.com/oauth/v1/token\",\n        authentication: \"post\"\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://apis.roblox.com/oauth/v1/token\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://apis.roblox.com/oauth/v1/userinfo\",\n        {\n          headers: {\n            authorization: `Bearer ${token.accessToken}`\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.sub,\n          name: profile.nickname || profile.preferred_username || \"\",\n          image: profile.picture,\n          email: profile.preferred_username || null,\n          // Roblox does not provide email\n          emailVerified: true,\n          ...userMap\n        },\n        data: {\n          ...profile\n        }\n      };\n    },\n    options\n  };\n};\n\nvar LANG = /* @__PURE__ */ ((LANG2) => {\n  LANG2[LANG2[\"RUS\"] = 0] = \"RUS\";\n  LANG2[LANG2[\"UKR\"] = 1] = \"UKR\";\n  LANG2[LANG2[\"ENG\"] = 3] = \"ENG\";\n  LANG2[LANG2[\"SPA\"] = 4] = \"SPA\";\n  LANG2[LANG2[\"GERMAN\"] = 6] = \"GERMAN\";\n  LANG2[LANG2[\"POL\"] = 15] = \"POL\";\n  LANG2[LANG2[\"FRA\"] = 16] = \"FRA\";\n  LANG2[LANG2[\"TURKEY\"] = 82] = \"TURKEY\";\n  return LANG2;\n})(LANG || {});\nconst vk = (options) => {\n  return {\n    id: \"vk\",\n    name: \"VK\",\n    async createAuthorizationURL({ state, scopes, codeVerifier, redirectURI }) {\n      const _scopes = options.disableDefaultScope ? [] : [\"email\", \"phone\"];\n      options.scope && _scopes.push(...options.scope);\n      scopes && _scopes.push(...scopes);\n      const authorizationEndpoint = \"https://id.vk.com/authorize\";\n      return createAuthorizationURL({\n        id: \"vk\",\n        options,\n        authorizationEndpoint,\n        scopes: _scopes,\n        state,\n        redirectURI,\n        codeVerifier\n      });\n    },\n    validateAuthorizationCode: async ({\n      code,\n      codeVerifier,\n      redirectURI,\n      deviceId\n    }) => {\n      return validateAuthorizationCode({\n        code,\n        codeVerifier,\n        redirectURI: options.redirectURI || redirectURI,\n        options,\n        deviceId,\n        tokenEndpoint: \"https://id.vk.com/oauth2/auth\"\n      });\n    },\n    refreshAccessToken: options.refreshAccessToken ? options.refreshAccessToken : async (refreshToken) => {\n      return refreshAccessToken({\n        refreshToken,\n        options: {\n          clientId: options.clientId,\n          clientKey: options.clientKey,\n          clientSecret: options.clientSecret\n        },\n        tokenEndpoint: \"https://id.vk.com/oauth2/auth\"\n      });\n    },\n    async getUserInfo(data) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(data);\n      }\n      if (!data.accessToken) {\n        return null;\n      }\n      const formBody = new URLSearchParams({\n        access_token: data.accessToken,\n        client_id: options.clientId\n      }).toString();\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://id.vk.com/oauth2/user_info\",\n        {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/x-www-form-urlencoded\"\n          },\n          body: formBody\n        }\n      );\n      if (error) {\n        return null;\n      }\n      if (!profile.user.email) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.user.user_id,\n          first_name: profile.user.first_name,\n          last_name: profile.user.last_name,\n          email: profile.user.email,\n          image: profile.user.avatar,\n          /** @note VK does not provide emailVerified*/\n          emailVerified: !!profile.user.email,\n          birthday: profile.user.birthday,\n          sex: profile.user.sex,\n          ...userMap\n        },\n        data: profile\n      };\n    },\n    options\n  };\n};\n\nconst zoom = (userOptions) => {\n  const options = {\n    pkce: true,\n    ...userOptions\n  };\n  return {\n    id: \"zoom\",\n    name: \"Zoom\",\n    createAuthorizationURL: async ({ state, redirectURI, codeVerifier }) => {\n      const params = new URLSearchParams({\n        response_type: \"code\",\n        redirect_uri: options.redirectURI ? options.redirectURI : redirectURI,\n        client_id: options.clientId,\n        state\n      });\n      if (options.pkce) {\n        const codeChallenge = await generateCodeChallenge(codeVerifier);\n        params.set(\"code_challenge_method\", \"S256\");\n        params.set(\"code_challenge\", codeChallenge);\n      }\n      const url = new URL(\"https://zoom.us/oauth/authorize\");\n      url.search = params.toString();\n      return url;\n    },\n    validateAuthorizationCode: async ({ code, redirectURI, codeVerifier }) => {\n      return validateAuthorizationCode({\n        code,\n        redirectURI: options.redirectURI || redirectURI,\n        codeVerifier,\n        options,\n        tokenEndpoint: \"https://zoom.us/oauth/token\",\n        authentication: \"post\"\n      });\n    },\n    async getUserInfo(token) {\n      if (options.getUserInfo) {\n        return options.getUserInfo(token);\n      }\n      const { data: profile, error } = await (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_5__.betterFetch)(\n        \"https://api.zoom.us/v2/users/me\",\n        {\n          headers: {\n            authorization: `Bearer ${token.accessToken}`\n          }\n        }\n      );\n      if (error) {\n        return null;\n      }\n      const userMap = await options.mapProfileToUser?.(profile);\n      return {\n        user: {\n          id: profile.id,\n          name: profile.display_name,\n          image: profile.pic_url,\n          email: profile.email,\n          emailVerified: Boolean(profile.verified),\n          ...userMap\n        },\n        data: {\n          ...profile\n        }\n      };\n    }\n  };\n};\n\nconst socialProviders = {\n  apple,\n  discord,\n  facebook,\n  github,\n  microsoft,\n  google,\n  huggingface,\n  slack,\n  spotify,\n  twitch,\n  twitter,\n  dropbox,\n  kick,\n  linear,\n  linkedin,\n  gitlab,\n  tiktok,\n  reddit,\n  roblox,\n  vk,\n  zoom,\n  notion\n};\nconst socialProviderList = Object.keys(socialProviders);\nconst SocialProviderListEnum = zod_v4__WEBPACK_IMPORTED_MODULE_20__[\"enum\"](socialProviderList).or(zod_v4__WEBPACK_IMPORTED_MODULE_20__.string());\n\nconst signInSocial = createAuthEndpoint(\n  \"/sign-in/social\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      /**\n       * Callback URL to redirect to after the user\n       * has signed in.\n       */\n      callbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"Callback URL to redirect to after the user has signed in\"\n      }).optional(),\n      /**\n       * callback url to redirect if the user is newly registered.\n       *\n       * useful if you have different routes for existing users and new users\n       */\n      newUserCallbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional(),\n      /**\n       * Callback url to redirect to if an error happens\n       *\n       * If it's initiated from the client sdk this defaults to\n       * the current url.\n       */\n      errorCallbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"Callback URL to redirect to if an error happens\"\n      }).optional(),\n      /**\n       * OAuth2 provider to use`\n       */\n      provider: SocialProviderListEnum,\n      /**\n       * Disable automatic redirection to the provider\n       *\n       * This is useful if you want to handle the redirection\n       * yourself like in a popup or a different tab.\n       */\n      disableRedirect: zod_v4__WEBPACK_IMPORTED_MODULE_20__.boolean().meta({\n        description: \"Disable automatic redirection to the provider. Useful for handling the redirection yourself\"\n      }).optional(),\n      /**\n       * ID token from the provider\n       *\n       * This is used to sign in the user\n       * if the user is already signed in with the\n       * provider in the frontend.\n       *\n       * Only applicable if the provider supports\n       * it. Currently only `apple` and `google` is\n       * supported out of the box.\n       */\n      idToken: zod_v4__WEBPACK_IMPORTED_MODULE_20__.optional(\n        zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n          /**\n           * ID token from the provider\n           */\n          token: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n            description: \"ID token from the provider\"\n          }),\n          /**\n           * The nonce used to generate the token\n           */\n          nonce: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n            description: \"Nonce used to generate the token\"\n          }).optional(),\n          /**\n           * Access token from the provider\n           */\n          accessToken: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n            description: \"Access token from the provider\"\n          }).optional(),\n          /**\n           * Refresh token from the provider\n           */\n          refreshToken: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n            description: \"Refresh token from the provider\"\n          }).optional(),\n          /**\n           * Expiry date of the token\n           */\n          expiresAt: zod_v4__WEBPACK_IMPORTED_MODULE_20__.number().meta({\n            description: \"Expiry date of the token\"\n          }).optional()\n        })\n      ),\n      scopes: zod_v4__WEBPACK_IMPORTED_MODULE_20__.array(zod_v4__WEBPACK_IMPORTED_MODULE_20__.string()).meta({\n        description: \"Array of scopes to request from the provider. This will override the default scopes passed.\"\n      }).optional(),\n      /**\n       * Explicitly request sign-up\n       *\n       * Should be used to allow sign up when\n       * disableImplicitSignUp for this provider is\n       * true\n       */\n      requestSignUp: zod_v4__WEBPACK_IMPORTED_MODULE_20__.boolean().meta({\n        description: \"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider\"\n      }).optional(),\n      /**\n       * The login hint to use for the authorization code request\n       */\n      loginHint: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The login hint to use for the authorization code request\"\n      }).optional()\n    }),\n    metadata: {\n      openapi: {\n        description: \"Sign in with a social provider\",\n        operationId: \"socialSignIn\",\n        responses: {\n          \"200\": {\n            description: \"Success - Returns either session details or redirect URL\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  // todo: we need support for multiple schema\n                  type: \"object\",\n                  description: \"Session response when idToken is provided\",\n                  properties: {\n                    redirect: {\n                      type: \"boolean\",\n                      enum: [false]\n                    },\n                    token: {\n                      type: \"string\",\n                      description: \"Session token\",\n                      url: {\n                        type: \"null\",\n                        nullable: true\n                      },\n                      user: {\n                        type: \"object\",\n                        properties: {\n                          id: { type: \"string\" },\n                          email: { type: \"string\" },\n                          name: {\n                            type: \"string\",\n                            nullable: true\n                          },\n                          image: {\n                            type: \"string\",\n                            nullable: true\n                          },\n                          emailVerified: {\n                            type: \"boolean\"\n                          },\n                          createdAt: {\n                            type: \"string\",\n                            format: \"date-time\"\n                          },\n                          updatedAt: {\n                            type: \"string\",\n                            format: \"date-time\"\n                          }\n                        },\n                        required: [\n                          \"id\",\n                          \"email\",\n                          \"emailVerified\",\n                          \"createdAt\",\n                          \"updatedAt\"\n                        ]\n                      }\n                    }\n                  },\n                  required: [\"redirect\", \"token\", \"user\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (c) => {\n    const provider = c.context.socialProviders.find(\n      (p) => p.id === c.body.provider\n    );\n    if (!provider) {\n      c.context.logger.error(\n        \"Provider not found. Make sure to add the provider in your auth config\",\n        {\n          provider: c.body.provider\n        }\n      );\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"NOT_FOUND\", {\n        message: BASE_ERROR_CODES.PROVIDER_NOT_FOUND\n      });\n    }\n    if (c.body.idToken) {\n      if (!provider.verifyIdToken) {\n        c.context.logger.error(\n          \"Provider does not support id token verification\",\n          {\n            provider: c.body.provider\n          }\n        );\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"NOT_FOUND\", {\n          message: BASE_ERROR_CODES.ID_TOKEN_NOT_SUPPORTED\n        });\n      }\n      const { token, nonce } = c.body.idToken;\n      const valid = await provider.verifyIdToken(token, nonce);\n      if (!valid) {\n        c.context.logger.error(\"Invalid id token\", {\n          provider: c.body.provider\n        });\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n          message: BASE_ERROR_CODES.INVALID_TOKEN\n        });\n      }\n      const userInfo = await provider.getUserInfo({\n        idToken: token,\n        accessToken: c.body.idToken.accessToken,\n        refreshToken: c.body.idToken.refreshToken\n      });\n      if (!userInfo || !userInfo?.user) {\n        c.context.logger.error(\"Failed to get user info\", {\n          provider: c.body.provider\n        });\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n          message: BASE_ERROR_CODES.FAILED_TO_GET_USER_INFO\n        });\n      }\n      if (!userInfo.user.email) {\n        c.context.logger.error(\"User email not found\", {\n          provider: c.body.provider\n        });\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n          message: BASE_ERROR_CODES.USER_EMAIL_NOT_FOUND\n        });\n      }\n      const data = await handleOAuthUserInfo(c, {\n        userInfo: {\n          ...userInfo.user,\n          email: userInfo.user.email,\n          id: userInfo.user.id,\n          name: userInfo.user.name || \"\",\n          image: userInfo.user.image,\n          emailVerified: userInfo.user.emailVerified || false\n        },\n        account: {\n          providerId: provider.id,\n          accountId: userInfo.user.id,\n          accessToken: c.body.idToken.accessToken\n        },\n        callbackURL: c.body.callbackURL,\n        disableSignUp: provider.disableImplicitSignUp && !c.body.requestSignUp || provider.disableSignUp\n      });\n      if (data.error) {\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n          message: data.error\n        });\n      }\n      await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.setSessionCookie)(c, data.data);\n      return c.json({\n        redirect: false,\n        token: data.data.session.token,\n        url: void 0,\n        user: {\n          id: data.data.user.id,\n          email: data.data.user.email,\n          name: data.data.user.name,\n          image: data.data.user.image,\n          emailVerified: data.data.user.emailVerified,\n          createdAt: data.data.user.createdAt,\n          updatedAt: data.data.user.updatedAt\n        }\n      });\n    }\n    const { codeVerifier, state } = await generateState(c);\n    const url = await provider.createAuthorizationURL({\n      state,\n      codeVerifier,\n      redirectURI: `${c.context.baseURL}/callback/${provider.id}`,\n      scopes: c.body.scopes,\n      loginHint: c.body.loginHint\n    });\n    return c.json({\n      url: url.toString(),\n      redirect: !c.body.disableRedirect\n    });\n  }\n);\nconst signInEmail = createAuthEndpoint(\n  \"/sign-in/email\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      /**\n       * Email of the user\n       */\n      email: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"Email of the user\"\n      }),\n      /**\n       * Password of the user\n       */\n      password: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"Password of the user\"\n      }),\n      /**\n       * Callback URL to use as a redirect for email\n       * verification and for possible redirects\n       */\n      callbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"Callback URL to use as a redirect for email verification\"\n      }).optional(),\n      /**\n       * If this is false, the session will not be remembered\n       * @default true\n       */\n      rememberMe: zod_v4__WEBPACK_IMPORTED_MODULE_20__.boolean().meta({\n        description: \"If this is false, the session will not be remembered. Default is `true`.\"\n      }).default(true).optional()\n    }),\n    metadata: {\n      openapi: {\n        description: \"Sign in with email and password\",\n        responses: {\n          \"200\": {\n            description: \"Success - Returns either session details or redirect URL\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  // todo: we need support for multiple schema\n                  type: \"object\",\n                  description: \"Session response when idToken is provided\",\n                  properties: {\n                    redirect: {\n                      type: \"boolean\",\n                      enum: [false]\n                    },\n                    token: {\n                      type: \"string\",\n                      description: \"Session token\"\n                    },\n                    url: {\n                      type: \"null\",\n                      nullable: true\n                    },\n                    user: {\n                      type: \"object\",\n                      properties: {\n                        id: { type: \"string\" },\n                        email: { type: \"string\" },\n                        name: {\n                          type: \"string\",\n                          nullable: true\n                        },\n                        image: {\n                          type: \"string\",\n                          nullable: true\n                        },\n                        emailVerified: {\n                          type: \"boolean\"\n                        },\n                        createdAt: {\n                          type: \"string\",\n                          format: \"date-time\"\n                        },\n                        updatedAt: {\n                          type: \"string\",\n                          format: \"date-time\"\n                        }\n                      },\n                      required: [\n                        \"id\",\n                        \"email\",\n                        \"emailVerified\",\n                        \"createdAt\",\n                        \"updatedAt\"\n                      ]\n                    }\n                  },\n                  required: [\"redirect\", \"token\", \"user\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    if (!ctx.context.options?.emailAndPassword?.enabled) {\n      ctx.context.logger.error(\n        \"Email and password is not enabled. Make sure to enable it in the options on you `auth.ts` file. Check `https://better-auth.com/docs/authentication/email-password` for more!\"\n      );\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Email and password is not enabled\"\n      });\n    }\n    const { email, password } = ctx.body;\n    const isValidEmail = zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().email().safeParse(email);\n    if (!isValidEmail.success) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.INVALID_EMAIL\n      });\n    }\n    const user = await ctx.context.internalAdapter.findUserByEmail(email, {\n      includeAccounts: true\n    });\n    if (!user) {\n      await ctx.context.password.hash(password);\n      ctx.context.logger.error(\"User not found\", { email });\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n        message: BASE_ERROR_CODES.INVALID_EMAIL_OR_PASSWORD\n      });\n    }\n    const credentialAccount = user.accounts.find(\n      (a) => a.providerId === \"credential\"\n    );\n    if (!credentialAccount) {\n      ctx.context.logger.error(\"Credential account not found\", { email });\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n        message: BASE_ERROR_CODES.INVALID_EMAIL_OR_PASSWORD\n      });\n    }\n    const currentPassword = credentialAccount?.password;\n    if (!currentPassword) {\n      ctx.context.logger.error(\"Password not found\", { email });\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n        message: BASE_ERROR_CODES.INVALID_EMAIL_OR_PASSWORD\n      });\n    }\n    const validPassword = await ctx.context.password.verify({\n      hash: currentPassword,\n      password\n    });\n    if (!validPassword) {\n      ctx.context.logger.error(\"Invalid password\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n        message: BASE_ERROR_CODES.INVALID_EMAIL_OR_PASSWORD\n      });\n    }\n    if (ctx.context.options?.emailAndPassword?.requireEmailVerification && !user.user.emailVerified) {\n      if (!ctx.context.options?.emailVerification?.sendVerificationEmail) {\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"FORBIDDEN\", {\n          message: BASE_ERROR_CODES.EMAIL_NOT_VERIFIED\n        });\n      }\n      if (ctx.context.options?.emailVerification?.sendOnSignIn) {\n        const token = await createEmailVerificationToken(\n          ctx.context.secret,\n          user.user.email,\n          void 0,\n          ctx.context.options.emailVerification?.expiresIn\n        );\n        const url = `${ctx.context.baseURL}/verify-email?token=${token}&callbackURL=${ctx.body.callbackURL || \"/\"}`;\n        await ctx.context.options.emailVerification.sendVerificationEmail(\n          {\n            user: user.user,\n            url,\n            token\n          },\n          ctx.request\n        );\n      }\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"FORBIDDEN\", {\n        message: BASE_ERROR_CODES.EMAIL_NOT_VERIFIED\n      });\n    }\n    const session = await ctx.context.internalAdapter.createSession(\n      user.user.id,\n      ctx,\n      ctx.body.rememberMe === false\n    );\n    if (!session) {\n      ctx.context.logger.error(\"Failed to create session\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n        message: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION\n      });\n    }\n    await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.setSessionCookie)(\n      ctx,\n      {\n        session,\n        user: user.user\n      },\n      ctx.body.rememberMe === false\n    );\n    return ctx.json({\n      redirect: !!ctx.body.callbackURL,\n      token: session.token,\n      url: ctx.body.callbackURL,\n      user: {\n        id: user.user.id,\n        email: user.user.email,\n        name: user.user.name,\n        image: user.user.image,\n        emailVerified: user.user.emailVerified,\n        createdAt: user.user.createdAt,\n        updatedAt: user.user.updatedAt\n      }\n    });\n  }\n);\n\nconst schema = zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n  code: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional(),\n  error: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional(),\n  device_id: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional(),\n  error_description: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional(),\n  state: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional(),\n  user: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional()\n});\nconst callbackOAuth = createAuthEndpoint(\n  \"/callback/:id\",\n  {\n    method: [\"GET\", \"POST\"],\n    body: schema.optional(),\n    query: schema.optional(),\n    metadata: HIDE_METADATA\n  },\n  async (c) => {\n    let queryOrBody;\n    const defaultErrorURL = c.context.options.onAPIError?.errorURL || `${c.context.baseURL}/error`;\n    try {\n      if (c.method === \"GET\") {\n        queryOrBody = schema.parse(c.query);\n      } else if (c.method === \"POST\") {\n        queryOrBody = schema.parse(c.body);\n      } else {\n        throw new Error(\"Unsupported method\");\n      }\n    } catch (e) {\n      c.context.logger.error(\"INVALID_CALLBACK_REQUEST\", e);\n      throw c.redirect(`${defaultErrorURL}?error=invalid_callback_request`);\n    }\n    const { code, error, state, error_description, device_id } = queryOrBody;\n    if (error) {\n      throw c.redirect(\n        `${defaultErrorURL}?error=${error}&error_description=${error_description}`\n      );\n    }\n    if (!state) {\n      c.context.logger.error(\"State not found\", error);\n      throw c.redirect(`${defaultErrorURL}?error=state_not_found`);\n    }\n    const {\n      codeVerifier,\n      callbackURL,\n      link,\n      errorURL,\n      newUserURL,\n      requestSignUp\n    } = await parseState(c);\n    function redirectOnError(error2) {\n      let url = errorURL || defaultErrorURL;\n      if (url.includes(\"?\")) {\n        url = `${url}&error=${error2}`;\n      } else {\n        url = `${url}?error=${error2}`;\n      }\n      throw c.redirect(url);\n    }\n    if (!code) {\n      c.context.logger.error(\"Code not found\");\n      throw redirectOnError(\"no_code\");\n    }\n    const provider = c.context.socialProviders.find(\n      (p) => p.id === c.params.id\n    );\n    if (!provider) {\n      c.context.logger.error(\n        \"Oauth provider with id\",\n        c.params.id,\n        \"not found\"\n      );\n      throw redirectOnError(\"oauth_provider_not_found\");\n    }\n    let tokens;\n    try {\n      tokens = await provider.validateAuthorizationCode({\n        code,\n        codeVerifier,\n        deviceId: device_id,\n        redirectURI: `${c.context.baseURL}/callback/${provider.id}`\n      });\n    } catch (e) {\n      c.context.logger.error(\"\", e);\n      throw redirectOnError(\"invalid_code\");\n    }\n    const userInfo = await provider.getUserInfo({\n      ...tokens,\n      user: c.body?.user ? (0,_better_auth_tB5eU6EY_mjs__WEBPACK_IMPORTED_MODULE_11__.s)(c.body.user) : void 0\n    }).then((res) => res?.user);\n    if (!userInfo) {\n      c.context.logger.error(\"Unable to get user info\");\n      return redirectOnError(\"unable_to_get_user_info\");\n    }\n    if (!callbackURL) {\n      c.context.logger.error(\"No callback URL found\");\n      throw redirectOnError(\"no_callback_url\");\n    }\n    if (link) {\n      const trustedProviders = c.context.options.account?.accountLinking?.trustedProviders;\n      const isTrustedProvider = trustedProviders?.includes(\n        provider.id\n      );\n      if (!isTrustedProvider && !userInfo.emailVerified || c.context.options.account?.accountLinking?.enabled === false) {\n        c.context.logger.error(\"Unable to link account - untrusted provider\");\n        return redirectOnError(\"unable_to_link_account\");\n      }\n      const existingAccount = await c.context.internalAdapter.findAccount(\n        userInfo.id\n      );\n      if (existingAccount) {\n        if (existingAccount.userId.toString() !== link.userId.toString()) {\n          return redirectOnError(\"account_already_linked_to_different_user\");\n        }\n        const updateData = Object.fromEntries(\n          Object.entries({\n            accessToken: await setTokenUtil(tokens.accessToken, c.context),\n            refreshToken: await setTokenUtil(tokens.refreshToken, c.context),\n            idToken: tokens.idToken,\n            accessTokenExpiresAt: tokens.accessTokenExpiresAt,\n            refreshTokenExpiresAt: tokens.refreshTokenExpiresAt,\n            scope: tokens.scopes?.join(\",\")\n          }).filter(([_, value]) => value !== void 0)\n        );\n        await c.context.internalAdapter.updateAccount(\n          existingAccount.id,\n          updateData\n        );\n      } else {\n        const newAccount = await c.context.internalAdapter.createAccount(\n          {\n            userId: link.userId,\n            providerId: provider.id,\n            accountId: userInfo.id,\n            ...tokens,\n            accessToken: await setTokenUtil(tokens.accessToken, c.context),\n            refreshToken: await setTokenUtil(tokens.refreshToken, c.context),\n            scope: tokens.scopes?.join(\",\")\n          },\n          c\n        );\n        if (!newAccount) {\n          return redirectOnError(\"unable_to_link_account\");\n        }\n      }\n      let toRedirectTo2;\n      try {\n        const url = callbackURL;\n        toRedirectTo2 = url.toString();\n      } catch {\n        toRedirectTo2 = callbackURL;\n      }\n      throw c.redirect(toRedirectTo2);\n    }\n    if (!userInfo.email) {\n      c.context.logger.error(\n        \"Provider did not return email. This could be due to misconfiguration in the provider settings.\"\n      );\n      return redirectOnError(\"email_not_found\");\n    }\n    const result = await handleOAuthUserInfo(c, {\n      userInfo: {\n        ...userInfo,\n        email: userInfo.email,\n        name: userInfo.name || userInfo.email\n      },\n      account: {\n        providerId: provider.id,\n        accountId: userInfo.id,\n        ...tokens,\n        scope: tokens.scopes?.join(\",\")\n      },\n      callbackURL,\n      disableSignUp: provider.disableImplicitSignUp && !requestSignUp || provider.options?.disableSignUp,\n      overrideUserInfo: provider.options?.overrideUserInfoOnSignIn\n    });\n    if (result.error) {\n      c.context.logger.error(result.error.split(\" \").join(\"_\"));\n      return redirectOnError(result.error.split(\" \").join(\"_\"));\n    }\n    const { session, user } = result.data;\n    await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.setSessionCookie)(c, {\n      session,\n      user\n    });\n    let toRedirectTo;\n    try {\n      const url = result.isRegister ? newUserURL || callbackURL : callbackURL;\n      toRedirectTo = url.toString();\n    } catch {\n      toRedirectTo = result.isRegister ? newUserURL || callbackURL : callbackURL;\n    }\n    throw c.redirect(toRedirectTo);\n  }\n);\n\nconst signOut = createAuthEndpoint(\n  \"/sign-out\",\n  {\n    method: \"POST\",\n    requireHeaders: true,\n    metadata: {\n      openapi: {\n        description: \"Sign out the current user\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    success: {\n                      type: \"boolean\"\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    const sessionCookieToken = await ctx.getSignedCookie(\n      ctx.context.authCookies.sessionToken.name,\n      ctx.context.secret\n    );\n    if (!sessionCookieToken) {\n      (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.deleteSessionCookie)(ctx);\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.FAILED_TO_GET_SESSION\n      });\n    }\n    await ctx.context.internalAdapter.deleteSession(sessionCookieToken);\n    (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.deleteSessionCookie)(ctx);\n    return ctx.json({\n      success: true\n    });\n  }\n);\n\nfunction redirectError(ctx, callbackURL, query) {\n  const url = callbackURL ? new URL(callbackURL, ctx.baseURL) : new URL(`${ctx.baseURL}/error`);\n  if (query)\n    Object.entries(query).forEach(([k, v]) => url.searchParams.set(k, v));\n  return url.href;\n}\nfunction redirectCallback(ctx, callbackURL, query) {\n  const url = new URL(callbackURL, ctx.baseURL);\n  if (query)\n    Object.entries(query).forEach(([k, v]) => url.searchParams.set(k, v));\n  return url.href;\n}\nconst requestPasswordReset = createAuthEndpoint(\n  \"/request-password-reset\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      /**\n       * The email address of the user to send a password reset email to.\n       */\n      email: zod_v4__WEBPACK_IMPORTED_MODULE_20__.email().meta({\n        description: \"The email address of the user to send a password reset email to\"\n      }),\n      /**\n       * The URL to redirect the user to reset their password.\n       * If the token isn't valid or expired, it'll be redirected with a query parameter `?\n       * error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?\n       * token=VALID_TOKEN\n       */\n      redirectTo: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN\"\n      }).optional()\n    }),\n    metadata: {\n      openapi: {\n        description: \"Send a password reset email to the user\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    status: {\n                      type: \"boolean\"\n                    },\n                    message: {\n                      type: \"string\"\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    if (!ctx.context.options.emailAndPassword?.sendResetPassword) {\n      ctx.context.logger.error(\n        \"Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!\"\n      );\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Reset password isn't enabled\"\n      });\n    }\n    const { email, redirectTo } = ctx.body;\n    const user = await ctx.context.internalAdapter.findUserByEmail(email, {\n      includeAccounts: true\n    });\n    if (!user) {\n      ctx.context.logger.error(\"Reset Password: User not found\", { email });\n      return ctx.json({\n        status: true,\n        message: \"If this email exists in our system, check your email for the reset link\"\n      });\n    }\n    const defaultExpiresIn = 60 * 60 * 1;\n    const expiresAt = (0,_better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_1__.g)(\n      ctx.context.options.emailAndPassword.resetPasswordTokenExpiresIn || defaultExpiresIn,\n      \"sec\"\n    );\n    const verificationToken = (0,_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_15__.g)(24);\n    await ctx.context.internalAdapter.createVerificationValue(\n      {\n        value: user.user.id,\n        identifier: `reset-password:${verificationToken}`,\n        expiresAt\n      },\n      ctx\n    );\n    const callbackURL = redirectTo ? encodeURIComponent(redirectTo) : \"\";\n    const url = `${ctx.context.baseURL}/reset-password/${verificationToken}?callbackURL=${callbackURL}`;\n    await ctx.context.options.emailAndPassword.sendResetPassword(\n      {\n        user: user.user,\n        url,\n        token: verificationToken\n      },\n      ctx.request\n    );\n    return ctx.json({\n      status: true\n    });\n  }\n);\nconst forgetPassword = createAuthEndpoint(\n  \"/forget-password\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      /**\n       * The email address of the user to send a password reset email to.\n       */\n      email: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().email().meta({\n        description: \"The email address of the user to send a password reset email to\"\n      }),\n      /**\n       * The URL to redirect the user to reset their password.\n       * If the token isn't valid or expired, it'll be redirected with a query parameter `?\n       * error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?\n       * token=VALID_TOKEN\n       */\n      redirectTo: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN\"\n      }).optional()\n    }),\n    metadata: {\n      openapi: {\n        description: \"Send a password reset email to the user\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    status: {\n                      type: \"boolean\"\n                    },\n                    message: {\n                      type: \"string\"\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    if (!ctx.context.options.emailAndPassword?.sendResetPassword) {\n      ctx.context.logger.error(\n        \"Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!\"\n      );\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Reset password isn't enabled\"\n      });\n    }\n    const { email, redirectTo } = ctx.body;\n    const user = await ctx.context.internalAdapter.findUserByEmail(email, {\n      includeAccounts: true\n    });\n    if (!user) {\n      ctx.context.logger.error(\"Reset Password: User not found\", { email });\n      return ctx.json({\n        status: true,\n        message: \"If this email exists in our system, check your email for the reset link\"\n      });\n    }\n    const defaultExpiresIn = 60 * 60 * 1;\n    const expiresAt = (0,_better_auth_CW6D9eSx_mjs__WEBPACK_IMPORTED_MODULE_1__.g)(\n      ctx.context.options.emailAndPassword.resetPasswordTokenExpiresIn || defaultExpiresIn,\n      \"sec\"\n    );\n    const verificationToken = (0,_better_auth_DBGfIDnh_mjs__WEBPACK_IMPORTED_MODULE_15__.g)(24);\n    await ctx.context.internalAdapter.createVerificationValue(\n      {\n        value: user.user.id,\n        identifier: `reset-password:${verificationToken}`,\n        expiresAt\n      },\n      ctx\n    );\n    const callbackURL = redirectTo ? encodeURIComponent(redirectTo) : \"\";\n    const url = `${ctx.context.baseURL}/reset-password/${verificationToken}?callbackURL=${callbackURL}`;\n    await ctx.context.options.emailAndPassword.sendResetPassword(\n      {\n        user: user.user,\n        url,\n        token: verificationToken\n      },\n      ctx.request\n    );\n    return ctx.json({\n      status: true\n    });\n  }\n);\nconst requestPasswordResetCallback = createAuthEndpoint(\n  \"/reset-password/:token\",\n  {\n    method: \"GET\",\n    query: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      callbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The URL to redirect the user to reset their password\"\n      })\n    }),\n    use: [originCheck((ctx) => ctx.query.callbackURL)],\n    metadata: {\n      openapi: {\n        description: \"Redirects the user to the callback URL with the token\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    token: {\n                      type: \"string\"\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    const { token } = ctx.params;\n    const { callbackURL } = ctx.query;\n    if (!token || !callbackURL) {\n      throw ctx.redirect(\n        redirectError(ctx.context, callbackURL, { error: \"INVALID_TOKEN\" })\n      );\n    }\n    const verification = await ctx.context.internalAdapter.findVerificationValue(\n      `reset-password:${token}`\n    );\n    if (!verification || verification.expiresAt < /* @__PURE__ */ new Date()) {\n      throw ctx.redirect(\n        redirectError(ctx.context, callbackURL, { error: \"INVALID_TOKEN\" })\n      );\n    }\n    throw ctx.redirect(redirectCallback(ctx.context, callbackURL, { token }));\n  }\n);\nconst forgetPasswordCallback = requestPasswordResetCallback;\nconst resetPassword = createAuthEndpoint(\n  \"/reset-password\",\n  {\n    method: \"POST\",\n    query: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      token: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional()\n    }).optional(),\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      newPassword: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The new password to set\"\n      }),\n      token: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The token to reset the password\"\n      }).optional()\n    }),\n    metadata: {\n      openapi: {\n        description: \"Reset the password for a user\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    status: {\n                      type: \"boolean\"\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    const token = ctx.body.token || ctx.query?.token;\n    if (!token) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.INVALID_TOKEN\n      });\n    }\n    const { newPassword } = ctx.body;\n    const minLength = ctx.context.password?.config.minPasswordLength;\n    const maxLength = ctx.context.password?.config.maxPasswordLength;\n    if (newPassword.length < minLength) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.PASSWORD_TOO_SHORT\n      });\n    }\n    if (newPassword.length > maxLength) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.PASSWORD_TOO_LONG\n      });\n    }\n    const id = `reset-password:${token}`;\n    const verification = await ctx.context.internalAdapter.findVerificationValue(id);\n    if (!verification || verification.expiresAt < /* @__PURE__ */ new Date()) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.INVALID_TOKEN\n      });\n    }\n    const userId = verification.value;\n    const hashedPassword = await ctx.context.password.hash(newPassword);\n    const accounts = await ctx.context.internalAdapter.findAccounts(userId);\n    const account = accounts.find((ac) => ac.providerId === \"credential\");\n    if (!account) {\n      await ctx.context.internalAdapter.createAccount(\n        {\n          userId,\n          providerId: \"credential\",\n          password: hashedPassword,\n          accountId: userId\n        },\n        ctx\n      );\n    } else {\n      await ctx.context.internalAdapter.updatePassword(\n        userId,\n        hashedPassword,\n        ctx\n      );\n    }\n    await ctx.context.internalAdapter.deleteVerificationValue(verification.id);\n    if (ctx.context.options.emailAndPassword?.onPasswordReset) {\n      const user = await ctx.context.internalAdapter.findUserById(userId);\n      if (user) {\n        await ctx.context.options.emailAndPassword.onPasswordReset(\n          {\n            user\n          },\n          ctx.request\n        );\n      }\n    }\n    if (ctx.context.options.emailAndPassword?.revokeSessionsOnPasswordReset) {\n      await ctx.context.internalAdapter.deleteSessions(userId);\n    }\n    return ctx.json({\n      status: true\n    });\n  }\n);\n\nconst updateUser = () => createAuthEndpoint(\n  \"/update-user\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.record(\n      zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"Field name must be a string\"\n      }),\n      zod_v4__WEBPACK_IMPORTED_MODULE_20__.any()\n    ),\n    use: [sessionMiddleware],\n    metadata: {\n      $Infer: {\n        body: {}\n      },\n      openapi: {\n        description: \"Update the current user\",\n        requestBody: {\n          content: {\n            \"application/json\": {\n              schema: {\n                type: \"object\",\n                properties: {\n                  name: {\n                    type: \"string\",\n                    description: \"The name of the user\"\n                  },\n                  image: {\n                    type: \"string\",\n                    description: \"The image of the user\"\n                  }\n                }\n              }\n            }\n          }\n        },\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    status: {\n                      type: \"boolean\",\n                      description: \"Indicates if the update was successful\"\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    const body = ctx.body;\n    if (body.email) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.EMAIL_CAN_NOT_BE_UPDATED\n      });\n    }\n    const { name, image, ...rest } = body;\n    const session = ctx.context.session;\n    if (image === void 0 && name === void 0 && Object.keys(rest).length === 0) {\n      return ctx.json({\n        status: true\n      });\n    }\n    const additionalFields = (0,_better_auth_n2KFGwjY_mjs__WEBPACK_IMPORTED_MODULE_16__.f)(\n      ctx.context.options,\n      rest,\n      \"update\"\n    );\n    const user = await ctx.context.internalAdapter.updateUser(\n      session.user.id,\n      {\n        name,\n        image,\n        ...additionalFields\n      },\n      ctx\n    );\n    await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.setSessionCookie)(ctx, {\n      session: session.session,\n      user\n    });\n    return ctx.json({\n      status: true\n    });\n  }\n);\nconst changePassword = createAuthEndpoint(\n  \"/change-password\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      /**\n       * The new password to set\n       */\n      newPassword: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The new password to set\"\n      }),\n      /**\n       * The current password of the user\n       */\n      currentPassword: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The current password is required\"\n      }),\n      /**\n       * revoke all sessions that are not the\n       * current one logged in by the user\n       */\n      revokeOtherSessions: zod_v4__WEBPACK_IMPORTED_MODULE_20__.boolean().meta({\n        description: \"Must be a boolean value\"\n      }).optional()\n    }),\n    use: [sessionMiddleware],\n    metadata: {\n      openapi: {\n        description: \"Change the password of the user\",\n        responses: {\n          \"200\": {\n            description: \"Password successfully changed\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    token: {\n                      type: \"string\",\n                      nullable: true,\n                      // Only present if revokeOtherSessions is true\n                      description: \"New session token if other sessions were revoked\"\n                    },\n                    user: {\n                      type: \"object\",\n                      properties: {\n                        id: {\n                          type: \"string\",\n                          description: \"The unique identifier of the user\"\n                        },\n                        email: {\n                          type: \"string\",\n                          format: \"email\",\n                          description: \"The email address of the user\"\n                        },\n                        name: {\n                          type: \"string\",\n                          description: \"The name of the user\"\n                        },\n                        image: {\n                          type: \"string\",\n                          format: \"uri\",\n                          nullable: true,\n                          description: \"The profile image URL of the user\"\n                        },\n                        emailVerified: {\n                          type: \"boolean\",\n                          description: \"Whether the email has been verified\"\n                        },\n                        createdAt: {\n                          type: \"string\",\n                          format: \"date-time\",\n                          description: \"When the user was created\"\n                        },\n                        updatedAt: {\n                          type: \"string\",\n                          format: \"date-time\",\n                          description: \"When the user was last updated\"\n                        }\n                      },\n                      required: [\n                        \"id\",\n                        \"email\",\n                        \"name\",\n                        \"emailVerified\",\n                        \"createdAt\",\n                        \"updatedAt\"\n                      ]\n                    }\n                  },\n                  required: [\"user\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    const { newPassword, currentPassword, revokeOtherSessions } = ctx.body;\n    const session = ctx.context.session;\n    const minPasswordLength = ctx.context.password.config.minPasswordLength;\n    if (newPassword.length < minPasswordLength) {\n      ctx.context.logger.error(\"Password is too short\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.PASSWORD_TOO_SHORT\n      });\n    }\n    const maxPasswordLength = ctx.context.password.config.maxPasswordLength;\n    if (newPassword.length > maxPasswordLength) {\n      ctx.context.logger.error(\"Password is too long\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.PASSWORD_TOO_LONG\n      });\n    }\n    const accounts = await ctx.context.internalAdapter.findAccounts(\n      session.user.id\n    );\n    const account = accounts.find(\n      (account2) => account2.providerId === \"credential\" && account2.password\n    );\n    if (!account || !account.password) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.CREDENTIAL_ACCOUNT_NOT_FOUND\n      });\n    }\n    const passwordHash = await ctx.context.password.hash(newPassword);\n    const verify = await ctx.context.password.verify({\n      hash: account.password,\n      password: currentPassword\n    });\n    if (!verify) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.INVALID_PASSWORD\n      });\n    }\n    await ctx.context.internalAdapter.updateAccount(account.id, {\n      password: passwordHash\n    });\n    let token = null;\n    if (revokeOtherSessions) {\n      await ctx.context.internalAdapter.deleteSessions(session.user.id);\n      const newSession = await ctx.context.internalAdapter.createSession(\n        session.user.id,\n        ctx\n      );\n      if (!newSession) {\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"INTERNAL_SERVER_ERROR\", {\n          message: BASE_ERROR_CODES.FAILED_TO_GET_SESSION\n        });\n      }\n      await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.setSessionCookie)(ctx, {\n        session: newSession,\n        user: session.user\n      });\n      token = newSession.token;\n    }\n    return ctx.json({\n      token,\n      user: {\n        id: session.user.id,\n        email: session.user.email,\n        name: session.user.name,\n        image: session.user.image,\n        emailVerified: session.user.emailVerified,\n        createdAt: session.user.createdAt,\n        updatedAt: session.user.updatedAt\n      }\n    });\n  }\n);\nconst setPassword = createAuthEndpoint(\n  \"/set-password\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      /**\n       * The new password to set\n       */\n      newPassword: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The new password to set is required\"\n      })\n    }),\n    metadata: {\n      SERVER_ONLY: true\n    },\n    use: [sessionMiddleware]\n  },\n  async (ctx) => {\n    const { newPassword } = ctx.body;\n    const session = ctx.context.session;\n    const minPasswordLength = ctx.context.password.config.minPasswordLength;\n    if (newPassword.length < minPasswordLength) {\n      ctx.context.logger.error(\"Password is too short\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.PASSWORD_TOO_SHORT\n      });\n    }\n    const maxPasswordLength = ctx.context.password.config.maxPasswordLength;\n    if (newPassword.length > maxPasswordLength) {\n      ctx.context.logger.error(\"Password is too long\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.PASSWORD_TOO_LONG\n      });\n    }\n    const accounts = await ctx.context.internalAdapter.findAccounts(\n      session.user.id\n    );\n    const account = accounts.find(\n      (account2) => account2.providerId === \"credential\" && account2.password\n    );\n    const passwordHash = await ctx.context.password.hash(newPassword);\n    if (!account) {\n      await ctx.context.internalAdapter.linkAccount(\n        {\n          userId: session.user.id,\n          providerId: \"credential\",\n          accountId: session.user.id,\n          password: passwordHash\n        },\n        ctx\n      );\n      return ctx.json({\n        status: true\n      });\n    }\n    throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n      message: \"user already has a password\"\n    });\n  }\n);\nconst deleteUser = createAuthEndpoint(\n  \"/delete-user\",\n  {\n    method: \"POST\",\n    use: [sessionMiddleware],\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      /**\n       * The callback URL to redirect to after the user is deleted\n       * this is only used on delete user callback\n       */\n      callbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The callback URL to redirect to after the user is deleted\"\n      }).optional(),\n      /**\n       * The password of the user. If the password isn't provided, session freshness\n       * will be checked.\n       */\n      password: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The password of the user is required to delete the user\"\n      }).optional(),\n      /**\n       * The token to delete the user. If the token is provided, the user will be deleted\n       */\n      token: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The token to delete the user is required\"\n      }).optional()\n    }),\n    metadata: {\n      openapi: {\n        description: \"Delete the user\",\n        responses: {\n          \"200\": {\n            description: \"User deletion processed successfully\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    success: {\n                      type: \"boolean\",\n                      description: \"Indicates if the operation was successful\"\n                    },\n                    message: {\n                      type: \"string\",\n                      enum: [\"User deleted\", \"Verification email sent\"],\n                      description: \"Status message of the deletion process\"\n                    }\n                  },\n                  required: [\"success\", \"message\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    if (!ctx.context.options.user?.deleteUser?.enabled) {\n      ctx.context.logger.error(\n        \"Delete user is disabled. Enable it in the options\",\n        {\n          session: ctx.context.session\n        }\n      );\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"NOT_FOUND\");\n    }\n    const session = ctx.context.session;\n    if (ctx.body.password) {\n      const accounts = await ctx.context.internalAdapter.findAccounts(\n        session.user.id\n      );\n      const account = accounts.find(\n        (account2) => account2.providerId === \"credential\" && account2.password\n      );\n      if (!account || !account.password) {\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n          message: BASE_ERROR_CODES.CREDENTIAL_ACCOUNT_NOT_FOUND\n        });\n      }\n      const verify = await ctx.context.password.verify({\n        hash: account.password,\n        password: ctx.body.password\n      });\n      if (!verify) {\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n          message: BASE_ERROR_CODES.INVALID_PASSWORD\n        });\n      }\n    }\n    if (ctx.body.token) {\n      await deleteUserCallback({\n        ...ctx,\n        query: {\n          token: ctx.body.token\n        }\n      });\n      return ctx.json({\n        success: true,\n        message: \"User deleted\"\n      });\n    }\n    if (ctx.context.options.user.deleteUser?.sendDeleteAccountVerification) {\n      const token = (0,_better_auth_B4Qoxdgc_mjs__WEBPACK_IMPORTED_MODULE_8__.g)(32, \"0-9\", \"a-z\");\n      await ctx.context.internalAdapter.createVerificationValue(\n        {\n          value: session.user.id,\n          identifier: `delete-account-${token}`,\n          expiresAt: new Date(\n            Date.now() + (ctx.context.options.user.deleteUser?.deleteTokenExpiresIn || 60 * 60 * 24) * 1e3\n          )\n        },\n        ctx\n      );\n      const url = `${ctx.context.baseURL}/delete-user/callback?token=${token}&callbackURL=${ctx.body.callbackURL || \"/\"}`;\n      await ctx.context.options.user.deleteUser.sendDeleteAccountVerification(\n        {\n          user: session.user,\n          url,\n          token\n        },\n        ctx.request\n      );\n      return ctx.json({\n        success: true,\n        message: \"Verification email sent\"\n      });\n    }\n    if (!ctx.body.password && ctx.context.sessionConfig.freshAge !== 0) {\n      const currentAge = session.session.createdAt.getTime();\n      const freshAge = ctx.context.sessionConfig.freshAge * 1e3;\n      const now = Date.now();\n      if (now - currentAge > freshAge * 1e3) {\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n          message: BASE_ERROR_CODES.SESSION_EXPIRED\n        });\n      }\n    }\n    const beforeDelete = ctx.context.options.user.deleteUser?.beforeDelete;\n    if (beforeDelete) {\n      await beforeDelete(session.user, ctx.request);\n    }\n    await ctx.context.internalAdapter.deleteUser(session.user.id);\n    await ctx.context.internalAdapter.deleteSessions(session.user.id);\n    await ctx.context.internalAdapter.deleteAccounts(session.user.id);\n    (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.deleteSessionCookie)(ctx);\n    const afterDelete = ctx.context.options.user.deleteUser?.afterDelete;\n    if (afterDelete) {\n      await afterDelete(session.user, ctx.request);\n    }\n    return ctx.json({\n      success: true,\n      message: \"User deleted\"\n    });\n  }\n);\nconst deleteUserCallback = createAuthEndpoint(\n  \"/delete-user/callback\",\n  {\n    method: \"GET\",\n    query: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      token: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The token to verify the deletion request\"\n      }),\n      callbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The URL to redirect to after deletion\"\n      }).optional()\n    }),\n    use: [originCheck((ctx) => ctx.query.callbackURL)],\n    metadata: {\n      openapi: {\n        description: \"Callback to complete user deletion with verification token\",\n        responses: {\n          \"200\": {\n            description: \"User successfully deleted\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    success: {\n                      type: \"boolean\",\n                      description: \"Indicates if the deletion was successful\"\n                    },\n                    message: {\n                      type: \"string\",\n                      enum: [\"User deleted\"],\n                      description: \"Confirmation message\"\n                    }\n                  },\n                  required: [\"success\", \"message\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    if (!ctx.context.options.user?.deleteUser?.enabled) {\n      ctx.context.logger.error(\n        \"Delete user is disabled. Enable it in the options\"\n      );\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"NOT_FOUND\");\n    }\n    const session = await getSessionFromCtx(ctx);\n    if (!session) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"NOT_FOUND\", {\n        message: BASE_ERROR_CODES.FAILED_TO_GET_USER_INFO\n      });\n    }\n    const token = await ctx.context.internalAdapter.findVerificationValue(\n      `delete-account-${ctx.query.token}`\n    );\n    if (!token || token.expiresAt < /* @__PURE__ */ new Date()) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"NOT_FOUND\", {\n        message: BASE_ERROR_CODES.INVALID_TOKEN\n      });\n    }\n    if (token.value !== session.user.id) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"NOT_FOUND\", {\n        message: BASE_ERROR_CODES.INVALID_TOKEN\n      });\n    }\n    const beforeDelete = ctx.context.options.user.deleteUser?.beforeDelete;\n    if (beforeDelete) {\n      await beforeDelete(session.user, ctx.request);\n    }\n    await ctx.context.internalAdapter.deleteUser(session.user.id);\n    await ctx.context.internalAdapter.deleteSessions(session.user.id);\n    await ctx.context.internalAdapter.deleteAccounts(session.user.id);\n    await ctx.context.internalAdapter.deleteVerificationValue(token.id);\n    (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.deleteSessionCookie)(ctx);\n    const afterDelete = ctx.context.options.user.deleteUser?.afterDelete;\n    if (afterDelete) {\n      await afterDelete(session.user, ctx.request);\n    }\n    if (ctx.query.callbackURL) {\n      throw ctx.redirect(ctx.query.callbackURL || \"/\");\n    }\n    return ctx.json({\n      success: true,\n      message: \"User deleted\"\n    });\n  }\n);\nconst changeEmail = createAuthEndpoint(\n  \"/change-email\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      newEmail: zod_v4__WEBPACK_IMPORTED_MODULE_20__.email().meta({\n        description: \"The new email address to set must be a valid email address\"\n      }),\n      callbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The URL to redirect to after email verification\"\n      }).optional()\n    }),\n    use: [sessionMiddleware],\n    metadata: {\n      openapi: {\n        responses: {\n          \"200\": {\n            description: \"Email change request processed successfully\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    status: {\n                      type: \"boolean\",\n                      description: \"Indicates if the request was successful\"\n                    },\n                    message: {\n                      type: \"string\",\n                      enum: [\"Email updated\", \"Verification email sent\"],\n                      description: \"Status message of the email change process\",\n                      nullable: true\n                    }\n                  },\n                  required: [\"status\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    if (!ctx.context.options.user?.changeEmail?.enabled) {\n      ctx.context.logger.error(\"Change email is disabled.\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Change email is disabled\"\n      });\n    }\n    const newEmail = ctx.body.newEmail.toLowerCase();\n    if (newEmail === ctx.context.session.user.email) {\n      ctx.context.logger.error(\"Email is the same\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Email is the same\"\n      });\n    }\n    const existingUser = await ctx.context.internalAdapter.findUserByEmail(newEmail);\n    if (existingUser) {\n      ctx.context.logger.error(\"Email already exists\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Couldn't update your email\"\n      });\n    }\n    if (ctx.context.session.user.emailVerified !== true) {\n      const existing = await ctx.context.internalAdapter.findUserByEmail(newEmail);\n      if (existing) {\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNPROCESSABLE_ENTITY\", {\n          message: BASE_ERROR_CODES.USER_ALREADY_EXISTS\n        });\n      }\n      await ctx.context.internalAdapter.updateUserByEmail(\n        ctx.context.session.user.email,\n        {\n          email: newEmail\n        },\n        ctx\n      );\n      await (0,_cookies_index_mjs__WEBPACK_IMPORTED_MODULE_10__.setSessionCookie)(ctx, {\n        session: ctx.context.session.session,\n        user: {\n          ...ctx.context.session.user,\n          email: newEmail\n        }\n      });\n      if (ctx.context.options.emailVerification?.sendVerificationEmail) {\n        const token2 = await createEmailVerificationToken(\n          ctx.context.secret,\n          newEmail,\n          void 0,\n          ctx.context.options.emailVerification?.expiresIn\n        );\n        const url2 = `${ctx.context.baseURL}/verify-email?token=${token2}&callbackURL=${ctx.body.callbackURL || \"/\"}`;\n        await ctx.context.options.emailVerification.sendVerificationEmail(\n          {\n            user: {\n              ...ctx.context.session.user,\n              email: newEmail\n            },\n            url: url2,\n            token: token2\n          },\n          ctx.request\n        );\n      }\n      return ctx.json({\n        status: true\n      });\n    }\n    if (!ctx.context.options.user.changeEmail.sendChangeEmailVerification) {\n      ctx.context.logger.error(\"Verification email isn't enabled.\");\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Verification email isn't enabled\"\n      });\n    }\n    const token = await createEmailVerificationToken(\n      ctx.context.secret,\n      ctx.context.session.user.email,\n      newEmail,\n      ctx.context.options.emailVerification?.expiresIn\n    );\n    const url = `${ctx.context.baseURL}/verify-email?token=${token}&callbackURL=${ctx.body.callbackURL || \"/\"}`;\n    await ctx.context.options.user.changeEmail.sendChangeEmailVerification(\n      {\n        user: ctx.context.session.user,\n        newEmail,\n        url,\n        token\n      },\n      ctx.request\n    );\n    return ctx.json({\n      status: true\n    });\n  }\n);\n\nfunction sanitize(input) {\n  return input.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\").replace(/\"/g, \"&quot;\").replace(/'/g, \"&#39;\");\n}\nconst html = (errorCode = \"Unknown\") => `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Authentication Error</title>\n    <style>\n        :root {\n            --bg-color: #f8f9fa;\n            --text-color: #212529;\n            --accent-color: #000000;\n            --error-color: #dc3545;\n            --border-color: #e9ecef;\n        }\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n            background-color: var(--bg-color);\n            color: var(--text-color);\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 100vh;\n            margin: 0;\n            line-height: 1.5;\n        }\n        .error-container {\n            background-color: #ffffff;\n            border-radius: 12px;\n            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);\n            padding: 2.5rem;\n            text-align: center;\n            max-width: 90%;\n            width: 400px;\n        }\n        h1 {\n            color: var(--error-color);\n            font-size: 1.75rem;\n            margin-bottom: 1rem;\n            font-weight: 600;\n        }\n        p {\n            margin-bottom: 1.5rem;\n            color: #495057;\n        }\n        .btn {\n            background-color: var(--accent-color);\n            color: #ffffff;\n            text-decoration: none;\n            padding: 0.75rem 1.5rem;\n            border-radius: 6px;\n            transition: all 0.3s ease;\n            display: inline-block;\n            font-weight: 500;\n            border: 2px solid var(--accent-color);\n        }\n        .btn:hover {\n            background-color: #131721;\n        }\n        .error-code {\n            font-size: 0.875rem;\n            color: #6c757d;\n            margin-top: 1.5rem;\n            padding-top: 1.5rem;\n            border-top: 1px solid var(--border-color);\n        }\n        .icon {\n            font-size: 3rem;\n            margin-bottom: 1rem;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"error-container\">\n        <div class=\"icon\">\\u26A0\\uFE0F</div>\n        <h1>Better Auth Error</h1>\n        <p>We encountered an issue while processing your request. Please try again or contact the application owner if the problem persists.</p>\n        <a href=\"/\" id=\"returnLink\" class=\"btn\">Return to Application</a>\n        <div class=\"error-code\">Error Code: <span id=\"errorCode\">${sanitize(\n  errorCode\n)}</span></div>\n    </div>\n</body>\n</html>`;\nconst error = createAuthEndpoint(\n  \"/error\",\n  {\n    method: \"GET\",\n    metadata: {\n      ...HIDE_METADATA,\n      openapi: {\n        description: \"Displays an error page\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"text/html\": {\n                schema: {\n                  type: \"string\",\n                  description: \"The HTML content of the error page\"\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (c) => {\n    const query = new URL(c.request?.url || \"\").searchParams.get(\"error\") || \"Unknown\";\n    return new Response(html(query), {\n      headers: {\n        \"Content-Type\": \"text/html\"\n      }\n    });\n  }\n);\n\nconst ok = createAuthEndpoint(\n  \"/ok\",\n  {\n    method: \"GET\",\n    metadata: {\n      ...HIDE_METADATA,\n      openapi: {\n        description: \"Check if the API is working\",\n        responses: {\n          \"200\": {\n            description: \"API is working\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    ok: {\n                      type: \"boolean\",\n                      description: \"Indicates if the API is working\"\n                    }\n                  },\n                  required: [\"ok\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    return ctx.json({\n      ok: true\n    });\n  }\n);\n\nconst listUserAccounts = createAuthEndpoint(\n  \"/list-accounts\",\n  {\n    method: \"GET\",\n    use: [sessionMiddleware],\n    metadata: {\n      openapi: {\n        description: \"List all accounts linked to the user\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"array\",\n                  items: {\n                    type: \"object\",\n                    properties: {\n                      id: {\n                        type: \"string\"\n                      },\n                      provider: {\n                        type: \"string\"\n                      },\n                      createdAt: {\n                        type: \"string\",\n                        format: \"date-time\"\n                      },\n                      updatedAt: {\n                        type: \"string\",\n                        format: \"date-time\"\n                      }\n                    },\n                    accountId: {\n                      type: \"string\"\n                    },\n                    scopes: {\n                      type: \"array\",\n                      items: {\n                        type: \"string\"\n                      }\n                    }\n                  },\n                  required: [\n                    \"id\",\n                    \"provider\",\n                    \"createdAt\",\n                    \"updatedAt\",\n                    \"accountId\",\n                    \"scopes\"\n                  ]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (c) => {\n    const session = c.context.session;\n    const accounts = await c.context.internalAdapter.findAccounts(\n      session.user.id\n    );\n    return c.json(\n      accounts.map((a) => ({\n        id: a.id,\n        provider: a.providerId,\n        createdAt: a.createdAt,\n        updatedAt: a.updatedAt,\n        accountId: a.accountId,\n        scopes: a.scope?.split(\",\") || []\n      }))\n    );\n  }\n);\nconst linkSocialAccount = createAuthEndpoint(\n  \"/link-social\",\n  {\n    method: \"POST\",\n    requireHeaders: true,\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      /**\n       * Callback URL to redirect to after the user has signed in.\n       */\n      callbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The URL to redirect to after the user has signed in\"\n      }).optional(),\n      /**\n       * OAuth2 provider to use\n       */\n      provider: SocialProviderListEnum,\n      /**\n       * ID Token for direct authentication without redirect\n       */\n      idToken: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n        token: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string(),\n        nonce: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional(),\n        accessToken: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional(),\n        refreshToken: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional(),\n        scopes: zod_v4__WEBPACK_IMPORTED_MODULE_20__.array(zod_v4__WEBPACK_IMPORTED_MODULE_20__.string()).optional()\n      }).optional(),\n      /**\n       * Whether to allow sign up for new users\n       */\n      requestSignUp: zod_v4__WEBPACK_IMPORTED_MODULE_20__.boolean().optional(),\n      /**\n       * Additional scopes to request when linking the account.\n       * This is useful for requesting additional permissions when\n       * linking a social account compared to the initial authentication.\n       */\n      scopes: zod_v4__WEBPACK_IMPORTED_MODULE_20__.array(zod_v4__WEBPACK_IMPORTED_MODULE_20__.string()).meta({\n        description: \"Additional scopes to request from the provider\"\n      }).optional(),\n      /**\n       * The URL to redirect to if there is an error during the link process.\n       */\n      errorCallbackURL: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The URL to redirect to if there is an error during the link process\"\n      }).optional()\n    }),\n    use: [sessionMiddleware],\n    metadata: {\n      openapi: {\n        description: \"Link a social account to the user\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    url: {\n                      type: \"string\",\n                      description: \"The authorization URL to redirect the user to\"\n                    },\n                    redirect: {\n                      type: \"boolean\",\n                      description: \"Indicates if the user should be redirected to the authorization URL\"\n                    },\n                    status: {\n                      type: \"boolean\"\n                    }\n                  },\n                  required: [\"redirect\"]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (c) => {\n    const session = c.context.session;\n    const provider = c.context.socialProviders.find(\n      (p) => p.id === c.body.provider\n    );\n    if (!provider) {\n      c.context.logger.error(\n        \"Provider not found. Make sure to add the provider in your auth config\",\n        {\n          provider: c.body.provider\n        }\n      );\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"NOT_FOUND\", {\n        message: BASE_ERROR_CODES.PROVIDER_NOT_FOUND\n      });\n    }\n    if (c.body.idToken) {\n      if (!provider.verifyIdToken) {\n        c.context.logger.error(\n          \"Provider does not support id token verification\",\n          {\n            provider: c.body.provider\n          }\n        );\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"NOT_FOUND\", {\n          message: BASE_ERROR_CODES.ID_TOKEN_NOT_SUPPORTED\n        });\n      }\n      const { token, nonce } = c.body.idToken;\n      const valid = await provider.verifyIdToken(token, nonce);\n      if (!valid) {\n        c.context.logger.error(\"Invalid id token\", {\n          provider: c.body.provider\n        });\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n          message: BASE_ERROR_CODES.INVALID_TOKEN\n        });\n      }\n      const linkingUserInfo = await provider.getUserInfo({\n        idToken: token,\n        accessToken: c.body.idToken.accessToken,\n        refreshToken: c.body.idToken.refreshToken\n      });\n      if (!linkingUserInfo || !linkingUserInfo?.user) {\n        c.context.logger.error(\"Failed to get user info\", {\n          provider: c.body.provider\n        });\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n          message: BASE_ERROR_CODES.FAILED_TO_GET_USER_INFO\n        });\n      }\n      if (!linkingUserInfo.user.email) {\n        c.context.logger.error(\"User email not found\", {\n          provider: c.body.provider\n        });\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n          message: BASE_ERROR_CODES.USER_EMAIL_NOT_FOUND\n        });\n      }\n      const existingAccounts = await c.context.internalAdapter.findAccounts(\n        session.user.id\n      );\n      const hasBeenLinked = existingAccounts.find(\n        (a) => a.providerId === provider.id && a.accountId === linkingUserInfo.user.id\n      );\n      if (hasBeenLinked) {\n        return c.json({\n          redirect: false,\n          url: \"\",\n          // this is for type inference\n          status: true\n        });\n      }\n      const trustedProviders = c.context.options.account?.accountLinking?.trustedProviders;\n      const isTrustedProvider = trustedProviders?.includes(provider.id);\n      if (!isTrustedProvider && !linkingUserInfo.user.emailVerified || c.context.options.account?.accountLinking?.enabled === false) {\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n          message: \"Account not linked - linking not allowed\"\n        });\n      }\n      if (linkingUserInfo.user.email !== session.user.email && c.context.options.account?.accountLinking?.allowDifferentEmails !== true) {\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"UNAUTHORIZED\", {\n          message: \"Account not linked - different emails not allowed\"\n        });\n      }\n      try {\n        await c.context.internalAdapter.createAccount(\n          {\n            userId: session.user.id,\n            providerId: provider.id,\n            accountId: linkingUserInfo.user.id.toString(),\n            accessToken: c.body.idToken.accessToken,\n            idToken: token,\n            refreshToken: c.body.idToken.refreshToken,\n            scope: c.body.idToken.scopes?.join(\",\")\n          },\n          c\n        );\n      } catch (e) {\n        throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"EXPECTATION_FAILED\", {\n          message: \"Account not linked - unable to create account\"\n        });\n      }\n      if (c.context.options.account?.accountLinking?.updateUserInfoOnLink === true) {\n        try {\n          await c.context.internalAdapter.updateUser(session.user.id, {\n            name: linkingUserInfo.user?.name,\n            image: linkingUserInfo.user?.image\n          });\n        } catch (e) {\n          console.warn(\"Could not update user - \" + e.toString());\n        }\n      }\n      return c.json({\n        redirect: false,\n        url: \"\",\n        // this is for type inference\n        status: true\n      });\n    }\n    const state = await generateState(c, {\n      userId: session.user.id,\n      email: session.user.email\n    });\n    const url = await provider.createAuthorizationURL({\n      state: state.state,\n      codeVerifier: state.codeVerifier,\n      redirectURI: `${c.context.baseURL}/callback/${provider.id}`,\n      scopes: c.body.scopes\n    });\n    return c.json({\n      url: url.toString(),\n      redirect: true\n    });\n  }\n);\nconst unlinkAccount = createAuthEndpoint(\n  \"/unlink-account\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      providerId: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string(),\n      accountId: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().optional()\n    }),\n    use: [freshSessionMiddleware],\n    metadata: {\n      openapi: {\n        description: \"Unlink an account\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    status: {\n                      type: \"boolean\"\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    const { providerId, accountId } = ctx.body;\n    const accounts = await ctx.context.internalAdapter.findAccounts(\n      ctx.context.session.user.id\n    );\n    if (accounts.length === 1 && !ctx.context.options.account?.accountLinking?.allowUnlinkingAll) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.FAILED_TO_UNLINK_LAST_ACCOUNT\n      });\n    }\n    const accountExist = accounts.find(\n      (account) => accountId ? account.accountId === accountId && account.providerId === providerId : account.providerId === providerId\n    );\n    if (!accountExist) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: BASE_ERROR_CODES.ACCOUNT_NOT_FOUND\n      });\n    }\n    await ctx.context.internalAdapter.deleteAccount(accountExist.id);\n    return ctx.json({\n      status: true\n    });\n  }\n);\nconst getAccessToken = createAuthEndpoint(\n  \"/get-access-token\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      providerId: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The provider ID for the OAuth provider\"\n      }),\n      accountId: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The account ID associated with the refresh token\"\n      }).optional(),\n      userId: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The user ID associated with the account\"\n      }).optional()\n    }),\n    metadata: {\n      openapi: {\n        description: \"Get a valid access token, doing a refresh if needed\",\n        responses: {\n          200: {\n            description: \"A Valid access token\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    tokenType: {\n                      type: \"string\"\n                    },\n                    idToken: {\n                      type: \"string\"\n                    },\n                    accessToken: {\n                      type: \"string\"\n                    },\n                    refreshToken: {\n                      type: \"string\"\n                    },\n                    accessTokenExpiresAt: {\n                      type: \"string\",\n                      format: \"date-time\"\n                    },\n                    refreshTokenExpiresAt: {\n                      type: \"string\",\n                      format: \"date-time\"\n                    }\n                  }\n                }\n              }\n            }\n          },\n          400: {\n            description: \"Invalid refresh token or provider configuration\"\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    const { providerId, accountId, userId } = ctx.body;\n    const req = ctx.request;\n    const session = await getSessionFromCtx(ctx);\n    if (req && !session) {\n      throw ctx.error(\"UNAUTHORIZED\");\n    }\n    let resolvedUserId = session?.user?.id || userId;\n    if (!resolvedUserId) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: `Either userId or session is required`\n      });\n    }\n    if (!ctx.context.socialProviders.find((p) => p.id === providerId)) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: `Provider ${providerId} is not supported.`\n      });\n    }\n    const accounts = await ctx.context.internalAdapter.findAccounts(resolvedUserId);\n    const account = accounts.find(\n      (acc) => accountId ? acc.id === accountId && acc.providerId === providerId : acc.providerId === providerId\n    );\n    if (!account) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Account not found\"\n      });\n    }\n    const provider = ctx.context.socialProviders.find(\n      (p) => p.id === providerId\n    );\n    if (!provider) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: `Provider ${providerId} not found.`\n      });\n    }\n    try {\n      let newTokens = null;\n      const accessTokenExpired = account.accessTokenExpiresAt && new Date(account.accessTokenExpiresAt).getTime() - Date.now() < 5e3;\n      if (account.refreshToken && accessTokenExpired && provider.refreshAccessToken) {\n        newTokens = await provider.refreshAccessToken(\n          account.refreshToken\n        );\n        await ctx.context.internalAdapter.updateAccount(account.id, {\n          accessToken: await setTokenUtil(newTokens.accessToken, ctx.context),\n          accessTokenExpiresAt: newTokens.accessTokenExpiresAt,\n          refreshToken: await setTokenUtil(newTokens.refreshToken, ctx.context),\n          refreshTokenExpiresAt: newTokens.refreshTokenExpiresAt\n        });\n      }\n      const tokens = {\n        accessToken: await decryptOAuthToken(\n          newTokens?.accessToken ?? account.accessToken ?? \"\",\n          ctx.context\n        ),\n        accessTokenExpiresAt: newTokens?.accessTokenExpiresAt ?? account.accessTokenExpiresAt ?? void 0,\n        scopes: account.scope?.split(\",\") ?? [],\n        idToken: newTokens?.idToken ?? account.idToken ?? void 0\n      };\n      return ctx.json(tokens);\n    } catch (error) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Failed to get a valid access token\",\n        cause: error\n      });\n    }\n  }\n);\nconst refreshToken = createAuthEndpoint(\n  \"/refresh-token\",\n  {\n    method: \"POST\",\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      providerId: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The provider ID for the OAuth provider\"\n      }),\n      accountId: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The account ID associated with the refresh token\"\n      }).optional(),\n      userId: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The user ID associated with the account\"\n      }).optional()\n    }),\n    metadata: {\n      openapi: {\n        description: \"Refresh the access token using a refresh token\",\n        responses: {\n          200: {\n            description: \"Access token refreshed successfully\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    tokenType: {\n                      type: \"string\"\n                    },\n                    idToken: {\n                      type: \"string\"\n                    },\n                    accessToken: {\n                      type: \"string\"\n                    },\n                    refreshToken: {\n                      type: \"string\"\n                    },\n                    accessTokenExpiresAt: {\n                      type: \"string\",\n                      format: \"date-time\"\n                    },\n                    refreshTokenExpiresAt: {\n                      type: \"string\",\n                      format: \"date-time\"\n                    }\n                  }\n                }\n              }\n            }\n          },\n          400: {\n            description: \"Invalid refresh token or provider configuration\"\n          }\n        }\n      }\n    }\n  },\n  async (ctx) => {\n    const { providerId, accountId, userId } = ctx.body;\n    const req = ctx.request;\n    const session = await getSessionFromCtx(ctx);\n    if (req && !session) {\n      throw ctx.error(\"UNAUTHORIZED\");\n    }\n    let resolvedUserId = session?.user?.id || userId;\n    if (!resolvedUserId) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: `Either userId or session is required`\n      });\n    }\n    const accounts = await ctx.context.internalAdapter.findAccounts(resolvedUserId);\n    const account = accounts.find(\n      (acc) => accountId ? acc.id === accountId && acc.providerId === providerId : acc.providerId === providerId\n    );\n    if (!account) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Account not found\"\n      });\n    }\n    const provider = ctx.context.socialProviders.find(\n      (p) => p.id === providerId\n    );\n    if (!provider) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: `Provider ${providerId} not found.`\n      });\n    }\n    if (!provider.refreshAccessToken) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: `Provider ${providerId} does not support token refreshing.`\n      });\n    }\n    try {\n      const tokens = await provider.refreshAccessToken(\n        account.refreshToken\n      );\n      await ctx.context.internalAdapter.updateAccount(account.id, {\n        accessToken: await setTokenUtil(tokens.accessToken, ctx.context),\n        refreshToken: await setTokenUtil(tokens.refreshToken, ctx.context),\n        accessTokenExpiresAt: tokens.accessTokenExpiresAt,\n        refreshTokenExpiresAt: tokens.refreshTokenExpiresAt\n      });\n      return ctx.json(tokens);\n    } catch (error) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Failed to refresh access token\",\n        cause: error\n      });\n    }\n  }\n);\nconst accountInfo = createAuthEndpoint(\n  \"/account-info\",\n  {\n    method: \"POST\",\n    use: [sessionMiddleware],\n    metadata: {\n      openapi: {\n        description: \"Get the account info provided by the provider\",\n        responses: {\n          \"200\": {\n            description: \"Success\",\n            content: {\n              \"application/json\": {\n                schema: {\n                  type: \"object\",\n                  properties: {\n                    user: {\n                      type: \"object\",\n                      properties: {\n                        id: {\n                          type: \"string\"\n                        },\n                        name: {\n                          type: \"string\"\n                        },\n                        email: {\n                          type: \"string\"\n                        },\n                        image: {\n                          type: \"string\"\n                        },\n                        emailVerified: {\n                          type: \"boolean\"\n                        }\n                      },\n                      required: [\"id\", \"emailVerified\"]\n                    },\n                    data: {\n                      type: \"object\",\n                      properties: {},\n                      additionalProperties: true\n                    }\n                  },\n                  required: [\"user\", \"data\"],\n                  additionalProperties: false\n                }\n              }\n            }\n          }\n        }\n      }\n    },\n    body: zod_v4__WEBPACK_IMPORTED_MODULE_20__.object({\n      accountId: zod_v4__WEBPACK_IMPORTED_MODULE_20__.string().meta({\n        description: \"The provider given account id for which to get the account info\"\n      })\n    })\n  },\n  async (ctx) => {\n    const account = await ctx.context.internalAdapter.findAccount(\n      ctx.body.accountId\n    );\n    if (!account || account.userId !== ctx.context.session.user.id) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Account not found\"\n      });\n    }\n    const provider = ctx.context.socialProviders.find(\n      (p) => p.id === account.providerId\n    );\n    if (!provider) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"INTERNAL_SERVER_ERROR\", {\n        message: `Provider account provider is ${account.providerId} but it is not configured`\n      });\n    }\n    const tokens = await getAccessToken({\n      ...ctx,\n      body: {\n        accountId: account.id,\n        providerId: account.providerId\n      },\n      returnHeaders: false\n    });\n    if (!tokens.accessToken) {\n      throw new better_call__WEBPACK_IMPORTED_MODULE_0__.APIError(\"BAD_REQUEST\", {\n        message: \"Access token not found\"\n      });\n    }\n    const info = await provider.getUserInfo({\n      ...tokens,\n      accessToken: tokens.accessToken\n    });\n    return ctx.json(info);\n  }\n);\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLnozZHN4THhFLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBNEI7QUFDNkM7QUFDZjtBQUNMO0FBQ1M7QUFDb0I7QUFDaEM7QUFDZ0Q7QUFDbkU7QUFDRDtBQUNJO0FBQ0o7QUFDRjtBQUNJO0FBQ0g7QUFDMEM7QUFDcUI7QUFDQztBQUM3QjtBQUNYO0FBQ0Y7QUFDVjtBQUNOO0FBQ3VDO0FBQ1Q7QUFDRDtBQUNsRDtBQUNvRDs7QUFFbEUsMEJBQTBCLDZEQUFnQjtBQUMxQztBQUNBLENBQUM7QUFDRCw2QkFBNkIseURBQWdCO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLDZEQUFnQjtBQUNwQjtBQUNBLEtBQUs7QUFDTDtBQUNBLENBQUM7QUFDRCwyQkFBMkIsdURBQWM7QUFDekM7QUFDQSxDQUFDOztBQUVEO0FBQ0EsaUxBQWlMLGdCQUFnQjtBQUNqTSxnQkFBZ0IsS0FBSztBQUNyQixJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixnQkFBZ0I7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0RBQWdELHdCQUF3QjtBQUN4RSxpQkFBaUIseUJBQXlCO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLGlCQUFpQjtBQUNoRCx3QkFBd0IsaUJBQWlCO0FBQ3pDLE1BQU07QUFDTixzQkFBc0IsaUJBQWlCO0FBQ3ZDO0FBQ0E7QUFDQSx5Q0FBeUMsaUJBQWlCO0FBQzFELHlDQUF5QyxpQkFBaUI7QUFDMUQ7QUFD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Q3pCO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0Esb0NBQW9DO0FBQ3BDO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxVQUFVLDJDQUFRO0FBQ2xCLGlCQUFpQiwyQ0FBUTtBQUN6QjtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0wsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQVE7QUFDeEI7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixpREFBUTtBQUN4QixpREFBaUQsb0JBQW9CO0FBQ3JFLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxLQUFLO0FBQ0w7QUFDQSxnQkFBZ0IsaURBQVE7QUFDeEI7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUUycUQiLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWxhbi9EZXNrdG9wL0FwcHMvYmV0dGVyLWF1dGgvbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLnozZHN4THhFLm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyB6IGZyb20gJ3pvZC92NCc7XG5pbXBvcnQgeyBjcmVhdGVNaWRkbGV3YXJlLCBjcmVhdGVFbmRwb2ludCwgQVBJRXJyb3IgfSBmcm9tICdiZXR0ZXItY2FsbCc7XG5pbXBvcnQgeyBnIGFzIGdldERhdGUgfSBmcm9tICcuL2JldHRlci1hdXRoLkNXNkQ5ZVN4Lm1qcyc7XG5pbXBvcnQgeyBjcmVhdGVIYXNoIH0gZnJvbSAnQGJldHRlci1hdXRoL3V0aWxzL2hhc2gnO1xuaW1wb3J0IHsgYmFzZTY0LCBiYXNlNjRVcmwgfSBmcm9tICdAYmV0dGVyLWF1dGgvdXRpbHMvYmFzZTY0JztcbmltcG9ydCB7IHNpZ25KV1QsIHN5bW1ldHJpY0VuY3J5cHQsIHN5bW1ldHJpY0RlY3J5cHQgfSBmcm9tICcuLi9jcnlwdG8vaW5kZXgubWpzJztcbmltcG9ydCB7IGJldHRlckZldGNoIH0gZnJvbSAnQGJldHRlci1mZXRjaC9mZXRjaCc7XG5pbXBvcnQgeyBqd3RWZXJpZnksIGRlY29kZUp3dCwgZGVjb2RlUHJvdGVjdGVkSGVhZGVyLCBpbXBvcnRKV0ssIGNyZWF0ZVJlbW90ZUpXS1NldCB9IGZyb20gJ2pvc2UnO1xuaW1wb3J0ICdAbm9ibGUvY2lwaGVycy9jaGFjaGEnO1xuaW1wb3J0ICdAbm9ibGUvY2lwaGVycy91dGlscyc7XG5pbXBvcnQgJ0Bub2JsZS9jaXBoZXJzL3dlYmNyeXB0byc7XG5pbXBvcnQgJ0Bub2JsZS9oYXNoZXMvc2NyeXB0JztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzJztcbmltcG9ydCAnQGJldHRlci1hdXRoL3V0aWxzL2hleCc7XG5pbXBvcnQgJ0Bub2JsZS9oYXNoZXMvdXRpbHMnO1xuaW1wb3J0IHsgZyBhcyBnZW5lcmF0ZVJhbmRvbVN0cmluZyB9IGZyb20gJy4vYmV0dGVyLWF1dGguQjRRb3hkZ2MubWpzJztcbmltcG9ydCB7IGcgYXMgZ2V0T3JpZ2luLCBiIGFzIGdldEhvc3QsIGMgYXMgZ2V0UHJvdG9jb2wgfSBmcm9tICcuL2JldHRlci1hdXRoLlZUWE5MRk1ULm1qcyc7XG5pbXBvcnQgeyBkZWxldGVTZXNzaW9uQ29va2llLCBzZXRTZXNzaW9uQ29va2llLCBzZXRDb29raWVDYWNoZSB9IGZyb20gJy4uL2Nvb2tpZXMvaW5kZXgubWpzJztcbmltcG9ydCB7IHMgYXMgc2FmZUpTT05QYXJzZSB9IGZyb20gJy4vYmV0dGVyLWF1dGgudEI1ZVU2RVkubWpzJztcbmltcG9ydCB7IGNyZWF0ZUhNQUMgfSBmcm9tICdAYmV0dGVyLWF1dGgvdXRpbHMvaG1hYyc7XG5pbXBvcnQgeyBiaW5hcnkgfSBmcm9tICdAYmV0dGVyLWF1dGgvdXRpbHMvYmluYXJ5JztcbmltcG9ydCB7IEpXVEV4cGlyZWQgfSBmcm9tICdqb3NlL2Vycm9ycyc7XG5pbXBvcnQgJ0BiZXR0ZXItYXV0aC91dGlscy9yYW5kb20nO1xuaW1wb3J0IHsgYSBhcyBsb2dnZXIsIGcgYXMgZ2VuZXJhdGVJZCB9IGZyb20gJy4vYmV0dGVyLWF1dGguREJHZklEbmgubWpzJztcbmltcG9ydCB7IGYgYXMgcGFyc2VVc2VySW5wdXQgfSBmcm9tICcuL2JldHRlci1hdXRoLm4yS0ZHd2pZLm1qcyc7XG5pbXBvcnQgeyBiIGFzIGlzRGV2ZWxvcG1lbnQgfSBmcm9tICcuL2JldHRlci1hdXRoLjh6b3h6Zy1GLm1qcyc7XG5pbXBvcnQgJ2RlZnUnO1xuaW1wb3J0IHsgQiBhcyBCZXR0ZXJBdXRoRXJyb3IgfSBmcm9tICcuL2JldHRlci1hdXRoLkRkelNKZi1uLm1qcyc7XG5cbmNvbnN0IG9wdGlvbnNNaWRkbGV3YXJlID0gY3JlYXRlTWlkZGxld2FyZShhc3luYyAoKSA9PiB7XG4gIHJldHVybiB7fTtcbn0pO1xuY29uc3QgY3JlYXRlQXV0aE1pZGRsZXdhcmUgPSBjcmVhdGVNaWRkbGV3YXJlLmNyZWF0ZSh7XG4gIHVzZTogW1xuICAgIG9wdGlvbnNNaWRkbGV3YXJlLFxuICAgIC8qKlxuICAgICAqIE9ubHkgdXNlIGZvciBwb3N0IGhvb2tzXG4gICAgICovXG4gICAgY3JlYXRlTWlkZGxld2FyZShhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4ge307XG4gICAgfSlcbiAgXVxufSk7XG5jb25zdCBjcmVhdGVBdXRoRW5kcG9pbnQgPSBjcmVhdGVFbmRwb2ludC5jcmVhdGUoe1xuICB1c2U6IFtvcHRpb25zTWlkZGxld2FyZV1cbn0pO1xuXG5mdW5jdGlvbiBlc2NhcGVSZWdFeHBDaGFyKGNoYXIpIHtcbiAgaWYgKGNoYXIgPT09IFwiLVwiIHx8IGNoYXIgPT09IFwiXlwiIHx8IGNoYXIgPT09IFwiJFwiIHx8IGNoYXIgPT09IFwiK1wiIHx8IGNoYXIgPT09IFwiLlwiIHx8IGNoYXIgPT09IFwiKFwiIHx8IGNoYXIgPT09IFwiKVwiIHx8IGNoYXIgPT09IFwifFwiIHx8IGNoYXIgPT09IFwiW1wiIHx8IGNoYXIgPT09IFwiXVwiIHx8IGNoYXIgPT09IFwie1wiIHx8IGNoYXIgPT09IFwifVwiIHx8IGNoYXIgPT09IFwiKlwiIHx8IGNoYXIgPT09IFwiP1wiIHx8IGNoYXIgPT09IFwiXFxcXFwiKSB7XG4gICAgcmV0dXJuIGBcXFxcJHtjaGFyfWA7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGNoYXI7XG4gIH1cbn1cbmZ1bmN0aW9uIGVzY2FwZVJlZ0V4cFN0cmluZyhzdHIpIHtcbiAgbGV0IHJlc3VsdCA9IFwiXCI7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgcmVzdWx0ICs9IGVzY2FwZVJlZ0V4cENoYXIoc3RyW2ldKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuZnVuY3Rpb24gdHJhbnNmb3JtKHBhdHRlcm4sIHNlcGFyYXRvciA9IHRydWUpIHtcbiAgaWYgKEFycmF5LmlzQXJyYXkocGF0dGVybikpIHtcbiAgICBsZXQgcmVnRXhwUGF0dGVybnMgPSBwYXR0ZXJuLm1hcCgocCkgPT4gYF4ke3RyYW5zZm9ybShwLCBzZXBhcmF0b3IpfSRgKTtcbiAgICByZXR1cm4gYCg/OiR7cmVnRXhwUGF0dGVybnMuam9pbihcInxcIil9KWA7XG4gIH1cbiAgbGV0IHNlcGFyYXRvclNwbGl0dGVyID0gXCJcIjtcbiAgbGV0IHNlcGFyYXRvck1hdGNoZXIgPSBcIlwiO1xuICBsZXQgd2lsZGNhcmQgPSBcIi5cIjtcbiAgaWYgKHNlcGFyYXRvciA9PT0gdHJ1ZSkge1xuICAgIHNlcGFyYXRvclNwbGl0dGVyID0gXCIvXCI7XG4gICAgc2VwYXJhdG9yTWF0Y2hlciA9IFwiWy9cXFxcXFxcXF1cIjtcbiAgICB3aWxkY2FyZCA9IFwiW14vXFxcXFxcXFxdXCI7XG4gIH0gZWxzZSBpZiAoc2VwYXJhdG9yKSB7XG4gICAgc2VwYXJhdG9yU3BsaXR0ZXIgPSBzZXBhcmF0b3I7XG4gICAgc2VwYXJhdG9yTWF0Y2hlciA9IGVzY2FwZVJlZ0V4cFN0cmluZyhzZXBhcmF0b3JTcGxpdHRlcik7XG4gICAgaWYgKHNlcGFyYXRvck1hdGNoZXIubGVuZ3RoID4gMSkge1xuICAgICAgc2VwYXJhdG9yTWF0Y2hlciA9IGAoPzoke3NlcGFyYXRvck1hdGNoZXJ9KWA7XG4gICAgICB3aWxkY2FyZCA9IGAoKD8hJHtzZXBhcmF0b3JNYXRjaGVyfSkuKWA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHdpbGRjYXJkID0gYFteJHtzZXBhcmF0b3JNYXRjaGVyfV1gO1xuICAgIH1cbiAgfVxuICBsZXQgcmVxdWlyZWRTZXBhcmF0b3IgPSBzZXBhcmF0b3IgPyBgJHtzZXBhcmF0b3JNYXRjaGVyfSs/YCA6IFwiXCI7XG4gIGxldCBvcHRpb25hbFNlcGFyYXRvciA9IHNlcGFyYXRvciA/IGAke3NlcGFyYXRvck1hdGNoZXJ9Kj9gIDogXCJcIjtcbiAgbGV0IHNlZ21lbnRzID0gc2VwYXJhdG9yID8gcGF0dGVybi5zcGxpdChzZXBhcmF0b3JTcGxpdHRlcikgOiBbcGF0dGVybl07XG4gIGxldCByZXN1bHQgPSBcIlwiO1xuICBmb3IgKGxldCBzID0gMDsgcyA8IHNlZ21lbnRzLmxlbmd0aDsgcysrKSB7XG4gICAgbGV0IHNlZ21lbnQgPSBzZWdtZW50c1tzXTtcbiAgICBsZXQgbmV4dFNlZ21lbnQgPSBzZWdtZW50c1tzICsgMV07XG4gICAgbGV0IGN1cnJlbnRTZXBhcmF0b3IgPSBcIlwiO1xuICAgIGlmICghc2VnbWVudCAmJiBzID4gMCkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGlmIChzZXBhcmF0b3IpIHtcbiAgICAgIGlmIChzID09PSBzZWdtZW50cy5sZW5ndGggLSAxKSB7XG4gICAgICAgIGN1cnJlbnRTZXBhcmF0b3IgPSBvcHRpb25hbFNlcGFyYXRvcjtcbiAgICAgIH0gZWxzZSBpZiAobmV4dFNlZ21lbnQgIT09IFwiKipcIikge1xuICAgICAgICBjdXJyZW50U2VwYXJhdG9yID0gcmVxdWlyZWRTZXBhcmF0b3I7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjdXJyZW50U2VwYXJhdG9yID0gXCJcIjtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHNlcGFyYXRvciAmJiBzZWdtZW50ID09PSBcIioqXCIpIHtcbiAgICAgIGlmIChjdXJyZW50U2VwYXJhdG9yKSB7XG4gICAgICAgIHJlc3VsdCArPSBzID09PSAwID8gXCJcIiA6IGN1cnJlbnRTZXBhcmF0b3I7XG4gICAgICAgIHJlc3VsdCArPSBgKD86JHt3aWxkY2FyZH0qPyR7Y3VycmVudFNlcGFyYXRvcn0pKj9gO1xuICAgICAgfVxuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGZvciAobGV0IGMgPSAwOyBjIDwgc2VnbWVudC5sZW5ndGg7IGMrKykge1xuICAgICAgbGV0IGNoYXIgPSBzZWdtZW50W2NdO1xuICAgICAgaWYgKGNoYXIgPT09IFwiXFxcXFwiKSB7XG4gICAgICAgIGlmIChjIDwgc2VnbWVudC5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgcmVzdWx0ICs9IGVzY2FwZVJlZ0V4cENoYXIoc2VnbWVudFtjICsgMV0pO1xuICAgICAgICAgIGMrKztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChjaGFyID09PSBcIj9cIikge1xuICAgICAgICByZXN1bHQgKz0gd2lsZGNhcmQ7XG4gICAgICB9IGVsc2UgaWYgKGNoYXIgPT09IFwiKlwiKSB7XG4gICAgICAgIHJlc3VsdCArPSBgJHt3aWxkY2FyZH0qP2A7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXN1bHQgKz0gZXNjYXBlUmVnRXhwQ2hhcihjaGFyKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmVzdWx0ICs9IGN1cnJlbnRTZXBhcmF0b3I7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cbmZ1bmN0aW9uIGlzTWF0Y2gocmVnZXhwLCBzYW1wbGUpIHtcbiAgaWYgKHR5cGVvZiBzYW1wbGUgIT09IFwic3RyaW5nXCIpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGBTYW1wbGUgbXVzdCBiZSBhIHN0cmluZywgYnV0ICR7dHlwZW9mIHNhbXBsZX0gZ2l2ZW5gKTtcbiAgfVxuICByZXR1cm4gcmVnZXhwLnRlc3Qoc2FtcGxlKTtcbn1cbmZ1bmN0aW9uIHdpbGRjYXJkTWF0Y2gocGF0dGVybiwgb3B0aW9ucykge1xuICBpZiAodHlwZW9mIHBhdHRlcm4gIT09IFwic3RyaW5nXCIgJiYgIUFycmF5LmlzQXJyYXkocGF0dGVybikpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFxuICAgICAgYFRoZSBmaXJzdCBhcmd1bWVudCBtdXN0IGJlIGEgc2luZ2xlIHBhdHRlcm4gc3RyaW5nIG9yIGFuIGFycmF5IG9mIHBhdHRlcm5zLCBidXQgJHt0eXBlb2YgcGF0dGVybn0gZ2l2ZW5gXG4gICAgKTtcbiAgfVxuICBpZiAodHlwZW9mIG9wdGlvbnMgPT09IFwic3RyaW5nXCIgfHwgdHlwZW9mIG9wdGlvbnMgPT09IFwiYm9vbGVhblwiKSB7XG4gICAgb3B0aW9ucyA9IHsgc2VwYXJhdG9yOiBvcHRpb25zIH07XG4gIH1cbiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIgJiYgISh0eXBlb2Ygb3B0aW9ucyA9PT0gXCJ1bmRlZmluZWRcIiB8fCB0eXBlb2Ygb3B0aW9ucyA9PT0gXCJvYmplY3RcIiAmJiBvcHRpb25zICE9PSBudWxsICYmICFBcnJheS5pc0FycmF5KG9wdGlvbnMpKSkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXG4gICAgICBgVGhlIHNlY29uZCBhcmd1bWVudCBtdXN0IGJlIGFuIG9wdGlvbnMgb2JqZWN0IG9yIGEgc3RyaW5nL2Jvb2xlYW4gc2VwYXJhdG9yLCBidXQgJHt0eXBlb2Ygb3B0aW9uc30gZ2l2ZW5gXG4gICAgKTtcbiAgfVxuICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgaWYgKG9wdGlvbnMuc2VwYXJhdG9yID09PSBcIlxcXFxcIikge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIFwiXFxcXCBpcyBub3QgYSB2YWxpZCBzZXBhcmF0b3IgYmVjYXVzZSBpdCBpcyB1c2VkIGZvciBlc2NhcGluZy4gVHJ5IHNldHRpbmcgdGhlIHNlcGFyYXRvciB0byBgdHJ1ZWAgaW5zdGVhZFwiXG4gICAgKTtcbiAgfVxuICBsZXQgcmVnZXhwUGF0dGVybiA9IHRyYW5zZm9ybShwYXR0ZXJuLCBvcHRpb25zLnNlcGFyYXRvcik7XG4gIGxldCByZWdleHAgPSBuZXcgUmVnRXhwKGBeJHtyZWdleHBQYXR0ZXJufSRgLCBvcHRpb25zLmZsYWdzKTtcbiAgbGV0IGZuID0gaXNNYXRjaC5iaW5kKG51bGwsIHJlZ2V4cCk7XG4gIGZuLm9wdGlvbnMgPSBvcHRpb25zO1xuICBmbi5wYXR0ZXJuID0gcGF0dGVybjtcbiAgZm4ucmVnZXhwID0gcmVnZXhwO1xuICByZXR1cm4gZm47XG59XG5cbmNvbnN0IG9yaWdpbkNoZWNrTWlkZGxld2FyZSA9IGNyZWF0ZUF1dGhNaWRkbGV3YXJlKGFzeW5jIChjdHgpID0+IHtcbiAgaWYgKGN0eC5yZXF1ZXN0Py5tZXRob2QgIT09IFwiUE9TVFwiIHx8ICFjdHgucmVxdWVzdCkge1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCB7IGJvZHksIHF1ZXJ5LCBjb250ZXh0IH0gPSBjdHg7XG4gIGNvbnN0IG9yaWdpbkhlYWRlciA9IGN0eC5oZWFkZXJzPy5nZXQoXCJvcmlnaW5cIikgfHwgY3R4LmhlYWRlcnM/LmdldChcInJlZmVyZXJcIikgfHwgXCJcIjtcbiAgY29uc3QgY2FsbGJhY2tVUkwgPSBib2R5Py5jYWxsYmFja1VSTCB8fCBxdWVyeT8uY2FsbGJhY2tVUkw7XG4gIGNvbnN0IHJlZGlyZWN0VVJMID0gYm9keT8ucmVkaXJlY3RUbztcbiAgY29uc3QgZXJyb3JDYWxsYmFja1VSTCA9IGJvZHk/LmVycm9yQ2FsbGJhY2tVUkw7XG4gIGNvbnN0IG5ld1VzZXJDYWxsYmFja1VSTCA9IGJvZHk/Lm5ld1VzZXJDYWxsYmFja1VSTDtcbiAgY29uc3QgdHJ1c3RlZE9yaWdpbnMgPSBBcnJheS5pc0FycmF5KGNvbnRleHQub3B0aW9ucy50cnVzdGVkT3JpZ2lucykgPyBjb250ZXh0LnRydXN0ZWRPcmlnaW5zIDogW1xuICAgIC4uLmNvbnRleHQudHJ1c3RlZE9yaWdpbnMsXG4gICAgLi4uYXdhaXQgY29udGV4dC5vcHRpb25zLnRydXN0ZWRPcmlnaW5zPy4oY3R4LnJlcXVlc3QpIHx8IFtdXG4gIF07XG4gIGNvbnN0IHVzZXNDb29raWVzID0gY3R4LmhlYWRlcnM/LmhhcyhcImNvb2tpZVwiKTtcbiAgY29uc3QgbWF0Y2hlc1BhdHRlcm4gPSAodXJsLCBwYXR0ZXJuKSA9PiB7XG4gICAgaWYgKHVybC5zdGFydHNXaXRoKFwiL1wiKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAocGF0dGVybi5pbmNsdWRlcyhcIipcIikpIHtcbiAgICAgIGlmIChwYXR0ZXJuLmluY2x1ZGVzKFwiOi8vXCIpKSB7XG4gICAgICAgIHJldHVybiB3aWxkY2FyZE1hdGNoKHBhdHRlcm4pKGdldE9yaWdpbih1cmwpIHx8IHVybCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gd2lsZGNhcmRNYXRjaChwYXR0ZXJuKShnZXRIb3N0KHVybCkpO1xuICAgIH1cbiAgICBjb25zdCBwcm90b2NvbCA9IGdldFByb3RvY29sKHVybCk7XG4gICAgcmV0dXJuIHByb3RvY29sID09PSBcImh0dHA6XCIgfHwgcHJvdG9jb2wgPT09IFwiaHR0cHM6XCIgfHwgIXByb3RvY29sID8gcGF0dGVybiA9PT0gZ2V0T3JpZ2luKHVybCkgOiB1cmwuc3RhcnRzV2l0aChwYXR0ZXJuKTtcbiAgfTtcbiAgY29uc3QgdmFsaWRhdGVVUkwgPSAodXJsLCBsYWJlbCkgPT4ge1xuICAgIGlmICghdXJsKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGlzVHJ1c3RlZE9yaWdpbiA9IHRydXN0ZWRPcmlnaW5zLnNvbWUoXG4gICAgICAob3JpZ2luKSA9PiBtYXRjaGVzUGF0dGVybih1cmwsIG9yaWdpbikgfHwgdXJsPy5zdGFydHNXaXRoKFwiL1wiKSAmJiBsYWJlbCAhPT0gXCJvcmlnaW5cIiAmJiAvXlxcLyg/IVxcL3xcXFxcfCUyZnwlNWMpW1xcd1xcLS5cXCsvQF0qKD86XFw/W1xcd1xcLS5cXCsvPSYlQF0qKT8kLy50ZXN0KHVybClcbiAgICApO1xuICAgIGlmICghaXNUcnVzdGVkT3JpZ2luKSB7XG4gICAgICBjdHguY29udGV4dC5sb2dnZXIuZXJyb3IoYEludmFsaWQgJHtsYWJlbH06ICR7dXJsfWApO1xuICAgICAgY3R4LmNvbnRleHQubG9nZ2VyLmluZm8oXG4gICAgICAgIGBJZiBpdCdzIGEgdmFsaWQgVVJMLCBwbGVhc2UgYWRkICR7dXJsfSB0byB0cnVzdGVkT3JpZ2lucyBpbiB5b3VyIGF1dGggY29uZmlnXG5gLFxuICAgICAgICBgQ3VycmVudCBsaXN0IG9mIHRydXN0ZWRPcmlnaW5zOiAke3RydXN0ZWRPcmlnaW5zfWBcbiAgICAgICk7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJGT1JCSURERU5cIiwgeyBtZXNzYWdlOiBgSW52YWxpZCAke2xhYmVsfWAgfSk7XG4gICAgfVxuICB9O1xuICBpZiAodXNlc0Nvb2tpZXMgJiYgIWN0eC5jb250ZXh0Lm9wdGlvbnMuYWR2YW5jZWQ/LmRpc2FibGVDU1JGQ2hlY2spIHtcbiAgICB2YWxpZGF0ZVVSTChvcmlnaW5IZWFkZXIsIFwib3JpZ2luXCIpO1xuICB9XG4gIGNhbGxiYWNrVVJMICYmIHZhbGlkYXRlVVJMKGNhbGxiYWNrVVJMLCBcImNhbGxiYWNrVVJMXCIpO1xuICByZWRpcmVjdFVSTCAmJiB2YWxpZGF0ZVVSTChyZWRpcmVjdFVSTCwgXCJyZWRpcmVjdFVSTFwiKTtcbiAgZXJyb3JDYWxsYmFja1VSTCAmJiB2YWxpZGF0ZVVSTChlcnJvckNhbGxiYWNrVVJMLCBcImVycm9yQ2FsbGJhY2tVUkxcIik7XG4gIG5ld1VzZXJDYWxsYmFja1VSTCAmJiB2YWxpZGF0ZVVSTChuZXdVc2VyQ2FsbGJhY2tVUkwsIFwibmV3VXNlckNhbGxiYWNrVVJMXCIpO1xufSk7XG5jb25zdCBvcmlnaW5DaGVjayA9IChnZXRWYWx1ZSkgPT4gY3JlYXRlQXV0aE1pZGRsZXdhcmUoYXN5bmMgKGN0eCkgPT4ge1xuICBpZiAoIWN0eC5yZXF1ZXN0KSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHsgY29udGV4dCB9ID0gY3R4O1xuICBjb25zdCBjYWxsYmFja1VSTCA9IGdldFZhbHVlKGN0eCk7XG4gIGNvbnN0IHRydXN0ZWRPcmlnaW5zID0gQXJyYXkuaXNBcnJheShcbiAgICBjb250ZXh0Lm9wdGlvbnMudHJ1c3RlZE9yaWdpbnNcbiAgKSA/IGNvbnRleHQudHJ1c3RlZE9yaWdpbnMgOiBbXG4gICAgLi4uY29udGV4dC50cnVzdGVkT3JpZ2lucyxcbiAgICAuLi5hd2FpdCBjb250ZXh0Lm9wdGlvbnMudHJ1c3RlZE9yaWdpbnM/LihjdHgucmVxdWVzdCkgfHwgW11cbiAgXTtcbiAgY29uc3QgbWF0Y2hlc1BhdHRlcm4gPSAodXJsLCBwYXR0ZXJuKSA9PiB7XG4gICAgaWYgKHVybC5zdGFydHNXaXRoKFwiL1wiKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAocGF0dGVybi5pbmNsdWRlcyhcIipcIikpIHtcbiAgICAgIGlmIChwYXR0ZXJuLmluY2x1ZGVzKFwiOi8vXCIpKSB7XG4gICAgICAgIHJldHVybiB3aWxkY2FyZE1hdGNoKHBhdHRlcm4pKGdldE9yaWdpbih1cmwpIHx8IHVybCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gd2lsZGNhcmRNYXRjaChwYXR0ZXJuKShnZXRIb3N0KHVybCkpO1xuICAgIH1cbiAgICBjb25zdCBwcm90b2NvbCA9IGdldFByb3RvY29sKHVybCk7XG4gICAgcmV0dXJuIHByb3RvY29sID09PSBcImh0dHA6XCIgfHwgcHJvdG9jb2wgPT09IFwiaHR0cHM6XCIgfHwgIXByb3RvY29sID8gcGF0dGVybiA9PT0gZ2V0T3JpZ2luKHVybCkgOiB1cmwuc3RhcnRzV2l0aChwYXR0ZXJuKTtcbiAgfTtcbiAgY29uc3QgdmFsaWRhdGVVUkwgPSAodXJsLCBsYWJlbCkgPT4ge1xuICAgIGlmICghdXJsKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGlzVHJ1c3RlZE9yaWdpbiA9IHRydXN0ZWRPcmlnaW5zLnNvbWUoXG4gICAgICAob3JpZ2luKSA9PiBtYXRjaGVzUGF0dGVybih1cmwsIG9yaWdpbikgfHwgdXJsPy5zdGFydHNXaXRoKFwiL1wiKSAmJiBsYWJlbCAhPT0gXCJvcmlnaW5cIiAmJiAvXlxcLyg/IVxcL3xcXFxcfCUyZnwlNWMpW1xcd1xcLS5cXCsvQF0qKD86XFw/W1xcd1xcLS5cXCsvPSYlQF0qKT8kLy50ZXN0KFxuICAgICAgICB1cmxcbiAgICAgIClcbiAgICApO1xuICAgIGlmICghaXNUcnVzdGVkT3JpZ2luKSB7XG4gICAgICBjdHguY29udGV4dC5sb2dnZXIuZXJyb3IoYEludmFsaWQgJHtsYWJlbH06ICR7dXJsfWApO1xuICAgICAgY3R4LmNvbnRleHQubG9nZ2VyLmluZm8oXG4gICAgICAgIGBJZiBpdCdzIGEgdmFsaWQgVVJMLCBwbGVhc2UgYWRkICR7dXJsfSB0byB0cnVzdGVkT3JpZ2lucyBpbiB5b3VyIGF1dGggY29uZmlnXG5gLFxuICAgICAgICBgQ3VycmVudCBsaXN0IG9mIHRydXN0ZWRPcmlnaW5zOiAke3RydXN0ZWRPcmlnaW5zfWBcbiAgICAgICk7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJGT1JCSURERU5cIiwgeyBtZXNzYWdlOiBgSW52YWxpZCAke2xhYmVsfWAgfSk7XG4gICAgfVxuICB9O1xuICBjb25zdCBjYWxsYmFja3MgPSBBcnJheS5pc0FycmF5KGNhbGxiYWNrVVJMKSA/IGNhbGxiYWNrVVJMIDogW2NhbGxiYWNrVVJMXTtcbiAgZm9yIChjb25zdCB1cmwgb2YgY2FsbGJhY2tzKSB7XG4gICAgdmFsaWRhdGVVUkwodXJsLCBcImNhbGxiYWNrVVJMXCIpO1xuICB9XG59KTtcblxuY29uc3QgQkFTRV9FUlJPUl9DT0RFUyA9IHtcbiAgVVNFUl9OT1RfRk9VTkQ6IFwiVXNlciBub3QgZm91bmRcIixcbiAgRkFJTEVEX1RPX0NSRUFURV9VU0VSOiBcIkZhaWxlZCB0byBjcmVhdGUgdXNlclwiLFxuICBGQUlMRURfVE9fQ1JFQVRFX1NFU1NJT046IFwiRmFpbGVkIHRvIGNyZWF0ZSBzZXNzaW9uXCIsXG4gIEZBSUxFRF9UT19VUERBVEVfVVNFUjogXCJGYWlsZWQgdG8gdXBkYXRlIHVzZXJcIixcbiAgRkFJTEVEX1RPX0dFVF9TRVNTSU9OOiBcIkZhaWxlZCB0byBnZXQgc2Vzc2lvblwiLFxuICBJTlZBTElEX1BBU1NXT1JEOiBcIkludmFsaWQgcGFzc3dvcmRcIixcbiAgSU5WQUxJRF9FTUFJTDogXCJJbnZhbGlkIGVtYWlsXCIsXG4gIElOVkFMSURfRU1BSUxfT1JfUEFTU1dPUkQ6IFwiSW52YWxpZCBlbWFpbCBvciBwYXNzd29yZFwiLFxuICBTT0NJQUxfQUNDT1VOVF9BTFJFQURZX0xJTktFRDogXCJTb2NpYWwgYWNjb3VudCBhbHJlYWR5IGxpbmtlZFwiLFxuICBQUk9WSURFUl9OT1RfRk9VTkQ6IFwiUHJvdmlkZXIgbm90IGZvdW5kXCIsXG4gIElOVkFMSURfVE9LRU46IFwiaW52YWxpZCB0b2tlblwiLFxuICBJRF9UT0tFTl9OT1RfU1VQUE9SVEVEOiBcImlkX3Rva2VuIG5vdCBzdXBwb3J0ZWRcIixcbiAgRkFJTEVEX1RPX0dFVF9VU0VSX0lORk86IFwiRmFpbGVkIHRvIGdldCB1c2VyIGluZm9cIixcbiAgVVNFUl9FTUFJTF9OT1RfRk9VTkQ6IFwiVXNlciBlbWFpbCBub3QgZm91bmRcIixcbiAgRU1BSUxfTk9UX1ZFUklGSUVEOiBcIkVtYWlsIG5vdCB2ZXJpZmllZFwiLFxuICBQQVNTV09SRF9UT09fU0hPUlQ6IFwiUGFzc3dvcmQgdG9vIHNob3J0XCIsXG4gIFBBU1NXT1JEX1RPT19MT05HOiBcIlBhc3N3b3JkIHRvbyBsb25nXCIsXG4gIFVTRVJfQUxSRUFEWV9FWElTVFM6IFwiVXNlciBhbHJlYWR5IGV4aXN0c1wiLFxuICBFTUFJTF9DQU5fTk9UX0JFX1VQREFURUQ6IFwiRW1haWwgY2FuIG5vdCBiZSB1cGRhdGVkXCIsXG4gIENSRURFTlRJQUxfQUNDT1VOVF9OT1RfRk9VTkQ6IFwiQ3JlZGVudGlhbCBhY2NvdW50IG5vdCBmb3VuZFwiLFxuICBTRVNTSU9OX0VYUElSRUQ6IFwiU2Vzc2lvbiBleHBpcmVkLiBSZS1hdXRoZW50aWNhdGUgdG8gcGVyZm9ybSB0aGlzIGFjdGlvbi5cIixcbiAgRkFJTEVEX1RPX1VOTElOS19MQVNUX0FDQ09VTlQ6IFwiWW91IGNhbid0IHVubGluayB5b3VyIGxhc3QgYWNjb3VudFwiLFxuICBBQ0NPVU5UX05PVF9GT1VORDogXCJBY2NvdW50IG5vdCBmb3VuZFwiLFxuICBVU0VSX0FMUkVBRFlfSEFTX1BBU1NXT1JEOiBcIlVzZXIgYWxyZWFkeSBoYXMgYSBwYXNzd29yZC4gUHJvdmlkZSB0aGF0IHRvIGRlbGV0ZSB0aGUgYWNjb3VudC5cIlxufTtcblxuY29uc3QgZ2V0U2Vzc2lvbiA9ICgpID0+IGNyZWF0ZUF1dGhFbmRwb2ludChcbiAgXCIvZ2V0LXNlc3Npb25cIixcbiAge1xuICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICBxdWVyeTogei5vcHRpb25hbChcbiAgICAgIHoub2JqZWN0KHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIElmIGNvb2tpZSBjYWNoZSBpcyBlbmFibGVkLCBpdCB3aWxsIGRpc2FibGUgdGhlIGNhY2hlXG4gICAgICAgICAqIGFuZCBmZXRjaCB0aGUgc2Vzc2lvbiBmcm9tIHRoZSBkYXRhYmFzZVxuICAgICAgICAgKi9cbiAgICAgICAgZGlzYWJsZUNvb2tpZUNhY2hlOiB6LmNvZXJjZS5ib29sZWFuKCkubWV0YSh7XG4gICAgICAgICAgZGVzY3JpcHRpb246IFwiRGlzYWJsZSBjb29raWUgY2FjaGUgYW5kIGZldGNoIHNlc3Npb24gZnJvbSBkYXRhYmFzZVwiXG4gICAgICAgIH0pLm9wdGlvbmFsKCksXG4gICAgICAgIGRpc2FibGVSZWZyZXNoOiB6LmNvZXJjZS5ib29sZWFuKCkubWV0YSh7XG4gICAgICAgICAgZGVzY3JpcHRpb246IFwiRGlzYWJsZSBzZXNzaW9uIHJlZnJlc2guIFVzZWZ1bCBmb3IgY2hlY2tpbmcgc2Vzc2lvbiBzdGF0dXMsIHdpdGhvdXQgdXBkYXRpbmcgdGhlIHNlc3Npb25cIlxuICAgICAgICB9KS5vcHRpb25hbCgpXG4gICAgICB9KVxuICAgICksXG4gICAgcmVxdWlyZUhlYWRlcnM6IHRydWUsXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgIG9wZW5hcGk6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiR2V0IHRoZSBjdXJyZW50IHNlc3Npb25cIixcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgXCIyMDBcIjoge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiU3VjY2Vzc1wiLFxuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIjoge1xuICAgICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICRyZWY6IFwiIy9jb21wb25lbnRzL3NjaGVtYXMvU2Vzc2lvblwiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAkcmVmOiBcIiMvY29tcG9uZW50cy9zY2hlbWFzL1VzZXJcIlxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFtcInNlc3Npb25cIiwgXCJ1c2VyXCJdXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBhc3luYyAoY3R4KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHNlc3Npb25Db29raWVUb2tlbiA9IGF3YWl0IGN0eC5nZXRTaWduZWRDb29raWUoXG4gICAgICAgIGN0eC5jb250ZXh0LmF1dGhDb29raWVzLnNlc3Npb25Ub2tlbi5uYW1lLFxuICAgICAgICBjdHguY29udGV4dC5zZWNyZXRcbiAgICAgICk7XG4gICAgICBpZiAoIXNlc3Npb25Db29raWVUb2tlbikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHNlc3Npb25EYXRhQ29va2llID0gY3R4LmdldENvb2tpZShcbiAgICAgICAgY3R4LmNvbnRleHQuYXV0aENvb2tpZXMuc2Vzc2lvbkRhdGEubmFtZVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHNlc3Npb25EYXRhUGF5bG9hZCA9IHNlc3Npb25EYXRhQ29va2llID8gc2FmZUpTT05QYXJzZShiaW5hcnkuZGVjb2RlKGJhc2U2NC5kZWNvZGUoc2Vzc2lvbkRhdGFDb29raWUpKSkgOiBudWxsO1xuICAgICAgaWYgKHNlc3Npb25EYXRhUGF5bG9hZCkge1xuICAgICAgICBjb25zdCBpc1ZhbGlkID0gYXdhaXQgY3JlYXRlSE1BQyhcIlNIQS0yNTZcIiwgXCJiYXNlNjR1cmxub3BhZFwiKS52ZXJpZnkoXG4gICAgICAgICAgY3R4LmNvbnRleHQuc2VjcmV0LFxuICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgIC4uLnNlc3Npb25EYXRhUGF5bG9hZC5zZXNzaW9uLFxuICAgICAgICAgICAgZXhwaXJlc0F0OiBzZXNzaW9uRGF0YVBheWxvYWQuZXhwaXJlc0F0XG4gICAgICAgICAgfSksXG4gICAgICAgICAgc2Vzc2lvbkRhdGFQYXlsb2FkLnNpZ25hdHVyZVxuICAgICAgICApO1xuICAgICAgICBpZiAoIWlzVmFsaWQpIHtcbiAgICAgICAgICBjb25zdCBkYXRhQ29va2llID0gY3R4LmNvbnRleHQuYXV0aENvb2tpZXMuc2Vzc2lvbkRhdGEubmFtZTtcbiAgICAgICAgICBjdHguc2V0Q29va2llKGRhdGFDb29raWUsIFwiXCIsIHtcbiAgICAgICAgICAgIG1heEFnZTogMFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBjdHguanNvbihudWxsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY29uc3QgZG9udFJlbWVtYmVyTWUgPSBhd2FpdCBjdHguZ2V0U2lnbmVkQ29va2llKFxuICAgICAgICBjdHguY29udGV4dC5hdXRoQ29va2llcy5kb250UmVtZW1iZXJUb2tlbi5uYW1lLFxuICAgICAgICBjdHguY29udGV4dC5zZWNyZXRcbiAgICAgICk7XG4gICAgICBpZiAoc2Vzc2lvbkRhdGFQYXlsb2FkPy5zZXNzaW9uICYmIGN0eC5jb250ZXh0Lm9wdGlvbnMuc2Vzc2lvbj8uY29va2llQ2FjaGU/LmVuYWJsZWQgJiYgIWN0eC5xdWVyeT8uZGlzYWJsZUNvb2tpZUNhY2hlKSB7XG4gICAgICAgIGNvbnN0IHNlc3Npb24yID0gc2Vzc2lvbkRhdGFQYXlsb2FkLnNlc3Npb247XG4gICAgICAgIGNvbnN0IGhhc0V4cGlyZWQgPSBzZXNzaW9uRGF0YVBheWxvYWQuZXhwaXJlc0F0IDwgRGF0ZS5ub3coKSB8fCBzZXNzaW9uMi5zZXNzaW9uLmV4cGlyZXNBdCA8IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpO1xuICAgICAgICBpZiAoIWhhc0V4cGlyZWQpIHtcbiAgICAgICAgICBjdHguY29udGV4dC5zZXNzaW9uID0gc2Vzc2lvbjI7XG4gICAgICAgICAgcmV0dXJuIGN0eC5qc29uKFxuICAgICAgICAgICAgc2Vzc2lvbjJcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IGRhdGFDb29raWUgPSBjdHguY29udGV4dC5hdXRoQ29va2llcy5zZXNzaW9uRGF0YS5uYW1lO1xuICAgICAgICAgIGN0eC5zZXRDb29raWUoZGF0YUNvb2tpZSwgXCJcIiwge1xuICAgICAgICAgICAgbWF4QWdlOiAwXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZmluZFNlc3Npb24oc2Vzc2lvbkNvb2tpZVRva2VuKTtcbiAgICAgIGN0eC5jb250ZXh0LnNlc3Npb24gPSBzZXNzaW9uO1xuICAgICAgaWYgKCFzZXNzaW9uIHx8IHNlc3Npb24uc2Vzc2lvbi5leHBpcmVzQXQgPCAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSkge1xuICAgICAgICBkZWxldGVTZXNzaW9uQ29va2llKGN0eCk7XG4gICAgICAgIGlmIChzZXNzaW9uKSB7XG4gICAgICAgICAgYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmRlbGV0ZVNlc3Npb24oXG4gICAgICAgICAgICBzZXNzaW9uLnNlc3Npb24udG9rZW5cbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjdHguanNvbihudWxsKTtcbiAgICAgIH1cbiAgICAgIGlmIChkb250UmVtZW1iZXJNZSB8fCBjdHgucXVlcnk/LmRpc2FibGVSZWZyZXNoKSB7XG4gICAgICAgIHJldHVybiBjdHguanNvbihcbiAgICAgICAgICBzZXNzaW9uXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjb25zdCBleHBpcmVzSW4gPSBjdHguY29udGV4dC5zZXNzaW9uQ29uZmlnLmV4cGlyZXNJbjtcbiAgICAgIGNvbnN0IHVwZGF0ZUFnZSA9IGN0eC5jb250ZXh0LnNlc3Npb25Db25maWcudXBkYXRlQWdlO1xuICAgICAgY29uc3Qgc2Vzc2lvbklzRHVlVG9CZVVwZGF0ZWREYXRlID0gc2Vzc2lvbi5zZXNzaW9uLmV4cGlyZXNBdC52YWx1ZU9mKCkgLSBleHBpcmVzSW4gKiAxZTMgKyB1cGRhdGVBZ2UgKiAxZTM7XG4gICAgICBjb25zdCBzaG91bGRCZVVwZGF0ZWQgPSBzZXNzaW9uSXNEdWVUb0JlVXBkYXRlZERhdGUgPD0gRGF0ZS5ub3coKTtcbiAgICAgIGlmIChzaG91bGRCZVVwZGF0ZWQgJiYgKCFjdHgucXVlcnk/LmRpc2FibGVSZWZyZXNoIHx8ICFjdHguY29udGV4dC5vcHRpb25zLnNlc3Npb24/LmRpc2FibGVTZXNzaW9uUmVmcmVzaCkpIHtcbiAgICAgICAgY29uc3QgdXBkYXRlZFNlc3Npb24gPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIudXBkYXRlU2Vzc2lvbihcbiAgICAgICAgICBzZXNzaW9uLnNlc3Npb24udG9rZW4sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZXhwaXJlc0F0OiBnZXREYXRlKGN0eC5jb250ZXh0LnNlc3Npb25Db25maWcuZXhwaXJlc0luLCBcInNlY1wiKSxcbiAgICAgICAgICAgIHVwZGF0ZWRBdDogLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKClcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIGlmICghdXBkYXRlZFNlc3Npb24pIHtcbiAgICAgICAgICBkZWxldGVTZXNzaW9uQ29va2llKGN0eCk7XG4gICAgICAgICAgcmV0dXJuIGN0eC5qc29uKG51bGwsIHsgc3RhdHVzOiA0MDEgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbWF4QWdlID0gKHVwZGF0ZWRTZXNzaW9uLmV4cGlyZXNBdC52YWx1ZU9mKCkgLSBEYXRlLm5vdygpKSAvIDFlMztcbiAgICAgICAgYXdhaXQgc2V0U2Vzc2lvbkNvb2tpZShcbiAgICAgICAgICBjdHgsXG4gICAgICAgICAge1xuICAgICAgICAgICAgc2Vzc2lvbjogdXBkYXRlZFNlc3Npb24sXG4gICAgICAgICAgICB1c2VyOiBzZXNzaW9uLnVzZXJcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIG1heEFnZVxuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIGN0eC5qc29uKHtcbiAgICAgICAgICBzZXNzaW9uOiB1cGRhdGVkU2Vzc2lvbixcbiAgICAgICAgICB1c2VyOiBzZXNzaW9uLnVzZXJcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBhd2FpdCBzZXRDb29raWVDYWNoZShjdHgsIHNlc3Npb24pO1xuICAgICAgcmV0dXJuIGN0eC5qc29uKFxuICAgICAgICBzZXNzaW9uXG4gICAgICApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjdHguY29udGV4dC5sb2dnZXIuZXJyb3IoXCJJTlRFUk5BTF9TRVJWRVJfRVJST1JcIiwgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiSU5URVJOQUxfU0VSVkVSX0VSUk9SXCIsIHtcbiAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5GQUlMRURfVE9fR0VUX1NFU1NJT05cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuKTtcbmNvbnN0IGdldFNlc3Npb25Gcm9tQ3R4ID0gYXN5bmMgKGN0eCwgY29uZmlnKSA9PiB7XG4gIGlmIChjdHguY29udGV4dC5zZXNzaW9uKSB7XG4gICAgcmV0dXJuIGN0eC5jb250ZXh0LnNlc3Npb247XG4gIH1cbiAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGdldFNlc3Npb24oKSh7XG4gICAgLi4uY3R4LFxuICAgIGFzUmVzcG9uc2U6IGZhbHNlLFxuICAgIGhlYWRlcnM6IGN0eC5oZWFkZXJzLFxuICAgIHJldHVybkhlYWRlcnM6IGZhbHNlLFxuICAgIHF1ZXJ5OiB7XG4gICAgICAuLi5jb25maWcsXG4gICAgICAuLi5jdHgucXVlcnlcbiAgICB9XG4gIH0pLmNhdGNoKChlKSA9PiB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH0pO1xuICBjdHguY29udGV4dC5zZXNzaW9uID0gc2Vzc2lvbjtcbiAgcmV0dXJuIHNlc3Npb247XG59O1xuY29uc3Qgc2Vzc2lvbk1pZGRsZXdhcmUgPSBjcmVhdGVBdXRoTWlkZGxld2FyZShhc3luYyAoY3R4KSA9PiB7XG4gIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBnZXRTZXNzaW9uRnJvbUN0eChjdHgpO1xuICBpZiAoIXNlc3Npb24/LnNlc3Npb24pIHtcbiAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJVTkFVVEhPUklaRURcIik7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBzZXNzaW9uXG4gIH07XG59KTtcbmNvbnN0IHJlcXVlc3RPbmx5U2Vzc2lvbk1pZGRsZXdhcmUgPSBjcmVhdGVBdXRoTWlkZGxld2FyZShcbiAgYXN5bmMgKGN0eCkgPT4ge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBnZXRTZXNzaW9uRnJvbUN0eChjdHgpO1xuICAgIGlmICghc2Vzc2lvbj8uc2Vzc2lvbiAmJiAoY3R4LnJlcXVlc3QgfHwgY3R4LmhlYWRlcnMpKSB7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJVTkFVVEhPUklaRURcIik7XG4gICAgfVxuICAgIHJldHVybiB7IHNlc3Npb24gfTtcbiAgfVxuKTtcbmNvbnN0IGZyZXNoU2Vzc2lvbk1pZGRsZXdhcmUgPSBjcmVhdGVBdXRoTWlkZGxld2FyZShhc3luYyAoY3R4KSA9PiB7XG4gIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBnZXRTZXNzaW9uRnJvbUN0eChjdHgpO1xuICBpZiAoIXNlc3Npb24/LnNlc3Npb24pIHtcbiAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJVTkFVVEhPUklaRURcIik7XG4gIH1cbiAgaWYgKGN0eC5jb250ZXh0LnNlc3Npb25Db25maWcuZnJlc2hBZ2UgPT09IDApIHtcbiAgICByZXR1cm4ge1xuICAgICAgc2Vzc2lvblxuICAgIH07XG4gIH1cbiAgY29uc3QgZnJlc2hBZ2UgPSBjdHguY29udGV4dC5zZXNzaW9uQ29uZmlnLmZyZXNoQWdlO1xuICBjb25zdCBsYXN0VXBkYXRlZCA9IHNlc3Npb24uc2Vzc2lvbi51cGRhdGVkQXQ/LnZhbHVlT2YoKSB8fCBzZXNzaW9uLnNlc3Npb24uY3JlYXRlZEF0LnZhbHVlT2YoKTtcbiAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgY29uc3QgaXNGcmVzaCA9IG5vdyAtIGxhc3RVcGRhdGVkIDwgZnJlc2hBZ2UgKiAxZTM7XG4gIGlmICghaXNGcmVzaCkge1xuICAgIHRocm93IG5ldyBBUElFcnJvcihcIkZPUkJJRERFTlwiLCB7XG4gICAgICBtZXNzYWdlOiBcIlNlc3Npb24gaXMgbm90IGZyZXNoXCJcbiAgICB9KTtcbiAgfVxuICByZXR1cm4ge1xuICAgIHNlc3Npb25cbiAgfTtcbn0pO1xuY29uc3QgbGlzdFNlc3Npb25zID0gKCkgPT4gY3JlYXRlQXV0aEVuZHBvaW50KFxuICBcIi9saXN0LXNlc3Npb25zXCIsXG4gIHtcbiAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgdXNlOiBbc2Vzc2lvbk1pZGRsZXdhcmVdLFxuICAgIHJlcXVpcmVIZWFkZXJzOiB0cnVlLFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICBvcGVuYXBpOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIkxpc3QgYWxsIGFjdGl2ZSBzZXNzaW9ucyBmb3IgdGhlIHVzZXJcIixcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgXCIyMDBcIjoge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiU3VjY2Vzc1wiLFxuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIjoge1xuICAgICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgICAgdHlwZTogXCJhcnJheVwiLFxuICAgICAgICAgICAgICAgICAgaXRlbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgJHJlZjogXCIjL2NvbXBvbmVudHMvc2NoZW1hcy9TZXNzaW9uXCJcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGFzeW5jIChjdHgpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc2Vzc2lvbnMgPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIubGlzdFNlc3Npb25zKFxuICAgICAgICBjdHguY29udGV4dC5zZXNzaW9uLnVzZXIuaWRcbiAgICAgICk7XG4gICAgICBjb25zdCBhY3RpdmVTZXNzaW9ucyA9IHNlc3Npb25zLmZpbHRlcigoc2Vzc2lvbikgPT4ge1xuICAgICAgICByZXR1cm4gc2Vzc2lvbi5leHBpcmVzQXQgPiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGN0eC5qc29uKFxuICAgICAgICBhY3RpdmVTZXNzaW9uc1xuICAgICAgKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjdHguY29udGV4dC5sb2dnZXIuZXJyb3IoZSk7XG4gICAgICB0aHJvdyBjdHguZXJyb3IoXCJJTlRFUk5BTF9TRVJWRVJfRVJST1JcIik7XG4gICAgfVxuICB9XG4pO1xuY29uc3QgcmV2b2tlU2Vzc2lvbiA9IGNyZWF0ZUF1dGhFbmRwb2ludChcbiAgXCIvcmV2b2tlLXNlc3Npb25cIixcbiAge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgYm9keTogei5vYmplY3Qoe1xuICAgICAgdG9rZW46IHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSB0b2tlbiB0byByZXZva2VcIlxuICAgICAgfSlcbiAgICB9KSxcbiAgICB1c2U6IFtzZXNzaW9uTWlkZGxld2FyZV0sXG4gICAgcmVxdWlyZUhlYWRlcnM6IHRydWUsXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgIG9wZW5hcGk6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiUmV2b2tlIGEgc2luZ2xlIHNlc3Npb25cIixcbiAgICAgICAgcmVxdWVzdEJvZHk6IHtcbiAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIjoge1xuICAgICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgIHRva2VuOiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSB0b2tlbiB0byByZXZva2VcIlxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFtcInRva2VuXCJdXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHJlc3BvbnNlczoge1xuICAgICAgICAgIFwiMjAwXCI6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlN1Y2Nlc3NcIixcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbi9qc29uXCI6IHtcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYm9vbGVhblwiLFxuICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkluZGljYXRlcyBpZiB0aGUgc2Vzc2lvbiB3YXMgcmV2b2tlZCBzdWNjZXNzZnVsbHlcIlxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFtcInN0YXR1c1wiXVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgYXN5bmMgKGN0eCkgPT4ge1xuICAgIGNvbnN0IHRva2VuID0gY3R4LmJvZHkudG9rZW47XG4gICAgY29uc3QgZmluZFNlc3Npb24gPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZmluZFNlc3Npb24odG9rZW4pO1xuICAgIGlmICghZmluZFNlc3Npb24pIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogXCJTZXNzaW9uIG5vdCBmb3VuZFwiXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGZpbmRTZXNzaW9uLnNlc3Npb24udXNlcklkICE9PSBjdHguY29udGV4dC5zZXNzaW9uLnVzZXIuaWQpIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIlVOQVVUSE9SSVpFRFwiKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5kZWxldGVTZXNzaW9uKHRva2VuKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY3R4LmNvbnRleHQubG9nZ2VyLmVycm9yKFxuICAgICAgICBlcnJvciAmJiB0eXBlb2YgZXJyb3IgPT09IFwib2JqZWN0XCIgJiYgXCJuYW1lXCIgaW4gZXJyb3IgPyBlcnJvci5uYW1lIDogXCJcIixcbiAgICAgICAgZXJyb3JcbiAgICAgICk7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJJTlRFUk5BTF9TRVJWRVJfRVJST1JcIik7XG4gICAgfVxuICAgIHJldHVybiBjdHguanNvbih7XG4gICAgICBzdGF0dXM6IHRydWVcbiAgICB9KTtcbiAgfVxuKTtcbmNvbnN0IHJldm9rZVNlc3Npb25zID0gY3JlYXRlQXV0aEVuZHBvaW50KFxuICBcIi9yZXZva2Utc2Vzc2lvbnNcIixcbiAge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgdXNlOiBbc2Vzc2lvbk1pZGRsZXdhcmVdLFxuICAgIHJlcXVpcmVIZWFkZXJzOiB0cnVlLFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICBvcGVuYXBpOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlJldm9rZSBhbGwgc2Vzc2lvbnMgZm9yIHRoZSB1c2VyXCIsXG4gICAgICAgIHJlc3BvbnNlczoge1xuICAgICAgICAgIFwiMjAwXCI6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlN1Y2Nlc3NcIixcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbi9qc29uXCI6IHtcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYm9vbGVhblwiLFxuICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkluZGljYXRlcyBpZiBhbGwgc2Vzc2lvbnMgd2VyZSByZXZva2VkIHN1Y2Nlc3NmdWxseVwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICByZXF1aXJlZDogW1wic3RhdHVzXCJdXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBhc3luYyAoY3R4KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5kZWxldGVTZXNzaW9ucyhcbiAgICAgICAgY3R4LmNvbnRleHQuc2Vzc2lvbi51c2VyLmlkXG4gICAgICApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjdHguY29udGV4dC5sb2dnZXIuZXJyb3IoXG4gICAgICAgIGVycm9yICYmIHR5cGVvZiBlcnJvciA9PT0gXCJvYmplY3RcIiAmJiBcIm5hbWVcIiBpbiBlcnJvciA/IGVycm9yLm5hbWUgOiBcIlwiLFxuICAgICAgICBlcnJvclxuICAgICAgKTtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIklOVEVSTkFMX1NFUlZFUl9FUlJPUlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIGN0eC5qc29uKHtcbiAgICAgIHN0YXR1czogdHJ1ZVxuICAgIH0pO1xuICB9XG4pO1xuY29uc3QgcmV2b2tlT3RoZXJTZXNzaW9ucyA9IGNyZWF0ZUF1dGhFbmRwb2ludChcbiAgXCIvcmV2b2tlLW90aGVyLXNlc3Npb25zXCIsXG4gIHtcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgIHJlcXVpcmVIZWFkZXJzOiB0cnVlLFxuICAgIHVzZTogW3Nlc3Npb25NaWRkbGV3YXJlXSxcbiAgICBtZXRhZGF0YToge1xuICAgICAgb3BlbmFwaToge1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJSZXZva2UgYWxsIG90aGVyIHNlc3Npb25zIGZvciB0aGUgdXNlciBleGNlcHQgdGhlIGN1cnJlbnQgb25lXCIsXG4gICAgICAgIHJlc3BvbnNlczoge1xuICAgICAgICAgIFwiMjAwXCI6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlN1Y2Nlc3NcIixcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbi9qc29uXCI6IHtcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYm9vbGVhblwiLFxuICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkluZGljYXRlcyBpZiBhbGwgb3RoZXIgc2Vzc2lvbnMgd2VyZSByZXZva2VkIHN1Y2Nlc3NmdWxseVwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICByZXF1aXJlZDogW1wic3RhdHVzXCJdXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBhc3luYyAoY3R4KSA9PiB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGN0eC5jb250ZXh0LnNlc3Npb247XG4gICAgaWYgKCFzZXNzaW9uLnVzZXIpIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIlVOQVVUSE9SSVpFRFwiKTtcbiAgICB9XG4gICAgY29uc3Qgc2Vzc2lvbnMgPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIubGlzdFNlc3Npb25zKFxuICAgICAgc2Vzc2lvbi51c2VyLmlkXG4gICAgKTtcbiAgICBjb25zdCBhY3RpdmVTZXNzaW9ucyA9IHNlc3Npb25zLmZpbHRlcigoc2Vzc2lvbjIpID0+IHtcbiAgICAgIHJldHVybiBzZXNzaW9uMi5leHBpcmVzQXQgPiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKTtcbiAgICB9KTtcbiAgICBjb25zdCBvdGhlclNlc3Npb25zID0gYWN0aXZlU2Vzc2lvbnMuZmlsdGVyKFxuICAgICAgKHNlc3Npb24yKSA9PiBzZXNzaW9uMi50b2tlbiAhPT0gY3R4LmNvbnRleHQuc2Vzc2lvbi5zZXNzaW9uLnRva2VuXG4gICAgKTtcbiAgICBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgIG90aGVyU2Vzc2lvbnMubWFwKFxuICAgICAgICAoc2Vzc2lvbjIpID0+IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5kZWxldGVTZXNzaW9uKHNlc3Npb24yLnRva2VuKVxuICAgICAgKVxuICAgICk7XG4gICAgcmV0dXJuIGN0eC5qc29uKHtcbiAgICAgIHN0YXR1czogdHJ1ZVxuICAgIH0pO1xuICB9XG4pO1xuXG5hc3luYyBmdW5jdGlvbiBjcmVhdGVFbWFpbFZlcmlmaWNhdGlvblRva2VuKHNlY3JldCwgZW1haWwsIHVwZGF0ZVRvLCBleHBpcmVzSW4gPSAzNjAwKSB7XG4gIGNvbnN0IHRva2VuID0gYXdhaXQgc2lnbkpXVChcbiAgICB7XG4gICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgIHVwZGF0ZVRvXG4gICAgfSxcbiAgICBzZWNyZXQsXG4gICAgZXhwaXJlc0luXG4gICk7XG4gIHJldHVybiB0b2tlbjtcbn1cbmFzeW5jIGZ1bmN0aW9uIHNlbmRWZXJpZmljYXRpb25FbWFpbEZuKGN0eCwgdXNlcikge1xuICBpZiAoIWN0eC5jb250ZXh0Lm9wdGlvbnMuZW1haWxWZXJpZmljYXRpb24/LnNlbmRWZXJpZmljYXRpb25FbWFpbCkge1xuICAgIGN0eC5jb250ZXh0LmxvZ2dlci5lcnJvcihcIlZlcmlmaWNhdGlvbiBlbWFpbCBpc24ndCBlbmFibGVkLlwiKTtcbiAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICBtZXNzYWdlOiBcIlZlcmlmaWNhdGlvbiBlbWFpbCBpc24ndCBlbmFibGVkXCJcbiAgICB9KTtcbiAgfVxuICBjb25zdCB0b2tlbiA9IGF3YWl0IGNyZWF0ZUVtYWlsVmVyaWZpY2F0aW9uVG9rZW4oXG4gICAgY3R4LmNvbnRleHQuc2VjcmV0LFxuICAgIHVzZXIuZW1haWwsXG4gICAgdm9pZCAwLFxuICAgIGN0eC5jb250ZXh0Lm9wdGlvbnMuZW1haWxWZXJpZmljYXRpb24/LmV4cGlyZXNJblxuICApO1xuICBjb25zdCB1cmwgPSBgJHtjdHguY29udGV4dC5iYXNlVVJMfS92ZXJpZnktZW1haWw/dG9rZW49JHt0b2tlbn0mY2FsbGJhY2tVUkw9JHtjdHguYm9keS5jYWxsYmFja1VSTCB8fCBcIi9cIn1gO1xuICBhd2FpdCBjdHguY29udGV4dC5vcHRpb25zLmVtYWlsVmVyaWZpY2F0aW9uLnNlbmRWZXJpZmljYXRpb25FbWFpbChcbiAgICB7XG4gICAgICB1c2VyLFxuICAgICAgdXJsLFxuICAgICAgdG9rZW5cbiAgICB9LFxuICAgIGN0eC5yZXF1ZXN0XG4gICk7XG59XG5jb25zdCBzZW5kVmVyaWZpY2F0aW9uRW1haWwgPSBjcmVhdGVBdXRoRW5kcG9pbnQoXG4gIFwiL3NlbmQtdmVyaWZpY2F0aW9uLWVtYWlsXCIsXG4gIHtcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgIGJvZHk6IHoub2JqZWN0KHtcbiAgICAgIGVtYWlsOiB6LmVtYWlsKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBlbWFpbCB0byBzZW5kIHRoZSB2ZXJpZmljYXRpb24gZW1haWwgdG9cIlxuICAgICAgfSksXG4gICAgICBjYWxsYmFja1VSTDogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIFVSTCB0byB1c2UgZm9yIGVtYWlsIHZlcmlmaWNhdGlvbiBjYWxsYmFja1wiXG4gICAgICB9KS5vcHRpb25hbCgpXG4gICAgfSksXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgIG9wZW5hcGk6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiU2VuZCBhIHZlcmlmaWNhdGlvbiBlbWFpbCB0byB0aGUgdXNlclwiLFxuICAgICAgICByZXF1ZXN0Qm9keToge1xuICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiOiB7XG4gICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgZW1haWw6IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIGVtYWlsIHRvIHNlbmQgdGhlIHZlcmlmaWNhdGlvbiBlbWFpbCB0b1wiLFxuICAgICAgICAgICAgICAgICAgICBleGFtcGxlOiBcInVzZXJAZXhhbXBsZS5jb21cIlxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIGNhbGxiYWNrVVJMOiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBVUkwgdG8gdXNlIGZvciBlbWFpbCB2ZXJpZmljYXRpb24gY2FsbGJhY2tcIixcbiAgICAgICAgICAgICAgICAgICAgZXhhbXBsZTogXCJodHRwczovL2V4YW1wbGUuY29tL2NhbGxiYWNrXCIsXG4gICAgICAgICAgICAgICAgICAgIG51bGxhYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICByZXF1aXJlZDogW1wiZW1haWxcIl1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgXCIyMDBcIjoge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiU3VjY2Vzc1wiLFxuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIjoge1xuICAgICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJib29sZWFuXCIsXG4gICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiSW5kaWNhdGVzIGlmIHRoZSBlbWFpbCB3YXMgc2VudCBzdWNjZXNzZnVsbHlcIixcbiAgICAgICAgICAgICAgICAgICAgICBleGFtcGxlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiNDAwXCI6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkJhZCBSZXF1ZXN0XCIsXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiOiB7XG4gICAgICAgICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJFcnJvciBtZXNzYWdlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgZXhhbXBsZTogXCJWZXJpZmljYXRpb24gZW1haWwgaXNuJ3QgZW5hYmxlZFwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGFzeW5jIChjdHgpID0+IHtcbiAgICBpZiAoIWN0eC5jb250ZXh0Lm9wdGlvbnMuZW1haWxWZXJpZmljYXRpb24/LnNlbmRWZXJpZmljYXRpb25FbWFpbCkge1xuICAgICAgY3R4LmNvbnRleHQubG9nZ2VyLmVycm9yKFwiVmVyaWZpY2F0aW9uIGVtYWlsIGlzbid0IGVuYWJsZWQuXCIpO1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBcIlZlcmlmaWNhdGlvbiBlbWFpbCBpc24ndCBlbmFibGVkXCJcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCB7IGVtYWlsIH0gPSBjdHguYm9keTtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZ2V0U2Vzc2lvbkZyb21DdHgoY3R4KTtcbiAgICBpZiAoIXNlc3Npb24pIHtcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZmluZFVzZXJCeUVtYWlsKGVtYWlsKTtcbiAgICAgIGlmICghdXNlcikge1xuICAgICAgICByZXR1cm4gY3R4Lmpzb24oe1xuICAgICAgICAgIHN0YXR1czogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGF3YWl0IHNlbmRWZXJpZmljYXRpb25FbWFpbEZuKGN0eCwgdXNlci51c2VyKTtcbiAgICAgIHJldHVybiBjdHguanNvbih7XG4gICAgICAgIHN0YXR1czogdHJ1ZVxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChzZXNzaW9uPy51c2VyLmVtYWlsVmVyaWZpZWQpIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogXCJZb3UgY2FuIG9ubHkgc2VuZCBhIHZlcmlmaWNhdGlvbiBlbWFpbCB0byBhbiB1bnZlcmlmaWVkIGVtYWlsXCJcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoc2Vzc2lvbj8udXNlci5lbWFpbCAhPT0gZW1haWwpIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogXCJZb3UgY2FuIG9ubHkgc2VuZCBhIHZlcmlmaWNhdGlvbiBlbWFpbCB0byB5b3VyIG93biBlbWFpbFwiXG4gICAgICB9KTtcbiAgICB9XG4gICAgYXdhaXQgc2VuZFZlcmlmaWNhdGlvbkVtYWlsRm4oY3R4LCBzZXNzaW9uLnVzZXIpO1xuICAgIHJldHVybiBjdHguanNvbih7XG4gICAgICBzdGF0dXM6IHRydWVcbiAgICB9KTtcbiAgfVxuKTtcbmNvbnN0IHZlcmlmeUVtYWlsID0gY3JlYXRlQXV0aEVuZHBvaW50KFxuICBcIi92ZXJpZnktZW1haWxcIixcbiAge1xuICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICBxdWVyeTogei5vYmplY3Qoe1xuICAgICAgdG9rZW46IHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSB0b2tlbiB0byB2ZXJpZnkgdGhlIGVtYWlsXCJcbiAgICAgIH0pLFxuICAgICAgY2FsbGJhY2tVUkw6IHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBVUkwgdG8gcmVkaXJlY3QgdG8gYWZ0ZXIgZW1haWwgdmVyaWZpY2F0aW9uXCJcbiAgICAgIH0pLm9wdGlvbmFsKClcbiAgICB9KSxcbiAgICB1c2U6IFtvcmlnaW5DaGVjaygoY3R4KSA9PiBjdHgucXVlcnkuY2FsbGJhY2tVUkwpXSxcbiAgICBtZXRhZGF0YToge1xuICAgICAgb3BlbmFwaToge1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJWZXJpZnkgdGhlIGVtYWlsIG9mIHRoZSB1c2VyXCIsXG4gICAgICAgIHBhcmFtZXRlcnM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiBcInRva2VuXCIsXG4gICAgICAgICAgICBpbjogXCJxdWVyeVwiLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIHRva2VuIHRvIHZlcmlmeSB0aGUgZW1haWxcIixcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIG5hbWU6IFwiY2FsbGJhY2tVUkxcIixcbiAgICAgICAgICAgIGluOiBcInF1ZXJ5XCIsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgVVJMIHRvIHJlZGlyZWN0IHRvIGFmdGVyIGVtYWlsIHZlcmlmaWNhdGlvblwiLFxuICAgICAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIF0sXG4gICAgICAgIHJlc3BvbnNlczoge1xuICAgICAgICAgIFwiMjAwXCI6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlN1Y2Nlc3NcIixcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbi9qc29uXCI6IHtcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlVzZXIgSURcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlVzZXIgZW1haWxcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiVXNlciBuYW1lXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWFnZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJVc2VyIGltYWdlIFVSTFwiXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZW1haWxWZXJpZmllZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImJvb2xlYW5cIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiSW5kaWNhdGVzIGlmIHRoZSB1c2VyIGVtYWlsIGlzIHZlcmlmaWVkXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiVXNlciBjcmVhdGlvbiBkYXRlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkQXQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiVXNlciB1cGRhdGUgZGF0ZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogW1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJpZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJlbWFpbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImltYWdlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImVtYWlsVmVyaWZpZWRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY3JlYXRlZEF0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInVwZGF0ZWRBdFwiXG4gICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImJvb2xlYW5cIixcbiAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJJbmRpY2F0ZXMgaWYgdGhlIGVtYWlsIHdhcyB2ZXJpZmllZCBzdWNjZXNzZnVsbHlcIlxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFtcInVzZXJcIiwgXCJzdGF0dXNcIl1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGFzeW5jIChjdHgpID0+IHtcbiAgICBmdW5jdGlvbiByZWRpcmVjdE9uRXJyb3IoZXJyb3IpIHtcbiAgICAgIGlmIChjdHgucXVlcnkuY2FsbGJhY2tVUkwpIHtcbiAgICAgICAgaWYgKGN0eC5xdWVyeS5jYWxsYmFja1VSTC5pbmNsdWRlcyhcIj9cIikpIHtcbiAgICAgICAgICB0aHJvdyBjdHgucmVkaXJlY3QoYCR7Y3R4LnF1ZXJ5LmNhbGxiYWNrVVJMfSZlcnJvcj0ke2Vycm9yfWApO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IGN0eC5yZWRpcmVjdChgJHtjdHgucXVlcnkuY2FsbGJhY2tVUkx9P2Vycm9yPSR7ZXJyb3J9YCk7XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJVTkFVVEhPUklaRURcIiwge1xuICAgICAgICBtZXNzYWdlOiBlcnJvclxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IHsgdG9rZW4gfSA9IGN0eC5xdWVyeTtcbiAgICBsZXQgand0O1xuICAgIHRyeSB7XG4gICAgICBqd3QgPSBhd2FpdCBqd3RWZXJpZnkoXG4gICAgICAgIHRva2VuLFxuICAgICAgICBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoY3R4LmNvbnRleHQuc2VjcmV0KSxcbiAgICAgICAge1xuICAgICAgICAgIGFsZ29yaXRobXM6IFtcIkhTMjU2XCJdXG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgaWYgKGUgaW5zdGFuY2VvZiBKV1RFeHBpcmVkKSB7XG4gICAgICAgIHJldHVybiByZWRpcmVjdE9uRXJyb3IoXCJ0b2tlbl9leHBpcmVkXCIpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlZGlyZWN0T25FcnJvcihcImludmFsaWRfdG9rZW5cIik7XG4gICAgfVxuICAgIGNvbnN0IHNjaGVtYSA9IHoub2JqZWN0KHtcbiAgICAgIGVtYWlsOiB6LnN0cmluZygpLmVtYWlsKCksXG4gICAgICB1cGRhdGVUbzogei5zdHJpbmcoKS5vcHRpb25hbCgpXG4gICAgfSk7XG4gICAgY29uc3QgcGFyc2VkID0gc2NoZW1hLnBhcnNlKGp3dC5wYXlsb2FkKTtcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmZpbmRVc2VyQnlFbWFpbChcbiAgICAgIHBhcnNlZC5lbWFpbFxuICAgICk7XG4gICAgaWYgKCF1c2VyKSB7XG4gICAgICByZXR1cm4gcmVkaXJlY3RPbkVycm9yKFwidXNlcl9ub3RfZm91bmRcIik7XG4gICAgfVxuICAgIGlmIChwYXJzZWQudXBkYXRlVG8pIHtcbiAgICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBnZXRTZXNzaW9uRnJvbUN0eChjdHgpO1xuICAgICAgaWYgKCFzZXNzaW9uKSB7XG4gICAgICAgIGlmIChjdHgucXVlcnkuY2FsbGJhY2tVUkwpIHtcbiAgICAgICAgICB0aHJvdyBjdHgucmVkaXJlY3QoYCR7Y3R4LnF1ZXJ5LmNhbGxiYWNrVVJMfT9lcnJvcj11bmF1dGhvcml6ZWRgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVkaXJlY3RPbkVycm9yKFwidW5hdXRob3JpemVkXCIpO1xuICAgICAgfVxuICAgICAgaWYgKHNlc3Npb24udXNlci5lbWFpbCAhPT0gcGFyc2VkLmVtYWlsKSB7XG4gICAgICAgIGlmIChjdHgucXVlcnkuY2FsbGJhY2tVUkwpIHtcbiAgICAgICAgICB0aHJvdyBjdHgucmVkaXJlY3QoYCR7Y3R4LnF1ZXJ5LmNhbGxiYWNrVVJMfT9lcnJvcj11bmF1dGhvcml6ZWRgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVkaXJlY3RPbkVycm9yKFwidW5hdXRob3JpemVkXCIpO1xuICAgICAgfVxuICAgICAgY29uc3QgdXBkYXRlZFVzZXIyID0gYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLnVwZGF0ZVVzZXJCeUVtYWlsKFxuICAgICAgICBwYXJzZWQuZW1haWwsXG4gICAgICAgIHtcbiAgICAgICAgICBlbWFpbDogcGFyc2VkLnVwZGF0ZVRvLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IGZhbHNlXG4gICAgICAgIH0sXG4gICAgICAgIGN0eFxuICAgICAgKTtcbiAgICAgIGNvbnN0IG5ld1Rva2VuID0gYXdhaXQgY3JlYXRlRW1haWxWZXJpZmljYXRpb25Ub2tlbihcbiAgICAgICAgY3R4LmNvbnRleHQuc2VjcmV0LFxuICAgICAgICBwYXJzZWQudXBkYXRlVG9cbiAgICAgICk7XG4gICAgICBhd2FpdCBjdHguY29udGV4dC5vcHRpb25zLmVtYWlsVmVyaWZpY2F0aW9uPy5zZW5kVmVyaWZpY2F0aW9uRW1haWw/LihcbiAgICAgICAge1xuICAgICAgICAgIHVzZXI6IHVwZGF0ZWRVc2VyMixcbiAgICAgICAgICB1cmw6IGAke2N0eC5jb250ZXh0LmJhc2VVUkx9L3ZlcmlmeS1lbWFpbD90b2tlbj0ke25ld1Rva2VufSZjYWxsYmFja1VSTD0ke2N0eC5xdWVyeS5jYWxsYmFja1VSTCB8fCBcIi9cIn1gLFxuICAgICAgICAgIHRva2VuOiBuZXdUb2tlblxuICAgICAgICB9LFxuICAgICAgICBjdHgucmVxdWVzdFxuICAgICAgKTtcbiAgICAgIGF3YWl0IHNldFNlc3Npb25Db29raWUoY3R4LCB7XG4gICAgICAgIHNlc3Npb246IHNlc3Npb24uc2Vzc2lvbixcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIC4uLnNlc3Npb24udXNlcixcbiAgICAgICAgICBlbWFpbDogcGFyc2VkLnVwZGF0ZVRvLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IGZhbHNlXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgaWYgKGN0eC5xdWVyeS5jYWxsYmFja1VSTCkge1xuICAgICAgICB0aHJvdyBjdHgucmVkaXJlY3QoY3R4LnF1ZXJ5LmNhbGxiYWNrVVJMKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBjdHguanNvbih7XG4gICAgICAgIHN0YXR1czogdHJ1ZSxcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGlkOiB1cGRhdGVkVXNlcjIuaWQsXG4gICAgICAgICAgZW1haWw6IHVwZGF0ZWRVc2VyMi5lbWFpbCxcbiAgICAgICAgICBuYW1lOiB1cGRhdGVkVXNlcjIubmFtZSxcbiAgICAgICAgICBpbWFnZTogdXBkYXRlZFVzZXIyLmltYWdlLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IHVwZGF0ZWRVc2VyMi5lbWFpbFZlcmlmaWVkLFxuICAgICAgICAgIGNyZWF0ZWRBdDogdXBkYXRlZFVzZXIyLmNyZWF0ZWRBdCxcbiAgICAgICAgICB1cGRhdGVkQXQ6IHVwZGF0ZWRVc2VyMi51cGRhdGVkQXRcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChjdHguY29udGV4dC5vcHRpb25zLmVtYWlsVmVyaWZpY2F0aW9uPy5vbkVtYWlsVmVyaWZpY2F0aW9uKSB7XG4gICAgICBhd2FpdCBjdHguY29udGV4dC5vcHRpb25zLmVtYWlsVmVyaWZpY2F0aW9uLm9uRW1haWxWZXJpZmljYXRpb24oXG4gICAgICAgIHVzZXIudXNlcixcbiAgICAgICAgY3R4LnJlcXVlc3RcbiAgICAgICk7XG4gICAgfVxuICAgIGNvbnN0IHVwZGF0ZWRVc2VyID0gYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLnVwZGF0ZVVzZXJCeUVtYWlsKFxuICAgICAgcGFyc2VkLmVtYWlsLFxuICAgICAge1xuICAgICAgICBlbWFpbFZlcmlmaWVkOiB0cnVlXG4gICAgICB9LFxuICAgICAgY3R4XG4gICAgKTtcbiAgICBpZiAoY3R4LmNvbnRleHQub3B0aW9ucy5lbWFpbFZlcmlmaWNhdGlvbj8uYWZ0ZXJFbWFpbFZlcmlmaWNhdGlvbikge1xuICAgICAgYXdhaXQgY3R4LmNvbnRleHQub3B0aW9ucy5lbWFpbFZlcmlmaWNhdGlvbi5hZnRlckVtYWlsVmVyaWZpY2F0aW9uKFxuICAgICAgICB1cGRhdGVkVXNlcixcbiAgICAgICAgY3R4LnJlcXVlc3RcbiAgICAgICk7XG4gICAgfVxuICAgIGlmIChjdHguY29udGV4dC5vcHRpb25zLmVtYWlsVmVyaWZpY2F0aW9uPy5hdXRvU2lnbkluQWZ0ZXJWZXJpZmljYXRpb24pIHtcbiAgICAgIGNvbnN0IGN1cnJlbnRTZXNzaW9uID0gYXdhaXQgZ2V0U2Vzc2lvbkZyb21DdHgoY3R4KTtcbiAgICAgIGlmICghY3VycmVudFNlc3Npb24gfHwgY3VycmVudFNlc3Npb24udXNlci5lbWFpbCAhPT0gcGFyc2VkLmVtYWlsKSB7XG4gICAgICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuY3JlYXRlU2Vzc2lvbihcbiAgICAgICAgICB1c2VyLnVzZXIuaWQsXG4gICAgICAgICAgY3R4XG4gICAgICAgICk7XG4gICAgICAgIGlmICghc2Vzc2lvbikge1xuICAgICAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIklOVEVSTkFMX1NFUlZFUl9FUlJPUlwiLCB7XG4gICAgICAgICAgICBtZXNzYWdlOiBcIkZhaWxlZCB0byBjcmVhdGUgc2Vzc2lvblwiXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgc2V0U2Vzc2lvbkNvb2tpZShjdHgsIHtcbiAgICAgICAgICBzZXNzaW9uLFxuICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgIC4uLnVzZXIudXNlcixcbiAgICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IHRydWVcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXdhaXQgc2V0U2Vzc2lvbkNvb2tpZShjdHgsIHtcbiAgICAgICAgICBzZXNzaW9uOiBjdXJyZW50U2Vzc2lvbi5zZXNzaW9uLFxuICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgIC4uLmN1cnJlbnRTZXNzaW9uLnVzZXIsXG4gICAgICAgICAgICBlbWFpbFZlcmlmaWVkOiB0cnVlXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGN0eC5xdWVyeS5jYWxsYmFja1VSTCkge1xuICAgICAgdGhyb3cgY3R4LnJlZGlyZWN0KGN0eC5xdWVyeS5jYWxsYmFja1VSTCk7XG4gICAgfVxuICAgIHJldHVybiBjdHguanNvbih7XG4gICAgICBzdGF0dXM6IHRydWUsXG4gICAgICB1c2VyOiBudWxsXG4gICAgfSk7XG4gIH1cbik7XG5cbmNvbnN0IEhJREVfTUVUQURBVEEgPSB7XG4gIGlzQWN0aW9uOiBmYWxzZVxufTtcblxuYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVTdGF0ZShjLCBsaW5rKSB7XG4gIGNvbnN0IGNhbGxiYWNrVVJMID0gYy5ib2R5Py5jYWxsYmFja1VSTCB8fCBjLmNvbnRleHQub3B0aW9ucy5iYXNlVVJMO1xuICBpZiAoIWNhbGxiYWNrVVJMKSB7XG4gICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgbWVzc2FnZTogXCJjYWxsYmFja1VSTCBpcyByZXF1aXJlZFwiXG4gICAgfSk7XG4gIH1cbiAgY29uc3QgY29kZVZlcmlmaWVyID0gZ2VuZXJhdGVSYW5kb21TdHJpbmcoMTI4KTtcbiAgY29uc3Qgc3RhdGUgPSBnZW5lcmF0ZVJhbmRvbVN0cmluZygzMik7XG4gIGNvbnN0IGRhdGEgPSBKU09OLnN0cmluZ2lmeSh7XG4gICAgY2FsbGJhY2tVUkwsXG4gICAgY29kZVZlcmlmaWVyLFxuICAgIGVycm9yVVJMOiBjLmJvZHk/LmVycm9yQ2FsbGJhY2tVUkwsXG4gICAgbmV3VXNlclVSTDogYy5ib2R5Py5uZXdVc2VyQ2FsbGJhY2tVUkwsXG4gICAgbGluayxcbiAgICAvKipcbiAgICAgKiBUaGlzIGlzIHRoZSBhY3R1YWwgZXhwaXJ5IHRpbWUgb2YgdGhlIHN0YXRlXG4gICAgICovXG4gICAgZXhwaXJlc0F0OiBEYXRlLm5vdygpICsgMTAgKiA2MCAqIDFlMyxcbiAgICByZXF1ZXN0U2lnblVwOiBjLmJvZHk/LnJlcXVlc3RTaWduVXBcbiAgfSk7XG4gIGNvbnN0IGV4cGlyZXNBdCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpO1xuICBleHBpcmVzQXQuc2V0TWludXRlcyhleHBpcmVzQXQuZ2V0TWludXRlcygpICsgMTApO1xuICBjb25zdCB2ZXJpZmljYXRpb24gPSBhd2FpdCBjLmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmNyZWF0ZVZlcmlmaWNhdGlvblZhbHVlKFxuICAgIHtcbiAgICAgIHZhbHVlOiBkYXRhLFxuICAgICAgaWRlbnRpZmllcjogc3RhdGUsXG4gICAgICBleHBpcmVzQXRcbiAgICB9LFxuICAgIGNcbiAgKTtcbiAgaWYgKCF2ZXJpZmljYXRpb24pIHtcbiAgICBjLmNvbnRleHQubG9nZ2VyLmVycm9yKFxuICAgICAgXCJVbmFibGUgdG8gY3JlYXRlIHZlcmlmaWNhdGlvbi4gTWFrZSBzdXJlIHRoZSBkYXRhYmFzZSBhZGFwdGVyIGlzIHByb3Blcmx5IHdvcmtpbmcgYW5kIHRoZXJlIGlzIGEgdmVyaWZpY2F0aW9uIHRhYmxlIGluIHRoZSBkYXRhYmFzZVwiXG4gICAgKTtcbiAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJJTlRFUk5BTF9TRVJWRVJfRVJST1JcIiwge1xuICAgICAgbWVzc2FnZTogXCJVbmFibGUgdG8gY3JlYXRlIHZlcmlmaWNhdGlvblwiXG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBzdGF0ZTogdmVyaWZpY2F0aW9uLmlkZW50aWZpZXIsXG4gICAgY29kZVZlcmlmaWVyXG4gIH07XG59XG5hc3luYyBmdW5jdGlvbiBwYXJzZVN0YXRlKGMpIHtcbiAgY29uc3Qgc3RhdGUgPSBjLnF1ZXJ5LnN0YXRlIHx8IGMuYm9keS5zdGF0ZTtcbiAgY29uc3QgZGF0YSA9IGF3YWl0IGMuY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZmluZFZlcmlmaWNhdGlvblZhbHVlKHN0YXRlKTtcbiAgaWYgKCFkYXRhKSB7XG4gICAgYy5jb250ZXh0LmxvZ2dlci5lcnJvcihcIlN0YXRlIE1pc21hdGNoLiBWZXJpZmljYXRpb24gbm90IGZvdW5kXCIsIHtcbiAgICAgIHN0YXRlXG4gICAgfSk7XG4gICAgY29uc3QgZXJyb3JVUkwgPSBjLmNvbnRleHQub3B0aW9ucy5vbkFQSUVycm9yPy5lcnJvclVSTCB8fCBgJHtjLmNvbnRleHQuYmFzZVVSTH0vZXJyb3JgO1xuICAgIHRocm93IGMucmVkaXJlY3QoYCR7ZXJyb3JVUkx9P2Vycm9yPXBsZWFzZV9yZXN0YXJ0X3RoZV9wcm9jZXNzYCk7XG4gIH1cbiAgY29uc3QgcGFyc2VkRGF0YSA9IHoub2JqZWN0KHtcbiAgICBjYWxsYmFja1VSTDogei5zdHJpbmcoKSxcbiAgICBjb2RlVmVyaWZpZXI6IHouc3RyaW5nKCksXG4gICAgZXJyb3JVUkw6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBuZXdVc2VyVVJMOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgZXhwaXJlc0F0OiB6Lm51bWJlcigpLFxuICAgIGxpbms6IHoub2JqZWN0KHtcbiAgICAgIGVtYWlsOiB6LnN0cmluZygpLFxuICAgICAgdXNlcklkOiB6LmNvZXJjZS5zdHJpbmcoKVxuICAgIH0pLm9wdGlvbmFsKCksXG4gICAgcmVxdWVzdFNpZ25VcDogei5ib29sZWFuKCkub3B0aW9uYWwoKVxuICB9KS5wYXJzZShKU09OLnBhcnNlKGRhdGEudmFsdWUpKTtcbiAgaWYgKCFwYXJzZWREYXRhLmVycm9yVVJMKSB7XG4gICAgcGFyc2VkRGF0YS5lcnJvclVSTCA9IGAke2MuY29udGV4dC5iYXNlVVJMfS9lcnJvcmA7XG4gIH1cbiAgaWYgKHBhcnNlZERhdGEuZXhwaXJlc0F0IDwgRGF0ZS5ub3coKSkge1xuICAgIGF3YWl0IGMuY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZGVsZXRlVmVyaWZpY2F0aW9uVmFsdWUoZGF0YS5pZCk7XG4gICAgY29uc3QgZXJyb3JVUkwgPSBjLmNvbnRleHQub3B0aW9ucy5vbkFQSUVycm9yPy5lcnJvclVSTCB8fCBgJHtjLmNvbnRleHQuYmFzZVVSTH0vZXJyb3JgO1xuICAgIHRocm93IGMucmVkaXJlY3QoYCR7ZXJyb3JVUkx9P2Vycm9yPXBsZWFzZV9yZXN0YXJ0X3RoZV9wcm9jZXNzYCk7XG4gIH1cbiAgYXdhaXQgYy5jb250ZXh0LmludGVybmFsQWRhcHRlci5kZWxldGVWZXJpZmljYXRpb25WYWx1ZShkYXRhLmlkKTtcbiAgcmV0dXJuIHBhcnNlZERhdGE7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlQ29kZUNoYWxsZW5nZShjb2RlVmVyaWZpZXIpIHtcbiAgY29uc3QgY29kZUNoYWxsZW5nZUJ5dGVzID0gYXdhaXQgY3JlYXRlSGFzaChcIlNIQS0yNTZcIikuZGlnZXN0KGNvZGVWZXJpZmllcik7XG4gIHJldHVybiBiYXNlNjRVcmwuZW5jb2RlKG5ldyBVaW50OEFycmF5KGNvZGVDaGFsbGVuZ2VCeXRlcyksIHtcbiAgICBwYWRkaW5nOiBmYWxzZVxuICB9KTtcbn1cbmZ1bmN0aW9uIGdldE9BdXRoMlRva2VucyhkYXRhKSB7XG4gIHJldHVybiB7XG4gICAgdG9rZW5UeXBlOiBkYXRhLnRva2VuX3R5cGUsXG4gICAgYWNjZXNzVG9rZW46IGRhdGEuYWNjZXNzX3Rva2VuLFxuICAgIHJlZnJlc2hUb2tlbjogZGF0YS5yZWZyZXNoX3Rva2VuLFxuICAgIGFjY2Vzc1Rva2VuRXhwaXJlc0F0OiBkYXRhLmV4cGlyZXNfaW4gPyBnZXREYXRlKGRhdGEuZXhwaXJlc19pbiwgXCJzZWNcIikgOiB2b2lkIDAsXG4gICAgcmVmcmVzaFRva2VuRXhwaXJlc0F0OiBkYXRhLnJlZnJlc2hfdG9rZW5fZXhwaXJlc19pbiA/IGdldERhdGUoZGF0YS5yZWZyZXNoX3Rva2VuX2V4cGlyZXNfaW4sIFwic2VjXCIpIDogdm9pZCAwLFxuICAgIHNjb3BlczogZGF0YT8uc2NvcGUgPyB0eXBlb2YgZGF0YS5zY29wZSA9PT0gXCJzdHJpbmdcIiA/IGRhdGEuc2NvcGUuc3BsaXQoXCIgXCIpIDogZGF0YS5zY29wZSA6IFtdLFxuICAgIGlkVG9rZW46IGRhdGEuaWRfdG9rZW5cbiAgfTtcbn1cbmNvbnN0IGVuY29kZU9BdXRoUGFyYW1ldGVyID0gKHZhbHVlKSA9PiBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpLnJlcGxhY2UoLyUyMC9nLCBcIitcIik7XG5mdW5jdGlvbiBkZWNyeXB0T0F1dGhUb2tlbih0b2tlbiwgY3R4KSB7XG4gIGlmICghdG9rZW4pIHJldHVybiB0b2tlbjtcbiAgaWYgKGN0eC5vcHRpb25zLmFjY291bnQ/LmVuY3J5cHRPQXV0aFRva2Vucykge1xuICAgIHJldHVybiBzeW1tZXRyaWNEZWNyeXB0KHtcbiAgICAgIGtleTogY3R4LnNlY3JldCxcbiAgICAgIGRhdGE6IHRva2VuXG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIHRva2VuO1xufVxuZnVuY3Rpb24gc2V0VG9rZW5VdGlsKHRva2VuLCBjdHgpIHtcbiAgaWYgKGN0eC5vcHRpb25zLmFjY291bnQ/LmVuY3J5cHRPQXV0aFRva2VucyAmJiB0b2tlbikge1xuICAgIHJldHVybiBzeW1tZXRyaWNFbmNyeXB0KHtcbiAgICAgIGtleTogY3R4LnNlY3JldCxcbiAgICAgIGRhdGE6IHRva2VuXG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIHRva2VuO1xufVxuXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVPQXV0aFVzZXJJbmZvKGMsIHtcbiAgdXNlckluZm8sXG4gIGFjY291bnQsXG4gIGNhbGxiYWNrVVJMLFxuICBkaXNhYmxlU2lnblVwLFxuICBvdmVycmlkZVVzZXJJbmZvXG59KSB7XG4gIGNvbnN0IGRiVXNlciA9IGF3YWl0IGMuY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZmluZE9BdXRoVXNlcihcbiAgICB1c2VySW5mby5lbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgIGFjY291bnQuYWNjb3VudElkLFxuICAgIGFjY291bnQucHJvdmlkZXJJZFxuICApLmNhdGNoKChlKSA9PiB7XG4gICAgbG9nZ2VyLmVycm9yKFxuICAgICAgXCJCZXR0ZXIgYXV0aCB3YXMgdW5hYmxlIHRvIHF1ZXJ5IHlvdXIgZGF0YWJhc2UuXFxuRXJyb3I6IFwiLFxuICAgICAgZVxuICAgICk7XG4gICAgY29uc3QgZXJyb3JVUkwgPSBjLmNvbnRleHQub3B0aW9ucy5vbkFQSUVycm9yPy5lcnJvclVSTCB8fCBgJHtjLmNvbnRleHQuYmFzZVVSTH0vZXJyb3JgO1xuICAgIHRocm93IGMucmVkaXJlY3QoYCR7ZXJyb3JVUkx9P2Vycm9yPWludGVybmFsX3NlcnZlcl9lcnJvcmApO1xuICB9KTtcbiAgbGV0IHVzZXIgPSBkYlVzZXI/LnVzZXI7XG4gIGxldCBpc1JlZ2lzdGVyID0gIXVzZXI7XG4gIGlmIChkYlVzZXIpIHtcbiAgICBjb25zdCBoYXNCZWVuTGlua2VkID0gZGJVc2VyLmFjY291bnRzLmZpbmQoXG4gICAgICAoYSkgPT4gYS5wcm92aWRlcklkID09PSBhY2NvdW50LnByb3ZpZGVySWQgJiYgYS5hY2NvdW50SWQgPT09IGFjY291bnQuYWNjb3VudElkXG4gICAgKTtcbiAgICBpZiAoIWhhc0JlZW5MaW5rZWQpIHtcbiAgICAgIGNvbnN0IHRydXN0ZWRQcm92aWRlcnMgPSBjLmNvbnRleHQub3B0aW9ucy5hY2NvdW50Py5hY2NvdW50TGlua2luZz8udHJ1c3RlZFByb3ZpZGVycztcbiAgICAgIGNvbnN0IGlzVHJ1c3RlZFByb3ZpZGVyID0gdHJ1c3RlZFByb3ZpZGVycz8uaW5jbHVkZXMoXG4gICAgICAgIGFjY291bnQucHJvdmlkZXJJZFxuICAgICAgKTtcbiAgICAgIGlmICghaXNUcnVzdGVkUHJvdmlkZXIgJiYgIXVzZXJJbmZvLmVtYWlsVmVyaWZpZWQgfHwgYy5jb250ZXh0Lm9wdGlvbnMuYWNjb3VudD8uYWNjb3VudExpbmtpbmc/LmVuYWJsZWQgPT09IGZhbHNlKSB7XG4gICAgICAgIGlmIChpc0RldmVsb3BtZW50KSB7XG4gICAgICAgICAgbG9nZ2VyLndhcm4oXG4gICAgICAgICAgICBgVXNlciBhbHJlYWR5IGV4aXN0IGJ1dCBhY2NvdW50IGlzbid0IGxpbmtlZCB0byAke2FjY291bnQucHJvdmlkZXJJZH0uIFRvIHJlYWQgbW9yZSBhYm91dCBob3cgYWNjb3VudCBsaW5raW5nIHdvcmtzIGluIEJldHRlciBBdXRoIHNlZSBodHRwczovL3d3dy5iZXR0ZXItYXV0aC5jb20vZG9jcy9jb25jZXB0cy91c2Vycy1hY2NvdW50cyNhY2NvdW50LWxpbmtpbmcuYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBlcnJvcjogXCJhY2NvdW50IG5vdCBsaW5rZWRcIixcbiAgICAgICAgICBkYXRhOiBudWxsXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBjLmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmxpbmtBY2NvdW50KFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHByb3ZpZGVySWQ6IGFjY291bnQucHJvdmlkZXJJZCxcbiAgICAgICAgICAgIGFjY291bnRJZDogdXNlckluZm8uaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIHVzZXJJZDogZGJVc2VyLnVzZXIuaWQsXG4gICAgICAgICAgICBhY2Nlc3NUb2tlbjogYXdhaXQgc2V0VG9rZW5VdGlsKGFjY291bnQuYWNjZXNzVG9rZW4sIGMuY29udGV4dCksXG4gICAgICAgICAgICByZWZyZXNoVG9rZW46IGF3YWl0IHNldFRva2VuVXRpbChhY2NvdW50LnJlZnJlc2hUb2tlbiwgYy5jb250ZXh0KSxcbiAgICAgICAgICAgIGlkVG9rZW46IGFjY291bnQuaWRUb2tlbixcbiAgICAgICAgICAgIGFjY2Vzc1Rva2VuRXhwaXJlc0F0OiBhY2NvdW50LmFjY2Vzc1Rva2VuRXhwaXJlc0F0LFxuICAgICAgICAgICAgcmVmcmVzaFRva2VuRXhwaXJlc0F0OiBhY2NvdW50LnJlZnJlc2hUb2tlbkV4cGlyZXNBdCxcbiAgICAgICAgICAgIHNjb3BlOiBhY2NvdW50LnNjb3BlXG4gICAgICAgICAgfSxcbiAgICAgICAgICBjXG4gICAgICAgICk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcihcIlVuYWJsZSB0byBsaW5rIGFjY291bnRcIiwgZSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZXJyb3I6IFwidW5hYmxlIHRvIGxpbmsgYWNjb3VudFwiLFxuICAgICAgICAgIGRhdGE6IG51bGxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGMuY29udGV4dC5vcHRpb25zLmFjY291bnQ/LnVwZGF0ZUFjY291bnRPblNpZ25JbiAhPT0gZmFsc2UpIHtcbiAgICAgICAgY29uc3QgdXBkYXRlRGF0YSA9IE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgICBPYmplY3QuZW50cmllcyh7XG4gICAgICAgICAgICBpZFRva2VuOiBhY2NvdW50LmlkVG9rZW4sXG4gICAgICAgICAgICBhY2Nlc3NUb2tlbjogYXdhaXQgc2V0VG9rZW5VdGlsKGFjY291bnQuYWNjZXNzVG9rZW4sIGMuY29udGV4dCksXG4gICAgICAgICAgICByZWZyZXNoVG9rZW46IGF3YWl0IHNldFRva2VuVXRpbChhY2NvdW50LnJlZnJlc2hUb2tlbiwgYy5jb250ZXh0KSxcbiAgICAgICAgICAgIGFjY2Vzc1Rva2VuRXhwaXJlc0F0OiBhY2NvdW50LmFjY2Vzc1Rva2VuRXhwaXJlc0F0LFxuICAgICAgICAgICAgcmVmcmVzaFRva2VuRXhwaXJlc0F0OiBhY2NvdW50LnJlZnJlc2hUb2tlbkV4cGlyZXNBdCxcbiAgICAgICAgICAgIHNjb3BlOiBhY2NvdW50LnNjb3BlXG4gICAgICAgICAgfSkuZmlsdGVyKChbXywgdmFsdWVdKSA9PiB2YWx1ZSAhPT0gdm9pZCAwKVxuICAgICAgICApO1xuICAgICAgICBpZiAoT2JqZWN0LmtleXModXBkYXRlRGF0YSkubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGF3YWl0IGMuY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIudXBkYXRlQWNjb3VudChcbiAgICAgICAgICAgIGhhc0JlZW5MaW5rZWQuaWQsXG4gICAgICAgICAgICB1cGRhdGVEYXRhLFxuICAgICAgICAgICAgY1xuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKG92ZXJyaWRlVXNlckluZm8pIHtcbiAgICAgIGNvbnN0IHsgaWQ6IF8sIC4uLnJlc3RVc2VySW5mbyB9ID0gdXNlckluZm87XG4gICAgICBhd2FpdCBjLmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLnVwZGF0ZVVzZXIoZGJVc2VyLnVzZXIuaWQsIHtcbiAgICAgICAgLi4ucmVzdFVzZXJJbmZvLFxuICAgICAgICBlbWFpbDogdXNlckluZm8uZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgZW1haWxWZXJpZmllZDogdXNlckluZm8uZW1haWwudG9Mb3dlckNhc2UoKSA9PT0gZGJVc2VyLnVzZXIuZW1haWwgPyBkYlVzZXIudXNlci5lbWFpbFZlcmlmaWVkIHx8IHVzZXJJbmZvLmVtYWlsVmVyaWZpZWQgOiB1c2VySW5mby5lbWFpbFZlcmlmaWVkXG4gICAgICB9KTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgaWYgKGRpc2FibGVTaWduVXApIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGVycm9yOiBcInNpZ251cCBkaXNhYmxlZFwiLFxuICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICBpc1JlZ2lzdGVyOiBmYWxzZVxuICAgICAgfTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgaWQ6IF8sIC4uLnJlc3RVc2VySW5mbyB9ID0gdXNlckluZm87XG4gICAgICB1c2VyID0gYXdhaXQgYy5jb250ZXh0LmludGVybmFsQWRhcHRlci5jcmVhdGVPQXV0aFVzZXIoXG4gICAgICAgIHtcbiAgICAgICAgICAuLi5yZXN0VXNlckluZm8sXG4gICAgICAgICAgZW1haWw6IHVzZXJJbmZvLmVtYWlsLnRvTG93ZXJDYXNlKClcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGFjY2Vzc1Rva2VuOiBhd2FpdCBzZXRUb2tlblV0aWwoYWNjb3VudC5hY2Nlc3NUb2tlbiwgYy5jb250ZXh0KSxcbiAgICAgICAgICByZWZyZXNoVG9rZW46IGF3YWl0IHNldFRva2VuVXRpbChhY2NvdW50LnJlZnJlc2hUb2tlbiwgYy5jb250ZXh0KSxcbiAgICAgICAgICBpZFRva2VuOiBhY2NvdW50LmlkVG9rZW4sXG4gICAgICAgICAgYWNjZXNzVG9rZW5FeHBpcmVzQXQ6IGFjY291bnQuYWNjZXNzVG9rZW5FeHBpcmVzQXQsXG4gICAgICAgICAgcmVmcmVzaFRva2VuRXhwaXJlc0F0OiBhY2NvdW50LnJlZnJlc2hUb2tlbkV4cGlyZXNBdCxcbiAgICAgICAgICBzY29wZTogYWNjb3VudC5zY29wZSxcbiAgICAgICAgICBwcm92aWRlcklkOiBhY2NvdW50LnByb3ZpZGVySWQsXG4gICAgICAgICAgYWNjb3VudElkOiB1c2VySW5mby5pZC50b1N0cmluZygpXG4gICAgICAgIH0sXG4gICAgICAgIGNcbiAgICAgICkudGhlbigocmVzKSA9PiByZXM/LnVzZXIpO1xuICAgICAgaWYgKCF1c2VySW5mby5lbWFpbFZlcmlmaWVkICYmIHVzZXIgJiYgYy5jb250ZXh0Lm9wdGlvbnMuZW1haWxWZXJpZmljYXRpb24/LnNlbmRPblNpZ25VcCkge1xuICAgICAgICBjb25zdCB0b2tlbiA9IGF3YWl0IGNyZWF0ZUVtYWlsVmVyaWZpY2F0aW9uVG9rZW4oXG4gICAgICAgICAgYy5jb250ZXh0LnNlY3JldCxcbiAgICAgICAgICB1c2VyLmVtYWlsLFxuICAgICAgICAgIHZvaWQgMCxcbiAgICAgICAgICBjLmNvbnRleHQub3B0aW9ucy5lbWFpbFZlcmlmaWNhdGlvbj8uZXhwaXJlc0luXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IHVybCA9IGAke2MuY29udGV4dC5iYXNlVVJMfS92ZXJpZnktZW1haWw/dG9rZW49JHt0b2tlbn0mY2FsbGJhY2tVUkw9JHtjYWxsYmFja1VSTH1gO1xuICAgICAgICBhd2FpdCBjLmNvbnRleHQub3B0aW9ucy5lbWFpbFZlcmlmaWNhdGlvbj8uc2VuZFZlcmlmaWNhdGlvbkVtYWlsPy4oXG4gICAgICAgICAge1xuICAgICAgICAgICAgdXNlcixcbiAgICAgICAgICAgIHVybCxcbiAgICAgICAgICAgIHRva2VuXG4gICAgICAgICAgfSxcbiAgICAgICAgICBjLnJlcXVlc3RcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoZSk7XG4gICAgICBpZiAoZSBpbnN0YW5jZW9mIEFQSUVycm9yKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZXJyb3I6IGUubWVzc2FnZSxcbiAgICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICAgIGlzUmVnaXN0ZXI6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICBlcnJvcjogXCJ1bmFibGUgdG8gY3JlYXRlIHVzZXJcIixcbiAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgICAgaXNSZWdpc3RlcjogZmFsc2VcbiAgICAgIH07XG4gICAgfVxuICB9XG4gIGlmICghdXNlcikge1xuICAgIHJldHVybiB7XG4gICAgICBlcnJvcjogXCJ1bmFibGUgdG8gY3JlYXRlIHVzZXJcIixcbiAgICAgIGRhdGE6IG51bGwsXG4gICAgICBpc1JlZ2lzdGVyOiBmYWxzZVxuICAgIH07XG4gIH1cbiAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGMuY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuY3JlYXRlU2Vzc2lvbih1c2VyLmlkLCBjKTtcbiAgaWYgKCFzZXNzaW9uKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGVycm9yOiBcInVuYWJsZSB0byBjcmVhdGUgc2Vzc2lvblwiLFxuICAgICAgZGF0YTogbnVsbCxcbiAgICAgIGlzUmVnaXN0ZXI6IGZhbHNlXG4gICAgfTtcbiAgfVxuICByZXR1cm4ge1xuICAgIGRhdGE6IHtcbiAgICAgIHNlc3Npb24sXG4gICAgICB1c2VyXG4gICAgfSxcbiAgICBlcnJvcjogbnVsbCxcbiAgICBpc1JlZ2lzdGVyXG4gIH07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoe1xuICBpZCxcbiAgb3B0aW9ucyxcbiAgYXV0aG9yaXphdGlvbkVuZHBvaW50LFxuICBzdGF0ZSxcbiAgY29kZVZlcmlmaWVyLFxuICBzY29wZXMsXG4gIGNsYWltcyxcbiAgcmVkaXJlY3RVUkksXG4gIGR1cmF0aW9uLFxuICBwcm9tcHQsXG4gIGFjY2Vzc1R5cGUsXG4gIHJlc3BvbnNlVHlwZSxcbiAgZGlzcGxheSxcbiAgbG9naW5IaW50LFxuICBoZCxcbiAgcmVzcG9uc2VNb2RlLFxuICBhZGRpdGlvbmFsUGFyYW1zLFxuICBzY29wZUpvaW5lclxufSkge1xuICBjb25zdCB1cmwgPSBuZXcgVVJMKGF1dGhvcml6YXRpb25FbmRwb2ludCk7XG4gIHVybC5zZWFyY2hQYXJhbXMuc2V0KFwicmVzcG9uc2VfdHlwZVwiLCByZXNwb25zZVR5cGUgfHwgXCJjb2RlXCIpO1xuICB1cmwuc2VhcmNoUGFyYW1zLnNldChcImNsaWVudF9pZFwiLCBvcHRpb25zLmNsaWVudElkKTtcbiAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJzdGF0ZVwiLCBzdGF0ZSk7XG4gIHVybC5zZWFyY2hQYXJhbXMuc2V0KFwic2NvcGVcIiwgc2NvcGVzLmpvaW4oc2NvcGVKb2luZXIgfHwgXCIgXCIpKTtcbiAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJyZWRpcmVjdF91cmlcIiwgb3B0aW9ucy5yZWRpcmVjdFVSSSB8fCByZWRpcmVjdFVSSSk7XG4gIGR1cmF0aW9uICYmIHVybC5zZWFyY2hQYXJhbXMuc2V0KFwiZHVyYXRpb25cIiwgZHVyYXRpb24pO1xuICBkaXNwbGF5ICYmIHVybC5zZWFyY2hQYXJhbXMuc2V0KFwiZGlzcGxheVwiLCBkaXNwbGF5KTtcbiAgbG9naW5IaW50ICYmIHVybC5zZWFyY2hQYXJhbXMuc2V0KFwibG9naW5faGludFwiLCBsb2dpbkhpbnQpO1xuICBwcm9tcHQgJiYgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJwcm9tcHRcIiwgcHJvbXB0KTtcbiAgaGQgJiYgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJoZFwiLCBoZCk7XG4gIGFjY2Vzc1R5cGUgJiYgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJhY2Nlc3NfdHlwZVwiLCBhY2Nlc3NUeXBlKTtcbiAgcmVzcG9uc2VNb2RlICYmIHVybC5zZWFyY2hQYXJhbXMuc2V0KFwicmVzcG9uc2VfbW9kZVwiLCByZXNwb25zZU1vZGUpO1xuICBpZiAoY29kZVZlcmlmaWVyKSB7XG4gICAgY29uc3QgY29kZUNoYWxsZW5nZSA9IGF3YWl0IGdlbmVyYXRlQ29kZUNoYWxsZW5nZShjb2RlVmVyaWZpZXIpO1xuICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KFwiY29kZV9jaGFsbGVuZ2VfbWV0aG9kXCIsIFwiUzI1NlwiKTtcbiAgICB1cmwuc2VhcmNoUGFyYW1zLnNldChcImNvZGVfY2hhbGxlbmdlXCIsIGNvZGVDaGFsbGVuZ2UpO1xuICB9XG4gIGlmIChjbGFpbXMpIHtcbiAgICBjb25zdCBjbGFpbXNPYmogPSBjbGFpbXMucmVkdWNlKFxuICAgICAgKGFjYywgY2xhaW0pID0+IHtcbiAgICAgICAgYWNjW2NsYWltXSA9IG51bGw7XG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgICB9LFxuICAgICAge31cbiAgICApO1xuICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KFxuICAgICAgXCJjbGFpbXNcIixcbiAgICAgIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgaWRfdG9rZW46IHsgZW1haWw6IG51bGwsIGVtYWlsX3ZlcmlmaWVkOiBudWxsLCAuLi5jbGFpbXNPYmogfVxuICAgICAgfSlcbiAgICApO1xuICB9XG4gIGlmIChhZGRpdGlvbmFsUGFyYW1zKSB7XG4gICAgT2JqZWN0LmVudHJpZXMoYWRkaXRpb25hbFBhcmFtcykuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICB1cmwuc2VhcmNoUGFyYW1zLnNldChrZXksIHZhbHVlKTtcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gdXJsO1xufVxuXG5hc3luYyBmdW5jdGlvbiB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlKHtcbiAgY29kZSxcbiAgY29kZVZlcmlmaWVyLFxuICByZWRpcmVjdFVSSSxcbiAgb3B0aW9ucyxcbiAgdG9rZW5FbmRwb2ludCxcbiAgYXV0aGVudGljYXRpb24sXG4gIGRldmljZUlkLFxuICBoZWFkZXJzLFxuICBhZGRpdGlvbmFsUGFyYW1zID0ge31cbn0pIHtcbiAgY29uc3QgYm9keSA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTtcbiAgY29uc3QgcmVxdWVzdEhlYWRlcnMgPSB7XG4gICAgXCJjb250ZW50LXR5cGVcIjogXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIixcbiAgICBhY2NlcHQ6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgIFwidXNlci1hZ2VudFwiOiBcImJldHRlci1hdXRoXCIsXG4gICAgLi4uaGVhZGVyc1xuICB9O1xuICBib2R5LnNldChcImdyYW50X3R5cGVcIiwgXCJhdXRob3JpemF0aW9uX2NvZGVcIik7XG4gIGJvZHkuc2V0KFwiY29kZVwiLCBjb2RlKTtcbiAgY29kZVZlcmlmaWVyICYmIGJvZHkuc2V0KFwiY29kZV92ZXJpZmllclwiLCBjb2RlVmVyaWZpZXIpO1xuICBvcHRpb25zLmNsaWVudEtleSAmJiBib2R5LnNldChcImNsaWVudF9rZXlcIiwgb3B0aW9ucy5jbGllbnRLZXkpO1xuICBkZXZpY2VJZCAmJiBib2R5LnNldChcImRldmljZV9pZFwiLCBkZXZpY2VJZCk7XG4gIGJvZHkuc2V0KFwicmVkaXJlY3RfdXJpXCIsIG9wdGlvbnMucmVkaXJlY3RVUkkgfHwgcmVkaXJlY3RVUkkpO1xuICBib2R5LnNldChcImNsaWVudF9pZFwiLCBvcHRpb25zLmNsaWVudElkKTtcbiAgaWYgKGF1dGhlbnRpY2F0aW9uID09PSBcImJhc2ljXCIpIHtcbiAgICBjb25zdCBlbmNvZGVkQ3JlZGVudGlhbHMgPSBiYXNlNjQuZW5jb2RlKFxuICAgICAgYCR7b3B0aW9ucy5jbGllbnRJZH06JHtvcHRpb25zLmNsaWVudFNlY3JldH1gXG4gICAgKTtcbiAgICByZXF1ZXN0SGVhZGVyc1tcImF1dGhvcml6YXRpb25cIl0gPSBgQmFzaWMgJHtlbmNvZGVkQ3JlZGVudGlhbHN9YDtcbiAgfSBlbHNlIHtcbiAgICBib2R5LnNldChcImNsaWVudF9zZWNyZXRcIiwgb3B0aW9ucy5jbGllbnRTZWNyZXQpO1xuICB9XG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGFkZGl0aW9uYWxQYXJhbXMpKSB7XG4gICAgaWYgKCFib2R5LmhhcyhrZXkpKSBib2R5LmFwcGVuZChrZXksIHZhbHVlKTtcbiAgfVxuICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBiZXR0ZXJGZXRjaCh0b2tlbkVuZHBvaW50LCB7XG4gICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICBib2R5LFxuICAgIGhlYWRlcnM6IHJlcXVlc3RIZWFkZXJzXG4gIH0pO1xuICBpZiAoZXJyb3IpIHtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxuICBjb25zdCB0b2tlbnMgPSBnZXRPQXV0aDJUb2tlbnMoZGF0YSk7XG4gIHJldHVybiB0b2tlbnM7XG59XG5hc3luYyBmdW5jdGlvbiB2YWxpZGF0ZVRva2VuKHRva2VuLCBqd2tzRW5kcG9pbnQpIHtcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgYmV0dGVyRmV0Y2goandrc0VuZHBvaW50LCB7XG4gICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgIGhlYWRlcnM6IHtcbiAgICAgIGFjY2VwdDogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICBcInVzZXItYWdlbnRcIjogXCJiZXR0ZXItYXV0aFwiXG4gICAgfVxuICB9KTtcbiAgaWYgKGVycm9yKSB7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbiAgY29uc3Qga2V5cyA9IGRhdGFbXCJrZXlzXCJdO1xuICBjb25zdCBoZWFkZXIgPSBKU09OLnBhcnNlKGF0b2IodG9rZW4uc3BsaXQoXCIuXCIpWzBdKSk7XG4gIGNvbnN0IGtleSA9IGtleXMuZmluZCgoa2V5MikgPT4ga2V5Mi5raWQgPT09IGhlYWRlci5raWQpO1xuICBpZiAoIWtleSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIktleSBub3QgZm91bmRcIik7XG4gIH1cbiAgY29uc3QgdmVyaWZpZWQgPSBhd2FpdCBqd3RWZXJpZnkodG9rZW4sIGtleSk7XG4gIHJldHVybiB2ZXJpZmllZDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gcmVmcmVzaEFjY2Vzc1Rva2VuKHtcbiAgcmVmcmVzaFRva2VuLFxuICBvcHRpb25zLFxuICB0b2tlbkVuZHBvaW50LFxuICBhdXRoZW50aWNhdGlvbixcbiAgZXh0cmFQYXJhbXMsXG4gIGdyYW50VHlwZSA9IFwicmVmcmVzaF90b2tlblwiXG59KSB7XG4gIGNvbnN0IGJvZHkgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XG4gIGNvbnN0IGhlYWRlcnMgPSB7XG4gICAgXCJjb250ZW50LXR5cGVcIjogXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIixcbiAgICBhY2NlcHQ6IFwiYXBwbGljYXRpb24vanNvblwiXG4gIH07XG4gIGJvZHkuc2V0KFwiZ3JhbnRfdHlwZVwiLCBncmFudFR5cGUpO1xuICBib2R5LnNldChcInJlZnJlc2hfdG9rZW5cIiwgcmVmcmVzaFRva2VuKTtcbiAgaWYgKGF1dGhlbnRpY2F0aW9uID09PSBcImJhc2ljXCIpIHtcbiAgICBoZWFkZXJzW1wiYXV0aG9yaXphdGlvblwiXSA9IGJhc2U2NC5lbmNvZGUoXG4gICAgICBgJHtvcHRpb25zLmNsaWVudElkfToke29wdGlvbnMuY2xpZW50U2VjcmV0fWBcbiAgICApO1xuICB9IGVsc2Uge1xuICAgIGJvZHkuc2V0KFwiY2xpZW50X2lkXCIsIG9wdGlvbnMuY2xpZW50SWQpO1xuICAgIGJvZHkuc2V0KFwiY2xpZW50X3NlY3JldFwiLCBvcHRpb25zLmNsaWVudFNlY3JldCk7XG4gIH1cbiAgaWYgKGV4dHJhUGFyYW1zKSB7XG4gICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoZXh0cmFQYXJhbXMpKSB7XG4gICAgICBib2R5LnNldChrZXksIHZhbHVlKTtcbiAgICB9XG4gIH1cbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgYmV0dGVyRmV0Y2godG9rZW5FbmRwb2ludCwge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgYm9keSxcbiAgICBoZWFkZXJzXG4gIH0pO1xuICBpZiAoZXJyb3IpIHtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxuICBjb25zdCB0b2tlbnMgPSB7XG4gICAgYWNjZXNzVG9rZW46IGRhdGEuYWNjZXNzX3Rva2VuLFxuICAgIHJlZnJlc2hUb2tlbjogZGF0YS5yZWZyZXNoX3Rva2VuLFxuICAgIHRva2VuVHlwZTogZGF0YS50b2tlbl90eXBlLFxuICAgIHNjb3BlczogZGF0YS5zY29wZT8uc3BsaXQoXCIgXCIpLFxuICAgIGlkVG9rZW46IGRhdGEuaWRfdG9rZW5cbiAgfTtcbiAgaWYgKGRhdGEuZXhwaXJlc19pbikge1xuICAgIGNvbnN0IG5vdyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpO1xuICAgIHRva2Vucy5hY2Nlc3NUb2tlbkV4cGlyZXNBdCA9IG5ldyBEYXRlKFxuICAgICAgbm93LmdldFRpbWUoKSArIGRhdGEuZXhwaXJlc19pbiAqIDFlM1xuICAgICk7XG4gIH1cbiAgcmV0dXJuIHRva2Vucztcbn1cblxuY29uc3QgYXBwbGUgPSAob3B0aW9ucykgPT4ge1xuICBjb25zdCB0b2tlbkVuZHBvaW50ID0gXCJodHRwczovL2FwcGxlaWQuYXBwbGUuY29tL2F1dGgvdG9rZW5cIjtcbiAgcmV0dXJuIHtcbiAgICBpZDogXCJhcHBsZVwiLFxuICAgIG5hbWU6IFwiQXBwbGVcIixcbiAgICBhc3luYyBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHsgc3RhdGUsIHNjb3BlcywgcmVkaXJlY3RVUkkgfSkge1xuICAgICAgY29uc3QgX3Njb3BlID0gb3B0aW9ucy5kaXNhYmxlRGVmYXVsdFNjb3BlID8gW10gOiBbXCJlbWFpbFwiLCBcIm5hbWVcIl07XG4gICAgICBvcHRpb25zLnNjb3BlICYmIF9zY29wZS5wdXNoKC4uLm9wdGlvbnMuc2NvcGUpO1xuICAgICAgc2NvcGVzICYmIF9zY29wZS5wdXNoKC4uLnNjb3Blcyk7XG4gICAgICBjb25zdCB1cmwgPSBhd2FpdCBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHtcbiAgICAgICAgaWQ6IFwiYXBwbGVcIixcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgYXV0aG9yaXphdGlvbkVuZHBvaW50OiBcImh0dHBzOi8vYXBwbGVpZC5hcHBsZS5jb20vYXV0aC9hdXRob3JpemVcIixcbiAgICAgICAgc2NvcGVzOiBfc2NvcGUsXG4gICAgICAgIHN0YXRlLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgcmVzcG9uc2VNb2RlOiBcImZvcm1fcG9zdFwiLFxuICAgICAgICByZXNwb25zZVR5cGU6IFwiY29kZSBpZF90b2tlblwiXG4gICAgICB9KTtcbiAgICAgIHJldHVybiB1cmw7XG4gICAgfSxcbiAgICB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlOiBhc3luYyAoeyBjb2RlLCBjb2RlVmVyaWZpZXIsIHJlZGlyZWN0VVJJIH0pID0+IHtcbiAgICAgIHJldHVybiB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlKHtcbiAgICAgICAgY29kZSxcbiAgICAgICAgY29kZVZlcmlmaWVyLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgdG9rZW5FbmRwb2ludFxuICAgICAgfSk7XG4gICAgfSxcbiAgICBhc3luYyB2ZXJpZnlJZFRva2VuKHRva2VuLCBub25jZSkge1xuICAgICAgaWYgKG9wdGlvbnMuZGlzYWJsZUlkVG9rZW5TaWduSW4pIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMudmVyaWZ5SWRUb2tlbikge1xuICAgICAgICByZXR1cm4gb3B0aW9ucy52ZXJpZnlJZFRva2VuKHRva2VuLCBub25jZSk7XG4gICAgICB9XG4gICAgICBjb25zdCBkZWNvZGVkSGVhZGVyID0gZGVjb2RlUHJvdGVjdGVkSGVhZGVyKHRva2VuKTtcbiAgICAgIGNvbnN0IHsga2lkLCBhbGc6IGp3dEFsZyB9ID0gZGVjb2RlZEhlYWRlcjtcbiAgICAgIGlmICgha2lkIHx8ICFqd3RBbGcpIHJldHVybiBmYWxzZTtcbiAgICAgIGNvbnN0IHB1YmxpY0tleSA9IGF3YWl0IGdldEFwcGxlUHVibGljS2V5KGtpZCk7XG4gICAgICBjb25zdCB7IHBheWxvYWQ6IGp3dENsYWltcyB9ID0gYXdhaXQgand0VmVyaWZ5KHRva2VuLCBwdWJsaWNLZXksIHtcbiAgICAgICAgYWxnb3JpdGhtczogW2p3dEFsZ10sXG4gICAgICAgIGlzc3VlcjogXCJodHRwczovL2FwcGxlaWQuYXBwbGUuY29tXCIsXG4gICAgICAgIGF1ZGllbmNlOiBvcHRpb25zLmFwcEJ1bmRsZUlkZW50aWZpZXIgfHwgb3B0aW9ucy5jbGllbnRJZCxcbiAgICAgICAgbWF4VG9rZW5BZ2U6IFwiMWhcIlxuICAgICAgfSk7XG4gICAgICBbXCJlbWFpbF92ZXJpZmllZFwiLCBcImlzX3ByaXZhdGVfZW1haWxcIl0uZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgICAgaWYgKGp3dENsYWltc1tmaWVsZF0gIT09IHZvaWQgMCkge1xuICAgICAgICAgIGp3dENsYWltc1tmaWVsZF0gPSBCb29sZWFuKGp3dENsYWltc1tmaWVsZF0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGlmIChub25jZSAmJiBqd3RDbGFpbXMubm9uY2UgIT09IG5vbmNlKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAhIWp3dENsYWltcztcbiAgICB9LFxuICAgIHJlZnJlc2hBY2Nlc3NUb2tlbjogb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gPyBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA6IGFzeW5jIChyZWZyZXNoVG9rZW4pID0+IHtcbiAgICAgIHJldHVybiByZWZyZXNoQWNjZXNzVG9rZW4oe1xuICAgICAgICByZWZyZXNoVG9rZW4sXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICBjbGllbnRJZDogb3B0aW9ucy5jbGllbnRJZCxcbiAgICAgICAgICBjbGllbnRLZXk6IG9wdGlvbnMuY2xpZW50S2V5LFxuICAgICAgICAgIGNsaWVudFNlY3JldDogb3B0aW9ucy5jbGllbnRTZWNyZXRcbiAgICAgICAgfSxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL2FwcGxlaWQuYXBwbGUuY29tL2F1dGgvdG9rZW5cIlxuICAgICAgfSk7XG4gICAgfSxcbiAgICBhc3luYyBnZXRVc2VySW5mbyh0b2tlbikge1xuICAgICAgaWYgKG9wdGlvbnMuZ2V0VXNlckluZm8pIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMuZ2V0VXNlckluZm8odG9rZW4pO1xuICAgICAgfVxuICAgICAgaWYgKCF0b2tlbi5pZFRva2VuKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgcHJvZmlsZSA9IGRlY29kZUp3dCh0b2tlbi5pZFRva2VuKTtcbiAgICAgIGlmICghcHJvZmlsZSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IG5hbWUgPSB0b2tlbi51c2VyID8gYCR7dG9rZW4udXNlci5uYW1lPy5maXJzdE5hbWV9ICR7dG9rZW4udXNlci5uYW1lPy5sYXN0TmFtZX1gIDogcHJvZmlsZS5uYW1lIHx8IHByb2ZpbGUuZW1haWw7XG4gICAgICBjb25zdCBlbWFpbFZlcmlmaWVkID0gdHlwZW9mIHByb2ZpbGUuZW1haWxfdmVyaWZpZWQgPT09IFwiYm9vbGVhblwiID8gcHJvZmlsZS5lbWFpbF92ZXJpZmllZCA6IHByb2ZpbGUuZW1haWxfdmVyaWZpZWQgPT09IFwidHJ1ZVwiO1xuICAgICAgY29uc3QgdXNlck1hcCA9IGF3YWl0IG9wdGlvbnMubWFwUHJvZmlsZVRvVXNlcj8uKHByb2ZpbGUpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGlkOiBwcm9maWxlLnN1YixcbiAgICAgICAgICBuYW1lLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQsXG4gICAgICAgICAgZW1haWw6IHByb2ZpbGUuZW1haWwsXG4gICAgICAgICAgLi4udXNlck1hcFxuICAgICAgICB9LFxuICAgICAgICBkYXRhOiBwcm9maWxlXG4gICAgICB9O1xuICAgIH0sXG4gICAgb3B0aW9uc1xuICB9O1xufTtcbmNvbnN0IGdldEFwcGxlUHVibGljS2V5ID0gYXN5bmMgKGtpZCkgPT4ge1xuICBjb25zdCBBUFBMRV9CQVNFX1VSTCA9IFwiaHR0cHM6Ly9hcHBsZWlkLmFwcGxlLmNvbVwiO1xuICBjb25zdCBKV0tTX0FQUExFX1VSSSA9IFwiL2F1dGgva2V5c1wiO1xuICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGJldHRlckZldGNoKGAke0FQUExFX0JBU0VfVVJMfSR7SldLU19BUFBMRV9VUkl9YCk7XG4gIGlmICghZGF0YT8ua2V5cykge1xuICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgIG1lc3NhZ2U6IFwiS2V5cyBub3QgZm91bmRcIlxuICAgIH0pO1xuICB9XG4gIGNvbnN0IGp3ayA9IGRhdGEua2V5cy5maW5kKChrZXkpID0+IGtleS5raWQgPT09IGtpZCk7XG4gIGlmICghandrKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBKV0sgd2l0aCBraWQgJHtraWR9IG5vdCBmb3VuZGApO1xuICB9XG4gIHJldHVybiBhd2FpdCBpbXBvcnRKV0soandrLCBqd2suYWxnKTtcbn07XG5cbmNvbnN0IGRpc2NvcmQgPSAob3B0aW9ucykgPT4ge1xuICByZXR1cm4ge1xuICAgIGlkOiBcImRpc2NvcmRcIixcbiAgICBuYW1lOiBcIkRpc2NvcmRcIixcbiAgICBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHsgc3RhdGUsIHNjb3BlcywgcmVkaXJlY3RVUkkgfSkge1xuICAgICAgY29uc3QgX3Njb3BlcyA9IG9wdGlvbnMuZGlzYWJsZURlZmF1bHRTY29wZSA/IFtdIDogW1wiaWRlbnRpZnlcIiwgXCJlbWFpbFwiXTtcbiAgICAgIHNjb3BlcyAmJiBfc2NvcGVzLnB1c2goLi4uc2NvcGVzKTtcbiAgICAgIG9wdGlvbnMuc2NvcGUgJiYgX3Njb3Blcy5wdXNoKC4uLm9wdGlvbnMuc2NvcGUpO1xuICAgICAgcmV0dXJuIG5ldyBVUkwoXG4gICAgICAgIGBodHRwczovL2Rpc2NvcmQuY29tL2FwaS9vYXV0aDIvYXV0aG9yaXplP3Njb3BlPSR7X3Njb3Blcy5qb2luKFxuICAgICAgICAgIFwiK1wiXG4gICAgICAgICl9JnJlc3BvbnNlX3R5cGU9Y29kZSZjbGllbnRfaWQ9JHtvcHRpb25zLmNsaWVudElkfSZyZWRpcmVjdF91cmk9JHtlbmNvZGVVUklDb21wb25lbnQoXG4gICAgICAgICAgb3B0aW9ucy5yZWRpcmVjdFVSSSB8fCByZWRpcmVjdFVSSVxuICAgICAgICApfSZzdGF0ZT0ke3N0YXRlfSZwcm9tcHQ9JHtvcHRpb25zLnByb21wdCB8fCBcIm5vbmVcIn1gXG4gICAgICApO1xuICAgIH0sXG4gICAgdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZTogYXN5bmMgKHsgY29kZSwgcmVkaXJlY3RVUkkgfSkgPT4ge1xuICAgICAgcmV0dXJuIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGUoe1xuICAgICAgICBjb2RlLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL2Rpc2NvcmQuY29tL2FwaS9vYXV0aDIvdG9rZW5cIlxuICAgICAgfSk7XG4gICAgfSxcbiAgICByZWZyZXNoQWNjZXNzVG9rZW46IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuID8gb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gOiBhc3luYyAocmVmcmVzaFRva2VuKSA9PiB7XG4gICAgICByZXR1cm4gcmVmcmVzaEFjY2Vzc1Rva2VuKHtcbiAgICAgICAgcmVmcmVzaFRva2VuLFxuICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgY2xpZW50SWQ6IG9wdGlvbnMuY2xpZW50SWQsXG4gICAgICAgICAgY2xpZW50S2V5OiBvcHRpb25zLmNsaWVudEtleSxcbiAgICAgICAgICBjbGllbnRTZWNyZXQ6IG9wdGlvbnMuY2xpZW50U2VjcmV0XG4gICAgICAgIH0sXG4gICAgICAgIHRva2VuRW5kcG9pbnQ6IFwiaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvb2F1dGgyL3Rva2VuXCJcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgYXN5bmMgZ2V0VXNlckluZm8odG9rZW4pIHtcbiAgICAgIGlmIChvcHRpb25zLmdldFVzZXJJbmZvKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLmdldFVzZXJJbmZvKHRva2VuKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgZGF0YTogcHJvZmlsZSwgZXJyb3IgfSA9IGF3YWl0IGJldHRlckZldGNoKFxuICAgICAgICBcImh0dHBzOi8vZGlzY29yZC5jb20vYXBpL3VzZXJzL0BtZVwiLFxuICAgICAgICB7XG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgYXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VuLmFjY2Vzc1Rva2VufWBcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICBpZiAocHJvZmlsZS5hdmF0YXIgPT09IG51bGwpIHtcbiAgICAgICAgY29uc3QgZGVmYXVsdEF2YXRhck51bWJlciA9IHByb2ZpbGUuZGlzY3JpbWluYXRvciA9PT0gXCIwXCIgPyBOdW1iZXIoQmlnSW50KHByb2ZpbGUuaWQpID4+IEJpZ0ludCgyMikpICUgNiA6IHBhcnNlSW50KHByb2ZpbGUuZGlzY3JpbWluYXRvcikgJSA1O1xuICAgICAgICBwcm9maWxlLmltYWdlX3VybCA9IGBodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9lbWJlZC9hdmF0YXJzLyR7ZGVmYXVsdEF2YXRhck51bWJlcn0ucG5nYDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGZvcm1hdCA9IHByb2ZpbGUuYXZhdGFyLnN0YXJ0c1dpdGgoXCJhX1wiKSA/IFwiZ2lmXCIgOiBcInBuZ1wiO1xuICAgICAgICBwcm9maWxlLmltYWdlX3VybCA9IGBodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdmF0YXJzLyR7cHJvZmlsZS5pZH0vJHtwcm9maWxlLmF2YXRhcn0uJHtmb3JtYXR9YDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHVzZXJNYXAgPSBhd2FpdCBvcHRpb25zLm1hcFByb2ZpbGVUb1VzZXI/Lihwcm9maWxlKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogcHJvZmlsZS5pZCxcbiAgICAgICAgICBuYW1lOiBwcm9maWxlLmdsb2JhbF9uYW1lIHx8IHByb2ZpbGUudXNlcm5hbWUgfHwgXCJcIixcbiAgICAgICAgICBlbWFpbDogcHJvZmlsZS5lbWFpbCxcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiBwcm9maWxlLnZlcmlmaWVkLFxuICAgICAgICAgIGltYWdlOiBwcm9maWxlLmltYWdlX3VybCxcbiAgICAgICAgICAuLi51c2VyTWFwXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGE6IHByb2ZpbGVcbiAgICAgIH07XG4gICAgfSxcbiAgICBvcHRpb25zXG4gIH07XG59O1xuXG5jb25zdCBmYWNlYm9vayA9IChvcHRpb25zKSA9PiB7XG4gIHJldHVybiB7XG4gICAgaWQ6IFwiZmFjZWJvb2tcIixcbiAgICBuYW1lOiBcIkZhY2Vib29rXCIsXG4gICAgYXN5bmMgY3JlYXRlQXV0aG9yaXphdGlvblVSTCh7IHN0YXRlLCBzY29wZXMsIHJlZGlyZWN0VVJJLCBsb2dpbkhpbnQgfSkge1xuICAgICAgY29uc3QgX3Njb3BlcyA9IG9wdGlvbnMuZGlzYWJsZURlZmF1bHRTY29wZSA/IFtdIDogW1wiZW1haWxcIiwgXCJwdWJsaWNfcHJvZmlsZVwiXTtcbiAgICAgIG9wdGlvbnMuc2NvcGUgJiYgX3Njb3Blcy5wdXNoKC4uLm9wdGlvbnMuc2NvcGUpO1xuICAgICAgc2NvcGVzICYmIF9zY29wZXMucHVzaCguLi5zY29wZXMpO1xuICAgICAgcmV0dXJuIGF3YWl0IGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoe1xuICAgICAgICBpZDogXCJmYWNlYm9va1wiLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQ6IFwiaHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3YyMS4wL2RpYWxvZy9vYXV0aFwiLFxuICAgICAgICBzY29wZXM6IF9zY29wZXMsXG4gICAgICAgIHN0YXRlLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgbG9naW5IaW50LFxuICAgICAgICBhZGRpdGlvbmFsUGFyYW1zOiBvcHRpb25zLmNvbmZpZ0lkID8ge1xuICAgICAgICAgIGNvbmZpZ19pZDogb3B0aW9ucy5jb25maWdJZFxuICAgICAgICB9IDoge31cbiAgICAgIH0pO1xuICAgIH0sXG4gICAgdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZTogYXN5bmMgKHsgY29kZSwgcmVkaXJlY3RVUkkgfSkgPT4ge1xuICAgICAgcmV0dXJuIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGUoe1xuICAgICAgICBjb2RlLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS9vYXV0aC9hY2Nlc3NfdG9rZW5cIlxuICAgICAgfSk7XG4gICAgfSxcbiAgICBhc3luYyB2ZXJpZnlJZFRva2VuKHRva2VuLCBub25jZSkge1xuICAgICAgaWYgKG9wdGlvbnMuZGlzYWJsZUlkVG9rZW5TaWduSW4pIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMudmVyaWZ5SWRUb2tlbikge1xuICAgICAgICByZXR1cm4gb3B0aW9ucy52ZXJpZnlJZFRva2VuKHRva2VuLCBub25jZSk7XG4gICAgICB9XG4gICAgICBpZiAodG9rZW4uc3BsaXQoXCIuXCIpLmxlbmd0aCA9PT0gMykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHsgcGF5bG9hZDogand0Q2xhaW1zIH0gPSBhd2FpdCBqd3RWZXJpZnkoXG4gICAgICAgICAgICB0b2tlbixcbiAgICAgICAgICAgIGNyZWF0ZVJlbW90ZUpXS1NldChcbiAgICAgICAgICAgICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXJzLmZhY2Vib29rLmNvbS9kb2NzL2ZhY2Vib29rLWxvZ2luL2xpbWl0ZWQtbG9naW4vdG9rZW4vI2p3a3NcbiAgICAgICAgICAgICAgbmV3IFVSTChcbiAgICAgICAgICAgICAgICBcImh0dHBzOi8vbGltaXRlZC5mYWNlYm9vay5jb20vLndlbGwta25vd24vb2F1dGgvb3BlbmlkL2p3a3MvXCJcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgYWxnb3JpdGhtczogW1wiUlMyNTZcIl0sXG4gICAgICAgICAgICAgIGF1ZGllbmNlOiBvcHRpb25zLmNsaWVudElkLFxuICAgICAgICAgICAgICBpc3N1ZXI6IFwiaHR0cHM6Ly93d3cuZmFjZWJvb2suY29tXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICAgIGlmIChub25jZSAmJiBqd3RDbGFpbXMubm9uY2UgIT09IG5vbmNlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiAhIWp3dENsYWltcztcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG4gICAgcmVmcmVzaEFjY2Vzc1Rva2VuOiBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA/IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuIDogYXN5bmMgKHJlZnJlc2hUb2tlbikgPT4ge1xuICAgICAgcmV0dXJuIHJlZnJlc2hBY2Nlc3NUb2tlbih7XG4gICAgICAgIHJlZnJlc2hUb2tlbixcbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgIGNsaWVudElkOiBvcHRpb25zLmNsaWVudElkLFxuICAgICAgICAgIGNsaWVudEtleTogb3B0aW9ucy5jbGllbnRLZXksXG4gICAgICAgICAgY2xpZW50U2VjcmV0OiBvcHRpb25zLmNsaWVudFNlY3JldFxuICAgICAgICB9LFxuICAgICAgICB0b2tlbkVuZHBvaW50OiBcImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL3YxOC4wL29hdXRoL2FjY2Vzc190b2tlblwiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIGFzeW5jIGdldFVzZXJJbmZvKHRva2VuKSB7XG4gICAgICBpZiAob3B0aW9ucy5nZXRVc2VySW5mbykge1xuICAgICAgICByZXR1cm4gb3B0aW9ucy5nZXRVc2VySW5mbyh0b2tlbik7XG4gICAgICB9XG4gICAgICBpZiAodG9rZW4uaWRUb2tlbiAmJiB0b2tlbi5pZFRva2VuLnNwbGl0KFwiLlwiKS5sZW5ndGggPT09IDMpIHtcbiAgICAgICAgY29uc3QgcHJvZmlsZTIgPSBkZWNvZGVKd3QodG9rZW4uaWRUb2tlbik7XG4gICAgICAgIGNvbnN0IHVzZXIgPSB7XG4gICAgICAgICAgaWQ6IHByb2ZpbGUyLnN1YixcbiAgICAgICAgICBuYW1lOiBwcm9maWxlMi5uYW1lLFxuICAgICAgICAgIGVtYWlsOiBwcm9maWxlMi5lbWFpbCxcbiAgICAgICAgICBwaWN0dXJlOiB7XG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIHVybDogcHJvZmlsZTIucGljdHVyZSxcbiAgICAgICAgICAgICAgaGVpZ2h0OiAxMDAsXG4gICAgICAgICAgICAgIHdpZHRoOiAxMDAsXG4gICAgICAgICAgICAgIGlzX3NpbGhvdWV0dGU6IGZhbHNlXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCB1c2VyTWFwMiA9IGF3YWl0IG9wdGlvbnMubWFwUHJvZmlsZVRvVXNlcj8uKHtcbiAgICAgICAgICAuLi51c2VyLFxuICAgICAgICAgIGVtYWlsX3ZlcmlmaWVkOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgIC4uLnVzZXIsXG4gICAgICAgICAgICBlbWFpbFZlcmlmaWVkOiB0cnVlLFxuICAgICAgICAgICAgLi4udXNlck1hcDJcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRhdGE6IHByb2ZpbGUyXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBjb25zdCBmaWVsZHMgPSBbXG4gICAgICAgIFwiaWRcIixcbiAgICAgICAgXCJuYW1lXCIsXG4gICAgICAgIFwiZW1haWxcIixcbiAgICAgICAgXCJwaWN0dXJlXCIsXG4gICAgICAgIC4uLm9wdGlvbnM/LmZpZWxkcyB8fCBbXVxuICAgICAgXTtcbiAgICAgIGNvbnN0IHsgZGF0YTogcHJvZmlsZSwgZXJyb3IgfSA9IGF3YWl0IGJldHRlckZldGNoKFxuICAgICAgICBcImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL21lP2ZpZWxkcz1cIiArIGZpZWxkcy5qb2luKFwiLFwiKSxcbiAgICAgICAge1xuICAgICAgICAgIGF1dGg6IHtcbiAgICAgICAgICAgIHR5cGU6IFwiQmVhcmVyXCIsXG4gICAgICAgICAgICB0b2tlbjogdG9rZW4uYWNjZXNzVG9rZW5cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICBjb25zdCB1c2VyTWFwID0gYXdhaXQgb3B0aW9ucy5tYXBQcm9maWxlVG9Vc2VyPy4ocHJvZmlsZSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IHByb2ZpbGUuaWQsXG4gICAgICAgICAgbmFtZTogcHJvZmlsZS5uYW1lLFxuICAgICAgICAgIGVtYWlsOiBwcm9maWxlLmVtYWlsLFxuICAgICAgICAgIGltYWdlOiBwcm9maWxlLnBpY3R1cmUuZGF0YS51cmwsXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogcHJvZmlsZS5lbWFpbF92ZXJpZmllZCxcbiAgICAgICAgICAuLi51c2VyTWFwXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGE6IHByb2ZpbGVcbiAgICAgIH07XG4gICAgfSxcbiAgICBvcHRpb25zXG4gIH07XG59O1xuXG5jb25zdCBnaXRodWIgPSAob3B0aW9ucykgPT4ge1xuICBjb25zdCB0b2tlbkVuZHBvaW50ID0gXCJodHRwczovL2dpdGh1Yi5jb20vbG9naW4vb2F1dGgvYWNjZXNzX3Rva2VuXCI7XG4gIHJldHVybiB7XG4gICAgaWQ6IFwiZ2l0aHViXCIsXG4gICAgbmFtZTogXCJHaXRIdWJcIixcbiAgICBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHsgc3RhdGUsIHNjb3BlcywgbG9naW5IaW50LCByZWRpcmVjdFVSSSB9KSB7XG4gICAgICBjb25zdCBfc2NvcGVzID0gb3B0aW9ucy5kaXNhYmxlRGVmYXVsdFNjb3BlID8gW10gOiBbXCJyZWFkOnVzZXJcIiwgXCJ1c2VyOmVtYWlsXCJdO1xuICAgICAgb3B0aW9ucy5zY29wZSAmJiBfc2NvcGVzLnB1c2goLi4ub3B0aW9ucy5zY29wZSk7XG4gICAgICBzY29wZXMgJiYgX3Njb3Blcy5wdXNoKC4uLnNjb3Blcyk7XG4gICAgICByZXR1cm4gY3JlYXRlQXV0aG9yaXphdGlvblVSTCh7XG4gICAgICAgIGlkOiBcImdpdGh1YlwiLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQ6IFwiaHR0cHM6Ly9naXRodWIuY29tL2xvZ2luL29hdXRoL2F1dGhvcml6ZVwiLFxuICAgICAgICBzY29wZXM6IF9zY29wZXMsXG4gICAgICAgIHN0YXRlLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgbG9naW5IaW50LFxuICAgICAgICBwcm9tcHQ6IG9wdGlvbnMucHJvbXB0XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGU6IGFzeW5jICh7IGNvZGUsIHJlZGlyZWN0VVJJIH0pID0+IHtcbiAgICAgIHJldHVybiB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlKHtcbiAgICAgICAgY29kZSxcbiAgICAgICAgcmVkaXJlY3RVUkksXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIHRva2VuRW5kcG9pbnRcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgcmVmcmVzaEFjY2Vzc1Rva2VuOiBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA/IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuIDogYXN5bmMgKHJlZnJlc2hUb2tlbikgPT4ge1xuICAgICAgcmV0dXJuIHJlZnJlc2hBY2Nlc3NUb2tlbih7XG4gICAgICAgIHJlZnJlc2hUb2tlbixcbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgIGNsaWVudElkOiBvcHRpb25zLmNsaWVudElkLFxuICAgICAgICAgIGNsaWVudEtleTogb3B0aW9ucy5jbGllbnRLZXksXG4gICAgICAgICAgY2xpZW50U2VjcmV0OiBvcHRpb25zLmNsaWVudFNlY3JldFxuICAgICAgICB9LFxuICAgICAgICB0b2tlbkVuZHBvaW50OiBcImh0dHBzOi8vZ2l0aHViLmNvbS9sb2dpbi9vYXV0aC9hY2Nlc3NfdG9rZW5cIlxuICAgICAgfSk7XG4gICAgfSxcbiAgICBhc3luYyBnZXRVc2VySW5mbyh0b2tlbikge1xuICAgICAgaWYgKG9wdGlvbnMuZ2V0VXNlckluZm8pIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMuZ2V0VXNlckluZm8odG9rZW4pO1xuICAgICAgfVxuICAgICAgY29uc3QgeyBkYXRhOiBwcm9maWxlLCBlcnJvciB9ID0gYXdhaXQgYmV0dGVyRmV0Y2goXG4gICAgICAgIFwiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2VyXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBcIlVzZXItQWdlbnRcIjogXCJiZXR0ZXItYXV0aFwiLFxuICAgICAgICAgICAgYXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VuLmFjY2Vzc1Rva2VufWBcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICBjb25zdCB7IGRhdGE6IGVtYWlscyB9ID0gYXdhaXQgYmV0dGVyRmV0Y2goXCJodHRwczovL2FwaS5naXRodWIuY29tL3VzZXIvZW1haWxzXCIsIHtcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbi5hY2Nlc3NUb2tlbn1gLFxuICAgICAgICAgIFwiVXNlci1BZ2VudFwiOiBcImJldHRlci1hdXRoXCJcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBpZiAoIXByb2ZpbGUuZW1haWwgJiYgZW1haWxzKSB7XG4gICAgICAgIHByb2ZpbGUuZW1haWwgPSAoZW1haWxzLmZpbmQoKGUpID0+IGUucHJpbWFyeSkgPz8gZW1haWxzWzBdKT8uZW1haWw7XG4gICAgICB9XG4gICAgICBjb25zdCBlbWFpbFZlcmlmaWVkID0gZW1haWxzPy5maW5kKChlKSA9PiBlLmVtYWlsID09PSBwcm9maWxlLmVtYWlsKT8udmVyaWZpZWQgPz8gZmFsc2U7XG4gICAgICBjb25zdCB1c2VyTWFwID0gYXdhaXQgb3B0aW9ucy5tYXBQcm9maWxlVG9Vc2VyPy4ocHJvZmlsZSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IHByb2ZpbGUuaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICBuYW1lOiBwcm9maWxlLm5hbWUgfHwgcHJvZmlsZS5sb2dpbixcbiAgICAgICAgICBlbWFpbDogcHJvZmlsZS5lbWFpbCxcbiAgICAgICAgICBpbWFnZTogcHJvZmlsZS5hdmF0YXJfdXJsLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQsXG4gICAgICAgICAgLi4udXNlck1hcFxuICAgICAgICB9LFxuICAgICAgICBkYXRhOiBwcm9maWxlXG4gICAgICB9O1xuICAgIH0sXG4gICAgb3B0aW9uc1xuICB9O1xufTtcblxuY29uc3QgZ29vZ2xlID0gKG9wdGlvbnMpID0+IHtcbiAgcmV0dXJuIHtcbiAgICBpZDogXCJnb29nbGVcIixcbiAgICBuYW1lOiBcIkdvb2dsZVwiLFxuICAgIGFzeW5jIGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoe1xuICAgICAgc3RhdGUsXG4gICAgICBzY29wZXMsXG4gICAgICBjb2RlVmVyaWZpZXIsXG4gICAgICByZWRpcmVjdFVSSSxcbiAgICAgIGxvZ2luSGludCxcbiAgICAgIGRpc3BsYXlcbiAgICB9KSB7XG4gICAgICBpZiAoIW9wdGlvbnMuY2xpZW50SWQgfHwgIW9wdGlvbnMuY2xpZW50U2VjcmV0KSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcihcbiAgICAgICAgICBcIkNsaWVudCBJZCBhbmQgQ2xpZW50IFNlY3JldCBpcyByZXF1aXJlZCBmb3IgR29vZ2xlLiBNYWtlIHN1cmUgdG8gcHJvdmlkZSB0aGVtIGluIHRoZSBvcHRpb25zLlwiXG4gICAgICAgICk7XG4gICAgICAgIHRocm93IG5ldyBCZXR0ZXJBdXRoRXJyb3IoXCJDTElFTlRfSURfQU5EX1NFQ1JFVF9SRVFVSVJFRFwiKTtcbiAgICAgIH1cbiAgICAgIGlmICghY29kZVZlcmlmaWVyKSB7XG4gICAgICAgIHRocm93IG5ldyBCZXR0ZXJBdXRoRXJyb3IoXCJjb2RlVmVyaWZpZXIgaXMgcmVxdWlyZWQgZm9yIEdvb2dsZVwiKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IF9zY29wZXMgPSBvcHRpb25zLmRpc2FibGVEZWZhdWx0U2NvcGUgPyBbXSA6IFtcImVtYWlsXCIsIFwicHJvZmlsZVwiLCBcIm9wZW5pZFwiXTtcbiAgICAgIG9wdGlvbnMuc2NvcGUgJiYgX3Njb3Blcy5wdXNoKC4uLm9wdGlvbnMuc2NvcGUpO1xuICAgICAgc2NvcGVzICYmIF9zY29wZXMucHVzaCguLi5zY29wZXMpO1xuICAgICAgaWYgKG9wdGlvbnMucHJvbXB0ID09PSBcInNlbGVjdF9hY2NvdW50K2NvbnNlbnRcIilcbiAgICAgICAgb3B0aW9ucy5wcm9tcHQgPSBcInNlbGVjdF9hY2NvdW50IGNvbnNlbnRcIjtcbiAgICAgIGNvbnN0IHVybCA9IGF3YWl0IGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoe1xuICAgICAgICBpZDogXCJnb29nbGVcIixcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgYXV0aG9yaXphdGlvbkVuZHBvaW50OiBcImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoXCIsXG4gICAgICAgIHNjb3BlczogX3Njb3BlcyxcbiAgICAgICAgc3RhdGUsXG4gICAgICAgIGNvZGVWZXJpZmllcixcbiAgICAgICAgcmVkaXJlY3RVUkksXG4gICAgICAgIHByb21wdDogb3B0aW9ucy5wcm9tcHQsXG4gICAgICAgIGFjY2Vzc1R5cGU6IG9wdGlvbnMuYWNjZXNzVHlwZSxcbiAgICAgICAgZGlzcGxheTogZGlzcGxheSB8fCBvcHRpb25zLmRpc3BsYXksXG4gICAgICAgIGxvZ2luSGludCxcbiAgICAgICAgaGQ6IG9wdGlvbnMuaGQsXG4gICAgICAgIGFkZGl0aW9uYWxQYXJhbXM6IHtcbiAgICAgICAgICBpbmNsdWRlX2dyYW50ZWRfc2NvcGVzOiBcInRydWVcIlxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiB1cmw7XG4gICAgfSxcbiAgICB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlOiBhc3luYyAoeyBjb2RlLCBjb2RlVmVyaWZpZXIsIHJlZGlyZWN0VVJJIH0pID0+IHtcbiAgICAgIHJldHVybiB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlKHtcbiAgICAgICAgY29kZSxcbiAgICAgICAgY29kZVZlcmlmaWVyLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL29hdXRoMi5nb29nbGVhcGlzLmNvbS90b2tlblwiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIHJlZnJlc2hBY2Nlc3NUb2tlbjogb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gPyBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA6IGFzeW5jIChyZWZyZXNoVG9rZW4pID0+IHtcbiAgICAgIHJldHVybiByZWZyZXNoQWNjZXNzVG9rZW4oe1xuICAgICAgICByZWZyZXNoVG9rZW4sXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICBjbGllbnRJZDogb3B0aW9ucy5jbGllbnRJZCxcbiAgICAgICAgICBjbGllbnRLZXk6IG9wdGlvbnMuY2xpZW50S2V5LFxuICAgICAgICAgIGNsaWVudFNlY3JldDogb3B0aW9ucy5jbGllbnRTZWNyZXRcbiAgICAgICAgfSxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9vYXV0aDIvdjQvdG9rZW5cIlxuICAgICAgfSk7XG4gICAgfSxcbiAgICBhc3luYyB2ZXJpZnlJZFRva2VuKHRva2VuLCBub25jZSkge1xuICAgICAgaWYgKG9wdGlvbnMuZGlzYWJsZUlkVG9rZW5TaWduSW4pIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMudmVyaWZ5SWRUb2tlbikge1xuICAgICAgICByZXR1cm4gb3B0aW9ucy52ZXJpZnlJZFRva2VuKHRva2VuLCBub25jZSk7XG4gICAgICB9XG4gICAgICBjb25zdCBnb29nbGVQdWJsaWNLZXlVcmwgPSBgaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YzL3Rva2VuaW5mbz9pZF90b2tlbj0ke3Rva2VufWA7XG4gICAgICBjb25zdCB7IGRhdGE6IHRva2VuSW5mbyB9ID0gYXdhaXQgYmV0dGVyRmV0Y2goZ29vZ2xlUHVibGljS2V5VXJsKTtcbiAgICAgIGlmICghdG9rZW5JbmZvKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGlzVmFsaWQgPSB0b2tlbkluZm8uYXVkID09PSBvcHRpb25zLmNsaWVudElkICYmICh0b2tlbkluZm8uaXNzID09PSBcImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbVwiIHx8IHRva2VuSW5mby5pc3MgPT09IFwiYWNjb3VudHMuZ29vZ2xlLmNvbVwiKTtcbiAgICAgIHJldHVybiBpc1ZhbGlkO1xuICAgIH0sXG4gICAgYXN5bmMgZ2V0VXNlckluZm8odG9rZW4pIHtcbiAgICAgIGlmIChvcHRpb25zLmdldFVzZXJJbmZvKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLmdldFVzZXJJbmZvKHRva2VuKTtcbiAgICAgIH1cbiAgICAgIGlmICghdG9rZW4uaWRUb2tlbikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHVzZXIgPSBkZWNvZGVKd3QodG9rZW4uaWRUb2tlbik7XG4gICAgICBjb25zdCB1c2VyTWFwID0gYXdhaXQgb3B0aW9ucy5tYXBQcm9maWxlVG9Vc2VyPy4odXNlcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IHVzZXIuc3ViLFxuICAgICAgICAgIG5hbWU6IHVzZXIubmFtZSxcbiAgICAgICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICAgICAgICBpbWFnZTogdXNlci5waWN0dXJlLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IHVzZXIuZW1haWxfdmVyaWZpZWQsXG4gICAgICAgICAgLi4udXNlck1hcFxuICAgICAgICB9LFxuICAgICAgICBkYXRhOiB1c2VyXG4gICAgICB9O1xuICAgIH0sXG4gICAgb3B0aW9uc1xuICB9O1xufTtcblxuY29uc3Qga2ljayA9IChvcHRpb25zKSA9PiB7XG4gIHJldHVybiB7XG4gICAgaWQ6IFwia2lja1wiLFxuICAgIG5hbWU6IFwiS2lja1wiLFxuICAgIGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoeyBzdGF0ZSwgc2NvcGVzLCByZWRpcmVjdFVSSSwgY29kZVZlcmlmaWVyIH0pIHtcbiAgICAgIGNvbnN0IF9zY29wZXMgPSBvcHRpb25zLmRpc2FibGVEZWZhdWx0U2NvcGUgPyBbXSA6IFtcInVzZXI6cmVhZFwiXTtcbiAgICAgIG9wdGlvbnMuc2NvcGUgJiYgX3Njb3Blcy5wdXNoKC4uLm9wdGlvbnMuc2NvcGUpO1xuICAgICAgc2NvcGVzICYmIF9zY29wZXMucHVzaCguLi5zY29wZXMpO1xuICAgICAgcmV0dXJuIGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoe1xuICAgICAgICBpZDogXCJraWNrXCIsXG4gICAgICAgIHJlZGlyZWN0VVJJLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQ6IFwiaHR0cHM6Ly9pZC5raWNrLmNvbS9vYXV0aC9hdXRob3JpemVcIixcbiAgICAgICAgc2NvcGVzOiBfc2NvcGVzLFxuICAgICAgICBjb2RlVmVyaWZpZXIsXG4gICAgICAgIHN0YXRlXG4gICAgICB9KTtcbiAgICB9LFxuICAgIGFzeW5jIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGUoeyBjb2RlLCByZWRpcmVjdFVSSSwgY29kZVZlcmlmaWVyIH0pIHtcbiAgICAgIHJldHVybiB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlKHtcbiAgICAgICAgY29kZSxcbiAgICAgICAgcmVkaXJlY3RVUkksXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIHRva2VuRW5kcG9pbnQ6IFwiaHR0cHM6Ly9pZC5raWNrLmNvbS9vYXV0aC90b2tlblwiLFxuICAgICAgICBjb2RlVmVyaWZpZXJcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgYXN5bmMgZ2V0VXNlckluZm8odG9rZW4pIHtcbiAgICAgIGlmIChvcHRpb25zLmdldFVzZXJJbmZvKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLmdldFVzZXJJbmZvKHRva2VuKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IGJldHRlckZldGNoKFwiaHR0cHM6Ly9hcGkua2ljay5jb20vcHVibGljL3YxL3VzZXJzXCIsIHtcbiAgICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VuLmFjY2Vzc1Rva2VufWBcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICBjb25zdCBwcm9maWxlID0gZGF0YS5kYXRhWzBdO1xuICAgICAgY29uc3QgdXNlck1hcCA9IGF3YWl0IG9wdGlvbnMubWFwUHJvZmlsZVRvVXNlcj8uKHByb2ZpbGUpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGlkOiBwcm9maWxlLnVzZXJfaWQsXG4gICAgICAgICAgbmFtZTogcHJvZmlsZS5uYW1lLFxuICAgICAgICAgIGVtYWlsOiBwcm9maWxlLmVtYWlsLFxuICAgICAgICAgIGltYWdlOiBwcm9maWxlLnByb2ZpbGVfcGljdHVyZSxcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiB0cnVlLFxuICAgICAgICAgIC4uLnVzZXJNYXBcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YTogcHJvZmlsZVxuICAgICAgfTtcbiAgICB9LFxuICAgIG9wdGlvbnNcbiAgfTtcbn07XG5cbmNvbnN0IGh1Z2dpbmdmYWNlID0gKG9wdGlvbnMpID0+IHtcbiAgcmV0dXJuIHtcbiAgICBpZDogXCJodWdnaW5nZmFjZVwiLFxuICAgIG5hbWU6IFwiSHVnZ2luZyBGYWNlXCIsXG4gICAgY3JlYXRlQXV0aG9yaXphdGlvblVSTCh7IHN0YXRlLCBzY29wZXMsIGNvZGVWZXJpZmllciwgcmVkaXJlY3RVUkkgfSkge1xuICAgICAgY29uc3QgX3Njb3BlcyA9IG9wdGlvbnMuZGlzYWJsZURlZmF1bHRTY29wZSA/IFtdIDogW1wib3BlbmlkXCIsIFwicHJvZmlsZVwiLCBcImVtYWlsXCJdO1xuICAgICAgb3B0aW9ucy5zY29wZSAmJiBfc2NvcGVzLnB1c2goLi4ub3B0aW9ucy5zY29wZSk7XG4gICAgICBzY29wZXMgJiYgX3Njb3Blcy5wdXNoKC4uLnNjb3Blcyk7XG4gICAgICByZXR1cm4gY3JlYXRlQXV0aG9yaXphdGlvblVSTCh7XG4gICAgICAgIGlkOiBcImh1Z2dpbmdmYWNlXCIsXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIGF1dGhvcml6YXRpb25FbmRwb2ludDogXCJodHRwczovL2h1Z2dpbmdmYWNlLmNvL29hdXRoL2F1dGhvcml6ZVwiLFxuICAgICAgICBzY29wZXM6IF9zY29wZXMsXG4gICAgICAgIHN0YXRlLFxuICAgICAgICBjb2RlVmVyaWZpZXIsXG4gICAgICAgIHJlZGlyZWN0VVJJXG4gICAgICB9KTtcbiAgICB9LFxuICAgIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGU6IGFzeW5jICh7IGNvZGUsIGNvZGVWZXJpZmllciwgcmVkaXJlY3RVUkkgfSkgPT4ge1xuICAgICAgcmV0dXJuIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGUoe1xuICAgICAgICBjb2RlLFxuICAgICAgICBjb2RlVmVyaWZpZXIsXG4gICAgICAgIHJlZGlyZWN0VVJJLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICB0b2tlbkVuZHBvaW50OiBcImh0dHBzOi8vaHVnZ2luZ2ZhY2UuY28vb2F1dGgvdG9rZW5cIlxuICAgICAgfSk7XG4gICAgfSxcbiAgICByZWZyZXNoQWNjZXNzVG9rZW46IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuID8gb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gOiBhc3luYyAocmVmcmVzaFRva2VuKSA9PiB7XG4gICAgICByZXR1cm4gcmVmcmVzaEFjY2Vzc1Rva2VuKHtcbiAgICAgICAgcmVmcmVzaFRva2VuLFxuICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgY2xpZW50SWQ6IG9wdGlvbnMuY2xpZW50SWQsXG4gICAgICAgICAgY2xpZW50S2V5OiBvcHRpb25zLmNsaWVudEtleSxcbiAgICAgICAgICBjbGllbnRTZWNyZXQ6IG9wdGlvbnMuY2xpZW50U2VjcmV0XG4gICAgICAgIH0sXG4gICAgICAgIHRva2VuRW5kcG9pbnQ6IFwiaHR0cHM6Ly9odWdnaW5nZmFjZS5jby9vYXV0aC90b2tlblwiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIGFzeW5jIGdldFVzZXJJbmZvKHRva2VuKSB7XG4gICAgICBpZiAob3B0aW9ucy5nZXRVc2VySW5mbykge1xuICAgICAgICByZXR1cm4gb3B0aW9ucy5nZXRVc2VySW5mbyh0b2tlbik7XG4gICAgICB9XG4gICAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUsIGVycm9yIH0gPSBhd2FpdCBiZXR0ZXJGZXRjaChcbiAgICAgICAgXCJodHRwczovL2h1Z2dpbmdmYWNlLmNvL29hdXRoL3VzZXJpbmZvXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VuLmFjY2Vzc1Rva2VufWBcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICBjb25zdCB1c2VyTWFwID0gYXdhaXQgb3B0aW9ucy5tYXBQcm9maWxlVG9Vc2VyPy4ocHJvZmlsZSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IHByb2ZpbGUuc3ViLFxuICAgICAgICAgIG5hbWU6IHByb2ZpbGUubmFtZSB8fCBwcm9maWxlLnByZWZlcnJlZF91c2VybmFtZSxcbiAgICAgICAgICBlbWFpbDogcHJvZmlsZS5lbWFpbCxcbiAgICAgICAgICBpbWFnZTogcHJvZmlsZS5waWN0dXJlLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IHByb2ZpbGUuZW1haWxfdmVyaWZpZWQgPz8gZmFsc2UsXG4gICAgICAgICAgLi4udXNlck1hcFxuICAgICAgICB9LFxuICAgICAgICBkYXRhOiBwcm9maWxlXG4gICAgICB9O1xuICAgIH0sXG4gICAgb3B0aW9uc1xuICB9O1xufTtcblxuY29uc3QgbWljcm9zb2Z0ID0gKG9wdGlvbnMpID0+IHtcbiAgY29uc3QgdGVuYW50ID0gb3B0aW9ucy50ZW5hbnRJZCB8fCBcImNvbW1vblwiO1xuICBjb25zdCBhdXRob3JpemF0aW9uRW5kcG9pbnQgPSBgaHR0cHM6Ly9sb2dpbi5taWNyb3NvZnRvbmxpbmUuY29tLyR7dGVuYW50fS9vYXV0aDIvdjIuMC9hdXRob3JpemVgO1xuICBjb25zdCB0b2tlbkVuZHBvaW50ID0gYGh0dHBzOi8vbG9naW4ubWljcm9zb2Z0b25saW5lLmNvbS8ke3RlbmFudH0vb2F1dGgyL3YyLjAvdG9rZW5gO1xuICByZXR1cm4ge1xuICAgIGlkOiBcIm1pY3Jvc29mdFwiLFxuICAgIG5hbWU6IFwiTWljcm9zb2Z0IEVudHJhSURcIixcbiAgICBjcmVhdGVBdXRob3JpemF0aW9uVVJMKGRhdGEpIHtcbiAgICAgIGNvbnN0IHNjb3BlcyA9IG9wdGlvbnMuZGlzYWJsZURlZmF1bHRTY29wZSA/IFtdIDogW1wib3BlbmlkXCIsIFwicHJvZmlsZVwiLCBcImVtYWlsXCIsIFwiVXNlci5SZWFkXCIsIFwib2ZmbGluZV9hY2Nlc3NcIl07XG4gICAgICBvcHRpb25zLnNjb3BlICYmIHNjb3Blcy5wdXNoKC4uLm9wdGlvbnMuc2NvcGUpO1xuICAgICAgZGF0YS5zY29wZXMgJiYgc2NvcGVzLnB1c2goLi4uZGF0YS5zY29wZXMpO1xuICAgICAgcmV0dXJuIGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoe1xuICAgICAgICBpZDogXCJtaWNyb3NvZnRcIixcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgYXV0aG9yaXphdGlvbkVuZHBvaW50LFxuICAgICAgICBzdGF0ZTogZGF0YS5zdGF0ZSxcbiAgICAgICAgY29kZVZlcmlmaWVyOiBkYXRhLmNvZGVWZXJpZmllcixcbiAgICAgICAgc2NvcGVzLFxuICAgICAgICByZWRpcmVjdFVSSTogZGF0YS5yZWRpcmVjdFVSSSxcbiAgICAgICAgcHJvbXB0OiBvcHRpb25zLnByb21wdFxuICAgICAgfSk7XG4gICAgfSxcbiAgICB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlKHsgY29kZSwgY29kZVZlcmlmaWVyLCByZWRpcmVjdFVSSSB9KSB7XG4gICAgICByZXR1cm4gdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZSh7XG4gICAgICAgIGNvZGUsXG4gICAgICAgIGNvZGVWZXJpZmllcixcbiAgICAgICAgcmVkaXJlY3RVUkksXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIHRva2VuRW5kcG9pbnRcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgYXN5bmMgZ2V0VXNlckluZm8odG9rZW4pIHtcbiAgICAgIGlmIChvcHRpb25zLmdldFVzZXJJbmZvKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLmdldFVzZXJJbmZvKHRva2VuKTtcbiAgICAgIH1cbiAgICAgIGlmICghdG9rZW4uaWRUb2tlbikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHVzZXIgPSBkZWNvZGVKd3QodG9rZW4uaWRUb2tlbik7XG4gICAgICBjb25zdCBwcm9maWxlUGhvdG9TaXplID0gb3B0aW9ucy5wcm9maWxlUGhvdG9TaXplIHx8IDQ4O1xuICAgICAgYXdhaXQgYmV0dGVyRmV0Y2goXG4gICAgICAgIGBodHRwczovL2dyYXBoLm1pY3Jvc29mdC5jb20vdjEuMC9tZS9waG90b3MvJHtwcm9maWxlUGhvdG9TaXplfXgke3Byb2ZpbGVQaG90b1NpemV9LyR2YWx1ZWAsXG4gICAgICAgIHtcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW4uYWNjZXNzVG9rZW59YFxuICAgICAgICAgIH0sXG4gICAgICAgICAgYXN5bmMgb25SZXNwb25zZShjb250ZXh0KSB7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5kaXNhYmxlUHJvZmlsZVBob3RvIHx8ICFjb250ZXh0LnJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gY29udGV4dC5yZXNwb25zZS5jbG9uZSgpO1xuICAgICAgICAgICAgICBjb25zdCBwaWN0dXJlQnVmZmVyID0gYXdhaXQgcmVzcG9uc2UuYXJyYXlCdWZmZXIoKTtcbiAgICAgICAgICAgICAgY29uc3QgcGljdHVyZUJhc2U2NCA9IGJhc2U2NC5lbmNvZGUocGljdHVyZUJ1ZmZlcik7XG4gICAgICAgICAgICAgIHVzZXIucGljdHVyZSA9IGBkYXRhOmltYWdlL2pwZWc7YmFzZTY0LCAke3BpY3R1cmVCYXNlNjR9YDtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKFxuICAgICAgICAgICAgICAgIGUgJiYgdHlwZW9mIGUgPT09IFwib2JqZWN0XCIgJiYgXCJuYW1lXCIgaW4gZSA/IGUubmFtZSA6IFwiXCIsXG4gICAgICAgICAgICAgICAgZVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHVzZXJNYXAgPSBhd2FpdCBvcHRpb25zLm1hcFByb2ZpbGVUb1VzZXI/Lih1c2VyKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogdXNlci5zdWIsXG4gICAgICAgICAgbmFtZTogdXNlci5uYW1lLFxuICAgICAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxuICAgICAgICAgIGltYWdlOiB1c2VyLnBpY3R1cmUsXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogdHJ1ZSxcbiAgICAgICAgICAuLi51c2VyTWFwXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGE6IHVzZXJcbiAgICAgIH07XG4gICAgfSxcbiAgICByZWZyZXNoQWNjZXNzVG9rZW46IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuID8gb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gOiBhc3luYyAocmVmcmVzaFRva2VuKSA9PiB7XG4gICAgICBjb25zdCBzY29wZXMgPSBvcHRpb25zLmRpc2FibGVEZWZhdWx0U2NvcGUgPyBbXSA6IFtcIm9wZW5pZFwiLCBcInByb2ZpbGVcIiwgXCJlbWFpbFwiLCBcIlVzZXIuUmVhZFwiLCBcIm9mZmxpbmVfYWNjZXNzXCJdO1xuICAgICAgb3B0aW9ucy5zY29wZSAmJiBzY29wZXMucHVzaCguLi5vcHRpb25zLnNjb3BlKTtcbiAgICAgIHJldHVybiByZWZyZXNoQWNjZXNzVG9rZW4oe1xuICAgICAgICByZWZyZXNoVG9rZW4sXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICBjbGllbnRJZDogb3B0aW9ucy5jbGllbnRJZCxcbiAgICAgICAgICBjbGllbnRTZWNyZXQ6IG9wdGlvbnMuY2xpZW50U2VjcmV0XG4gICAgICAgIH0sXG4gICAgICAgIGV4dHJhUGFyYW1zOiB7XG4gICAgICAgICAgc2NvcGU6IHNjb3Blcy5qb2luKFwiIFwiKVxuICAgICAgICAgIC8vIEluY2x1ZGUgdGhlIHNjb3BlcyBpbiByZXF1ZXN0IHRvIG1pY3Jvc29mdFxuICAgICAgICB9LFxuICAgICAgICB0b2tlbkVuZHBvaW50XG4gICAgICB9KTtcbiAgICB9LFxuICAgIG9wdGlvbnNcbiAgfTtcbn07XG5cbmNvbnN0IHNsYWNrID0gKG9wdGlvbnMpID0+IHtcbiAgcmV0dXJuIHtcbiAgICBpZDogXCJzbGFja1wiLFxuICAgIG5hbWU6IFwiU2xhY2tcIixcbiAgICBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHsgc3RhdGUsIHNjb3BlcywgcmVkaXJlY3RVUkkgfSkge1xuICAgICAgY29uc3QgX3Njb3BlcyA9IG9wdGlvbnMuZGlzYWJsZURlZmF1bHRTY29wZSA/IFtdIDogW1wib3BlbmlkXCIsIFwicHJvZmlsZVwiLCBcImVtYWlsXCJdO1xuICAgICAgc2NvcGVzICYmIF9zY29wZXMucHVzaCguLi5zY29wZXMpO1xuICAgICAgb3B0aW9ucy5zY29wZSAmJiBfc2NvcGVzLnB1c2goLi4ub3B0aW9ucy5zY29wZSk7XG4gICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKFwiaHR0cHM6Ly9zbGFjay5jb20vb3BlbmlkL2Nvbm5lY3QvYXV0aG9yaXplXCIpO1xuICAgICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJzY29wZVwiLCBfc2NvcGVzLmpvaW4oXCIgXCIpKTtcbiAgICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KFwicmVzcG9uc2VfdHlwZVwiLCBcImNvZGVcIik7XG4gICAgICB1cmwuc2VhcmNoUGFyYW1zLnNldChcImNsaWVudF9pZFwiLCBvcHRpb25zLmNsaWVudElkKTtcbiAgICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KFwicmVkaXJlY3RfdXJpXCIsIG9wdGlvbnMucmVkaXJlY3RVUkkgfHwgcmVkaXJlY3RVUkkpO1xuICAgICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJzdGF0ZVwiLCBzdGF0ZSk7XG4gICAgICByZXR1cm4gdXJsO1xuICAgIH0sXG4gICAgdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZTogYXN5bmMgKHsgY29kZSwgcmVkaXJlY3RVUkkgfSkgPT4ge1xuICAgICAgcmV0dXJuIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGUoe1xuICAgICAgICBjb2RlLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL3NsYWNrLmNvbS9hcGkvb3BlbmlkLmNvbm5lY3QudG9rZW5cIlxuICAgICAgfSk7XG4gICAgfSxcbiAgICByZWZyZXNoQWNjZXNzVG9rZW46IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuID8gb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gOiBhc3luYyAocmVmcmVzaFRva2VuKSA9PiB7XG4gICAgICByZXR1cm4gcmVmcmVzaEFjY2Vzc1Rva2VuKHtcbiAgICAgICAgcmVmcmVzaFRva2VuLFxuICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgY2xpZW50SWQ6IG9wdGlvbnMuY2xpZW50SWQsXG4gICAgICAgICAgY2xpZW50S2V5OiBvcHRpb25zLmNsaWVudEtleSxcbiAgICAgICAgICBjbGllbnRTZWNyZXQ6IG9wdGlvbnMuY2xpZW50U2VjcmV0XG4gICAgICAgIH0sXG4gICAgICAgIHRva2VuRW5kcG9pbnQ6IFwiaHR0cHM6Ly9zbGFjay5jb20vYXBpL29wZW5pZC5jb25uZWN0LnRva2VuXCJcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgYXN5bmMgZ2V0VXNlckluZm8odG9rZW4pIHtcbiAgICAgIGlmIChvcHRpb25zLmdldFVzZXJJbmZvKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLmdldFVzZXJJbmZvKHRva2VuKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgZGF0YTogcHJvZmlsZSwgZXJyb3IgfSA9IGF3YWl0IGJldHRlckZldGNoKFxuICAgICAgICBcImh0dHBzOi8vc2xhY2suY29tL2FwaS9vcGVuaWQuY29ubmVjdC51c2VySW5mb1wiLFxuICAgICAgICB7XG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgYXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VuLmFjY2Vzc1Rva2VufWBcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICBjb25zdCB1c2VyTWFwID0gYXdhaXQgb3B0aW9ucy5tYXBQcm9maWxlVG9Vc2VyPy4ocHJvZmlsZSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IHByb2ZpbGVbXCJodHRwczovL3NsYWNrLmNvbS91c2VyX2lkXCJdLFxuICAgICAgICAgIG5hbWU6IHByb2ZpbGUubmFtZSB8fCBcIlwiLFxuICAgICAgICAgIGVtYWlsOiBwcm9maWxlLmVtYWlsLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IHByb2ZpbGUuZW1haWxfdmVyaWZpZWQsXG4gICAgICAgICAgaW1hZ2U6IHByb2ZpbGUucGljdHVyZSB8fCBwcm9maWxlW1wiaHR0cHM6Ly9zbGFjay5jb20vdXNlcl9pbWFnZV81MTJcIl0sXG4gICAgICAgICAgLi4udXNlck1hcFxuICAgICAgICB9LFxuICAgICAgICBkYXRhOiBwcm9maWxlXG4gICAgICB9O1xuICAgIH0sXG4gICAgb3B0aW9uc1xuICB9O1xufTtcblxuY29uc3Qgbm90aW9uID0gKG9wdGlvbnMpID0+IHtcbiAgY29uc3QgdG9rZW5FbmRwb2ludCA9IFwiaHR0cHM6Ly9hcGkubm90aW9uLmNvbS92MS9vYXV0aC90b2tlblwiO1xuICByZXR1cm4ge1xuICAgIGlkOiBcIm5vdGlvblwiLFxuICAgIG5hbWU6IFwiTm90aW9uXCIsXG4gICAgY3JlYXRlQXV0aG9yaXphdGlvblVSTCh7IHN0YXRlLCBzY29wZXMsIGxvZ2luSGludCwgcmVkaXJlY3RVUkkgfSkge1xuICAgICAgY29uc3QgX3Njb3BlcyA9IG9wdGlvbnMuZGlzYWJsZURlZmF1bHRTY29wZSA/IFtdIDogW107XG4gICAgICBvcHRpb25zLnNjb3BlICYmIF9zY29wZXMucHVzaCguLi5vcHRpb25zLnNjb3BlKTtcbiAgICAgIHNjb3BlcyAmJiBfc2NvcGVzLnB1c2goLi4uc2NvcGVzKTtcbiAgICAgIHJldHVybiBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHtcbiAgICAgICAgaWQ6IFwibm90aW9uXCIsXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIGF1dGhvcml6YXRpb25FbmRwb2ludDogXCJodHRwczovL2FwaS5ub3Rpb24uY29tL3YxL29hdXRoL2F1dGhvcml6ZVwiLFxuICAgICAgICBzY29wZXM6IF9zY29wZXMsXG4gICAgICAgIHN0YXRlLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgbG9naW5IaW50LFxuICAgICAgICBhZGRpdGlvbmFsUGFyYW1zOiB7XG4gICAgICAgICAgb3duZXI6IFwidXNlclwiXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sXG4gICAgdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZTogYXN5bmMgKHsgY29kZSwgcmVkaXJlY3RVUkkgfSkgPT4ge1xuICAgICAgcmV0dXJuIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGUoe1xuICAgICAgICBjb2RlLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgdG9rZW5FbmRwb2ludCxcbiAgICAgICAgYXV0aGVudGljYXRpb246IFwiYmFzaWNcIlxuICAgICAgfSk7XG4gICAgfSxcbiAgICByZWZyZXNoQWNjZXNzVG9rZW46IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuID8gb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gOiBhc3luYyAocmVmcmVzaFRva2VuKSA9PiB7XG4gICAgICByZXR1cm4gcmVmcmVzaEFjY2Vzc1Rva2VuKHtcbiAgICAgICAgcmVmcmVzaFRva2VuLFxuICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgY2xpZW50SWQ6IG9wdGlvbnMuY2xpZW50SWQsXG4gICAgICAgICAgY2xpZW50S2V5OiBvcHRpb25zLmNsaWVudEtleSxcbiAgICAgICAgICBjbGllbnRTZWNyZXQ6IG9wdGlvbnMuY2xpZW50U2VjcmV0XG4gICAgICAgIH0sXG4gICAgICAgIHRva2VuRW5kcG9pbnRcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgYXN5bmMgZ2V0VXNlckluZm8odG9rZW4pIHtcbiAgICAgIGlmIChvcHRpb25zLmdldFVzZXJJbmZvKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLmdldFVzZXJJbmZvKHRva2VuKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgZGF0YTogcHJvZmlsZSwgZXJyb3IgfSA9IGF3YWl0IGJldHRlckZldGNoKFwiaHR0cHM6Ly9hcGkubm90aW9uLmNvbS92MS91c2Vycy9tZVwiLCB7XG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW4uYWNjZXNzVG9rZW59YCxcbiAgICAgICAgICBcIk5vdGlvbi1WZXJzaW9uXCI6IFwiMjAyMi0wNi0yOFwiXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgaWYgKGVycm9yIHx8ICFwcm9maWxlKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgdXNlclByb2ZpbGUgPSBwcm9maWxlLmJvdD8ub3duZXI/LnVzZXI7XG4gICAgICBpZiAoIXVzZXJQcm9maWxlKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgdXNlck1hcCA9IGF3YWl0IG9wdGlvbnMubWFwUHJvZmlsZVRvVXNlcj8uKHVzZXJQcm9maWxlKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogdXNlclByb2ZpbGUuaWQsXG4gICAgICAgICAgbmFtZTogdXNlclByb2ZpbGUubmFtZSB8fCBcIk5vdGlvbiBVc2VyXCIsXG4gICAgICAgICAgZW1haWw6IHVzZXJQcm9maWxlLnBlcnNvbj8uZW1haWwgfHwgbnVsbCxcbiAgICAgICAgICBpbWFnZTogdXNlclByb2ZpbGUuYXZhdGFyX3VybCxcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiAhIXVzZXJQcm9maWxlLnBlcnNvbj8uZW1haWwsXG4gICAgICAgICAgLi4udXNlck1hcFxuICAgICAgICB9LFxuICAgICAgICBkYXRhOiB1c2VyUHJvZmlsZVxuICAgICAgfTtcbiAgICB9LFxuICAgIG9wdGlvbnNcbiAgfTtcbn07XG5cbmNvbnN0IHNwb3RpZnkgPSAob3B0aW9ucykgPT4ge1xuICByZXR1cm4ge1xuICAgIGlkOiBcInNwb3RpZnlcIixcbiAgICBuYW1lOiBcIlNwb3RpZnlcIixcbiAgICBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHsgc3RhdGUsIHNjb3BlcywgY29kZVZlcmlmaWVyLCByZWRpcmVjdFVSSSB9KSB7XG4gICAgICBjb25zdCBfc2NvcGVzID0gb3B0aW9ucy5kaXNhYmxlRGVmYXVsdFNjb3BlID8gW10gOiBbXCJ1c2VyLXJlYWQtZW1haWxcIl07XG4gICAgICBvcHRpb25zLnNjb3BlICYmIF9zY29wZXMucHVzaCguLi5vcHRpb25zLnNjb3BlKTtcbiAgICAgIHNjb3BlcyAmJiBfc2NvcGVzLnB1c2goLi4uc2NvcGVzKTtcbiAgICAgIHJldHVybiBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHtcbiAgICAgICAgaWQ6IFwic3BvdGlmeVwiLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQ6IFwiaHR0cHM6Ly9hY2NvdW50cy5zcG90aWZ5LmNvbS9hdXRob3JpemVcIixcbiAgICAgICAgc2NvcGVzOiBfc2NvcGVzLFxuICAgICAgICBzdGF0ZSxcbiAgICAgICAgY29kZVZlcmlmaWVyLFxuICAgICAgICByZWRpcmVjdFVSSVxuICAgICAgfSk7XG4gICAgfSxcbiAgICB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlOiBhc3luYyAoeyBjb2RlLCBjb2RlVmVyaWZpZXIsIHJlZGlyZWN0VVJJIH0pID0+IHtcbiAgICAgIHJldHVybiB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlKHtcbiAgICAgICAgY29kZSxcbiAgICAgICAgY29kZVZlcmlmaWVyLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL2FjY291bnRzLnNwb3RpZnkuY29tL2FwaS90b2tlblwiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIHJlZnJlc2hBY2Nlc3NUb2tlbjogb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gPyBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA6IGFzeW5jIChyZWZyZXNoVG9rZW4pID0+IHtcbiAgICAgIHJldHVybiByZWZyZXNoQWNjZXNzVG9rZW4oe1xuICAgICAgICByZWZyZXNoVG9rZW4sXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICBjbGllbnRJZDogb3B0aW9ucy5jbGllbnRJZCxcbiAgICAgICAgICBjbGllbnRLZXk6IG9wdGlvbnMuY2xpZW50S2V5LFxuICAgICAgICAgIGNsaWVudFNlY3JldDogb3B0aW9ucy5jbGllbnRTZWNyZXRcbiAgICAgICAgfSxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL2FjY291bnRzLnNwb3RpZnkuY29tL2FwaS90b2tlblwiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIGFzeW5jIGdldFVzZXJJbmZvKHRva2VuKSB7XG4gICAgICBpZiAob3B0aW9ucy5nZXRVc2VySW5mbykge1xuICAgICAgICByZXR1cm4gb3B0aW9ucy5nZXRVc2VySW5mbyh0b2tlbik7XG4gICAgICB9XG4gICAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUsIGVycm9yIH0gPSBhd2FpdCBiZXR0ZXJGZXRjaChcbiAgICAgICAgXCJodHRwczovL2FwaS5zcG90aWZ5LmNvbS92MS9tZVwiLFxuICAgICAgICB7XG4gICAgICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbi5hY2Nlc3NUb2tlbn1gXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgdXNlck1hcCA9IGF3YWl0IG9wdGlvbnMubWFwUHJvZmlsZVRvVXNlcj8uKHByb2ZpbGUpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGlkOiBwcm9maWxlLmlkLFxuICAgICAgICAgIG5hbWU6IHByb2ZpbGUuZGlzcGxheV9uYW1lLFxuICAgICAgICAgIGVtYWlsOiBwcm9maWxlLmVtYWlsLFxuICAgICAgICAgIGltYWdlOiBwcm9maWxlLmltYWdlc1swXT8udXJsLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IGZhbHNlLFxuICAgICAgICAgIC4uLnVzZXJNYXBcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YTogcHJvZmlsZVxuICAgICAgfTtcbiAgICB9LFxuICAgIG9wdGlvbnNcbiAgfTtcbn07XG5cbmNvbnN0IHR3aXRjaCA9IChvcHRpb25zKSA9PiB7XG4gIHJldHVybiB7XG4gICAgaWQ6IFwidHdpdGNoXCIsXG4gICAgbmFtZTogXCJUd2l0Y2hcIixcbiAgICBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHsgc3RhdGUsIHNjb3BlcywgcmVkaXJlY3RVUkkgfSkge1xuICAgICAgY29uc3QgX3Njb3BlcyA9IG9wdGlvbnMuZGlzYWJsZURlZmF1bHRTY29wZSA/IFtdIDogW1widXNlcjpyZWFkOmVtYWlsXCIsIFwib3BlbmlkXCJdO1xuICAgICAgb3B0aW9ucy5zY29wZSAmJiBfc2NvcGVzLnB1c2goLi4ub3B0aW9ucy5zY29wZSk7XG4gICAgICBzY29wZXMgJiYgX3Njb3Blcy5wdXNoKC4uLnNjb3Blcyk7XG4gICAgICByZXR1cm4gY3JlYXRlQXV0aG9yaXphdGlvblVSTCh7XG4gICAgICAgIGlkOiBcInR3aXRjaFwiLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgYXV0aG9yaXphdGlvbkVuZHBvaW50OiBcImh0dHBzOi8vaWQudHdpdGNoLnR2L29hdXRoMi9hdXRob3JpemVcIixcbiAgICAgICAgc2NvcGVzOiBfc2NvcGVzLFxuICAgICAgICBzdGF0ZSxcbiAgICAgICAgY2xhaW1zOiBvcHRpb25zLmNsYWltcyB8fCBbXG4gICAgICAgICAgXCJlbWFpbFwiLFxuICAgICAgICAgIFwiZW1haWxfdmVyaWZpZWRcIixcbiAgICAgICAgICBcInByZWZlcnJlZF91c2VybmFtZVwiLFxuICAgICAgICAgIFwicGljdHVyZVwiXG4gICAgICAgIF1cbiAgICAgIH0pO1xuICAgIH0sXG4gICAgdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZTogYXN5bmMgKHsgY29kZSwgcmVkaXJlY3RVUkkgfSkgPT4ge1xuICAgICAgcmV0dXJuIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGUoe1xuICAgICAgICBjb2RlLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL2lkLnR3aXRjaC50di9vYXV0aDIvdG9rZW5cIlxuICAgICAgfSk7XG4gICAgfSxcbiAgICByZWZyZXNoQWNjZXNzVG9rZW46IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuID8gb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gOiBhc3luYyAocmVmcmVzaFRva2VuKSA9PiB7XG4gICAgICByZXR1cm4gcmVmcmVzaEFjY2Vzc1Rva2VuKHtcbiAgICAgICAgcmVmcmVzaFRva2VuLFxuICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgY2xpZW50SWQ6IG9wdGlvbnMuY2xpZW50SWQsXG4gICAgICAgICAgY2xpZW50S2V5OiBvcHRpb25zLmNsaWVudEtleSxcbiAgICAgICAgICBjbGllbnRTZWNyZXQ6IG9wdGlvbnMuY2xpZW50U2VjcmV0XG4gICAgICAgIH0sXG4gICAgICAgIHRva2VuRW5kcG9pbnQ6IFwiaHR0cHM6Ly9pZC50d2l0Y2gudHYvb2F1dGgyL3Rva2VuXCJcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgYXN5bmMgZ2V0VXNlckluZm8odG9rZW4pIHtcbiAgICAgIGlmIChvcHRpb25zLmdldFVzZXJJbmZvKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLmdldFVzZXJJbmZvKHRva2VuKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGlkVG9rZW4gPSB0b2tlbi5pZFRva2VuO1xuICAgICAgaWYgKCFpZFRva2VuKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcihcIk5vIGlkVG9rZW4gZm91bmQgaW4gdG9rZW5cIik7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgcHJvZmlsZSA9IGRlY29kZUp3dChpZFRva2VuKTtcbiAgICAgIGNvbnN0IHVzZXJNYXAgPSBhd2FpdCBvcHRpb25zLm1hcFByb2ZpbGVUb1VzZXI/Lihwcm9maWxlKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogcHJvZmlsZS5zdWIsXG4gICAgICAgICAgbmFtZTogcHJvZmlsZS5wcmVmZXJyZWRfdXNlcm5hbWUsXG4gICAgICAgICAgZW1haWw6IHByb2ZpbGUuZW1haWwsXG4gICAgICAgICAgaW1hZ2U6IHByb2ZpbGUucGljdHVyZSxcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiBwcm9maWxlLmVtYWlsX3ZlcmlmaWVkLFxuICAgICAgICAgIC4uLnVzZXJNYXBcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YTogcHJvZmlsZVxuICAgICAgfTtcbiAgICB9LFxuICAgIG9wdGlvbnNcbiAgfTtcbn07XG5cbmNvbnN0IHR3aXR0ZXIgPSAob3B0aW9ucykgPT4ge1xuICByZXR1cm4ge1xuICAgIGlkOiBcInR3aXR0ZXJcIixcbiAgICBuYW1lOiBcIlR3aXR0ZXJcIixcbiAgICBjcmVhdGVBdXRob3JpemF0aW9uVVJMKGRhdGEpIHtcbiAgICAgIGNvbnN0IF9zY29wZXMgPSBvcHRpb25zLmRpc2FibGVEZWZhdWx0U2NvcGUgPyBbXSA6IFtcInVzZXJzLnJlYWRcIiwgXCJ0d2VldC5yZWFkXCIsIFwib2ZmbGluZS5hY2Nlc3NcIiwgXCJ1c2Vycy5lbWFpbFwiXTtcbiAgICAgIG9wdGlvbnMuc2NvcGUgJiYgX3Njb3Blcy5wdXNoKC4uLm9wdGlvbnMuc2NvcGUpO1xuICAgICAgZGF0YS5zY29wZXMgJiYgX3Njb3Blcy5wdXNoKC4uLmRhdGEuc2NvcGVzKTtcbiAgICAgIHJldHVybiBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHtcbiAgICAgICAgaWQ6IFwidHdpdHRlclwiLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQ6IFwiaHR0cHM6Ly94LmNvbS9pL29hdXRoMi9hdXRob3JpemVcIixcbiAgICAgICAgc2NvcGVzOiBfc2NvcGVzLFxuICAgICAgICBzdGF0ZTogZGF0YS5zdGF0ZSxcbiAgICAgICAgY29kZVZlcmlmaWVyOiBkYXRhLmNvZGVWZXJpZmllcixcbiAgICAgICAgcmVkaXJlY3RVUkk6IGRhdGEucmVkaXJlY3RVUklcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZTogYXN5bmMgKHsgY29kZSwgY29kZVZlcmlmaWVyLCByZWRpcmVjdFVSSSB9KSA9PiB7XG4gICAgICByZXR1cm4gdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZSh7XG4gICAgICAgIGNvZGUsXG4gICAgICAgIGNvZGVWZXJpZmllcixcbiAgICAgICAgYXV0aGVudGljYXRpb246IFwiYmFzaWNcIixcbiAgICAgICAgcmVkaXJlY3RVUkksXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIHRva2VuRW5kcG9pbnQ6IFwiaHR0cHM6Ly9hcGkueC5jb20vMi9vYXV0aDIvdG9rZW5cIlxuICAgICAgfSk7XG4gICAgfSxcbiAgICByZWZyZXNoQWNjZXNzVG9rZW46IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuID8gb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gOiBhc3luYyAocmVmcmVzaFRva2VuKSA9PiB7XG4gICAgICByZXR1cm4gcmVmcmVzaEFjY2Vzc1Rva2VuKHtcbiAgICAgICAgcmVmcmVzaFRva2VuLFxuICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgY2xpZW50SWQ6IG9wdGlvbnMuY2xpZW50SWQsXG4gICAgICAgICAgY2xpZW50S2V5OiBvcHRpb25zLmNsaWVudEtleSxcbiAgICAgICAgICBjbGllbnRTZWNyZXQ6IG9wdGlvbnMuY2xpZW50U2VjcmV0XG4gICAgICAgIH0sXG4gICAgICAgIHRva2VuRW5kcG9pbnQ6IFwiaHR0cHM6Ly9hcGkueC5jb20vMi9vYXV0aDIvdG9rZW5cIlxuICAgICAgfSk7XG4gICAgfSxcbiAgICBhc3luYyBnZXRVc2VySW5mbyh0b2tlbikge1xuICAgICAgaWYgKG9wdGlvbnMuZ2V0VXNlckluZm8pIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMuZ2V0VXNlckluZm8odG9rZW4pO1xuICAgICAgfVxuICAgICAgY29uc3QgeyBkYXRhOiBwcm9maWxlLCBlcnJvcjogcHJvZmlsZUVycm9yIH0gPSBhd2FpdCBiZXR0ZXJGZXRjaChcbiAgICAgICAgXCJodHRwczovL2FwaS54LmNvbS8yL3VzZXJzL21lP3VzZXIuZmllbGRzPXByb2ZpbGVfaW1hZ2VfdXJsXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VuLmFjY2Vzc1Rva2VufWBcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBpZiAocHJvZmlsZUVycm9yKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgeyBkYXRhOiBlbWFpbERhdGEsIGVycm9yOiBlbWFpbEVycm9yIH0gPSBhd2FpdCBiZXR0ZXJGZXRjaChcImh0dHBzOi8vYXBpLnguY29tLzIvdXNlcnMvbWU/dXNlci5maWVsZHM9Y29uZmlybWVkX2VtYWlsXCIsIHtcbiAgICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VuLmFjY2Vzc1Rva2VufWBcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBsZXQgZW1haWxWZXJpZmllZCA9IGZhbHNlO1xuICAgICAgaWYgKCFlbWFpbEVycm9yICYmIGVtYWlsRGF0YT8uZGF0YT8uY29uZmlybWVkX2VtYWlsKSB7XG4gICAgICAgIHByb2ZpbGUuZGF0YS5lbWFpbCA9IGVtYWlsRGF0YS5kYXRhLmNvbmZpcm1lZF9lbWFpbDtcbiAgICAgICAgZW1haWxWZXJpZmllZCA9IHRydWU7XG4gICAgICB9XG4gICAgICBjb25zdCB1c2VyTWFwID0gYXdhaXQgb3B0aW9ucy5tYXBQcm9maWxlVG9Vc2VyPy4ocHJvZmlsZSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IHByb2ZpbGUuZGF0YS5pZCxcbiAgICAgICAgICBuYW1lOiBwcm9maWxlLmRhdGEubmFtZSxcbiAgICAgICAgICBlbWFpbDogcHJvZmlsZS5kYXRhLmVtYWlsIHx8IHByb2ZpbGUuZGF0YS51c2VybmFtZSB8fCBudWxsLFxuICAgICAgICAgIGltYWdlOiBwcm9maWxlLmRhdGEucHJvZmlsZV9pbWFnZV91cmwsXG4gICAgICAgICAgZW1haWxWZXJpZmllZCxcbiAgICAgICAgICAuLi51c2VyTWFwXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGE6IHByb2ZpbGVcbiAgICAgIH07XG4gICAgfSxcbiAgICBvcHRpb25zXG4gIH07XG59O1xuXG5jb25zdCBkcm9wYm94ID0gKG9wdGlvbnMpID0+IHtcbiAgY29uc3QgdG9rZW5FbmRwb2ludCA9IFwiaHR0cHM6Ly9hcGkuZHJvcGJveGFwaS5jb20vb2F1dGgyL3Rva2VuXCI7XG4gIHJldHVybiB7XG4gICAgaWQ6IFwiZHJvcGJveFwiLFxuICAgIG5hbWU6IFwiRHJvcGJveFwiLFxuICAgIGNyZWF0ZUF1dGhvcml6YXRpb25VUkw6IGFzeW5jICh7XG4gICAgICBzdGF0ZSxcbiAgICAgIHNjb3BlcyxcbiAgICAgIGNvZGVWZXJpZmllcixcbiAgICAgIHJlZGlyZWN0VVJJXG4gICAgfSkgPT4ge1xuICAgICAgY29uc3QgX3Njb3BlcyA9IG9wdGlvbnMuZGlzYWJsZURlZmF1bHRTY29wZSA/IFtdIDogW1wiYWNjb3VudF9pbmZvLnJlYWRcIl07XG4gICAgICBvcHRpb25zLnNjb3BlICYmIF9zY29wZXMucHVzaCguLi5vcHRpb25zLnNjb3BlKTtcbiAgICAgIHNjb3BlcyAmJiBfc2NvcGVzLnB1c2goLi4uc2NvcGVzKTtcbiAgICAgIGNvbnN0IGFkZGl0aW9uYWxQYXJhbXMgPSB7fTtcbiAgICAgIGlmIChvcHRpb25zLmFjY2Vzc1R5cGUpIHtcbiAgICAgICAgYWRkaXRpb25hbFBhcmFtcy50b2tlbl9hY2Nlc3NfdHlwZSA9IG9wdGlvbnMuYWNjZXNzVHlwZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhd2FpdCBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHtcbiAgICAgICAgaWQ6IFwiZHJvcGJveFwiLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQ6IFwiaHR0cHM6Ly93d3cuZHJvcGJveC5jb20vb2F1dGgyL2F1dGhvcml6ZVwiLFxuICAgICAgICBzY29wZXM6IF9zY29wZXMsXG4gICAgICAgIHN0YXRlLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgY29kZVZlcmlmaWVyLFxuICAgICAgICBhZGRpdGlvbmFsUGFyYW1zXG4gICAgICB9KTtcbiAgICB9LFxuICAgIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGU6IGFzeW5jICh7IGNvZGUsIGNvZGVWZXJpZmllciwgcmVkaXJlY3RVUkkgfSkgPT4ge1xuICAgICAgcmV0dXJuIGF3YWl0IHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGUoe1xuICAgICAgICBjb2RlLFxuICAgICAgICBjb2RlVmVyaWZpZXIsXG4gICAgICAgIHJlZGlyZWN0VVJJLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICB0b2tlbkVuZHBvaW50XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHJlZnJlc2hBY2Nlc3NUb2tlbjogb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gPyBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA6IGFzeW5jIChyZWZyZXNoVG9rZW4pID0+IHtcbiAgICAgIHJldHVybiByZWZyZXNoQWNjZXNzVG9rZW4oe1xuICAgICAgICByZWZyZXNoVG9rZW4sXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICBjbGllbnRJZDogb3B0aW9ucy5jbGllbnRJZCxcbiAgICAgICAgICBjbGllbnRLZXk6IG9wdGlvbnMuY2xpZW50S2V5LFxuICAgICAgICAgIGNsaWVudFNlY3JldDogb3B0aW9ucy5jbGllbnRTZWNyZXRcbiAgICAgICAgfSxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL2FwaS5kcm9wYm94LmNvbS9vYXV0aDIvdG9rZW5cIlxuICAgICAgfSk7XG4gICAgfSxcbiAgICBhc3luYyBnZXRVc2VySW5mbyh0b2tlbikge1xuICAgICAgaWYgKG9wdGlvbnMuZ2V0VXNlckluZm8pIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMuZ2V0VXNlckluZm8odG9rZW4pO1xuICAgICAgfVxuICAgICAgY29uc3QgeyBkYXRhOiBwcm9maWxlLCBlcnJvciB9ID0gYXdhaXQgYmV0dGVyRmV0Y2goXG4gICAgICAgIFwiaHR0cHM6Ly9hcGkuZHJvcGJveGFwaS5jb20vMi91c2Vycy9nZXRfY3VycmVudF9hY2NvdW50XCIsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbi5hY2Nlc3NUb2tlbn1gXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgdXNlck1hcCA9IGF3YWl0IG9wdGlvbnMubWFwUHJvZmlsZVRvVXNlcj8uKHByb2ZpbGUpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGlkOiBwcm9maWxlLmFjY291bnRfaWQsXG4gICAgICAgICAgbmFtZTogcHJvZmlsZS5uYW1lPy5kaXNwbGF5X25hbWUsXG4gICAgICAgICAgZW1haWw6IHByb2ZpbGUuZW1haWwsXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogcHJvZmlsZS5lbWFpbF92ZXJpZmllZCB8fCBmYWxzZSxcbiAgICAgICAgICBpbWFnZTogcHJvZmlsZS5wcm9maWxlX3Bob3RvX3VybCxcbiAgICAgICAgICAuLi51c2VyTWFwXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGE6IHByb2ZpbGVcbiAgICAgIH07XG4gICAgfSxcbiAgICBvcHRpb25zXG4gIH07XG59O1xuXG5jb25zdCBsaW5lYXIgPSAob3B0aW9ucykgPT4ge1xuICBjb25zdCB0b2tlbkVuZHBvaW50ID0gXCJodHRwczovL2FwaS5saW5lYXIuYXBwL29hdXRoL3Rva2VuXCI7XG4gIHJldHVybiB7XG4gICAgaWQ6IFwibGluZWFyXCIsXG4gICAgbmFtZTogXCJMaW5lYXJcIixcbiAgICBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHsgc3RhdGUsIHNjb3BlcywgbG9naW5IaW50LCByZWRpcmVjdFVSSSB9KSB7XG4gICAgICBjb25zdCBfc2NvcGVzID0gb3B0aW9ucy5kaXNhYmxlRGVmYXVsdFNjb3BlID8gW10gOiBbXCJyZWFkXCJdO1xuICAgICAgb3B0aW9ucy5zY29wZSAmJiBfc2NvcGVzLnB1c2goLi4ub3B0aW9ucy5zY29wZSk7XG4gICAgICBzY29wZXMgJiYgX3Njb3Blcy5wdXNoKC4uLnNjb3Blcyk7XG4gICAgICByZXR1cm4gY3JlYXRlQXV0aG9yaXphdGlvblVSTCh7XG4gICAgICAgIGlkOiBcImxpbmVhclwiLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQ6IFwiaHR0cHM6Ly9saW5lYXIuYXBwL29hdXRoL2F1dGhvcml6ZVwiLFxuICAgICAgICBzY29wZXM6IF9zY29wZXMsXG4gICAgICAgIHN0YXRlLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgbG9naW5IaW50XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGU6IGFzeW5jICh7IGNvZGUsIHJlZGlyZWN0VVJJIH0pID0+IHtcbiAgICAgIHJldHVybiB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlKHtcbiAgICAgICAgY29kZSxcbiAgICAgICAgcmVkaXJlY3RVUkksXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIHRva2VuRW5kcG9pbnRcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgcmVmcmVzaEFjY2Vzc1Rva2VuOiBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA/IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuIDogYXN5bmMgKHJlZnJlc2hUb2tlbikgPT4ge1xuICAgICAgcmV0dXJuIHJlZnJlc2hBY2Nlc3NUb2tlbih7XG4gICAgICAgIHJlZnJlc2hUb2tlbixcbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgIGNsaWVudElkOiBvcHRpb25zLmNsaWVudElkLFxuICAgICAgICAgIGNsaWVudEtleTogb3B0aW9ucy5jbGllbnRLZXksXG4gICAgICAgICAgY2xpZW50U2VjcmV0OiBvcHRpb25zLmNsaWVudFNlY3JldFxuICAgICAgICB9LFxuICAgICAgICB0b2tlbkVuZHBvaW50XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGFzeW5jIGdldFVzZXJJbmZvKHRva2VuKSB7XG4gICAgICBpZiAob3B0aW9ucy5nZXRVc2VySW5mbykge1xuICAgICAgICByZXR1cm4gb3B0aW9ucy5nZXRVc2VySW5mbyh0b2tlbik7XG4gICAgICB9XG4gICAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUsIGVycm9yIH0gPSBhd2FpdCBiZXR0ZXJGZXRjaChcbiAgICAgICAgXCJodHRwczovL2FwaS5saW5lYXIuYXBwL2dyYXBocWxcIixcbiAgICAgICAge1xuICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW4uYWNjZXNzVG9rZW59YFxuICAgICAgICAgIH0sXG4gICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgcXVlcnk6IGBcblx0XHRcdFx0XHRcdFx0cXVlcnkge1xuXHRcdFx0XHRcdFx0XHRcdHZpZXdlciB7XG5cdFx0XHRcdFx0XHRcdFx0XHRpZFxuXHRcdFx0XHRcdFx0XHRcdFx0bmFtZVxuXHRcdFx0XHRcdFx0XHRcdFx0ZW1haWxcblx0XHRcdFx0XHRcdFx0XHRcdGF2YXRhclVybFxuXHRcdFx0XHRcdFx0XHRcdFx0YWN0aXZlXG5cdFx0XHRcdFx0XHRcdFx0XHRjcmVhdGVkQXRcblx0XHRcdFx0XHRcdFx0XHRcdHVwZGF0ZWRBdFxuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0YFxuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBpZiAoZXJyb3IgfHwgIXByb2ZpbGU/LmRhdGE/LnZpZXdlcikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHVzZXJEYXRhID0gcHJvZmlsZS5kYXRhLnZpZXdlcjtcbiAgICAgIGNvbnN0IHVzZXJNYXAgPSBhd2FpdCBvcHRpb25zLm1hcFByb2ZpbGVUb1VzZXI/Lih1c2VyRGF0YSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IHByb2ZpbGUuZGF0YS52aWV3ZXIuaWQsXG4gICAgICAgICAgbmFtZTogcHJvZmlsZS5kYXRhLnZpZXdlci5uYW1lLFxuICAgICAgICAgIGVtYWlsOiBwcm9maWxlLmRhdGEudmlld2VyLmVtYWlsLFxuICAgICAgICAgIGltYWdlOiBwcm9maWxlLmRhdGEudmlld2VyLmF2YXRhclVybCxcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiB0cnVlLFxuICAgICAgICAgIC4uLnVzZXJNYXBcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YTogdXNlckRhdGFcbiAgICAgIH07XG4gICAgfSxcbiAgICBvcHRpb25zXG4gIH07XG59O1xuXG5jb25zdCBsaW5rZWRpbiA9IChvcHRpb25zKSA9PiB7XG4gIGNvbnN0IGF1dGhvcml6YXRpb25FbmRwb2ludCA9IFwiaHR0cHM6Ly93d3cubGlua2VkaW4uY29tL29hdXRoL3YyL2F1dGhvcml6YXRpb25cIjtcbiAgY29uc3QgdG9rZW5FbmRwb2ludCA9IFwiaHR0cHM6Ly93d3cubGlua2VkaW4uY29tL29hdXRoL3YyL2FjY2Vzc1Rva2VuXCI7XG4gIHJldHVybiB7XG4gICAgaWQ6IFwibGlua2VkaW5cIixcbiAgICBuYW1lOiBcIkxpbmtlZGluXCIsXG4gICAgY3JlYXRlQXV0aG9yaXphdGlvblVSTDogYXN5bmMgKHtcbiAgICAgIHN0YXRlLFxuICAgICAgc2NvcGVzLFxuICAgICAgcmVkaXJlY3RVUkksXG4gICAgICBsb2dpbkhpbnRcbiAgICB9KSA9PiB7XG4gICAgICBjb25zdCBfc2NvcGVzID0gb3B0aW9ucy5kaXNhYmxlRGVmYXVsdFNjb3BlID8gW10gOiBbXCJwcm9maWxlXCIsIFwiZW1haWxcIiwgXCJvcGVuaWRcIl07XG4gICAgICBvcHRpb25zLnNjb3BlICYmIF9zY29wZXMucHVzaCguLi5vcHRpb25zLnNjb3BlKTtcbiAgICAgIHNjb3BlcyAmJiBfc2NvcGVzLnB1c2goLi4uc2NvcGVzKTtcbiAgICAgIHJldHVybiBhd2FpdCBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHtcbiAgICAgICAgaWQ6IFwibGlua2VkaW5cIixcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgYXV0aG9yaXphdGlvbkVuZHBvaW50LFxuICAgICAgICBzY29wZXM6IF9zY29wZXMsXG4gICAgICAgIHN0YXRlLFxuICAgICAgICBsb2dpbkhpbnQsXG4gICAgICAgIHJlZGlyZWN0VVJJXG4gICAgICB9KTtcbiAgICB9LFxuICAgIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGU6IGFzeW5jICh7IGNvZGUsIHJlZGlyZWN0VVJJIH0pID0+IHtcbiAgICAgIHJldHVybiBhd2FpdCB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlKHtcbiAgICAgICAgY29kZSxcbiAgICAgICAgcmVkaXJlY3RVUkksXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIHRva2VuRW5kcG9pbnRcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgcmVmcmVzaEFjY2Vzc1Rva2VuOiBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA/IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuIDogYXN5bmMgKHJlZnJlc2hUb2tlbikgPT4ge1xuICAgICAgcmV0dXJuIHJlZnJlc2hBY2Nlc3NUb2tlbih7XG4gICAgICAgIHJlZnJlc2hUb2tlbixcbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgIGNsaWVudElkOiBvcHRpb25zLmNsaWVudElkLFxuICAgICAgICAgIGNsaWVudEtleTogb3B0aW9ucy5jbGllbnRLZXksXG4gICAgICAgICAgY2xpZW50U2VjcmV0OiBvcHRpb25zLmNsaWVudFNlY3JldFxuICAgICAgICB9LFxuICAgICAgICB0b2tlbkVuZHBvaW50XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGFzeW5jIGdldFVzZXJJbmZvKHRva2VuKSB7XG4gICAgICBpZiAob3B0aW9ucy5nZXRVc2VySW5mbykge1xuICAgICAgICByZXR1cm4gb3B0aW9ucy5nZXRVc2VySW5mbyh0b2tlbik7XG4gICAgICB9XG4gICAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUsIGVycm9yIH0gPSBhd2FpdCBiZXR0ZXJGZXRjaChcbiAgICAgICAgXCJodHRwczovL2FwaS5saW5rZWRpbi5jb20vdjIvdXNlcmluZm9cIixcbiAgICAgICAge1xuICAgICAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW4uYWNjZXNzVG9rZW59YFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHVzZXJNYXAgPSBhd2FpdCBvcHRpb25zLm1hcFByb2ZpbGVUb1VzZXI/Lihwcm9maWxlKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogcHJvZmlsZS5zdWIsXG4gICAgICAgICAgbmFtZTogcHJvZmlsZS5uYW1lLFxuICAgICAgICAgIGVtYWlsOiBwcm9maWxlLmVtYWlsLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IHByb2ZpbGUuZW1haWxfdmVyaWZpZWQgfHwgZmFsc2UsXG4gICAgICAgICAgaW1hZ2U6IHByb2ZpbGUucGljdHVyZSxcbiAgICAgICAgICAuLi51c2VyTWFwXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGE6IHByb2ZpbGVcbiAgICAgIH07XG4gICAgfSxcbiAgICBvcHRpb25zXG4gIH07XG59O1xuXG5jb25zdCBjbGVhbkRvdWJsZVNsYXNoZXMgPSAoaW5wdXQgPSBcIlwiKSA9PiB7XG4gIHJldHVybiBpbnB1dC5zcGxpdChcIjovL1wiKS5tYXAoKHN0cikgPT4gc3RyLnJlcGxhY2UoL1xcL3syLH0vZywgXCIvXCIpKS5qb2luKFwiOi8vXCIpO1xufTtcbmNvbnN0IGlzc3VlclRvRW5kcG9pbnRzID0gKGlzc3VlcikgPT4ge1xuICBsZXQgYmFzZVVybCA9IGlzc3VlciB8fCBcImh0dHBzOi8vZ2l0bGFiLmNvbVwiO1xuICByZXR1cm4ge1xuICAgIGF1dGhvcml6YXRpb25FbmRwb2ludDogY2xlYW5Eb3VibGVTbGFzaGVzKGAke2Jhc2VVcmx9L29hdXRoL2F1dGhvcml6ZWApLFxuICAgIHRva2VuRW5kcG9pbnQ6IGNsZWFuRG91YmxlU2xhc2hlcyhgJHtiYXNlVXJsfS9vYXV0aC90b2tlbmApLFxuICAgIHVzZXJpbmZvRW5kcG9pbnQ6IGNsZWFuRG91YmxlU2xhc2hlcyhgJHtiYXNlVXJsfS9hcGkvdjQvdXNlcmApXG4gIH07XG59O1xuY29uc3QgZ2l0bGFiID0gKG9wdGlvbnMpID0+IHtcbiAgY29uc3QgeyBhdXRob3JpemF0aW9uRW5kcG9pbnQsIHRva2VuRW5kcG9pbnQsIHVzZXJpbmZvRW5kcG9pbnQgfSA9IGlzc3VlclRvRW5kcG9pbnRzKG9wdGlvbnMuaXNzdWVyKTtcbiAgY29uc3QgaXNzdWVySWQgPSBcImdpdGxhYlwiO1xuICBjb25zdCBpc3N1ZXJOYW1lID0gXCJHaXRsYWJcIjtcbiAgcmV0dXJuIHtcbiAgICBpZDogaXNzdWVySWQsXG4gICAgbmFtZTogaXNzdWVyTmFtZSxcbiAgICBjcmVhdGVBdXRob3JpemF0aW9uVVJMOiBhc3luYyAoe1xuICAgICAgc3RhdGUsXG4gICAgICBzY29wZXMsXG4gICAgICBjb2RlVmVyaWZpZXIsXG4gICAgICBsb2dpbkhpbnQsXG4gICAgICByZWRpcmVjdFVSSVxuICAgIH0pID0+IHtcbiAgICAgIGNvbnN0IF9zY29wZXMgPSBvcHRpb25zLmRpc2FibGVEZWZhdWx0U2NvcGUgPyBbXSA6IFtcInJlYWRfdXNlclwiXTtcbiAgICAgIG9wdGlvbnMuc2NvcGUgJiYgX3Njb3Blcy5wdXNoKC4uLm9wdGlvbnMuc2NvcGUpO1xuICAgICAgc2NvcGVzICYmIF9zY29wZXMucHVzaCguLi5zY29wZXMpO1xuICAgICAgcmV0dXJuIGF3YWl0IGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoe1xuICAgICAgICBpZDogaXNzdWVySWQsXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIGF1dGhvcml6YXRpb25FbmRwb2ludCxcbiAgICAgICAgc2NvcGVzOiBfc2NvcGVzLFxuICAgICAgICBzdGF0ZSxcbiAgICAgICAgcmVkaXJlY3RVUkksXG4gICAgICAgIGNvZGVWZXJpZmllcixcbiAgICAgICAgbG9naW5IaW50XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGU6IGFzeW5jICh7IGNvZGUsIHJlZGlyZWN0VVJJLCBjb2RlVmVyaWZpZXIgfSkgPT4ge1xuICAgICAgcmV0dXJuIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGUoe1xuICAgICAgICBjb2RlLFxuICAgICAgICByZWRpcmVjdFVSSSxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgY29kZVZlcmlmaWVyLFxuICAgICAgICB0b2tlbkVuZHBvaW50XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHJlZnJlc2hBY2Nlc3NUb2tlbjogb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gPyBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA6IGFzeW5jIChyZWZyZXNoVG9rZW4pID0+IHtcbiAgICAgIHJldHVybiByZWZyZXNoQWNjZXNzVG9rZW4oe1xuICAgICAgICByZWZyZXNoVG9rZW4sXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICBjbGllbnRJZDogb3B0aW9ucy5jbGllbnRJZCxcbiAgICAgICAgICBjbGllbnRLZXk6IG9wdGlvbnMuY2xpZW50S2V5LFxuICAgICAgICAgIGNsaWVudFNlY3JldDogb3B0aW9ucy5jbGllbnRTZWNyZXRcbiAgICAgICAgfSxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL2dpdGxhYi5jb20vb2F1dGgvdG9rZW5cIlxuICAgICAgfSk7XG4gICAgfSxcbiAgICBhc3luYyBnZXRVc2VySW5mbyh0b2tlbikge1xuICAgICAgaWYgKG9wdGlvbnMuZ2V0VXNlckluZm8pIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMuZ2V0VXNlckluZm8odG9rZW4pO1xuICAgICAgfVxuICAgICAgY29uc3QgeyBkYXRhOiBwcm9maWxlLCBlcnJvciB9ID0gYXdhaXQgYmV0dGVyRmV0Y2goXG4gICAgICAgIHVzZXJpbmZvRW5kcG9pbnQsXG4gICAgICAgIHsgaGVhZGVyczogeyBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW4uYWNjZXNzVG9rZW59YCB9IH1cbiAgICAgICk7XG4gICAgICBpZiAoZXJyb3IgfHwgcHJvZmlsZS5zdGF0ZSAhPT0gXCJhY3RpdmVcIiB8fCBwcm9maWxlLmxvY2tlZCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHVzZXJNYXAgPSBhd2FpdCBvcHRpb25zLm1hcFByb2ZpbGVUb1VzZXI/Lihwcm9maWxlKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogcHJvZmlsZS5pZC50b1N0cmluZygpLFxuICAgICAgICAgIG5hbWU6IHByb2ZpbGUubmFtZSA/PyBwcm9maWxlLnVzZXJuYW1lLFxuICAgICAgICAgIGVtYWlsOiBwcm9maWxlLmVtYWlsLFxuICAgICAgICAgIGltYWdlOiBwcm9maWxlLmF2YXRhcl91cmwsXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogdHJ1ZSxcbiAgICAgICAgICAuLi51c2VyTWFwXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGE6IHByb2ZpbGVcbiAgICAgIH07XG4gICAgfSxcbiAgICBvcHRpb25zXG4gIH07XG59O1xuXG5jb25zdCB0aWt0b2sgPSAob3B0aW9ucykgPT4ge1xuICByZXR1cm4ge1xuICAgIGlkOiBcInRpa3Rva1wiLFxuICAgIG5hbWU6IFwiVGlrVG9rXCIsXG4gICAgY3JlYXRlQXV0aG9yaXphdGlvblVSTCh7IHN0YXRlLCBzY29wZXMsIHJlZGlyZWN0VVJJIH0pIHtcbiAgICAgIGNvbnN0IF9zY29wZXMgPSBvcHRpb25zLmRpc2FibGVEZWZhdWx0U2NvcGUgPyBbXSA6IFtcInVzZXIuaW5mby5wcm9maWxlXCJdO1xuICAgICAgb3B0aW9ucy5zY29wZSAmJiBfc2NvcGVzLnB1c2goLi4ub3B0aW9ucy5zY29wZSk7XG4gICAgICBzY29wZXMgJiYgX3Njb3Blcy5wdXNoKC4uLnNjb3Blcyk7XG4gICAgICByZXR1cm4gbmV3IFVSTChcbiAgICAgICAgYGh0dHBzOi8vd3d3LnRpa3Rvay5jb20vdjIvYXV0aC9hdXRob3JpemU/c2NvcGU9JHtfc2NvcGVzLmpvaW4oXG4gICAgICAgICAgXCIsXCJcbiAgICAgICAgKX0mcmVzcG9uc2VfdHlwZT1jb2RlJmNsaWVudF9rZXk9JHtvcHRpb25zLmNsaWVudEtleX0mY2xpZW50X3NlY3JldD0ke29wdGlvbnMuY2xpZW50U2VjcmV0fSZyZWRpcmVjdF91cmk9JHtlbmNvZGVVUklDb21wb25lbnQoXG4gICAgICAgICAgb3B0aW9ucy5yZWRpcmVjdFVSSSB8fCByZWRpcmVjdFVSSVxuICAgICAgICApfSZzdGF0ZT0ke3N0YXRlfWBcbiAgICAgICk7XG4gICAgfSxcbiAgICB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlOiBhc3luYyAoeyBjb2RlLCByZWRpcmVjdFVSSSB9KSA9PiB7XG4gICAgICByZXR1cm4gdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZSh7XG4gICAgICAgIGNvZGUsXG4gICAgICAgIHJlZGlyZWN0VVJJOiBvcHRpb25zLnJlZGlyZWN0VVJJIHx8IHJlZGlyZWN0VVJJLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICB0b2tlbkVuZHBvaW50OiBcImh0dHBzOi8vb3Blbi50aWt0b2thcGlzLmNvbS92Mi9vYXV0aC90b2tlbi9cIlxuICAgICAgfSk7XG4gICAgfSxcbiAgICByZWZyZXNoQWNjZXNzVG9rZW46IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuID8gb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gOiBhc3luYyAocmVmcmVzaFRva2VuKSA9PiB7XG4gICAgICByZXR1cm4gcmVmcmVzaEFjY2Vzc1Rva2VuKHtcbiAgICAgICAgcmVmcmVzaFRva2VuLFxuICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgY2xpZW50SWQ6IG9wdGlvbnMuY2xpZW50SWQsXG4gICAgICAgICAgY2xpZW50S2V5OiBvcHRpb25zLmNsaWVudEtleSxcbiAgICAgICAgICBjbGllbnRTZWNyZXQ6IG9wdGlvbnMuY2xpZW50U2VjcmV0XG4gICAgICAgIH0sXG4gICAgICAgIHRva2VuRW5kcG9pbnQ6IFwiaHR0cHM6Ly9vcGVuLnRpa3Rva2FwaXMuY29tL3YyL29hdXRoL3Rva2VuL1wiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIGFzeW5jIGdldFVzZXJJbmZvKHRva2VuKSB7XG4gICAgICBpZiAob3B0aW9ucy5nZXRVc2VySW5mbykge1xuICAgICAgICByZXR1cm4gb3B0aW9ucy5nZXRVc2VySW5mbyh0b2tlbik7XG4gICAgICB9XG4gICAgICBjb25zdCBmaWVsZHMgPSBbXG4gICAgICAgIFwib3Blbl9pZFwiLFxuICAgICAgICBcImF2YXRhcl9sYXJnZV91cmxcIixcbiAgICAgICAgXCJkaXNwbGF5X25hbWVcIixcbiAgICAgICAgXCJ1c2VybmFtZVwiXG4gICAgICBdO1xuICAgICAgY29uc3QgeyBkYXRhOiBwcm9maWxlLCBlcnJvciB9ID0gYXdhaXQgYmV0dGVyRmV0Y2goXG4gICAgICAgIGBodHRwczovL29wZW4udGlrdG9rYXBpcy5jb20vdjIvdXNlci9pbmZvLz9maWVsZHM9JHtmaWVsZHMuam9pbihcIixcIil9YCxcbiAgICAgICAge1xuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbi5hY2Nlc3NUb2tlbn1gXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGVtYWlsOiBwcm9maWxlLmRhdGEudXNlci5lbWFpbCB8fCBwcm9maWxlLmRhdGEudXNlci51c2VybmFtZSxcbiAgICAgICAgICBpZDogcHJvZmlsZS5kYXRhLnVzZXIub3Blbl9pZCxcbiAgICAgICAgICBuYW1lOiBwcm9maWxlLmRhdGEudXNlci5kaXNwbGF5X25hbWUgfHwgcHJvZmlsZS5kYXRhLnVzZXIudXNlcm5hbWUsXG4gICAgICAgICAgaW1hZ2U6IHByb2ZpbGUuZGF0YS51c2VyLmF2YXRhcl9sYXJnZV91cmwsXG4gICAgICAgICAgLyoqIEBub3RlIFRpa3RvayBkb2VzIG5vdCBwcm92aWRlIGVtYWlsVmVyaWZpZWQgb3IgZXZlbiBlbWFpbCovXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogcHJvZmlsZS5kYXRhLnVzZXIuZW1haWwgPyB0cnVlIDogZmFsc2VcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YTogcHJvZmlsZVxuICAgICAgfTtcbiAgICB9LFxuICAgIG9wdGlvbnNcbiAgfTtcbn07XG5cbmNvbnN0IHJlZGRpdCA9IChvcHRpb25zKSA9PiB7XG4gIHJldHVybiB7XG4gICAgaWQ6IFwicmVkZGl0XCIsXG4gICAgbmFtZTogXCJSZWRkaXRcIixcbiAgICBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHsgc3RhdGUsIHNjb3BlcywgcmVkaXJlY3RVUkkgfSkge1xuICAgICAgY29uc3QgX3Njb3BlcyA9IG9wdGlvbnMuZGlzYWJsZURlZmF1bHRTY29wZSA/IFtdIDogW1wiaWRlbnRpdHlcIl07XG4gICAgICBvcHRpb25zLnNjb3BlICYmIF9zY29wZXMucHVzaCguLi5vcHRpb25zLnNjb3BlKTtcbiAgICAgIHNjb3BlcyAmJiBfc2NvcGVzLnB1c2goLi4uc2NvcGVzKTtcbiAgICAgIHJldHVybiBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHtcbiAgICAgICAgaWQ6IFwicmVkZGl0XCIsXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIGF1dGhvcml6YXRpb25FbmRwb2ludDogXCJodHRwczovL3d3dy5yZWRkaXQuY29tL2FwaS92MS9hdXRob3JpemVcIixcbiAgICAgICAgc2NvcGVzOiBfc2NvcGVzLFxuICAgICAgICBzdGF0ZSxcbiAgICAgICAgcmVkaXJlY3RVUkksXG4gICAgICAgIGR1cmF0aW9uOiBvcHRpb25zLmR1cmF0aW9uXG4gICAgICB9KTtcbiAgICB9LFxuICAgIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGU6IGFzeW5jICh7IGNvZGUsIHJlZGlyZWN0VVJJIH0pID0+IHtcbiAgICAgIGNvbnN0IGJvZHkgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHtcbiAgICAgICAgZ3JhbnRfdHlwZTogXCJhdXRob3JpemF0aW9uX2NvZGVcIixcbiAgICAgICAgY29kZSxcbiAgICAgICAgcmVkaXJlY3RfdXJpOiBvcHRpb25zLnJlZGlyZWN0VVJJIHx8IHJlZGlyZWN0VVJJXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGhlYWRlcnMgPSB7XG4gICAgICAgIFwiY29udGVudC10eXBlXCI6IFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCIsXG4gICAgICAgIGFjY2VwdDogXCJ0ZXh0L3BsYWluXCIsXG4gICAgICAgIFwidXNlci1hZ2VudFwiOiBcImJldHRlci1hdXRoXCIsXG4gICAgICAgIEF1dGhvcml6YXRpb246IGBCYXNpYyAke2Jhc2U2NC5lbmNvZGUoXG4gICAgICAgICAgYCR7b3B0aW9ucy5jbGllbnRJZH06JHtvcHRpb25zLmNsaWVudFNlY3JldH1gXG4gICAgICAgICl9YFxuICAgICAgfTtcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IGJldHRlckZldGNoKFxuICAgICAgICBcImh0dHBzOi8vd3d3LnJlZGRpdC5jb20vYXBpL3YxL2FjY2Vzc190b2tlblwiLFxuICAgICAgICB7XG4gICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICBoZWFkZXJzLFxuICAgICAgICAgIGJvZHk6IGJvZHkudG9TdHJpbmcoKVxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGdldE9BdXRoMlRva2VucyhkYXRhKTtcbiAgICB9LFxuICAgIHJlZnJlc2hBY2Nlc3NUb2tlbjogb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gPyBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA6IGFzeW5jIChyZWZyZXNoVG9rZW4pID0+IHtcbiAgICAgIHJldHVybiByZWZyZXNoQWNjZXNzVG9rZW4oe1xuICAgICAgICByZWZyZXNoVG9rZW4sXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICBjbGllbnRJZDogb3B0aW9ucy5jbGllbnRJZCxcbiAgICAgICAgICBjbGllbnRLZXk6IG9wdGlvbnMuY2xpZW50S2V5LFxuICAgICAgICAgIGNsaWVudFNlY3JldDogb3B0aW9ucy5jbGllbnRTZWNyZXRcbiAgICAgICAgfSxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL3d3dy5yZWRkaXQuY29tL2FwaS92MS9hY2Nlc3NfdG9rZW5cIlxuICAgICAgfSk7XG4gICAgfSxcbiAgICBhc3luYyBnZXRVc2VySW5mbyh0b2tlbikge1xuICAgICAgaWYgKG9wdGlvbnMuZ2V0VXNlckluZm8pIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMuZ2V0VXNlckluZm8odG9rZW4pO1xuICAgICAgfVxuICAgICAgY29uc3QgeyBkYXRhOiBwcm9maWxlLCBlcnJvciB9ID0gYXdhaXQgYmV0dGVyRmV0Y2goXG4gICAgICAgIFwiaHR0cHM6Ly9vYXV0aC5yZWRkaXQuY29tL2FwaS92MS9tZVwiLFxuICAgICAgICB7XG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VuLmFjY2Vzc1Rva2VufWAsXG4gICAgICAgICAgICBcIlVzZXItQWdlbnRcIjogXCJiZXR0ZXItYXV0aFwiXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgdXNlck1hcCA9IGF3YWl0IG9wdGlvbnMubWFwUHJvZmlsZVRvVXNlcj8uKHByb2ZpbGUpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGlkOiBwcm9maWxlLmlkLFxuICAgICAgICAgIG5hbWU6IHByb2ZpbGUubmFtZSxcbiAgICAgICAgICBlbWFpbDogcHJvZmlsZS5vYXV0aF9jbGllbnRfaWQsXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogcHJvZmlsZS5oYXNfdmVyaWZpZWRfZW1haWwsXG4gICAgICAgICAgaW1hZ2U6IHByb2ZpbGUuaWNvbl9pbWc/LnNwbGl0KFwiP1wiKVswXSxcbiAgICAgICAgICAuLi51c2VyTWFwXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGE6IHByb2ZpbGVcbiAgICAgIH07XG4gICAgfSxcbiAgICBvcHRpb25zXG4gIH07XG59O1xuXG5jb25zdCByb2Jsb3ggPSAob3B0aW9ucykgPT4ge1xuICByZXR1cm4ge1xuICAgIGlkOiBcInJvYmxveFwiLFxuICAgIG5hbWU6IFwiUm9ibG94XCIsXG4gICAgY3JlYXRlQXV0aG9yaXphdGlvblVSTCh7IHN0YXRlLCBzY29wZXMsIHJlZGlyZWN0VVJJIH0pIHtcbiAgICAgIGNvbnN0IF9zY29wZXMgPSBvcHRpb25zLmRpc2FibGVEZWZhdWx0U2NvcGUgPyBbXSA6IFtcIm9wZW5pZFwiLCBcInByb2ZpbGVcIl07XG4gICAgICBvcHRpb25zLnNjb3BlICYmIF9zY29wZXMucHVzaCguLi5vcHRpb25zLnNjb3BlKTtcbiAgICAgIHNjb3BlcyAmJiBfc2NvcGVzLnB1c2goLi4uc2NvcGVzKTtcbiAgICAgIHJldHVybiBuZXcgVVJMKFxuICAgICAgICBgaHR0cHM6Ly9hcGlzLnJvYmxveC5jb20vb2F1dGgvdjEvYXV0aG9yaXplP3Njb3BlPSR7X3Njb3Blcy5qb2luKFxuICAgICAgICAgIFwiK1wiXG4gICAgICAgICl9JnJlc3BvbnNlX3R5cGU9Y29kZSZjbGllbnRfaWQ9JHtvcHRpb25zLmNsaWVudElkfSZyZWRpcmVjdF91cmk9JHtlbmNvZGVVUklDb21wb25lbnQoXG4gICAgICAgICAgb3B0aW9ucy5yZWRpcmVjdFVSSSB8fCByZWRpcmVjdFVSSVxuICAgICAgICApfSZzdGF0ZT0ke3N0YXRlfSZwcm9tcHQ9JHtvcHRpb25zLnByb21wdCB8fCBcInNlbGVjdF9hY2NvdW50K2NvbnNlbnRcIn1gXG4gICAgICApO1xuICAgIH0sXG4gICAgdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZTogYXN5bmMgKHsgY29kZSwgcmVkaXJlY3RVUkkgfSkgPT4ge1xuICAgICAgcmV0dXJuIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGUoe1xuICAgICAgICBjb2RlLFxuICAgICAgICByZWRpcmVjdFVSSTogb3B0aW9ucy5yZWRpcmVjdFVSSSB8fCByZWRpcmVjdFVSSSxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL2FwaXMucm9ibG94LmNvbS9vYXV0aC92MS90b2tlblwiLFxuICAgICAgICBhdXRoZW50aWNhdGlvbjogXCJwb3N0XCJcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgcmVmcmVzaEFjY2Vzc1Rva2VuOiBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA/IG9wdGlvbnMucmVmcmVzaEFjY2Vzc1Rva2VuIDogYXN5bmMgKHJlZnJlc2hUb2tlbikgPT4ge1xuICAgICAgcmV0dXJuIHJlZnJlc2hBY2Nlc3NUb2tlbih7XG4gICAgICAgIHJlZnJlc2hUb2tlbixcbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgIGNsaWVudElkOiBvcHRpb25zLmNsaWVudElkLFxuICAgICAgICAgIGNsaWVudEtleTogb3B0aW9ucy5jbGllbnRLZXksXG4gICAgICAgICAgY2xpZW50U2VjcmV0OiBvcHRpb25zLmNsaWVudFNlY3JldFxuICAgICAgICB9LFxuICAgICAgICB0b2tlbkVuZHBvaW50OiBcImh0dHBzOi8vYXBpcy5yb2Jsb3guY29tL29hdXRoL3YxL3Rva2VuXCJcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgYXN5bmMgZ2V0VXNlckluZm8odG9rZW4pIHtcbiAgICAgIGlmIChvcHRpb25zLmdldFVzZXJJbmZvKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLmdldFVzZXJJbmZvKHRva2VuKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgZGF0YTogcHJvZmlsZSwgZXJyb3IgfSA9IGF3YWl0IGJldHRlckZldGNoKFxuICAgICAgICBcImh0dHBzOi8vYXBpcy5yb2Jsb3guY29tL29hdXRoL3YxL3VzZXJpbmZvXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW4uYWNjZXNzVG9rZW59YFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHVzZXJNYXAgPSBhd2FpdCBvcHRpb25zLm1hcFByb2ZpbGVUb1VzZXI/Lihwcm9maWxlKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogcHJvZmlsZS5zdWIsXG4gICAgICAgICAgbmFtZTogcHJvZmlsZS5uaWNrbmFtZSB8fCBwcm9maWxlLnByZWZlcnJlZF91c2VybmFtZSB8fCBcIlwiLFxuICAgICAgICAgIGltYWdlOiBwcm9maWxlLnBpY3R1cmUsXG4gICAgICAgICAgZW1haWw6IHByb2ZpbGUucHJlZmVycmVkX3VzZXJuYW1lIHx8IG51bGwsXG4gICAgICAgICAgLy8gUm9ibG94IGRvZXMgbm90IHByb3ZpZGUgZW1haWxcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiB0cnVlLFxuICAgICAgICAgIC4uLnVzZXJNYXBcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIC4uLnByb2ZpbGVcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9LFxuICAgIG9wdGlvbnNcbiAgfTtcbn07XG5cbnZhciBMQU5HID0gLyogQF9fUFVSRV9fICovICgoTEFORzIpID0+IHtcbiAgTEFORzJbTEFORzJbXCJSVVNcIl0gPSAwXSA9IFwiUlVTXCI7XG4gIExBTkcyW0xBTkcyW1wiVUtSXCJdID0gMV0gPSBcIlVLUlwiO1xuICBMQU5HMltMQU5HMltcIkVOR1wiXSA9IDNdID0gXCJFTkdcIjtcbiAgTEFORzJbTEFORzJbXCJTUEFcIl0gPSA0XSA9IFwiU1BBXCI7XG4gIExBTkcyW0xBTkcyW1wiR0VSTUFOXCJdID0gNl0gPSBcIkdFUk1BTlwiO1xuICBMQU5HMltMQU5HMltcIlBPTFwiXSA9IDE1XSA9IFwiUE9MXCI7XG4gIExBTkcyW0xBTkcyW1wiRlJBXCJdID0gMTZdID0gXCJGUkFcIjtcbiAgTEFORzJbTEFORzJbXCJUVVJLRVlcIl0gPSA4Ml0gPSBcIlRVUktFWVwiO1xuICByZXR1cm4gTEFORzI7XG59KShMQU5HIHx8IHt9KTtcbmNvbnN0IHZrID0gKG9wdGlvbnMpID0+IHtcbiAgcmV0dXJuIHtcbiAgICBpZDogXCJ2a1wiLFxuICAgIG5hbWU6IFwiVktcIixcbiAgICBhc3luYyBjcmVhdGVBdXRob3JpemF0aW9uVVJMKHsgc3RhdGUsIHNjb3BlcywgY29kZVZlcmlmaWVyLCByZWRpcmVjdFVSSSB9KSB7XG4gICAgICBjb25zdCBfc2NvcGVzID0gb3B0aW9ucy5kaXNhYmxlRGVmYXVsdFNjb3BlID8gW10gOiBbXCJlbWFpbFwiLCBcInBob25lXCJdO1xuICAgICAgb3B0aW9ucy5zY29wZSAmJiBfc2NvcGVzLnB1c2goLi4ub3B0aW9ucy5zY29wZSk7XG4gICAgICBzY29wZXMgJiYgX3Njb3Blcy5wdXNoKC4uLnNjb3Blcyk7XG4gICAgICBjb25zdCBhdXRob3JpemF0aW9uRW5kcG9pbnQgPSBcImh0dHBzOi8vaWQudmsuY29tL2F1dGhvcml6ZVwiO1xuICAgICAgcmV0dXJuIGNyZWF0ZUF1dGhvcml6YXRpb25VUkwoe1xuICAgICAgICBpZDogXCJ2a1wiLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQsXG4gICAgICAgIHNjb3BlczogX3Njb3BlcyxcbiAgICAgICAgc3RhdGUsXG4gICAgICAgIHJlZGlyZWN0VVJJLFxuICAgICAgICBjb2RlVmVyaWZpZXJcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgdmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZTogYXN5bmMgKHtcbiAgICAgIGNvZGUsXG4gICAgICBjb2RlVmVyaWZpZXIsXG4gICAgICByZWRpcmVjdFVSSSxcbiAgICAgIGRldmljZUlkXG4gICAgfSkgPT4ge1xuICAgICAgcmV0dXJuIHZhbGlkYXRlQXV0aG9yaXphdGlvbkNvZGUoe1xuICAgICAgICBjb2RlLFxuICAgICAgICBjb2RlVmVyaWZpZXIsXG4gICAgICAgIHJlZGlyZWN0VVJJOiBvcHRpb25zLnJlZGlyZWN0VVJJIHx8IHJlZGlyZWN0VVJJLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICBkZXZpY2VJZCxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL2lkLnZrLmNvbS9vYXV0aDIvYXV0aFwiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIHJlZnJlc2hBY2Nlc3NUb2tlbjogb3B0aW9ucy5yZWZyZXNoQWNjZXNzVG9rZW4gPyBvcHRpb25zLnJlZnJlc2hBY2Nlc3NUb2tlbiA6IGFzeW5jIChyZWZyZXNoVG9rZW4pID0+IHtcbiAgICAgIHJldHVybiByZWZyZXNoQWNjZXNzVG9rZW4oe1xuICAgICAgICByZWZyZXNoVG9rZW4sXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICBjbGllbnRJZDogb3B0aW9ucy5jbGllbnRJZCxcbiAgICAgICAgICBjbGllbnRLZXk6IG9wdGlvbnMuY2xpZW50S2V5LFxuICAgICAgICAgIGNsaWVudFNlY3JldDogb3B0aW9ucy5jbGllbnRTZWNyZXRcbiAgICAgICAgfSxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL2lkLnZrLmNvbS9vYXV0aDIvYXV0aFwiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIGFzeW5jIGdldFVzZXJJbmZvKGRhdGEpIHtcbiAgICAgIGlmIChvcHRpb25zLmdldFVzZXJJbmZvKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLmdldFVzZXJJbmZvKGRhdGEpO1xuICAgICAgfVxuICAgICAgaWYgKCFkYXRhLmFjY2Vzc1Rva2VuKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgZm9ybUJvZHkgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHtcbiAgICAgICAgYWNjZXNzX3Rva2VuOiBkYXRhLmFjY2Vzc1Rva2VuLFxuICAgICAgICBjbGllbnRfaWQ6IG9wdGlvbnMuY2xpZW50SWRcbiAgICAgIH0pLnRvU3RyaW5nKCk7XG4gICAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUsIGVycm9yIH0gPSBhd2FpdCBiZXR0ZXJGZXRjaChcbiAgICAgICAgXCJodHRwczovL2lkLnZrLmNvbS9vYXV0aDIvdXNlcl9pbmZvXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCJcbiAgICAgICAgICB9LFxuICAgICAgICAgIGJvZHk6IGZvcm1Cb2R5XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICBpZiAoIXByb2ZpbGUudXNlci5lbWFpbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHVzZXJNYXAgPSBhd2FpdCBvcHRpb25zLm1hcFByb2ZpbGVUb1VzZXI/Lihwcm9maWxlKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogcHJvZmlsZS51c2VyLnVzZXJfaWQsXG4gICAgICAgICAgZmlyc3RfbmFtZTogcHJvZmlsZS51c2VyLmZpcnN0X25hbWUsXG4gICAgICAgICAgbGFzdF9uYW1lOiBwcm9maWxlLnVzZXIubGFzdF9uYW1lLFxuICAgICAgICAgIGVtYWlsOiBwcm9maWxlLnVzZXIuZW1haWwsXG4gICAgICAgICAgaW1hZ2U6IHByb2ZpbGUudXNlci5hdmF0YXIsXG4gICAgICAgICAgLyoqIEBub3RlIFZLIGRvZXMgbm90IHByb3ZpZGUgZW1haWxWZXJpZmllZCovXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogISFwcm9maWxlLnVzZXIuZW1haWwsXG4gICAgICAgICAgYmlydGhkYXk6IHByb2ZpbGUudXNlci5iaXJ0aGRheSxcbiAgICAgICAgICBzZXg6IHByb2ZpbGUudXNlci5zZXgsXG4gICAgICAgICAgLi4udXNlck1hcFxuICAgICAgICB9LFxuICAgICAgICBkYXRhOiBwcm9maWxlXG4gICAgICB9O1xuICAgIH0sXG4gICAgb3B0aW9uc1xuICB9O1xufTtcblxuY29uc3Qgem9vbSA9ICh1c2VyT3B0aW9ucykgPT4ge1xuICBjb25zdCBvcHRpb25zID0ge1xuICAgIHBrY2U6IHRydWUsXG4gICAgLi4udXNlck9wdGlvbnNcbiAgfTtcbiAgcmV0dXJuIHtcbiAgICBpZDogXCJ6b29tXCIsXG4gICAgbmFtZTogXCJab29tXCIsXG4gICAgY3JlYXRlQXV0aG9yaXphdGlvblVSTDogYXN5bmMgKHsgc3RhdGUsIHJlZGlyZWN0VVJJLCBjb2RlVmVyaWZpZXIgfSkgPT4ge1xuICAgICAgY29uc3QgcGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh7XG4gICAgICAgIHJlc3BvbnNlX3R5cGU6IFwiY29kZVwiLFxuICAgICAgICByZWRpcmVjdF91cmk6IG9wdGlvbnMucmVkaXJlY3RVUkkgPyBvcHRpb25zLnJlZGlyZWN0VVJJIDogcmVkaXJlY3RVUkksXG4gICAgICAgIGNsaWVudF9pZDogb3B0aW9ucy5jbGllbnRJZCxcbiAgICAgICAgc3RhdGVcbiAgICAgIH0pO1xuICAgICAgaWYgKG9wdGlvbnMucGtjZSkge1xuICAgICAgICBjb25zdCBjb2RlQ2hhbGxlbmdlID0gYXdhaXQgZ2VuZXJhdGVDb2RlQ2hhbGxlbmdlKGNvZGVWZXJpZmllcik7XG4gICAgICAgIHBhcmFtcy5zZXQoXCJjb2RlX2NoYWxsZW5nZV9tZXRob2RcIiwgXCJTMjU2XCIpO1xuICAgICAgICBwYXJhbXMuc2V0KFwiY29kZV9jaGFsbGVuZ2VcIiwgY29kZUNoYWxsZW5nZSk7XG4gICAgICB9XG4gICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKFwiaHR0cHM6Ly96b29tLnVzL29hdXRoL2F1dGhvcml6ZVwiKTtcbiAgICAgIHVybC5zZWFyY2ggPSBwYXJhbXMudG9TdHJpbmcoKTtcbiAgICAgIHJldHVybiB1cmw7XG4gICAgfSxcbiAgICB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlOiBhc3luYyAoeyBjb2RlLCByZWRpcmVjdFVSSSwgY29kZVZlcmlmaWVyIH0pID0+IHtcbiAgICAgIHJldHVybiB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlKHtcbiAgICAgICAgY29kZSxcbiAgICAgICAgcmVkaXJlY3RVUkk6IG9wdGlvbnMucmVkaXJlY3RVUkkgfHwgcmVkaXJlY3RVUkksXG4gICAgICAgIGNvZGVWZXJpZmllcixcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgdG9rZW5FbmRwb2ludDogXCJodHRwczovL3pvb20udXMvb2F1dGgvdG9rZW5cIixcbiAgICAgICAgYXV0aGVudGljYXRpb246IFwicG9zdFwiXG4gICAgICB9KTtcbiAgICB9LFxuICAgIGFzeW5jIGdldFVzZXJJbmZvKHRva2VuKSB7XG4gICAgICBpZiAob3B0aW9ucy5nZXRVc2VySW5mbykge1xuICAgICAgICByZXR1cm4gb3B0aW9ucy5nZXRVc2VySW5mbyh0b2tlbik7XG4gICAgICB9XG4gICAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUsIGVycm9yIH0gPSBhd2FpdCBiZXR0ZXJGZXRjaChcbiAgICAgICAgXCJodHRwczovL2FwaS56b29tLnVzL3YyL3VzZXJzL21lXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW4uYWNjZXNzVG9rZW59YFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHVzZXJNYXAgPSBhd2FpdCBvcHRpb25zLm1hcFByb2ZpbGVUb1VzZXI/Lihwcm9maWxlKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogcHJvZmlsZS5pZCxcbiAgICAgICAgICBuYW1lOiBwcm9maWxlLmRpc3BsYXlfbmFtZSxcbiAgICAgICAgICBpbWFnZTogcHJvZmlsZS5waWNfdXJsLFxuICAgICAgICAgIGVtYWlsOiBwcm9maWxlLmVtYWlsLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IEJvb2xlYW4ocHJvZmlsZS52ZXJpZmllZCksXG4gICAgICAgICAgLi4udXNlck1hcFxuICAgICAgICB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4ucHJvZmlsZVxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cbiAgfTtcbn07XG5cbmNvbnN0IHNvY2lhbFByb3ZpZGVycyA9IHtcbiAgYXBwbGUsXG4gIGRpc2NvcmQsXG4gIGZhY2Vib29rLFxuICBnaXRodWIsXG4gIG1pY3Jvc29mdCxcbiAgZ29vZ2xlLFxuICBodWdnaW5nZmFjZSxcbiAgc2xhY2ssXG4gIHNwb3RpZnksXG4gIHR3aXRjaCxcbiAgdHdpdHRlcixcbiAgZHJvcGJveCxcbiAga2ljayxcbiAgbGluZWFyLFxuICBsaW5rZWRpbixcbiAgZ2l0bGFiLFxuICB0aWt0b2ssXG4gIHJlZGRpdCxcbiAgcm9ibG94LFxuICB2ayxcbiAgem9vbSxcbiAgbm90aW9uXG59O1xuY29uc3Qgc29jaWFsUHJvdmlkZXJMaXN0ID0gT2JqZWN0LmtleXMoc29jaWFsUHJvdmlkZXJzKTtcbmNvbnN0IFNvY2lhbFByb3ZpZGVyTGlzdEVudW0gPSB6LmVudW0oc29jaWFsUHJvdmlkZXJMaXN0KS5vcih6LnN0cmluZygpKTtcblxuY29uc3Qgc2lnbkluU29jaWFsID0gY3JlYXRlQXV0aEVuZHBvaW50KFxuICBcIi9zaWduLWluL3NvY2lhbFwiLFxuICB7XG4gICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICBib2R5OiB6Lm9iamVjdCh7XG4gICAgICAvKipcbiAgICAgICAqIENhbGxiYWNrIFVSTCB0byByZWRpcmVjdCB0byBhZnRlciB0aGUgdXNlclxuICAgICAgICogaGFzIHNpZ25lZCBpbi5cbiAgICAgICAqL1xuICAgICAgY2FsbGJhY2tVUkw6IHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIkNhbGxiYWNrIFVSTCB0byByZWRpcmVjdCB0byBhZnRlciB0aGUgdXNlciBoYXMgc2lnbmVkIGluXCJcbiAgICAgIH0pLm9wdGlvbmFsKCksXG4gICAgICAvKipcbiAgICAgICAqIGNhbGxiYWNrIHVybCB0byByZWRpcmVjdCBpZiB0aGUgdXNlciBpcyBuZXdseSByZWdpc3RlcmVkLlxuICAgICAgICpcbiAgICAgICAqIHVzZWZ1bCBpZiB5b3UgaGF2ZSBkaWZmZXJlbnQgcm91dGVzIGZvciBleGlzdGluZyB1c2VycyBhbmQgbmV3IHVzZXJzXG4gICAgICAgKi9cbiAgICAgIG5ld1VzZXJDYWxsYmFja1VSTDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgICAgLyoqXG4gICAgICAgKiBDYWxsYmFjayB1cmwgdG8gcmVkaXJlY3QgdG8gaWYgYW4gZXJyb3IgaGFwcGVuc1xuICAgICAgICpcbiAgICAgICAqIElmIGl0J3MgaW5pdGlhdGVkIGZyb20gdGhlIGNsaWVudCBzZGsgdGhpcyBkZWZhdWx0cyB0b1xuICAgICAgICogdGhlIGN1cnJlbnQgdXJsLlxuICAgICAgICovXG4gICAgICBlcnJvckNhbGxiYWNrVVJMOiB6LnN0cmluZygpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJDYWxsYmFjayBVUkwgdG8gcmVkaXJlY3QgdG8gaWYgYW4gZXJyb3IgaGFwcGVuc1wiXG4gICAgICB9KS5vcHRpb25hbCgpLFxuICAgICAgLyoqXG4gICAgICAgKiBPQXV0aDIgcHJvdmlkZXIgdG8gdXNlYFxuICAgICAgICovXG4gICAgICBwcm92aWRlcjogU29jaWFsUHJvdmlkZXJMaXN0RW51bSxcbiAgICAgIC8qKlxuICAgICAgICogRGlzYWJsZSBhdXRvbWF0aWMgcmVkaXJlY3Rpb24gdG8gdGhlIHByb3ZpZGVyXG4gICAgICAgKlxuICAgICAgICogVGhpcyBpcyB1c2VmdWwgaWYgeW91IHdhbnQgdG8gaGFuZGxlIHRoZSByZWRpcmVjdGlvblxuICAgICAgICogeW91cnNlbGYgbGlrZSBpbiBhIHBvcHVwIG9yIGEgZGlmZmVyZW50IHRhYi5cbiAgICAgICAqL1xuICAgICAgZGlzYWJsZVJlZGlyZWN0OiB6LmJvb2xlYW4oKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiRGlzYWJsZSBhdXRvbWF0aWMgcmVkaXJlY3Rpb24gdG8gdGhlIHByb3ZpZGVyLiBVc2VmdWwgZm9yIGhhbmRsaW5nIHRoZSByZWRpcmVjdGlvbiB5b3Vyc2VsZlwiXG4gICAgICB9KS5vcHRpb25hbCgpLFxuICAgICAgLyoqXG4gICAgICAgKiBJRCB0b2tlbiBmcm9tIHRoZSBwcm92aWRlclxuICAgICAgICpcbiAgICAgICAqIFRoaXMgaXMgdXNlZCB0byBzaWduIGluIHRoZSB1c2VyXG4gICAgICAgKiBpZiB0aGUgdXNlciBpcyBhbHJlYWR5IHNpZ25lZCBpbiB3aXRoIHRoZVxuICAgICAgICogcHJvdmlkZXIgaW4gdGhlIGZyb250ZW5kLlxuICAgICAgICpcbiAgICAgICAqIE9ubHkgYXBwbGljYWJsZSBpZiB0aGUgcHJvdmlkZXIgc3VwcG9ydHNcbiAgICAgICAqIGl0LiBDdXJyZW50bHkgb25seSBgYXBwbGVgIGFuZCBgZ29vZ2xlYCBpc1xuICAgICAgICogc3VwcG9ydGVkIG91dCBvZiB0aGUgYm94LlxuICAgICAgICovXG4gICAgICBpZFRva2VuOiB6Lm9wdGlvbmFsKFxuICAgICAgICB6Lm9iamVjdCh7XG4gICAgICAgICAgLyoqXG4gICAgICAgICAgICogSUQgdG9rZW4gZnJvbSB0aGUgcHJvdmlkZXJcbiAgICAgICAgICAgKi9cbiAgICAgICAgICB0b2tlbjogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIklEIHRva2VuIGZyb20gdGhlIHByb3ZpZGVyXCJcbiAgICAgICAgICB9KSxcbiAgICAgICAgICAvKipcbiAgICAgICAgICAgKiBUaGUgbm9uY2UgdXNlZCB0byBnZW5lcmF0ZSB0aGUgdG9rZW5cbiAgICAgICAgICAgKi9cbiAgICAgICAgICBub25jZTogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIk5vbmNlIHVzZWQgdG8gZ2VuZXJhdGUgdGhlIHRva2VuXCJcbiAgICAgICAgICB9KS5vcHRpb25hbCgpLFxuICAgICAgICAgIC8qKlxuICAgICAgICAgICAqIEFjY2VzcyB0b2tlbiBmcm9tIHRoZSBwcm92aWRlclxuICAgICAgICAgICAqL1xuICAgICAgICAgIGFjY2Vzc1Rva2VuOiB6LnN0cmluZygpLm1ldGEoe1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiQWNjZXNzIHRva2VuIGZyb20gdGhlIHByb3ZpZGVyXCJcbiAgICAgICAgICB9KS5vcHRpb25hbCgpLFxuICAgICAgICAgIC8qKlxuICAgICAgICAgICAqIFJlZnJlc2ggdG9rZW4gZnJvbSB0aGUgcHJvdmlkZXJcbiAgICAgICAgICAgKi9cbiAgICAgICAgICByZWZyZXNoVG9rZW46IHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJSZWZyZXNoIHRva2VuIGZyb20gdGhlIHByb3ZpZGVyXCJcbiAgICAgICAgICB9KS5vcHRpb25hbCgpLFxuICAgICAgICAgIC8qKlxuICAgICAgICAgICAqIEV4cGlyeSBkYXRlIG9mIHRoZSB0b2tlblxuICAgICAgICAgICAqL1xuICAgICAgICAgIGV4cGlyZXNBdDogei5udW1iZXIoKS5tZXRhKHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkV4cGlyeSBkYXRlIG9mIHRoZSB0b2tlblwiXG4gICAgICAgICAgfSkub3B0aW9uYWwoKVxuICAgICAgICB9KVxuICAgICAgKSxcbiAgICAgIHNjb3Blczogei5hcnJheSh6LnN0cmluZygpKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiQXJyYXkgb2Ygc2NvcGVzIHRvIHJlcXVlc3QgZnJvbSB0aGUgcHJvdmlkZXIuIFRoaXMgd2lsbCBvdmVycmlkZSB0aGUgZGVmYXVsdCBzY29wZXMgcGFzc2VkLlwiXG4gICAgICB9KS5vcHRpb25hbCgpLFxuICAgICAgLyoqXG4gICAgICAgKiBFeHBsaWNpdGx5IHJlcXVlc3Qgc2lnbi11cFxuICAgICAgICpcbiAgICAgICAqIFNob3VsZCBiZSB1c2VkIHRvIGFsbG93IHNpZ24gdXAgd2hlblxuICAgICAgICogZGlzYWJsZUltcGxpY2l0U2lnblVwIGZvciB0aGlzIHByb3ZpZGVyIGlzXG4gICAgICAgKiB0cnVlXG4gICAgICAgKi9cbiAgICAgIHJlcXVlc3RTaWduVXA6IHouYm9vbGVhbigpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJFeHBsaWNpdGx5IHJlcXVlc3Qgc2lnbi11cC4gVXNlZnVsIHdoZW4gZGlzYWJsZUltcGxpY2l0U2lnblVwIGlzIHRydWUgZm9yIHRoaXMgcHJvdmlkZXJcIlxuICAgICAgfSkub3B0aW9uYWwoKSxcbiAgICAgIC8qKlxuICAgICAgICogVGhlIGxvZ2luIGhpbnQgdG8gdXNlIGZvciB0aGUgYXV0aG9yaXphdGlvbiBjb2RlIHJlcXVlc3RcbiAgICAgICAqL1xuICAgICAgbG9naW5IaW50OiB6LnN0cmluZygpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgbG9naW4gaGludCB0byB1c2UgZm9yIHRoZSBhdXRob3JpemF0aW9uIGNvZGUgcmVxdWVzdFwiXG4gICAgICB9KS5vcHRpb25hbCgpXG4gICAgfSksXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgIG9wZW5hcGk6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiU2lnbiBpbiB3aXRoIGEgc29jaWFsIHByb3ZpZGVyXCIsXG4gICAgICAgIG9wZXJhdGlvbklkOiBcInNvY2lhbFNpZ25JblwiLFxuICAgICAgICByZXNwb25zZXM6IHtcbiAgICAgICAgICBcIjIwMFwiOiB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJTdWNjZXNzIC0gUmV0dXJucyBlaXRoZXIgc2Vzc2lvbiBkZXRhaWxzIG9yIHJlZGlyZWN0IFVSTFwiLFxuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIjoge1xuICAgICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgICAgLy8gdG9kbzogd2UgbmVlZCBzdXBwb3J0IGZvciBtdWx0aXBsZSBzY2hlbWFcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJTZXNzaW9uIHJlc3BvbnNlIHdoZW4gaWRUb2tlbiBpcyBwcm92aWRlZFwiLFxuICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICByZWRpcmVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYm9vbGVhblwiLFxuICAgICAgICAgICAgICAgICAgICAgIGVudW06IFtmYWxzZV1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdG9rZW46IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlNlc3Npb24gdG9rZW5cIixcbiAgICAgICAgICAgICAgICAgICAgICB1cmw6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwibnVsbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgbnVsbGFibGU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB7IHR5cGU6IFwic3RyaW5nXCIgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZW1haWw6IHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsYWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICBpbWFnZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbGFibGU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZW1haWxWZXJpZmllZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYm9vbGVhblwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBcImRhdGUtdGltZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRBdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBcImRhdGUtdGltZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICBcImlkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIFwiZW1haWxcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgXCJlbWFpbFZlcmlmaWVkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIFwiY3JlYXRlZEF0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIFwidXBkYXRlZEF0XCJcbiAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICByZXF1aXJlZDogW1wicmVkaXJlY3RcIiwgXCJ0b2tlblwiLCBcInVzZXJcIl1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGFzeW5jIChjKSA9PiB7XG4gICAgY29uc3QgcHJvdmlkZXIgPSBjLmNvbnRleHQuc29jaWFsUHJvdmlkZXJzLmZpbmQoXG4gICAgICAocCkgPT4gcC5pZCA9PT0gYy5ib2R5LnByb3ZpZGVyXG4gICAgKTtcbiAgICBpZiAoIXByb3ZpZGVyKSB7XG4gICAgICBjLmNvbnRleHQubG9nZ2VyLmVycm9yKFxuICAgICAgICBcIlByb3ZpZGVyIG5vdCBmb3VuZC4gTWFrZSBzdXJlIHRvIGFkZCB0aGUgcHJvdmlkZXIgaW4geW91ciBhdXRoIGNvbmZpZ1wiLFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZXI6IGMuYm9keS5wcm92aWRlclxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiTk9UX0ZPVU5EXCIsIHtcbiAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5QUk9WSURFUl9OT1RfRk9VTkRcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoYy5ib2R5LmlkVG9rZW4pIHtcbiAgICAgIGlmICghcHJvdmlkZXIudmVyaWZ5SWRUb2tlbikge1xuICAgICAgICBjLmNvbnRleHQubG9nZ2VyLmVycm9yKFxuICAgICAgICAgIFwiUHJvdmlkZXIgZG9lcyBub3Qgc3VwcG9ydCBpZCB0b2tlbiB2ZXJpZmljYXRpb25cIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICBwcm92aWRlcjogYy5ib2R5LnByb3ZpZGVyXG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJOT1RfRk9VTkRcIiwge1xuICAgICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuSURfVE9LRU5fTk9UX1NVUFBPUlRFRFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgdG9rZW4sIG5vbmNlIH0gPSBjLmJvZHkuaWRUb2tlbjtcbiAgICAgIGNvbnN0IHZhbGlkID0gYXdhaXQgcHJvdmlkZXIudmVyaWZ5SWRUb2tlbih0b2tlbiwgbm9uY2UpO1xuICAgICAgaWYgKCF2YWxpZCkge1xuICAgICAgICBjLmNvbnRleHQubG9nZ2VyLmVycm9yKFwiSW52YWxpZCBpZCB0b2tlblwiLCB7XG4gICAgICAgICAgcHJvdmlkZXI6IGMuYm9keS5wcm92aWRlclxuICAgICAgICB9KTtcbiAgICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiVU5BVVRIT1JJWkVEXCIsIHtcbiAgICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLklOVkFMSURfVE9LRU5cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBjb25zdCB1c2VySW5mbyA9IGF3YWl0IHByb3ZpZGVyLmdldFVzZXJJbmZvKHtcbiAgICAgICAgaWRUb2tlbjogdG9rZW4sXG4gICAgICAgIGFjY2Vzc1Rva2VuOiBjLmJvZHkuaWRUb2tlbi5hY2Nlc3NUb2tlbixcbiAgICAgICAgcmVmcmVzaFRva2VuOiBjLmJvZHkuaWRUb2tlbi5yZWZyZXNoVG9rZW5cbiAgICAgIH0pO1xuICAgICAgaWYgKCF1c2VySW5mbyB8fCAhdXNlckluZm8/LnVzZXIpIHtcbiAgICAgICAgYy5jb250ZXh0LmxvZ2dlci5lcnJvcihcIkZhaWxlZCB0byBnZXQgdXNlciBpbmZvXCIsIHtcbiAgICAgICAgICBwcm92aWRlcjogYy5ib2R5LnByb3ZpZGVyXG4gICAgICAgIH0pO1xuICAgICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJVTkFVVEhPUklaRURcIiwge1xuICAgICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuRkFJTEVEX1RPX0dFVF9VU0VSX0lORk9cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAoIXVzZXJJbmZvLnVzZXIuZW1haWwpIHtcbiAgICAgICAgYy5jb250ZXh0LmxvZ2dlci5lcnJvcihcIlVzZXIgZW1haWwgbm90IGZvdW5kXCIsIHtcbiAgICAgICAgICBwcm92aWRlcjogYy5ib2R5LnByb3ZpZGVyXG4gICAgICAgIH0pO1xuICAgICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJVTkFVVEhPUklaRURcIiwge1xuICAgICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuVVNFUl9FTUFJTF9OT1RfRk9VTkRcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgaGFuZGxlT0F1dGhVc2VySW5mbyhjLCB7XG4gICAgICAgIHVzZXJJbmZvOiB7XG4gICAgICAgICAgLi4udXNlckluZm8udXNlcixcbiAgICAgICAgICBlbWFpbDogdXNlckluZm8udXNlci5lbWFpbCxcbiAgICAgICAgICBpZDogdXNlckluZm8udXNlci5pZCxcbiAgICAgICAgICBuYW1lOiB1c2VySW5mby51c2VyLm5hbWUgfHwgXCJcIixcbiAgICAgICAgICBpbWFnZTogdXNlckluZm8udXNlci5pbWFnZSxcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiB1c2VySW5mby51c2VyLmVtYWlsVmVyaWZpZWQgfHwgZmFsc2VcbiAgICAgICAgfSxcbiAgICAgICAgYWNjb3VudDoge1xuICAgICAgICAgIHByb3ZpZGVySWQ6IHByb3ZpZGVyLmlkLFxuICAgICAgICAgIGFjY291bnRJZDogdXNlckluZm8udXNlci5pZCxcbiAgICAgICAgICBhY2Nlc3NUb2tlbjogYy5ib2R5LmlkVG9rZW4uYWNjZXNzVG9rZW5cbiAgICAgICAgfSxcbiAgICAgICAgY2FsbGJhY2tVUkw6IGMuYm9keS5jYWxsYmFja1VSTCxcbiAgICAgICAgZGlzYWJsZVNpZ25VcDogcHJvdmlkZXIuZGlzYWJsZUltcGxpY2l0U2lnblVwICYmICFjLmJvZHkucmVxdWVzdFNpZ25VcCB8fCBwcm92aWRlci5kaXNhYmxlU2lnblVwXG4gICAgICB9KTtcbiAgICAgIGlmIChkYXRhLmVycm9yKSB7XG4gICAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIlVOQVVUSE9SSVpFRFwiLCB7XG4gICAgICAgICAgbWVzc2FnZTogZGF0YS5lcnJvclxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGF3YWl0IHNldFNlc3Npb25Db29raWUoYywgZGF0YS5kYXRhKTtcbiAgICAgIHJldHVybiBjLmpzb24oe1xuICAgICAgICByZWRpcmVjdDogZmFsc2UsXG4gICAgICAgIHRva2VuOiBkYXRhLmRhdGEuc2Vzc2lvbi50b2tlbixcbiAgICAgICAgdXJsOiB2b2lkIDAsXG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogZGF0YS5kYXRhLnVzZXIuaWQsXG4gICAgICAgICAgZW1haWw6IGRhdGEuZGF0YS51c2VyLmVtYWlsLFxuICAgICAgICAgIG5hbWU6IGRhdGEuZGF0YS51c2VyLm5hbWUsXG4gICAgICAgICAgaW1hZ2U6IGRhdGEuZGF0YS51c2VyLmltYWdlLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IGRhdGEuZGF0YS51c2VyLmVtYWlsVmVyaWZpZWQsXG4gICAgICAgICAgY3JlYXRlZEF0OiBkYXRhLmRhdGEudXNlci5jcmVhdGVkQXQsXG4gICAgICAgICAgdXBkYXRlZEF0OiBkYXRhLmRhdGEudXNlci51cGRhdGVkQXRcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IHsgY29kZVZlcmlmaWVyLCBzdGF0ZSB9ID0gYXdhaXQgZ2VuZXJhdGVTdGF0ZShjKTtcbiAgICBjb25zdCB1cmwgPSBhd2FpdCBwcm92aWRlci5jcmVhdGVBdXRob3JpemF0aW9uVVJMKHtcbiAgICAgIHN0YXRlLFxuICAgICAgY29kZVZlcmlmaWVyLFxuICAgICAgcmVkaXJlY3RVUkk6IGAke2MuY29udGV4dC5iYXNlVVJMfS9jYWxsYmFjay8ke3Byb3ZpZGVyLmlkfWAsXG4gICAgICBzY29wZXM6IGMuYm9keS5zY29wZXMsXG4gICAgICBsb2dpbkhpbnQ6IGMuYm9keS5sb2dpbkhpbnRcbiAgICB9KTtcbiAgICByZXR1cm4gYy5qc29uKHtcbiAgICAgIHVybDogdXJsLnRvU3RyaW5nKCksXG4gICAgICByZWRpcmVjdDogIWMuYm9keS5kaXNhYmxlUmVkaXJlY3RcbiAgICB9KTtcbiAgfVxuKTtcbmNvbnN0IHNpZ25JbkVtYWlsID0gY3JlYXRlQXV0aEVuZHBvaW50KFxuICBcIi9zaWduLWluL2VtYWlsXCIsXG4gIHtcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgIGJvZHk6IHoub2JqZWN0KHtcbiAgICAgIC8qKlxuICAgICAgICogRW1haWwgb2YgdGhlIHVzZXJcbiAgICAgICAqL1xuICAgICAgZW1haWw6IHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIkVtYWlsIG9mIHRoZSB1c2VyXCJcbiAgICAgIH0pLFxuICAgICAgLyoqXG4gICAgICAgKiBQYXNzd29yZCBvZiB0aGUgdXNlclxuICAgICAgICovXG4gICAgICBwYXNzd29yZDogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiUGFzc3dvcmQgb2YgdGhlIHVzZXJcIlxuICAgICAgfSksXG4gICAgICAvKipcbiAgICAgICAqIENhbGxiYWNrIFVSTCB0byB1c2UgYXMgYSByZWRpcmVjdCBmb3IgZW1haWxcbiAgICAgICAqIHZlcmlmaWNhdGlvbiBhbmQgZm9yIHBvc3NpYmxlIHJlZGlyZWN0c1xuICAgICAgICovXG4gICAgICBjYWxsYmFja1VSTDogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiQ2FsbGJhY2sgVVJMIHRvIHVzZSBhcyBhIHJlZGlyZWN0IGZvciBlbWFpbCB2ZXJpZmljYXRpb25cIlxuICAgICAgfSkub3B0aW9uYWwoKSxcbiAgICAgIC8qKlxuICAgICAgICogSWYgdGhpcyBpcyBmYWxzZSwgdGhlIHNlc3Npb24gd2lsbCBub3QgYmUgcmVtZW1iZXJlZFxuICAgICAgICogQGRlZmF1bHQgdHJ1ZVxuICAgICAgICovXG4gICAgICByZW1lbWJlck1lOiB6LmJvb2xlYW4oKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiSWYgdGhpcyBpcyBmYWxzZSwgdGhlIHNlc3Npb24gd2lsbCBub3QgYmUgcmVtZW1iZXJlZC4gRGVmYXVsdCBpcyBgdHJ1ZWAuXCJcbiAgICAgIH0pLmRlZmF1bHQodHJ1ZSkub3B0aW9uYWwoKVxuICAgIH0pLFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICBvcGVuYXBpOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlNpZ24gaW4gd2l0aCBlbWFpbCBhbmQgcGFzc3dvcmRcIixcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgXCIyMDBcIjoge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiU3VjY2VzcyAtIFJldHVybnMgZWl0aGVyIHNlc3Npb24gZGV0YWlscyBvciByZWRpcmVjdCBVUkxcIixcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbi9qc29uXCI6IHtcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgIC8vIHRvZG86IHdlIG5lZWQgc3VwcG9ydCBmb3IgbXVsdGlwbGUgc2NoZW1hXG4gICAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiU2Vzc2lvbiByZXNwb25zZSB3aGVuIGlkVG9rZW4gaXMgcHJvdmlkZWRcIixcbiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImJvb2xlYW5cIixcbiAgICAgICAgICAgICAgICAgICAgICBlbnVtOiBbZmFsc2VdXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHRva2VuOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJTZXNzaW9uIHRva2VuXCJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdXJsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJudWxsXCIsXG4gICAgICAgICAgICAgICAgICAgICAgbnVsbGFibGU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZW1haWw6IHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsYWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG51bGxhYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZW1haWxWZXJpZmllZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImJvb2xlYW5cIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFwiZGF0ZS10aW1lXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkQXQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBcImRhdGUtdGltZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogW1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJpZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJlbWFpbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJlbWFpbFZlcmlmaWVkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNyZWF0ZWRBdFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ1cGRhdGVkQXRcIlxuICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBbXCJyZWRpcmVjdFwiLCBcInRva2VuXCIsIFwidXNlclwiXVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgYXN5bmMgKGN0eCkgPT4ge1xuICAgIGlmICghY3R4LmNvbnRleHQub3B0aW9ucz8uZW1haWxBbmRQYXNzd29yZD8uZW5hYmxlZCkge1xuICAgICAgY3R4LmNvbnRleHQubG9nZ2VyLmVycm9yKFxuICAgICAgICBcIkVtYWlsIGFuZCBwYXNzd29yZCBpcyBub3QgZW5hYmxlZC4gTWFrZSBzdXJlIHRvIGVuYWJsZSBpdCBpbiB0aGUgb3B0aW9ucyBvbiB5b3UgYGF1dGgudHNgIGZpbGUuIENoZWNrIGBodHRwczovL2JldHRlci1hdXRoLmNvbS9kb2NzL2F1dGhlbnRpY2F0aW9uL2VtYWlsLXBhc3N3b3JkYCBmb3IgbW9yZSFcIlxuICAgICAgKTtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogXCJFbWFpbCBhbmQgcGFzc3dvcmQgaXMgbm90IGVuYWJsZWRcIlxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IHsgZW1haWwsIHBhc3N3b3JkIH0gPSBjdHguYm9keTtcbiAgICBjb25zdCBpc1ZhbGlkRW1haWwgPSB6LnN0cmluZygpLmVtYWlsKCkuc2FmZVBhcnNlKGVtYWlsKTtcbiAgICBpZiAoIWlzVmFsaWRFbWFpbC5zdWNjZXNzKSB7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuSU5WQUxJRF9FTUFJTFxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZmluZFVzZXJCeUVtYWlsKGVtYWlsLCB7XG4gICAgICBpbmNsdWRlQWNjb3VudHM6IHRydWVcbiAgICB9KTtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIGF3YWl0IGN0eC5jb250ZXh0LnBhc3N3b3JkLmhhc2gocGFzc3dvcmQpO1xuICAgICAgY3R4LmNvbnRleHQubG9nZ2VyLmVycm9yKFwiVXNlciBub3QgZm91bmRcIiwgeyBlbWFpbCB9KTtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIlVOQVVUSE9SSVpFRFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuSU5WQUxJRF9FTUFJTF9PUl9QQVNTV09SRFxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IGNyZWRlbnRpYWxBY2NvdW50ID0gdXNlci5hY2NvdW50cy5maW5kKFxuICAgICAgKGEpID0+IGEucHJvdmlkZXJJZCA9PT0gXCJjcmVkZW50aWFsXCJcbiAgICApO1xuICAgIGlmICghY3JlZGVudGlhbEFjY291bnQpIHtcbiAgICAgIGN0eC5jb250ZXh0LmxvZ2dlci5lcnJvcihcIkNyZWRlbnRpYWwgYWNjb3VudCBub3QgZm91bmRcIiwgeyBlbWFpbCB9KTtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIlVOQVVUSE9SSVpFRFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuSU5WQUxJRF9FTUFJTF9PUl9QQVNTV09SRFxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IGN1cnJlbnRQYXNzd29yZCA9IGNyZWRlbnRpYWxBY2NvdW50Py5wYXNzd29yZDtcbiAgICBpZiAoIWN1cnJlbnRQYXNzd29yZCkge1xuICAgICAgY3R4LmNvbnRleHQubG9nZ2VyLmVycm9yKFwiUGFzc3dvcmQgbm90IGZvdW5kXCIsIHsgZW1haWwgfSk7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJVTkFVVEhPUklaRURcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLklOVkFMSURfRU1BSUxfT1JfUEFTU1dPUkRcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCB2YWxpZFBhc3N3b3JkID0gYXdhaXQgY3R4LmNvbnRleHQucGFzc3dvcmQudmVyaWZ5KHtcbiAgICAgIGhhc2g6IGN1cnJlbnRQYXNzd29yZCxcbiAgICAgIHBhc3N3b3JkXG4gICAgfSk7XG4gICAgaWYgKCF2YWxpZFBhc3N3b3JkKSB7XG4gICAgICBjdHguY29udGV4dC5sb2dnZXIuZXJyb3IoXCJJbnZhbGlkIHBhc3N3b3JkXCIpO1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiVU5BVVRIT1JJWkVEXCIsIHtcbiAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5JTlZBTElEX0VNQUlMX09SX1BBU1NXT1JEXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGN0eC5jb250ZXh0Lm9wdGlvbnM/LmVtYWlsQW5kUGFzc3dvcmQ/LnJlcXVpcmVFbWFpbFZlcmlmaWNhdGlvbiAmJiAhdXNlci51c2VyLmVtYWlsVmVyaWZpZWQpIHtcbiAgICAgIGlmICghY3R4LmNvbnRleHQub3B0aW9ucz8uZW1haWxWZXJpZmljYXRpb24/LnNlbmRWZXJpZmljYXRpb25FbWFpbCkge1xuICAgICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJGT1JCSURERU5cIiwge1xuICAgICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuRU1BSUxfTk9UX1ZFUklGSUVEXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaWYgKGN0eC5jb250ZXh0Lm9wdGlvbnM/LmVtYWlsVmVyaWZpY2F0aW9uPy5zZW5kT25TaWduSW4pIHtcbiAgICAgICAgY29uc3QgdG9rZW4gPSBhd2FpdCBjcmVhdGVFbWFpbFZlcmlmaWNhdGlvblRva2VuKFxuICAgICAgICAgIGN0eC5jb250ZXh0LnNlY3JldCxcbiAgICAgICAgICB1c2VyLnVzZXIuZW1haWwsXG4gICAgICAgICAgdm9pZCAwLFxuICAgICAgICAgIGN0eC5jb250ZXh0Lm9wdGlvbnMuZW1haWxWZXJpZmljYXRpb24/LmV4cGlyZXNJblxuICAgICAgICApO1xuICAgICAgICBjb25zdCB1cmwgPSBgJHtjdHguY29udGV4dC5iYXNlVVJMfS92ZXJpZnktZW1haWw/dG9rZW49JHt0b2tlbn0mY2FsbGJhY2tVUkw9JHtjdHguYm9keS5jYWxsYmFja1VSTCB8fCBcIi9cIn1gO1xuICAgICAgICBhd2FpdCBjdHguY29udGV4dC5vcHRpb25zLmVtYWlsVmVyaWZpY2F0aW9uLnNlbmRWZXJpZmljYXRpb25FbWFpbChcbiAgICAgICAgICB7XG4gICAgICAgICAgICB1c2VyOiB1c2VyLnVzZXIsXG4gICAgICAgICAgICB1cmwsXG4gICAgICAgICAgICB0b2tlblxuICAgICAgICAgIH0sXG4gICAgICAgICAgY3R4LnJlcXVlc3RcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkZPUkJJRERFTlwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuRU1BSUxfTk9UX1ZFUklGSUVEXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5jcmVhdGVTZXNzaW9uKFxuICAgICAgdXNlci51c2VyLmlkLFxuICAgICAgY3R4LFxuICAgICAgY3R4LmJvZHkucmVtZW1iZXJNZSA9PT0gZmFsc2VcbiAgICApO1xuICAgIGlmICghc2Vzc2lvbikge1xuICAgICAgY3R4LmNvbnRleHQubG9nZ2VyLmVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBzZXNzaW9uXCIpO1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiVU5BVVRIT1JJWkVEXCIsIHtcbiAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5GQUlMRURfVE9fQ1JFQVRFX1NFU1NJT05cbiAgICAgIH0pO1xuICAgIH1cbiAgICBhd2FpdCBzZXRTZXNzaW9uQ29va2llKFxuICAgICAgY3R4LFxuICAgICAge1xuICAgICAgICBzZXNzaW9uLFxuICAgICAgICB1c2VyOiB1c2VyLnVzZXJcbiAgICAgIH0sXG4gICAgICBjdHguYm9keS5yZW1lbWJlck1lID09PSBmYWxzZVxuICAgICk7XG4gICAgcmV0dXJuIGN0eC5qc29uKHtcbiAgICAgIHJlZGlyZWN0OiAhIWN0eC5ib2R5LmNhbGxiYWNrVVJMLFxuICAgICAgdG9rZW46IHNlc3Npb24udG9rZW4sXG4gICAgICB1cmw6IGN0eC5ib2R5LmNhbGxiYWNrVVJMLFxuICAgICAgdXNlcjoge1xuICAgICAgICBpZDogdXNlci51c2VyLmlkLFxuICAgICAgICBlbWFpbDogdXNlci51c2VyLmVtYWlsLFxuICAgICAgICBuYW1lOiB1c2VyLnVzZXIubmFtZSxcbiAgICAgICAgaW1hZ2U6IHVzZXIudXNlci5pbWFnZSxcbiAgICAgICAgZW1haWxWZXJpZmllZDogdXNlci51c2VyLmVtYWlsVmVyaWZpZWQsXG4gICAgICAgIGNyZWF0ZWRBdDogdXNlci51c2VyLmNyZWF0ZWRBdCxcbiAgICAgICAgdXBkYXRlZEF0OiB1c2VyLnVzZXIudXBkYXRlZEF0XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbik7XG5cbmNvbnN0IHNjaGVtYSA9IHoub2JqZWN0KHtcbiAgY29kZTogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBlcnJvcjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBkZXZpY2VfaWQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgZXJyb3JfZGVzY3JpcHRpb246IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgc3RhdGU6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgdXNlcjogei5zdHJpbmcoKS5vcHRpb25hbCgpXG59KTtcbmNvbnN0IGNhbGxiYWNrT0F1dGggPSBjcmVhdGVBdXRoRW5kcG9pbnQoXG4gIFwiL2NhbGxiYWNrLzppZFwiLFxuICB7XG4gICAgbWV0aG9kOiBbXCJHRVRcIiwgXCJQT1NUXCJdLFxuICAgIGJvZHk6IHNjaGVtYS5vcHRpb25hbCgpLFxuICAgIHF1ZXJ5OiBzY2hlbWEub3B0aW9uYWwoKSxcbiAgICBtZXRhZGF0YTogSElERV9NRVRBREFUQVxuICB9LFxuICBhc3luYyAoYykgPT4ge1xuICAgIGxldCBxdWVyeU9yQm9keTtcbiAgICBjb25zdCBkZWZhdWx0RXJyb3JVUkwgPSBjLmNvbnRleHQub3B0aW9ucy5vbkFQSUVycm9yPy5lcnJvclVSTCB8fCBgJHtjLmNvbnRleHQuYmFzZVVSTH0vZXJyb3JgO1xuICAgIHRyeSB7XG4gICAgICBpZiAoYy5tZXRob2QgPT09IFwiR0VUXCIpIHtcbiAgICAgICAgcXVlcnlPckJvZHkgPSBzY2hlbWEucGFyc2UoYy5xdWVyeSk7XG4gICAgICB9IGVsc2UgaWYgKGMubWV0aG9kID09PSBcIlBPU1RcIikge1xuICAgICAgICBxdWVyeU9yQm9keSA9IHNjaGVtYS5wYXJzZShjLmJvZHkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5zdXBwb3J0ZWQgbWV0aG9kXCIpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGMuY29udGV4dC5sb2dnZXIuZXJyb3IoXCJJTlZBTElEX0NBTExCQUNLX1JFUVVFU1RcIiwgZSk7XG4gICAgICB0aHJvdyBjLnJlZGlyZWN0KGAke2RlZmF1bHRFcnJvclVSTH0/ZXJyb3I9aW52YWxpZF9jYWxsYmFja19yZXF1ZXN0YCk7XG4gICAgfVxuICAgIGNvbnN0IHsgY29kZSwgZXJyb3IsIHN0YXRlLCBlcnJvcl9kZXNjcmlwdGlvbiwgZGV2aWNlX2lkIH0gPSBxdWVyeU9yQm9keTtcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIHRocm93IGMucmVkaXJlY3QoXG4gICAgICAgIGAke2RlZmF1bHRFcnJvclVSTH0/ZXJyb3I9JHtlcnJvcn0mZXJyb3JfZGVzY3JpcHRpb249JHtlcnJvcl9kZXNjcmlwdGlvbn1gXG4gICAgICApO1xuICAgIH1cbiAgICBpZiAoIXN0YXRlKSB7XG4gICAgICBjLmNvbnRleHQubG9nZ2VyLmVycm9yKFwiU3RhdGUgbm90IGZvdW5kXCIsIGVycm9yKTtcbiAgICAgIHRocm93IGMucmVkaXJlY3QoYCR7ZGVmYXVsdEVycm9yVVJMfT9lcnJvcj1zdGF0ZV9ub3RfZm91bmRgKTtcbiAgICB9XG4gICAgY29uc3Qge1xuICAgICAgY29kZVZlcmlmaWVyLFxuICAgICAgY2FsbGJhY2tVUkwsXG4gICAgICBsaW5rLFxuICAgICAgZXJyb3JVUkwsXG4gICAgICBuZXdVc2VyVVJMLFxuICAgICAgcmVxdWVzdFNpZ25VcFxuICAgIH0gPSBhd2FpdCBwYXJzZVN0YXRlKGMpO1xuICAgIGZ1bmN0aW9uIHJlZGlyZWN0T25FcnJvcihlcnJvcjIpIHtcbiAgICAgIGxldCB1cmwgPSBlcnJvclVSTCB8fCBkZWZhdWx0RXJyb3JVUkw7XG4gICAgICBpZiAodXJsLmluY2x1ZGVzKFwiP1wiKSkge1xuICAgICAgICB1cmwgPSBgJHt1cmx9JmVycm9yPSR7ZXJyb3IyfWA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB1cmwgPSBgJHt1cmx9P2Vycm9yPSR7ZXJyb3IyfWA7XG4gICAgICB9XG4gICAgICB0aHJvdyBjLnJlZGlyZWN0KHVybCk7XG4gICAgfVxuICAgIGlmICghY29kZSkge1xuICAgICAgYy5jb250ZXh0LmxvZ2dlci5lcnJvcihcIkNvZGUgbm90IGZvdW5kXCIpO1xuICAgICAgdGhyb3cgcmVkaXJlY3RPbkVycm9yKFwibm9fY29kZVwiKTtcbiAgICB9XG4gICAgY29uc3QgcHJvdmlkZXIgPSBjLmNvbnRleHQuc29jaWFsUHJvdmlkZXJzLmZpbmQoXG4gICAgICAocCkgPT4gcC5pZCA9PT0gYy5wYXJhbXMuaWRcbiAgICApO1xuICAgIGlmICghcHJvdmlkZXIpIHtcbiAgICAgIGMuY29udGV4dC5sb2dnZXIuZXJyb3IoXG4gICAgICAgIFwiT2F1dGggcHJvdmlkZXIgd2l0aCBpZFwiLFxuICAgICAgICBjLnBhcmFtcy5pZCxcbiAgICAgICAgXCJub3QgZm91bmRcIlxuICAgICAgKTtcbiAgICAgIHRocm93IHJlZGlyZWN0T25FcnJvcihcIm9hdXRoX3Byb3ZpZGVyX25vdF9mb3VuZFwiKTtcbiAgICB9XG4gICAgbGV0IHRva2VucztcbiAgICB0cnkge1xuICAgICAgdG9rZW5zID0gYXdhaXQgcHJvdmlkZXIudmFsaWRhdGVBdXRob3JpemF0aW9uQ29kZSh7XG4gICAgICAgIGNvZGUsXG4gICAgICAgIGNvZGVWZXJpZmllcixcbiAgICAgICAgZGV2aWNlSWQ6IGRldmljZV9pZCxcbiAgICAgICAgcmVkaXJlY3RVUkk6IGAke2MuY29udGV4dC5iYXNlVVJMfS9jYWxsYmFjay8ke3Byb3ZpZGVyLmlkfWBcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGMuY29udGV4dC5sb2dnZXIuZXJyb3IoXCJcIiwgZSk7XG4gICAgICB0aHJvdyByZWRpcmVjdE9uRXJyb3IoXCJpbnZhbGlkX2NvZGVcIik7XG4gICAgfVxuICAgIGNvbnN0IHVzZXJJbmZvID0gYXdhaXQgcHJvdmlkZXIuZ2V0VXNlckluZm8oe1xuICAgICAgLi4udG9rZW5zLFxuICAgICAgdXNlcjogYy5ib2R5Py51c2VyID8gc2FmZUpTT05QYXJzZShjLmJvZHkudXNlcikgOiB2b2lkIDBcbiAgICB9KS50aGVuKChyZXMpID0+IHJlcz8udXNlcik7XG4gICAgaWYgKCF1c2VySW5mbykge1xuICAgICAgYy5jb250ZXh0LmxvZ2dlci5lcnJvcihcIlVuYWJsZSB0byBnZXQgdXNlciBpbmZvXCIpO1xuICAgICAgcmV0dXJuIHJlZGlyZWN0T25FcnJvcihcInVuYWJsZV90b19nZXRfdXNlcl9pbmZvXCIpO1xuICAgIH1cbiAgICBpZiAoIWNhbGxiYWNrVVJMKSB7XG4gICAgICBjLmNvbnRleHQubG9nZ2VyLmVycm9yKFwiTm8gY2FsbGJhY2sgVVJMIGZvdW5kXCIpO1xuICAgICAgdGhyb3cgcmVkaXJlY3RPbkVycm9yKFwibm9fY2FsbGJhY2tfdXJsXCIpO1xuICAgIH1cbiAgICBpZiAobGluaykge1xuICAgICAgY29uc3QgdHJ1c3RlZFByb3ZpZGVycyA9IGMuY29udGV4dC5vcHRpb25zLmFjY291bnQ/LmFjY291bnRMaW5raW5nPy50cnVzdGVkUHJvdmlkZXJzO1xuICAgICAgY29uc3QgaXNUcnVzdGVkUHJvdmlkZXIgPSB0cnVzdGVkUHJvdmlkZXJzPy5pbmNsdWRlcyhcbiAgICAgICAgcHJvdmlkZXIuaWRcbiAgICAgICk7XG4gICAgICBpZiAoIWlzVHJ1c3RlZFByb3ZpZGVyICYmICF1c2VySW5mby5lbWFpbFZlcmlmaWVkIHx8IGMuY29udGV4dC5vcHRpb25zLmFjY291bnQ/LmFjY291bnRMaW5raW5nPy5lbmFibGVkID09PSBmYWxzZSkge1xuICAgICAgICBjLmNvbnRleHQubG9nZ2VyLmVycm9yKFwiVW5hYmxlIHRvIGxpbmsgYWNjb3VudCAtIHVudHJ1c3RlZCBwcm92aWRlclwiKTtcbiAgICAgICAgcmV0dXJuIHJlZGlyZWN0T25FcnJvcihcInVuYWJsZV90b19saW5rX2FjY291bnRcIik7XG4gICAgICB9XG4gICAgICBjb25zdCBleGlzdGluZ0FjY291bnQgPSBhd2FpdCBjLmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmZpbmRBY2NvdW50KFxuICAgICAgICB1c2VySW5mby5pZFxuICAgICAgKTtcbiAgICAgIGlmIChleGlzdGluZ0FjY291bnQpIHtcbiAgICAgICAgaWYgKGV4aXN0aW5nQWNjb3VudC51c2VySWQudG9TdHJpbmcoKSAhPT0gbGluay51c2VySWQudG9TdHJpbmcoKSkge1xuICAgICAgICAgIHJldHVybiByZWRpcmVjdE9uRXJyb3IoXCJhY2NvdW50X2FscmVhZHlfbGlua2VkX3RvX2RpZmZlcmVudF91c2VyXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHVwZGF0ZURhdGEgPSBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgICAgICAgT2JqZWN0LmVudHJpZXMoe1xuICAgICAgICAgICAgYWNjZXNzVG9rZW46IGF3YWl0IHNldFRva2VuVXRpbCh0b2tlbnMuYWNjZXNzVG9rZW4sIGMuY29udGV4dCksXG4gICAgICAgICAgICByZWZyZXNoVG9rZW46IGF3YWl0IHNldFRva2VuVXRpbCh0b2tlbnMucmVmcmVzaFRva2VuLCBjLmNvbnRleHQpLFxuICAgICAgICAgICAgaWRUb2tlbjogdG9rZW5zLmlkVG9rZW4sXG4gICAgICAgICAgICBhY2Nlc3NUb2tlbkV4cGlyZXNBdDogdG9rZW5zLmFjY2Vzc1Rva2VuRXhwaXJlc0F0LFxuICAgICAgICAgICAgcmVmcmVzaFRva2VuRXhwaXJlc0F0OiB0b2tlbnMucmVmcmVzaFRva2VuRXhwaXJlc0F0LFxuICAgICAgICAgICAgc2NvcGU6IHRva2Vucy5zY29wZXM/LmpvaW4oXCIsXCIpXG4gICAgICAgICAgfSkuZmlsdGVyKChbXywgdmFsdWVdKSA9PiB2YWx1ZSAhPT0gdm9pZCAwKVxuICAgICAgICApO1xuICAgICAgICBhd2FpdCBjLmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLnVwZGF0ZUFjY291bnQoXG4gICAgICAgICAgZXhpc3RpbmdBY2NvdW50LmlkLFxuICAgICAgICAgIHVwZGF0ZURhdGFcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IG5ld0FjY291bnQgPSBhd2FpdCBjLmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmNyZWF0ZUFjY291bnQoXG4gICAgICAgICAge1xuICAgICAgICAgICAgdXNlcklkOiBsaW5rLnVzZXJJZCxcbiAgICAgICAgICAgIHByb3ZpZGVySWQ6IHByb3ZpZGVyLmlkLFxuICAgICAgICAgICAgYWNjb3VudElkOiB1c2VySW5mby5pZCxcbiAgICAgICAgICAgIC4uLnRva2VucyxcbiAgICAgICAgICAgIGFjY2Vzc1Rva2VuOiBhd2FpdCBzZXRUb2tlblV0aWwodG9rZW5zLmFjY2Vzc1Rva2VuLCBjLmNvbnRleHQpLFxuICAgICAgICAgICAgcmVmcmVzaFRva2VuOiBhd2FpdCBzZXRUb2tlblV0aWwodG9rZW5zLnJlZnJlc2hUb2tlbiwgYy5jb250ZXh0KSxcbiAgICAgICAgICAgIHNjb3BlOiB0b2tlbnMuc2NvcGVzPy5qb2luKFwiLFwiKVxuICAgICAgICAgIH0sXG4gICAgICAgICAgY1xuICAgICAgICApO1xuICAgICAgICBpZiAoIW5ld0FjY291bnQpIHtcbiAgICAgICAgICByZXR1cm4gcmVkaXJlY3RPbkVycm9yKFwidW5hYmxlX3RvX2xpbmtfYWNjb3VudFwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgbGV0IHRvUmVkaXJlY3RUbzI7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB1cmwgPSBjYWxsYmFja1VSTDtcbiAgICAgICAgdG9SZWRpcmVjdFRvMiA9IHVybC50b1N0cmluZygpO1xuICAgICAgfSBjYXRjaCB7XG4gICAgICAgIHRvUmVkaXJlY3RUbzIgPSBjYWxsYmFja1VSTDtcbiAgICAgIH1cbiAgICAgIHRocm93IGMucmVkaXJlY3QodG9SZWRpcmVjdFRvMik7XG4gICAgfVxuICAgIGlmICghdXNlckluZm8uZW1haWwpIHtcbiAgICAgIGMuY29udGV4dC5sb2dnZXIuZXJyb3IoXG4gICAgICAgIFwiUHJvdmlkZXIgZGlkIG5vdCByZXR1cm4gZW1haWwuIFRoaXMgY291bGQgYmUgZHVlIHRvIG1pc2NvbmZpZ3VyYXRpb24gaW4gdGhlIHByb3ZpZGVyIHNldHRpbmdzLlwiXG4gICAgICApO1xuICAgICAgcmV0dXJuIHJlZGlyZWN0T25FcnJvcihcImVtYWlsX25vdF9mb3VuZFwiKTtcbiAgICB9XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlT0F1dGhVc2VySW5mbyhjLCB7XG4gICAgICB1c2VySW5mbzoge1xuICAgICAgICAuLi51c2VySW5mbyxcbiAgICAgICAgZW1haWw6IHVzZXJJbmZvLmVtYWlsLFxuICAgICAgICBuYW1lOiB1c2VySW5mby5uYW1lIHx8IHVzZXJJbmZvLmVtYWlsXG4gICAgICB9LFxuICAgICAgYWNjb3VudDoge1xuICAgICAgICBwcm92aWRlcklkOiBwcm92aWRlci5pZCxcbiAgICAgICAgYWNjb3VudElkOiB1c2VySW5mby5pZCxcbiAgICAgICAgLi4udG9rZW5zLFxuICAgICAgICBzY29wZTogdG9rZW5zLnNjb3Blcz8uam9pbihcIixcIilcbiAgICAgIH0sXG4gICAgICBjYWxsYmFja1VSTCxcbiAgICAgIGRpc2FibGVTaWduVXA6IHByb3ZpZGVyLmRpc2FibGVJbXBsaWNpdFNpZ25VcCAmJiAhcmVxdWVzdFNpZ25VcCB8fCBwcm92aWRlci5vcHRpb25zPy5kaXNhYmxlU2lnblVwLFxuICAgICAgb3ZlcnJpZGVVc2VySW5mbzogcHJvdmlkZXIub3B0aW9ucz8ub3ZlcnJpZGVVc2VySW5mb09uU2lnbkluXG4gICAgfSk7XG4gICAgaWYgKHJlc3VsdC5lcnJvcikge1xuICAgICAgYy5jb250ZXh0LmxvZ2dlci5lcnJvcihyZXN1bHQuZXJyb3Iuc3BsaXQoXCIgXCIpLmpvaW4oXCJfXCIpKTtcbiAgICAgIHJldHVybiByZWRpcmVjdE9uRXJyb3IocmVzdWx0LmVycm9yLnNwbGl0KFwiIFwiKS5qb2luKFwiX1wiKSk7XG4gICAgfVxuICAgIGNvbnN0IHsgc2Vzc2lvbiwgdXNlciB9ID0gcmVzdWx0LmRhdGE7XG4gICAgYXdhaXQgc2V0U2Vzc2lvbkNvb2tpZShjLCB7XG4gICAgICBzZXNzaW9uLFxuICAgICAgdXNlclxuICAgIH0pO1xuICAgIGxldCB0b1JlZGlyZWN0VG87XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVybCA9IHJlc3VsdC5pc1JlZ2lzdGVyID8gbmV3VXNlclVSTCB8fCBjYWxsYmFja1VSTCA6IGNhbGxiYWNrVVJMO1xuICAgICAgdG9SZWRpcmVjdFRvID0gdXJsLnRvU3RyaW5nKCk7XG4gICAgfSBjYXRjaCB7XG4gICAgICB0b1JlZGlyZWN0VG8gPSByZXN1bHQuaXNSZWdpc3RlciA/IG5ld1VzZXJVUkwgfHwgY2FsbGJhY2tVUkwgOiBjYWxsYmFja1VSTDtcbiAgICB9XG4gICAgdGhyb3cgYy5yZWRpcmVjdCh0b1JlZGlyZWN0VG8pO1xuICB9XG4pO1xuXG5jb25zdCBzaWduT3V0ID0gY3JlYXRlQXV0aEVuZHBvaW50KFxuICBcIi9zaWduLW91dFwiLFxuICB7XG4gICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICByZXF1aXJlSGVhZGVyczogdHJ1ZSxcbiAgICBtZXRhZGF0YToge1xuICAgICAgb3BlbmFwaToge1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJTaWduIG91dCB0aGUgY3VycmVudCB1c2VyXCIsXG4gICAgICAgIHJlc3BvbnNlczoge1xuICAgICAgICAgIFwiMjAwXCI6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlN1Y2Nlc3NcIixcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbi9qc29uXCI6IHtcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImJvb2xlYW5cIlxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBhc3luYyAoY3R4KSA9PiB7XG4gICAgY29uc3Qgc2Vzc2lvbkNvb2tpZVRva2VuID0gYXdhaXQgY3R4LmdldFNpZ25lZENvb2tpZShcbiAgICAgIGN0eC5jb250ZXh0LmF1dGhDb29raWVzLnNlc3Npb25Ub2tlbi5uYW1lLFxuICAgICAgY3R4LmNvbnRleHQuc2VjcmV0XG4gICAgKTtcbiAgICBpZiAoIXNlc3Npb25Db29raWVUb2tlbikge1xuICAgICAgZGVsZXRlU2Vzc2lvbkNvb2tpZShjdHgpO1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLkZBSUxFRF9UT19HRVRfU0VTU0lPTlxuICAgICAgfSk7XG4gICAgfVxuICAgIGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5kZWxldGVTZXNzaW9uKHNlc3Npb25Db29raWVUb2tlbik7XG4gICAgZGVsZXRlU2Vzc2lvbkNvb2tpZShjdHgpO1xuICAgIHJldHVybiBjdHguanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlXG4gICAgfSk7XG4gIH1cbik7XG5cbmZ1bmN0aW9uIHJlZGlyZWN0RXJyb3IoY3R4LCBjYWxsYmFja1VSTCwgcXVlcnkpIHtcbiAgY29uc3QgdXJsID0gY2FsbGJhY2tVUkwgPyBuZXcgVVJMKGNhbGxiYWNrVVJMLCBjdHguYmFzZVVSTCkgOiBuZXcgVVJMKGAke2N0eC5iYXNlVVJMfS9lcnJvcmApO1xuICBpZiAocXVlcnkpXG4gICAgT2JqZWN0LmVudHJpZXMocXVlcnkpLmZvckVhY2goKFtrLCB2XSkgPT4gdXJsLnNlYXJjaFBhcmFtcy5zZXQoaywgdikpO1xuICByZXR1cm4gdXJsLmhyZWY7XG59XG5mdW5jdGlvbiByZWRpcmVjdENhbGxiYWNrKGN0eCwgY2FsbGJhY2tVUkwsIHF1ZXJ5KSB7XG4gIGNvbnN0IHVybCA9IG5ldyBVUkwoY2FsbGJhY2tVUkwsIGN0eC5iYXNlVVJMKTtcbiAgaWYgKHF1ZXJ5KVxuICAgIE9iamVjdC5lbnRyaWVzKHF1ZXJ5KS5mb3JFYWNoKChbaywgdl0pID0+IHVybC5zZWFyY2hQYXJhbXMuc2V0KGssIHYpKTtcbiAgcmV0dXJuIHVybC5ocmVmO1xufVxuY29uc3QgcmVxdWVzdFBhc3N3b3JkUmVzZXQgPSBjcmVhdGVBdXRoRW5kcG9pbnQoXG4gIFwiL3JlcXVlc3QtcGFzc3dvcmQtcmVzZXRcIixcbiAge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgYm9keTogei5vYmplY3Qoe1xuICAgICAgLyoqXG4gICAgICAgKiBUaGUgZW1haWwgYWRkcmVzcyBvZiB0aGUgdXNlciB0byBzZW5kIGEgcGFzc3dvcmQgcmVzZXQgZW1haWwgdG8uXG4gICAgICAgKi9cbiAgICAgIGVtYWlsOiB6LmVtYWlsKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBlbWFpbCBhZGRyZXNzIG9mIHRoZSB1c2VyIHRvIHNlbmQgYSBwYXNzd29yZCByZXNldCBlbWFpbCB0b1wiXG4gICAgICB9KSxcbiAgICAgIC8qKlxuICAgICAgICogVGhlIFVSTCB0byByZWRpcmVjdCB0aGUgdXNlciB0byByZXNldCB0aGVpciBwYXNzd29yZC5cbiAgICAgICAqIElmIHRoZSB0b2tlbiBpc24ndCB2YWxpZCBvciBleHBpcmVkLCBpdCdsbCBiZSByZWRpcmVjdGVkIHdpdGggYSBxdWVyeSBwYXJhbWV0ZXIgYD9cbiAgICAgICAqIGVycm9yPUlOVkFMSURfVE9LRU5gLiBJZiB0aGUgdG9rZW4gaXMgdmFsaWQsIGl0J2xsIGJlIHJlZGlyZWN0ZWQgd2l0aCBhIHF1ZXJ5IHBhcmFtZXRlciBgP1xuICAgICAgICogdG9rZW49VkFMSURfVE9LRU5cbiAgICAgICAqL1xuICAgICAgcmVkaXJlY3RUbzogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIFVSTCB0byByZWRpcmVjdCB0aGUgdXNlciB0byByZXNldCB0aGVpciBwYXNzd29yZC4gSWYgdGhlIHRva2VuIGlzbid0IHZhbGlkIG9yIGV4cGlyZWQsIGl0J2xsIGJlIHJlZGlyZWN0ZWQgd2l0aCBhIHF1ZXJ5IHBhcmFtZXRlciBgP2Vycm9yPUlOVkFMSURfVE9LRU5gLiBJZiB0aGUgdG9rZW4gaXMgdmFsaWQsIGl0J2xsIGJlIHJlZGlyZWN0ZWQgd2l0aCBhIHF1ZXJ5IHBhcmFtZXRlciBgP3Rva2VuPVZBTElEX1RPS0VOXCJcbiAgICAgIH0pLm9wdGlvbmFsKClcbiAgICB9KSxcbiAgICBtZXRhZGF0YToge1xuICAgICAgb3BlbmFwaToge1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJTZW5kIGEgcGFzc3dvcmQgcmVzZXQgZW1haWwgdG8gdGhlIHVzZXJcIixcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgXCIyMDBcIjoge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiU3VjY2Vzc1wiLFxuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIjoge1xuICAgICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJib29sZWFuXCJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZToge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgYXN5bmMgKGN0eCkgPT4ge1xuICAgIGlmICghY3R4LmNvbnRleHQub3B0aW9ucy5lbWFpbEFuZFBhc3N3b3JkPy5zZW5kUmVzZXRQYXNzd29yZCkge1xuICAgICAgY3R4LmNvbnRleHQubG9nZ2VyLmVycm9yKFxuICAgICAgICBcIlJlc2V0IHBhc3N3b3JkIGlzbid0IGVuYWJsZWQuUGxlYXNlIHBhc3MgYW4gZW1haWxBbmRQYXNzd29yZC5zZW5kUmVzZXRQYXNzd29yZCBmdW5jdGlvbiBpbiB5b3VyIGF1dGggY29uZmlnIVwiXG4gICAgICApO1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBcIlJlc2V0IHBhc3N3b3JkIGlzbid0IGVuYWJsZWRcIlxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IHsgZW1haWwsIHJlZGlyZWN0VG8gfSA9IGN0eC5ib2R5O1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZmluZFVzZXJCeUVtYWlsKGVtYWlsLCB7XG4gICAgICBpbmNsdWRlQWNjb3VudHM6IHRydWVcbiAgICB9KTtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIGN0eC5jb250ZXh0LmxvZ2dlci5lcnJvcihcIlJlc2V0IFBhc3N3b3JkOiBVc2VyIG5vdCBmb3VuZFwiLCB7IGVtYWlsIH0pO1xuICAgICAgcmV0dXJuIGN0eC5qc29uKHtcbiAgICAgICAgc3RhdHVzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiBcIklmIHRoaXMgZW1haWwgZXhpc3RzIGluIG91ciBzeXN0ZW0sIGNoZWNrIHlvdXIgZW1haWwgZm9yIHRoZSByZXNldCBsaW5rXCJcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBkZWZhdWx0RXhwaXJlc0luID0gNjAgKiA2MCAqIDE7XG4gICAgY29uc3QgZXhwaXJlc0F0ID0gZ2V0RGF0ZShcbiAgICAgIGN0eC5jb250ZXh0Lm9wdGlvbnMuZW1haWxBbmRQYXNzd29yZC5yZXNldFBhc3N3b3JkVG9rZW5FeHBpcmVzSW4gfHwgZGVmYXVsdEV4cGlyZXNJbixcbiAgICAgIFwic2VjXCJcbiAgICApO1xuICAgIGNvbnN0IHZlcmlmaWNhdGlvblRva2VuID0gZ2VuZXJhdGVJZCgyNCk7XG4gICAgYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmNyZWF0ZVZlcmlmaWNhdGlvblZhbHVlKFxuICAgICAge1xuICAgICAgICB2YWx1ZTogdXNlci51c2VyLmlkLFxuICAgICAgICBpZGVudGlmaWVyOiBgcmVzZXQtcGFzc3dvcmQ6JHt2ZXJpZmljYXRpb25Ub2tlbn1gLFxuICAgICAgICBleHBpcmVzQXRcbiAgICAgIH0sXG4gICAgICBjdHhcbiAgICApO1xuICAgIGNvbnN0IGNhbGxiYWNrVVJMID0gcmVkaXJlY3RUbyA/IGVuY29kZVVSSUNvbXBvbmVudChyZWRpcmVjdFRvKSA6IFwiXCI7XG4gICAgY29uc3QgdXJsID0gYCR7Y3R4LmNvbnRleHQuYmFzZVVSTH0vcmVzZXQtcGFzc3dvcmQvJHt2ZXJpZmljYXRpb25Ub2tlbn0/Y2FsbGJhY2tVUkw9JHtjYWxsYmFja1VSTH1gO1xuICAgIGF3YWl0IGN0eC5jb250ZXh0Lm9wdGlvbnMuZW1haWxBbmRQYXNzd29yZC5zZW5kUmVzZXRQYXNzd29yZChcbiAgICAgIHtcbiAgICAgICAgdXNlcjogdXNlci51c2VyLFxuICAgICAgICB1cmwsXG4gICAgICAgIHRva2VuOiB2ZXJpZmljYXRpb25Ub2tlblxuICAgICAgfSxcbiAgICAgIGN0eC5yZXF1ZXN0XG4gICAgKTtcbiAgICByZXR1cm4gY3R4Lmpzb24oe1xuICAgICAgc3RhdHVzOiB0cnVlXG4gICAgfSk7XG4gIH1cbik7XG5jb25zdCBmb3JnZXRQYXNzd29yZCA9IGNyZWF0ZUF1dGhFbmRwb2ludChcbiAgXCIvZm9yZ2V0LXBhc3N3b3JkXCIsXG4gIHtcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgIGJvZHk6IHoub2JqZWN0KHtcbiAgICAgIC8qKlxuICAgICAgICogVGhlIGVtYWlsIGFkZHJlc3Mgb2YgdGhlIHVzZXIgdG8gc2VuZCBhIHBhc3N3b3JkIHJlc2V0IGVtYWlsIHRvLlxuICAgICAgICovXG4gICAgICBlbWFpbDogei5zdHJpbmcoKS5lbWFpbCgpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgZW1haWwgYWRkcmVzcyBvZiB0aGUgdXNlciB0byBzZW5kIGEgcGFzc3dvcmQgcmVzZXQgZW1haWwgdG9cIlxuICAgICAgfSksXG4gICAgICAvKipcbiAgICAgICAqIFRoZSBVUkwgdG8gcmVkaXJlY3QgdGhlIHVzZXIgdG8gcmVzZXQgdGhlaXIgcGFzc3dvcmQuXG4gICAgICAgKiBJZiB0aGUgdG9rZW4gaXNuJ3QgdmFsaWQgb3IgZXhwaXJlZCwgaXQnbGwgYmUgcmVkaXJlY3RlZCB3aXRoIGEgcXVlcnkgcGFyYW1ldGVyIGA/XG4gICAgICAgKiBlcnJvcj1JTlZBTElEX1RPS0VOYC4gSWYgdGhlIHRva2VuIGlzIHZhbGlkLCBpdCdsbCBiZSByZWRpcmVjdGVkIHdpdGggYSBxdWVyeSBwYXJhbWV0ZXIgYD9cbiAgICAgICAqIHRva2VuPVZBTElEX1RPS0VOXG4gICAgICAgKi9cbiAgICAgIHJlZGlyZWN0VG86IHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBVUkwgdG8gcmVkaXJlY3QgdGhlIHVzZXIgdG8gcmVzZXQgdGhlaXIgcGFzc3dvcmQuIElmIHRoZSB0b2tlbiBpc24ndCB2YWxpZCBvciBleHBpcmVkLCBpdCdsbCBiZSByZWRpcmVjdGVkIHdpdGggYSBxdWVyeSBwYXJhbWV0ZXIgYD9lcnJvcj1JTlZBTElEX1RPS0VOYC4gSWYgdGhlIHRva2VuIGlzIHZhbGlkLCBpdCdsbCBiZSByZWRpcmVjdGVkIHdpdGggYSBxdWVyeSBwYXJhbWV0ZXIgYD90b2tlbj1WQUxJRF9UT0tFTlwiXG4gICAgICB9KS5vcHRpb25hbCgpXG4gICAgfSksXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgIG9wZW5hcGk6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiU2VuZCBhIHBhc3N3b3JkIHJlc2V0IGVtYWlsIHRvIHRoZSB1c2VyXCIsXG4gICAgICAgIHJlc3BvbnNlczoge1xuICAgICAgICAgIFwiMjAwXCI6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlN1Y2Nlc3NcIixcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbi9qc29uXCI6IHtcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYm9vbGVhblwiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGFzeW5jIChjdHgpID0+IHtcbiAgICBpZiAoIWN0eC5jb250ZXh0Lm9wdGlvbnMuZW1haWxBbmRQYXNzd29yZD8uc2VuZFJlc2V0UGFzc3dvcmQpIHtcbiAgICAgIGN0eC5jb250ZXh0LmxvZ2dlci5lcnJvcihcbiAgICAgICAgXCJSZXNldCBwYXNzd29yZCBpc24ndCBlbmFibGVkLlBsZWFzZSBwYXNzIGFuIGVtYWlsQW5kUGFzc3dvcmQuc2VuZFJlc2V0UGFzc3dvcmQgZnVuY3Rpb24gaW4geW91ciBhdXRoIGNvbmZpZyFcIlxuICAgICAgKTtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogXCJSZXNldCBwYXNzd29yZCBpc24ndCBlbmFibGVkXCJcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCB7IGVtYWlsLCByZWRpcmVjdFRvIH0gPSBjdHguYm9keTtcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmZpbmRVc2VyQnlFbWFpbChlbWFpbCwge1xuICAgICAgaW5jbHVkZUFjY291bnRzOiB0cnVlXG4gICAgfSk7XG4gICAgaWYgKCF1c2VyKSB7XG4gICAgICBjdHguY29udGV4dC5sb2dnZXIuZXJyb3IoXCJSZXNldCBQYXNzd29yZDogVXNlciBub3QgZm91bmRcIiwgeyBlbWFpbCB9KTtcbiAgICAgIHJldHVybiBjdHguanNvbih7XG4gICAgICAgIHN0YXR1czogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogXCJJZiB0aGlzIGVtYWlsIGV4aXN0cyBpbiBvdXIgc3lzdGVtLCBjaGVjayB5b3VyIGVtYWlsIGZvciB0aGUgcmVzZXQgbGlua1wiXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgZGVmYXVsdEV4cGlyZXNJbiA9IDYwICogNjAgKiAxO1xuICAgIGNvbnN0IGV4cGlyZXNBdCA9IGdldERhdGUoXG4gICAgICBjdHguY29udGV4dC5vcHRpb25zLmVtYWlsQW5kUGFzc3dvcmQucmVzZXRQYXNzd29yZFRva2VuRXhwaXJlc0luIHx8IGRlZmF1bHRFeHBpcmVzSW4sXG4gICAgICBcInNlY1wiXG4gICAgKTtcbiAgICBjb25zdCB2ZXJpZmljYXRpb25Ub2tlbiA9IGdlbmVyYXRlSWQoMjQpO1xuICAgIGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5jcmVhdGVWZXJpZmljYXRpb25WYWx1ZShcbiAgICAgIHtcbiAgICAgICAgdmFsdWU6IHVzZXIudXNlci5pZCxcbiAgICAgICAgaWRlbnRpZmllcjogYHJlc2V0LXBhc3N3b3JkOiR7dmVyaWZpY2F0aW9uVG9rZW59YCxcbiAgICAgICAgZXhwaXJlc0F0XG4gICAgICB9LFxuICAgICAgY3R4XG4gICAgKTtcbiAgICBjb25zdCBjYWxsYmFja1VSTCA9IHJlZGlyZWN0VG8gPyBlbmNvZGVVUklDb21wb25lbnQocmVkaXJlY3RUbykgOiBcIlwiO1xuICAgIGNvbnN0IHVybCA9IGAke2N0eC5jb250ZXh0LmJhc2VVUkx9L3Jlc2V0LXBhc3N3b3JkLyR7dmVyaWZpY2F0aW9uVG9rZW59P2NhbGxiYWNrVVJMPSR7Y2FsbGJhY2tVUkx9YDtcbiAgICBhd2FpdCBjdHguY29udGV4dC5vcHRpb25zLmVtYWlsQW5kUGFzc3dvcmQuc2VuZFJlc2V0UGFzc3dvcmQoXG4gICAgICB7XG4gICAgICAgIHVzZXI6IHVzZXIudXNlcixcbiAgICAgICAgdXJsLFxuICAgICAgICB0b2tlbjogdmVyaWZpY2F0aW9uVG9rZW5cbiAgICAgIH0sXG4gICAgICBjdHgucmVxdWVzdFxuICAgICk7XG4gICAgcmV0dXJuIGN0eC5qc29uKHtcbiAgICAgIHN0YXR1czogdHJ1ZVxuICAgIH0pO1xuICB9XG4pO1xuY29uc3QgcmVxdWVzdFBhc3N3b3JkUmVzZXRDYWxsYmFjayA9IGNyZWF0ZUF1dGhFbmRwb2ludChcbiAgXCIvcmVzZXQtcGFzc3dvcmQvOnRva2VuXCIsXG4gIHtcbiAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgcXVlcnk6IHoub2JqZWN0KHtcbiAgICAgIGNhbGxiYWNrVVJMOiB6LnN0cmluZygpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgVVJMIHRvIHJlZGlyZWN0IHRoZSB1c2VyIHRvIHJlc2V0IHRoZWlyIHBhc3N3b3JkXCJcbiAgICAgIH0pXG4gICAgfSksXG4gICAgdXNlOiBbb3JpZ2luQ2hlY2soKGN0eCkgPT4gY3R4LnF1ZXJ5LmNhbGxiYWNrVVJMKV0sXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgIG9wZW5hcGk6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiUmVkaXJlY3RzIHRoZSB1c2VyIHRvIHRoZSBjYWxsYmFjayBVUkwgd2l0aCB0aGUgdG9rZW5cIixcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgXCIyMDBcIjoge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiU3VjY2Vzc1wiLFxuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIjoge1xuICAgICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgdG9rZW46IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGFzeW5jIChjdHgpID0+IHtcbiAgICBjb25zdCB7IHRva2VuIH0gPSBjdHgucGFyYW1zO1xuICAgIGNvbnN0IHsgY2FsbGJhY2tVUkwgfSA9IGN0eC5xdWVyeTtcbiAgICBpZiAoIXRva2VuIHx8ICFjYWxsYmFja1VSTCkge1xuICAgICAgdGhyb3cgY3R4LnJlZGlyZWN0KFxuICAgICAgICByZWRpcmVjdEVycm9yKGN0eC5jb250ZXh0LCBjYWxsYmFja1VSTCwgeyBlcnJvcjogXCJJTlZBTElEX1RPS0VOXCIgfSlcbiAgICAgICk7XG4gICAgfVxuICAgIGNvbnN0IHZlcmlmaWNhdGlvbiA9IGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5maW5kVmVyaWZpY2F0aW9uVmFsdWUoXG4gICAgICBgcmVzZXQtcGFzc3dvcmQ6JHt0b2tlbn1gXG4gICAgKTtcbiAgICBpZiAoIXZlcmlmaWNhdGlvbiB8fCB2ZXJpZmljYXRpb24uZXhwaXJlc0F0IDwgLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCkpIHtcbiAgICAgIHRocm93IGN0eC5yZWRpcmVjdChcbiAgICAgICAgcmVkaXJlY3RFcnJvcihjdHguY29udGV4dCwgY2FsbGJhY2tVUkwsIHsgZXJyb3I6IFwiSU5WQUxJRF9UT0tFTlwiIH0pXG4gICAgICApO1xuICAgIH1cbiAgICB0aHJvdyBjdHgucmVkaXJlY3QocmVkaXJlY3RDYWxsYmFjayhjdHguY29udGV4dCwgY2FsbGJhY2tVUkwsIHsgdG9rZW4gfSkpO1xuICB9XG4pO1xuY29uc3QgZm9yZ2V0UGFzc3dvcmRDYWxsYmFjayA9IHJlcXVlc3RQYXNzd29yZFJlc2V0Q2FsbGJhY2s7XG5jb25zdCByZXNldFBhc3N3b3JkID0gY3JlYXRlQXV0aEVuZHBvaW50KFxuICBcIi9yZXNldC1wYXNzd29yZFwiLFxuICB7XG4gICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICBxdWVyeTogei5vYmplY3Qoe1xuICAgICAgdG9rZW46IHouc3RyaW5nKCkub3B0aW9uYWwoKVxuICAgIH0pLm9wdGlvbmFsKCksXG4gICAgYm9keTogei5vYmplY3Qoe1xuICAgICAgbmV3UGFzc3dvcmQ6IHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBuZXcgcGFzc3dvcmQgdG8gc2V0XCJcbiAgICAgIH0pLFxuICAgICAgdG9rZW46IHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSB0b2tlbiB0byByZXNldCB0aGUgcGFzc3dvcmRcIlxuICAgICAgfSkub3B0aW9uYWwoKVxuICAgIH0pLFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICBvcGVuYXBpOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlJlc2V0IHRoZSBwYXNzd29yZCBmb3IgYSB1c2VyXCIsXG4gICAgICAgIHJlc3BvbnNlczoge1xuICAgICAgICAgIFwiMjAwXCI6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlN1Y2Nlc3NcIixcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbi9qc29uXCI6IHtcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYm9vbGVhblwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGFzeW5jIChjdHgpID0+IHtcbiAgICBjb25zdCB0b2tlbiA9IGN0eC5ib2R5LnRva2VuIHx8IGN0eC5xdWVyeT8udG9rZW47XG4gICAgaWYgKCF0b2tlbikge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLklOVkFMSURfVE9LRU5cbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCB7IG5ld1Bhc3N3b3JkIH0gPSBjdHguYm9keTtcbiAgICBjb25zdCBtaW5MZW5ndGggPSBjdHguY29udGV4dC5wYXNzd29yZD8uY29uZmlnLm1pblBhc3N3b3JkTGVuZ3RoO1xuICAgIGNvbnN0IG1heExlbmd0aCA9IGN0eC5jb250ZXh0LnBhc3N3b3JkPy5jb25maWcubWF4UGFzc3dvcmRMZW5ndGg7XG4gICAgaWYgKG5ld1Bhc3N3b3JkLmxlbmd0aCA8IG1pbkxlbmd0aCkge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLlBBU1NXT1JEX1RPT19TSE9SVFxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChuZXdQYXNzd29yZC5sZW5ndGggPiBtYXhMZW5ndGgpIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5QQVNTV09SRF9UT09fTE9OR1xuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IGlkID0gYHJlc2V0LXBhc3N3b3JkOiR7dG9rZW59YDtcbiAgICBjb25zdCB2ZXJpZmljYXRpb24gPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZmluZFZlcmlmaWNhdGlvblZhbHVlKGlkKTtcbiAgICBpZiAoIXZlcmlmaWNhdGlvbiB8fCB2ZXJpZmljYXRpb24uZXhwaXJlc0F0IDwgLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCkpIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5JTlZBTElEX1RPS0VOXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgdXNlcklkID0gdmVyaWZpY2F0aW9uLnZhbHVlO1xuICAgIGNvbnN0IGhhc2hlZFBhc3N3b3JkID0gYXdhaXQgY3R4LmNvbnRleHQucGFzc3dvcmQuaGFzaChuZXdQYXNzd29yZCk7XG4gICAgY29uc3QgYWNjb3VudHMgPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZmluZEFjY291bnRzKHVzZXJJZCk7XG4gICAgY29uc3QgYWNjb3VudCA9IGFjY291bnRzLmZpbmQoKGFjKSA9PiBhYy5wcm92aWRlcklkID09PSBcImNyZWRlbnRpYWxcIik7XG4gICAgaWYgKCFhY2NvdW50KSB7XG4gICAgICBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuY3JlYXRlQWNjb3VudChcbiAgICAgICAge1xuICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICBwcm92aWRlcklkOiBcImNyZWRlbnRpYWxcIixcbiAgICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgICAgYWNjb3VudElkOiB1c2VySWRcbiAgICAgICAgfSxcbiAgICAgICAgY3R4XG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIudXBkYXRlUGFzc3dvcmQoXG4gICAgICAgIHVzZXJJZCxcbiAgICAgICAgaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgIGN0eFxuICAgICAgKTtcbiAgICB9XG4gICAgYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmRlbGV0ZVZlcmlmaWNhdGlvblZhbHVlKHZlcmlmaWNhdGlvbi5pZCk7XG4gICAgaWYgKGN0eC5jb250ZXh0Lm9wdGlvbnMuZW1haWxBbmRQYXNzd29yZD8ub25QYXNzd29yZFJlc2V0KSB7XG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmZpbmRVc2VyQnlJZCh1c2VySWQpO1xuICAgICAgaWYgKHVzZXIpIHtcbiAgICAgICAgYXdhaXQgY3R4LmNvbnRleHQub3B0aW9ucy5lbWFpbEFuZFBhc3N3b3JkLm9uUGFzc3dvcmRSZXNldChcbiAgICAgICAgICB7XG4gICAgICAgICAgICB1c2VyXG4gICAgICAgICAgfSxcbiAgICAgICAgICBjdHgucmVxdWVzdFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoY3R4LmNvbnRleHQub3B0aW9ucy5lbWFpbEFuZFBhc3N3b3JkPy5yZXZva2VTZXNzaW9uc09uUGFzc3dvcmRSZXNldCkge1xuICAgICAgYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmRlbGV0ZVNlc3Npb25zKHVzZXJJZCk7XG4gICAgfVxuICAgIHJldHVybiBjdHguanNvbih7XG4gICAgICBzdGF0dXM6IHRydWVcbiAgICB9KTtcbiAgfVxuKTtcblxuY29uc3QgdXBkYXRlVXNlciA9ICgpID0+IGNyZWF0ZUF1dGhFbmRwb2ludChcbiAgXCIvdXBkYXRlLXVzZXJcIixcbiAge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgYm9keTogei5yZWNvcmQoXG4gICAgICB6LnN0cmluZygpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJGaWVsZCBuYW1lIG11c3QgYmUgYSBzdHJpbmdcIlxuICAgICAgfSksXG4gICAgICB6LmFueSgpXG4gICAgKSxcbiAgICB1c2U6IFtzZXNzaW9uTWlkZGxld2FyZV0sXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgICRJbmZlcjoge1xuICAgICAgICBib2R5OiB7fVxuICAgICAgfSxcbiAgICAgIG9wZW5hcGk6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVXBkYXRlIHRoZSBjdXJyZW50IHVzZXJcIixcbiAgICAgICAgcmVxdWVzdEJvZHk6IHtcbiAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIjoge1xuICAgICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgIG5hbWU6IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIG5hbWUgb2YgdGhlIHVzZXJcIlxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIGltYWdlOiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBpbWFnZSBvZiB0aGUgdXNlclwiXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICByZXNwb25zZXM6IHtcbiAgICAgICAgICBcIjIwMFwiOiB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJTdWNjZXNzXCIsXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiOiB7XG4gICAgICAgICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImJvb2xlYW5cIixcbiAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJJbmRpY2F0ZXMgaWYgdGhlIHVwZGF0ZSB3YXMgc3VjY2Vzc2Z1bFwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGFzeW5jIChjdHgpID0+IHtcbiAgICBjb25zdCBib2R5ID0gY3R4LmJvZHk7XG4gICAgaWYgKGJvZHkuZW1haWwpIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5FTUFJTF9DQU5fTk9UX0JFX1VQREFURURcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCB7IG5hbWUsIGltYWdlLCAuLi5yZXN0IH0gPSBib2R5O1xuICAgIGNvbnN0IHNlc3Npb24gPSBjdHguY29udGV4dC5zZXNzaW9uO1xuICAgIGlmIChpbWFnZSA9PT0gdm9pZCAwICYmIG5hbWUgPT09IHZvaWQgMCAmJiBPYmplY3Qua2V5cyhyZXN0KS5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBjdHguanNvbih7XG4gICAgICAgIHN0YXR1czogdHJ1ZVxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IGFkZGl0aW9uYWxGaWVsZHMgPSBwYXJzZVVzZXJJbnB1dChcbiAgICAgIGN0eC5jb250ZXh0Lm9wdGlvbnMsXG4gICAgICByZXN0LFxuICAgICAgXCJ1cGRhdGVcIlxuICAgICk7XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci51cGRhdGVVc2VyKFxuICAgICAgc2Vzc2lvbi51c2VyLmlkLFxuICAgICAge1xuICAgICAgICBuYW1lLFxuICAgICAgICBpbWFnZSxcbiAgICAgICAgLi4uYWRkaXRpb25hbEZpZWxkc1xuICAgICAgfSxcbiAgICAgIGN0eFxuICAgICk7XG4gICAgYXdhaXQgc2V0U2Vzc2lvbkNvb2tpZShjdHgsIHtcbiAgICAgIHNlc3Npb246IHNlc3Npb24uc2Vzc2lvbixcbiAgICAgIHVzZXJcbiAgICB9KTtcbiAgICByZXR1cm4gY3R4Lmpzb24oe1xuICAgICAgc3RhdHVzOiB0cnVlXG4gICAgfSk7XG4gIH1cbik7XG5jb25zdCBjaGFuZ2VQYXNzd29yZCA9IGNyZWF0ZUF1dGhFbmRwb2ludChcbiAgXCIvY2hhbmdlLXBhc3N3b3JkXCIsXG4gIHtcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgIGJvZHk6IHoub2JqZWN0KHtcbiAgICAgIC8qKlxuICAgICAgICogVGhlIG5ldyBwYXNzd29yZCB0byBzZXRcbiAgICAgICAqL1xuICAgICAgbmV3UGFzc3dvcmQ6IHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBuZXcgcGFzc3dvcmQgdG8gc2V0XCJcbiAgICAgIH0pLFxuICAgICAgLyoqXG4gICAgICAgKiBUaGUgY3VycmVudCBwYXNzd29yZCBvZiB0aGUgdXNlclxuICAgICAgICovXG4gICAgICBjdXJyZW50UGFzc3dvcmQ6IHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBjdXJyZW50IHBhc3N3b3JkIGlzIHJlcXVpcmVkXCJcbiAgICAgIH0pLFxuICAgICAgLyoqXG4gICAgICAgKiByZXZva2UgYWxsIHNlc3Npb25zIHRoYXQgYXJlIG5vdCB0aGVcbiAgICAgICAqIGN1cnJlbnQgb25lIGxvZ2dlZCBpbiBieSB0aGUgdXNlclxuICAgICAgICovXG4gICAgICByZXZva2VPdGhlclNlc3Npb25zOiB6LmJvb2xlYW4oKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiTXVzdCBiZSBhIGJvb2xlYW4gdmFsdWVcIlxuICAgICAgfSkub3B0aW9uYWwoKVxuICAgIH0pLFxuICAgIHVzZTogW3Nlc3Npb25NaWRkbGV3YXJlXSxcbiAgICBtZXRhZGF0YToge1xuICAgICAgb3BlbmFwaToge1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJDaGFuZ2UgdGhlIHBhc3N3b3JkIG9mIHRoZSB1c2VyXCIsXG4gICAgICAgIHJlc3BvbnNlczoge1xuICAgICAgICAgIFwiMjAwXCI6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlBhc3N3b3JkIHN1Y2Nlc3NmdWxseSBjaGFuZ2VkXCIsXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiOiB7XG4gICAgICAgICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICB0b2tlbjoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgbnVsbGFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgLy8gT25seSBwcmVzZW50IGlmIHJldm9rZU90aGVyU2Vzc2lvbnMgaXMgdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIk5ldyBzZXNzaW9uIHRva2VuIGlmIG90aGVyIHNlc3Npb25zIHdlcmUgcmV2b2tlZFwiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSB1bmlxdWUgaWRlbnRpZmllciBvZiB0aGUgdXNlclwiXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZW1haWw6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBcImVtYWlsXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBlbWFpbCBhZGRyZXNzIG9mIHRoZSB1c2VyXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBuYW1lIG9mIHRoZSB1c2VyXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWFnZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFwidXJpXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG51bGxhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgcHJvZmlsZSBpbWFnZSBVUkwgb2YgdGhlIHVzZXJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJib29sZWFuXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIldoZXRoZXIgdGhlIGVtYWlsIGhhcyBiZWVuIHZlcmlmaWVkXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBcImRhdGUtdGltZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJXaGVuIHRoZSB1c2VyIHdhcyBjcmVhdGVkXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkQXQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBcImRhdGUtdGltZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJXaGVuIHRoZSB1c2VyIHdhcyBsYXN0IHVwZGF0ZWRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiaWRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZW1haWxcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJlbWFpbFZlcmlmaWVkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNyZWF0ZWRBdFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ1cGRhdGVkQXRcIlxuICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBbXCJ1c2VyXCJdXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBhc3luYyAoY3R4KSA9PiB7XG4gICAgY29uc3QgeyBuZXdQYXNzd29yZCwgY3VycmVudFBhc3N3b3JkLCByZXZva2VPdGhlclNlc3Npb25zIH0gPSBjdHguYm9keTtcbiAgICBjb25zdCBzZXNzaW9uID0gY3R4LmNvbnRleHQuc2Vzc2lvbjtcbiAgICBjb25zdCBtaW5QYXNzd29yZExlbmd0aCA9IGN0eC5jb250ZXh0LnBhc3N3b3JkLmNvbmZpZy5taW5QYXNzd29yZExlbmd0aDtcbiAgICBpZiAobmV3UGFzc3dvcmQubGVuZ3RoIDwgbWluUGFzc3dvcmRMZW5ndGgpIHtcbiAgICAgIGN0eC5jb250ZXh0LmxvZ2dlci5lcnJvcihcIlBhc3N3b3JkIGlzIHRvbyBzaG9ydFwiKTtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5QQVNTV09SRF9UT09fU0hPUlRcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBtYXhQYXNzd29yZExlbmd0aCA9IGN0eC5jb250ZXh0LnBhc3N3b3JkLmNvbmZpZy5tYXhQYXNzd29yZExlbmd0aDtcbiAgICBpZiAobmV3UGFzc3dvcmQubGVuZ3RoID4gbWF4UGFzc3dvcmRMZW5ndGgpIHtcbiAgICAgIGN0eC5jb250ZXh0LmxvZ2dlci5lcnJvcihcIlBhc3N3b3JkIGlzIHRvbyBsb25nXCIpO1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLlBBU1NXT1JEX1RPT19MT05HXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgYWNjb3VudHMgPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZmluZEFjY291bnRzKFxuICAgICAgc2Vzc2lvbi51c2VyLmlkXG4gICAgKTtcbiAgICBjb25zdCBhY2NvdW50ID0gYWNjb3VudHMuZmluZChcbiAgICAgIChhY2NvdW50MikgPT4gYWNjb3VudDIucHJvdmlkZXJJZCA9PT0gXCJjcmVkZW50aWFsXCIgJiYgYWNjb3VudDIucGFzc3dvcmRcbiAgICApO1xuICAgIGlmICghYWNjb3VudCB8fCAhYWNjb3VudC5wYXNzd29yZCkge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLkNSRURFTlRJQUxfQUNDT1VOVF9OT1RfRk9VTkRcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBwYXNzd29yZEhhc2ggPSBhd2FpdCBjdHguY29udGV4dC5wYXNzd29yZC5oYXNoKG5ld1Bhc3N3b3JkKTtcbiAgICBjb25zdCB2ZXJpZnkgPSBhd2FpdCBjdHguY29udGV4dC5wYXNzd29yZC52ZXJpZnkoe1xuICAgICAgaGFzaDogYWNjb3VudC5wYXNzd29yZCxcbiAgICAgIHBhc3N3b3JkOiBjdXJyZW50UGFzc3dvcmRcbiAgICB9KTtcbiAgICBpZiAoIXZlcmlmeSkge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLklOVkFMSURfUEFTU1dPUkRcbiAgICAgIH0pO1xuICAgIH1cbiAgICBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIudXBkYXRlQWNjb3VudChhY2NvdW50LmlkLCB7XG4gICAgICBwYXNzd29yZDogcGFzc3dvcmRIYXNoXG4gICAgfSk7XG4gICAgbGV0IHRva2VuID0gbnVsbDtcbiAgICBpZiAocmV2b2tlT3RoZXJTZXNzaW9ucykge1xuICAgICAgYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmRlbGV0ZVNlc3Npb25zKHNlc3Npb24udXNlci5pZCk7XG4gICAgICBjb25zdCBuZXdTZXNzaW9uID0gYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmNyZWF0ZVNlc3Npb24oXG4gICAgICAgIHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgY3R4XG4gICAgICApO1xuICAgICAgaWYgKCFuZXdTZXNzaW9uKSB7XG4gICAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIklOVEVSTkFMX1NFUlZFUl9FUlJPUlwiLCB7XG4gICAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5GQUlMRURfVE9fR0VUX1NFU1NJT05cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBhd2FpdCBzZXRTZXNzaW9uQ29va2llKGN0eCwge1xuICAgICAgICBzZXNzaW9uOiBuZXdTZXNzaW9uLFxuICAgICAgICB1c2VyOiBzZXNzaW9uLnVzZXJcbiAgICAgIH0pO1xuICAgICAgdG9rZW4gPSBuZXdTZXNzaW9uLnRva2VuO1xuICAgIH1cbiAgICByZXR1cm4gY3R4Lmpzb24oe1xuICAgICAgdG9rZW4sXG4gICAgICB1c2VyOiB7XG4gICAgICAgIGlkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgIGVtYWlsOiBzZXNzaW9uLnVzZXIuZW1haWwsXG4gICAgICAgIG5hbWU6IHNlc3Npb24udXNlci5uYW1lLFxuICAgICAgICBpbWFnZTogc2Vzc2lvbi51c2VyLmltYWdlLFxuICAgICAgICBlbWFpbFZlcmlmaWVkOiBzZXNzaW9uLnVzZXIuZW1haWxWZXJpZmllZCxcbiAgICAgICAgY3JlYXRlZEF0OiBzZXNzaW9uLnVzZXIuY3JlYXRlZEF0LFxuICAgICAgICB1cGRhdGVkQXQ6IHNlc3Npb24udXNlci51cGRhdGVkQXRcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuKTtcbmNvbnN0IHNldFBhc3N3b3JkID0gY3JlYXRlQXV0aEVuZHBvaW50KFxuICBcIi9zZXQtcGFzc3dvcmRcIixcbiAge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgYm9keTogei5vYmplY3Qoe1xuICAgICAgLyoqXG4gICAgICAgKiBUaGUgbmV3IHBhc3N3b3JkIHRvIHNldFxuICAgICAgICovXG4gICAgICBuZXdQYXNzd29yZDogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIG5ldyBwYXNzd29yZCB0byBzZXQgaXMgcmVxdWlyZWRcIlxuICAgICAgfSlcbiAgICB9KSxcbiAgICBtZXRhZGF0YToge1xuICAgICAgU0VSVkVSX09OTFk6IHRydWVcbiAgICB9LFxuICAgIHVzZTogW3Nlc3Npb25NaWRkbGV3YXJlXVxuICB9LFxuICBhc3luYyAoY3R4KSA9PiB7XG4gICAgY29uc3QgeyBuZXdQYXNzd29yZCB9ID0gY3R4LmJvZHk7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGN0eC5jb250ZXh0LnNlc3Npb247XG4gICAgY29uc3QgbWluUGFzc3dvcmRMZW5ndGggPSBjdHguY29udGV4dC5wYXNzd29yZC5jb25maWcubWluUGFzc3dvcmRMZW5ndGg7XG4gICAgaWYgKG5ld1Bhc3N3b3JkLmxlbmd0aCA8IG1pblBhc3N3b3JkTGVuZ3RoKSB7XG4gICAgICBjdHguY29udGV4dC5sb2dnZXIuZXJyb3IoXCJQYXNzd29yZCBpcyB0b28gc2hvcnRcIik7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuUEFTU1dPUkRfVE9PX1NIT1JUXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgbWF4UGFzc3dvcmRMZW5ndGggPSBjdHguY29udGV4dC5wYXNzd29yZC5jb25maWcubWF4UGFzc3dvcmRMZW5ndGg7XG4gICAgaWYgKG5ld1Bhc3N3b3JkLmxlbmd0aCA+IG1heFBhc3N3b3JkTGVuZ3RoKSB7XG4gICAgICBjdHguY29udGV4dC5sb2dnZXIuZXJyb3IoXCJQYXNzd29yZCBpcyB0b28gbG9uZ1wiKTtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5QQVNTV09SRF9UT09fTE9OR1xuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IGFjY291bnRzID0gYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmZpbmRBY2NvdW50cyhcbiAgICAgIHNlc3Npb24udXNlci5pZFxuICAgICk7XG4gICAgY29uc3QgYWNjb3VudCA9IGFjY291bnRzLmZpbmQoXG4gICAgICAoYWNjb3VudDIpID0+IGFjY291bnQyLnByb3ZpZGVySWQgPT09IFwiY3JlZGVudGlhbFwiICYmIGFjY291bnQyLnBhc3N3b3JkXG4gICAgKTtcbiAgICBjb25zdCBwYXNzd29yZEhhc2ggPSBhd2FpdCBjdHguY29udGV4dC5wYXNzd29yZC5oYXNoKG5ld1Bhc3N3b3JkKTtcbiAgICBpZiAoIWFjY291bnQpIHtcbiAgICAgIGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5saW5rQWNjb3VudChcbiAgICAgICAge1xuICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgIHByb3ZpZGVySWQ6IFwiY3JlZGVudGlhbFwiLFxuICAgICAgICAgIGFjY291bnRJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZEhhc2hcbiAgICAgICAgfSxcbiAgICAgICAgY3R4XG4gICAgICApO1xuICAgICAgcmV0dXJuIGN0eC5qc29uKHtcbiAgICAgICAgc3RhdHVzOiB0cnVlXG4gICAgICB9KTtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgbWVzc2FnZTogXCJ1c2VyIGFscmVhZHkgaGFzIGEgcGFzc3dvcmRcIlxuICAgIH0pO1xuICB9XG4pO1xuY29uc3QgZGVsZXRlVXNlciA9IGNyZWF0ZUF1dGhFbmRwb2ludChcbiAgXCIvZGVsZXRlLXVzZXJcIixcbiAge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgdXNlOiBbc2Vzc2lvbk1pZGRsZXdhcmVdLFxuICAgIGJvZHk6IHoub2JqZWN0KHtcbiAgICAgIC8qKlxuICAgICAgICogVGhlIGNhbGxiYWNrIFVSTCB0byByZWRpcmVjdCB0byBhZnRlciB0aGUgdXNlciBpcyBkZWxldGVkXG4gICAgICAgKiB0aGlzIGlzIG9ubHkgdXNlZCBvbiBkZWxldGUgdXNlciBjYWxsYmFja1xuICAgICAgICovXG4gICAgICBjYWxsYmFja1VSTDogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIGNhbGxiYWNrIFVSTCB0byByZWRpcmVjdCB0byBhZnRlciB0aGUgdXNlciBpcyBkZWxldGVkXCJcbiAgICAgIH0pLm9wdGlvbmFsKCksXG4gICAgICAvKipcbiAgICAgICAqIFRoZSBwYXNzd29yZCBvZiB0aGUgdXNlci4gSWYgdGhlIHBhc3N3b3JkIGlzbid0IHByb3ZpZGVkLCBzZXNzaW9uIGZyZXNobmVzc1xuICAgICAgICogd2lsbCBiZSBjaGVja2VkLlxuICAgICAgICovXG4gICAgICBwYXNzd29yZDogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIHBhc3N3b3JkIG9mIHRoZSB1c2VyIGlzIHJlcXVpcmVkIHRvIGRlbGV0ZSB0aGUgdXNlclwiXG4gICAgICB9KS5vcHRpb25hbCgpLFxuICAgICAgLyoqXG4gICAgICAgKiBUaGUgdG9rZW4gdG8gZGVsZXRlIHRoZSB1c2VyLiBJZiB0aGUgdG9rZW4gaXMgcHJvdmlkZWQsIHRoZSB1c2VyIHdpbGwgYmUgZGVsZXRlZFxuICAgICAgICovXG4gICAgICB0b2tlbjogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIHRva2VuIHRvIGRlbGV0ZSB0aGUgdXNlciBpcyByZXF1aXJlZFwiXG4gICAgICB9KS5vcHRpb25hbCgpXG4gICAgfSksXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgIG9wZW5hcGk6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiRGVsZXRlIHRoZSB1c2VyXCIsXG4gICAgICAgIHJlc3BvbnNlczoge1xuICAgICAgICAgIFwiMjAwXCI6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlVzZXIgZGVsZXRpb24gcHJvY2Vzc2VkIHN1Y2Nlc3NmdWxseVwiLFxuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIjoge1xuICAgICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzczoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYm9vbGVhblwiLFxuICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkluZGljYXRlcyBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsXCJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZToge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgZW51bTogW1wiVXNlciBkZWxldGVkXCIsIFwiVmVyaWZpY2F0aW9uIGVtYWlsIHNlbnRcIl0sXG4gICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiU3RhdHVzIG1lc3NhZ2Ugb2YgdGhlIGRlbGV0aW9uIHByb2Nlc3NcIlxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFtcInN1Y2Nlc3NcIiwgXCJtZXNzYWdlXCJdXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBhc3luYyAoY3R4KSA9PiB7XG4gICAgaWYgKCFjdHguY29udGV4dC5vcHRpb25zLnVzZXI/LmRlbGV0ZVVzZXI/LmVuYWJsZWQpIHtcbiAgICAgIGN0eC5jb250ZXh0LmxvZ2dlci5lcnJvcihcbiAgICAgICAgXCJEZWxldGUgdXNlciBpcyBkaXNhYmxlZC4gRW5hYmxlIGl0IGluIHRoZSBvcHRpb25zXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBzZXNzaW9uOiBjdHguY29udGV4dC5zZXNzaW9uXG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJOT1RfRk9VTkRcIik7XG4gICAgfVxuICAgIGNvbnN0IHNlc3Npb24gPSBjdHguY29udGV4dC5zZXNzaW9uO1xuICAgIGlmIChjdHguYm9keS5wYXNzd29yZCkge1xuICAgICAgY29uc3QgYWNjb3VudHMgPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZmluZEFjY291bnRzKFxuICAgICAgICBzZXNzaW9uLnVzZXIuaWRcbiAgICAgICk7XG4gICAgICBjb25zdCBhY2NvdW50ID0gYWNjb3VudHMuZmluZChcbiAgICAgICAgKGFjY291bnQyKSA9PiBhY2NvdW50Mi5wcm92aWRlcklkID09PSBcImNyZWRlbnRpYWxcIiAmJiBhY2NvdW50Mi5wYXNzd29yZFxuICAgICAgKTtcbiAgICAgIGlmICghYWNjb3VudCB8fCAhYWNjb3VudC5wYXNzd29yZCkge1xuICAgICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5DUkVERU5USUFMX0FDQ09VTlRfTk9UX0ZPVU5EXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgY29uc3QgdmVyaWZ5ID0gYXdhaXQgY3R4LmNvbnRleHQucGFzc3dvcmQudmVyaWZ5KHtcbiAgICAgICAgaGFzaDogYWNjb3VudC5wYXNzd29yZCxcbiAgICAgICAgcGFzc3dvcmQ6IGN0eC5ib2R5LnBhc3N3b3JkXG4gICAgICB9KTtcbiAgICAgIGlmICghdmVyaWZ5KSB7XG4gICAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLklOVkFMSURfUEFTU1dPUkRcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChjdHguYm9keS50b2tlbikge1xuICAgICAgYXdhaXQgZGVsZXRlVXNlckNhbGxiYWNrKHtcbiAgICAgICAgLi4uY3R4LFxuICAgICAgICBxdWVyeToge1xuICAgICAgICAgIHRva2VuOiBjdHguYm9keS50b2tlblxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBjdHguanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6IFwiVXNlciBkZWxldGVkXCJcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoY3R4LmNvbnRleHQub3B0aW9ucy51c2VyLmRlbGV0ZVVzZXI/LnNlbmREZWxldGVBY2NvdW50VmVyaWZpY2F0aW9uKSB7XG4gICAgICBjb25zdCB0b2tlbiA9IGdlbmVyYXRlUmFuZG9tU3RyaW5nKDMyLCBcIjAtOVwiLCBcImEtelwiKTtcbiAgICAgIGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5jcmVhdGVWZXJpZmljYXRpb25WYWx1ZShcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgaWRlbnRpZmllcjogYGRlbGV0ZS1hY2NvdW50LSR7dG9rZW59YCxcbiAgICAgICAgICBleHBpcmVzQXQ6IG5ldyBEYXRlKFxuICAgICAgICAgICAgRGF0ZS5ub3coKSArIChjdHguY29udGV4dC5vcHRpb25zLnVzZXIuZGVsZXRlVXNlcj8uZGVsZXRlVG9rZW5FeHBpcmVzSW4gfHwgNjAgKiA2MCAqIDI0KSAqIDFlM1xuICAgICAgICAgIClcbiAgICAgICAgfSxcbiAgICAgICAgY3R4XG4gICAgICApO1xuICAgICAgY29uc3QgdXJsID0gYCR7Y3R4LmNvbnRleHQuYmFzZVVSTH0vZGVsZXRlLXVzZXIvY2FsbGJhY2s/dG9rZW49JHt0b2tlbn0mY2FsbGJhY2tVUkw9JHtjdHguYm9keS5jYWxsYmFja1VSTCB8fCBcIi9cIn1gO1xuICAgICAgYXdhaXQgY3R4LmNvbnRleHQub3B0aW9ucy51c2VyLmRlbGV0ZVVzZXIuc2VuZERlbGV0ZUFjY291bnRWZXJpZmljYXRpb24oXG4gICAgICAgIHtcbiAgICAgICAgICB1c2VyOiBzZXNzaW9uLnVzZXIsXG4gICAgICAgICAgdXJsLFxuICAgICAgICAgIHRva2VuXG4gICAgICAgIH0sXG4gICAgICAgIGN0eC5yZXF1ZXN0XG4gICAgICApO1xuICAgICAgcmV0dXJuIGN0eC5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogXCJWZXJpZmljYXRpb24gZW1haWwgc2VudFwiXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKCFjdHguYm9keS5wYXNzd29yZCAmJiBjdHguY29udGV4dC5zZXNzaW9uQ29uZmlnLmZyZXNoQWdlICE9PSAwKSB7XG4gICAgICBjb25zdCBjdXJyZW50QWdlID0gc2Vzc2lvbi5zZXNzaW9uLmNyZWF0ZWRBdC5nZXRUaW1lKCk7XG4gICAgICBjb25zdCBmcmVzaEFnZSA9IGN0eC5jb250ZXh0LnNlc3Npb25Db25maWcuZnJlc2hBZ2UgKiAxZTM7XG4gICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgICAgaWYgKG5vdyAtIGN1cnJlbnRBZ2UgPiBmcmVzaEFnZSAqIDFlMykge1xuICAgICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5TRVNTSU9OX0VYUElSRURcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGJlZm9yZURlbGV0ZSA9IGN0eC5jb250ZXh0Lm9wdGlvbnMudXNlci5kZWxldGVVc2VyPy5iZWZvcmVEZWxldGU7XG4gICAgaWYgKGJlZm9yZURlbGV0ZSkge1xuICAgICAgYXdhaXQgYmVmb3JlRGVsZXRlKHNlc3Npb24udXNlciwgY3R4LnJlcXVlc3QpO1xuICAgIH1cbiAgICBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZGVsZXRlVXNlcihzZXNzaW9uLnVzZXIuaWQpO1xuICAgIGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5kZWxldGVTZXNzaW9ucyhzZXNzaW9uLnVzZXIuaWQpO1xuICAgIGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5kZWxldGVBY2NvdW50cyhzZXNzaW9uLnVzZXIuaWQpO1xuICAgIGRlbGV0ZVNlc3Npb25Db29raWUoY3R4KTtcbiAgICBjb25zdCBhZnRlckRlbGV0ZSA9IGN0eC5jb250ZXh0Lm9wdGlvbnMudXNlci5kZWxldGVVc2VyPy5hZnRlckRlbGV0ZTtcbiAgICBpZiAoYWZ0ZXJEZWxldGUpIHtcbiAgICAgIGF3YWl0IGFmdGVyRGVsZXRlKHNlc3Npb24udXNlciwgY3R4LnJlcXVlc3QpO1xuICAgIH1cbiAgICByZXR1cm4gY3R4Lmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIG1lc3NhZ2U6IFwiVXNlciBkZWxldGVkXCJcbiAgICB9KTtcbiAgfVxuKTtcbmNvbnN0IGRlbGV0ZVVzZXJDYWxsYmFjayA9IGNyZWF0ZUF1dGhFbmRwb2ludChcbiAgXCIvZGVsZXRlLXVzZXIvY2FsbGJhY2tcIixcbiAge1xuICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICBxdWVyeTogei5vYmplY3Qoe1xuICAgICAgdG9rZW46IHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSB0b2tlbiB0byB2ZXJpZnkgdGhlIGRlbGV0aW9uIHJlcXVlc3RcIlxuICAgICAgfSksXG4gICAgICBjYWxsYmFja1VSTDogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIFVSTCB0byByZWRpcmVjdCB0byBhZnRlciBkZWxldGlvblwiXG4gICAgICB9KS5vcHRpb25hbCgpXG4gICAgfSksXG4gICAgdXNlOiBbb3JpZ2luQ2hlY2soKGN0eCkgPT4gY3R4LnF1ZXJ5LmNhbGxiYWNrVVJMKV0sXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgIG9wZW5hcGk6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiQ2FsbGJhY2sgdG8gY29tcGxldGUgdXNlciBkZWxldGlvbiB3aXRoIHZlcmlmaWNhdGlvbiB0b2tlblwiLFxuICAgICAgICByZXNwb25zZXM6IHtcbiAgICAgICAgICBcIjIwMFwiOiB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJVc2VyIHN1Y2Nlc3NmdWxseSBkZWxldGVkXCIsXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiOiB7XG4gICAgICAgICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJib29sZWFuXCIsXG4gICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiSW5kaWNhdGVzIGlmIHRoZSBkZWxldGlvbiB3YXMgc3VjY2Vzc2Z1bFwiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgIGVudW06IFtcIlVzZXIgZGVsZXRlZFwiXSxcbiAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJDb25maXJtYXRpb24gbWVzc2FnZVwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICByZXF1aXJlZDogW1wic3VjY2Vzc1wiLCBcIm1lc3NhZ2VcIl1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGFzeW5jIChjdHgpID0+IHtcbiAgICBpZiAoIWN0eC5jb250ZXh0Lm9wdGlvbnMudXNlcj8uZGVsZXRlVXNlcj8uZW5hYmxlZCkge1xuICAgICAgY3R4LmNvbnRleHQubG9nZ2VyLmVycm9yKFxuICAgICAgICBcIkRlbGV0ZSB1c2VyIGlzIGRpc2FibGVkLiBFbmFibGUgaXQgaW4gdGhlIG9wdGlvbnNcIlxuICAgICAgKTtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIk5PVF9GT1VORFwiKTtcbiAgICB9XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGdldFNlc3Npb25Gcm9tQ3R4KGN0eCk7XG4gICAgaWYgKCFzZXNzaW9uKSB7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJOT1RfRk9VTkRcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLkZBSUxFRF9UT19HRVRfVVNFUl9JTkZPXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgdG9rZW4gPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZmluZFZlcmlmaWNhdGlvblZhbHVlKFxuICAgICAgYGRlbGV0ZS1hY2NvdW50LSR7Y3R4LnF1ZXJ5LnRva2VufWBcbiAgICApO1xuICAgIGlmICghdG9rZW4gfHwgdG9rZW4uZXhwaXJlc0F0IDwgLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCkpIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIk5PVF9GT1VORFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuSU5WQUxJRF9UT0tFTlxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmICh0b2tlbi52YWx1ZSAhPT0gc2Vzc2lvbi51c2VyLmlkKSB7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJOT1RfRk9VTkRcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLklOVkFMSURfVE9LRU5cbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBiZWZvcmVEZWxldGUgPSBjdHguY29udGV4dC5vcHRpb25zLnVzZXIuZGVsZXRlVXNlcj8uYmVmb3JlRGVsZXRlO1xuICAgIGlmIChiZWZvcmVEZWxldGUpIHtcbiAgICAgIGF3YWl0IGJlZm9yZURlbGV0ZShzZXNzaW9uLnVzZXIsIGN0eC5yZXF1ZXN0KTtcbiAgICB9XG4gICAgYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmRlbGV0ZVVzZXIoc2Vzc2lvbi51c2VyLmlkKTtcbiAgICBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZGVsZXRlU2Vzc2lvbnMoc2Vzc2lvbi51c2VyLmlkKTtcbiAgICBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZGVsZXRlQWNjb3VudHMoc2Vzc2lvbi51c2VyLmlkKTtcbiAgICBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZGVsZXRlVmVyaWZpY2F0aW9uVmFsdWUodG9rZW4uaWQpO1xuICAgIGRlbGV0ZVNlc3Npb25Db29raWUoY3R4KTtcbiAgICBjb25zdCBhZnRlckRlbGV0ZSA9IGN0eC5jb250ZXh0Lm9wdGlvbnMudXNlci5kZWxldGVVc2VyPy5hZnRlckRlbGV0ZTtcbiAgICBpZiAoYWZ0ZXJEZWxldGUpIHtcbiAgICAgIGF3YWl0IGFmdGVyRGVsZXRlKHNlc3Npb24udXNlciwgY3R4LnJlcXVlc3QpO1xuICAgIH1cbiAgICBpZiAoY3R4LnF1ZXJ5LmNhbGxiYWNrVVJMKSB7XG4gICAgICB0aHJvdyBjdHgucmVkaXJlY3QoY3R4LnF1ZXJ5LmNhbGxiYWNrVVJMIHx8IFwiL1wiKTtcbiAgICB9XG4gICAgcmV0dXJuIGN0eC5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtZXNzYWdlOiBcIlVzZXIgZGVsZXRlZFwiXG4gICAgfSk7XG4gIH1cbik7XG5jb25zdCBjaGFuZ2VFbWFpbCA9IGNyZWF0ZUF1dGhFbmRwb2ludChcbiAgXCIvY2hhbmdlLWVtYWlsXCIsXG4gIHtcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgIGJvZHk6IHoub2JqZWN0KHtcbiAgICAgIG5ld0VtYWlsOiB6LmVtYWlsKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBuZXcgZW1haWwgYWRkcmVzcyB0byBzZXQgbXVzdCBiZSBhIHZhbGlkIGVtYWlsIGFkZHJlc3NcIlxuICAgICAgfSksXG4gICAgICBjYWxsYmFja1VSTDogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIFVSTCB0byByZWRpcmVjdCB0byBhZnRlciBlbWFpbCB2ZXJpZmljYXRpb25cIlxuICAgICAgfSkub3B0aW9uYWwoKVxuICAgIH0pLFxuICAgIHVzZTogW3Nlc3Npb25NaWRkbGV3YXJlXSxcbiAgICBtZXRhZGF0YToge1xuICAgICAgb3BlbmFwaToge1xuICAgICAgICByZXNwb25zZXM6IHtcbiAgICAgICAgICBcIjIwMFwiOiB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJFbWFpbCBjaGFuZ2UgcmVxdWVzdCBwcm9jZXNzZWQgc3VjY2Vzc2Z1bGx5XCIsXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiOiB7XG4gICAgICAgICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImJvb2xlYW5cIixcbiAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJJbmRpY2F0ZXMgaWYgdGhlIHJlcXVlc3Qgd2FzIHN1Y2Nlc3NmdWxcIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICBlbnVtOiBbXCJFbWFpbCB1cGRhdGVkXCIsIFwiVmVyaWZpY2F0aW9uIGVtYWlsIHNlbnRcIl0sXG4gICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiU3RhdHVzIG1lc3NhZ2Ugb2YgdGhlIGVtYWlsIGNoYW5nZSBwcm9jZXNzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgbnVsbGFibGU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBbXCJzdGF0dXNcIl1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGFzeW5jIChjdHgpID0+IHtcbiAgICBpZiAoIWN0eC5jb250ZXh0Lm9wdGlvbnMudXNlcj8uY2hhbmdlRW1haWw/LmVuYWJsZWQpIHtcbiAgICAgIGN0eC5jb250ZXh0LmxvZ2dlci5lcnJvcihcIkNoYW5nZSBlbWFpbCBpcyBkaXNhYmxlZC5cIik7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IFwiQ2hhbmdlIGVtYWlsIGlzIGRpc2FibGVkXCJcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBuZXdFbWFpbCA9IGN0eC5ib2R5Lm5ld0VtYWlsLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKG5ld0VtYWlsID09PSBjdHguY29udGV4dC5zZXNzaW9uLnVzZXIuZW1haWwpIHtcbiAgICAgIGN0eC5jb250ZXh0LmxvZ2dlci5lcnJvcihcIkVtYWlsIGlzIHRoZSBzYW1lXCIpO1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBcIkVtYWlsIGlzIHRoZSBzYW1lXCJcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBleGlzdGluZ1VzZXIgPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZmluZFVzZXJCeUVtYWlsKG5ld0VtYWlsKTtcbiAgICBpZiAoZXhpc3RpbmdVc2VyKSB7XG4gICAgICBjdHguY29udGV4dC5sb2dnZXIuZXJyb3IoXCJFbWFpbCBhbHJlYWR5IGV4aXN0c1wiKTtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogXCJDb3VsZG4ndCB1cGRhdGUgeW91ciBlbWFpbFwiXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGN0eC5jb250ZXh0LnNlc3Npb24udXNlci5lbWFpbFZlcmlmaWVkICE9PSB0cnVlKSB7XG4gICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5maW5kVXNlckJ5RW1haWwobmV3RW1haWwpO1xuICAgICAgaWYgKGV4aXN0aW5nKSB7XG4gICAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIlVOUFJPQ0VTU0FCTEVfRU5USVRZXCIsIHtcbiAgICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLlVTRVJfQUxSRUFEWV9FWElTVFNcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIudXBkYXRlVXNlckJ5RW1haWwoXG4gICAgICAgIGN0eC5jb250ZXh0LnNlc3Npb24udXNlci5lbWFpbCxcbiAgICAgICAge1xuICAgICAgICAgIGVtYWlsOiBuZXdFbWFpbFxuICAgICAgICB9LFxuICAgICAgICBjdHhcbiAgICAgICk7XG4gICAgICBhd2FpdCBzZXRTZXNzaW9uQ29va2llKGN0eCwge1xuICAgICAgICBzZXNzaW9uOiBjdHguY29udGV4dC5zZXNzaW9uLnNlc3Npb24sXG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAuLi5jdHguY29udGV4dC5zZXNzaW9uLnVzZXIsXG4gICAgICAgICAgZW1haWw6IG5ld0VtYWlsXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgaWYgKGN0eC5jb250ZXh0Lm9wdGlvbnMuZW1haWxWZXJpZmljYXRpb24/LnNlbmRWZXJpZmljYXRpb25FbWFpbCkge1xuICAgICAgICBjb25zdCB0b2tlbjIgPSBhd2FpdCBjcmVhdGVFbWFpbFZlcmlmaWNhdGlvblRva2VuKFxuICAgICAgICAgIGN0eC5jb250ZXh0LnNlY3JldCxcbiAgICAgICAgICBuZXdFbWFpbCxcbiAgICAgICAgICB2b2lkIDAsXG4gICAgICAgICAgY3R4LmNvbnRleHQub3B0aW9ucy5lbWFpbFZlcmlmaWNhdGlvbj8uZXhwaXJlc0luXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IHVybDIgPSBgJHtjdHguY29udGV4dC5iYXNlVVJMfS92ZXJpZnktZW1haWw/dG9rZW49JHt0b2tlbjJ9JmNhbGxiYWNrVVJMPSR7Y3R4LmJvZHkuY2FsbGJhY2tVUkwgfHwgXCIvXCJ9YDtcbiAgICAgICAgYXdhaXQgY3R4LmNvbnRleHQub3B0aW9ucy5lbWFpbFZlcmlmaWNhdGlvbi5zZW5kVmVyaWZpY2F0aW9uRW1haWwoXG4gICAgICAgICAge1xuICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAuLi5jdHguY29udGV4dC5zZXNzaW9uLnVzZXIsXG4gICAgICAgICAgICAgIGVtYWlsOiBuZXdFbWFpbFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVybDogdXJsMixcbiAgICAgICAgICAgIHRva2VuOiB0b2tlbjJcbiAgICAgICAgICB9LFxuICAgICAgICAgIGN0eC5yZXF1ZXN0XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gY3R4Lmpzb24oe1xuICAgICAgICBzdGF0dXM6IHRydWVcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoIWN0eC5jb250ZXh0Lm9wdGlvbnMudXNlci5jaGFuZ2VFbWFpbC5zZW5kQ2hhbmdlRW1haWxWZXJpZmljYXRpb24pIHtcbiAgICAgIGN0eC5jb250ZXh0LmxvZ2dlci5lcnJvcihcIlZlcmlmaWNhdGlvbiBlbWFpbCBpc24ndCBlbmFibGVkLlwiKTtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogXCJWZXJpZmljYXRpb24gZW1haWwgaXNuJ3QgZW5hYmxlZFwiXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgdG9rZW4gPSBhd2FpdCBjcmVhdGVFbWFpbFZlcmlmaWNhdGlvblRva2VuKFxuICAgICAgY3R4LmNvbnRleHQuc2VjcmV0LFxuICAgICAgY3R4LmNvbnRleHQuc2Vzc2lvbi51c2VyLmVtYWlsLFxuICAgICAgbmV3RW1haWwsXG4gICAgICBjdHguY29udGV4dC5vcHRpb25zLmVtYWlsVmVyaWZpY2F0aW9uPy5leHBpcmVzSW5cbiAgICApO1xuICAgIGNvbnN0IHVybCA9IGAke2N0eC5jb250ZXh0LmJhc2VVUkx9L3ZlcmlmeS1lbWFpbD90b2tlbj0ke3Rva2VufSZjYWxsYmFja1VSTD0ke2N0eC5ib2R5LmNhbGxiYWNrVVJMIHx8IFwiL1wifWA7XG4gICAgYXdhaXQgY3R4LmNvbnRleHQub3B0aW9ucy51c2VyLmNoYW5nZUVtYWlsLnNlbmRDaGFuZ2VFbWFpbFZlcmlmaWNhdGlvbihcbiAgICAgIHtcbiAgICAgICAgdXNlcjogY3R4LmNvbnRleHQuc2Vzc2lvbi51c2VyLFxuICAgICAgICBuZXdFbWFpbCxcbiAgICAgICAgdXJsLFxuICAgICAgICB0b2tlblxuICAgICAgfSxcbiAgICAgIGN0eC5yZXF1ZXN0XG4gICAgKTtcbiAgICByZXR1cm4gY3R4Lmpzb24oe1xuICAgICAgc3RhdHVzOiB0cnVlXG4gICAgfSk7XG4gIH1cbik7XG5cbmZ1bmN0aW9uIHNhbml0aXplKGlucHV0KSB7XG4gIHJldHVybiBpbnB1dC5yZXBsYWNlKC8mL2csIFwiJmFtcDtcIikucmVwbGFjZSgvPC9nLCBcIiZsdDtcIikucmVwbGFjZSgvPi9nLCBcIiZndDtcIikucmVwbGFjZSgvXCIvZywgXCImcXVvdDtcIikucmVwbGFjZSgvJy9nLCBcIiYjMzk7XCIpO1xufVxuY29uc3QgaHRtbCA9IChlcnJvckNvZGUgPSBcIlVua25vd25cIikgPT4gYDwhRE9DVFlQRSBodG1sPlxuPGh0bWwgbGFuZz1cImVuXCI+XG48aGVhZD5cbiAgICA8bWV0YSBjaGFyc2V0PVwiVVRGLThcIj5cbiAgICA8bWV0YSBuYW1lPVwidmlld3BvcnRcIiBjb250ZW50PVwid2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMFwiPlxuICAgIDx0aXRsZT5BdXRoZW50aWNhdGlvbiBFcnJvcjwvdGl0bGU+XG4gICAgPHN0eWxlPlxuICAgICAgICA6cm9vdCB7XG4gICAgICAgICAgICAtLWJnLWNvbG9yOiAjZjhmOWZhO1xuICAgICAgICAgICAgLS10ZXh0LWNvbG9yOiAjMjEyNTI5O1xuICAgICAgICAgICAgLS1hY2NlbnQtY29sb3I6ICMwMDAwMDA7XG4gICAgICAgICAgICAtLWVycm9yLWNvbG9yOiAjZGMzNTQ1O1xuICAgICAgICAgICAgLS1ib3JkZXItY29sb3I6ICNlOWVjZWY7XG4gICAgICAgIH1cbiAgICAgICAgYm9keSB7XG4gICAgICAgICAgICBmb250LWZhbWlseTogLWFwcGxlLXN5c3RlbSwgQmxpbmtNYWNTeXN0ZW1Gb250LCAnU2Vnb2UgVUknLCBSb2JvdG8sICdIZWx2ZXRpY2EgTmV1ZScsIEFyaWFsLCBzYW5zLXNlcmlmO1xuICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYmctY29sb3IpO1xuICAgICAgICAgICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpO1xuICAgICAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAgICAgICAgIGhlaWdodDogMTAwdmg7XG4gICAgICAgICAgICBtYXJnaW46IDA7XG4gICAgICAgICAgICBsaW5lLWhlaWdodDogMS41O1xuICAgICAgICB9XG4gICAgICAgIC5lcnJvci1jb250YWluZXIge1xuICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZmZmZjtcbiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDEycHg7XG4gICAgICAgICAgICBib3gtc2hhZG93OiAwIDRweCA2cHggcmdiYSgwLCAwLCAwLCAwLjA1KTtcbiAgICAgICAgICAgIHBhZGRpbmc6IDIuNXJlbTtcbiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgICAgICAgICAgIG1heC13aWR0aDogOTAlO1xuICAgICAgICAgICAgd2lkdGg6IDQwMHB4O1xuICAgICAgICB9XG4gICAgICAgIGgxIHtcbiAgICAgICAgICAgIGNvbG9yOiB2YXIoLS1lcnJvci1jb2xvcik7XG4gICAgICAgICAgICBmb250LXNpemU6IDEuNzVyZW07XG4gICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxcmVtO1xuICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDYwMDtcbiAgICAgICAgfVxuICAgICAgICBwIHtcbiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDEuNXJlbTtcbiAgICAgICAgICAgIGNvbG9yOiAjNDk1MDU3O1xuICAgICAgICB9XG4gICAgICAgIC5idG4ge1xuICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYWNjZW50LWNvbG9yKTtcbiAgICAgICAgICAgIGNvbG9yOiAjZmZmZmZmO1xuICAgICAgICAgICAgdGV4dC1kZWNvcmF0aW9uOiBub25lO1xuICAgICAgICAgICAgcGFkZGluZzogMC43NXJlbSAxLjVyZW07XG4gICAgICAgICAgICBib3JkZXItcmFkaXVzOiA2cHg7XG4gICAgICAgICAgICB0cmFuc2l0aW9uOiBhbGwgMC4zcyBlYXNlO1xuICAgICAgICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDUwMDtcbiAgICAgICAgICAgIGJvcmRlcjogMnB4IHNvbGlkIHZhcigtLWFjY2VudC1jb2xvcik7XG4gICAgICAgIH1cbiAgICAgICAgLmJ0bjpob3ZlciB7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMTMxNzIxO1xuICAgICAgICB9XG4gICAgICAgIC5lcnJvci1jb2RlIHtcbiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC44NzVyZW07XG4gICAgICAgICAgICBjb2xvcjogIzZjNzU3ZDtcbiAgICAgICAgICAgIG1hcmdpbi10b3A6IDEuNXJlbTtcbiAgICAgICAgICAgIHBhZGRpbmctdG9wOiAxLjVyZW07XG4gICAgICAgICAgICBib3JkZXItdG9wOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTtcbiAgICAgICAgfVxuICAgICAgICAuaWNvbiB7XG4gICAgICAgICAgICBmb250LXNpemU6IDNyZW07XG4gICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxcmVtO1xuICAgICAgICB9XG4gICAgPC9zdHlsZT5cbjwvaGVhZD5cbjxib2R5PlxuICAgIDxkaXYgY2xhc3M9XCJlcnJvci1jb250YWluZXJcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImljb25cIj5cXHUyNkEwXFx1RkUwRjwvZGl2PlxuICAgICAgICA8aDE+QmV0dGVyIEF1dGggRXJyb3I8L2gxPlxuICAgICAgICA8cD5XZSBlbmNvdW50ZXJlZCBhbiBpc3N1ZSB3aGlsZSBwcm9jZXNzaW5nIHlvdXIgcmVxdWVzdC4gUGxlYXNlIHRyeSBhZ2FpbiBvciBjb250YWN0IHRoZSBhcHBsaWNhdGlvbiBvd25lciBpZiB0aGUgcHJvYmxlbSBwZXJzaXN0cy48L3A+XG4gICAgICAgIDxhIGhyZWY9XCIvXCIgaWQ9XCJyZXR1cm5MaW5rXCIgY2xhc3M9XCJidG5cIj5SZXR1cm4gdG8gQXBwbGljYXRpb248L2E+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJlcnJvci1jb2RlXCI+RXJyb3IgQ29kZTogPHNwYW4gaWQ9XCJlcnJvckNvZGVcIj4ke3Nhbml0aXplKFxuICBlcnJvckNvZGVcbil9PC9zcGFuPjwvZGl2PlxuICAgIDwvZGl2PlxuPC9ib2R5PlxuPC9odG1sPmA7XG5jb25zdCBlcnJvciA9IGNyZWF0ZUF1dGhFbmRwb2ludChcbiAgXCIvZXJyb3JcIixcbiAge1xuICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICBtZXRhZGF0YToge1xuICAgICAgLi4uSElERV9NRVRBREFUQSxcbiAgICAgIG9wZW5hcGk6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiRGlzcGxheXMgYW4gZXJyb3IgcGFnZVwiLFxuICAgICAgICByZXNwb25zZXM6IHtcbiAgICAgICAgICBcIjIwMFwiOiB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJTdWNjZXNzXCIsXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgIFwidGV4dC9odG1sXCI6IHtcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgSFRNTCBjb250ZW50IG9mIHRoZSBlcnJvciBwYWdlXCJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGFzeW5jIChjKSA9PiB7XG4gICAgY29uc3QgcXVlcnkgPSBuZXcgVVJMKGMucmVxdWVzdD8udXJsIHx8IFwiXCIpLnNlYXJjaFBhcmFtcy5nZXQoXCJlcnJvclwiKSB8fCBcIlVua25vd25cIjtcbiAgICByZXR1cm4gbmV3IFJlc3BvbnNlKGh0bWwocXVlcnkpLCB7XG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwidGV4dC9odG1sXCJcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuKTtcblxuY29uc3Qgb2sgPSBjcmVhdGVBdXRoRW5kcG9pbnQoXG4gIFwiL29rXCIsXG4gIHtcbiAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgIC4uLkhJREVfTUVUQURBVEEsXG4gICAgICBvcGVuYXBpOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIkNoZWNrIGlmIHRoZSBBUEkgaXMgd29ya2luZ1wiLFxuICAgICAgICByZXNwb25zZXM6IHtcbiAgICAgICAgICBcIjIwMFwiOiB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJBUEkgaXMgd29ya2luZ1wiLFxuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIjoge1xuICAgICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgb2s6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImJvb2xlYW5cIixcbiAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJJbmRpY2F0ZXMgaWYgdGhlIEFQSSBpcyB3b3JraW5nXCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBbXCJva1wiXVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgYXN5bmMgKGN0eCkgPT4ge1xuICAgIHJldHVybiBjdHguanNvbih7XG4gICAgICBvazogdHJ1ZVxuICAgIH0pO1xuICB9XG4pO1xuXG5jb25zdCBsaXN0VXNlckFjY291bnRzID0gY3JlYXRlQXV0aEVuZHBvaW50KFxuICBcIi9saXN0LWFjY291bnRzXCIsXG4gIHtcbiAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgdXNlOiBbc2Vzc2lvbk1pZGRsZXdhcmVdLFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICBvcGVuYXBpOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIkxpc3QgYWxsIGFjY291bnRzIGxpbmtlZCB0byB0aGUgdXNlclwiLFxuICAgICAgICByZXNwb25zZXM6IHtcbiAgICAgICAgICBcIjIwMFwiOiB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJTdWNjZXNzXCIsXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiOiB7XG4gICAgICAgICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBcImFycmF5XCIsXG4gICAgICAgICAgICAgICAgICBpdGVtczoge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgaWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCJcbiAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGVyOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiXG4gICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFwiZGF0ZS10aW1lXCJcbiAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRBdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogXCJkYXRlLXRpbWVcIlxuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgYWNjb3VudElkOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzY29wZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImFycmF5XCIsXG4gICAgICAgICAgICAgICAgICAgICAgaXRlbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCJcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICByZXF1aXJlZDogW1xuICAgICAgICAgICAgICAgICAgICBcImlkXCIsXG4gICAgICAgICAgICAgICAgICAgIFwicHJvdmlkZXJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJjcmVhdGVkQXRcIixcbiAgICAgICAgICAgICAgICAgICAgXCJ1cGRhdGVkQXRcIixcbiAgICAgICAgICAgICAgICAgICAgXCJhY2NvdW50SWRcIixcbiAgICAgICAgICAgICAgICAgICAgXCJzY29wZXNcIlxuICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgYXN5bmMgKGMpID0+IHtcbiAgICBjb25zdCBzZXNzaW9uID0gYy5jb250ZXh0LnNlc3Npb247XG4gICAgY29uc3QgYWNjb3VudHMgPSBhd2FpdCBjLmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmZpbmRBY2NvdW50cyhcbiAgICAgIHNlc3Npb24udXNlci5pZFxuICAgICk7XG4gICAgcmV0dXJuIGMuanNvbihcbiAgICAgIGFjY291bnRzLm1hcCgoYSkgPT4gKHtcbiAgICAgICAgaWQ6IGEuaWQsXG4gICAgICAgIHByb3ZpZGVyOiBhLnByb3ZpZGVySWQsXG4gICAgICAgIGNyZWF0ZWRBdDogYS5jcmVhdGVkQXQsXG4gICAgICAgIHVwZGF0ZWRBdDogYS51cGRhdGVkQXQsXG4gICAgICAgIGFjY291bnRJZDogYS5hY2NvdW50SWQsXG4gICAgICAgIHNjb3BlczogYS5zY29wZT8uc3BsaXQoXCIsXCIpIHx8IFtdXG4gICAgICB9KSlcbiAgICApO1xuICB9XG4pO1xuY29uc3QgbGlua1NvY2lhbEFjY291bnQgPSBjcmVhdGVBdXRoRW5kcG9pbnQoXG4gIFwiL2xpbmstc29jaWFsXCIsXG4gIHtcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgIHJlcXVpcmVIZWFkZXJzOiB0cnVlLFxuICAgIGJvZHk6IHoub2JqZWN0KHtcbiAgICAgIC8qKlxuICAgICAgICogQ2FsbGJhY2sgVVJMIHRvIHJlZGlyZWN0IHRvIGFmdGVyIHRoZSB1c2VyIGhhcyBzaWduZWQgaW4uXG4gICAgICAgKi9cbiAgICAgIGNhbGxiYWNrVVJMOiB6LnN0cmluZygpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgVVJMIHRvIHJlZGlyZWN0IHRvIGFmdGVyIHRoZSB1c2VyIGhhcyBzaWduZWQgaW5cIlxuICAgICAgfSkub3B0aW9uYWwoKSxcbiAgICAgIC8qKlxuICAgICAgICogT0F1dGgyIHByb3ZpZGVyIHRvIHVzZVxuICAgICAgICovXG4gICAgICBwcm92aWRlcjogU29jaWFsUHJvdmlkZXJMaXN0RW51bSxcbiAgICAgIC8qKlxuICAgICAgICogSUQgVG9rZW4gZm9yIGRpcmVjdCBhdXRoZW50aWNhdGlvbiB3aXRob3V0IHJlZGlyZWN0XG4gICAgICAgKi9cbiAgICAgIGlkVG9rZW46IHoub2JqZWN0KHtcbiAgICAgICAgdG9rZW46IHouc3RyaW5nKCksXG4gICAgICAgIG5vbmNlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICAgIGFjY2Vzc1Rva2VuOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICAgIHJlZnJlc2hUb2tlbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgICAgICBzY29wZXM6IHouYXJyYXkoei5zdHJpbmcoKSkub3B0aW9uYWwoKVxuICAgICAgfSkub3B0aW9uYWwoKSxcbiAgICAgIC8qKlxuICAgICAgICogV2hldGhlciB0byBhbGxvdyBzaWduIHVwIGZvciBuZXcgdXNlcnNcbiAgICAgICAqL1xuICAgICAgcmVxdWVzdFNpZ25VcDogei5ib29sZWFuKCkub3B0aW9uYWwoKSxcbiAgICAgIC8qKlxuICAgICAgICogQWRkaXRpb25hbCBzY29wZXMgdG8gcmVxdWVzdCB3aGVuIGxpbmtpbmcgdGhlIGFjY291bnQuXG4gICAgICAgKiBUaGlzIGlzIHVzZWZ1bCBmb3IgcmVxdWVzdGluZyBhZGRpdGlvbmFsIHBlcm1pc3Npb25zIHdoZW5cbiAgICAgICAqIGxpbmtpbmcgYSBzb2NpYWwgYWNjb3VudCBjb21wYXJlZCB0byB0aGUgaW5pdGlhbCBhdXRoZW50aWNhdGlvbi5cbiAgICAgICAqL1xuICAgICAgc2NvcGVzOiB6LmFycmF5KHouc3RyaW5nKCkpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJBZGRpdGlvbmFsIHNjb3BlcyB0byByZXF1ZXN0IGZyb20gdGhlIHByb3ZpZGVyXCJcbiAgICAgIH0pLm9wdGlvbmFsKCksXG4gICAgICAvKipcbiAgICAgICAqIFRoZSBVUkwgdG8gcmVkaXJlY3QgdG8gaWYgdGhlcmUgaXMgYW4gZXJyb3IgZHVyaW5nIHRoZSBsaW5rIHByb2Nlc3MuXG4gICAgICAgKi9cbiAgICAgIGVycm9yQ2FsbGJhY2tVUkw6IHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBVUkwgdG8gcmVkaXJlY3QgdG8gaWYgdGhlcmUgaXMgYW4gZXJyb3IgZHVyaW5nIHRoZSBsaW5rIHByb2Nlc3NcIlxuICAgICAgfSkub3B0aW9uYWwoKVxuICAgIH0pLFxuICAgIHVzZTogW3Nlc3Npb25NaWRkbGV3YXJlXSxcbiAgICBtZXRhZGF0YToge1xuICAgICAgb3BlbmFwaToge1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJMaW5rIGEgc29jaWFsIGFjY291bnQgdG8gdGhlIHVzZXJcIixcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgXCIyMDBcIjoge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiU3VjY2Vzc1wiLFxuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIjoge1xuICAgICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgYXV0aG9yaXphdGlvbiBVUkwgdG8gcmVkaXJlY3QgdGhlIHVzZXIgdG9cIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICByZWRpcmVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYm9vbGVhblwiLFxuICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkluZGljYXRlcyBpZiB0aGUgdXNlciBzaG91bGQgYmUgcmVkaXJlY3RlZCB0byB0aGUgYXV0aG9yaXphdGlvbiBVUkxcIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImJvb2xlYW5cIlxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFtcInJlZGlyZWN0XCJdXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBhc3luYyAoYykgPT4ge1xuICAgIGNvbnN0IHNlc3Npb24gPSBjLmNvbnRleHQuc2Vzc2lvbjtcbiAgICBjb25zdCBwcm92aWRlciA9IGMuY29udGV4dC5zb2NpYWxQcm92aWRlcnMuZmluZChcbiAgICAgIChwKSA9PiBwLmlkID09PSBjLmJvZHkucHJvdmlkZXJcbiAgICApO1xuICAgIGlmICghcHJvdmlkZXIpIHtcbiAgICAgIGMuY29udGV4dC5sb2dnZXIuZXJyb3IoXG4gICAgICAgIFwiUHJvdmlkZXIgbm90IGZvdW5kLiBNYWtlIHN1cmUgdG8gYWRkIHRoZSBwcm92aWRlciBpbiB5b3VyIGF1dGggY29uZmlnXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlcjogYy5ib2R5LnByb3ZpZGVyXG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJOT1RfRk9VTkRcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLlBST1ZJREVSX05PVF9GT1VORFxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChjLmJvZHkuaWRUb2tlbikge1xuICAgICAgaWYgKCFwcm92aWRlci52ZXJpZnlJZFRva2VuKSB7XG4gICAgICAgIGMuY29udGV4dC5sb2dnZXIuZXJyb3IoXG4gICAgICAgICAgXCJQcm92aWRlciBkb2VzIG5vdCBzdXBwb3J0IGlkIHRva2VuIHZlcmlmaWNhdGlvblwiLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHByb3ZpZGVyOiBjLmJvZHkucHJvdmlkZXJcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIk5PVF9GT1VORFwiLCB7XG4gICAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5JRF9UT0tFTl9OT1RfU1VQUE9SVEVEXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgY29uc3QgeyB0b2tlbiwgbm9uY2UgfSA9IGMuYm9keS5pZFRva2VuO1xuICAgICAgY29uc3QgdmFsaWQgPSBhd2FpdCBwcm92aWRlci52ZXJpZnlJZFRva2VuKHRva2VuLCBub25jZSk7XG4gICAgICBpZiAoIXZhbGlkKSB7XG4gICAgICAgIGMuY29udGV4dC5sb2dnZXIuZXJyb3IoXCJJbnZhbGlkIGlkIHRva2VuXCIsIHtcbiAgICAgICAgICBwcm92aWRlcjogYy5ib2R5LnByb3ZpZGVyXG4gICAgICAgIH0pO1xuICAgICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJVTkFVVEhPUklaRURcIiwge1xuICAgICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuSU5WQUxJRF9UT0tFTlxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGxpbmtpbmdVc2VySW5mbyA9IGF3YWl0IHByb3ZpZGVyLmdldFVzZXJJbmZvKHtcbiAgICAgICAgaWRUb2tlbjogdG9rZW4sXG4gICAgICAgIGFjY2Vzc1Rva2VuOiBjLmJvZHkuaWRUb2tlbi5hY2Nlc3NUb2tlbixcbiAgICAgICAgcmVmcmVzaFRva2VuOiBjLmJvZHkuaWRUb2tlbi5yZWZyZXNoVG9rZW5cbiAgICAgIH0pO1xuICAgICAgaWYgKCFsaW5raW5nVXNlckluZm8gfHwgIWxpbmtpbmdVc2VySW5mbz8udXNlcikge1xuICAgICAgICBjLmNvbnRleHQubG9nZ2VyLmVycm9yKFwiRmFpbGVkIHRvIGdldCB1c2VyIGluZm9cIiwge1xuICAgICAgICAgIHByb3ZpZGVyOiBjLmJvZHkucHJvdmlkZXJcbiAgICAgICAgfSk7XG4gICAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIlVOQVVUSE9SSVpFRFwiLCB7XG4gICAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5GQUlMRURfVE9fR0VUX1VTRVJfSU5GT1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGlmICghbGlua2luZ1VzZXJJbmZvLnVzZXIuZW1haWwpIHtcbiAgICAgICAgYy5jb250ZXh0LmxvZ2dlci5lcnJvcihcIlVzZXIgZW1haWwgbm90IGZvdW5kXCIsIHtcbiAgICAgICAgICBwcm92aWRlcjogYy5ib2R5LnByb3ZpZGVyXG4gICAgICAgIH0pO1xuICAgICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJVTkFVVEhPUklaRURcIiwge1xuICAgICAgICAgIG1lc3NhZ2U6IEJBU0VfRVJST1JfQ09ERVMuVVNFUl9FTUFJTF9OT1RfRk9VTkRcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBjb25zdCBleGlzdGluZ0FjY291bnRzID0gYXdhaXQgYy5jb250ZXh0LmludGVybmFsQWRhcHRlci5maW5kQWNjb3VudHMoXG4gICAgICAgIHNlc3Npb24udXNlci5pZFxuICAgICAgKTtcbiAgICAgIGNvbnN0IGhhc0JlZW5MaW5rZWQgPSBleGlzdGluZ0FjY291bnRzLmZpbmQoXG4gICAgICAgIChhKSA9PiBhLnByb3ZpZGVySWQgPT09IHByb3ZpZGVyLmlkICYmIGEuYWNjb3VudElkID09PSBsaW5raW5nVXNlckluZm8udXNlci5pZFxuICAgICAgKTtcbiAgICAgIGlmIChoYXNCZWVuTGlua2VkKSB7XG4gICAgICAgIHJldHVybiBjLmpzb24oe1xuICAgICAgICAgIHJlZGlyZWN0OiBmYWxzZSxcbiAgICAgICAgICB1cmw6IFwiXCIsXG4gICAgICAgICAgLy8gdGhpcyBpcyBmb3IgdHlwZSBpbmZlcmVuY2VcbiAgICAgICAgICBzdGF0dXM6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBjb25zdCB0cnVzdGVkUHJvdmlkZXJzID0gYy5jb250ZXh0Lm9wdGlvbnMuYWNjb3VudD8uYWNjb3VudExpbmtpbmc/LnRydXN0ZWRQcm92aWRlcnM7XG4gICAgICBjb25zdCBpc1RydXN0ZWRQcm92aWRlciA9IHRydXN0ZWRQcm92aWRlcnM/LmluY2x1ZGVzKHByb3ZpZGVyLmlkKTtcbiAgICAgIGlmICghaXNUcnVzdGVkUHJvdmlkZXIgJiYgIWxpbmtpbmdVc2VySW5mby51c2VyLmVtYWlsVmVyaWZpZWQgfHwgYy5jb250ZXh0Lm9wdGlvbnMuYWNjb3VudD8uYWNjb3VudExpbmtpbmc/LmVuYWJsZWQgPT09IGZhbHNlKSB7XG4gICAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIlVOQVVUSE9SSVpFRFwiLCB7XG4gICAgICAgICAgbWVzc2FnZTogXCJBY2NvdW50IG5vdCBsaW5rZWQgLSBsaW5raW5nIG5vdCBhbGxvd2VkXCJcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAobGlua2luZ1VzZXJJbmZvLnVzZXIuZW1haWwgIT09IHNlc3Npb24udXNlci5lbWFpbCAmJiBjLmNvbnRleHQub3B0aW9ucy5hY2NvdW50Py5hY2NvdW50TGlua2luZz8uYWxsb3dEaWZmZXJlbnRFbWFpbHMgIT09IHRydWUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiVU5BVVRIT1JJWkVEXCIsIHtcbiAgICAgICAgICBtZXNzYWdlOiBcIkFjY291bnQgbm90IGxpbmtlZCAtIGRpZmZlcmVudCBlbWFpbHMgbm90IGFsbG93ZWRcIlxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGMuY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuY3JlYXRlQWNjb3VudChcbiAgICAgICAgICB7XG4gICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgIHByb3ZpZGVySWQ6IHByb3ZpZGVyLmlkLFxuICAgICAgICAgICAgYWNjb3VudElkOiBsaW5raW5nVXNlckluZm8udXNlci5pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgYWNjZXNzVG9rZW46IGMuYm9keS5pZFRva2VuLmFjY2Vzc1Rva2VuLFxuICAgICAgICAgICAgaWRUb2tlbjogdG9rZW4sXG4gICAgICAgICAgICByZWZyZXNoVG9rZW46IGMuYm9keS5pZFRva2VuLnJlZnJlc2hUb2tlbixcbiAgICAgICAgICAgIHNjb3BlOiBjLmJvZHkuaWRUb2tlbi5zY29wZXM/LmpvaW4oXCIsXCIpXG4gICAgICAgICAgfSxcbiAgICAgICAgICBjXG4gICAgICAgICk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkVYUEVDVEFUSU9OX0ZBSUxFRFwiLCB7XG4gICAgICAgICAgbWVzc2FnZTogXCJBY2NvdW50IG5vdCBsaW5rZWQgLSB1bmFibGUgdG8gY3JlYXRlIGFjY291bnRcIlxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGlmIChjLmNvbnRleHQub3B0aW9ucy5hY2NvdW50Py5hY2NvdW50TGlua2luZz8udXBkYXRlVXNlckluZm9PbkxpbmsgPT09IHRydWUpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCBjLmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLnVwZGF0ZVVzZXIoc2Vzc2lvbi51c2VyLmlkLCB7XG4gICAgICAgICAgICBuYW1lOiBsaW5raW5nVXNlckluZm8udXNlcj8ubmFtZSxcbiAgICAgICAgICAgIGltYWdlOiBsaW5raW5nVXNlckluZm8udXNlcj8uaW1hZ2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIGNvbnNvbGUud2FybihcIkNvdWxkIG5vdCB1cGRhdGUgdXNlciAtIFwiICsgZS50b1N0cmluZygpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGMuanNvbih7XG4gICAgICAgIHJlZGlyZWN0OiBmYWxzZSxcbiAgICAgICAgdXJsOiBcIlwiLFxuICAgICAgICAvLyB0aGlzIGlzIGZvciB0eXBlIGluZmVyZW5jZVxuICAgICAgICBzdGF0dXM6IHRydWVcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBzdGF0ZSA9IGF3YWl0IGdlbmVyYXRlU3RhdGUoYywge1xuICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICBlbWFpbDogc2Vzc2lvbi51c2VyLmVtYWlsXG4gICAgfSk7XG4gICAgY29uc3QgdXJsID0gYXdhaXQgcHJvdmlkZXIuY3JlYXRlQXV0aG9yaXphdGlvblVSTCh7XG4gICAgICBzdGF0ZTogc3RhdGUuc3RhdGUsXG4gICAgICBjb2RlVmVyaWZpZXI6IHN0YXRlLmNvZGVWZXJpZmllcixcbiAgICAgIHJlZGlyZWN0VVJJOiBgJHtjLmNvbnRleHQuYmFzZVVSTH0vY2FsbGJhY2svJHtwcm92aWRlci5pZH1gLFxuICAgICAgc2NvcGVzOiBjLmJvZHkuc2NvcGVzXG4gICAgfSk7XG4gICAgcmV0dXJuIGMuanNvbih7XG4gICAgICB1cmw6IHVybC50b1N0cmluZygpLFxuICAgICAgcmVkaXJlY3Q6IHRydWVcbiAgICB9KTtcbiAgfVxuKTtcbmNvbnN0IHVubGlua0FjY291bnQgPSBjcmVhdGVBdXRoRW5kcG9pbnQoXG4gIFwiL3VubGluay1hY2NvdW50XCIsXG4gIHtcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgIGJvZHk6IHoub2JqZWN0KHtcbiAgICAgIHByb3ZpZGVySWQ6IHouc3RyaW5nKCksXG4gICAgICBhY2NvdW50SWQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKVxuICAgIH0pLFxuICAgIHVzZTogW2ZyZXNoU2Vzc2lvbk1pZGRsZXdhcmVdLFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICBvcGVuYXBpOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlVubGluayBhbiBhY2NvdW50XCIsXG4gICAgICAgIHJlc3BvbnNlczoge1xuICAgICAgICAgIFwiMjAwXCI6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlN1Y2Nlc3NcIixcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbi9qc29uXCI6IHtcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYm9vbGVhblwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGFzeW5jIChjdHgpID0+IHtcbiAgICBjb25zdCB7IHByb3ZpZGVySWQsIGFjY291bnRJZCB9ID0gY3R4LmJvZHk7XG4gICAgY29uc3QgYWNjb3VudHMgPSBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIuZmluZEFjY291bnRzKFxuICAgICAgY3R4LmNvbnRleHQuc2Vzc2lvbi51c2VyLmlkXG4gICAgKTtcbiAgICBpZiAoYWNjb3VudHMubGVuZ3RoID09PSAxICYmICFjdHguY29udGV4dC5vcHRpb25zLmFjY291bnQ/LmFjY291bnRMaW5raW5nPy5hbGxvd1VubGlua2luZ0FsbCkge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBCQVNFX0VSUk9SX0NPREVTLkZBSUxFRF9UT19VTkxJTktfTEFTVF9BQ0NPVU5UXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgYWNjb3VudEV4aXN0ID0gYWNjb3VudHMuZmluZChcbiAgICAgIChhY2NvdW50KSA9PiBhY2NvdW50SWQgPyBhY2NvdW50LmFjY291bnRJZCA9PT0gYWNjb3VudElkICYmIGFjY291bnQucHJvdmlkZXJJZCA9PT0gcHJvdmlkZXJJZCA6IGFjY291bnQucHJvdmlkZXJJZCA9PT0gcHJvdmlkZXJJZFxuICAgICk7XG4gICAgaWYgKCFhY2NvdW50RXhpc3QpIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogQkFTRV9FUlJPUl9DT0RFUy5BQ0NPVU5UX05PVF9GT1VORFxuICAgICAgfSk7XG4gICAgfVxuICAgIGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5kZWxldGVBY2NvdW50KGFjY291bnRFeGlzdC5pZCk7XG4gICAgcmV0dXJuIGN0eC5qc29uKHtcbiAgICAgIHN0YXR1czogdHJ1ZVxuICAgIH0pO1xuICB9XG4pO1xuY29uc3QgZ2V0QWNjZXNzVG9rZW4gPSBjcmVhdGVBdXRoRW5kcG9pbnQoXG4gIFwiL2dldC1hY2Nlc3MtdG9rZW5cIixcbiAge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgYm9keTogei5vYmplY3Qoe1xuICAgICAgcHJvdmlkZXJJZDogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIHByb3ZpZGVyIElEIGZvciB0aGUgT0F1dGggcHJvdmlkZXJcIlxuICAgICAgfSksXG4gICAgICBhY2NvdW50SWQ6IHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBhY2NvdW50IElEIGFzc29jaWF0ZWQgd2l0aCB0aGUgcmVmcmVzaCB0b2tlblwiXG4gICAgICB9KS5vcHRpb25hbCgpLFxuICAgICAgdXNlcklkOiB6LnN0cmluZygpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgdXNlciBJRCBhc3NvY2lhdGVkIHdpdGggdGhlIGFjY291bnRcIlxuICAgICAgfSkub3B0aW9uYWwoKVxuICAgIH0pLFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICBvcGVuYXBpOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIkdldCBhIHZhbGlkIGFjY2VzcyB0b2tlbiwgZG9pbmcgYSByZWZyZXNoIGlmIG5lZWRlZFwiLFxuICAgICAgICByZXNwb25zZXM6IHtcbiAgICAgICAgICAyMDA6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkEgVmFsaWQgYWNjZXNzIHRva2VuXCIsXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiOiB7XG4gICAgICAgICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICB0b2tlblR5cGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGlkVG9rZW46IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICByZWZyZXNoVG9rZW46IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuRXhwaXJlc0F0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFwiZGF0ZS10aW1lXCJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgcmVmcmVzaFRva2VuRXhwaXJlc0F0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFwiZGF0ZS10aW1lXCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgNDAwOiB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJJbnZhbGlkIHJlZnJlc2ggdG9rZW4gb3IgcHJvdmlkZXIgY29uZmlndXJhdGlvblwiXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBhc3luYyAoY3R4KSA9PiB7XG4gICAgY29uc3QgeyBwcm92aWRlcklkLCBhY2NvdW50SWQsIHVzZXJJZCB9ID0gY3R4LmJvZHk7XG4gICAgY29uc3QgcmVxID0gY3R4LnJlcXVlc3Q7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGdldFNlc3Npb25Gcm9tQ3R4KGN0eCk7XG4gICAgaWYgKHJlcSAmJiAhc2Vzc2lvbikge1xuICAgICAgdGhyb3cgY3R4LmVycm9yKFwiVU5BVVRIT1JJWkVEXCIpO1xuICAgIH1cbiAgICBsZXQgcmVzb2x2ZWRVc2VySWQgPSBzZXNzaW9uPy51c2VyPy5pZCB8fCB1c2VySWQ7XG4gICAgaWYgKCFyZXNvbHZlZFVzZXJJZCkge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBgRWl0aGVyIHVzZXJJZCBvciBzZXNzaW9uIGlzIHJlcXVpcmVkYFxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmICghY3R4LmNvbnRleHQuc29jaWFsUHJvdmlkZXJzLmZpbmQoKHApID0+IHAuaWQgPT09IHByb3ZpZGVySWQpKSB7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IGBQcm92aWRlciAke3Byb3ZpZGVySWR9IGlzIG5vdCBzdXBwb3J0ZWQuYFxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IGFjY291bnRzID0gYXdhaXQgY3R4LmNvbnRleHQuaW50ZXJuYWxBZGFwdGVyLmZpbmRBY2NvdW50cyhyZXNvbHZlZFVzZXJJZCk7XG4gICAgY29uc3QgYWNjb3VudCA9IGFjY291bnRzLmZpbmQoXG4gICAgICAoYWNjKSA9PiBhY2NvdW50SWQgPyBhY2MuaWQgPT09IGFjY291bnRJZCAmJiBhY2MucHJvdmlkZXJJZCA9PT0gcHJvdmlkZXJJZCA6IGFjYy5wcm92aWRlcklkID09PSBwcm92aWRlcklkXG4gICAgKTtcbiAgICBpZiAoIWFjY291bnQpIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogXCJBY2NvdW50IG5vdCBmb3VuZFwiXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgcHJvdmlkZXIgPSBjdHguY29udGV4dC5zb2NpYWxQcm92aWRlcnMuZmluZChcbiAgICAgIChwKSA9PiBwLmlkID09PSBwcm92aWRlcklkXG4gICAgKTtcbiAgICBpZiAoIXByb3ZpZGVyKSB7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IGBQcm92aWRlciAke3Byb3ZpZGVySWR9IG5vdCBmb3VuZC5gXG4gICAgICB9KTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGxldCBuZXdUb2tlbnMgPSBudWxsO1xuICAgICAgY29uc3QgYWNjZXNzVG9rZW5FeHBpcmVkID0gYWNjb3VudC5hY2Nlc3NUb2tlbkV4cGlyZXNBdCAmJiBuZXcgRGF0ZShhY2NvdW50LmFjY2Vzc1Rva2VuRXhwaXJlc0F0KS5nZXRUaW1lKCkgLSBEYXRlLm5vdygpIDwgNWUzO1xuICAgICAgaWYgKGFjY291bnQucmVmcmVzaFRva2VuICYmIGFjY2Vzc1Rva2VuRXhwaXJlZCAmJiBwcm92aWRlci5yZWZyZXNoQWNjZXNzVG9rZW4pIHtcbiAgICAgICAgbmV3VG9rZW5zID0gYXdhaXQgcHJvdmlkZXIucmVmcmVzaEFjY2Vzc1Rva2VuKFxuICAgICAgICAgIGFjY291bnQucmVmcmVzaFRva2VuXG4gICAgICAgICk7XG4gICAgICAgIGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci51cGRhdGVBY2NvdW50KGFjY291bnQuaWQsIHtcbiAgICAgICAgICBhY2Nlc3NUb2tlbjogYXdhaXQgc2V0VG9rZW5VdGlsKG5ld1Rva2Vucy5hY2Nlc3NUb2tlbiwgY3R4LmNvbnRleHQpLFxuICAgICAgICAgIGFjY2Vzc1Rva2VuRXhwaXJlc0F0OiBuZXdUb2tlbnMuYWNjZXNzVG9rZW5FeHBpcmVzQXQsXG4gICAgICAgICAgcmVmcmVzaFRva2VuOiBhd2FpdCBzZXRUb2tlblV0aWwobmV3VG9rZW5zLnJlZnJlc2hUb2tlbiwgY3R4LmNvbnRleHQpLFxuICAgICAgICAgIHJlZnJlc2hUb2tlbkV4cGlyZXNBdDogbmV3VG9rZW5zLnJlZnJlc2hUb2tlbkV4cGlyZXNBdFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHRva2VucyA9IHtcbiAgICAgICAgYWNjZXNzVG9rZW46IGF3YWl0IGRlY3J5cHRPQXV0aFRva2VuKFxuICAgICAgICAgIG5ld1Rva2Vucz8uYWNjZXNzVG9rZW4gPz8gYWNjb3VudC5hY2Nlc3NUb2tlbiA/PyBcIlwiLFxuICAgICAgICAgIGN0eC5jb250ZXh0XG4gICAgICAgICksXG4gICAgICAgIGFjY2Vzc1Rva2VuRXhwaXJlc0F0OiBuZXdUb2tlbnM/LmFjY2Vzc1Rva2VuRXhwaXJlc0F0ID8/IGFjY291bnQuYWNjZXNzVG9rZW5FeHBpcmVzQXQgPz8gdm9pZCAwLFxuICAgICAgICBzY29wZXM6IGFjY291bnQuc2NvcGU/LnNwbGl0KFwiLFwiKSA/PyBbXSxcbiAgICAgICAgaWRUb2tlbjogbmV3VG9rZW5zPy5pZFRva2VuID8/IGFjY291bnQuaWRUb2tlbiA/PyB2b2lkIDBcbiAgICAgIH07XG4gICAgICByZXR1cm4gY3R4Lmpzb24odG9rZW5zKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBcIkZhaWxlZCB0byBnZXQgYSB2YWxpZCBhY2Nlc3MgdG9rZW5cIixcbiAgICAgICAgY2F1c2U6IGVycm9yXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbik7XG5jb25zdCByZWZyZXNoVG9rZW4gPSBjcmVhdGVBdXRoRW5kcG9pbnQoXG4gIFwiL3JlZnJlc2gtdG9rZW5cIixcbiAge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgYm9keTogei5vYmplY3Qoe1xuICAgICAgcHJvdmlkZXJJZDogei5zdHJpbmcoKS5tZXRhKHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIHByb3ZpZGVyIElEIGZvciB0aGUgT0F1dGggcHJvdmlkZXJcIlxuICAgICAgfSksXG4gICAgICBhY2NvdW50SWQ6IHouc3RyaW5nKCkubWV0YSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBhY2NvdW50IElEIGFzc29jaWF0ZWQgd2l0aCB0aGUgcmVmcmVzaCB0b2tlblwiXG4gICAgICB9KS5vcHRpb25hbCgpLFxuICAgICAgdXNlcklkOiB6LnN0cmluZygpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgdXNlciBJRCBhc3NvY2lhdGVkIHdpdGggdGhlIGFjY291bnRcIlxuICAgICAgfSkub3B0aW9uYWwoKVxuICAgIH0pLFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICBvcGVuYXBpOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlJlZnJlc2ggdGhlIGFjY2VzcyB0b2tlbiB1c2luZyBhIHJlZnJlc2ggdG9rZW5cIixcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgMjAwOiB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJBY2Nlc3MgdG9rZW4gcmVmcmVzaGVkIHN1Y2Nlc3NmdWxseVwiLFxuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIjoge1xuICAgICAgICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgdG9rZW5UeXBlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBpZFRva2VuOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbjoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgcmVmcmVzaFRva2VuOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbkV4cGlyZXNBdDoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBcImRhdGUtdGltZVwiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHJlZnJlc2hUb2tlbkV4cGlyZXNBdDoge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBcImRhdGUtdGltZVwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIDQwMDoge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiSW52YWxpZCByZWZyZXNoIHRva2VuIG9yIHByb3ZpZGVyIGNvbmZpZ3VyYXRpb25cIlxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgYXN5bmMgKGN0eCkgPT4ge1xuICAgIGNvbnN0IHsgcHJvdmlkZXJJZCwgYWNjb3VudElkLCB1c2VySWQgfSA9IGN0eC5ib2R5O1xuICAgIGNvbnN0IHJlcSA9IGN0eC5yZXF1ZXN0O1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBnZXRTZXNzaW9uRnJvbUN0eChjdHgpO1xuICAgIGlmIChyZXEgJiYgIXNlc3Npb24pIHtcbiAgICAgIHRocm93IGN0eC5lcnJvcihcIlVOQVVUSE9SSVpFRFwiKTtcbiAgICB9XG4gICAgbGV0IHJlc29sdmVkVXNlcklkID0gc2Vzc2lvbj8udXNlcj8uaWQgfHwgdXNlcklkO1xuICAgIGlmICghcmVzb2x2ZWRVc2VySWQpIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogYEVpdGhlciB1c2VySWQgb3Igc2Vzc2lvbiBpcyByZXF1aXJlZGBcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBhY2NvdW50cyA9IGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5maW5kQWNjb3VudHMocmVzb2x2ZWRVc2VySWQpO1xuICAgIGNvbnN0IGFjY291bnQgPSBhY2NvdW50cy5maW5kKFxuICAgICAgKGFjYykgPT4gYWNjb3VudElkID8gYWNjLmlkID09PSBhY2NvdW50SWQgJiYgYWNjLnByb3ZpZGVySWQgPT09IHByb3ZpZGVySWQgOiBhY2MucHJvdmlkZXJJZCA9PT0gcHJvdmlkZXJJZFxuICAgICk7XG4gICAgaWYgKCFhY2NvdW50KSB7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IFwiQWNjb3VudCBub3QgZm91bmRcIlxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IHByb3ZpZGVyID0gY3R4LmNvbnRleHQuc29jaWFsUHJvdmlkZXJzLmZpbmQoXG4gICAgICAocCkgPT4gcC5pZCA9PT0gcHJvdmlkZXJJZFxuICAgICk7XG4gICAgaWYgKCFwcm92aWRlcikge1xuICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQkFEX1JFUVVFU1RcIiwge1xuICAgICAgICBtZXNzYWdlOiBgUHJvdmlkZXIgJHtwcm92aWRlcklkfSBub3QgZm91bmQuYFxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmICghcHJvdmlkZXIucmVmcmVzaEFjY2Vzc1Rva2VuKSB7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IGBQcm92aWRlciAke3Byb3ZpZGVySWR9IGRvZXMgbm90IHN1cHBvcnQgdG9rZW4gcmVmcmVzaGluZy5gXG4gICAgICB9KTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHRva2VucyA9IGF3YWl0IHByb3ZpZGVyLnJlZnJlc2hBY2Nlc3NUb2tlbihcbiAgICAgICAgYWNjb3VudC5yZWZyZXNoVG9rZW5cbiAgICAgICk7XG4gICAgICBhd2FpdCBjdHguY29udGV4dC5pbnRlcm5hbEFkYXB0ZXIudXBkYXRlQWNjb3VudChhY2NvdW50LmlkLCB7XG4gICAgICAgIGFjY2Vzc1Rva2VuOiBhd2FpdCBzZXRUb2tlblV0aWwodG9rZW5zLmFjY2Vzc1Rva2VuLCBjdHguY29udGV4dCksXG4gICAgICAgIHJlZnJlc2hUb2tlbjogYXdhaXQgc2V0VG9rZW5VdGlsKHRva2Vucy5yZWZyZXNoVG9rZW4sIGN0eC5jb250ZXh0KSxcbiAgICAgICAgYWNjZXNzVG9rZW5FeHBpcmVzQXQ6IHRva2Vucy5hY2Nlc3NUb2tlbkV4cGlyZXNBdCxcbiAgICAgICAgcmVmcmVzaFRva2VuRXhwaXJlc0F0OiB0b2tlbnMucmVmcmVzaFRva2VuRXhwaXJlc0F0XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBjdHguanNvbih0b2tlbnMpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgQVBJRXJyb3IoXCJCQURfUkVRVUVTVFwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIHJlZnJlc2ggYWNjZXNzIHRva2VuXCIsXG4gICAgICAgIGNhdXNlOiBlcnJvclxuICAgICAgfSk7XG4gICAgfVxuICB9XG4pO1xuY29uc3QgYWNjb3VudEluZm8gPSBjcmVhdGVBdXRoRW5kcG9pbnQoXG4gIFwiL2FjY291bnQtaW5mb1wiLFxuICB7XG4gICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICB1c2U6IFtzZXNzaW9uTWlkZGxld2FyZV0sXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgIG9wZW5hcGk6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiR2V0IHRoZSBhY2NvdW50IGluZm8gcHJvdmlkZWQgYnkgdGhlIHByb3ZpZGVyXCIsXG4gICAgICAgIHJlc3BvbnNlczoge1xuICAgICAgICAgIFwiMjAwXCI6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlN1Y2Nlc3NcIixcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbi9qc29uXCI6IHtcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJib29sZWFuXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBbXCJpZFwiLCBcImVtYWlsVmVyaWZpZWRcIl1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge30sXG4gICAgICAgICAgICAgICAgICAgICAgYWRkaXRpb25hbFByb3BlcnRpZXM6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBbXCJ1c2VyXCIsIFwiZGF0YVwiXSxcbiAgICAgICAgICAgICAgICAgIGFkZGl0aW9uYWxQcm9wZXJ0aWVzOiBmYWxzZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgYm9keTogei5vYmplY3Qoe1xuICAgICAgYWNjb3VudElkOiB6LnN0cmluZygpLm1ldGEoe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJUaGUgcHJvdmlkZXIgZ2l2ZW4gYWNjb3VudCBpZCBmb3Igd2hpY2ggdG8gZ2V0IHRoZSBhY2NvdW50IGluZm9cIlxuICAgICAgfSlcbiAgICB9KVxuICB9LFxuICBhc3luYyAoY3R4KSA9PiB7XG4gICAgY29uc3QgYWNjb3VudCA9IGF3YWl0IGN0eC5jb250ZXh0LmludGVybmFsQWRhcHRlci5maW5kQWNjb3VudChcbiAgICAgIGN0eC5ib2R5LmFjY291bnRJZFxuICAgICk7XG4gICAgaWYgKCFhY2NvdW50IHx8IGFjY291bnQudXNlcklkICE9PSBjdHguY29udGV4dC5zZXNzaW9uLnVzZXIuaWQpIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogXCJBY2NvdW50IG5vdCBmb3VuZFwiXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgcHJvdmlkZXIgPSBjdHguY29udGV4dC5zb2NpYWxQcm92aWRlcnMuZmluZChcbiAgICAgIChwKSA9PiBwLmlkID09PSBhY2NvdW50LnByb3ZpZGVySWRcbiAgICApO1xuICAgIGlmICghcHJvdmlkZXIpIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIklOVEVSTkFMX1NFUlZFUl9FUlJPUlwiLCB7XG4gICAgICAgIG1lc3NhZ2U6IGBQcm92aWRlciBhY2NvdW50IHByb3ZpZGVyIGlzICR7YWNjb3VudC5wcm92aWRlcklkfSBidXQgaXQgaXMgbm90IGNvbmZpZ3VyZWRgXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgdG9rZW5zID0gYXdhaXQgZ2V0QWNjZXNzVG9rZW4oe1xuICAgICAgLi4uY3R4LFxuICAgICAgYm9keToge1xuICAgICAgICBhY2NvdW50SWQ6IGFjY291bnQuaWQsXG4gICAgICAgIHByb3ZpZGVySWQ6IGFjY291bnQucHJvdmlkZXJJZFxuICAgICAgfSxcbiAgICAgIHJldHVybkhlYWRlcnM6IGZhbHNlXG4gICAgfSk7XG4gICAgaWYgKCF0b2tlbnMuYWNjZXNzVG9rZW4pIHtcbiAgICAgIHRocm93IG5ldyBBUElFcnJvcihcIkJBRF9SRVFVRVNUXCIsIHtcbiAgICAgICAgbWVzc2FnZTogXCJBY2Nlc3MgdG9rZW4gbm90IGZvdW5kXCJcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBpbmZvID0gYXdhaXQgcHJvdmlkZXIuZ2V0VXNlckluZm8oe1xuICAgICAgLi4udG9rZW5zLFxuICAgICAgYWNjZXNzVG9rZW46IHRva2Vucy5hY2Nlc3NUb2tlblxuICAgIH0pO1xuICAgIHJldHVybiBjdHguanNvbihpbmZvKTtcbiAgfVxuKTtcblxuZXhwb3J0IHsgc2lnbk91dCBhcyAkLCBvcmlnaW5DaGVja01pZGRsZXdhcmUgYXMgQSwgQkFTRV9FUlJPUl9DT0RFUyBhcyBCLCBlcnJvciBhcyBDLCBvayBhcyBELCBhY2NvdW50SW5mbyBhcyBFLCBnZXRBY2Nlc3NUb2tlbiBhcyBGLCByZWZyZXNoVG9rZW4gYXMgRywgSElERV9NRVRBREFUQSBhcyBILCB1bmxpbmtBY2NvdW50IGFzIEksIGRlbGV0ZVVzZXJDYWxsYmFjayBhcyBKLCBsaXN0VXNlckFjY291bnRzIGFzIEssIGxpbmtTb2NpYWxBY2NvdW50IGFzIEwsIHJldm9rZU90aGVyU2Vzc2lvbnMgYXMgTSwgcmV2b2tlU2Vzc2lvbnMgYXMgTiwgcmV2b2tlU2Vzc2lvbiBhcyBPLCByZXF1ZXN0UGFzc3dvcmRSZXNldENhbGxiYWNrIGFzIFAsIHJlcXVlc3RQYXNzd29yZFJlc2V0IGFzIFEsIGZvcmdldFBhc3N3b3JkQ2FsbGJhY2sgYXMgUiwgZGVsZXRlVXNlciBhcyBTLCBzZXRQYXNzd29yZCBhcyBULCBjaGFuZ2VQYXNzd29yZCBhcyBVLCBjaGFuZ2VFbWFpbCBhcyBWLCBzZW5kVmVyaWZpY2F0aW9uRW1haWwgYXMgVywgdmVyaWZ5RW1haWwgYXMgWCwgcmVzZXRQYXNzd29yZCBhcyBZLCBmb3JnZXRQYXNzd29yZCBhcyBaLCBzaWduSW5FbWFpbCBhcyBfLCB2YWxpZGF0ZVRva2VuIGFzIGEsIGNhbGxiYWNrT0F1dGggYXMgYTAsIHNpZ25JblNvY2lhbCBhcyBhMSwgcmVxdWVzdE9ubHlTZXNzaW9uTWlkZGxld2FyZSBhcyBhMiwgc29jaWFsUHJvdmlkZXJMaXN0IGFzIGEzLCBTb2NpYWxQcm92aWRlckxpc3RFbnVtIGFzIGE0LCBhcHBsZSBhcyBhNSwgZ2V0QXBwbGVQdWJsaWNLZXkgYXMgYTYsIGRpc2NvcmQgYXMgYTcsIGRyb3Bib3ggYXMgYTgsIGZhY2Vib29rIGFzIGE5LCBnaXRodWIgYXMgYWEsIGxpbmVhciBhcyBhYiwgbGlua2VkaW4gYXMgYWMsIGdpdGxhYiBhcyBhZCwgZ29vZ2xlIGFzIGFlLCBraWNrIGFzIGFmLCBtaWNyb3NvZnQgYXMgYWcsIG5vdGlvbiBhcyBhaCwgcmVkZGl0IGFzIGFpLCByb2Jsb3ggYXMgYWosIHNwb3RpZnkgYXMgYWssIHRpa3RvayBhcyBhbCwgdHdpdGNoIGFzIGFtLCB0d2l0dGVyIGFzIGFuLCBMQU5HIGFzIGFvLCB2ayBhcyBhcCwgem9vbSBhcyBhcSwgaHVnZ2luZ2ZhY2UgYXMgYXIsIHNsYWNrIGFzIGFzLCBnZW5lcmF0ZUNvZGVDaGFsbGVuZ2UgYXMgYiwgY3JlYXRlQXV0aG9yaXphdGlvblVSTCBhcyBjLCBnZXRPQXV0aDJUb2tlbnMgYXMgZCwgZW5jb2RlT0F1dGhQYXJhbWV0ZXIgYXMgZSwgZGVjcnlwdE9BdXRoVG9rZW4gYXMgZiwgZ2VuZXJhdGVTdGF0ZSBhcyBnLCBoYW5kbGVPQXV0aFVzZXJJbmZvIGFzIGgsIGNyZWF0ZUF1dGhNaWRkbGV3YXJlIGFzIGksIGNyZWF0ZUF1dGhFbmRwb2ludCBhcyBqLCBnZXRTZXNzaW9uRnJvbUN0eCBhcyBrLCBzZXNzaW9uTWlkZGxld2FyZSBhcyBsLCBnZXRTZXNzaW9uIGFzIG0sIGZyZXNoU2Vzc2lvbk1pZGRsZXdhcmUgYXMgbiwgb3JpZ2luQ2hlY2sgYXMgbywgcGFyc2VTdGF0ZSBhcyBwLCBvcHRpb25zTWlkZGxld2FyZSBhcyBxLCByZWZyZXNoQWNjZXNzVG9rZW4gYXMgciwgc2V0VG9rZW5VdGlsIGFzIHMsIHNvY2lhbFByb3ZpZGVycyBhcyB0LCBzZW5kVmVyaWZpY2F0aW9uRW1haWxGbiBhcyB1LCB2YWxpZGF0ZUF1dGhvcml6YXRpb25Db2RlIGFzIHYsIGNyZWF0ZUVtYWlsVmVyaWZpY2F0aW9uVG9rZW4gYXMgdywgd2lsZGNhcmRNYXRjaCBhcyB4LCBsaXN0U2Vzc2lvbnMgYXMgeSwgdXBkYXRlVXNlciBhcyB6IH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/better-auth/dist/shared/better-auth.z3dsxLxE.mjs\n");

/***/ }),

/***/ "(ssr)/../../node_modules/better-auth/dist/client/react/index.mjs":
/*!******************************************************************!*\
  !*** ../../node_modules/better-auth/dist/client/react/index.mjs ***!
  \******************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   capitalizeFirstLetter: () => (/* binding */ capitalizeFirstLetter),\n/* harmony export */   createAuthClient: () => (/* binding */ createAuthClient),\n/* harmony export */   useStore: () => (/* binding */ useStore)\n/* harmony export */ });\n/* harmony import */ var _shared_better_auth_A_Crzln_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../shared/better-auth.A_Crzln-.mjs */ \"(ssr)/../../node_modules/better-auth/dist/shared/better-auth.A_Crzln-.mjs\");\n/* harmony import */ var nanostores__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! nanostores */ \"(ssr)/../../node_modules/nanostores/listen-keys/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react */ \"(ssr)/../../node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _better_fetch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @better-fetch/fetch */ \"(ssr)/../../node_modules/@better-fetch/fetch/dist/index.js\");\n/* harmony import */ var _shared_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../shared/better-auth.VTXNLFMT.mjs */ \"(ssr)/../../node_modules/better-auth/dist/shared/better-auth.VTXNLFMT.mjs\");\n/* harmony import */ var _shared_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../shared/better-auth.8zoxzg-F.mjs */ \"(ssr)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs\");\n/* harmony import */ var _shared_better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../shared/better-auth.DdzSJf-n.mjs */ \"(ssr)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs\");\n/* harmony import */ var _shared_better_auth_Buni1mmI_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../shared/better-auth.Buni1mmI.mjs */ \"(ssr)/../../node_modules/better-auth/dist/shared/better-auth.Buni1mmI.mjs\");\n/* harmony import */ var _shared_better_auth_ffWeg50w_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../shared/better-auth.ffWeg50w.mjs */ \"(ssr)/../../node_modules/better-auth/dist/shared/better-auth.ffWeg50w.mjs\");\n\n\n\n\n\n\n\n\n\n\nfunction useStore(store, options = {}) {\n  let snapshotRef = (0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(store.get());\n  const { keys, deps = [store, keys] } = options;\n  let subscribe = (0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)((onChange) => {\n    const emitChange = (value) => {\n      if (snapshotRef.current === value) return;\n      snapshotRef.current = value;\n      onChange();\n    };\n    emitChange(store.value);\n    if (keys?.length) {\n      return (0,nanostores__WEBPACK_IMPORTED_MODULE_8__.listenKeys)(store, keys, emitChange);\n    }\n    return store.listen(emitChange);\n  }, deps);\n  let get = () => snapshotRef.current;\n  return (0,react__WEBPACK_IMPORTED_MODULE_1__.useSyncExternalStore)(subscribe, get, get);\n}\n\nfunction getAtomKey(str) {\n  return `use${capitalizeFirstLetter(str)}`;\n}\nfunction capitalizeFirstLetter(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\nfunction createAuthClient(options) {\n  const {\n    pluginPathMethods,\n    pluginsActions,\n    pluginsAtoms,\n    $fetch,\n    $store,\n    atomListeners\n  } = (0,_shared_better_auth_A_Crzln_mjs__WEBPACK_IMPORTED_MODULE_0__.g)(options);\n  let resolvedHooks = {};\n  for (const [key, value] of Object.entries(pluginsAtoms)) {\n    resolvedHooks[getAtomKey(key)] = () => useStore(value);\n  }\n  const routes = {\n    ...pluginsActions,\n    ...resolvedHooks,\n    $fetch,\n    $store\n  };\n  const proxy = (0,_shared_better_auth_A_Crzln_mjs__WEBPACK_IMPORTED_MODULE_0__.c)(\n    routes,\n    $fetch,\n    pluginPathMethods,\n    pluginsAtoms,\n    atomListeners\n  );\n  return proxy;\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3QvY2xpZW50L3JlYWN0L2luZGV4Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBMEc7QUFDbEU7QUFDMEI7QUFDckM7QUFDa0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFL0MscUNBQXFDO0FBQ3JDLG9CQUFvQiw2Q0FBTTtBQUMxQixVQUFVLDZCQUE2QjtBQUN2QyxrQkFBa0Isa0RBQVc7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLHNEQUFVO0FBQ3ZCO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSxTQUFTLDJEQUFvQjtBQUM3Qjs7QUFFQTtBQUNBLGVBQWUsMkJBQTJCO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksRUFBRSxrRUFBZTtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixrRUFBc0I7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFNkQiLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWxhbi9EZXNrdG9wL0FwcHMvYmV0dGVyLWF1dGgvbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3QvY2xpZW50L3JlYWN0L2luZGV4Lm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnIGFzIGdldENsaWVudENvbmZpZywgYyBhcyBjcmVhdGVEeW5hbWljUGF0aFByb3h5IH0gZnJvbSAnLi4vLi4vc2hhcmVkL2JldHRlci1hdXRoLkFfQ3J6bG4tLm1qcyc7XG5pbXBvcnQgeyBsaXN0ZW5LZXlzIH0gZnJvbSAnbmFub3N0b3Jlcyc7XG5pbXBvcnQgeyB1c2VSZWYsIHVzZUNhbGxiYWNrLCB1c2VTeW5jRXh0ZXJuYWxTdG9yZSB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCAnQGJldHRlci1mZXRjaC9mZXRjaCc7XG5pbXBvcnQgJy4uLy4uL3NoYXJlZC9iZXR0ZXItYXV0aC5WVFhOTEZNVC5tanMnO1xuaW1wb3J0ICcuLi8uLi9zaGFyZWQvYmV0dGVyLWF1dGguOHpveHpnLUYubWpzJztcbmltcG9ydCAnLi4vLi4vc2hhcmVkL2JldHRlci1hdXRoLkRkelNKZi1uLm1qcyc7XG5pbXBvcnQgJy4uLy4uL3NoYXJlZC9iZXR0ZXItYXV0aC5CdW5pMW1tSS5tanMnO1xuaW1wb3J0ICcuLi8uLi9zaGFyZWQvYmV0dGVyLWF1dGguZmZXZWc1MHcubWpzJztcblxuZnVuY3Rpb24gdXNlU3RvcmUoc3RvcmUsIG9wdGlvbnMgPSB7fSkge1xuICBsZXQgc25hcHNob3RSZWYgPSB1c2VSZWYoc3RvcmUuZ2V0KCkpO1xuICBjb25zdCB7IGtleXMsIGRlcHMgPSBbc3RvcmUsIGtleXNdIH0gPSBvcHRpb25zO1xuICBsZXQgc3Vic2NyaWJlID0gdXNlQ2FsbGJhY2soKG9uQ2hhbmdlKSA9PiB7XG4gICAgY29uc3QgZW1pdENoYW5nZSA9ICh2YWx1ZSkgPT4ge1xuICAgICAgaWYgKHNuYXBzaG90UmVmLmN1cnJlbnQgPT09IHZhbHVlKSByZXR1cm47XG4gICAgICBzbmFwc2hvdFJlZi5jdXJyZW50ID0gdmFsdWU7XG4gICAgICBvbkNoYW5nZSgpO1xuICAgIH07XG4gICAgZW1pdENoYW5nZShzdG9yZS52YWx1ZSk7XG4gICAgaWYgKGtleXM/Lmxlbmd0aCkge1xuICAgICAgcmV0dXJuIGxpc3RlbktleXMoc3RvcmUsIGtleXMsIGVtaXRDaGFuZ2UpO1xuICAgIH1cbiAgICByZXR1cm4gc3RvcmUubGlzdGVuKGVtaXRDaGFuZ2UpO1xuICB9LCBkZXBzKTtcbiAgbGV0IGdldCA9ICgpID0+IHNuYXBzaG90UmVmLmN1cnJlbnQ7XG4gIHJldHVybiB1c2VTeW5jRXh0ZXJuYWxTdG9yZShzdWJzY3JpYmUsIGdldCwgZ2V0KTtcbn1cblxuZnVuY3Rpb24gZ2V0QXRvbUtleShzdHIpIHtcbiAgcmV0dXJuIGB1c2Uke2NhcGl0YWxpemVGaXJzdExldHRlcihzdHIpfWA7XG59XG5mdW5jdGlvbiBjYXBpdGFsaXplRmlyc3RMZXR0ZXIoc3RyKSB7XG4gIHJldHVybiBzdHIuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBzdHIuc2xpY2UoMSk7XG59XG5mdW5jdGlvbiBjcmVhdGVBdXRoQ2xpZW50KG9wdGlvbnMpIHtcbiAgY29uc3Qge1xuICAgIHBsdWdpblBhdGhNZXRob2RzLFxuICAgIHBsdWdpbnNBY3Rpb25zLFxuICAgIHBsdWdpbnNBdG9tcyxcbiAgICAkZmV0Y2gsXG4gICAgJHN0b3JlLFxuICAgIGF0b21MaXN0ZW5lcnNcbiAgfSA9IGdldENsaWVudENvbmZpZyhvcHRpb25zKTtcbiAgbGV0IHJlc29sdmVkSG9va3MgPSB7fTtcbiAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMocGx1Z2luc0F0b21zKSkge1xuICAgIHJlc29sdmVkSG9va3NbZ2V0QXRvbUtleShrZXkpXSA9ICgpID0+IHVzZVN0b3JlKHZhbHVlKTtcbiAgfVxuICBjb25zdCByb3V0ZXMgPSB7XG4gICAgLi4ucGx1Z2luc0FjdGlvbnMsXG4gICAgLi4ucmVzb2x2ZWRIb29rcyxcbiAgICAkZmV0Y2gsXG4gICAgJHN0b3JlXG4gIH07XG4gIGNvbnN0IHByb3h5ID0gY3JlYXRlRHluYW1pY1BhdGhQcm94eShcbiAgICByb3V0ZXMsXG4gICAgJGZldGNoLFxuICAgIHBsdWdpblBhdGhNZXRob2RzLFxuICAgIHBsdWdpbnNBdG9tcyxcbiAgICBhdG9tTGlzdGVuZXJzXG4gICk7XG4gIHJldHVybiBwcm94eTtcbn1cblxuZXhwb3J0IHsgY2FwaXRhbGl6ZUZpcnN0TGV0dGVyLCBjcmVhdGVBdXRoQ2xpZW50LCB1c2VTdG9yZSB9O1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/../../node_modules/better-auth/dist/client/react/index.mjs\n");

/***/ }),

/***/ "(ssr)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   a: () => (/* binding */ isProduction),\n/* harmony export */   b: () => (/* binding */ isDevelopment),\n/* harmony export */   e: () => (/* binding */ env),\n/* harmony export */   i: () => (/* binding */ isTest)\n/* harmony export */ });\nconst _envShim = /* @__PURE__ */ Object.create(null);\nconst _getEnv = (useShim) => globalThis.process?.env || //@ts-expect-error\nglobalThis.Deno?.env.toObject() || //@ts-expect-error\nglobalThis.__env__ || (useShim ? _envShim : globalThis);\nconst env = new Proxy(_envShim, {\n  get(_, prop) {\n    const env2 = _getEnv();\n    return env2[prop] ?? _envShim[prop];\n  },\n  has(_, prop) {\n    const env2 = _getEnv();\n    return prop in env2 || prop in _envShim;\n  },\n  set(_, prop, value) {\n    const env2 = _getEnv(true);\n    env2[prop] = value;\n    return true;\n  },\n  deleteProperty(_, prop) {\n    if (!prop) {\n      return false;\n    }\n    const env2 = _getEnv(true);\n    delete env2[prop];\n    return true;\n  },\n  ownKeys() {\n    const env2 = _getEnv(true);\n    return Object.keys(env2);\n  }\n});\nfunction toBoolean(val) {\n  return val ? val !== \"false\" : false;\n}\nconst nodeENV = typeof process !== \"undefined\" && process.env && \"development\" || \"\";\nconst isProduction = nodeENV === \"production\";\nconst isDevelopment = nodeENV === \"dev\" || nodeENV === \"development\";\nconst isTest = nodeENV === \"test\" || toBoolean(env.TEST);\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLjh6b3h6Zy1GLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsaUVBQWlFLGFBQW9CO0FBQ3JGO0FBQ0E7QUFDQTs7QUFFd0UiLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWxhbi9EZXNrdG9wL0FwcHMvYmV0dGVyLWF1dGgvbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLjh6b3h6Zy1GLm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBfZW52U2hpbSA9IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpO1xuY29uc3QgX2dldEVudiA9ICh1c2VTaGltKSA9PiBnbG9iYWxUaGlzLnByb2Nlc3M/LmVudiB8fCAvL0B0cy1leHBlY3QtZXJyb3Jcbmdsb2JhbFRoaXMuRGVubz8uZW52LnRvT2JqZWN0KCkgfHwgLy9AdHMtZXhwZWN0LWVycm9yXG5nbG9iYWxUaGlzLl9fZW52X18gfHwgKHVzZVNoaW0gPyBfZW52U2hpbSA6IGdsb2JhbFRoaXMpO1xuY29uc3QgZW52ID0gbmV3IFByb3h5KF9lbnZTaGltLCB7XG4gIGdldChfLCBwcm9wKSB7XG4gICAgY29uc3QgZW52MiA9IF9nZXRFbnYoKTtcbiAgICByZXR1cm4gZW52Mltwcm9wXSA/PyBfZW52U2hpbVtwcm9wXTtcbiAgfSxcbiAgaGFzKF8sIHByb3ApIHtcbiAgICBjb25zdCBlbnYyID0gX2dldEVudigpO1xuICAgIHJldHVybiBwcm9wIGluIGVudjIgfHwgcHJvcCBpbiBfZW52U2hpbTtcbiAgfSxcbiAgc2V0KF8sIHByb3AsIHZhbHVlKSB7XG4gICAgY29uc3QgZW52MiA9IF9nZXRFbnYodHJ1ZSk7XG4gICAgZW52Mltwcm9wXSA9IHZhbHVlO1xuICAgIHJldHVybiB0cnVlO1xuICB9LFxuICBkZWxldGVQcm9wZXJ0eShfLCBwcm9wKSB7XG4gICAgaWYgKCFwcm9wKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IGVudjIgPSBfZ2V0RW52KHRydWUpO1xuICAgIGRlbGV0ZSBlbnYyW3Byb3BdO1xuICAgIHJldHVybiB0cnVlO1xuICB9LFxuICBvd25LZXlzKCkge1xuICAgIGNvbnN0IGVudjIgPSBfZ2V0RW52KHRydWUpO1xuICAgIHJldHVybiBPYmplY3Qua2V5cyhlbnYyKTtcbiAgfVxufSk7XG5mdW5jdGlvbiB0b0Jvb2xlYW4odmFsKSB7XG4gIHJldHVybiB2YWwgPyB2YWwgIT09IFwiZmFsc2VcIiA6IGZhbHNlO1xufVxuY29uc3Qgbm9kZUVOViA9IHR5cGVvZiBwcm9jZXNzICE9PSBcInVuZGVmaW5lZFwiICYmIHByb2Nlc3MuZW52ICYmIHByb2Nlc3MuZW52Lk5PREVfRU5WIHx8IFwiXCI7XG5jb25zdCBpc1Byb2R1Y3Rpb24gPSBub2RlRU5WID09PSBcInByb2R1Y3Rpb25cIjtcbmNvbnN0IGlzRGV2ZWxvcG1lbnQgPSBub2RlRU5WID09PSBcImRldlwiIHx8IG5vZGVFTlYgPT09IFwiZGV2ZWxvcG1lbnRcIjtcbmNvbnN0IGlzVGVzdCA9IG5vZGVFTlYgPT09IFwidGVzdFwiIHx8IHRvQm9vbGVhbihlbnYuVEVTVCk7XG5cbmV4cG9ydCB7IGlzUHJvZHVjdGlvbiBhcyBhLCBpc0RldmVsb3BtZW50IGFzIGIsIGVudiBhcyBlLCBpc1Rlc3QgYXMgaSB9O1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs\n");

/***/ }),

/***/ "(ssr)/../../node_modules/better-auth/dist/shared/better-auth.A_Crzln-.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.A_Crzln-.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   c: () => (/* binding */ createDynamicPathProxy),\n/* harmony export */   g: () => (/* binding */ getClientConfig)\n/* harmony export */ });\n/* harmony import */ var _better_fetch_fetch__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @better-fetch/fetch */ \"(ssr)/../../node_modules/@better-fetch/fetch/dist/index.js\");\n/* harmony import */ var _better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./better-auth.VTXNLFMT.mjs */ \"(ssr)/../../node_modules/better-auth/dist/shared/better-auth.VTXNLFMT.mjs\");\n/* harmony import */ var nanostores__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! nanostores */ \"(ssr)/../../node_modules/nanostores/atom/index.js\");\n/* harmony import */ var _better_auth_Buni1mmI_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./better-auth.Buni1mmI.mjs */ \"(ssr)/../../node_modules/better-auth/dist/shared/better-auth.Buni1mmI.mjs\");\n/* harmony import */ var _better_auth_ffWeg50w_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./better-auth.ffWeg50w.mjs */ \"(ssr)/../../node_modules/better-auth/dist/shared/better-auth.ffWeg50w.mjs\");\n\n\n\n\n\n\nconst redirectPlugin = {\n  id: \"redirect\",\n  name: \"Redirect\",\n  hooks: {\n    onSuccess(context) {\n      if (context.data?.url && context.data?.redirect) {\n        if (typeof window !== \"undefined\" && window.location) {\n          if (window.location) {\n            try {\n              window.location.href = context.data.url;\n            } catch {\n            }\n          }\n        }\n      }\n    }\n  }\n};\n\nfunction getSessionAtom($fetch) {\n  const $signal = (0,nanostores__WEBPACK_IMPORTED_MODULE_4__.atom)(false);\n  const session = (0,_better_auth_Buni1mmI_mjs__WEBPACK_IMPORTED_MODULE_2__.u)($signal, \"/get-session\", $fetch, {\n    method: \"GET\"\n  });\n  return {\n    session,\n    $sessionSignal: $signal\n  };\n}\n\nconst getClientConfig = (options) => {\n  const isCredentialsSupported = \"credentials\" in Request.prototype;\n  const baseURL = (0,_better_auth_VTXNLFMT_mjs__WEBPACK_IMPORTED_MODULE_1__.a)(options?.baseURL, options?.basePath);\n  const pluginsFetchPlugins = options?.plugins?.flatMap((plugin) => plugin.fetchPlugins).filter((pl) => pl !== void 0) || [];\n  const lifeCyclePlugin = {\n    id: \"lifecycle-hooks\",\n    name: \"lifecycle-hooks\",\n    hooks: {\n      onSuccess: options?.fetchOptions?.onSuccess,\n      onError: options?.fetchOptions?.onError,\n      onRequest: options?.fetchOptions?.onRequest,\n      onResponse: options?.fetchOptions?.onResponse\n    }\n  };\n  const { onSuccess, onError, onRequest, onResponse, ...restOfFetchOptions } = options?.fetchOptions || {};\n  const $fetch = (0,_better_fetch_fetch__WEBPACK_IMPORTED_MODULE_0__.createFetch)({\n    baseURL,\n    ...isCredentialsSupported ? { credentials: \"include\" } : {},\n    method: \"GET\",\n    jsonParser(text) {\n      if (!text) {\n        return null;\n      }\n      return (0,_better_auth_ffWeg50w_mjs__WEBPACK_IMPORTED_MODULE_3__.p)(text, {\n        strict: false\n      });\n    },\n    customFetchImpl: async (input, init) => {\n      try {\n        return await fetch(input, init);\n      } catch (error) {\n        return Response.error();\n      }\n    },\n    ...restOfFetchOptions,\n    plugins: [\n      lifeCyclePlugin,\n      ...restOfFetchOptions.plugins || [],\n      ...options?.disableDefaultFetchPlugins ? [] : [redirectPlugin],\n      ...pluginsFetchPlugins\n    ]\n  });\n  const { $sessionSignal, session } = getSessionAtom($fetch);\n  const plugins = options?.plugins || [];\n  let pluginsActions = {};\n  let pluginsAtoms = {\n    $sessionSignal,\n    session\n  };\n  let pluginPathMethods = {\n    \"/sign-out\": \"POST\",\n    \"/revoke-sessions\": \"POST\",\n    \"/revoke-other-sessions\": \"POST\",\n    \"/delete-user\": \"POST\"\n  };\n  const atomListeners = [\n    {\n      signal: \"$sessionSignal\",\n      matcher(path) {\n        return path === \"/sign-out\" || path === \"/update-user\" || path.startsWith(\"/sign-in\") || path.startsWith(\"/sign-up\") || path === \"/delete-user\" || path === \"/verify-email\";\n      }\n    }\n  ];\n  for (const plugin of plugins) {\n    if (plugin.getAtoms) {\n      Object.assign(pluginsAtoms, plugin.getAtoms?.($fetch));\n    }\n    if (plugin.pathMethods) {\n      Object.assign(pluginPathMethods, plugin.pathMethods);\n    }\n    if (plugin.atomListeners) {\n      atomListeners.push(...plugin.atomListeners);\n    }\n  }\n  const $store = {\n    notify: (signal) => {\n      pluginsAtoms[signal].set(\n        !pluginsAtoms[signal].get()\n      );\n    },\n    listen: (signal, listener) => {\n      pluginsAtoms[signal].subscribe(listener);\n    },\n    atoms: pluginsAtoms\n  };\n  for (const plugin of plugins) {\n    if (plugin.getActions) {\n      Object.assign(\n        pluginsActions,\n        plugin.getActions?.($fetch, $store, options)\n      );\n    }\n  }\n  return {\n    pluginsActions,\n    pluginsAtoms,\n    pluginPathMethods,\n    atomListeners,\n    $fetch,\n    $store\n  };\n};\n\nfunction getMethod(path, knownPathMethods, args) {\n  const method = knownPathMethods[path];\n  const { fetchOptions, query, ...body } = args || {};\n  if (method) {\n    return method;\n  }\n  if (fetchOptions?.method) {\n    return fetchOptions.method;\n  }\n  if (body && Object.keys(body).length > 0) {\n    return \"POST\";\n  }\n  return \"GET\";\n}\nfunction createDynamicPathProxy(routes, client, knownPathMethods, atoms, atomListeners) {\n  function createProxy(path = []) {\n    return new Proxy(function() {\n    }, {\n      get(target, prop) {\n        const fullPath = [...path, prop];\n        let current = routes;\n        for (const segment of fullPath) {\n          if (current && typeof current === \"object\" && segment in current) {\n            current = current[segment];\n          } else {\n            current = void 0;\n            break;\n          }\n        }\n        if (typeof current === \"function\") {\n          return current;\n        }\n        return createProxy(fullPath);\n      },\n      apply: async (_, __, args) => {\n        const routePath = \"/\" + path.map(\n          (segment) => segment.replace(/[A-Z]/g, (letter) => `-${letter.toLowerCase()}`)\n        ).join(\"/\");\n        const arg = args[0] || {};\n        const fetchOptions = args[1] || {};\n        const { query, fetchOptions: argFetchOptions, ...body } = arg;\n        const options = {\n          ...fetchOptions,\n          ...argFetchOptions\n        };\n        const method = getMethod(routePath, knownPathMethods, arg);\n        return await client(routePath, {\n          ...options,\n          body: method === \"GET\" ? void 0 : {\n            ...body,\n            ...options?.body || {}\n          },\n          query: query || options?.query,\n          method,\n          async onSuccess(context) {\n            await options?.onSuccess?.(context);\n            const matches = atomListeners?.find((s) => s.matcher(routePath));\n            if (!matches) return;\n            const signal = atoms[matches.signal];\n            if (!signal) return;\n            const val = signal.get();\n            setTimeout(() => {\n              signal.set(!val);\n            }, 10);\n          }\n        });\n      }\n    });\n  }\n  return createProxy();\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLkFfQ3J6bG4tLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQWtEO0FBQ1c7QUFDM0I7QUFDNkI7QUFDSDs7QUFFNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxrQkFBa0IsZ0RBQUk7QUFDdEIsa0JBQWtCLDREQUFZO0FBQzlCO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGtCQUFrQiw0REFBVTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxtRUFBbUU7QUFDN0UsaUJBQWlCLGdFQUFXO0FBQzVCO0FBQ0Esa0NBQWtDLHlCQUF5QixJQUFJO0FBQy9EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLDREQUFTO0FBQ3RCO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxVQUFVLDBCQUEwQjtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsVUFBVSwrQkFBK0I7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsaUVBQWlFLHFCQUFxQjtBQUN0RjtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsZ0RBQWdEO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUU2RCIsInNvdXJjZXMiOlsiL1VzZXJzL21pbGFuL0Rlc2t0b3AvQXBwcy9iZXR0ZXItYXV0aC9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguQV9Dcnpsbi0ubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUZldGNoIH0gZnJvbSAnQGJldHRlci1mZXRjaC9mZXRjaCc7XG5pbXBvcnQgeyBhIGFzIGdldEJhc2VVUkwgfSBmcm9tICcuL2JldHRlci1hdXRoLlZUWE5MRk1ULm1qcyc7XG5pbXBvcnQgeyBhdG9tIH0gZnJvbSAnbmFub3N0b3Jlcyc7XG5pbXBvcnQgeyB1IGFzIHVzZUF1dGhRdWVyeSB9IGZyb20gJy4vYmV0dGVyLWF1dGguQnVuaTFtbUkubWpzJztcbmltcG9ydCB7IHAgYXMgcGFyc2VKU09OIH0gZnJvbSAnLi9iZXR0ZXItYXV0aC5mZldlZzUwdy5tanMnO1xuXG5jb25zdCByZWRpcmVjdFBsdWdpbiA9IHtcbiAgaWQ6IFwicmVkaXJlY3RcIixcbiAgbmFtZTogXCJSZWRpcmVjdFwiLFxuICBob29rczoge1xuICAgIG9uU3VjY2Vzcyhjb250ZXh0KSB7XG4gICAgICBpZiAoY29udGV4dC5kYXRhPy51cmwgJiYgY29udGV4dC5kYXRhPy5yZWRpcmVjdCkge1xuICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiAmJiB3aW5kb3cubG9jYXRpb24pIHtcbiAgICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGNvbnRleHQuZGF0YS51cmw7XG4gICAgICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cbmZ1bmN0aW9uIGdldFNlc3Npb25BdG9tKCRmZXRjaCkge1xuICBjb25zdCAkc2lnbmFsID0gYXRvbShmYWxzZSk7XG4gIGNvbnN0IHNlc3Npb24gPSB1c2VBdXRoUXVlcnkoJHNpZ25hbCwgXCIvZ2V0LXNlc3Npb25cIiwgJGZldGNoLCB7XG4gICAgbWV0aG9kOiBcIkdFVFwiXG4gIH0pO1xuICByZXR1cm4ge1xuICAgIHNlc3Npb24sXG4gICAgJHNlc3Npb25TaWduYWw6ICRzaWduYWxcbiAgfTtcbn1cblxuY29uc3QgZ2V0Q2xpZW50Q29uZmlnID0gKG9wdGlvbnMpID0+IHtcbiAgY29uc3QgaXNDcmVkZW50aWFsc1N1cHBvcnRlZCA9IFwiY3JlZGVudGlhbHNcIiBpbiBSZXF1ZXN0LnByb3RvdHlwZTtcbiAgY29uc3QgYmFzZVVSTCA9IGdldEJhc2VVUkwob3B0aW9ucz8uYmFzZVVSTCwgb3B0aW9ucz8uYmFzZVBhdGgpO1xuICBjb25zdCBwbHVnaW5zRmV0Y2hQbHVnaW5zID0gb3B0aW9ucz8ucGx1Z2lucz8uZmxhdE1hcCgocGx1Z2luKSA9PiBwbHVnaW4uZmV0Y2hQbHVnaW5zKS5maWx0ZXIoKHBsKSA9PiBwbCAhPT0gdm9pZCAwKSB8fCBbXTtcbiAgY29uc3QgbGlmZUN5Y2xlUGx1Z2luID0ge1xuICAgIGlkOiBcImxpZmVjeWNsZS1ob29rc1wiLFxuICAgIG5hbWU6IFwibGlmZWN5Y2xlLWhvb2tzXCIsXG4gICAgaG9va3M6IHtcbiAgICAgIG9uU3VjY2Vzczogb3B0aW9ucz8uZmV0Y2hPcHRpb25zPy5vblN1Y2Nlc3MsXG4gICAgICBvbkVycm9yOiBvcHRpb25zPy5mZXRjaE9wdGlvbnM/Lm9uRXJyb3IsXG4gICAgICBvblJlcXVlc3Q6IG9wdGlvbnM/LmZldGNoT3B0aW9ucz8ub25SZXF1ZXN0LFxuICAgICAgb25SZXNwb25zZTogb3B0aW9ucz8uZmV0Y2hPcHRpb25zPy5vblJlc3BvbnNlXG4gICAgfVxuICB9O1xuICBjb25zdCB7IG9uU3VjY2Vzcywgb25FcnJvciwgb25SZXF1ZXN0LCBvblJlc3BvbnNlLCAuLi5yZXN0T2ZGZXRjaE9wdGlvbnMgfSA9IG9wdGlvbnM/LmZldGNoT3B0aW9ucyB8fCB7fTtcbiAgY29uc3QgJGZldGNoID0gY3JlYXRlRmV0Y2goe1xuICAgIGJhc2VVUkwsXG4gICAgLi4uaXNDcmVkZW50aWFsc1N1cHBvcnRlZCA/IHsgY3JlZGVudGlhbHM6IFwiaW5jbHVkZVwiIH0gOiB7fSxcbiAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAganNvblBhcnNlcih0ZXh0KSB7XG4gICAgICBpZiAoIXRleHQpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICByZXR1cm4gcGFyc2VKU09OKHRleHQsIHtcbiAgICAgICAgc3RyaWN0OiBmYWxzZVxuICAgICAgfSk7XG4gICAgfSxcbiAgICBjdXN0b21GZXRjaEltcGw6IGFzeW5jIChpbnB1dCwgaW5pdCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IGZldGNoKGlucHV0LCBpbml0KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiBSZXNwb25zZS5lcnJvcigpO1xuICAgICAgfVxuICAgIH0sXG4gICAgLi4ucmVzdE9mRmV0Y2hPcHRpb25zLFxuICAgIHBsdWdpbnM6IFtcbiAgICAgIGxpZmVDeWNsZVBsdWdpbixcbiAgICAgIC4uLnJlc3RPZkZldGNoT3B0aW9ucy5wbHVnaW5zIHx8IFtdLFxuICAgICAgLi4ub3B0aW9ucz8uZGlzYWJsZURlZmF1bHRGZXRjaFBsdWdpbnMgPyBbXSA6IFtyZWRpcmVjdFBsdWdpbl0sXG4gICAgICAuLi5wbHVnaW5zRmV0Y2hQbHVnaW5zXG4gICAgXVxuICB9KTtcbiAgY29uc3QgeyAkc2Vzc2lvblNpZ25hbCwgc2Vzc2lvbiB9ID0gZ2V0U2Vzc2lvbkF0b20oJGZldGNoKTtcbiAgY29uc3QgcGx1Z2lucyA9IG9wdGlvbnM/LnBsdWdpbnMgfHwgW107XG4gIGxldCBwbHVnaW5zQWN0aW9ucyA9IHt9O1xuICBsZXQgcGx1Z2luc0F0b21zID0ge1xuICAgICRzZXNzaW9uU2lnbmFsLFxuICAgIHNlc3Npb25cbiAgfTtcbiAgbGV0IHBsdWdpblBhdGhNZXRob2RzID0ge1xuICAgIFwiL3NpZ24tb3V0XCI6IFwiUE9TVFwiLFxuICAgIFwiL3Jldm9rZS1zZXNzaW9uc1wiOiBcIlBPU1RcIixcbiAgICBcIi9yZXZva2Utb3RoZXItc2Vzc2lvbnNcIjogXCJQT1NUXCIsXG4gICAgXCIvZGVsZXRlLXVzZXJcIjogXCJQT1NUXCJcbiAgfTtcbiAgY29uc3QgYXRvbUxpc3RlbmVycyA9IFtcbiAgICB7XG4gICAgICBzaWduYWw6IFwiJHNlc3Npb25TaWduYWxcIixcbiAgICAgIG1hdGNoZXIocGF0aCkge1xuICAgICAgICByZXR1cm4gcGF0aCA9PT0gXCIvc2lnbi1vdXRcIiB8fCBwYXRoID09PSBcIi91cGRhdGUtdXNlclwiIHx8IHBhdGguc3RhcnRzV2l0aChcIi9zaWduLWluXCIpIHx8IHBhdGguc3RhcnRzV2l0aChcIi9zaWduLXVwXCIpIHx8IHBhdGggPT09IFwiL2RlbGV0ZS11c2VyXCIgfHwgcGF0aCA9PT0gXCIvdmVyaWZ5LWVtYWlsXCI7XG4gICAgICB9XG4gICAgfVxuICBdO1xuICBmb3IgKGNvbnN0IHBsdWdpbiBvZiBwbHVnaW5zKSB7XG4gICAgaWYgKHBsdWdpbi5nZXRBdG9tcykge1xuICAgICAgT2JqZWN0LmFzc2lnbihwbHVnaW5zQXRvbXMsIHBsdWdpbi5nZXRBdG9tcz8uKCRmZXRjaCkpO1xuICAgIH1cbiAgICBpZiAocGx1Z2luLnBhdGhNZXRob2RzKSB7XG4gICAgICBPYmplY3QuYXNzaWduKHBsdWdpblBhdGhNZXRob2RzLCBwbHVnaW4ucGF0aE1ldGhvZHMpO1xuICAgIH1cbiAgICBpZiAocGx1Z2luLmF0b21MaXN0ZW5lcnMpIHtcbiAgICAgIGF0b21MaXN0ZW5lcnMucHVzaCguLi5wbHVnaW4uYXRvbUxpc3RlbmVycyk7XG4gICAgfVxuICB9XG4gIGNvbnN0ICRzdG9yZSA9IHtcbiAgICBub3RpZnk6IChzaWduYWwpID0+IHtcbiAgICAgIHBsdWdpbnNBdG9tc1tzaWduYWxdLnNldChcbiAgICAgICAgIXBsdWdpbnNBdG9tc1tzaWduYWxdLmdldCgpXG4gICAgICApO1xuICAgIH0sXG4gICAgbGlzdGVuOiAoc2lnbmFsLCBsaXN0ZW5lcikgPT4ge1xuICAgICAgcGx1Z2luc0F0b21zW3NpZ25hbF0uc3Vic2NyaWJlKGxpc3RlbmVyKTtcbiAgICB9LFxuICAgIGF0b21zOiBwbHVnaW5zQXRvbXNcbiAgfTtcbiAgZm9yIChjb25zdCBwbHVnaW4gb2YgcGx1Z2lucykge1xuICAgIGlmIChwbHVnaW4uZ2V0QWN0aW9ucykge1xuICAgICAgT2JqZWN0LmFzc2lnbihcbiAgICAgICAgcGx1Z2luc0FjdGlvbnMsXG4gICAgICAgIHBsdWdpbi5nZXRBY3Rpb25zPy4oJGZldGNoLCAkc3RvcmUsIG9wdGlvbnMpXG4gICAgICApO1xuICAgIH1cbiAgfVxuICByZXR1cm4ge1xuICAgIHBsdWdpbnNBY3Rpb25zLFxuICAgIHBsdWdpbnNBdG9tcyxcbiAgICBwbHVnaW5QYXRoTWV0aG9kcyxcbiAgICBhdG9tTGlzdGVuZXJzLFxuICAgICRmZXRjaCxcbiAgICAkc3RvcmVcbiAgfTtcbn07XG5cbmZ1bmN0aW9uIGdldE1ldGhvZChwYXRoLCBrbm93blBhdGhNZXRob2RzLCBhcmdzKSB7XG4gIGNvbnN0IG1ldGhvZCA9IGtub3duUGF0aE1ldGhvZHNbcGF0aF07XG4gIGNvbnN0IHsgZmV0Y2hPcHRpb25zLCBxdWVyeSwgLi4uYm9keSB9ID0gYXJncyB8fCB7fTtcbiAgaWYgKG1ldGhvZCkge1xuICAgIHJldHVybiBtZXRob2Q7XG4gIH1cbiAgaWYgKGZldGNoT3B0aW9ucz8ubWV0aG9kKSB7XG4gICAgcmV0dXJuIGZldGNoT3B0aW9ucy5tZXRob2Q7XG4gIH1cbiAgaWYgKGJvZHkgJiYgT2JqZWN0LmtleXMoYm9keSkubGVuZ3RoID4gMCkge1xuICAgIHJldHVybiBcIlBPU1RcIjtcbiAgfVxuICByZXR1cm4gXCJHRVRcIjtcbn1cbmZ1bmN0aW9uIGNyZWF0ZUR5bmFtaWNQYXRoUHJveHkocm91dGVzLCBjbGllbnQsIGtub3duUGF0aE1ldGhvZHMsIGF0b21zLCBhdG9tTGlzdGVuZXJzKSB7XG4gIGZ1bmN0aW9uIGNyZWF0ZVByb3h5KHBhdGggPSBbXSkge1xuICAgIHJldHVybiBuZXcgUHJveHkoZnVuY3Rpb24oKSB7XG4gICAgfSwge1xuICAgICAgZ2V0KHRhcmdldCwgcHJvcCkge1xuICAgICAgICBjb25zdCBmdWxsUGF0aCA9IFsuLi5wYXRoLCBwcm9wXTtcbiAgICAgICAgbGV0IGN1cnJlbnQgPSByb3V0ZXM7XG4gICAgICAgIGZvciAoY29uc3Qgc2VnbWVudCBvZiBmdWxsUGF0aCkge1xuICAgICAgICAgIGlmIChjdXJyZW50ICYmIHR5cGVvZiBjdXJyZW50ID09PSBcIm9iamVjdFwiICYmIHNlZ21lbnQgaW4gY3VycmVudCkge1xuICAgICAgICAgICAgY3VycmVudCA9IGN1cnJlbnRbc2VnbWVudF07XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGN1cnJlbnQgPSB2b2lkIDA7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBjdXJyZW50ID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICByZXR1cm4gY3VycmVudDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY3JlYXRlUHJveHkoZnVsbFBhdGgpO1xuICAgICAgfSxcbiAgICAgIGFwcGx5OiBhc3luYyAoXywgX18sIGFyZ3MpID0+IHtcbiAgICAgICAgY29uc3Qgcm91dGVQYXRoID0gXCIvXCIgKyBwYXRoLm1hcChcbiAgICAgICAgICAoc2VnbWVudCkgPT4gc2VnbWVudC5yZXBsYWNlKC9bQS1aXS9nLCAobGV0dGVyKSA9PiBgLSR7bGV0dGVyLnRvTG93ZXJDYXNlKCl9YClcbiAgICAgICAgKS5qb2luKFwiL1wiKTtcbiAgICAgICAgY29uc3QgYXJnID0gYXJnc1swXSB8fCB7fTtcbiAgICAgICAgY29uc3QgZmV0Y2hPcHRpb25zID0gYXJnc1sxXSB8fCB7fTtcbiAgICAgICAgY29uc3QgeyBxdWVyeSwgZmV0Y2hPcHRpb25zOiBhcmdGZXRjaE9wdGlvbnMsIC4uLmJvZHkgfSA9IGFyZztcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgICAuLi5mZXRjaE9wdGlvbnMsXG4gICAgICAgICAgLi4uYXJnRmV0Y2hPcHRpb25zXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IG1ldGhvZCA9IGdldE1ldGhvZChyb3V0ZVBhdGgsIGtub3duUGF0aE1ldGhvZHMsIGFyZyk7XG4gICAgICAgIHJldHVybiBhd2FpdCBjbGllbnQocm91dGVQYXRoLCB7XG4gICAgICAgICAgLi4ub3B0aW9ucyxcbiAgICAgICAgICBib2R5OiBtZXRob2QgPT09IFwiR0VUXCIgPyB2b2lkIDAgOiB7XG4gICAgICAgICAgICAuLi5ib2R5LFxuICAgICAgICAgICAgLi4ub3B0aW9ucz8uYm9keSB8fCB7fVxuICAgICAgICAgIH0sXG4gICAgICAgICAgcXVlcnk6IHF1ZXJ5IHx8IG9wdGlvbnM/LnF1ZXJ5LFxuICAgICAgICAgIG1ldGhvZCxcbiAgICAgICAgICBhc3luYyBvblN1Y2Nlc3MoY29udGV4dCkge1xuICAgICAgICAgICAgYXdhaXQgb3B0aW9ucz8ub25TdWNjZXNzPy4oY29udGV4dCk7XG4gICAgICAgICAgICBjb25zdCBtYXRjaGVzID0gYXRvbUxpc3RlbmVycz8uZmluZCgocykgPT4gcy5tYXRjaGVyKHJvdXRlUGF0aCkpO1xuICAgICAgICAgICAgaWYgKCFtYXRjaGVzKSByZXR1cm47XG4gICAgICAgICAgICBjb25zdCBzaWduYWwgPSBhdG9tc1ttYXRjaGVzLnNpZ25hbF07XG4gICAgICAgICAgICBpZiAoIXNpZ25hbCkgcmV0dXJuO1xuICAgICAgICAgICAgY29uc3QgdmFsID0gc2lnbmFsLmdldCgpO1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgIHNpZ25hbC5zZXQoIXZhbCk7XG4gICAgICAgICAgICB9LCAxMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICByZXR1cm4gY3JlYXRlUHJveHkoKTtcbn1cblxuZXhwb3J0IHsgY3JlYXRlRHluYW1pY1BhdGhQcm94eSBhcyBjLCBnZXRDbGllbnRDb25maWcgYXMgZyB9O1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/../../node_modules/better-auth/dist/shared/better-auth.A_Crzln-.mjs\n");

/***/ }),

/***/ "(ssr)/../../node_modules/better-auth/dist/shared/better-auth.Buni1mmI.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.Buni1mmI.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   u: () => (/* binding */ useAuthQuery)\n/* harmony export */ });\n/* harmony import */ var nanostores__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! nanostores */ \"(ssr)/../../node_modules/nanostores/atom/index.js\");\n/* harmony import */ var nanostores__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! nanostores */ \"(ssr)/../../node_modules/nanostores/lifecycle/index.js\");\n\n\nconst isServer = typeof window === \"undefined\";\nconst useAuthQuery = (initializedAtom, path, $fetch, options) => {\n  const value = (0,nanostores__WEBPACK_IMPORTED_MODULE_0__.atom)({\n    data: null,\n    error: null,\n    isPending: true,\n    isRefetching: false,\n    refetch: () => {\n      return fn();\n    }\n  });\n  const fn = () => {\n    const opts = typeof options === \"function\" ? options({\n      data: value.get().data,\n      error: value.get().error,\n      isPending: value.get().isPending\n    }) : options;\n    return $fetch(path, {\n      ...opts,\n      async onSuccess(context) {\n        value.set({\n          data: context.data,\n          error: null,\n          isPending: false,\n          isRefetching: false,\n          refetch: value.value.refetch\n        });\n        await opts?.onSuccess?.(context);\n      },\n      async onError(context) {\n        const { request } = context;\n        const retryAttempts = typeof request.retry === \"number\" ? request.retry : request.retry?.attempts;\n        const retryAttempt = request.retryAttempt || 0;\n        if (retryAttempts && retryAttempt < retryAttempts) return;\n        value.set({\n          error: context.error,\n          data: null,\n          isPending: false,\n          isRefetching: false,\n          refetch: value.value.refetch\n        });\n        await opts?.onError?.(context);\n      },\n      async onRequest(context) {\n        const currentValue = value.get();\n        value.set({\n          isPending: currentValue.data === null,\n          data: currentValue.data,\n          error: null,\n          isRefetching: true,\n          refetch: value.value.refetch\n        });\n        await opts?.onRequest?.(context);\n      }\n    });\n  };\n  initializedAtom = Array.isArray(initializedAtom) ? initializedAtom : [initializedAtom];\n  let isMounted = false;\n  for (const initAtom of initializedAtom) {\n    initAtom.subscribe(() => {\n      if (isServer) {\n        return;\n      }\n      if (isMounted) {\n        fn();\n      } else {\n        (0,nanostores__WEBPACK_IMPORTED_MODULE_1__.onMount)(value, () => {\n          setTimeout(() => {\n            fn();\n          }, 0);\n          isMounted = true;\n          return () => {\n            value.off();\n            initAtom.off();\n          };\n        });\n      }\n    });\n  }\n  return value;\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLkJ1bmkxbW1JLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBMkM7O0FBRTNDO0FBQ0E7QUFDQSxnQkFBZ0IsZ0RBQUk7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxPQUFPO0FBQ1A7QUFDQSxnQkFBZ0IsVUFBVTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSLFFBQVEsbURBQU87QUFDZjtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUU2QiIsInNvdXJjZXMiOlsiL1VzZXJzL21pbGFuL0Rlc2t0b3AvQXBwcy9iZXR0ZXItYXV0aC9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguQnVuaTFtbUkubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGF0b20sIG9uTW91bnQgfSBmcm9tICduYW5vc3RvcmVzJztcblxuY29uc3QgaXNTZXJ2ZXIgPSB0eXBlb2Ygd2luZG93ID09PSBcInVuZGVmaW5lZFwiO1xuY29uc3QgdXNlQXV0aFF1ZXJ5ID0gKGluaXRpYWxpemVkQXRvbSwgcGF0aCwgJGZldGNoLCBvcHRpb25zKSA9PiB7XG4gIGNvbnN0IHZhbHVlID0gYXRvbSh7XG4gICAgZGF0YTogbnVsbCxcbiAgICBlcnJvcjogbnVsbCxcbiAgICBpc1BlbmRpbmc6IHRydWUsXG4gICAgaXNSZWZldGNoaW5nOiBmYWxzZSxcbiAgICByZWZldGNoOiAoKSA9PiB7XG4gICAgICByZXR1cm4gZm4oKTtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBmbiA9ICgpID0+IHtcbiAgICBjb25zdCBvcHRzID0gdHlwZW9mIG9wdGlvbnMgPT09IFwiZnVuY3Rpb25cIiA/IG9wdGlvbnMoe1xuICAgICAgZGF0YTogdmFsdWUuZ2V0KCkuZGF0YSxcbiAgICAgIGVycm9yOiB2YWx1ZS5nZXQoKS5lcnJvcixcbiAgICAgIGlzUGVuZGluZzogdmFsdWUuZ2V0KCkuaXNQZW5kaW5nXG4gICAgfSkgOiBvcHRpb25zO1xuICAgIHJldHVybiAkZmV0Y2gocGF0aCwge1xuICAgICAgLi4ub3B0cyxcbiAgICAgIGFzeW5jIG9uU3VjY2Vzcyhjb250ZXh0KSB7XG4gICAgICAgIHZhbHVlLnNldCh7XG4gICAgICAgICAgZGF0YTogY29udGV4dC5kYXRhLFxuICAgICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgICAgIGlzUGVuZGluZzogZmFsc2UsXG4gICAgICAgICAgaXNSZWZldGNoaW5nOiBmYWxzZSxcbiAgICAgICAgICByZWZldGNoOiB2YWx1ZS52YWx1ZS5yZWZldGNoXG4gICAgICAgIH0pO1xuICAgICAgICBhd2FpdCBvcHRzPy5vblN1Y2Nlc3M/Lihjb250ZXh0KTtcbiAgICAgIH0sXG4gICAgICBhc3luYyBvbkVycm9yKGNvbnRleHQpIHtcbiAgICAgICAgY29uc3QgeyByZXF1ZXN0IH0gPSBjb250ZXh0O1xuICAgICAgICBjb25zdCByZXRyeUF0dGVtcHRzID0gdHlwZW9mIHJlcXVlc3QucmV0cnkgPT09IFwibnVtYmVyXCIgPyByZXF1ZXN0LnJldHJ5IDogcmVxdWVzdC5yZXRyeT8uYXR0ZW1wdHM7XG4gICAgICAgIGNvbnN0IHJldHJ5QXR0ZW1wdCA9IHJlcXVlc3QucmV0cnlBdHRlbXB0IHx8IDA7XG4gICAgICAgIGlmIChyZXRyeUF0dGVtcHRzICYmIHJldHJ5QXR0ZW1wdCA8IHJldHJ5QXR0ZW1wdHMpIHJldHVybjtcbiAgICAgICAgdmFsdWUuc2V0KHtcbiAgICAgICAgICBlcnJvcjogY29udGV4dC5lcnJvcixcbiAgICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICAgIGlzUGVuZGluZzogZmFsc2UsXG4gICAgICAgICAgaXNSZWZldGNoaW5nOiBmYWxzZSxcbiAgICAgICAgICByZWZldGNoOiB2YWx1ZS52YWx1ZS5yZWZldGNoXG4gICAgICAgIH0pO1xuICAgICAgICBhd2FpdCBvcHRzPy5vbkVycm9yPy4oY29udGV4dCk7XG4gICAgICB9LFxuICAgICAgYXN5bmMgb25SZXF1ZXN0KGNvbnRleHQpIHtcbiAgICAgICAgY29uc3QgY3VycmVudFZhbHVlID0gdmFsdWUuZ2V0KCk7XG4gICAgICAgIHZhbHVlLnNldCh7XG4gICAgICAgICAgaXNQZW5kaW5nOiBjdXJyZW50VmFsdWUuZGF0YSA9PT0gbnVsbCxcbiAgICAgICAgICBkYXRhOiBjdXJyZW50VmFsdWUuZGF0YSxcbiAgICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgICAgICBpc1JlZmV0Y2hpbmc6IHRydWUsXG4gICAgICAgICAgcmVmZXRjaDogdmFsdWUudmFsdWUucmVmZXRjaFxuICAgICAgICB9KTtcbiAgICAgICAgYXdhaXQgb3B0cz8ub25SZXF1ZXN0Py4oY29udGV4dCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG4gIGluaXRpYWxpemVkQXRvbSA9IEFycmF5LmlzQXJyYXkoaW5pdGlhbGl6ZWRBdG9tKSA/IGluaXRpYWxpemVkQXRvbSA6IFtpbml0aWFsaXplZEF0b21dO1xuICBsZXQgaXNNb3VudGVkID0gZmFsc2U7XG4gIGZvciAoY29uc3QgaW5pdEF0b20gb2YgaW5pdGlhbGl6ZWRBdG9tKSB7XG4gICAgaW5pdEF0b20uc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIGlmIChpc1NlcnZlcikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoaXNNb3VudGVkKSB7XG4gICAgICAgIGZuKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvbk1vdW50KHZhbHVlLCAoKSA9PiB7XG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBmbigpO1xuICAgICAgICAgIH0sIDApO1xuICAgICAgICAgIGlzTW91bnRlZCA9IHRydWU7XG4gICAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIHZhbHVlLm9mZigpO1xuICAgICAgICAgICAgaW5pdEF0b20ub2ZmKCk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIHZhbHVlO1xufTtcblxuZXhwb3J0IHsgdXNlQXV0aFF1ZXJ5IGFzIHUgfTtcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/../../node_modules/better-auth/dist/shared/better-auth.Buni1mmI.mjs\n");

/***/ }),

/***/ "(ssr)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   B: () => (/* binding */ BetterAuthError),\n/* harmony export */   M: () => (/* binding */ MissingDependencyError)\n/* harmony export */ });\nclass BetterAuthError extends Error {\n  constructor(message, cause) {\n    super(message);\n    this.name = \"BetterAuthError\";\n    this.message = message;\n    this.cause = cause;\n    this.stack = \"\";\n  }\n}\nclass MissingDependencyError extends BetterAuthError {\n  constructor(pkgName) {\n    super(\n      `The package \"${pkgName}\" is required. Make sure it is installed.`,\n      pkgName\n    );\n  }\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLkRkelNKZi1uLm1qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixRQUFRO0FBQzlCO0FBQ0E7QUFDQTtBQUNBOztBQUU2RCIsInNvdXJjZXMiOlsiL1VzZXJzL21pbGFuL0Rlc2t0b3AvQXBwcy9iZXR0ZXItYXV0aC9ub2RlX21vZHVsZXMvYmV0dGVyLWF1dGgvZGlzdC9zaGFyZWQvYmV0dGVyLWF1dGguRGR6U0pmLW4ubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImNsYXNzIEJldHRlckF1dGhFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IobWVzc2FnZSwgY2F1c2UpIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB0aGlzLm5hbWUgPSBcIkJldHRlckF1dGhFcnJvclwiO1xuICAgIHRoaXMubWVzc2FnZSA9IG1lc3NhZ2U7XG4gICAgdGhpcy5jYXVzZSA9IGNhdXNlO1xuICAgIHRoaXMuc3RhY2sgPSBcIlwiO1xuICB9XG59XG5jbGFzcyBNaXNzaW5nRGVwZW5kZW5jeUVycm9yIGV4dGVuZHMgQmV0dGVyQXV0aEVycm9yIHtcbiAgY29uc3RydWN0b3IocGtnTmFtZSkge1xuICAgIHN1cGVyKFxuICAgICAgYFRoZSBwYWNrYWdlIFwiJHtwa2dOYW1lfVwiIGlzIHJlcXVpcmVkLiBNYWtlIHN1cmUgaXQgaXMgaW5zdGFsbGVkLmAsXG4gICAgICBwa2dOYW1lXG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgeyBCZXR0ZXJBdXRoRXJyb3IgYXMgQiwgTWlzc2luZ0RlcGVuZGVuY3lFcnJvciBhcyBNIH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs\n");

/***/ }),

/***/ "(ssr)/../../node_modules/better-auth/dist/shared/better-auth.VTXNLFMT.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.VTXNLFMT.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   a: () => (/* binding */ getBaseURL),\n/* harmony export */   b: () => (/* binding */ getHost),\n/* harmony export */   c: () => (/* binding */ getProtocol),\n/* harmony export */   g: () => (/* binding */ getOrigin)\n/* harmony export */ });\n/* harmony import */ var _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./better-auth.8zoxzg-F.mjs */ \"(ssr)/../../node_modules/better-auth/dist/shared/better-auth.8zoxzg-F.mjs\");\n/* harmony import */ var _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./better-auth.DdzSJf-n.mjs */ \"(ssr)/../../node_modules/better-auth/dist/shared/better-auth.DdzSJf-n.mjs\");\n\n\n\nfunction checkHasPath(url) {\n  try {\n    const parsedUrl = new URL(url);\n    return parsedUrl.pathname !== \"/\";\n  } catch (error) {\n    throw new _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_1__.B(\n      `Invalid base URL: ${url}. Please provide a valid base URL.`\n    );\n  }\n}\nfunction withPath(url, path = \"/api/auth\") {\n  const hasPath = checkHasPath(url);\n  if (hasPath) {\n    return url;\n  }\n  path = path.startsWith(\"/\") ? path : `/${path}`;\n  return `${url.replace(/\\/+$/, \"\")}${path}`;\n}\nfunction getBaseURL(url, path, request) {\n  if (url) {\n    return withPath(url, path);\n  }\n  const fromEnv = _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__.e.BETTER_AUTH_URL || _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__.e.NEXT_PUBLIC_BETTER_AUTH_URL || _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__.e.PUBLIC_BETTER_AUTH_URL || _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__.e.NUXT_PUBLIC_BETTER_AUTH_URL || _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__.e.NUXT_PUBLIC_AUTH_URL || (_better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__.e.BASE_URL !== \"/\" ? _better_auth_8zoxzg_F_mjs__WEBPACK_IMPORTED_MODULE_0__.e.BASE_URL : void 0);\n  if (fromEnv) {\n    return withPath(fromEnv, path);\n  }\n  const fromRequest = request?.headers.get(\"x-forwarded-host\");\n  const fromRequestProto = request?.headers.get(\"x-forwarded-proto\");\n  if (fromRequest && fromRequestProto) {\n    return withPath(`${fromRequestProto}://${fromRequest}`, path);\n  }\n  if (request) {\n    const url2 = getOrigin(request.url);\n    if (!url2) {\n      throw new _better_auth_DdzSJf_n_mjs__WEBPACK_IMPORTED_MODULE_1__.B(\n        \"Could not get origin from request. Please provide a valid base URL.\"\n      );\n    }\n    return withPath(url2, path);\n  }\n  if (typeof window !== \"undefined\" && window.location) {\n    return withPath(window.location.origin, path);\n  }\n  return void 0;\n}\nfunction getOrigin(url) {\n  try {\n    const parsedUrl = new URL(url);\n    return parsedUrl.origin;\n  } catch (error) {\n    return null;\n  }\n}\nfunction getProtocol(url) {\n  try {\n    const parsedUrl = new URL(url);\n    return parsedUrl.protocol;\n  } catch (error) {\n    return null;\n  }\n}\nfunction getHost(url) {\n  try {\n    const parsedUrl = new URL(url);\n    return parsedUrl.host;\n  } catch (error) {\n    return url;\n  }\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLlZUWE5MRk1ULm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBc0Q7QUFDWTs7QUFFbEU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osY0FBYyx3REFBZTtBQUM3QiwyQkFBMkIsSUFBSTtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLEtBQUs7QUFDaEQsWUFBWSx3QkFBd0IsRUFBRSxLQUFLO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0Isd0RBQUcsb0JBQW9CLHdEQUFHLGdDQUFnQyx3REFBRywyQkFBMkIsd0RBQUcsZ0NBQWdDLHdEQUFHLDBCQUEwQix3REFBRyxvQkFBb0Isd0RBQUc7QUFDcE07QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLGlCQUFpQixLQUFLLFlBQVk7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0Isd0RBQWU7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRTJFIiwic291cmNlcyI6WyIvVXNlcnMvbWlsYW4vRGVza3RvcC9BcHBzL2JldHRlci1hdXRoL25vZGVfbW9kdWxlcy9iZXR0ZXItYXV0aC9kaXN0L3NoYXJlZC9iZXR0ZXItYXV0aC5WVFhOTEZNVC5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZSBhcyBlbnYgfSBmcm9tICcuL2JldHRlci1hdXRoLjh6b3h6Zy1GLm1qcyc7XG5pbXBvcnQgeyBCIGFzIEJldHRlckF1dGhFcnJvciB9IGZyb20gJy4vYmV0dGVyLWF1dGguRGR6U0pmLW4ubWpzJztcblxuZnVuY3Rpb24gY2hlY2tIYXNQYXRoKHVybCkge1xuICB0cnkge1xuICAgIGNvbnN0IHBhcnNlZFVybCA9IG5ldyBVUkwodXJsKTtcbiAgICByZXR1cm4gcGFyc2VkVXJsLnBhdGhuYW1lICE9PSBcIi9cIjtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICB0aHJvdyBuZXcgQmV0dGVyQXV0aEVycm9yKFxuICAgICAgYEludmFsaWQgYmFzZSBVUkw6ICR7dXJsfS4gUGxlYXNlIHByb3ZpZGUgYSB2YWxpZCBiYXNlIFVSTC5gXG4gICAgKTtcbiAgfVxufVxuZnVuY3Rpb24gd2l0aFBhdGgodXJsLCBwYXRoID0gXCIvYXBpL2F1dGhcIikge1xuICBjb25zdCBoYXNQYXRoID0gY2hlY2tIYXNQYXRoKHVybCk7XG4gIGlmIChoYXNQYXRoKSB7XG4gICAgcmV0dXJuIHVybDtcbiAgfVxuICBwYXRoID0gcGF0aC5zdGFydHNXaXRoKFwiL1wiKSA/IHBhdGggOiBgLyR7cGF0aH1gO1xuICByZXR1cm4gYCR7dXJsLnJlcGxhY2UoL1xcLyskLywgXCJcIil9JHtwYXRofWA7XG59XG5mdW5jdGlvbiBnZXRCYXNlVVJMKHVybCwgcGF0aCwgcmVxdWVzdCkge1xuICBpZiAodXJsKSB7XG4gICAgcmV0dXJuIHdpdGhQYXRoKHVybCwgcGF0aCk7XG4gIH1cbiAgY29uc3QgZnJvbUVudiA9IGVudi5CRVRURVJfQVVUSF9VUkwgfHwgZW52Lk5FWFRfUFVCTElDX0JFVFRFUl9BVVRIX1VSTCB8fCBlbnYuUFVCTElDX0JFVFRFUl9BVVRIX1VSTCB8fCBlbnYuTlVYVF9QVUJMSUNfQkVUVEVSX0FVVEhfVVJMIHx8IGVudi5OVVhUX1BVQkxJQ19BVVRIX1VSTCB8fCAoZW52LkJBU0VfVVJMICE9PSBcIi9cIiA/IGVudi5CQVNFX1VSTCA6IHZvaWQgMCk7XG4gIGlmIChmcm9tRW52KSB7XG4gICAgcmV0dXJuIHdpdGhQYXRoKGZyb21FbnYsIHBhdGgpO1xuICB9XG4gIGNvbnN0IGZyb21SZXF1ZXN0ID0gcmVxdWVzdD8uaGVhZGVycy5nZXQoXCJ4LWZvcndhcmRlZC1ob3N0XCIpO1xuICBjb25zdCBmcm9tUmVxdWVzdFByb3RvID0gcmVxdWVzdD8uaGVhZGVycy5nZXQoXCJ4LWZvcndhcmRlZC1wcm90b1wiKTtcbiAgaWYgKGZyb21SZXF1ZXN0ICYmIGZyb21SZXF1ZXN0UHJvdG8pIHtcbiAgICByZXR1cm4gd2l0aFBhdGgoYCR7ZnJvbVJlcXVlc3RQcm90b306Ly8ke2Zyb21SZXF1ZXN0fWAsIHBhdGgpO1xuICB9XG4gIGlmIChyZXF1ZXN0KSB7XG4gICAgY29uc3QgdXJsMiA9IGdldE9yaWdpbihyZXF1ZXN0LnVybCk7XG4gICAgaWYgKCF1cmwyKSB7XG4gICAgICB0aHJvdyBuZXcgQmV0dGVyQXV0aEVycm9yKFxuICAgICAgICBcIkNvdWxkIG5vdCBnZXQgb3JpZ2luIGZyb20gcmVxdWVzdC4gUGxlYXNlIHByb3ZpZGUgYSB2YWxpZCBiYXNlIFVSTC5cIlxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIHdpdGhQYXRoKHVybDIsIHBhdGgpO1xuICB9XG4gIGlmICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiICYmIHdpbmRvdy5sb2NhdGlvbikge1xuICAgIHJldHVybiB3aXRoUGF0aCh3aW5kb3cubG9jYXRpb24ub3JpZ2luLCBwYXRoKTtcbiAgfVxuICByZXR1cm4gdm9pZCAwO1xufVxuZnVuY3Rpb24gZ2V0T3JpZ2luKHVybCkge1xuICB0cnkge1xuICAgIGNvbnN0IHBhcnNlZFVybCA9IG5ldyBVUkwodXJsKTtcbiAgICByZXR1cm4gcGFyc2VkVXJsLm9yaWdpbjtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuZnVuY3Rpb24gZ2V0UHJvdG9jb2wodXJsKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgcGFyc2VkVXJsID0gbmV3IFVSTCh1cmwpO1xuICAgIHJldHVybiBwYXJzZWRVcmwucHJvdG9jb2w7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cbmZ1bmN0aW9uIGdldEhvc3QodXJsKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgcGFyc2VkVXJsID0gbmV3IFVSTCh1cmwpO1xuICAgIHJldHVybiBwYXJzZWRVcmwuaG9zdDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gdXJsO1xuICB9XG59XG5cbmV4cG9ydCB7IGdldEJhc2VVUkwgYXMgYSwgZ2V0SG9zdCBhcyBiLCBnZXRQcm90b2NvbCBhcyBjLCBnZXRPcmlnaW4gYXMgZyB9O1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/../../node_modules/better-auth/dist/shared/better-auth.VTXNLFMT.mjs\n");

/***/ }),

/***/ "(ssr)/../../node_modules/better-auth/dist/shared/better-auth.ffWeg50w.mjs":
/*!***************************************************************************!*\
  !*** ../../node_modules/better-auth/dist/shared/better-auth.ffWeg50w.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   p: () => (/* binding */ parseJSON)\n/* harmony export */ });\nconst PROTO_POLLUTION_PATTERNS = {\n  proto: /\"(?:_|\\\\u0{2}5[Ff]){2}(?:p|\\\\u0{2}70)(?:r|\\\\u0{2}72)(?:o|\\\\u0{2}6[Ff])(?:t|\\\\u0{2}74)(?:o|\\\\u0{2}6[Ff])(?:_|\\\\u0{2}5[Ff]){2}\"\\s*:/,\n  constructor: /\"(?:c|\\\\u0063)(?:o|\\\\u006[Ff])(?:n|\\\\u006[Ee])(?:s|\\\\u0073)(?:t|\\\\u0074)(?:r|\\\\u0072)(?:u|\\\\u0075)(?:c|\\\\u0063)(?:t|\\\\u0074)(?:o|\\\\u006[Ff])(?:r|\\\\u0072)\"\\s*:/,\n  protoShort: /\"__proto__\"\\s*:/,\n  constructorShort: /\"constructor\"\\s*:/\n};\nconst JSON_SIGNATURE = /^\\s*[\"[{]|^\\s*-?\\d{1,16}(\\.\\d{1,17})?([Ee][+-]?\\d+)?\\s*$/;\nconst SPECIAL_VALUES = {\n  true: true,\n  false: false,\n  null: null,\n  undefined: void 0,\n  nan: Number.NaN,\n  infinity: Number.POSITIVE_INFINITY,\n  \"-infinity\": Number.NEGATIVE_INFINITY\n};\nconst ISO_DATE_REGEX = /^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})(?:\\.(\\d{1,7}))?(?:Z|([+-])(\\d{2}):(\\d{2}))$/;\nfunction isValidDate(date) {\n  return date instanceof Date && !isNaN(date.getTime());\n}\nfunction parseISODate(value) {\n  const match = ISO_DATE_REGEX.exec(value);\n  if (!match) return null;\n  const [\n    ,\n    year,\n    month,\n    day,\n    hour,\n    minute,\n    second,\n    ms,\n    offsetSign,\n    offsetHour,\n    offsetMinute\n  ] = match;\n  let date = new Date(\n    Date.UTC(\n      parseInt(year, 10),\n      parseInt(month, 10) - 1,\n      parseInt(day, 10),\n      parseInt(hour, 10),\n      parseInt(minute, 10),\n      parseInt(second, 10),\n      ms ? parseInt(ms.padEnd(3, \"0\"), 10) : 0\n    )\n  );\n  if (offsetSign) {\n    const offset = (parseInt(offsetHour, 10) * 60 + parseInt(offsetMinute, 10)) * (offsetSign === \"+\" ? -1 : 1);\n    date.setUTCMinutes(date.getUTCMinutes() + offset);\n  }\n  return isValidDate(date) ? date : null;\n}\nfunction betterJSONParse(value, options = {}) {\n  const {\n    strict = false,\n    warnings = false,\n    reviver,\n    parseDates = true\n  } = options;\n  if (typeof value !== \"string\") {\n    return value;\n  }\n  const trimmed = value.trim();\n  if (trimmed[0] === '\"' && trimmed.endsWith('\"') && !trimmed.slice(1, -1).includes('\"')) {\n    return trimmed.slice(1, -1);\n  }\n  const lowerValue = trimmed.toLowerCase();\n  if (lowerValue.length <= 9 && lowerValue in SPECIAL_VALUES) {\n    return SPECIAL_VALUES[lowerValue];\n  }\n  if (!JSON_SIGNATURE.test(trimmed)) {\n    if (strict) {\n      throw new SyntaxError(\"[better-json] Invalid JSON\");\n    }\n    return value;\n  }\n  const hasProtoPattern = Object.entries(PROTO_POLLUTION_PATTERNS).some(\n    ([key, pattern]) => {\n      const matches = pattern.test(trimmed);\n      if (matches && warnings) {\n        console.warn(\n          `[better-json] Detected potential prototype pollution attempt using ${key} pattern`\n        );\n      }\n      return matches;\n    }\n  );\n  if (hasProtoPattern && strict) {\n    throw new Error(\n      \"[better-json] Potential prototype pollution attempt detected\"\n    );\n  }\n  try {\n    const secureReviver = (key, value2) => {\n      if (key === \"__proto__\" || key === \"constructor\" && value2 && typeof value2 === \"object\" && \"prototype\" in value2) {\n        if (warnings) {\n          console.warn(\n            `[better-json] Dropping \"${key}\" key to prevent prototype pollution`\n          );\n        }\n        return void 0;\n      }\n      if (parseDates && typeof value2 === \"string\") {\n        const date = parseISODate(value2);\n        if (date) {\n          return date;\n        }\n      }\n      return reviver ? reviver(key, value2) : value2;\n    };\n    return JSON.parse(trimmed, secureReviver);\n  } catch (error) {\n    if (strict) {\n      throw error;\n    }\n    return value;\n  }\n}\nfunction parseJSON(value, options = { strict: true }) {\n  return betterJSONParse(value, options);\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi4vLi4vbm9kZV9tb2R1bGVzL2JldHRlci1hdXRoL2Rpc3Qvc2hhcmVkL2JldHRlci1hdXRoLmZmV2VnNTB3Lm1qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQUE7QUFDQSxxQkFBcUIsRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFFLGFBQWEsRUFBRSxhQUFhLEVBQUUsZ0JBQWdCLEVBQUUsYUFBYSxFQUFFLGdCQUFnQixFQUFFLE9BQU8sRUFBRTtBQUN0STtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyxXQUFXLEtBQUssTUFBTSxLQUFLO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QixFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsVUFBVSxJQUFJLGtCQUFrQixFQUFFLE1BQU0sRUFBRTtBQUNqSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEM7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdGQUFnRixLQUFLO0FBQ3JGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QyxJQUFJO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyxjQUFjO0FBQ3BEO0FBQ0E7O0FBRTBCIiwic291cmNlcyI6WyIvVXNlcnMvbWlsYW4vRGVza3RvcC9BcHBzL2JldHRlci1hdXRoL25vZGVfbW9kdWxlcy9iZXR0ZXItYXV0aC9kaXN0L3NoYXJlZC9iZXR0ZXItYXV0aC5mZldlZzUwdy5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgUFJPVE9fUE9MTFVUSU9OX1BBVFRFUk5TID0ge1xuICBwcm90bzogL1wiKD86X3xcXFxcdTB7Mn01W0ZmXSl7Mn0oPzpwfFxcXFx1MHsyfTcwKSg/OnJ8XFxcXHUwezJ9NzIpKD86b3xcXFxcdTB7Mn02W0ZmXSkoPzp0fFxcXFx1MHsyfTc0KSg/Om98XFxcXHUwezJ9NltGZl0pKD86X3xcXFxcdTB7Mn01W0ZmXSl7Mn1cIlxccyo6LyxcbiAgY29uc3RydWN0b3I6IC9cIig/OmN8XFxcXHUwMDYzKSg/Om98XFxcXHUwMDZbRmZdKSg/Om58XFxcXHUwMDZbRWVdKSg/OnN8XFxcXHUwMDczKSg/OnR8XFxcXHUwMDc0KSg/OnJ8XFxcXHUwMDcyKSg/OnV8XFxcXHUwMDc1KSg/OmN8XFxcXHUwMDYzKSg/OnR8XFxcXHUwMDc0KSg/Om98XFxcXHUwMDZbRmZdKSg/OnJ8XFxcXHUwMDcyKVwiXFxzKjovLFxuICBwcm90b1Nob3J0OiAvXCJfX3Byb3RvX19cIlxccyo6LyxcbiAgY29uc3RydWN0b3JTaG9ydDogL1wiY29uc3RydWN0b3JcIlxccyo6L1xufTtcbmNvbnN0IEpTT05fU0lHTkFUVVJFID0gL15cXHMqW1wiW3tdfF5cXHMqLT9cXGR7MSwxNn0oXFwuXFxkezEsMTd9KT8oW0VlXVsrLV0/XFxkKyk/XFxzKiQvO1xuY29uc3QgU1BFQ0lBTF9WQUxVRVMgPSB7XG4gIHRydWU6IHRydWUsXG4gIGZhbHNlOiBmYWxzZSxcbiAgbnVsbDogbnVsbCxcbiAgdW5kZWZpbmVkOiB2b2lkIDAsXG4gIG5hbjogTnVtYmVyLk5hTixcbiAgaW5maW5pdHk6IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSxcbiAgXCItaW5maW5pdHlcIjogTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZXG59O1xuY29uc3QgSVNPX0RBVEVfUkVHRVggPSAvXihcXGR7NH0pLShcXGR7Mn0pLShcXGR7Mn0pVChcXGR7Mn0pOihcXGR7Mn0pOihcXGR7Mn0pKD86XFwuKFxcZHsxLDd9KSk/KD86WnwoWystXSkoXFxkezJ9KTooXFxkezJ9KSkkLztcbmZ1bmN0aW9uIGlzVmFsaWREYXRlKGRhdGUpIHtcbiAgcmV0dXJuIGRhdGUgaW5zdGFuY2VvZiBEYXRlICYmICFpc05hTihkYXRlLmdldFRpbWUoKSk7XG59XG5mdW5jdGlvbiBwYXJzZUlTT0RhdGUodmFsdWUpIHtcbiAgY29uc3QgbWF0Y2ggPSBJU09fREFURV9SRUdFWC5leGVjKHZhbHVlKTtcbiAgaWYgKCFtYXRjaCkgcmV0dXJuIG51bGw7XG4gIGNvbnN0IFtcbiAgICAsXG4gICAgeWVhcixcbiAgICBtb250aCxcbiAgICBkYXksXG4gICAgaG91cixcbiAgICBtaW51dGUsXG4gICAgc2Vjb25kLFxuICAgIG1zLFxuICAgIG9mZnNldFNpZ24sXG4gICAgb2Zmc2V0SG91cixcbiAgICBvZmZzZXRNaW51dGVcbiAgXSA9IG1hdGNoO1xuICBsZXQgZGF0ZSA9IG5ldyBEYXRlKFxuICAgIERhdGUuVVRDKFxuICAgICAgcGFyc2VJbnQoeWVhciwgMTApLFxuICAgICAgcGFyc2VJbnQobW9udGgsIDEwKSAtIDEsXG4gICAgICBwYXJzZUludChkYXksIDEwKSxcbiAgICAgIHBhcnNlSW50KGhvdXIsIDEwKSxcbiAgICAgIHBhcnNlSW50KG1pbnV0ZSwgMTApLFxuICAgICAgcGFyc2VJbnQoc2Vjb25kLCAxMCksXG4gICAgICBtcyA/IHBhcnNlSW50KG1zLnBhZEVuZCgzLCBcIjBcIiksIDEwKSA6IDBcbiAgICApXG4gICk7XG4gIGlmIChvZmZzZXRTaWduKSB7XG4gICAgY29uc3Qgb2Zmc2V0ID0gKHBhcnNlSW50KG9mZnNldEhvdXIsIDEwKSAqIDYwICsgcGFyc2VJbnQob2Zmc2V0TWludXRlLCAxMCkpICogKG9mZnNldFNpZ24gPT09IFwiK1wiID8gLTEgOiAxKTtcbiAgICBkYXRlLnNldFVUQ01pbnV0ZXMoZGF0ZS5nZXRVVENNaW51dGVzKCkgKyBvZmZzZXQpO1xuICB9XG4gIHJldHVybiBpc1ZhbGlkRGF0ZShkYXRlKSA/IGRhdGUgOiBudWxsO1xufVxuZnVuY3Rpb24gYmV0dGVySlNPTlBhcnNlKHZhbHVlLCBvcHRpb25zID0ge30pIHtcbiAgY29uc3Qge1xuICAgIHN0cmljdCA9IGZhbHNlLFxuICAgIHdhcm5pbmdzID0gZmFsc2UsXG4gICAgcmV2aXZlcixcbiAgICBwYXJzZURhdGVzID0gdHJ1ZVxuICB9ID0gb3B0aW9ucztcbiAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gXCJzdHJpbmdcIikge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuICBjb25zdCB0cmltbWVkID0gdmFsdWUudHJpbSgpO1xuICBpZiAodHJpbW1lZFswXSA9PT0gJ1wiJyAmJiB0cmltbWVkLmVuZHNXaXRoKCdcIicpICYmICF0cmltbWVkLnNsaWNlKDEsIC0xKS5pbmNsdWRlcygnXCInKSkge1xuICAgIHJldHVybiB0cmltbWVkLnNsaWNlKDEsIC0xKTtcbiAgfVxuICBjb25zdCBsb3dlclZhbHVlID0gdHJpbW1lZC50b0xvd2VyQ2FzZSgpO1xuICBpZiAobG93ZXJWYWx1ZS5sZW5ndGggPD0gOSAmJiBsb3dlclZhbHVlIGluIFNQRUNJQUxfVkFMVUVTKSB7XG4gICAgcmV0dXJuIFNQRUNJQUxfVkFMVUVTW2xvd2VyVmFsdWVdO1xuICB9XG4gIGlmICghSlNPTl9TSUdOQVRVUkUudGVzdCh0cmltbWVkKSkge1xuICAgIGlmIChzdHJpY3QpIHtcbiAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcihcIltiZXR0ZXItanNvbl0gSW52YWxpZCBKU09OXCIpO1xuICAgIH1cbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cbiAgY29uc3QgaGFzUHJvdG9QYXR0ZXJuID0gT2JqZWN0LmVudHJpZXMoUFJPVE9fUE9MTFVUSU9OX1BBVFRFUk5TKS5zb21lKFxuICAgIChba2V5LCBwYXR0ZXJuXSkgPT4ge1xuICAgICAgY29uc3QgbWF0Y2hlcyA9IHBhdHRlcm4udGVzdCh0cmltbWVkKTtcbiAgICAgIGlmIChtYXRjaGVzICYmIHdhcm5pbmdzKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICBgW2JldHRlci1qc29uXSBEZXRlY3RlZCBwb3RlbnRpYWwgcHJvdG90eXBlIHBvbGx1dGlvbiBhdHRlbXB0IHVzaW5nICR7a2V5fSBwYXR0ZXJuYFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG1hdGNoZXM7XG4gICAgfVxuICApO1xuICBpZiAoaGFzUHJvdG9QYXR0ZXJuICYmIHN0cmljdCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIFwiW2JldHRlci1qc29uXSBQb3RlbnRpYWwgcHJvdG90eXBlIHBvbGx1dGlvbiBhdHRlbXB0IGRldGVjdGVkXCJcbiAgICApO1xuICB9XG4gIHRyeSB7XG4gICAgY29uc3Qgc2VjdXJlUmV2aXZlciA9IChrZXksIHZhbHVlMikgPT4ge1xuICAgICAgaWYgKGtleSA9PT0gXCJfX3Byb3RvX19cIiB8fCBrZXkgPT09IFwiY29uc3RydWN0b3JcIiAmJiB2YWx1ZTIgJiYgdHlwZW9mIHZhbHVlMiA9PT0gXCJvYmplY3RcIiAmJiBcInByb3RvdHlwZVwiIGluIHZhbHVlMikge1xuICAgICAgICBpZiAod2FybmluZ3MpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICBgW2JldHRlci1qc29uXSBEcm9wcGluZyBcIiR7a2V5fVwiIGtleSB0byBwcmV2ZW50IHByb3RvdHlwZSBwb2xsdXRpb25gXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdm9pZCAwO1xuICAgICAgfVxuICAgICAgaWYgKHBhcnNlRGF0ZXMgJiYgdHlwZW9mIHZhbHVlMiA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICBjb25zdCBkYXRlID0gcGFyc2VJU09EYXRlKHZhbHVlMik7XG4gICAgICAgIGlmIChkYXRlKSB7XG4gICAgICAgICAgcmV0dXJuIGRhdGU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiByZXZpdmVyID8gcmV2aXZlcihrZXksIHZhbHVlMikgOiB2YWx1ZTI7XG4gICAgfTtcbiAgICByZXR1cm4gSlNPTi5wYXJzZSh0cmltbWVkLCBzZWN1cmVSZXZpdmVyKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBpZiAoc3RyaWN0KSB7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG59XG5mdW5jdGlvbiBwYXJzZUpTT04odmFsdWUsIG9wdGlvbnMgPSB7IHN0cmljdDogdHJ1ZSB9KSB7XG4gIHJldHVybiBiZXR0ZXJKU09OUGFyc2UodmFsdWUsIG9wdGlvbnMpO1xufVxuXG5leHBvcnQgeyBwYXJzZUpTT04gYXMgcCB9O1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/../../node_modules/better-auth/dist/shared/better-auth.ffWeg50w.mjs\n");

/***/ })

};
;